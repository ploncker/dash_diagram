/*! For license information please see dash_diagram.min.js.LICENSE.txt */
(()=>{var __webpack_modules__={827:(t,e,n)=>{"use strict";n.d(e,{A:()=>a});var i=n(354),r=n.n(i),o=n(314),s=n.n(o)()(r());s.push([t.id,'/* this CSS contains only the basic CSS needed to run the app and use it */\n\n.lgraphcanvas {\n    /*cursor: crosshair;*/\n    user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n\toutline: none;\n    font-family: Tahoma, sans-serif;\n}\n\n.lgraphcanvas * {\n    box-sizing: border-box;\n}\n\n.litegraph.litecontextmenu {\n    font-family: Tahoma, sans-serif;\n    position: fixed;\n    top: 100px;\n    left: 100px;\n    min-width: 100px;\n    color: #aaf;\n    padding: 0;\n    box-shadow: 0 0 10px black !important;\n    background-color: #2e2e2e !important;\n\tz-index: 10;\n}\n\n.litegraph.litecontextmenu.dark {\n    background-color: #000 !important;\n}\n\n.litegraph.litecontextmenu .litemenu-title img {\n    margin-top: 2px;\n    margin-left: 2px;\n    margin-right: 4px;\n}\n\n.litegraph.litecontextmenu .litemenu-entry {\n    margin: 2px;\n    padding: 2px;\n}\n\n.litegraph.litecontextmenu .litemenu-entry.submenu {\n    background-color: #2e2e2e !important;\n}\n\n.litegraph.litecontextmenu.dark .litemenu-entry.submenu {\n    background-color: #000 !important;\n}\n\n.litegraph .litemenubar ul {\n    font-family: Tahoma, sans-serif;\n    margin: 0;\n    padding: 0;\n}\n\n.litegraph .litemenubar li {\n    font-size: 14px;\n    color: #999;\n    display: inline-block;\n    min-width: 50px;\n    padding-left: 10px;\n    padding-right: 10px;\n    user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    cursor: pointer;\n}\n\n.litegraph .litemenubar li:hover {\n    background-color: #777;\n    color: #eee;\n}\n\n.litegraph .litegraph .litemenubar-panel {\n    position: absolute;\n    top: 5px;\n    left: 5px;\n    min-width: 100px;\n    background-color: #444;\n    box-shadow: 0 0 3px black;\n    padding: 4px;\n    border-bottom: 2px solid #aaf;\n    z-index: 10;\n}\n\n.litegraph .litemenu-entry,\n.litemenu-title {\n    font-size: 12px;\n    color: #aaa;\n    padding: 0 0 0 4px;\n    margin: 2px;\n    padding-left: 2px;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    user-select: none;\n    cursor: pointer;\n}\n\n.litegraph .litemenu-entry .icon {\n    display: inline-block;\n    width: 12px;\n    height: 12px;\n    margin: 2px;\n    vertical-align: top;\n}\n\n.litegraph .litemenu-entry.checked .icon {\n    background-color: #aaf;\n}\n\n.litegraph .litemenu-entry .more {\n    float: right;\n    padding-right: 5px;\n}\n\n.litegraph .litemenu-entry.disabled {\n    opacity: 0.5;\n    cursor: default;\n}\n\n.litegraph .litemenu-entry.separator {\n    display: block;\n    border-top: 1px solid #333;\n    border-bottom: 1px solid #666;\n    width: 100%;\n    height: 0px;\n    margin: 3px 0 2px 0;\n    background-color: transparent;\n    padding: 0 !important;\n    cursor: default !important;\n}\n\n.litegraph .litemenu-entry.has_submenu {\n    border-right: 2px solid cyan;\n}\n\n.litegraph .litemenu-title {\n    color: #dde;\n    background-color: #111;\n    margin: 0;\n    padding: 2px;\n    cursor: default;\n}\n\n.litegraph .litemenu-entry:hover:not(.disabled):not(.separator) {\n    background-color: #444 !important;\n    color: #eee;\n    transition: all 0.2s;\n}\n\n.litegraph .litemenu-entry .property_name {\n    display: inline-block;\n    text-align: left;\n    min-width: 80px;\n    min-height: 1.2em;\n}\n\n.litegraph .litemenu-entry .property_value {\n    display: inline-block;\n    background-color: rgba(0, 0, 0, 0.5);\n    text-align: right;\n    min-width: 80px;\n    min-height: 1.2em;\n    vertical-align: middle;\n    padding-right: 10px;\n}\n\n.litegraph.litesearchbox {\n    font-family: Tahoma, sans-serif;\n    position: absolute;\n    background-color: rgba(0, 0, 0, 0.5);\n    padding-top: 4px;\n}\n\n.litegraph.litesearchbox input,\n.litegraph.litesearchbox select {\n    margin-top: 3px;\n    min-width: 60px;\n    min-height: 1.5em;\n    background-color: black;\n    border: 0;\n    color: white;\n    padding-left: 10px;\n    margin-right: 5px;\n}\n\n.litegraph.litesearchbox .name {\n    display: inline-block;\n    min-width: 60px;\n    min-height: 1.5em;\n    padding-left: 10px;\n}\n\n.litegraph.litesearchbox .helper {\n    overflow: auto;\n    max-height: 200px;\n    margin-top: 2px;\n}\n\n.litegraph.lite-search-item {\n    font-family: Tahoma, sans-serif;\n    background-color: rgba(0, 0, 0, 0.5);\n    color: white;\n    padding-top: 2px;\n}\n\n.litegraph.lite-search-item.not_in_filter{\n    /*background-color: rgba(50, 50, 50, 0.5);*/\n    /*color: #999;*/\n    color: #B99;\n    font-style: italic;\n}\n\n.litegraph.lite-search-item.generic_type{\n    /*background-color: rgba(50, 50, 50, 0.5);*/\n    /*color: #DD9;*/\n    color: #999;\n    font-style: italic;\n}\n\n.litegraph.lite-search-item:hover,\n.litegraph.lite-search-item.selected {\n    cursor: pointer;\n    background-color: white;\n    color: black;\n}\n\n/* DIALOGs ******/\n\n.litegraph .dialog {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    margin-top: -150px;\n    margin-left: -200px;\n\n    background-color: #2A2A2A;\n\n    min-width: 400px;\n    min-height: 200px;\n\tbox-shadow: 0 0 4px #111;\n    border-radius: 6px;\n}\n\n.litegraph .dialog.settings {\n\tleft: 10px;\n\ttop: 10px;\n\theight: calc( 100% - 20px );\n\tmargin: auto;\n    max-width: 50%;\n}\n\n.litegraph .dialog.centered {\n    top: 50px;\n    left: 50%;\n    position: absolute;\n    transform: translateX(-50%);\n    min-width: 600px;\n    min-height: 300px;\n    height: calc( 100% - 100px );\n\tmargin: auto;\n}\n\n.litegraph .dialog .close {\n    float: right;\n\tmargin: 4px;\n\tmargin-right: 10px;\n\tcursor: pointer;\n\tfont-size: 1.4em;\n}\n\n.litegraph .dialog .close:hover {\n\tcolor: white;\n}\n\n.litegraph .dialog .dialog-header {\n\tcolor: #AAA;\n\tborder-bottom: 1px solid #161616;\n}\n\n.litegraph .dialog .dialog-header { height: 40px; }\n.litegraph .dialog .dialog-footer { height: 50px; padding: 10px; border-top: 1px solid #1a1a1a;}\n\n.litegraph .dialog .dialog-header .dialog-title {\n    font: 20px "Arial";\n    margin: 4px;\n    padding: 4px 10px;\n    display: inline-block;\n}\n\n.litegraph .dialog .dialog-content, .litegraph .dialog .dialog-alt-content {\n    height: calc(100% - 90px);\n    width: 100%;\n\tmin-height: 100px;\n    display: inline-block;\n\tcolor: #AAA;\n    /*background-color: black;*/\n    overflow: auto;\n}\n\n.litegraph .dialog .dialog-content h3 {\n\tmargin: 10px;\n}\n\n.litegraph .dialog .dialog-content .connections {\n\tflex-direction: row;\n}\n\n.litegraph .dialog .dialog-content .connections .connections_side {\n\twidth: calc(50% - 5px);\n\tmin-height: 100px;\n\tbackground-color: black;\n\tdisplay: flex;\n}\n\n.litegraph .dialog .node_type {\n\tfont-size: 1.2em;\n\tdisplay: block;\n\tmargin: 10px;\n}\n\n.litegraph .dialog .node_desc {\n\topacity: 0.5;\n\tdisplay: block;\n\tmargin: 10px;\n}\n\n.litegraph .dialog .separator {\n\tdisplay: block;\n\twidth: calc( 100% - 4px );\n\theight: 1px;\n\tborder-top: 1px solid #000;\n\tborder-bottom: 1px solid #333;\n\tmargin: 10px 2px;\n\tpadding: 0;\n}\n\n.litegraph .dialog .property {\n\tmargin-bottom: 2px;\n\tpadding: 4px;\n}\n\n.litegraph .dialog .property:hover {\n\tbackground: #545454;\n}\n\n.litegraph .dialog .property_name {\n\tcolor: #737373;\n    display: inline-block;\n    text-align: left;\n    vertical-align: top;\n    width: 160px;\n\tpadding-left: 4px;\n\toverflow: hidden;\n    margin-right: 6px;\n}\n\n.litegraph .dialog .property:hover .property_name {\n    color: white;\n}\n\n.litegraph .dialog .property_value {\n    display: inline-block;\n    text-align: right;\n\tcolor: #AAA;\n\tbackground-color: #1A1A1A;\n    /*width: calc( 100% - 122px );*/\n    max-width: calc( 100% - 162px );\n    min-width: 200px;\n\tmax-height: 300px;\n    min-height: 20px;\n    padding: 4px;\n\tpadding-right: 12px;\n\toverflow: hidden;\n\tcursor: pointer;\n\tborder-radius: 3px;\n}\n\n.litegraph .dialog .property_value:hover {\n\tcolor: white;\n}\n\n.litegraph .dialog .property.boolean .property_value {\n\tpadding-right: 30px;\n    color: #A88;\n    /*width: auto;\n    float: right;*/\n}\n\n.litegraph .dialog .property.boolean.bool-on .property_name{\n    color: #8A8;\n}\n.litegraph .dialog .property.boolean.bool-on .property_value{\n    color: #8A8;\n}\n\n.litegraph .dialog .btn {\n\tborder: 0;\n\tborder-radius: 4px;\n    padding: 4px 20px;\n    margin-left: 0px;\n    background-color: #060606;\n    color: #8e8e8e;\n}\n\n.litegraph .dialog .btn:hover {\n    background-color: #111;\n    color: #FFF;\n}\n\n.litegraph .dialog .btn.delete:hover {\n    background-color: #F33;\n    color: black;\n}\n\n.litegraph .subgraph_property {\n\tpadding: 4px;\n}\n\n.litegraph .subgraph_property:hover {\n\tbackground-color: #333;\n}\n\n.litegraph .subgraph_property.extra {\n    margin-top: 8px;\n}\n\n.litegraph .subgraph_property span.name {\n\tfont-size: 1.3em;\n\tpadding-left: 4px;\n}\n\n.litegraph .subgraph_property span.type {\n\topacity: 0.5;\n\tmargin-right: 20px;\n\tpadding-left: 4px;\n}\n\n.litegraph .subgraph_property span.label {\n\tdisplay: inline-block;\n\twidth: 60px;\n\tpadding:  0px 10px;\n}\n\n.litegraph .subgraph_property input {\n\twidth: 140px;\n\tcolor: #999;\n\tbackground-color: #1A1A1A;\n\tborder-radius: 4px;\n\tborder: 0;\n\tmargin-right: 10px;\n\tpadding: 4px;\n\tpadding-left: 10px;\n}\n\n.litegraph .subgraph_property button {\n\tbackground-color: #1c1c1c;\n\tcolor: #aaa;\n\tborder: 0;\n\tborder-radius: 2px;\n\tpadding: 4px 10px;\n\tcursor: pointer;\n}\n\n.litegraph .subgraph_property.extra {\n\tcolor: #ccc;\n}\n\n.litegraph .subgraph_property.extra input {\n\tbackground-color: #111;\n}\n\n.litegraph .bullet_icon {\n\tmargin-left: 10px;\n\tborder-radius: 10px;\n\twidth: 12px;\n\theight: 12px;\n\tbackground-color: #666;\n\tdisplay: inline-block;\n\tmargin-top: 2px;\n\tmargin-right: 4px;\n    transition: background-color 0.1s ease 0s;\n    -moz-transition: background-color 0.1s ease 0s;\n}\n\n.litegraph .bullet_icon:hover {\n\tbackground-color: #698;\n\tcursor: pointer;\n} \n\n/* OLD */\n\n.graphcontextmenu {\n    padding: 4px;\n    min-width: 100px;\n}\n\n.graphcontextmenu-title {\n    color: #dde;\n    background-color: #222;\n    margin: 0;\n    padding: 2px;\n    cursor: default;\n}\n\n.graphmenu-entry {\n    box-sizing: border-box;\n    margin: 2px;\n    padding-left: 20px;\n    user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    transition: all linear 0.3s;\n}\n\n.graphmenu-entry.event,\n.litemenu-entry.event {\n    border-left: 8px solid orange;\n    padding-left: 12px;\n}\n\n.graphmenu-entry.disabled {\n    opacity: 0.3;\n}\n\n.graphmenu-entry.submenu {\n    border-right: 2px solid #eee;\n}\n\n.graphmenu-entry:hover {\n    background-color: #555;\n}\n\n.graphmenu-entry.separator {\n    background-color: #111;\n    border-bottom: 1px solid #666;\n    height: 1px;\n    width: calc(100% - 20px);\n    -moz-width: calc(100% - 20px);\n    -webkit-width: calc(100% - 20px);\n}\n\n.graphmenu-entry .property_name {\n    display: inline-block;\n    text-align: left;\n    min-width: 80px;\n    min-height: 1.2em;\n}\n\n.graphmenu-entry .property_value,\n.litemenu-entry .property_value {\n    display: inline-block;\n    background-color: rgba(0, 0, 0, 0.5);\n    text-align: right;\n    min-width: 80px;\n    min-height: 1.2em;\n    vertical-align: middle;\n    padding-right: 10px;\n}\n\n.graphdialog {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    min-height: 2em;\n    background-color: #333;\n    font-size: 1.2em;\n    box-shadow: 0 0 10px black !important;\n\tz-index: 10;\n}\n\n.graphdialog.rounded {\n    border-radius: 12px;\n    padding-right: 2px;\n}\n\n.graphdialog .name {\n    display: inline-block;\n    min-width: 60px;\n    min-height: 1.5em;\n    padding-left: 10px;\n}\n\n.graphdialog input,\n.graphdialog textarea,\n.graphdialog select {\n    margin: 3px;\n    min-width: 60px;\n    min-height: 1.5em;\n    background-color: black;\n    border: 0;\n    color: white;\n    padding-left: 10px;\n    outline: none;\n}\n\n.graphdialog textarea {\n\tmin-height: 150px;\n}\n\n.graphdialog button {\n    margin-top: 3px;\n    vertical-align: top;\n    background-color: #999;\n\tborder: 0;\n}\n\n.graphdialog button.rounded,\n.graphdialog input.rounded {\n    border-radius: 0 12px 12px 0;\n}\n\n.graphdialog .helper {\n    overflow: auto;\n    max-height: 200px;\n}\n\n.graphdialog .help-item {\n    padding-left: 10px;\n}\n\n.graphdialog .help-item:hover,\n.graphdialog .help-item.selected {\n    cursor: pointer;\n    background-color: white;\n    color: black;\n}\n\n.litegraph .dialog {\n    min-height: 0;\n}\n.litegraph .dialog .dialog-content {\ndisplay: block;\n}\n.litegraph .dialog .dialog-content .subgraph_property {\npadding: 5px;\n}\n.litegraph .dialog .dialog-footer {\nmargin: 0;\n}\n.litegraph .dialog .dialog-footer .subgraph_property {\nmargin-top: 0;\ndisplay: flex;\nalign-items: center;\npadding: 5px;\n}\n.litegraph .dialog .dialog-footer .subgraph_property .name {\nflex: 1;\n}\n.litegraph .graphdialog {\ndisplay: flex;\nalign-items: center;\nborder-radius: 20px;\npadding: 4px 10px;\nposition: fixed;\n}\n.litegraph .graphdialog .name {\npadding: 0;\nmin-height: 0;\nfont-size: 16px;\nvertical-align: middle;\n}\n.litegraph .graphdialog .value {\nfont-size: 16px;\nmin-height: 0;\nmargin: 0 10px;\npadding: 2px 5px;\n}\n.litegraph .graphdialog input[type="checkbox"] {\nwidth: 16px;\nheight: 16px;\n}\n.litegraph .graphdialog button {\npadding: 4px 18px;\nborder-radius: 20px;\ncursor: pointer;\n}\n  \n',"",{version:3,sources:["webpack://./node_modules/litegraph.js/css/litegraph.css"],names:[],mappings:"AAAA,0EAA0E;;AAE1E;IACI,qBAAqB;IACrB,iBAAiB;IACjB,sBAAsB;IACtB,yBAAyB;CAC5B,aAAa;IACV,+BAA+B;AACnC;;AAEA;IACI,sBAAsB;AAC1B;;AAEA;IACI,+BAA+B;IAC/B,eAAe;IACf,UAAU;IACV,WAAW;IACX,gBAAgB;IAChB,WAAW;IACX,UAAU;IACV,qCAAqC;IACrC,oCAAoC;CACvC,WAAW;AACZ;;AAEA;IACI,iCAAiC;AACrC;;AAEA;IACI,eAAe;IACf,gBAAgB;IAChB,iBAAiB;AACrB;;AAEA;IACI,WAAW;IACX,YAAY;AAChB;;AAEA;IACI,oCAAoC;AACxC;;AAEA;IACI,iCAAiC;AACrC;;AAEA;IACI,+BAA+B;IAC/B,SAAS;IACT,UAAU;AACd;;AAEA;IACI,eAAe;IACf,WAAW;IACX,qBAAqB;IACrB,eAAe;IACf,kBAAkB;IAClB,mBAAmB;IACnB,iBAAiB;IACjB,sBAAsB;IACtB,yBAAyB;IACzB,eAAe;AACnB;;AAEA;IACI,sBAAsB;IACtB,WAAW;AACf;;AAEA;IACI,kBAAkB;IAClB,QAAQ;IACR,SAAS;IACT,gBAAgB;IAChB,sBAAsB;IACtB,yBAAyB;IACzB,YAAY;IACZ,6BAA6B;IAC7B,WAAW;AACf;;AAEA;;IAEI,eAAe;IACf,WAAW;IACX,kBAAkB;IAClB,WAAW;IACX,iBAAiB;IACjB,sBAAsB;IACtB,yBAAyB;IACzB,iBAAiB;IACjB,eAAe;AACnB;;AAEA;IACI,qBAAqB;IACrB,WAAW;IACX,YAAY;IACZ,WAAW;IACX,mBAAmB;AACvB;;AAEA;IACI,sBAAsB;AAC1B;;AAEA;IACI,YAAY;IACZ,kBAAkB;AACtB;;AAEA;IACI,YAAY;IACZ,eAAe;AACnB;;AAEA;IACI,cAAc;IACd,0BAA0B;IAC1B,6BAA6B;IAC7B,WAAW;IACX,WAAW;IACX,mBAAmB;IACnB,6BAA6B;IAC7B,qBAAqB;IACrB,0BAA0B;AAC9B;;AAEA;IACI,4BAA4B;AAChC;;AAEA;IACI,WAAW;IACX,sBAAsB;IACtB,SAAS;IACT,YAAY;IACZ,eAAe;AACnB;;AAEA;IACI,iCAAiC;IACjC,WAAW;IACX,oBAAoB;AACxB;;AAEA;IACI,qBAAqB;IACrB,gBAAgB;IAChB,eAAe;IACf,iBAAiB;AACrB;;AAEA;IACI,qBAAqB;IACrB,oCAAoC;IACpC,iBAAiB;IACjB,eAAe;IACf,iBAAiB;IACjB,sBAAsB;IACtB,mBAAmB;AACvB;;AAEA;IACI,+BAA+B;IAC/B,kBAAkB;IAClB,oCAAoC;IACpC,gBAAgB;AACpB;;AAEA;;IAEI,eAAe;IACf,eAAe;IACf,iBAAiB;IACjB,uBAAuB;IACvB,SAAS;IACT,YAAY;IACZ,kBAAkB;IAClB,iBAAiB;AACrB;;AAEA;IACI,qBAAqB;IACrB,eAAe;IACf,iBAAiB;IACjB,kBAAkB;AACtB;;AAEA;IACI,cAAc;IACd,iBAAiB;IACjB,eAAe;AACnB;;AAEA;IACI,+BAA+B;IAC/B,oCAAoC;IACpC,YAAY;IACZ,gBAAgB;AACpB;;AAEA;IACI,2CAA2C;IAC3C,eAAe;IACf,WAAW;IACX,kBAAkB;AACtB;;AAEA;IACI,2CAA2C;IAC3C,eAAe;IACf,WAAW;IACX,kBAAkB;AACtB;;AAEA;;IAEI,eAAe;IACf,uBAAuB;IACvB,YAAY;AAChB;;AAEA,iBAAiB;;AAEjB;IACI,kBAAkB;IAClB,QAAQ;IACR,SAAS;IACT,kBAAkB;IAClB,mBAAmB;;IAEnB,yBAAyB;;IAEzB,gBAAgB;IAChB,iBAAiB;CACpB,wBAAwB;IACrB,kBAAkB;AACtB;;AAEA;CACC,UAAU;CACV,SAAS;CACT,2BAA2B;CAC3B,YAAY;IACT,cAAc;AAClB;;AAEA;IACI,SAAS;IACT,SAAS;IACT,kBAAkB;IAClB,2BAA2B;IAC3B,gBAAgB;IAChB,iBAAiB;IACjB,4BAA4B;CAC/B,YAAY;AACb;;AAEA;IACI,YAAY;CACf,WAAW;CACX,kBAAkB;CAClB,eAAe;CACf,gBAAgB;AACjB;;AAEA;CACC,YAAY;AACb;;AAEA;CACC,WAAW;CACX,gCAAgC;AACjC;;AAEA,oCAAoC,YAAY,EAAE;AAClD,oCAAoC,YAAY,EAAE,aAAa,EAAE,6BAA6B,CAAC;;AAE/F;IACI,kBAAkB;IAClB,WAAW;IACX,iBAAiB;IACjB,qBAAqB;AACzB;;AAEA;IACI,yBAAyB;IACzB,WAAW;CACd,iBAAiB;IACd,qBAAqB;CACxB,WAAW;IACR,2BAA2B;IAC3B,cAAc;AAClB;;AAEA;CACC,YAAY;AACb;;AAEA;CACC,mBAAmB;AACpB;;AAEA;CACC,sBAAsB;CACtB,iBAAiB;CACjB,uBAAuB;CACvB,aAAa;AACd;;AAEA;CACC,gBAAgB;CAChB,cAAc;CACd,YAAY;AACb;;AAEA;CACC,YAAY;CACZ,cAAc;CACd,YAAY;AACb;;AAEA;CACC,cAAc;CACd,yBAAyB;CACzB,WAAW;CACX,0BAA0B;CAC1B,6BAA6B;CAC7B,gBAAgB;CAChB,UAAU;AACX;;AAEA;CACC,kBAAkB;CAClB,YAAY;AACb;;AAEA;CACC,mBAAmB;AACpB;;AAEA;CACC,cAAc;IACX,qBAAqB;IACrB,gBAAgB;IAChB,mBAAmB;IACnB,YAAY;CACf,iBAAiB;CACjB,gBAAgB;IACb,iBAAiB;AACrB;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,qBAAqB;IACrB,iBAAiB;CACpB,WAAW;CACX,yBAAyB;IACtB,+BAA+B;IAC/B,+BAA+B;IAC/B,gBAAgB;CACnB,iBAAiB;IACd,gBAAgB;IAChB,YAAY;CACf,mBAAmB;CACnB,gBAAgB;CAChB,eAAe;CACf,kBAAkB;AACnB;;AAEA;CACC,YAAY;AACb;;AAEA;CACC,mBAAmB;IAChB,WAAW;IACX;kBACc;AAClB;;AAEA;IACI,WAAW;AACf;AACA;IACI,WAAW;AACf;;AAEA;CACC,SAAS;CACT,kBAAkB;IACf,iBAAiB;IACjB,gBAAgB;IAChB,yBAAyB;IACzB,cAAc;AAClB;;AAEA;IACI,sBAAsB;IACtB,WAAW;AACf;;AAEA;IACI,sBAAsB;IACtB,YAAY;AAChB;;AAEA;CACC,YAAY;AACb;;AAEA;CACC,sBAAsB;AACvB;;AAEA;IACI,eAAe;AACnB;;AAEA;CACC,gBAAgB;CAChB,iBAAiB;AAClB;;AAEA;CACC,YAAY;CACZ,kBAAkB;CAClB,iBAAiB;AAClB;;AAEA;CACC,qBAAqB;CACrB,WAAW;CACX,kBAAkB;AACnB;;AAEA;CACC,YAAY;CACZ,WAAW;CACX,yBAAyB;CACzB,kBAAkB;CAClB,SAAS;CACT,kBAAkB;CAClB,YAAY;CACZ,kBAAkB;AACnB;;AAEA;CACC,yBAAyB;CACzB,WAAW;CACX,SAAS;CACT,kBAAkB;CAClB,iBAAiB;CACjB,eAAe;AAChB;;AAEA;CACC,WAAW;AACZ;;AAEA;CACC,sBAAsB;AACvB;;AAEA;CACC,iBAAiB;CACjB,mBAAmB;CACnB,WAAW;CACX,YAAY;CACZ,sBAAsB;CACtB,qBAAqB;CACrB,eAAe;CACf,iBAAiB;IACd,yCAAyC;IACzC,8CAA8C;AAClD;;AAEA;CACC,sBAAsB;CACtB,eAAe;AAChB;;AAEA,QAAQ;;AAER;IACI,YAAY;IACZ,gBAAgB;AACpB;;AAEA;IACI,WAAW;IACX,sBAAsB;IACtB,SAAS;IACT,YAAY;IACZ,eAAe;AACnB;;AAEA;IACI,sBAAsB;IACtB,WAAW;IACX,kBAAkB;IAClB,iBAAiB;IACjB,sBAAsB;IACtB,yBAAyB;IACzB,2BAA2B;AAC/B;;AAEA;;IAEI,6BAA6B;IAC7B,kBAAkB;AACtB;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,4BAA4B;AAChC;;AAEA;IACI,sBAAsB;AAC1B;;AAEA;IACI,sBAAsB;IACtB,6BAA6B;IAC7B,WAAW;IACX,wBAAwB;IACxB,6BAA6B;IAC7B,gCAAgC;AACpC;;AAEA;IACI,qBAAqB;IACrB,gBAAgB;IAChB,eAAe;IACf,iBAAiB;AACrB;;AAEA;;IAEI,qBAAqB;IACrB,oCAAoC;IACpC,iBAAiB;IACjB,eAAe;IACf,iBAAiB;IACjB,sBAAsB;IACtB,mBAAmB;AACvB;;AAEA;IACI,kBAAkB;IAClB,SAAS;IACT,UAAU;IACV,eAAe;IACf,sBAAsB;IACtB,gBAAgB;IAChB,qCAAqC;CACxC,WAAW;AACZ;;AAEA;IACI,mBAAmB;IACnB,kBAAkB;AACtB;;AAEA;IACI,qBAAqB;IACrB,eAAe;IACf,iBAAiB;IACjB,kBAAkB;AACtB;;AAEA;;;IAGI,WAAW;IACX,eAAe;IACf,iBAAiB;IACjB,uBAAuB;IACvB,SAAS;IACT,YAAY;IACZ,kBAAkB;IAClB,aAAa;AACjB;;AAEA;CACC,iBAAiB;AAClB;;AAEA;IACI,eAAe;IACf,mBAAmB;IACnB,sBAAsB;CACzB,SAAS;AACV;;AAEA;;IAEI,4BAA4B;AAChC;;AAEA;IACI,cAAc;IACd,iBAAiB;AACrB;;AAEA;IACI,kBAAkB;AACtB;;AAEA;;IAEI,eAAe;IACf,uBAAuB;IACvB,YAAY;AAChB;;AAEA;IACI,aAAa;AACjB;AACA;AACA,cAAc;AACd;AACA;AACA,YAAY;AACZ;AACA;AACA,SAAS;AACT;AACA;AACA,aAAa;AACb,aAAa;AACb,mBAAmB;AACnB,YAAY;AACZ;AACA;AACA,OAAO;AACP;AACA;AACA,aAAa;AACb,mBAAmB;AACnB,mBAAmB;AACnB,iBAAiB;AACjB,eAAe;AACf;AACA;AACA,UAAU;AACV,aAAa;AACb,eAAe;AACf,sBAAsB;AACtB;AACA;AACA,eAAe;AACf,aAAa;AACb,cAAc;AACd,gBAAgB;AAChB;AACA;AACA,WAAW;AACX,YAAY;AACZ;AACA;AACA,iBAAiB;AACjB,mBAAmB;AACnB,eAAe;AACf",sourcesContent:['/* this CSS contains only the basic CSS needed to run the app and use it */\n\n.lgraphcanvas {\n    /*cursor: crosshair;*/\n    user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n\toutline: none;\n    font-family: Tahoma, sans-serif;\n}\n\n.lgraphcanvas * {\n    box-sizing: border-box;\n}\n\n.litegraph.litecontextmenu {\n    font-family: Tahoma, sans-serif;\n    position: fixed;\n    top: 100px;\n    left: 100px;\n    min-width: 100px;\n    color: #aaf;\n    padding: 0;\n    box-shadow: 0 0 10px black !important;\n    background-color: #2e2e2e !important;\n\tz-index: 10;\n}\n\n.litegraph.litecontextmenu.dark {\n    background-color: #000 !important;\n}\n\n.litegraph.litecontextmenu .litemenu-title img {\n    margin-top: 2px;\n    margin-left: 2px;\n    margin-right: 4px;\n}\n\n.litegraph.litecontextmenu .litemenu-entry {\n    margin: 2px;\n    padding: 2px;\n}\n\n.litegraph.litecontextmenu .litemenu-entry.submenu {\n    background-color: #2e2e2e !important;\n}\n\n.litegraph.litecontextmenu.dark .litemenu-entry.submenu {\n    background-color: #000 !important;\n}\n\n.litegraph .litemenubar ul {\n    font-family: Tahoma, sans-serif;\n    margin: 0;\n    padding: 0;\n}\n\n.litegraph .litemenubar li {\n    font-size: 14px;\n    color: #999;\n    display: inline-block;\n    min-width: 50px;\n    padding-left: 10px;\n    padding-right: 10px;\n    user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    cursor: pointer;\n}\n\n.litegraph .litemenubar li:hover {\n    background-color: #777;\n    color: #eee;\n}\n\n.litegraph .litegraph .litemenubar-panel {\n    position: absolute;\n    top: 5px;\n    left: 5px;\n    min-width: 100px;\n    background-color: #444;\n    box-shadow: 0 0 3px black;\n    padding: 4px;\n    border-bottom: 2px solid #aaf;\n    z-index: 10;\n}\n\n.litegraph .litemenu-entry,\n.litemenu-title {\n    font-size: 12px;\n    color: #aaa;\n    padding: 0 0 0 4px;\n    margin: 2px;\n    padding-left: 2px;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    user-select: none;\n    cursor: pointer;\n}\n\n.litegraph .litemenu-entry .icon {\n    display: inline-block;\n    width: 12px;\n    height: 12px;\n    margin: 2px;\n    vertical-align: top;\n}\n\n.litegraph .litemenu-entry.checked .icon {\n    background-color: #aaf;\n}\n\n.litegraph .litemenu-entry .more {\n    float: right;\n    padding-right: 5px;\n}\n\n.litegraph .litemenu-entry.disabled {\n    opacity: 0.5;\n    cursor: default;\n}\n\n.litegraph .litemenu-entry.separator {\n    display: block;\n    border-top: 1px solid #333;\n    border-bottom: 1px solid #666;\n    width: 100%;\n    height: 0px;\n    margin: 3px 0 2px 0;\n    background-color: transparent;\n    padding: 0 !important;\n    cursor: default !important;\n}\n\n.litegraph .litemenu-entry.has_submenu {\n    border-right: 2px solid cyan;\n}\n\n.litegraph .litemenu-title {\n    color: #dde;\n    background-color: #111;\n    margin: 0;\n    padding: 2px;\n    cursor: default;\n}\n\n.litegraph .litemenu-entry:hover:not(.disabled):not(.separator) {\n    background-color: #444 !important;\n    color: #eee;\n    transition: all 0.2s;\n}\n\n.litegraph .litemenu-entry .property_name {\n    display: inline-block;\n    text-align: left;\n    min-width: 80px;\n    min-height: 1.2em;\n}\n\n.litegraph .litemenu-entry .property_value {\n    display: inline-block;\n    background-color: rgba(0, 0, 0, 0.5);\n    text-align: right;\n    min-width: 80px;\n    min-height: 1.2em;\n    vertical-align: middle;\n    padding-right: 10px;\n}\n\n.litegraph.litesearchbox {\n    font-family: Tahoma, sans-serif;\n    position: absolute;\n    background-color: rgba(0, 0, 0, 0.5);\n    padding-top: 4px;\n}\n\n.litegraph.litesearchbox input,\n.litegraph.litesearchbox select {\n    margin-top: 3px;\n    min-width: 60px;\n    min-height: 1.5em;\n    background-color: black;\n    border: 0;\n    color: white;\n    padding-left: 10px;\n    margin-right: 5px;\n}\n\n.litegraph.litesearchbox .name {\n    display: inline-block;\n    min-width: 60px;\n    min-height: 1.5em;\n    padding-left: 10px;\n}\n\n.litegraph.litesearchbox .helper {\n    overflow: auto;\n    max-height: 200px;\n    margin-top: 2px;\n}\n\n.litegraph.lite-search-item {\n    font-family: Tahoma, sans-serif;\n    background-color: rgba(0, 0, 0, 0.5);\n    color: white;\n    padding-top: 2px;\n}\n\n.litegraph.lite-search-item.not_in_filter{\n    /*background-color: rgba(50, 50, 50, 0.5);*/\n    /*color: #999;*/\n    color: #B99;\n    font-style: italic;\n}\n\n.litegraph.lite-search-item.generic_type{\n    /*background-color: rgba(50, 50, 50, 0.5);*/\n    /*color: #DD9;*/\n    color: #999;\n    font-style: italic;\n}\n\n.litegraph.lite-search-item:hover,\n.litegraph.lite-search-item.selected {\n    cursor: pointer;\n    background-color: white;\n    color: black;\n}\n\n/* DIALOGs ******/\n\n.litegraph .dialog {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    margin-top: -150px;\n    margin-left: -200px;\n\n    background-color: #2A2A2A;\n\n    min-width: 400px;\n    min-height: 200px;\n\tbox-shadow: 0 0 4px #111;\n    border-radius: 6px;\n}\n\n.litegraph .dialog.settings {\n\tleft: 10px;\n\ttop: 10px;\n\theight: calc( 100% - 20px );\n\tmargin: auto;\n    max-width: 50%;\n}\n\n.litegraph .dialog.centered {\n    top: 50px;\n    left: 50%;\n    position: absolute;\n    transform: translateX(-50%);\n    min-width: 600px;\n    min-height: 300px;\n    height: calc( 100% - 100px );\n\tmargin: auto;\n}\n\n.litegraph .dialog .close {\n    float: right;\n\tmargin: 4px;\n\tmargin-right: 10px;\n\tcursor: pointer;\n\tfont-size: 1.4em;\n}\n\n.litegraph .dialog .close:hover {\n\tcolor: white;\n}\n\n.litegraph .dialog .dialog-header {\n\tcolor: #AAA;\n\tborder-bottom: 1px solid #161616;\n}\n\n.litegraph .dialog .dialog-header { height: 40px; }\n.litegraph .dialog .dialog-footer { height: 50px; padding: 10px; border-top: 1px solid #1a1a1a;}\n\n.litegraph .dialog .dialog-header .dialog-title {\n    font: 20px "Arial";\n    margin: 4px;\n    padding: 4px 10px;\n    display: inline-block;\n}\n\n.litegraph .dialog .dialog-content, .litegraph .dialog .dialog-alt-content {\n    height: calc(100% - 90px);\n    width: 100%;\n\tmin-height: 100px;\n    display: inline-block;\n\tcolor: #AAA;\n    /*background-color: black;*/\n    overflow: auto;\n}\n\n.litegraph .dialog .dialog-content h3 {\n\tmargin: 10px;\n}\n\n.litegraph .dialog .dialog-content .connections {\n\tflex-direction: row;\n}\n\n.litegraph .dialog .dialog-content .connections .connections_side {\n\twidth: calc(50% - 5px);\n\tmin-height: 100px;\n\tbackground-color: black;\n\tdisplay: flex;\n}\n\n.litegraph .dialog .node_type {\n\tfont-size: 1.2em;\n\tdisplay: block;\n\tmargin: 10px;\n}\n\n.litegraph .dialog .node_desc {\n\topacity: 0.5;\n\tdisplay: block;\n\tmargin: 10px;\n}\n\n.litegraph .dialog .separator {\n\tdisplay: block;\n\twidth: calc( 100% - 4px );\n\theight: 1px;\n\tborder-top: 1px solid #000;\n\tborder-bottom: 1px solid #333;\n\tmargin: 10px 2px;\n\tpadding: 0;\n}\n\n.litegraph .dialog .property {\n\tmargin-bottom: 2px;\n\tpadding: 4px;\n}\n\n.litegraph .dialog .property:hover {\n\tbackground: #545454;\n}\n\n.litegraph .dialog .property_name {\n\tcolor: #737373;\n    display: inline-block;\n    text-align: left;\n    vertical-align: top;\n    width: 160px;\n\tpadding-left: 4px;\n\toverflow: hidden;\n    margin-right: 6px;\n}\n\n.litegraph .dialog .property:hover .property_name {\n    color: white;\n}\n\n.litegraph .dialog .property_value {\n    display: inline-block;\n    text-align: right;\n\tcolor: #AAA;\n\tbackground-color: #1A1A1A;\n    /*width: calc( 100% - 122px );*/\n    max-width: calc( 100% - 162px );\n    min-width: 200px;\n\tmax-height: 300px;\n    min-height: 20px;\n    padding: 4px;\n\tpadding-right: 12px;\n\toverflow: hidden;\n\tcursor: pointer;\n\tborder-radius: 3px;\n}\n\n.litegraph .dialog .property_value:hover {\n\tcolor: white;\n}\n\n.litegraph .dialog .property.boolean .property_value {\n\tpadding-right: 30px;\n    color: #A88;\n    /*width: auto;\n    float: right;*/\n}\n\n.litegraph .dialog .property.boolean.bool-on .property_name{\n    color: #8A8;\n}\n.litegraph .dialog .property.boolean.bool-on .property_value{\n    color: #8A8;\n}\n\n.litegraph .dialog .btn {\n\tborder: 0;\n\tborder-radius: 4px;\n    padding: 4px 20px;\n    margin-left: 0px;\n    background-color: #060606;\n    color: #8e8e8e;\n}\n\n.litegraph .dialog .btn:hover {\n    background-color: #111;\n    color: #FFF;\n}\n\n.litegraph .dialog .btn.delete:hover {\n    background-color: #F33;\n    color: black;\n}\n\n.litegraph .subgraph_property {\n\tpadding: 4px;\n}\n\n.litegraph .subgraph_property:hover {\n\tbackground-color: #333;\n}\n\n.litegraph .subgraph_property.extra {\n    margin-top: 8px;\n}\n\n.litegraph .subgraph_property span.name {\n\tfont-size: 1.3em;\n\tpadding-left: 4px;\n}\n\n.litegraph .subgraph_property span.type {\n\topacity: 0.5;\n\tmargin-right: 20px;\n\tpadding-left: 4px;\n}\n\n.litegraph .subgraph_property span.label {\n\tdisplay: inline-block;\n\twidth: 60px;\n\tpadding:  0px 10px;\n}\n\n.litegraph .subgraph_property input {\n\twidth: 140px;\n\tcolor: #999;\n\tbackground-color: #1A1A1A;\n\tborder-radius: 4px;\n\tborder: 0;\n\tmargin-right: 10px;\n\tpadding: 4px;\n\tpadding-left: 10px;\n}\n\n.litegraph .subgraph_property button {\n\tbackground-color: #1c1c1c;\n\tcolor: #aaa;\n\tborder: 0;\n\tborder-radius: 2px;\n\tpadding: 4px 10px;\n\tcursor: pointer;\n}\n\n.litegraph .subgraph_property.extra {\n\tcolor: #ccc;\n}\n\n.litegraph .subgraph_property.extra input {\n\tbackground-color: #111;\n}\n\n.litegraph .bullet_icon {\n\tmargin-left: 10px;\n\tborder-radius: 10px;\n\twidth: 12px;\n\theight: 12px;\n\tbackground-color: #666;\n\tdisplay: inline-block;\n\tmargin-top: 2px;\n\tmargin-right: 4px;\n    transition: background-color 0.1s ease 0s;\n    -moz-transition: background-color 0.1s ease 0s;\n}\n\n.litegraph .bullet_icon:hover {\n\tbackground-color: #698;\n\tcursor: pointer;\n} \n\n/* OLD */\n\n.graphcontextmenu {\n    padding: 4px;\n    min-width: 100px;\n}\n\n.graphcontextmenu-title {\n    color: #dde;\n    background-color: #222;\n    margin: 0;\n    padding: 2px;\n    cursor: default;\n}\n\n.graphmenu-entry {\n    box-sizing: border-box;\n    margin: 2px;\n    padding-left: 20px;\n    user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    transition: all linear 0.3s;\n}\n\n.graphmenu-entry.event,\n.litemenu-entry.event {\n    border-left: 8px solid orange;\n    padding-left: 12px;\n}\n\n.graphmenu-entry.disabled {\n    opacity: 0.3;\n}\n\n.graphmenu-entry.submenu {\n    border-right: 2px solid #eee;\n}\n\n.graphmenu-entry:hover {\n    background-color: #555;\n}\n\n.graphmenu-entry.separator {\n    background-color: #111;\n    border-bottom: 1px solid #666;\n    height: 1px;\n    width: calc(100% - 20px);\n    -moz-width: calc(100% - 20px);\n    -webkit-width: calc(100% - 20px);\n}\n\n.graphmenu-entry .property_name {\n    display: inline-block;\n    text-align: left;\n    min-width: 80px;\n    min-height: 1.2em;\n}\n\n.graphmenu-entry .property_value,\n.litemenu-entry .property_value {\n    display: inline-block;\n    background-color: rgba(0, 0, 0, 0.5);\n    text-align: right;\n    min-width: 80px;\n    min-height: 1.2em;\n    vertical-align: middle;\n    padding-right: 10px;\n}\n\n.graphdialog {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    min-height: 2em;\n    background-color: #333;\n    font-size: 1.2em;\n    box-shadow: 0 0 10px black !important;\n\tz-index: 10;\n}\n\n.graphdialog.rounded {\n    border-radius: 12px;\n    padding-right: 2px;\n}\n\n.graphdialog .name {\n    display: inline-block;\n    min-width: 60px;\n    min-height: 1.5em;\n    padding-left: 10px;\n}\n\n.graphdialog input,\n.graphdialog textarea,\n.graphdialog select {\n    margin: 3px;\n    min-width: 60px;\n    min-height: 1.5em;\n    background-color: black;\n    border: 0;\n    color: white;\n    padding-left: 10px;\n    outline: none;\n}\n\n.graphdialog textarea {\n\tmin-height: 150px;\n}\n\n.graphdialog button {\n    margin-top: 3px;\n    vertical-align: top;\n    background-color: #999;\n\tborder: 0;\n}\n\n.graphdialog button.rounded,\n.graphdialog input.rounded {\n    border-radius: 0 12px 12px 0;\n}\n\n.graphdialog .helper {\n    overflow: auto;\n    max-height: 200px;\n}\n\n.graphdialog .help-item {\n    padding-left: 10px;\n}\n\n.graphdialog .help-item:hover,\n.graphdialog .help-item.selected {\n    cursor: pointer;\n    background-color: white;\n    color: black;\n}\n\n.litegraph .dialog {\n    min-height: 0;\n}\n.litegraph .dialog .dialog-content {\ndisplay: block;\n}\n.litegraph .dialog .dialog-content .subgraph_property {\npadding: 5px;\n}\n.litegraph .dialog .dialog-footer {\nmargin: 0;\n}\n.litegraph .dialog .dialog-footer .subgraph_property {\nmargin-top: 0;\ndisplay: flex;\nalign-items: center;\npadding: 5px;\n}\n.litegraph .dialog .dialog-footer .subgraph_property .name {\nflex: 1;\n}\n.litegraph .graphdialog {\ndisplay: flex;\nalign-items: center;\nborder-radius: 20px;\npadding: 4px 10px;\nposition: fixed;\n}\n.litegraph .graphdialog .name {\npadding: 0;\nmin-height: 0;\nfont-size: 16px;\nvertical-align: middle;\n}\n.litegraph .graphdialog .value {\nfont-size: 16px;\nmin-height: 0;\nmargin: 0 10px;\npadding: 2px 5px;\n}\n.litegraph .graphdialog input[type="checkbox"] {\nwidth: 16px;\nheight: 16px;\n}\n.litegraph .graphdialog button {\npadding: 4px 18px;\nborder-radius: 20px;\ncursor: pointer;\n}\n  \n'],sourceRoot:""}]);const a=s},314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,r,o){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(i)for(var a=0;a<this.length;a++){var u=this[a][0];null!=u&&(s[u]=!0)}for(var l=0;l<t.length;l++){var p=[].concat(t[l]);i&&s[p[0]]||(void 0!==o&&(void 0===p[5]||(p[1]="@layer".concat(p[5].length>0?" ".concat(p[5]):""," {").concat(p[1],"}")),p[5]=o),n&&(p[2]?(p[1]="@media ".concat(p[2]," {").concat(p[1],"}"),p[2]=n):p[2]=n),r&&(p[4]?(p[1]="@supports (".concat(p[4],") {").concat(p[1],"}"),p[4]=r):p[4]="".concat(r)),e.push(p))}},e}},354:t=>{"use strict";t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),o="/*# ".concat(r," */");return[e].concat([o]).join("\n")}return[e].join("\n")}},463:function(__unused_webpack_module,exports){(function(global){var LiteGraph=global.LiteGraph={VERSION:.4,CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:30,NODE_TITLE_TEXT_Y:20,NODE_SLOT_HEIGHT:20,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:140,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#999",NODE_SELECTED_TITLE_COLOR:"#FFF",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#AAA",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#333",NODE_DEFAULT_BGCOLOR:"#353535",NODE_DEFAULT_BOXCOLOR:"#666",NODE_DEFAULT_SHAPE:"box",NODE_BOX_OUTLINE_COLOR:"#FFF",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#222",WIDGET_OUTLINE_COLOR:"#666",WIDGET_TEXT_COLOR:"#DDD",WIDGET_SECONDARY_TEXT_COLOR:"#999",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1e3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,GRID_SHAPE:6,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,NODE_MODES:["Always","On Event","Never","On Trigger"],NODE_MODES_COLORS:["#666","#422","#333","#224","#626"],ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,LINK_RENDER_MODES:["Straight","Linear","Spline"],STRAIGHT_LINK:0,LINEAR_LINK:1,SPLINE_LINK:2,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,VERTICAL_LAYOUT:"vertical",proxy:null,node_images_path:"",debug:!1,catch_exceptions:!0,throw_errors:!0,allow_scripts:!1,use_deferred_actions:!0,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},Globals:{},searchbox_extras:{},auto_sort_node_types:!1,node_box_coloured_when_on:!1,node_box_coloured_by_mode:!1,dialog_close_on_mouse_leave:!0,dialog_close_on_mouse_leave_delay:500,shift_click_do_break_link_from:!1,click_do_break_link_to:!1,search_hide_on_mouse_leave:!0,search_filter_enabled:!1,search_show_all_on_open:!0,auto_load_slot_types:!1,registered_slot_in_types:{},registered_slot_out_types:{},slot_types_in:[],slot_types_out:[],slot_types_default_in:[],slot_types_default_out:[],alt_drag_do_clone_nodes:!1,do_add_triggers_slots:!1,allow_multi_output_for_events:!0,middle_click_slot_add_default_node:!1,release_link_on_empty_shows_menu:!1,pointerevents_method:"mouse",ctrl_shift_v_paste_connect_unselected_outputs:!1,use_uuids:!1,registerNodeType:function(t,e){if(!e.prototype)throw"Cannot register a simple object, it must be a class with a prototype";e.type=t,LiteGraph.debug&&console.log("Node registered: "+t);const n=e.name,i=t.lastIndexOf("/");for(var r in e.category=t.substring(0,i),e.title||(e.title=n),LGraphNode.prototype)e.prototype[r]||(e.prototype[r]=LGraphNode.prototype[r]);const o=this.registered_node_types[t];if(o&&console.log("replacing node type: "+t),!Object.prototype.hasOwnProperty.call(e.prototype,"shape")&&(Object.defineProperty(e.prototype,"shape",{set:function(t){switch(t){case"default":delete this._shape;break;case"box":this._shape=LiteGraph.BOX_SHAPE;break;case"round":this._shape=LiteGraph.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph.CARD_SHAPE;break;default:this._shape=t}},get:function(){return this._shape},enumerable:!0,configurable:!0}),e.supported_extensions))for(let t in e.supported_extensions){const n=e.supported_extensions[t];n&&n.constructor===String&&(this.node_types_by_file_extension[n.toLowerCase()]=e)}this.registered_node_types[t]=e,e.constructor.name&&(this.Nodes[n]=e),LiteGraph.onNodeTypeRegistered&&LiteGraph.onNodeTypeRegistered(t,e),o&&LiteGraph.onNodeTypeReplaced&&LiteGraph.onNodeTypeReplaced(t,e,o),e.prototype.onPropertyChange&&console.warn("LiteGraph node class "+t+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),this.auto_load_slot_types&&new e(e.title||"tmpnode")},unregisterNodeType:function(t){const e=t.constructor===String?this.registered_node_types[t]:t;if(!e)throw"node type not found: "+t;delete this.registered_node_types[e.type],e.constructor.name&&delete this.Nodes[e.constructor.name]},registerNodeAndSlotType:function(t,e,n){n=n||!1;const i=(t.constructor===String&&"anonymous"!==this.registered_node_types[t]?this.registered_node_types[t]:t).constructor.type;let r=[];r="string"==typeof e?e.split(","):e==this.EVENT||e==this.ACTION?["_event_"]:["*"];for(let t=0;t<r.length;++t){let e=r[t];""===e&&(e="*");const o=n?"registered_slot_out_types":"registered_slot_in_types";void 0===this[o][e]&&(this[o][e]={nodes:[]}),this[o][e].nodes.includes(i)||this[o][e].nodes.push(i),n?this.slot_types_out.includes(e.toLowerCase())||(this.slot_types_out.push(e.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(e.toLowerCase())||(this.slot_types_in.push(e.toLowerCase()),this.slot_types_in.sort())}},buildNodeClassFromObject:function(t,e){var n="";if(e.inputs)for(var i=0;i<e.inputs.length;++i){var r=e.inputs[i][0];(o=e.inputs[i][1])&&o.constructor===String&&(o='"'+o+'"'),n+="this.addInput('"+r+"',"+o+");\n"}if(e.outputs)for(i=0;i<e.outputs.length;++i){var o;r=e.outputs[i][0],(o=e.outputs[i][1])&&o.constructor===String&&(o='"'+o+'"'),n+="this.addOutput('"+r+"',"+o+");\n"}if(e.properties)for(var i in e.properties){var s=e.properties[i];s&&s.constructor===String&&(s='"'+s+'"'),n+="this.addProperty('"+i+"',"+s+");\n"}n+="if(this.onCreate)this.onCreate()";var a=Function(n);for(var i in e)"inputs"!=i&&"outputs"!=i&&"properties"!=i&&(a.prototype[i]=e[i]);return a.title=e.title||t.split("/").pop(),a.desc=e.desc||"Generated from object",this.registerNodeType(t,a),a},wrapFunctionAsNode:function(t,e,n,i,r){var o=Array(e.length),s="";if(null!==n)for(var a=LiteGraph.getParameterNames(e),u=0;u<a.length;++u){var l=0;n&&(null!=n[u]&&n[u].constructor===String?l="'"+n[u]+"'":null!=n[u]&&(l=n[u])),s+="this.addInput('"+a[u]+"',"+l+");\n"}null!==i&&(s+="this.addOutput('out',"+(null!=i?i.constructor===String?"'"+i+"'":i:0)+");\n"),r&&(s+="this.properties = "+JSON.stringify(r)+";\n");var p=Function(s);return p.title=t.split("/").pop(),p.desc="Generated from "+e.name,p.prototype.onExecute=function(){for(var t=0;t<o.length;++t)o[t]=this.getInputData(t);var n=e.apply(this,o);this.setOutputData(0,n)},this.registerNodeType(t,p),p},clearRegisteredTypes:function(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}},addNodeMethod:function(t,e){for(var n in LGraphNode.prototype[t]=e,this.registered_node_types){var i=this.registered_node_types[n];i.prototype[t]&&(i.prototype["_"+t]=i.prototype[t]),i.prototype[t]=e}},createNode:function(t,e,n){var i=this.registered_node_types[t];if(!i)return LiteGraph.debug&&console.log('GraphNode type "'+t+'" not registered.'),null;i.prototype,e=e||i.title||t;var r=null;if(LiteGraph.catch_exceptions)try{r=new i(e)}catch(t){return console.error(t),null}else r=new i(e);if(r.type=t,!r.title&&e&&(r.title=e),r.properties||(r.properties={}),r.properties_info||(r.properties_info=[]),r.flags||(r.flags={}),r.size||(r.size=r.computeSize()),r.pos||(r.pos=LiteGraph.DEFAULT_POSITION.concat()),r.mode||(r.mode=LiteGraph.ALWAYS),n)for(var o in n)r[o]=n[o];return r.onNodeCreated&&r.onNodeCreated(),r},getNodeType:function(t){return this.registered_node_types[t]},getNodeTypesInCategory:function(t,e){var n=[];for(var i in this.registered_node_types){var r=this.registered_node_types[i];r.filter==e&&(""==t?null==r.category&&n.push(r):r.category==t&&n.push(r))}return this.auto_sort_node_types&&n.sort((function(t,e){return t.title.localeCompare(e.title)})),n},getNodeTypesCategories:function(t){var e={"":1};for(var n in this.registered_node_types){var i=this.registered_node_types[n];if(i.category&&!i.skip_list){if(i.filter!=t)continue;e[i.category]=1}}var r=[];for(var n in e)r.push(n);return this.auto_sort_node_types?r.sort():r},reloadNodes:function(t){for(var e=document.getElementsByTagName("script"),n=[],i=0;i<e.length;i++)n.push(e[i]);var r=document.getElementsByTagName("head")[0];for(t=document.location.href+t,i=0;i<n.length;i++){var o=n[i].src;if(o&&o.substr(0,t.length)==t)try{LiteGraph.debug&&console.log("Reloading: "+o);var s=document.createElement("script");s.type="text/javascript",s.src=o,r.appendChild(s),r.removeChild(n[i])}catch(t){if(LiteGraph.throw_errors)throw t;LiteGraph.debug&&console.log("Error while reloading "+o)}}LiteGraph.debug&&console.log("Nodes reloaded")},cloneObject:function(t,e){if(null==t)return null;var n=JSON.parse(JSON.stringify(t));if(!e)return n;for(var i in n)e[i]=n[i];return e},uuidv4:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^16*Math.random()>>t/4).toString(16)))},isValidConnection:function(t,e){if(""!=t&&"*"!==t||(t=0),""!=e&&"*"!==e||(e=0),!t||!e||t==e||t==LiteGraph.EVENT&&e==LiteGraph.ACTION)return!0;if(t=String(t),e=String(e),t=t.toLowerCase(),e=e.toLowerCase(),-1==t.indexOf(",")&&-1==e.indexOf(","))return t==e;for(var n=t.split(","),i=e.split(","),r=0;r<n.length;++r)for(var o=0;o<i.length;++o)if(this.isValidConnection(n[r],i[o]))return!0;return!1},registerSearchboxExtra:function(t,e,n){this.searchbox_extras[e.toLowerCase()]={type:t,desc:e,data:n}},fetchFile:function(t,e,n,i){if(!t)return null;if(e=e||"text",t.constructor===String)return"http"==t.substr(0,4)&&LiteGraph.proxy&&(t=LiteGraph.proxy+t.substr(t.indexOf(":")+3)),fetch(t).then((function(t){if(!t.ok)throw new Error("File not found");return"arraybuffer"==e?t.arrayBuffer():"text"==e||"string"==e?t.text():"json"==e?t.json():"blob"==e?t.blob():void 0})).then((function(t){n&&n(t)})).catch((function(e){console.error("error fetching file:",t),i&&i(e)}));if(t.constructor===File||t.constructor===Blob){var r=new FileReader;if(r.onload=function(t){var i=t.target.result;"json"==e&&(i=JSON.parse(i)),n&&n(i)},"arraybuffer"==e)return r.readAsArrayBuffer(t);if("text"==e||"json"==e)return r.readAsText(t);if("blob"==e)return r.readAsBinaryString(t)}return null}};function LGraph(t){LiteGraph.debug&&console.log("Graph created"),this.list_of_graphcanvas=null,this.clear(),t&&this.configure(t)}function LLink(t,e,n,i,r,o){this.id=t,this.type=e,this.origin_id=n,this.origin_slot=i,this.target_id=r,this.target_slot=o,this._data=null,this._pos=new Float32Array(2)}function LGraphNode(t){this._ctor(t)}function LGraphGroup(t){this._ctor(t)}function DragAndScale(t,e){this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),t&&(this.element=t,e||this.bindEvents(t))}function LGraphCanvas(t,e,n){this.options=n=n||{},this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,t&&t.constructor===String&&(t=document.querySelector(t)),this.ds=new DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=LiteGraph.NODE_TEXT_SIZE+"px Arial",this.inner_text_font="normal "+LiteGraph.NODE_SUBTEXT_SIZE+"px Arial",this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.render_only_selected=!0,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.allow_reconnect_links=!0,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!1,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=n.viewport||null,e&&e.attachCanvas(this),this.setCanvas(t,n.skip_events),this.clear(),n.skip_render||this.startRendering(),this.autoresize=n.autoresize}"undefined"!=typeof performance?LiteGraph.getTime=performance.now.bind(performance):"undefined"!=typeof Date&&Date.now?LiteGraph.getTime=Date.now.bind(Date):"undefined"!=typeof process?LiteGraph.getTime=function(){var t=process.hrtime();return.001*t[0]+1e-6*t[1]}:LiteGraph.getTime=function(){return(new Date).getTime()},global.LGraph=LiteGraph.LGraph=LGraph,LGraph.supported_types=["number","string","boolean"],LGraph.prototype.getSupportedTypes=function(){return this.supported_types||LGraph.supported_types},LGraph.STATUS_STOPPED=1,LGraph.STATUS_RUNNING=2,LGraph.prototype.clear=function(){if(this.stop(),this.status=LGraph.STATUS_STOPPED,this.last_node_id=0,this.last_link_id=0,this._version=-1,this._nodes)for(var t=0;t<this._nodes.length;++t){var e=this._nodes[t];e.onRemoved&&e.onRemoved()}this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.vars={},this.extra={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[],this.inputs={},this.outputs={},this.change(),this.sendActionToCanvas("clear")},LGraph.prototype.attachCanvas=function(t){if(t.constructor!=LGraphCanvas)throw"attachCanvas expects a LGraphCanvas instance";t.graph&&t.graph!=this&&t.graph.detachCanvas(t),t.graph=this,this.list_of_graphcanvas||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(t)},LGraph.prototype.detachCanvas=function(t){if(this.list_of_graphcanvas){var e=this.list_of_graphcanvas.indexOf(t);-1!=e&&(t.graph=null,this.list_of_graphcanvas.splice(e,1))}},LGraph.prototype.start=function(t){if(this.status!=LGraph.STATUS_RUNNING){this.status=LGraph.STATUS_RUNNING,this.onPlayEvent&&this.onPlayEvent(),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph.getTime(),this.last_update_time=this.starttime;var e=this;0==(t=t||0)&&"undefined"!=typeof window&&window.requestAnimationFrame?(this.execution_timer_id=-1,function t(){-1==e.execution_timer_id&&(window.requestAnimationFrame(t),e.onBeforeStep&&e.onBeforeStep(),e.runStep(1,!e.catch_errors),e.onAfterStep&&e.onAfterStep())}()):this.execution_timer_id=setInterval((function(){e.onBeforeStep&&e.onBeforeStep(),e.runStep(1,!e.catch_errors),e.onAfterStep&&e.onAfterStep()}),t)}},LGraph.prototype.stop=function(){this.status!=LGraph.STATUS_STOPPED&&(this.status=LGraph.STATUS_STOPPED,this.onStopEvent&&this.onStopEvent(),null!=this.execution_timer_id&&(-1!=this.execution_timer_id&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},LGraph.prototype.runStep=function(t,e,n){t=t||1;var i=LiteGraph.getTime();this.globaltime=.001*(i-this.starttime);var r=this._nodes_executable?this._nodes_executable:this._nodes;if(r){if(n=n||r.length,e){for(var o=0;o<t;o++){for(var s=0;s<n;++s){var a=r[s];LiteGraph.use_deferred_actions&&a._waiting_actions&&a._waiting_actions.length&&a.executePendingActions(),a.mode==LiteGraph.ALWAYS&&a.onExecute&&a.doExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute()}else try{for(o=0;o<t;o++){for(s=0;s<n;++s)a=r[s],LiteGraph.use_deferred_actions&&a._waiting_actions&&a._waiting_actions.length&&a.executePendingActions(),a.mode==LiteGraph.ALWAYS&&a.onExecute&&a.onExecute();this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute(),this.errors_in_execution=!1}catch(t){if(this.errors_in_execution=!0,LiteGraph.throw_errors)throw t;LiteGraph.debug&&console.log("Error during execution: "+t),this.stop()}var u=LiteGraph.getTime(),l=u-i;0==l&&(l=1),this.execution_time=.001*l,this.globaltime+=.001*l,this.iteration+=1,this.elapsed_time=.001*(u-this.last_update_time),this.last_update_time=u,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[]}},LGraph.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var t=0;t<this._nodes_in_order.length;++t)this._nodes_in_order[t].onExecute&&this._nodes_executable.push(this._nodes_in_order[t])},LGraph.prototype.computeExecutionOrder=function(t,e){for(var n=[],i=[],r={},o={},s={},a=0,u=this._nodes.length;a<u;++a){var l=this._nodes[a];if(!t||l.onExecute){r[l.id]=l;var p=0;if(l.inputs)for(var h=0,c=l.inputs.length;h<c;h++)l.inputs[h]&&null!=l.inputs[h].link&&(p+=1);0==p?(i.push(l),e&&(l._level=1)):(e&&(l._level=0),s[l.id]=p)}}for(;0!=i.length;)if(l=i.shift(),n.push(l),delete r[l.id],l.outputs)for(a=0;a<l.outputs.length;a++){var d=l.outputs[a];if(null!=d&&null!=d.links&&0!=d.links.length)for(h=0;h<d.links.length;h++){var f=d.links[h],g=this.links[f];if(g&&!o[g.id]){var _=this.getNodeById(g.target_id);null!=_?(e&&(!_._level||_._level<=l._level)&&(_._level=l._level+1),o[g.id]=!0,s[_.id]-=1,0==s[_.id]&&i.push(_)):o[g.id]=!0}}}for(var a in r)n.push(r[a]);for(n.length!=this._nodes.length&&LiteGraph.debug&&console.warn("something went wrong, nodes missing"),u=n.length,a=0;a<u;++a)n[a].order=a;for(n=n.sort((function(t,e){var n=t.constructor.priority||t.priority||0,i=e.constructor.priority||e.priority||0;return n==i?t.order-e.order:n-i})),a=0;a<u;++a)n[a].order=a;return n},LGraph.prototype.getAncestors=function(t){for(var e=[],n=[t],i={};n.length;){var r=n.shift();if(r.inputs){i[r.id]||r==t||(i[r.id]=!0,e.push(r));for(var o=0;o<r.inputs.length;++o){var s=r.getInputNode(o);s&&-1==e.indexOf(s)&&n.push(s)}}}return e.sort((function(t,e){return t.order-e.order})),e},LGraph.prototype.arrange=function(t,e){t=t||100;const n=this.computeExecutionOrder(!1,!0),i=[];for(let t=0;t<n.length;++t){const e=n[t],r=e._level||1;i[r]||(i[r]=[]),i[r].push(e)}let r=t;for(let n=0;n<i.length;++n){const o=i[n];if(!o)continue;let s=100,a=t+LiteGraph.NODE_TITLE_HEIGHT;for(let n=0;n<o.length;++n){const i=o[n];i.pos[0]=e==LiteGraph.VERTICAL_LAYOUT?a:r,i.pos[1]=e==LiteGraph.VERTICAL_LAYOUT?r:a;const u=e==LiteGraph.VERTICAL_LAYOUT?1:0;i.size[u]>s&&(s=i.size[u]);const l=e==LiteGraph.VERTICAL_LAYOUT?0:1;a+=i.size[l]+t+LiteGraph.NODE_TITLE_HEIGHT}r+=s+t}this.setDirtyCanvas(!0,!0)},LGraph.prototype.getTime=function(){return this.globaltime},LGraph.prototype.getFixedTime=function(){return this.fixedtime},LGraph.prototype.getElapsedTime=function(){return this.elapsed_time},LGraph.prototype.sendEventToAllNodes=function(t,e,n){n=n||LiteGraph.ALWAYS;var i=this._nodes_in_order?this._nodes_in_order:this._nodes;if(i)for(var r=0,o=i.length;r<o;++r){var s=i[r];s.constructor!==LiteGraph.Subgraph||"onExecute"==t?s[t]&&s.mode==n&&(void 0===e?s[t]():e&&e.constructor===Array?s[t].apply(s,e):s[t](e)):s.mode==n&&s.sendEventToAllNodes(t,e,n)}},LGraph.prototype.sendActionToCanvas=function(t,e){if(this.list_of_graphcanvas)for(var n=0;n<this.list_of_graphcanvas.length;++n){var i=this.list_of_graphcanvas[n];i[t]&&i[t].apply(i,e)}},LGraph.prototype.add=function(t,e){if(t){if(t.constructor===LGraphGroup)return this._groups.push(t),this.setDirtyCanvas(!0),this.change(),t.graph=this,void this._version++;if(-1!=t.id&&null!=this._nodes_by_id[t.id]&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),LiteGraph.use_uuids?t.id=LiteGraph.uuidv4():t.id=++this.last_node_id),this._nodes.length>=LiteGraph.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return LiteGraph.use_uuids?null!=t.id&&-1!=t.id||(t.id=LiteGraph.uuidv4()):null==t.id||-1==t.id?t.id=++this.last_node_id:this.last_node_id<t.id&&(this.last_node_id=t.id),t.graph=this,this._version++,this._nodes.push(t),this._nodes_by_id[t.id]=t,t.onAdded&&t.onAdded(this),this.config.align_to_grid&&t.alignToGrid(),e||this.updateExecutionOrder(),this.onNodeAdded&&this.onNodeAdded(t),this.setDirtyCanvas(!0),this.change(),t}},LGraph.prototype.remove=function(t){if(t.constructor===LiteGraph.LGraphGroup){var e=this._groups.indexOf(t);return-1!=e&&this._groups.splice(e,1),t.graph=null,this._version++,this.setDirtyCanvas(!0,!0),void this.change()}if(null!=this._nodes_by_id[t.id]&&!t.ignore_remove){if(this.beforeChange(),t.inputs)for(var n=0;n<t.inputs.length;n++)null!=(i=t.inputs[n]).link&&t.disconnectInput(n);if(t.outputs)for(n=0;n<t.outputs.length;n++){var i;null!=(i=t.outputs[n]).links&&i.links.length&&t.disconnectOutput(n)}if(t.onRemoved&&t.onRemoved(),t.graph=null,this._version++,this.list_of_graphcanvas)for(n=0;n<this.list_of_graphcanvas.length;++n){var r=this.list_of_graphcanvas[n];r.selected_nodes[t.id]&&delete r.selected_nodes[t.id],r.node_dragged==t&&(r.node_dragged=null)}var o=this._nodes.indexOf(t);-1!=o&&this._nodes.splice(o,1),delete this._nodes_by_id[t.id],this.onNodeRemoved&&this.onNodeRemoved(t),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.afterChange(),this.change(),this.updateExecutionOrder()}},LGraph.prototype.getNodeById=function(t){return null==t?null:this._nodes_by_id[t]},LGraph.prototype.findNodesByClass=function(t,e){(e=e||[]).length=0;for(var n=0,i=this._nodes.length;n<i;++n)this._nodes[n].constructor===t&&e.push(this._nodes[n]);return e},LGraph.prototype.findNodesByType=function(t,e){t=t.toLowerCase(),(e=e||[]).length=0;for(var n=0,i=this._nodes.length;n<i;++n)this._nodes[n].type.toLowerCase()==t&&e.push(this._nodes[n]);return e},LGraph.prototype.findNodeByTitle=function(t){for(var e=0,n=this._nodes.length;e<n;++e)if(this._nodes[e].title==t)return this._nodes[e];return null},LGraph.prototype.findNodesByTitle=function(t){for(var e=[],n=0,i=this._nodes.length;n<i;++n)this._nodes[n].title==t&&e.push(this._nodes[n]);return e},LGraph.prototype.getNodeOnPos=function(t,e,n,i){for(var r=(n=n||this._nodes).length-1;r>=0;r--){var o=n[r];if(o.isPointInside(t,e,i))return o}return null},LGraph.prototype.getGroupOnPos=function(t,e){for(var n=this._groups.length-1;n>=0;n--){var i=this._groups[n];if(i.isPointInside(t,e,2,!0))return i}return null},LGraph.prototype.checkNodeTypes=function(){for(var t=0;t<this._nodes.length;t++){var e=this._nodes[t],n=LiteGraph.registered_node_types[e.type];if(e.constructor!=n){console.log("node being replaced by newer version: "+e.type);var i=LiteGraph.createNode(e.type);this._nodes[t]=i,i.configure(e.serialize()),i.graph=this,this._nodes_by_id[i.id]=i,e.inputs&&(i.inputs=e.inputs.concat()),e.outputs&&(i.outputs=e.outputs.concat())}}this.updateExecutionOrder()},LGraph.prototype.onAction=function(t,e,n){this._input_nodes=this.findNodesByClass(LiteGraph.GraphInput,this._input_nodes);for(var i=0;i<this._input_nodes.length;++i){var r=this._input_nodes[i];if(r.properties.name==t){r.actionDo(t,e,n);break}}},LGraph.prototype.trigger=function(t,e){this.onTrigger&&this.onTrigger(t,e)},LGraph.prototype.addInput=function(t,e,n){this.inputs[t]||(this.beforeChange(),this.inputs[t]={name:t,type:e,value:n},this._version++,this.afterChange(),this.onInputAdded&&this.onInputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange())},LGraph.prototype.setInputData=function(t,e){var n=this.inputs[t];n&&(n.value=e)},LGraph.prototype.getInputData=function(t){var e=this.inputs[t];return e?e.value:null},LGraph.prototype.renameInput=function(t,e){if(e!=t){if(!this.inputs[t])return!1;if(this.inputs[e])return console.error("there is already one input with that name"),!1;this.inputs[e]=this.inputs[t],delete this.inputs[t],this._version++,this.onInputRenamed&&this.onInputRenamed(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()}},LGraph.prototype.changeInputType=function(t,e){if(!this.inputs[t])return!1;this.inputs[t].type&&String(this.inputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.inputs[t].type=e,this._version++,this.onInputTypeChanged&&this.onInputTypeChanged(t,e))},LGraph.prototype.removeInput=function(t){return!!this.inputs[t]&&(delete this.inputs[t],this._version++,this.onInputRemoved&&this.onInputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0)},LGraph.prototype.addOutput=function(t,e,n){this.outputs[t]={name:t,type:e,value:n},this._version++,this.onOutputAdded&&this.onOutputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()},LGraph.prototype.setOutputData=function(t,e){var n=this.outputs[t];n&&(n.value=e)},LGraph.prototype.getOutputData=function(t){var e=this.outputs[t];return e?e.value:null},LGraph.prototype.renameOutput=function(t,e){return!!this.outputs[t]&&(this.outputs[e]?(console.error("there is already one output with that name"),!1):(this.outputs[e]=this.outputs[t],delete this.outputs[t],this._version++,this.onOutputRenamed&&this.onOutputRenamed(t,e),void(this.onInputsOutputsChange&&this.onInputsOutputsChange())))},LGraph.prototype.changeOutputType=function(t,e){if(!this.outputs[t])return!1;this.outputs[t].type&&String(this.outputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.outputs[t].type=e,this._version++,this.onOutputTypeChanged&&this.onOutputTypeChanged(t,e))},LGraph.prototype.removeOutput=function(t){return!!this.outputs[t]&&(delete this.outputs[t],this._version++,this.onOutputRemoved&&this.onOutputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0)},LGraph.prototype.triggerInput=function(t,e){for(var n=this.findNodesByTitle(t),i=0;i<n.length;++i)n[i].onTrigger(e)},LGraph.prototype.setCallback=function(t,e){for(var n=this.findNodesByTitle(t),i=0;i<n.length;++i)n[i].setTrigger(e)},LGraph.prototype.beforeChange=function(t){this.onBeforeChange&&this.onBeforeChange(this,t),this.sendActionToCanvas("onBeforeChange",this)},LGraph.prototype.afterChange=function(t){this.onAfterChange&&this.onAfterChange(this,t),this.sendActionToCanvas("onAfterChange",this)},LGraph.prototype.connectionChange=function(t,e){this.updateExecutionOrder(),this.onConnectionChange&&this.onConnectionChange(t),this._version++,this.sendActionToCanvas("onConnectionChange")},LGraph.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var t=0;t<this.list_of_graphcanvas.length;++t)if(this.list_of_graphcanvas[t].live_mode)return!0;return!1},LGraph.prototype.clearTriggeredSlots=function(){for(var t in this.links){var e=this.links[t];e&&e._last_time&&(e._last_time=0)}},LGraph.prototype.change=function(){LiteGraph.debug&&console.log("Graph changed"),this.sendActionToCanvas("setDirty",[!0,!0]),this.on_change&&this.on_change(this)},LGraph.prototype.setDirtyCanvas=function(t,e){this.sendActionToCanvas("setDirty",[t,e])},LGraph.prototype.removeLink=function(t){var e=this.links[t];if(e){var n=this.getNodeById(e.target_id);n&&n.disconnectInput(e.target_slot)}},LGraph.prototype.serialize=function(){for(var t=[],e=0,n=this._nodes.length;e<n;++e)t.push(this._nodes[e].serialize());var i=[];for(var e in this.links){var r=this.links[e];if(!r.serialize){console.warn("weird LLink bug, link info is not a LLink but a regular object");var o=new LLink;for(var s in r)o[s]=r[s];this.links[e]=o,r=o}i.push(r.serialize())}var a=[];for(e=0;e<this._groups.length;++e)a.push(this._groups[e].serialize());var u={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:t,links:i,groups:a,config:this.config,extra:this.extra,version:LiteGraph.VERSION};return this.onSerialize&&this.onSerialize(u),u},LGraph.prototype.configure=function(t,e){if(t){e||this.clear();var n=t.nodes;if(t.links&&t.links.constructor===Array){for(var i=[],r=0;r<t.links.length;++r){var o=t.links[r];if(o){var s=new LLink;s.configure(o),i[s.id]=s}else console.warn("serialized graph link data contains errors, skipping.")}t.links=i}for(var r in t)"nodes"!=r&&"groups"!=r&&(this[r]=t[r]);var a=!1;if(this._nodes=[],n){r=0;for(var u=n.length;r<u;++r){var l=n[r];(p=LiteGraph.createNode(l.type,l.title))||(LiteGraph.debug&&console.log("Node not found or has errors: "+l.type),(p=new LGraphNode).last_serialization=l,p.has_errors=!0,a=!0),p.id=l.id,this.add(p,!0)}for(r=0,u=n.length;r<u;++r){var p;l=n[r],(p=this.getNodeById(l.id))&&p.configure(l)}}if(this._groups.length=0,t.groups)for(r=0;r<t.groups.length;++r){var h=new LiteGraph.LGraphGroup;h.configure(t.groups[r]),this.add(h)}return this.updateExecutionOrder(),this.extra=t.extra||{},this.onConfigure&&this.onConfigure(t),this._version++,this.setDirtyCanvas(!0,!0),a}},LGraph.prototype.load=function(t,e){var n=this;if(t.constructor===File||t.constructor===Blob){var i=new FileReader;return i.addEventListener("load",(function(t){var i=JSON.parse(t.target.result);n.configure(i),e&&e()})),void i.readAsText(t)}var r=new XMLHttpRequest;r.open("GET",t,!0),r.send(null),r.onload=function(t){if(200===r.status){var i=JSON.parse(r.response);n.configure(i),e&&e()}else console.error("Error loading graph:",r.status,r.response)},r.onerror=function(t){console.error("Error loading graph:",t)}},LGraph.prototype.onNodeTrace=function(t,e,n){},LLink.prototype.configure=function(t){t.constructor===Array?(this.id=t[0],this.origin_id=t[1],this.origin_slot=t[2],this.target_id=t[3],this.target_slot=t[4],this.type=t[5]):(this.id=t.id,this.type=t.type,this.origin_id=t.origin_id,this.origin_slot=t.origin_slot,this.target_id=t.target_id,this.target_slot=t.target_slot)},LLink.prototype.serialize=function(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]},LiteGraph.LLink=LLink,global.LGraphNode=LiteGraph.LGraphNode=LGraphNode,LGraphNode.prototype._ctor=function(t){this.title=t||"Unnamed",this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),Object.defineProperty(this,"pos",{set:function(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])},get:function(){return this._pos},enumerable:!0}),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}},LGraphNode.prototype.configure=function(t){for(var e in this.graph&&this.graph._version++,t)if("properties"!=e)null!=t[e]&&("object"==typeof t[e]?this[e]&&this[e].configure?this[e].configure(t[e]):this[e]=LiteGraph.cloneObject(t[e],this[e]):this[e]=t[e]);else for(var n in t.properties)this.properties[n]=t.properties[n],this.onPropertyChanged&&this.onPropertyChanged(n,t.properties[n]);if(t.title||(this.title=this.constructor.title),this.inputs)for(var i=0;i<this.inputs.length;++i){var r=this.inputs[i],o=this.graph?this.graph.links[r.link]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,i,!0,o,r),this.onInputAdded&&this.onInputAdded(r)}if(this.outputs)for(i=0;i<this.outputs.length;++i){var s=this.outputs[i];if(s.links){for(e=0;e<s.links.length;++e)o=this.graph?this.graph.links[s.links[e]]:null,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,i,!0,o,s);this.onOutputAdded&&this.onOutputAdded(s)}}if(this.widgets){for(i=0;i<this.widgets.length;++i){var a=this.widgets[i];a&&a.options&&a.options.property&&null!=this.properties[a.options.property]&&(a.value=JSON.parse(JSON.stringify(this.properties[a.options.property])))}if(t.widgets_values)for(i=0;i<t.widgets_values.length;++i)this.widgets[i]&&(this.widgets[i].value=t.widgets_values[i])}this.onConfigure&&this.onConfigure(t)},LGraphNode.prototype.serialize=function(){var t={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph.cloneObject(this.flags),order:this.order,mode:this.mode};if(this.constructor===LGraphNode&&this.last_serialization)return this.last_serialization;if(this.inputs&&(t.inputs=this.inputs),this.outputs){for(var e=0;e<this.outputs.length;e++)delete this.outputs[e]._data;t.outputs=this.outputs}if(this.title&&this.title!=this.constructor.title&&(t.title=this.title),this.properties&&(t.properties=LiteGraph.cloneObject(this.properties)),this.widgets&&this.serialize_widgets)for(t.widgets_values=[],e=0;e<this.widgets.length;++e)this.widgets[e]?t.widgets_values[e]=this.widgets[e].value:t.widgets_values[e]=null;return t.type||(t.type=this.constructor.type),this.color&&(t.color=this.color),this.bgcolor&&(t.bgcolor=this.bgcolor),this.boxcolor&&(t.boxcolor=this.boxcolor),this.shape&&(t.shape=this.shape),this.onSerialize&&this.onSerialize(t)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter"),t},LGraphNode.prototype.clone=function(){var t=LiteGraph.createNode(this.type);if(!t)return null;var e=LiteGraph.cloneObject(this.serialize());if(e.inputs)for(var n=0;n<e.inputs.length;++n)e.inputs[n].link=null;if(e.outputs)for(n=0;n<e.outputs.length;++n)e.outputs[n].links&&(e.outputs[n].links.length=0);return delete e.id,LiteGraph.use_uuids&&(e.id=LiteGraph.uuidv4()),t.configure(e),t},LGraphNode.prototype.toString=function(){return JSON.stringify(this.serialize())},LGraphNode.prototype.getTitle=function(){return this.title||this.constructor.title},LGraphNode.prototype.setProperty=function(t,e){if(this.properties||(this.properties={}),e!==this.properties[t]){var n=this.properties[t];if(this.properties[t]=e,this.onPropertyChanged&&!1===this.onPropertyChanged(t,e,n)&&(this.properties[t]=n),this.widgets)for(var i=0;i<this.widgets.length;++i){var r=this.widgets[i];if(r&&r.options.property==t){r.value=e;break}}}},LGraphNode.prototype.setOutputData=function(t,e){if(this.outputs&&!(-1==t||t>=this.outputs.length)){var n=this.outputs[t];if(n&&(n._data=e,this.outputs[t].links))for(var i=0;i<this.outputs[t].links.length;i++){var r=this.outputs[t].links[i],o=this.graph.links[r];o&&(o.data=e)}}},LGraphNode.prototype.setOutputDataType=function(t,e){if(this.outputs&&!(-1==t||t>=this.outputs.length)){var n=this.outputs[t];if(n&&(n.type=e,this.outputs[t].links))for(var i=0;i<this.outputs[t].links.length;i++){var r=this.outputs[t].links[i];this.graph.links[r].type=e}}},LGraphNode.prototype.getInputData=function(t,e){if(this.inputs&&!(t>=this.inputs.length||null==this.inputs[t].link)){var n=this.inputs[t].link,i=this.graph.links[n];if(!i)return null;if(!e)return i.data;var r=this.graph.getNodeById(i.origin_id);return r?(r.updateOutputData?r.updateOutputData(i.origin_slot):r.onExecute&&r.onExecute(),i.data):i.data}},LGraphNode.prototype.getInputDataType=function(t){if(!this.inputs)return null;if(t>=this.inputs.length||null==this.inputs[t].link)return null;var e=this.inputs[t].link,n=this.graph.links[e];if(!n)return null;var i=this.graph.getNodeById(n.origin_id);if(!i)return n.type;var r=i.outputs[n.origin_slot];return r?r.type:null},LGraphNode.prototype.getInputDataByName=function(t,e){var n=this.findInputSlot(t);return-1==n?null:this.getInputData(n,e)},LGraphNode.prototype.isInputConnected=function(t){return!!this.inputs&&t<this.inputs.length&&null!=this.inputs[t].link},LGraphNode.prototype.getInputInfo=function(t){return this.inputs&&t<this.inputs.length?this.inputs[t]:null},LGraphNode.prototype.getInputLink=function(t){if(!this.inputs)return null;if(t<this.inputs.length){var e=this.inputs[t];return this.graph.links[e.link]}return null},LGraphNode.prototype.getInputNode=function(t){if(!this.inputs)return null;if(t>=this.inputs.length)return null;var e=this.inputs[t];if(!e||null===e.link)return null;var n=this.graph.links[e.link];return n?this.graph.getNodeById(n.origin_id):null},LGraphNode.prototype.getInputOrProperty=function(t){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[t]:null;for(var e=0,n=this.inputs.length;e<n;++e){var i=this.inputs[e];if(t==i.name&&null!=i.link){var r=this.graph.links[i.link];if(r)return r.data}}return this.properties[t]},LGraphNode.prototype.getOutputData=function(t){return this.outputs?t>=this.outputs.length?null:this.outputs[t]._data:null},LGraphNode.prototype.getOutputInfo=function(t){return this.outputs&&t<this.outputs.length?this.outputs[t]:null},LGraphNode.prototype.isOutputConnected=function(t){return!!this.outputs&&t<this.outputs.length&&this.outputs[t].links&&this.outputs[t].links.length},LGraphNode.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var t=0;t<this.outputs.length;++t)if(this.outputs[t].links&&this.outputs[t].links.length)return!0;return!1},LGraphNode.prototype.getOutputNodes=function(t){if(!this.outputs||0==this.outputs.length)return null;if(t>=this.outputs.length)return null;var e=this.outputs[t];if(!e.links||0==e.links.length)return null;for(var n=[],i=0;i<e.links.length;i++){var r=e.links[i],o=this.graph.links[r];if(o){var s=this.graph.getNodeById(o.target_id);s&&n.push(s)}}return n},LGraphNode.prototype.addOnTriggerInput=function(){var t=this.findInputSlot("onTrigger");return-1==t?(this.addInput("onTrigger",LiteGraph.EVENT,{optional:!0,nameLocked:!0}),this.findInputSlot("onTrigger")):t},LGraphNode.prototype.addOnExecutedOutput=function(){var t=this.findOutputSlot("onExecuted");return-1==t?(this.addOutput("onExecuted",LiteGraph.ACTION,{optional:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")):t},LGraphNode.prototype.onAfterExecuteNode=function(t,e){var n=this.findOutputSlot("onExecuted");-1!=n&&this.triggerSlot(n,t,null,e)},LGraphNode.prototype.changeMode=function(t){switch(t){case LiteGraph.ON_EVENT:break;case LiteGraph.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph.NEVER:case LiteGraph.ALWAYS:case LiteGraph.ON_REQUEST:break;default:return!1}return this.mode=t,!0},LGraphNode.prototype.executePendingActions=function(){if(this._waiting_actions&&this._waiting_actions.length){for(var t=0;t<this._waiting_actions.length;++t){var e=this._waiting_actions[t];this.onAction(e[0],e[1],e[2],e[3],e[4])}this._waiting_actions.length=0}},LGraphNode.prototype.doExecute=function(t,e){e=e||{},this.onExecute&&(e.action_call||(e.action_call=this.id+"_exec_"+Math.floor(9999*Math.random())),this.graph.nodes_executing[this.id]=!0,this.onExecute(t,e),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,e&&e.action_call&&(this.action_call=e.action_call,this.graph.nodes_executedAction[this.id]=e.action_call)),this.execute_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(t,e)},LGraphNode.prototype.actionDo=function(t,e,n,i){n=n||{},this.onAction&&(n.action_call||(n.action_call=this.id+"_"+(t||"action")+"_"+Math.floor(9999*Math.random())),this.graph.nodes_actioning[this.id]=t||"actioning",this.onAction(t,e,n,i),this.graph.nodes_actioning[this.id]=!1,n&&n.action_call&&(this.action_call=n.action_call,this.graph.nodes_executedAction[this.id]=n.action_call)),this.action_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(e,n)},LGraphNode.prototype.trigger=function(t,e,n){if(this.outputs&&this.outputs.length){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var i=0;i<this.outputs.length;++i){var r=this.outputs[i];!r||r.type!==LiteGraph.EVENT||t&&r.name!=t||this.triggerSlot(i,e,null,n)}}},LGraphNode.prototype.triggerSlot=function(t,e,n,i){if(i=i||{},this.outputs)if(null!=t){t.constructor!==Number&&console.warn("slot must be a number, use node.trigger('name') if you want to use a string");var r=this.outputs[t];if(r){var o=r.links;if(o&&o.length){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var s=0;s<o.length;++s){var a=o[s];if(null==n||n==a){var u=this.graph.links[o[s]];if(u){u._last_time=LiteGraph.getTime();var l=this.graph.getNodeById(u.target_id);if(l){var p=l.inputs[u.target_slot];l.mode===LiteGraph.ON_TRIGGER?(i.action_call||(i.action_call=this.id+"_trigg_"+Math.floor(9999*Math.random())),l.onExecute&&l.doExecute(e,i)):l.onAction&&(i.action_call||(i.action_call=this.id+"_act_"+Math.floor(9999*Math.random())),p=l.inputs[u.target_slot],LiteGraph.use_deferred_actions&&l.onExecute?(l._waiting_actions||(l._waiting_actions=[]),l._waiting_actions.push([p.name,e,i,u.target_slot])):l.actionDo(p.name,e,i,u.target_slot))}}}}}}}else console.error("slot must be a number")},LGraphNode.prototype.clearTriggeredSlot=function(t,e){if(this.outputs){var n=this.outputs[t];if(n){var i=n.links;if(i&&i.length)for(var r=0;r<i.length;++r){var o=i[r];if(null==e||e==o){var s=this.graph.links[i[r]];s&&(s._last_time=0)}}}}},LGraphNode.prototype.setSize=function(t){this.size=t,this.onResize&&this.onResize(this.size)},LGraphNode.prototype.addProperty=function(t,e,n,i){var r={name:t,type:n,default_value:e};if(i)for(var o in i)r[o]=i[o];return this.properties_info||(this.properties_info=[]),this.properties_info.push(r),this.properties||(this.properties={}),this.properties[t]=e,r},LGraphNode.prototype.addOutput=function(t,e,n){var i={name:t,type:e,links:null};if(n)for(var r in n)i[r]=n[r];return this.outputs||(this.outputs=[]),this.outputs.push(i),this.onOutputAdded&&this.onOutputAdded(i),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,e,!0),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),i},LGraphNode.prototype.addOutputs=function(t){for(var e=0;e<t.length;++e){var n=t[e],i={name:n[0],type:n[1],link:null};if(t[2])for(var r in n[2])i[r]=n[2][r];this.outputs||(this.outputs=[]),this.outputs.push(i),this.onOutputAdded&&this.onOutputAdded(i),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,n[1],!0)}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeOutput=function(t){this.disconnectOutput(t),this.outputs.splice(t,1);for(var e=t;e<this.outputs.length;++e)if(this.outputs[e]&&this.outputs[e].links)for(var n=this.outputs[e].links,i=0;i<n.length;++i){var r=this.graph.links[n[i]];r&&(r.origin_slot-=1)}this.setSize(this.computeSize()),this.onOutputRemoved&&this.onOutputRemoved(t),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addInput=function(t,e,n){var i={name:t,type:e=e||0,link:null};if(n)for(var r in n)i[r]=n[r];return this.inputs||(this.inputs=[]),this.inputs.push(i),this.setSize(this.computeSize()),this.onInputAdded&&this.onInputAdded(i),LiteGraph.registerNodeAndSlotType(this,e),this.setDirtyCanvas(!0,!0),i},LGraphNode.prototype.addInputs=function(t){for(var e=0;e<t.length;++e){var n=t[e],i={name:n[0],type:n[1],link:null};if(t[2])for(var r in n[2])i[r]=n[2][r];this.inputs||(this.inputs=[]),this.inputs.push(i),this.onInputAdded&&this.onInputAdded(i),LiteGraph.registerNodeAndSlotType(this,n[1])}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeInput=function(t){this.disconnectInput(t);for(var e=this.inputs.splice(t,1),n=t;n<this.inputs.length;++n)if(this.inputs[n]){var i=this.graph.links[this.inputs[n].link];i&&(i.target_slot-=1)}this.setSize(this.computeSize()),this.onInputRemoved&&this.onInputRemoved(t,e[0]),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addConnection=function(t,e,n,i){var r={name:t,type:e,pos:n,direction:i,links:null};return this.connections.push(r),r},LGraphNode.prototype.computeSize=function(t){if(this.constructor.size)return this.constructor.size.concat();var e=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1),n=t||new Float32Array([0,0]);e=Math.max(e,1);var i=LiteGraph.NODE_TEXT_SIZE,r=d(this.title),o=0,s=0;if(this.inputs)for(var a=0,u=this.inputs.length;a<u;++a){var l=this.inputs[a];o<(p=d(l.label||l.name||""))&&(o=p)}if(this.outputs)for(a=0,u=this.outputs.length;a<u;++a){var p,h=this.outputs[a];s<(p=d(h.label||h.name||""))&&(s=p)}n[0]=Math.max(o+s+10,r),n[0]=Math.max(n[0],LiteGraph.NODE_WIDTH),this.widgets&&this.widgets.length&&(n[0]=Math.max(n[0],1.5*LiteGraph.NODE_WIDTH)),n[1]=(this.constructor.slot_start_y||0)+e*LiteGraph.NODE_SLOT_HEIGHT;var c=0;if(this.widgets&&this.widgets.length){for(a=0,u=this.widgets.length;a<u;++a)this.widgets[a].computeSize?c+=this.widgets[a].computeSize(n[0])[1]+4:c+=LiteGraph.NODE_WIDGET_HEIGHT+4;c+=8}function d(t){return t?i*t.length*.6:0}return this.widgets_up?n[1]=Math.max(n[1],c):null!=this.widgets_start_y?n[1]=Math.max(n[1],c+this.widgets_start_y):n[1]+=c,this.constructor.min_height&&n[1]<this.constructor.min_height&&(n[1]=this.constructor.min_height),n[1]+=6,n},LGraphNode.prototype.getPropertyInfo=function(t){var e=null;if(this.properties_info)for(var n=0;n<this.properties_info.length;++n)if(this.properties_info[n].name==t){e=this.properties_info[n];break}return this.constructor["@"+t]&&(e=this.constructor["@"+t]),this.constructor.widgets_info&&this.constructor.widgets_info[t]&&(e=this.constructor.widgets_info[t]),!e&&this.onGetPropertyInfo&&(e=this.onGetPropertyInfo(t)),e||(e={}),e.type||(e.type=typeof this.properties[t]),"combo"==e.widget&&(e.type="enum"),e},LGraphNode.prototype.addWidget=function(t,e,n,i,r){this.widgets||(this.widgets=[]),!r&&i&&i.constructor===Object&&(r=i,i=null),r&&r.constructor===String&&(r={property:r}),i&&i.constructor===String&&(r||(r={}),r.property=i,i=null),i&&i.constructor!==Function&&(console.warn("addWidget: callback must be a function"),i=null);var o={type:t.toLowerCase(),name:e,value:n,callback:i,options:r||{}};if(void 0!==o.options.y&&(o.y=o.options.y),i||o.options.callback||o.options.property||console.warn("LiteGraph addWidget(...) without a callback or property assigned"),"combo"==t&&!o.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";return this.widgets.push(o),this.setSize(this.computeSize()),o},LGraphNode.prototype.addCustomWidget=function(t){return this.widgets||(this.widgets=[]),this.widgets.push(t),t},LGraphNode.prototype.getBounding=function(t,e){t=t||new Float32Array(4);const n=this.pos,i=this.flags.collapsed,r=this.size;let o=0,s=1,a=0,u=0;return e&&(o=4,s=6+o,a=4,u=5+a),t[0]=n[0]-o,t[1]=n[1]-LiteGraph.NODE_TITLE_HEIGHT-a,t[2]=i?(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+s:r[0]+s,t[3]=i?LiteGraph.NODE_TITLE_HEIGHT+u:r[1]+LiteGraph.NODE_TITLE_HEIGHT+u,this.onBounding&&this.onBounding(t),t},LGraphNode.prototype.isPointInside=function(t,e,n,i){n=n||0;var r=this.graph&&this.graph.isLive()?0:LiteGraph.NODE_TITLE_HEIGHT;if(i&&(r=0),this.flags&&this.flags.collapsed){if(isInsideRectangle(t,e,this.pos[0]-n,this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT-n,(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+2*n,LiteGraph.NODE_TITLE_HEIGHT+2*n))return!0}else if(this.pos[0]-4-n<t&&this.pos[0]+this.size[0]+4+n>t&&this.pos[1]-r-n<e&&this.pos[1]+this.size[1]+n>e)return!0;return!1},LGraphNode.prototype.getSlotInPosition=function(t,e){var n=new Float32Array(2);if(this.inputs)for(var i=0,r=this.inputs.length;i<r;++i){var o=this.inputs[i];if(this.getConnectionPos(!0,i,n),isInsideRectangle(t,e,n[0]-10,n[1]-5,20,10))return{input:o,slot:i,link_pos:n}}if(this.outputs)for(i=0,r=this.outputs.length;i<r;++i){var s=this.outputs[i];if(this.getConnectionPos(!1,i,n),isInsideRectangle(t,e,n[0]-10,n[1]-5,20,10))return{output:s,slot:i,link_pos:n}}return null},LGraphNode.prototype.findInputSlot=function(t,e){if(!this.inputs)return-1;for(var n=0,i=this.inputs.length;n<i;++n)if(t==this.inputs[n].name)return e?this.inputs[n]:n;return-1},LGraphNode.prototype.findOutputSlot=function(t,e){if(e=e||!1,!this.outputs)return-1;for(var n=0,i=this.outputs.length;n<i;++n)if(t==this.outputs[n].name)return e?this.outputs[n]:n;return-1},LGraphNode.prototype.findInputSlotFree=function(t){t=t||{};var e=Object.assign({returnObj:!1,typesNotAccepted:[]},t);if(!this.inputs)return-1;for(var n=0,i=this.inputs.length;n<i;++n)if(!(this.inputs[n].link&&null!=this.inputs[n].link||e.typesNotAccepted&&e.typesNotAccepted.includes&&e.typesNotAccepted.includes(this.inputs[n].type)))return e.returnObj?this.inputs[n]:n;return-1},LGraphNode.prototype.findOutputSlotFree=function(t){t=t||{};var e=Object.assign({returnObj:!1,typesNotAccepted:[]},t);if(!this.outputs)return-1;for(var n=0,i=this.outputs.length;n<i;++n)if(!(this.outputs[n].links&&null!=this.outputs[n].links||e.typesNotAccepted&&e.typesNotAccepted.includes&&e.typesNotAccepted.includes(this.outputs[n].type)))return e.returnObj?this.outputs[n]:n;return-1},LGraphNode.prototype.findInputSlotByType=function(t,e,n,i){return this.findSlotByType(!0,t,e,n,i)},LGraphNode.prototype.findOutputSlotByType=function(t,e,n,i){return this.findSlotByType(!1,t,e,n,i)},LGraphNode.prototype.findSlotByType=function(t,e,n,i,r){n=n||!1,i=i||!1,r=r||!1;var o=(t=t||!1)?this.inputs:this.outputs;if(!o)return-1;""!=e&&"*"!=e||(e=0);for(var s=0,a=o.length;s<a;++s){var u=(e+"").toLowerCase().split(",");h=((h="0"==o[s].type||"*"==o[s].type?"0":o[s].type)+"").toLowerCase().split(",");for(var l=0;l<u.length;l++)for(var p=0;p<h.length;p++)if("_event_"==u[l]&&(u[l]=LiteGraph.EVENT),"_event_"==h[l]&&(h[l]=LiteGraph.EVENT),"*"==u[l]&&(u[l]=0),"*"==h[l]&&(h[l]=0),u[l]==h[p]){if(i&&o[s].links&&null!==o[s].links)continue;return n?o[s]:s}}if(i&&!r)for(s=0,a=o.length;s<a;++s){var h;for(u=(e+"").toLowerCase().split(","),h=((h="0"==o[s].type||"*"==o[s].type?"0":o[s].type)+"").toLowerCase().split(","),l=0;l<u.length;l++)for(p=0;p<h.length;p++)if("*"==u[l]&&(u[l]=0),"*"==h[l]&&(h[l]=0),u[l]==h[p])return n?o[s]:s}return-1},LGraphNode.prototype.connectByType=function(t,e,n,i){i=i||{};var r,o=Object.assign({createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},i);return e&&e.constructor===Number&&(e=this.graph.getNodeById(e)),(r=e.findInputSlotByType(n,!1,!0))>=0&&null!==r?this.connect(t,e,r):o.createEventInCase&&n==LiteGraph.EVENT?this.connect(t,e,-1):o.generalTypeInCase&&(r=e.findInputSlotByType(0,!1,!0,!0))>=0||o.firstFreeIfOutputGeneralInCase&&(0==n||"*"==n||""==n)&&(r=e.findInputSlotFree({typesNotAccepted:[LiteGraph.EVENT]}))>=0?this.connect(t,e,r):(console.debug("no way to connect type: ",n," to targetNODE ",e),null)},LGraphNode.prototype.connectByTypeOutput=function(t,e,n,i){i=i||{};var r=Object.assign({createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},i);if(e&&e.constructor===Number&&(e=this.graph.getNodeById(e)),(o=e.findOutputSlotByType(n,!1,!0))>=0&&null!==o)return e.connect(o,this,t);if(r.generalTypeInCase&&(o=e.findOutputSlotByType(0,!1,!0,!0))>=0)return e.connect(o,this,t);if(r.createEventInCase&&n==LiteGraph.EVENT&&LiteGraph.do_add_triggers_slots){var o=e.addOnExecutedOutput();return e.connect(o,this,t)}return r.firstFreeIfInputGeneralInCase&&(0==n||"*"==n||""==n)&&(o=e.findOutputSlotFree({typesNotAccepted:[LiteGraph.EVENT]}))>=0?e.connect(o,this,t):(console.debug("no way to connect byOUT type: ",n," to sourceNODE ",e),null)},LGraphNode.prototype.connect=function(t,e,n){if(n=n||0,!this.graph)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(t.constructor===String){if(-1==(t=this.findOutputSlot(t)))return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),null}else if(!this.outputs||t>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;if(e&&e.constructor===Number&&(e=this.graph.getNodeById(e)),!e)throw"target node is null";if(e==this)return null;if(n.constructor===String){if(-1==(n=e.findInputSlot(n)))return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+n),null}else if(n===LiteGraph.EVENT){if(!LiteGraph.do_add_triggers_slots)return null;e.changeMode(LiteGraph.ON_TRIGGER),n=e.findInputSlot("onTrigger")}else if(!e.inputs||n>=e.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;var i=!1,r=e.inputs[n],o=null,s=this.outputs[t];return this.outputs[t]?(e.onBeforeConnectInput&&(n=e.onBeforeConnectInput(n)),!1!==n&&null!==n&&LiteGraph.isValidConnection(s.type,r.type)?e.onConnectInput&&!1===e.onConnectInput(n,s.type,s,this,t)||this.onConnectOutput&&!1===this.onConnectOutput(t,r.type,r,e,n)?null:(e.inputs[n]&&null!=e.inputs[n].link&&(this.graph.beforeChange(),e.disconnectInput(n,{doProcessChange:!1}),i=!0),null!==s.links&&s.links.length&&s.type===LiteGraph.EVENT&&(LiteGraph.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput(t,!1,{doProcessChange:!1}),i=!0)),o=new LLink(LiteGraph.use_uuids?LiteGraph.uuidv4():++this.graph.last_link_id,r.type||s.type,this.id,t,e.id,n),this.graph.links[o.id]=o,null==s.links&&(s.links=[]),s.links.push(o.id),e.inputs[n].link=o.id,this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!0,o,s),e.onConnectionsChange&&e.onConnectionsChange(LiteGraph.INPUT,n,!0,o,r),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,n,this,t),this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t,e,n)),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,o),o):(this.setDirtyCanvas(!1,!0),i&&this.graph.connectionChange(this,o),null)):null},LGraphNode.prototype.disconnectOutput=function(t,e){if(t.constructor===String){if(-1==(t=this.findOutputSlot(t)))return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.outputs||t>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var n=this.outputs[t];if(!n||!n.links||0==n.links.length)return!1;if(e){if(e.constructor===Number&&(e=this.graph.getNodeById(e)),!e)throw"Target Node not found";for(var i=0,r=n.links.length;i<r;i++){var o=n.links[i];if((s=this.graph.links[o]).target_id==e.id){n.links.splice(i,1),(a=e.inputs[s.target_slot]).link=null,delete this.graph.links[o],this.graph&&this.graph._version++,e.onConnectionsChange&&e.onConnectionsChange(LiteGraph.INPUT,s.target_slot,!1,s,a),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!1,s,n),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,s.target_slot));break}}}else{for(i=0,r=n.links.length;i<r;i++){var s;if(o=n.links[i],s=this.graph.links[o]){e=this.graph.getNodeById(s.target_id);var a=null;this.graph&&this.graph._version++,e&&((a=e.inputs[s.target_slot]).link=null,e.onConnectionsChange&&e.onConnectionsChange(LiteGraph.INPUT,s.target_slot,!1,s,a),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,s.target_slot)),delete this.graph.links[o],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!1,s,n),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,s.target_slot))}}n.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},LGraphNode.prototype.disconnectInput=function(t){if(t.constructor===String){if(-1==(t=this.findInputSlot(t)))return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.inputs||t>=this.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var e=this.inputs[t];if(!e)return!1;var n=this.inputs[t].link;if(null!=n){this.inputs[t].link=null;var i=this.graph.links[n];if(i){var r=this.graph.getNodeById(i.origin_id);if(!r)return!1;var o=r.outputs[i.origin_slot];if(!o||!o.links||0==o.links.length)return!1;for(var s=0,a=o.links.length;s<a;s++)if(o.links[s]==n){o.links.splice(s,1);break}delete this.graph.links[n],this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,t,!1,i,e),r.onConnectionsChange&&r.onConnectionsChange(LiteGraph.OUTPUT,s,!1,i,o),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,r,s),this.graph.onNodeConnectionChange(LiteGraph.INPUT,this,t))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0},LGraphNode.prototype.getConnectionPos=function(t,e,n){n=n||new Float32Array(2);var i=0;t&&this.inputs&&(i=this.inputs.length),!t&&this.outputs&&(i=this.outputs.length);var r=.5*LiteGraph.NODE_SLOT_HEIGHT;if(this.flags.collapsed){var o=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH;return this.horizontal?(n[0]=this.pos[0]+.5*o,n[1]=t?this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:this.pos[1]):(n[0]=t?this.pos[0]:this.pos[0]+o,n[1]=this.pos[1]-.5*LiteGraph.NODE_TITLE_HEIGHT),n}return t&&-1==e?(n[0]=this.pos[0]+.5*LiteGraph.NODE_TITLE_HEIGHT,n[1]=this.pos[1]+.5*LiteGraph.NODE_TITLE_HEIGHT,n):t&&i>e&&this.inputs[e].pos?(n[0]=this.pos[0]+this.inputs[e].pos[0],n[1]=this.pos[1]+this.inputs[e].pos[1],n):!t&&i>e&&this.outputs[e].pos?(n[0]=this.pos[0]+this.outputs[e].pos[0],n[1]=this.pos[1]+this.outputs[e].pos[1],n):this.horizontal?(n[0]=this.pos[0]+(e+.5)*(this.size[0]/i),n[1]=t?this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:this.pos[1]+this.size[1],n):(n[0]=t?this.pos[0]+r:this.pos[0]+this.size[0]+1-r,n[1]=this.pos[1]+(e+.7)*LiteGraph.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),n)},LGraphNode.prototype.alignToGrid=function(){this.pos[0]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph.CANVAS_GRID_SIZE)},LGraphNode.prototype.trace=function(t){this.console||(this.console=[]),this.console.push(t),this.console.length>LGraphNode.MAX_CONSOLE&&this.console.shift(),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,t)},LGraphNode.prototype.setDirtyCanvas=function(t,e){this.graph&&this.graph.sendActionToCanvas("setDirty",[t,e])},LGraphNode.prototype.loadImage=function(t){var e=new Image;e.src=LiteGraph.node_images_path+t,e.ready=!1;var n=this;return e.onload=function(){this.ready=!0,n.setDirtyCanvas(!0)},e},LGraphNode.prototype.captureInput=function(t){if(this.graph&&this.graph.list_of_graphcanvas)for(var e=this.graph.list_of_graphcanvas,n=0;n<e.length;++n){var i=e[n];(t||i.node_capturing_input==this)&&(i.node_capturing_input=t?this:null)}},LGraphNode.prototype.collapse=function(t){this.graph._version++,(!1!==this.constructor.collapsable||t)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},LGraphNode.prototype.pin=function(t){this.graph._version++,this.flags.pinned=void 0===t?!this.flags.pinned:t},LGraphNode.prototype.localToScreen=function(t,e,n){return[(t+this.pos[0])*n.scale+n.offset[0],(e+this.pos[1])*n.scale+n.offset[1]]},global.LGraphGroup=LiteGraph.LGraphGroup=LGraphGroup,LGraphGroup.prototype._ctor=function(t){this.title=t||"Group",this.font_size=24,this.color=LGraphCanvas.node_colors.pale_blue?LGraphCanvas.node_colors.pale_blue.groupcolor:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null,Object.defineProperty(this,"pos",{set:function(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])},get:function(){return this._pos},enumerable:!0}),Object.defineProperty(this,"size",{set:function(t){!t||t.length<2||(this._size[0]=Math.max(140,t[0]),this._size[1]=Math.max(80,t[1]))},get:function(){return this._size},enumerable:!0})},LGraphGroup.prototype.configure=function(t){this.title=t.title,this._bounding.set(t.bounding),this.color=t.color,this.font_size=t.font_size},LGraphGroup.prototype.serialize=function(){var t=this._bounding;return{title:this.title,bounding:[Math.round(t[0]),Math.round(t[1]),Math.round(t[2]),Math.round(t[3])],color:this.color,font_size:this.font_size}},LGraphGroup.prototype.move=function(t,e,n){if(this._pos[0]+=t,this._pos[1]+=e,!n)for(var i=0;i<this._nodes.length;++i){var r=this._nodes[i];r.pos[0]+=t,r.pos[1]+=e}},LGraphGroup.prototype.recomputeInsideNodes=function(){this._nodes.length=0;for(var t=this.graph._nodes,e=new Float32Array(4),n=0;n<t.length;++n){var i=t[n];i.getBounding(e),overlapBounding(this._bounding,e)&&this._nodes.push(i)}},LGraphGroup.prototype.isPointInside=LGraphNode.prototype.isPointInside,LGraphGroup.prototype.setDirtyCanvas=LGraphNode.prototype.setDirtyCanvas,LiteGraph.DragAndScale=DragAndScale,DragAndScale.prototype.bindEvents=function(t){this.last_mouse=new Float32Array(2),this._binded_mouse_callback=this.onMouse.bind(this),LiteGraph.pointerListenerAdd(t,"down",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(t,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(t,"up",this._binded_mouse_callback),t.addEventListener("mousewheel",this._binded_mouse_callback,!1),t.addEventListener("wheel",this._binded_mouse_callback,!1)},DragAndScale.prototype.computeVisibleArea=function(t){if(this.element){var e=this.element.width,n=this.element.height,i=-this.offset[0],r=-this.offset[1];t&&(i+=t[0]/this.scale,r+=t[1]/this.scale,e=t[2],n=t[3]);var o=i+e/this.scale,s=r+n/this.scale;this.visible_area[0]=i,this.visible_area[1]=r,this.visible_area[2]=o-i,this.visible_area[3]=s-r}else this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=0},DragAndScale.prototype.onMouse=function(t){if(this.enabled){var e=this.element,n=e.getBoundingClientRect(),i=t.clientX-n.left,r=t.clientY-n.top;t.canvasx=i,t.canvasy=r,t.dragging=this.dragging;var o=!this.viewport||this.viewport&&i>=this.viewport[0]&&i<this.viewport[0]+this.viewport[2]&&r>=this.viewport[1]&&r<this.viewport[1]+this.viewport[3],s=!1;if(this.onmouse&&(s=this.onmouse(t)),t.type==LiteGraph.pointerevents_method+"down"&&o)this.dragging=!0,LiteGraph.pointerListenerRemove(e,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"up",this._binded_mouse_callback);else if(t.type==LiteGraph.pointerevents_method+"move"){if(!s){var a=i-this.last_mouse[0],u=r-this.last_mouse[1];this.dragging&&this.mouseDrag(a,u)}}else t.type==LiteGraph.pointerevents_method+"up"?(this.dragging=!1,LiteGraph.pointerListenerRemove(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerRemove(document,"up",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(e,"move",this._binded_mouse_callback)):!o||"mousewheel"!=t.type&&"wheel"!=t.type&&"DOMMouseScroll"!=t.type||(t.eventType="mousewheel","wheel"==t.type?t.wheel=-t.deltaY:t.wheel=null!=t.wheelDeltaY?t.wheelDeltaY:-60*t.detail,t.delta=t.wheelDelta?t.wheelDelta/40:t.deltaY?-t.deltaY/3:0,this.changeDeltaScale(1+.05*t.delta));return this.last_mouse[0]=i,this.last_mouse[1]=r,o?(t.preventDefault(),t.stopPropagation(),!1):void 0}},DragAndScale.prototype.toCanvasContext=function(t){t.scale(this.scale,this.scale),t.translate(this.offset[0],this.offset[1])},DragAndScale.prototype.convertOffsetToCanvas=function(t){return[(t[0]+this.offset[0])*this.scale,(t[1]+this.offset[1])*this.scale]},DragAndScale.prototype.convertCanvasToOffset=function(t,e){return(e=e||[0,0])[0]=t[0]/this.scale-this.offset[0],e[1]=t[1]/this.scale-this.offset[1],e},DragAndScale.prototype.mouseDrag=function(t,e){this.offset[0]+=t/this.scale,this.offset[1]+=e/this.scale,this.onredraw&&this.onredraw(this)},DragAndScale.prototype.changeScale=function(t,e){if(t<this.min_scale?t=this.min_scale:t>this.max_scale&&(t=this.max_scale),t!=this.scale&&this.element){var n=this.element.getBoundingClientRect();if(n){e=e||[.5*n.width,.5*n.height];var i=this.convertCanvasToOffset(e);this.scale=t,Math.abs(this.scale-1)<.01&&(this.scale=1);var r=this.convertCanvasToOffset(e),o=[r[0]-i[0],r[1]-i[1]];this.offset[0]+=o[0],this.offset[1]+=o[1],this.onredraw&&this.onredraw(this)}}},DragAndScale.prototype.changeDeltaScale=function(t,e){this.changeScale(this.scale*t,e)},DragAndScale.prototype.reset=function(){this.scale=1,this.offset[0]=0,this.offset[1]=0},global.LGraphCanvas=LiteGraph.LGraphCanvas=LGraphCanvas,LGraphCanvas.DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",LGraphCanvas.link_type_colors={"-1":LiteGraph.EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"},LGraphCanvas.gradients={},LGraphCanvas.prototype.clear=function(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),this.onClear&&this.onClear()},LGraphCanvas.prototype.setGraph=function(t,e){this.graph!=t&&(e||this.clear(),t||!this.graph?(t.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)):this.graph.detachCanvas(this))},LGraphCanvas.prototype.getTopGraph=function(){return this._graph_stack.length?this._graph_stack[0]:this.graph},LGraphCanvas.prototype.openSubgraph=function(t){if(!t)throw"graph cannot be null";if(this.graph==t)throw"graph cannot be the same";this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),t.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)},LGraphCanvas.prototype.closeSubgraph=function(){if(this._graph_stack&&0!=this._graph_stack.length){var t=this.graph._subgraph_node,e=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},e.attachCanvas(this),this.setDirty(!0,!0),t&&(this.centerOnNode(t),this.selectNodes([t])),this.ds.offset=[0,0],this.ds.scale=1}},LGraphCanvas.prototype.getCurrentGraph=function(){return this.graph},LGraphCanvas.prototype.setCanvas=function(t,e){if(t&&t.constructor===String&&!(t=document.getElementById(t)))throw"Error creating LiteGraph canvas: Canvas not found";if(t!==this.canvas&&(!t&&this.canvas&&(e||this.unbindEvents()),this.canvas=t,this.ds.element=t,t)){if(t.className+=" lgraphcanvas",t.data=this,t.tabindex="1",this.bgcanvas=null,this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),null==t.getContext){if("canvas"!=t.localName)throw"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+t.localName;throw"This browser doesn't support Canvas"}null==(this.ctx=t.getContext("2d"))&&(t.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),e||this.bindEvents()}},LGraphCanvas.prototype._doNothing=function(t){return t.preventDefault(),!1},LGraphCanvas.prototype._doReturnTrue=function(t){return t.preventDefault(),!0},LGraphCanvas.prototype.bindEvents=function(){if(this._events_binded)console.warn("LGraphCanvas: events already binded");else{var t=this.canvas,e=this.getCanvasWindow().document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),LiteGraph.pointerListenerAdd(t,"down",this._mousedown_callback,!0),t.addEventListener("mousewheel",this._mousewheel_callback,!1),LiteGraph.pointerListenerAdd(t,"up",this._mouseup_callback,!0),LiteGraph.pointerListenerAdd(t,"move",this._mousemove_callback),t.addEventListener("contextmenu",this._doNothing),t.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),this._key_callback=this.processKey.bind(this),t.setAttribute("tabindex",1),t.addEventListener("keydown",this._key_callback,!0),e.addEventListener("keyup",this._key_callback,!0),this._ondrop_callback=this.processDrop.bind(this),t.addEventListener("dragover",this._doNothing,!1),t.addEventListener("dragend",this._doNothing,!1),t.addEventListener("drop",this._ondrop_callback,!1),t.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0}},LGraphCanvas.prototype.unbindEvents=function(){if(this._events_binded){var t=this.getCanvasWindow().document;LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"up",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"down",this._mousedown_callback),this.canvas.removeEventListener("mousewheel",this._mousewheel_callback),this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback),this.canvas.removeEventListener("keydown",this._key_callback),t.removeEventListener("keyup",this._key_callback),this.canvas.removeEventListener("contextmenu",this._doNothing),this.canvas.removeEventListener("drop",this._ondrop_callback),this.canvas.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null,this._mousewheel_callback=null,this._key_callback=null,this._ondrop_callback=null,this._events_binded=!1}else console.warn("LGraphCanvas: no events binded")},LGraphCanvas.getFileExtension=function(t){var e=t.indexOf("?");-1!=e&&(t=t.substr(0,e));var n=t.lastIndexOf(".");return-1==n?"":t.substr(n+1).toLowerCase()},LGraphCanvas.prototype.enableWebGL=function(){if("undefined"==typeof GL)throw"litegl.js must be included to use a WebGL canvas";if("undefined"==typeof enableWebGLCanvas)throw"webglCanvas.js must be included to use this feature";this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0},LGraphCanvas.prototype.setDirty=function(t,e){t&&(this.dirty_canvas=!0),e&&(this.dirty_bgcanvas=!0)},LGraphCanvas.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var t=this.canvas.ownerDocument;return t.defaultView||t.parentWindow},LGraphCanvas.prototype.startRendering=function(){this.is_rendering||(this.is_rendering=!0,function t(){this.pause_rendering||this.draw();var e=this.getCanvasWindow();this.is_rendering&&e.requestAnimationFrame(t.bind(this))}.call(this))},LGraphCanvas.prototype.stopRendering=function(){this.is_rendering=!1},LGraphCanvas.prototype.blockClick=function(){this.block_click=!0,this.last_mouseclick=0},LGraphCanvas.prototype.processMouseDown=function(t){if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),this.graph){this.adjustMouseEvent(t);var e=this.getCanvasWindow();e.document,LGraphCanvas.active_canvas=this;var n=this,i=t.clientX,r=t.clientY;this.ds.viewport=this.viewport;var o=!this.viewport||this.viewport&&i>=this.viewport[0]&&i<this.viewport[0]+this.viewport[2]&&r>=this.viewport[1]&&r<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousemove_callback),LiteGraph.pointerListenerAdd(e.document,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(e.document,"up",this._mouseup_callback,!0)),o){var s=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes,5),a=!1,u=LiteGraph.getTime(),l=void 0===t.isPrimary||!t.isPrimary,p=u-this.last_mouseclick<300&&l;if(this.mouse[0]=t.clientX,this.mouse[1]=t.clientY,this.graph_mouse[0]=t.canvasX,this.graph_mouse[1]=t.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&l?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.closeAllContextMenus(e),!this.onMouse||1!=this.onMouse(t)){if(1!=t.which||this.pointer_is_double)if(2==t.which)if(LiteGraph.middle_click_slot_add_default_node){if(s&&this.allow_interaction&&!a&&!this.read_only&&!this.connecting_node&&!s.flags.collapsed&&!this.live_mode){var h=!1,c=!1,d=!1;if(s.outputs)for(m=0,x=s.outputs.length;m<x;++m)if(A=s.outputs[m],w=s.getConnectionPos(!1,m),isInsideRectangle(t.canvasX,t.canvasY,w[0]-15,w[1]-10,30,20)){h=A,c=m,d=!0;break}if(s.inputs)for(m=0,x=s.inputs.length;m<x;++m)if(E=s.inputs[m],w=s.getConnectionPos(!0,m),isInsideRectangle(t.canvasX,t.canvasY,w[0]-15,w[1]-10,30,20)){h=E,c=m,d=!1;break}if(h&&!1!==c){var f=.5-(c+1)/(d?s.outputs.length:s.inputs.length),g=s.getBounding(),_=[d?g[0]+g[2]:g[0],t.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:d?s:null,slotFrom:d?c:null,nodeTo:d?null:s,slotTo:d?null:c,position:_,nodeType:"AUTO",posAdd:[d?30:-30,130*-f],posSizeFix:[d?0:-1,0]})}}}else!a&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else(3==t.which||this.pointer_is_double)&&(!this.allow_interaction||a||this.read_only||(s&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[s.id]||t.shiftKey||t.ctrlKey||t.metaKey)?this.selected_nodes[s.id]||this.selectNodes([s],!0):this.selectNodes([s])),this.processContextMenu(s,t)));else{t.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=t.canvasX,this.dragging_rectangle[1]=t.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,a=!0),LiteGraph.alt_drag_do_clone_nodes&&t.altKey&&s&&this.allow_interaction&&!a&&!this.read_only&&(cloned=s.clone())&&(cloned.pos[0]+=5,cloned.pos[1]+=5,this.graph.add(cloned,!1,{doCalcSize:!1}),s=cloned,a=!0,T||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=s),this.selected_nodes[s.id]||this.processNodeSelected(s,t)));var v=!1;if(!s||!this.allow_interaction&&!s.flags.allow_interaction||a||this.read_only){if(!a){if(!this.read_only)for(var m=0;m<this.visible_links.length;++m){var y=this.visible_links[m],b=y._pos;if(!(!b||t.canvasX<b[0]-4||t.canvasX>b[0]+4||t.canvasY<b[1]-4||t.canvasY>b[1]+4)){this.showLinkMenu(y,t),this.over_link_center=null;break}}this.selected_group=this.graph.getGroupOnPos(t.canvasX,t.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only&&(t.ctrlKey&&(this.dragging_rectangle=null),distance([t.canvasX,t.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]])*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()),p&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox(t),t.preventDefault(),t.stopPropagation()),v=!0}}else{if(this.live_mode||s.flags.pinned||this.bringToFront(s),this.allow_interaction&&!this.connecting_node&&!s.flags.collapsed&&!this.live_mode)if(!a&&!1!==s.resizable&&isInsideRectangle(t.canvasX,t.canvasY,s.pos[0]+s.size[0]-5,s.pos[1]+s.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=s,this.canvas.style.cursor="se-resize",a=!0;else{if(s.outputs){m=0;for(var x=s.outputs.length;m<x;++m){var A=s.outputs[m],w=s.getConnectionPos(!1,m);if(isInsideRectangle(t.canvasX,t.canvasY,w[0]-15,w[1]-10,30,20)){this.connecting_node=s,this.connecting_output=A,this.connecting_output.slot_index=m,this.connecting_pos=s.getConnectionPos(!1,m),this.connecting_slot=m,LiteGraph.shift_click_do_break_link_from&&t.shiftKey&&s.disconnectOutput(m),p?s.onOutputDblClick&&s.onOutputDblClick(m,t):s.onOutputClick&&s.onOutputClick(m,t),a=!0;break}}}if(s.inputs)for(m=0,x=s.inputs.length;m<x;++m){var E=s.inputs[m];w=s.getConnectionPos(!0,m);if(isInsideRectangle(t.canvasX,t.canvasY,w[0]-15,w[1]-10,30,20)){if(p?s.onInputDblClick&&s.onInputDblClick(m,t):s.onInputClick&&s.onInputClick(m,t),null!==E.link){var C=this.graph.links[E.link];LiteGraph.click_do_break_link_to&&(s.disconnectInput(m),this.dirty_bgcanvas=!0,a=!0),(this.allow_reconnect_links||t.shiftKey)&&(LiteGraph.click_do_break_link_to||s.disconnectInput(m),this.connecting_node=this.graph._nodes_by_id[C.origin_id],this.connecting_slot=C.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,a=!0)}a||(this.connecting_node=s,this.connecting_input=E,this.connecting_input.slot_index=m,this.connecting_pos=s.getConnectionPos(!0,m),this.connecting_slot=m,this.dirty_bgcanvas=!0,a=!0)}}}if(!a){var T=!1,O=[t.canvasX-s.pos[0],t.canvasY-s.pos[1]],S=this.processNodeWidgets(s,this.graph_mouse,t);S&&(T=!0,this.node_widget=[s,S]),this.allow_interaction&&p&&this.selected_nodes[s.id]&&(s.onDblClick&&s.onDblClick(t,O,this),this.processNodeDblClicked(s),T=!0),s.onMouseDown&&s.onMouseDown(t,O,this)?T=!0:(s.subgraph&&!s.skip_subgraph_button&&!s.flags.collapsed&&O[0]>s.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&O[1]<0&&(n=this,setTimeout((function(){n.openSubgraph(s.subgraph)}),10)),this.live_mode&&(v=!0,T=!0)),T?s.is_selected||this.processNodeSelected(s,t):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=s),this.processNodeSelected(s,t)),this.dirty_canvas=!0}}!a&&v&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}return this.last_mouse[0]=t.clientX,this.last_mouse[1]=t.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!e.document.activeElement||"input"!=e.document.activeElement.nodeName.toLowerCase()&&"textarea"!=e.document.activeElement.nodeName.toLowerCase())&&t.preventDefault(),t.stopPropagation(),this.onMouseDown&&this.onMouseDown(t),!1}}}},LGraphCanvas.prototype.processMouseMove=function(t){if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),this.graph){LGraphCanvas.active_canvas=this,this.adjustMouseEvent(t);var e=[t.clientX,t.clientY];this.mouse[0]=e[0],this.mouse[1]=e[1];var n=[e[0]-this.last_mouse[0],e[1]-this.last_mouse[1]];if(this.last_mouse=e,this.graph_mouse[0]=t.canvasX,this.graph_mouse[1]=t.canvasY,this.block_click)return t.preventDefault(),!1;t.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,t,this.node_widget[1]),this.dirty_canvas=!0);var i=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=t.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=t.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[t.canvasX-this.selected_group.pos[0],t.canvasY-this.selected_group.pos[1]];else{var r=n[0]/this.ds.scale,o=n[1]/this.ds.scale;this.selected_group.move(r,o,t.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=n[0]/this.ds.scale,this.ds.offset[1]+=n[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||i&&i.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(var s=0,a=this.graph._nodes.length;s<a;++s)this.graph._nodes[s].mouseOver&&i!=this.graph._nodes[s]&&(this.graph._nodes[s].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(t),this.node_over=null,this.dirty_canvas=!0);if(i){if(i.redraw_on_mouse&&(this.dirty_canvas=!0),i.mouseOver||(i.mouseOver=!0,this.node_over=i,this.dirty_canvas=!0,i.onMouseEnter&&i.onMouseEnter(t)),i.onMouseMove&&i.onMouseMove(t,[t.canvasX-i.pos[0],t.canvasY-i.pos[1]],this),this.connecting_node)if(this.connecting_output){var u=this._highlight_input||[0,0];if(this.isOverNodeBox(i,t.canvasX,t.canvasY));else if(-1!=(p=this.isOverNodeInput(i,t.canvasX,t.canvasY,u))&&i.inputs[p]){var l=i.inputs[p].type;LiteGraph.isValidConnection(this.connecting_output.type,l)&&(this._highlight_input=u,this._highlight_input_slot=i.inputs[p])}else this._highlight_input=null,this._highlight_input_slot=null}else if(this.connecting_input){var p;u=this._highlight_output||[0,0],this.isOverNodeBox(i,t.canvasX,t.canvasY)||(-1!=(p=this.isOverNodeOutput(i,t.canvasX,t.canvasY,u))&&i.outputs[p]?(l=i.outputs[p].type,LiteGraph.isValidConnection(this.connecting_input.type,l)&&(this._highlight_output=u)):this._highlight_output=null)}this.canvas&&(isInsideRectangle(t.canvasX,t.canvasY,i.pos[0]+i.size[0]-5,i.pos[1]+i.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{var h=null;for(s=0;s<this.visible_links.length;++s){var c=this.visible_links[s],d=c._pos;if(!(!d||t.canvasX<d[0]-4||t.canvasX>d[0]+4||t.canvasY<d[1]-4||t.canvasY>d[1]+4)){h=c;break}}h!=this.over_link_center&&(this.over_link_center=h,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=i&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(t,[t.canvasX-this.node_capturing_input.pos[0],t.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(var s in this.selected_nodes){var f=this.selected_nodes[s];f.pos[0]+=n[0]/this.ds.scale,f.pos[1]+=n[1]/this.ds.scale,f.is_selected||this.processNodeSelected(f,t)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var g=[t.canvasX-this.resizing_node.pos[0],t.canvasY-this.resizing_node.pos[1]],_=this.resizing_node.computeSize();g[0]=Math.max(_[0],g[0]),g[1]=Math.max(_[1],g[1]),this.resizing_node.setSize(g),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return t.preventDefault(),!1}},LGraphCanvas.prototype.processMouseUp=function(t){var e=void 0===t.isPrimary||t.isPrimary;if(!e)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),this.graph){var n=this.getCanvasWindow().document;LGraphCanvas.active_canvas=this,this.options.skip_events||(LiteGraph.pointerListenerRemove(n,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(this.canvas,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerRemove(n,"up",this._mouseup_callback,!0)),this.adjustMouseEvent(t);var i=LiteGraph.getTime();if(t.click_time=i-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),1==t.which){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,t),this.node_widget=null,this.selected_group){var r=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),o=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(r,o,t.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var s=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var a=this.graph._nodes,u=new Float32Array(4),l=Math.abs(this.dragging_rectangle[2]),p=Math.abs(this.dragging_rectangle[3]),h=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-l:this.dragging_rectangle[0],c=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-p:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=h,this.dragging_rectangle[1]=c,this.dragging_rectangle[2]=l,this.dragging_rectangle[3]=p,!s||l>10&&p>10){for(var d=[],f=0;f<a.length;++f){var g=a[f];g.getBounding(u),overlapBounding(this.dragging_rectangle,u)&&d.push(g)}d.length&&this.selectNodes(d,t.shiftKey)}else this.selectNodes([s],t.shiftKey||t.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var _=(this.connecting_output||this.connecting_input).type;if(s){if(this.connecting_output)-1!=(v=this.isOverNodeInput(s,t.canvasX,t.canvasY))?this.connecting_node.connect(this.connecting_slot,s,v):this.connecting_node.connectByType(this.connecting_slot,s,_);else if(this.connecting_input){var v;-1!=(v=this.isOverNodeOutput(s,t.canvasX,t.canvasY))?s.connect(v,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,s,_)}}else LiteGraph.release_link_on_empty_shows_menu&&(t.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox(t,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox(t,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e:t}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e:t}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else this.resizing_node?(this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null):this.node_dragged?((s=this.node_dragged)&&t.click_time<300&&isInsideRectangle(t.canvasX,t.canvasY,s.pos[0],s.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&s.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),this.onNodeMoved&&this.onNodeMoved(this.node_dragged),this.graph.afterChange(this.node_dragged),this.node_dragged=null):(!(s=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes))&&t.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(t,[t.canvasX-this.node_over.pos[0],t.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(t,[t.canvasX-this.node_capturing_input.pos[0],t.canvasY-this.node_capturing_input.pos[1]]))}else(2==t.which||3==t.which)&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return e&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),t.stopPropagation(),t.preventDefault(),!1}},LGraphCanvas.prototype.processMouseWheel=function(t){if(this.graph&&this.allow_dragcanvas){var e=null!=t.wheelDeltaY?t.wheelDeltaY:-60*t.detail;this.adjustMouseEvent(t);var n=t.clientX,i=t.clientY;if(!this.viewport||this.viewport&&n>=this.viewport[0]&&n<this.viewport[0]+this.viewport[2]&&i>=this.viewport[1]&&i<this.viewport[1]+this.viewport[3]){var r=this.ds.scale;return e>0?r*=1.1:e<0&&(r*=1/1.1),this.ds.changeScale(r,[t.clientX,t.clientY]),this.graph.change(),t.preventDefault(),!1}}},LGraphCanvas.prototype.isOverNodeBox=function(t,e,n){var i=LiteGraph.NODE_TITLE_HEIGHT;return!!isInsideRectangle(e,n,t.pos[0]+2,t.pos[1]+2-i,i-4,i-4)},LGraphCanvas.prototype.isOverNodeInput=function(t,e,n,i){if(t.inputs)for(var r=0,o=t.inputs.length;r<o;++r){t.inputs[r];var s=t.getConnectionPos(!0,r);if(t.horizontal?isInsideRectangle(e,n,s[0]-5,s[1]-10,10,20):isInsideRectangle(e,n,s[0]-10,s[1]-5,40,10))return i&&(i[0]=s[0],i[1]=s[1]),r}return-1},LGraphCanvas.prototype.isOverNodeOutput=function(t,e,n,i){if(t.outputs)for(var r=0,o=t.outputs.length;r<o;++r){t.outputs[r];var s=t.getConnectionPos(!1,r);if(t.horizontal?isInsideRectangle(e,n,s[0]-5,s[1]-10,10,20):isInsideRectangle(e,n,s[0]-10,s[1]-5,40,10))return i&&(i[0]=s[0],i[1]=s[1]),r}return-1},LGraphCanvas.prototype.processKey=function(t){if(this.graph){var e=!1;if("input"!=t.target.localName){if("keydown"==t.type){if(32==t.keyCode&&(this.dragging_canvas=!0,e=!0),27==t.keyCode&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),e=!0),65==t.keyCode&&t.ctrlKey&&(this.selectNodes(),e=!0),67!==t.keyCode||!t.metaKey&&!t.ctrlKey||t.shiftKey||this.selected_nodes&&(this.copyToClipboard(),e=!0),86===t.keyCode&&(t.metaKey||t.ctrlKey)&&this.pasteFromClipboard(t.shiftKey),46!=t.keyCode&&8!=t.keyCode||"input"!=t.target.localName&&"textarea"!=t.target.localName&&(this.deleteSelectedNodes(),e=!0),this.selected_nodes)for(var n in this.selected_nodes)this.selected_nodes[n].onKeyDown&&this.selected_nodes[n].onKeyDown(t)}else if("keyup"==t.type&&(32==t.keyCode&&(this.dragging_canvas=!1),this.selected_nodes))for(var n in this.selected_nodes)this.selected_nodes[n].onKeyUp&&this.selected_nodes[n].onKeyUp(t);return this.graph.change(),e?(t.preventDefault(),t.stopImmediatePropagation(),!1):void 0}}},LGraphCanvas.prototype.copyToClipboard=function(){var t={nodes:[],links:[]},e=0,n=[];for(var i in this.selected_nodes)!1!==(r=this.selected_nodes[i]).clonable&&(r._relative_id=e,n.push(r),e+=1);for(i=0;i<n.length;++i){var r;if(!1!==(r=n[i]).clonable){var o=r.clone();if(o){if(t.nodes.push(o.serialize()),r.inputs&&r.inputs.length)for(var s=0;s<r.inputs.length;++s){var a=r.inputs[s];if(a&&null!=a.link){var u=this.graph.links[a.link];if(u){var l=this.graph.getNodeById(u.origin_id);l&&t.links.push([l._relative_id,u.origin_slot,r._relative_id,u.target_slot,l.id])}}}}else console.warn("node type not found: "+r.type)}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(t))},LGraphCanvas.prototype.pasteFromClipboard=function(t=!1){if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs||!t){var e=localStorage.getItem("litegrapheditor_clipboard");if(e){this.graph.beforeChange();for(var n=JSON.parse(e),i=!1,r=!1,o=0;o<n.nodes.length;++o)i?(i[0]>n.nodes[o].pos[0]&&(i[0]=n.nodes[o].pos[0],r[0]=o),i[1]>n.nodes[o].pos[1]&&(i[1]=n.nodes[o].pos[1],r[1]=o)):(i=[n.nodes[o].pos[0],n.nodes[o].pos[1]],r=[o,o]);var s=[];for(o=0;o<n.nodes.length;++o){var a=n.nodes[o],u=LiteGraph.createNode(a.type);u&&(u.configure(a),u.pos[0]+=this.graph_mouse[0]-i[0],u.pos[1]+=this.graph_mouse[1]-i[1],this.graph.add(u,{doProcessChange:!1}),s.push(u))}for(o=0;o<n.links.length;++o){var l,p=n.links[o],h=p[0];if(null!=h)l=s[h];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&t){var c=p[4];c&&(l=this.graph.getNodeById(c))}var d=s[p[2]];l&&d?l.connect(p[1],d,p[3]):console.warn("Warning, nodes missing on pasting")}this.selectNodes(s),this.graph.afterChange()}}},LGraphCanvas.prototype.processDrop=function(t){t.preventDefault(),this.adjustMouseEvent(t);var e=t.clientX,n=t.clientY;if(!this.viewport||this.viewport&&e>=this.viewport[0]&&e<this.viewport[0]+this.viewport[2]&&n>=this.viewport[1]&&n<this.viewport[1]+this.viewport[3]){var i=[t.canvasX,t.canvasY],r=this.graph?this.graph.getNodeOnPos(i[0],i[1]):null;if(!r){var o=null;return this.onDropItem&&(o=this.onDropItem(event)),void(o||this.checkDropItem(t))}if(r.onDropFile||r.onDropData){var s=t.dataTransfer.files;if(s&&s.length)for(var a=0;a<s.length;a++){var u=t.dataTransfer.files[0],l=u.name;if(LGraphCanvas.getFileExtension(l),r.onDropFile&&r.onDropFile(u),r.onDropData){var p=new FileReader;p.onload=function(t){var e=t.target.result;r.onDropData(e,l,u)};var h=u.type.split("/")[0];"text"==h||""==h?p.readAsText(u):"image"==h?p.readAsDataURL(u):p.readAsArrayBuffer(u)}}}return!(!r.onDropItem||!r.onDropItem(event))||!!this.onDropItem&&this.onDropItem(event)}},LGraphCanvas.prototype.checkDropItem=function(t){if(t.dataTransfer.files.length){var e=t.dataTransfer.files[0],n=LGraphCanvas.getFileExtension(e.name).toLowerCase(),i=LiteGraph.node_types_by_file_extension[n];if(i){this.graph.beforeChange();var r=LiteGraph.createNode(i.type);r.pos=[t.canvasX,t.canvasY],this.graph.add(r),r.onDropFile&&r.onDropFile(e),this.graph.afterChange()}}},LGraphCanvas.prototype.processNodeDblClicked=function(t){this.onShowNodePanel?this.onShowNodePanel(t):this.showShowNodePanel(t),this.onNodeDblClicked&&this.onNodeDblClicked(t),this.setDirty(!0)},LGraphCanvas.prototype.processNodeSelected=function(t,e){this.selectNode(t,e&&(e.shiftKey||e.ctrlKey||this.multi_select)),this.onNodeSelected&&this.onNodeSelected(t)},LGraphCanvas.prototype.selectNode=function(t,e){null==t?this.deselectAllNodes():this.selectNodes([t],e)},LGraphCanvas.prototype.selectNodes=function(t,e){for(var n in e||this.deselectAllNodes(),"string"==typeof(t=t||this.graph._nodes)&&(t=[t]),t){var i=t[n];if(i.is_selected)this.deselectNode(i);else{if(!i.is_selected&&i.onSelected&&i.onSelected(),i.is_selected=!0,this.selected_nodes[i.id]=i,i.inputs)for(var r=0;r<i.inputs.length;++r)this.highlighted_links[i.inputs[r].link]=!0;if(i.outputs)for(r=0;r<i.outputs.length;++r){var o=i.outputs[r];if(o.links)for(var s=0;s<o.links.length;++s)this.highlighted_links[o.links[s]]=!0}}}this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)},LGraphCanvas.prototype.deselectNode=function(t){if(t.is_selected){if(t.onDeselected&&t.onDeselected(),t.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(t),t.inputs)for(var e=0;e<t.inputs.length;++e)delete this.highlighted_links[t.inputs[e].link];if(t.outputs)for(e=0;e<t.outputs.length;++e){var n=t.outputs[e];if(n.links)for(var i=0;i<n.links.length;++i)delete this.highlighted_links[n.links[i]]}}},LGraphCanvas.prototype.deselectAllNodes=function(){if(this.graph){for(var t=this.graph._nodes,e=0,n=t.length;e<n;++e){var i=t[e];i.is_selected&&(i.onDeselected&&i.onDeselected(),i.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(i))}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)}},LGraphCanvas.prototype.deleteSelectedNodes=function(){for(var t in this.graph.beforeChange(),this.selected_nodes){var e=this.selected_nodes[t];if(!e.block_delete){if(e.inputs&&e.inputs.length&&e.outputs&&e.outputs.length&&LiteGraph.isValidConnection(e.inputs[0].type,e.outputs[0].type)&&e.inputs[0].link&&e.outputs[0].links&&e.outputs[0].links.length){var n=e.graph.links[e.inputs[0].link],i=e.graph.links[e.outputs[0].links[0]],r=e.getInputNode(0),o=e.getOutputNodes(0)[0];r&&o&&r.connect(n.origin_slot,o,i.target_slot)}this.graph.remove(e),this.onNodeDeselected&&this.onNodeDeselected(e)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()},LGraphCanvas.prototype.centerOnNode=function(t){this.ds.offset[0]=-t.pos[0]-.5*t.size[0]+.5*this.canvas.width/this.ds.scale,this.ds.offset[1]=-t.pos[1]-.5*t.size[1]+.5*this.canvas.height/this.ds.scale,this.setDirty(!0,!0)},LGraphCanvas.prototype.adjustMouseEvent=function(t){var e=0,n=0;if(this.canvas){var i=this.canvas.getBoundingClientRect();e=t.clientX-i.left,n=t.clientY-i.top}else e=t.clientX,n=t.clientY;this.last_mouse_position[0]=e,this.last_mouse_position[1]=n,t.canvasX=e/this.ds.scale-this.ds.offset[0],t.canvasY=n/this.ds.scale-this.ds.offset[1]},LGraphCanvas.prototype.setZoom=function(t,e){this.ds.changeScale(t,e),this.dirty_canvas=!0,this.dirty_bgcanvas=!0},LGraphCanvas.prototype.convertOffsetToCanvas=function(t,e){return this.ds.convertOffsetToCanvas(t,e)},LGraphCanvas.prototype.convertCanvasToOffset=function(t,e){return this.ds.convertCanvasToOffset(t,e)},LGraphCanvas.prototype.convertEventToCanvasOffset=function(t){var e=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([t.clientX-e.left,t.clientY-e.top])},LGraphCanvas.prototype.bringToFront=function(t){var e=this.graph._nodes.indexOf(t);-1!=e&&(this.graph._nodes.splice(e,1),this.graph._nodes.push(t))},LGraphCanvas.prototype.sendToBack=function(t){var e=this.graph._nodes.indexOf(t);-1!=e&&(this.graph._nodes.splice(e,1),this.graph._nodes.unshift(t))};var temp=new Float32Array(4);LGraphCanvas.prototype.computeVisibleNodes=function(t,e){var n=e||[];n.length=0;for(var i=0,r=(t=t||this.graph._nodes).length;i<r;++i){var o=t[i];(!this.live_mode||o.onDrawBackground||o.onDrawForeground)&&overlapBounding(this.visible_area,o.getBounding(temp,!0))&&n.push(o)}return n},LGraphCanvas.prototype.draw=function(t,e){if(this.canvas&&0!=this.canvas.width&&0!=this.canvas.height){var n=LiteGraph.getTime();this.render_time=.001*(n-this.last_draw_time),this.last_draw_time=n,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||e||this.always_render_background||this.graph&&this.graph._last_trigger_time&&n-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||t)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1}},LGraphCanvas.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var t=this.ctx;if(t){var e=this.canvas;t.start2D&&!this.viewport&&(t.start2D(),t.restore(),t.setTransform(1,0,0,1,0,0));var n=this.viewport||this.dirty_area;if(n&&(t.save(),t.beginPath(),t.rect(n[0],n[1],n[2],n[3]),t.clip()),this.clear_background&&(n?t.clearRect(n[0],n[1],n[2],n[3]):t.clearRect(0,0,e.width,e.height)),this.bgcanvas==this.canvas?this.drawBackCanvas():t.drawImage(this.bgcanvas,0,0),this.onRender&&this.onRender(e,t),this.show_info&&this.renderInfo(t,n?n[0]:0,n?n[1]:0),this.graph){t.save(),this.ds.toCanvasContext(t);for(var i=this.computeVisibleNodes(null,this.visible_nodes),r=0;r<i.length;++r){var o=i[r];t.save(),t.translate(o.pos[0],o.pos[1]),this.drawNode(o,t),t.restore()}if(this.render_execution_order&&this.drawExecutionOrder(t),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(t)),null!=this.connecting_pos){t.lineWidth=this.connections_width;var s=null,a=this.connecting_output||this.connecting_input,u=a.type,l=a.dir;null==l&&(l=this.connecting_output?this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var p=a.shape;if(s=u===LiteGraph.EVENT?LiteGraph.EVENT_LINK_COLOR:LiteGraph.CONNECTING_LINK_COLOR,this.renderLink(t,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,s,l,LiteGraph.CENTER),t.beginPath(),u===LiteGraph.EVENT||p===LiteGraph.BOX_SHAPE?(t.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),t.fill(),t.beginPath(),t.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):p===LiteGraph.ARROW_SHAPE?(t.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),t.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),t.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),t.closePath()):(t.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,2*Math.PI)),t.fill(),t.fillStyle="#ffcc00",this._highlight_input){t.beginPath();var h=this._highlight_input_slot.shape;h===LiteGraph.ARROW_SHAPE?(t.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),t.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),t.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),t.closePath()):t.arc(this._highlight_input[0],this._highlight_input[1],6,0,2*Math.PI),t.fill()}this._highlight_output&&(t.beginPath(),h===LiteGraph.ARROW_SHAPE?(t.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),t.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),t.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),t.closePath()):t.arc(this._highlight_output[0],this._highlight_output[1],6,0,2*Math.PI),t.fill())}this.dragging_rectangle&&(t.strokeStyle="#FFF",t.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(t,this.over_link_center):this.onDrawLinkTooltip&&this.onDrawLinkTooltip(t,null),this.onDrawForeground&&this.onDrawForeground(t,this.visible_rect),t.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(t),this.onDrawOverlay&&this.onDrawOverlay(t),n&&t.restore(),t.finish2D&&t.finish2D()}},LGraphCanvas.prototype.drawSubgraphPanel=function(t){var e=this.graph,n=e._subgraph_node;n?(this.drawSubgraphPanelLeft(e,n,t),this.drawSubgraphPanelRight(e,n,t)):console.warn("subgraph without subnode")},LGraphCanvas.prototype.drawSubgraphPanelLeft=function(t,e,n){var i=e.inputs?e.inputs.length:0,r=Math.floor(1.6*LiteGraph.NODE_SLOT_HEIGHT);if(n.fillStyle="#111",n.globalAlpha=.8,n.beginPath(),n.roundRect(10,10,200,(i+1)*r+50,[8]),n.fill(),n.globalAlpha=1,n.fillStyle="#888",n.font="14px Arial",n.textAlign="left",n.fillText("Graph Inputs",20,34),this.drawButton(180,20,20,20,"X","#151515"))this.closeSubgraph();else{var o=50;if(n.font="14px Arial",e.inputs)for(var s=0;s<e.inputs.length;++s){var a=e.inputs[s];if(!a.not_subgraph_input){if(this.drawButton(20,o+2,180,r-2)){var u=e.constructor.input_node_type||"graph/input";this.graph.beforeChange();var l=LiteGraph.createNode(u);l?(t.add(l),this.block_click=!1,this.last_click_position=null,this.selectNodes([l]),this.node_dragged=l,this.dragging_canvas=!1,l.setProperty("name",a.name),l.setProperty("type",a.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",u)}n.fillStyle="#9C9",n.beginPath(),n.arc(184,o+.5*r,5,0,2*Math.PI),n.fill(),n.fillStyle="#AAA",n.fillText(a.name,30,o+.75*r),n.fillStyle="#777",n.fillText(a.type,130,o+.75*r),o+=r}}this.drawButton(20,o+2,180,r-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(e)}},LGraphCanvas.prototype.drawSubgraphPanelRight=function(t,e,n){var i=e.outputs?e.outputs.length:0,r=this.bgcanvas.width,o=200,s=Math.floor(1.6*LiteGraph.NODE_SLOT_HEIGHT);n.fillStyle="#111",n.globalAlpha=.8,n.beginPath(),n.roundRect(r-o-10,10,o,(i+1)*s+50,[8]),n.fill(),n.globalAlpha=1,n.fillStyle="#888",n.font="14px Arial",n.textAlign="left";var a="Graph Outputs",u=n.measureText(a).width;if(n.fillText(a,r-u-20,34),this.drawButton(r-o,20,20,20,"X","#151515"))this.closeSubgraph();else{var l=50;if(n.font="14px Arial",e.outputs)for(var p=0;p<e.outputs.length;++p){var h=e.outputs[p];if(!h.not_subgraph_input){if(this.drawButton(r-o,l+2,180,s-2)){var c=e.constructor.output_node_type||"graph/output";this.graph.beforeChange();var d=LiteGraph.createNode(c);d?(t.add(d),this.block_click=!1,this.last_click_position=null,this.selectNodes([d]),this.node_dragged=d,this.dragging_canvas=!1,d.setProperty("name",h.name),d.setProperty("type",h.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",c)}n.fillStyle="#9C9",n.beginPath(),n.arc(r-o+16,l+.5*s,5,0,2*Math.PI),n.fill(),n.fillStyle="#AAA",n.fillText(h.name,r-o+30,l+.75*s),n.fillStyle="#777",n.fillText(h.type,r-o+130,l+.75*s),l+=s}}this.drawButton(r-o,l+2,180,s-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(e)}},LGraphCanvas.prototype.drawButton=function(t,e,n,i,r,o,s,a){var u=this.ctx;o=o||LiteGraph.NODE_DEFAULT_COLOR,s=s||"#555",a=a||LiteGraph.NODE_TEXT_COLOR;var l=this.ds.convertOffsetToCanvas(this.graph_mouse),p=LiteGraph.isInsideRectangle(l[0],l[1],t,e,n,i);if(l=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null){var h=this.canvas.getBoundingClientRect();l[0]-=h.left,l[1]-=h.top}var c=l&&LiteGraph.isInsideRectangle(l[0],l[1],t,e,n,i);u.fillStyle=p?s:o,c&&(u.fillStyle="#AAA"),u.beginPath(),u.roundRect(t,e,n,i,[4]),u.fill(),null!=r&&r.constructor==String&&(u.fillStyle=a,u.textAlign="center",u.font=(.65*i|0)+"px Arial",u.fillText(r,t+.5*n,e+.75*i),u.textAlign="left");var d=c&&!this.block_click;return c&&this.blockClick(),d},LGraphCanvas.prototype.isAreaClicked=function(t,e,n,i,r){var o=this.mouse,s=(LiteGraph.isInsideRectangle(o[0],o[1],t,e,n,i),(o=this.last_click_position)&&LiteGraph.isInsideRectangle(o[0],o[1],t,e,n,i)),a=s&&!this.block_click;return s&&r&&this.blockClick(),a},LGraphCanvas.prototype.renderInfo=function(t,e,n){e=e||10,n=n||this.canvas.height-80,t.save(),t.translate(e,n),t.font="10px Arial",t.fillStyle="#888",t.textAlign="left",this.graph?(t.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),t.fillText("I: "+this.graph.iteration,5,26),t.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),t.fillText("V: "+this.graph._version,5,52),t.fillText("FPS:"+this.fps.toFixed(2),5,65)):t.fillText("No graph selected",5,13),t.restore()},LGraphCanvas.prototype.drawBackCanvas=function(){var t=this.bgcanvas;t.width==this.canvas.width&&t.height==this.canvas.height||(t.width=this.canvas.width,t.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var e=this.bgctx;e.start&&e.start();var n=this.viewport||[0,0,e.canvas.width,e.canvas.height];if(this.clear_background&&e.clearRect(n[0],n[1],n[2],n[3]),this._graph_stack&&this._graph_stack.length){e.save(),this._graph_stack[this._graph_stack.length-1];var i=this.graph._subgraph_node;e.strokeStyle=i.bgcolor,e.lineWidth=10,e.strokeRect(1,1,t.width-2,t.height-2),e.lineWidth=1,e.font="40px Arial",e.textAlign="center",e.fillStyle=i.bgcolor||"#AAA";for(var r="",o=1;o<this._graph_stack.length;++o)r+=this._graph_stack[o]._subgraph_node.getTitle()+" >> ";e.fillText(r+i.getTitle(),.5*t.width,40),e.restore()}var s=!1;if(this.onRenderBackground&&(s=this.onRenderBackground(t,e)),this.viewport||(e.restore(),e.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(e.save(),this.ds.toCanvasContext(e),this.ds.scale<1.5&&!s&&this.clear_background_color&&(e.fillStyle=this.clear_background_color,e.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!s){if(this.zoom_modify_alpha?e.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:e.globalAlpha=this.editor_alpha,e.imageSmoothingEnabled=e.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var a=this;this._bg_img.onload=function(){a.draw(!0,!0)}}var u=null;null==this._pattern&&this._bg_img.width>0?(u=e.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=u):u=this._pattern,u&&(e.fillStyle=u,e.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),e.fillStyle="transparent"),e.globalAlpha=1,e.imageSmoothingEnabled=e.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(t,e),this.onDrawBackground&&this.onDrawBackground(e,this.visible_area),this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(e.strokeStyle="#235",e.strokeRect(0,0,t.width,t.height)),this.render_connections_shadows?(e.shadowColor="#000",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=6):e.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(e),e.shadowColor="rgba(0,0,0,0)",e.restore()}e.finish&&e.finish(),this.dirty_bgcanvas=!1,this.dirty_canvas=!0};var temp_vec2=new Float32Array(2);LGraphCanvas.prototype.drawNode=function(t,e){this.current_node=t;var n=t.color||t.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,i=t.bgcolor||t.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR;t.mouseOver;var r=this.ds.scale<.6;if(this.live_mode)t.flags.collapsed||(e.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(e,this,this.canvas));else{var o=this.editor_alpha;if(e.globalAlpha=o,this.render_shadows&&!r?(e.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,e.shadowOffsetX=2*this.ds.scale,e.shadowOffsetY=2*this.ds.scale,e.shadowBlur=3*this.ds.scale):e.shadowColor="transparent",!t.flags.collapsed||!t.onDrawCollapsed||1!=t.onDrawCollapsed(e,this)){var s=t._shape||LiteGraph.BOX_SHAPE,a=temp_vec2;temp_vec2.set(t.size);var u=t.horizontal;if(t.flags.collapsed){e.font=this.inner_text_font;var l=t.getTitle?t.getTitle():t.title;null!=l&&(t._collapsed_width=Math.min(t.size[0],e.measureText(l).width+2*LiteGraph.NODE_TITLE_HEIGHT),a[0]=t._collapsed_width,a[1]=0)}t.clip_area&&(e.save(),e.beginPath(),s==LiteGraph.BOX_SHAPE?e.rect(0,0,a[0],a[1]):s==LiteGraph.ROUND_SHAPE?e.roundRect(0,0,a[0],a[1],[10]):s==LiteGraph.CIRCLE_SHAPE&&e.arc(.5*a[0],.5*a[1],.5*a[0],0,2*Math.PI),e.clip()),t.has_errors&&(i="red"),this.drawNodeShape(t,e,a,n,i,t.is_selected,t.mouseOver),e.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(e,this,this.canvas),e.textAlign=u?"center":"left",e.font=this.inner_text_font;var p=!r,h=this.connecting_output,c=this.connecting_input;e.lineWidth=1;var d=0,f=new Float32Array(2);if(t.flags.collapsed){if(this.render_collapsed_slots){var g=null,_=null;if(t.inputs)for(y=0;y<t.inputs.length;y++)if(null!=(w=t.inputs[y]).link){g=w;break}if(t.outputs)for(y=0;y<t.outputs.length;y++)(w=t.outputs[y]).links&&w.links.length&&(_=w);if(g){var v=0,m=-.5*LiteGraph.NODE_TITLE_HEIGHT;u&&(v=.5*t._collapsed_width,m=-LiteGraph.NODE_TITLE_HEIGHT),e.fillStyle="#686",e.beginPath(),w.type===LiteGraph.EVENT||w.shape===LiteGraph.BOX_SHAPE?e.rect(v-7+.5,m-4,14,8):w.shape===LiteGraph.ARROW_SHAPE?(e.moveTo(v+8,m),e.lineTo(v+-4,m-4),e.lineTo(v+-4,m+4),e.closePath()):e.arc(v,m,4,0,2*Math.PI),e.fill()}_&&(v=t._collapsed_width,m=-.5*LiteGraph.NODE_TITLE_HEIGHT,u&&(v=.5*t._collapsed_width,m=0),e.fillStyle="#686",e.strokeStyle="black",e.beginPath(),w.type===LiteGraph.EVENT||w.shape===LiteGraph.BOX_SHAPE?e.rect(v-7+.5,m-4,14,8):w.shape===LiteGraph.ARROW_SHAPE?(e.moveTo(v+6,m),e.lineTo(v-6,m-4),e.lineTo(v-6,m+4),e.closePath()):e.arc(v,m,4,0,2*Math.PI),e.fill())}}else{if(t.inputs)for(var y=0;y<t.inputs.length;y++){var b=(w=t.inputs[y]).type,x=w.shape;e.globalAlpha=o,this.connecting_output&&!LiteGraph.isValidConnection(w.type,h.type)&&(e.globalAlpha=.4*o),e.fillStyle=null!=w.link?w.color_on||this.default_connection_color_byType[b]||this.default_connection_color.input_on:w.color_off||this.default_connection_color_byTypeOff[b]||this.default_connection_color_byType[b]||this.default_connection_color.input_off,(E=t.getConnectionPos(!0,y,f))[0]-=t.pos[0],E[1]-=t.pos[1],d<E[1]+.5*LiteGraph.NODE_SLOT_HEIGHT&&(d=E[1]+.5*LiteGraph.NODE_SLOT_HEIGHT),e.beginPath(),"array"==b&&(x=LiteGraph.GRID_SHAPE);var A=!0;w.type===LiteGraph.EVENT||w.shape===LiteGraph.BOX_SHAPE?u?e.rect(E[0]-5+.5,E[1]-8+.5,10,14):e.rect(E[0]-6+.5,E[1]-5+.5,14,10):x===LiteGraph.ARROW_SHAPE?(e.moveTo(E[0]+8,E[1]+.5),e.lineTo(E[0]-4,E[1]+6+.5),e.lineTo(E[0]-4,E[1]-6+.5),e.closePath()):x===LiteGraph.GRID_SHAPE?(e.rect(E[0]-4,E[1]-4,2,2),e.rect(E[0]-1,E[1]-4,2,2),e.rect(E[0]+2,E[1]-4,2,2),e.rect(E[0]-4,E[1]-1,2,2),e.rect(E[0]-1,E[1]-1,2,2),e.rect(E[0]+2,E[1]-1,2,2),e.rect(E[0]-4,E[1]+2,2,2),e.rect(E[0]-1,E[1]+2,2,2),e.rect(E[0]+2,E[1]+2,2,2),A=!1):r?e.rect(E[0]-4,E[1]-4,8,8):e.arc(E[0],E[1],4,0,2*Math.PI),e.fill(),p&&(C=null!=w.label?w.label:w.name)&&(e.fillStyle=LiteGraph.NODE_TEXT_COLOR,u||w.dir==LiteGraph.UP?e.fillText(C,E[0],E[1]-10):e.fillText(C,E[0]+10,E[1]+5))}if(e.textAlign=u?"center":"right",e.strokeStyle="black",t.outputs)for(y=0;y<t.outputs.length;y++){var w,E,C;b=(w=t.outputs[y]).type,x=w.shape,this.connecting_input&&!LiteGraph.isValidConnection(b,c.type)&&(e.globalAlpha=.4*o),(E=t.getConnectionPos(!1,y,f))[0]-=t.pos[0],E[1]-=t.pos[1],d<E[1]+.5*LiteGraph.NODE_SLOT_HEIGHT&&(d=E[1]+.5*LiteGraph.NODE_SLOT_HEIGHT),e.fillStyle=w.links&&w.links.length?w.color_on||this.default_connection_color_byType[b]||this.default_connection_color.output_on:w.color_off||this.default_connection_color_byTypeOff[b]||this.default_connection_color_byType[b]||this.default_connection_color.output_off,e.beginPath(),"array"==b&&(x=LiteGraph.GRID_SHAPE),A=!0,b===LiteGraph.EVENT||x===LiteGraph.BOX_SHAPE?u?e.rect(E[0]-5+.5,E[1]-8+.5,10,14):e.rect(E[0]-6+.5,E[1]-5+.5,14,10):x===LiteGraph.ARROW_SHAPE?(e.moveTo(E[0]+8,E[1]+.5),e.lineTo(E[0]-4,E[1]+6+.5),e.lineTo(E[0]-4,E[1]-6+.5),e.closePath()):x===LiteGraph.GRID_SHAPE?(e.rect(E[0]-4,E[1]-4,2,2),e.rect(E[0]-1,E[1]-4,2,2),e.rect(E[0]+2,E[1]-4,2,2),e.rect(E[0]-4,E[1]-1,2,2),e.rect(E[0]-1,E[1]-1,2,2),e.rect(E[0]+2,E[1]-1,2,2),e.rect(E[0]-4,E[1]+2,2,2),e.rect(E[0]-1,E[1]+2,2,2),e.rect(E[0]+2,E[1]+2,2,2),A=!1):r?e.rect(E[0]-4,E[1]-4,8,8):e.arc(E[0],E[1],4,0,2*Math.PI),e.fill(),!r&&A&&e.stroke(),p&&(C=null!=w.label?w.label:w.name)&&(e.fillStyle=LiteGraph.NODE_TEXT_COLOR,u||w.dir==LiteGraph.DOWN?e.fillText(C,E[0],E[1]-8):e.fillText(C,E[0]-10,E[1]+5))}if(e.textAlign="left",e.globalAlpha=1,t.widgets){var T=d;(u||t.widgets_up)&&(T=2),null!=t.widgets_start_y&&(T=t.widgets_start_y),this.drawNodeWidgets(t,T,e,this.node_widget&&this.node_widget[0]==t?this.node_widget[1]:null)}}t.clip_area&&e.restore(),e.globalAlpha=1}}},LGraphCanvas.prototype.drawLinkTooltip=function(t,e){var n=e._pos;if(t.fillStyle="black",t.beginPath(),t.arc(n[0],n[1],3,0,2*Math.PI),t.fill(),null!=e.data&&(!this.onDrawLinkTooltip||1!=this.onDrawLinkTooltip(t,e,this))){var i=e.data,r=null;if(null!=(r=i.constructor===Number?i.toFixed(2):i.constructor===String?'"'+i+'"':i.constructor===Boolean?String(i):i.toToolTip?i.toToolTip():"["+i.constructor.name+"]")){r=r.substr(0,30),t.font="14px Courier New";var o=t.measureText(r).width+20;t.shadowColor="black",t.shadowOffsetX=2,t.shadowOffsetY=2,t.shadowBlur=3,t.fillStyle="#454",t.beginPath(),t.roundRect(n[0]-.5*o,n[1]-15-24,o,24,[3]),t.moveTo(n[0]-10,n[1]-15),t.lineTo(n[0]+10,n[1]-15),t.lineTo(n[0],n[1]-5),t.fill(),t.shadowColor="transparent",t.textAlign="center",t.fillStyle="#CEC",t.fillText(r,n[0],n[1]-15-24*.3)}}};var tmp_area=new Float32Array(4);LGraphCanvas.prototype.drawNodeShape=function(t,e,n,i,r,o,s){e.strokeStyle=i,e.fillStyle=r;var a=LiteGraph.NODE_TITLE_HEIGHT,u=this.ds.scale<.5,l=t._shape||t.constructor.shape||LiteGraph.ROUND_SHAPE,p=t.constructor.title_mode,h=!0;p==LiteGraph.TRANSPARENT_TITLE||p==LiteGraph.NO_TITLE?h=!1:p==LiteGraph.AUTOHIDE_TITLE&&s&&(h=!0);var c=tmp_area;c[0]=0,c[1]=h?-a:0,c[2]=n[0]+1,c[3]=h?n[1]+a:n[1];var d=e.globalAlpha;if(e.beginPath(),l==LiteGraph.BOX_SHAPE||u?e.fillRect(c[0],c[1],c[2],c[3]):l==LiteGraph.ROUND_SHAPE||l==LiteGraph.CARD_SHAPE?e.roundRect(c[0],c[1],c[2],c[3],l==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):l==LiteGraph.CIRCLE_SHAPE&&e.arc(.5*n[0],.5*n[1],.5*n[0],0,2*Math.PI),e.fill(),!t.flags.collapsed&&h&&(e.shadowColor="transparent",e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(0,-1,c[2],2)),e.shadowColor="transparent",t.onDrawBackground&&t.onDrawBackground(e,this,this.canvas,this.graph_mouse),h||p==LiteGraph.TRANSPARENT_TITLE){if(t.onDrawTitleBar)t.onDrawTitleBar(e,a,n,this.ds.scale,i);else if(p!=LiteGraph.TRANSPARENT_TITLE&&(t.constructor.title_color||this.render_title_colored)){var f=t.constructor.title_color||i;if(t.flags.collapsed&&(e.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients){var g=LGraphCanvas.gradients[f];g||((g=LGraphCanvas.gradients[f]=e.createLinearGradient(0,0,400,0)).addColorStop(0,f),g.addColorStop(1,"#000")),e.fillStyle=g}else e.fillStyle=f;e.beginPath(),l==LiteGraph.BOX_SHAPE||u?e.rect(0,-a,n[0]+1,a):l!=LiteGraph.ROUND_SHAPE&&l!=LiteGraph.CARD_SHAPE||e.roundRect(0,-a,n[0]+1,a,t.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),e.fill(),e.shadowColor="transparent"}var _=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[t.mode]&&(_=LiteGraph.NODE_MODES_COLORS[t.mode]),LiteGraph.node_box_coloured_when_on&&(_=t.action_triggered?"#FFF":t.execute_triggered?"#AAA":_);var v=10;if(t.onDrawTitleBox?t.onDrawTitleBox(e,a,n,this.ds.scale):l==LiteGraph.ROUND_SHAPE||l==LiteGraph.CIRCLE_SHAPE||l==LiteGraph.CARD_SHAPE?(u&&(e.fillStyle="black",e.beginPath(),e.arc(.5*a,-.5*a,6,0,2*Math.PI),e.fill()),e.fillStyle=t.boxcolor||_||LiteGraph.NODE_DEFAULT_BOXCOLOR,u?e.fillRect(.5*a-5,-.5*a-5,v,v):(e.beginPath(),e.arc(.5*a,-.5*a,5,0,2*Math.PI),e.fill())):(u&&(e.fillStyle="black",e.fillRect(.5*(a-v)-1,-.5*(a+v)-1,12,12)),e.fillStyle=t.boxcolor||_||LiteGraph.NODE_DEFAULT_BOXCOLOR,e.fillRect(.5*(a-v),-.5*(a+v),v,v)),e.globalAlpha=d,t.onDrawTitleText&&t.onDrawTitleText(e,a,n,this.ds.scale,this.title_text_font,o),!u){e.font=this.title_text_font;var m=String(t.getTitle());m&&(e.fillStyle=o?LiteGraph.NODE_SELECTED_TITLE_COLOR:t.constructor.title_text_color||this.node_title_color,t.flags.collapsed?(e.textAlign="left",e.measureText(m),e.fillText(m.substr(0,20),a,LiteGraph.NODE_TITLE_TEXT_Y-a),e.textAlign="left"):(e.textAlign="left",e.fillText(m,a,LiteGraph.NODE_TITLE_TEXT_Y-a)))}if(!t.flags.collapsed&&t.subgraph&&!t.skip_subgraph_button){var y=LiteGraph.NODE_TITLE_HEIGHT,b=t.size[0]-y,x=LiteGraph.isInsideRectangle(this.graph_mouse[0]-t.pos[0],this.graph_mouse[1]-t.pos[1],b+2,2-y,y-4,y-4);e.fillStyle=x?"#888":"#555",l==LiteGraph.BOX_SHAPE||u?e.fillRect(b+2,2-y,y-4,y-4):(e.beginPath(),e.roundRect(b+2,2-y,y-4,y-4,[4]),e.fill()),e.fillStyle="#333",e.beginPath(),e.moveTo(b+.2*y,.6*-y),e.lineTo(b+.8*y,.6*-y),e.lineTo(b+.5*y,.3*-y),e.fill()}t.onDrawTitle&&t.onDrawTitle(e)}o&&(t.onBounding&&t.onBounding(c),p==LiteGraph.TRANSPARENT_TITLE&&(c[1]-=a,c[3]+=a),e.lineWidth=1,e.globalAlpha=.8,e.beginPath(),l==LiteGraph.BOX_SHAPE?e.rect(-6+c[0],-6+c[1],12+c[2],12+c[3]):l==LiteGraph.ROUND_SHAPE||l==LiteGraph.CARD_SHAPE&&t.flags.collapsed?e.roundRect(-6+c[0],-6+c[1],12+c[2],12+c[3],[2*this.round_radius]):l==LiteGraph.CARD_SHAPE?e.roundRect(-6+c[0],-6+c[1],12+c[2],12+c[3],[2*this.round_radius,2,2*this.round_radius,2]):l==LiteGraph.CIRCLE_SHAPE&&e.arc(.5*n[0],.5*n[1],.5*n[0]+6,0,2*Math.PI),e.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,e.stroke(),e.strokeStyle=i,e.globalAlpha=1),t.execute_triggered>0&&t.execute_triggered--,t.action_triggered>0&&t.action_triggered--};var margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);function compareObjects(t,e){for(var n in t)if(t[n]!=e[n])return!1;return!0}function distance(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}function colorToString(t){return"rgba("+Math.round(255*t[0]).toFixed()+","+Math.round(255*t[1]).toFixed()+","+Math.round(255*t[2]).toFixed()+","+(4==t.length?t[3].toFixed(2):"1.0")+")"}function isInsideRectangle(t,e,n,i,r,o){return n<t&&n+r>t&&i<e&&i+o>e}function growBounding(t,e,n){e<t[0]?t[0]=e:e>t[2]&&(t[2]=e),n<t[1]?t[1]=n:n>t[3]&&(t[3]=n)}function isInsideBounding(t,e){return!(t[0]<e[0][0]||t[1]<e[0][1]||t[0]>e[1][0]||t[1]>e[1][1])}function overlapBounding(t,e){var n=t[0]+t[2],i=t[1]+t[3],r=e[0]+e[2],o=e[1]+e[3];return!(t[0]>r||t[1]>o||n<e[0]||i<e[1])}function hex2num(t){"#"==t.charAt(0)&&(t=t.slice(1)),t=t.toUpperCase();for(var e,n,i="0123456789ABCDEF",r=new Array(3),o=0,s=0;s<6;s+=2)e=i.indexOf(t.charAt(s)),n=i.indexOf(t.charAt(s+1)),r[o]=16*e+n,o++;return r}function num2hex(t){for(var e,n,i="0123456789ABCDEF",r="#",o=0;o<3;o++)e=t[o]/16,n=t[o]%16,r+=i.charAt(e)+i.charAt(n);return r}function ContextMenu(t,e){e=e||{},this.options=e;var n=this;e.parentMenu&&(e.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),e.parentMenu=null):(this.parentMenu=e.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this));var i=null;e.event&&(i=e.event.constructor.name),"MouseEvent"!==i&&"CustomEvent"!==i&&"PointerEvent"!==i&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. ("+i+")"),e.event=null);var r=document.createElement("div");function o(t){var n=parseInt(r.style.top);return r.style.top=(n+t.deltaY*e.scroll_speed).toFixed()+"px",t.preventDefault(),!0}if(r.className="litegraph litecontextmenu litemenubar-panel",e.className&&(r.className+=" "+e.className),r.style.minWidth=100,r.style.minHeight=100,r.style.pointerEvents="none",setTimeout((function(){r.style.pointerEvents="auto"}),100),LiteGraph.pointerListenerAdd(r,"up",(function(t){return t.preventDefault(),!0}),!0),r.addEventListener("contextmenu",(function(t){return 2!=t.button||t.preventDefault(),!1}),!0),LiteGraph.pointerListenerAdd(r,"down",(function(t){if(2==t.button)return n.close(),t.preventDefault(),!0}),!0),e.scroll_speed||(e.scroll_speed=.1),r.addEventListener("wheel",o,!0),r.addEventListener("mousewheel",o,!0),this.root=r,e.title){var s=document.createElement("div");s.className="litemenu-title",s.innerHTML=e.title,r.appendChild(s)}for(var a=0;a<t.length;a++){var u=t.constructor==Array?t[a]:a;null!=u&&u.constructor!==String&&(u=void 0===u.content?String(u):u.content);var l=t[a];this.addItem(u,l,e)}LiteGraph.pointerListenerAdd(r,"enter",(function(t){r.closing_timer&&clearTimeout(r.closing_timer)}));var p=document;e.event&&(p=e.event.target.ownerDocument),p||(p=document),p.fullscreenElement?p.fullscreenElement.appendChild(r):p.body.appendChild(r);var h=e.left||0,c=e.top||0;if(e.event){if(h=e.event.clientX-10,c=e.event.clientY-10,e.title&&(c-=20),e.parentMenu){var d=e.parentMenu.root.getBoundingClientRect();h=d.left+d.width}var f=document.body.getBoundingClientRect(),g=r.getBoundingClientRect();0==f.height&&console.error("document.body height is 0. That is dangerous, set html,body { height: 100%; }"),f.width&&h>f.width-g.width-10&&(h=f.width-g.width-10),f.height&&c>f.height-g.height-10&&(c=f.height-g.height-10)}r.style.left=h+"px",r.style.top=c+"px",e.scale&&(r.style.transform="scale("+e.scale+")")}function CurveEditor(t){this.points=t,this.selected=-1,this.nearest=-1,this.size=null,this.must_update=!0,this.margin=5}function clamp(t,e,n){return e>t?e:n<t?n:t}LGraphCanvas.prototype.drawConnections=function(t){var e=LiteGraph.getTime(),n=this.visible_area;margin_area[0]=n[0]-20,margin_area[1]=n[1]-20,margin_area[2]=n[2]+40,margin_area[3]=n[3]+40,t.lineWidth=this.connections_width,t.fillStyle="#AAA",t.strokeStyle="#AAA",t.globalAlpha=this.editor_alpha;for(var i=this.graph._nodes,r=0,o=i.length;r<o;++r){var s=i[r];if(s.inputs&&s.inputs.length)for(var a=0;a<s.inputs.length;++a){var u=s.inputs[a];if(u&&null!=u.link){var l=u.link,p=this.graph.links[l];if(p){var h=this.graph.getNodeById(p.origin_id);if(null!=h){var c,d=p.origin_slot;c=-1==d?[h.pos[0]+10,h.pos[1]+10]:h.getConnectionPos(!1,d,tempA);var f=s.getConnectionPos(!0,a,tempB);if(link_bounding[0]=c[0],link_bounding[1]=c[1],link_bounding[2]=f[0]-c[0],link_bounding[3]=f[1]-c[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),overlapBounding(link_bounding,margin_area)){var g=h.outputs[d],_=s.inputs[a];if(g&&_){var v=g.dir||(h.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),m=_.dir||(s.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink(t,c,f,p,!1,0,null,v,m),p&&p._last_time&&e-p._last_time<1e3){var y=2-.002*(e-p._last_time),b=t.globalAlpha;t.globalAlpha=b*y,this.renderLink(t,c,f,p,!0,y,"white",v,m),t.globalAlpha=b}}}}}}}}t.globalAlpha=1},LGraphCanvas.prototype.renderLink=function(t,e,n,i,r,o,s,a,u,l){i&&this.visible_links.push(i),!s&&i&&(s=i.color||LGraphCanvas.link_type_colors[i.type]),s||(s=this.default_link_color),null!=i&&this.highlighted_links[i.id]&&(s="#FFF"),a=a||LiteGraph.RIGHT,u=u||LiteGraph.LEFT;var p=distance(e,n);this.render_connections_border&&this.ds.scale>.6&&(t.lineWidth=this.connections_width+4),t.lineJoin="round",(l=l||1)>1&&(t.lineWidth=.5),t.beginPath();for(var h=0;h<l;h+=1){var c=5*(h-.5*(l-1));if(this.links_render_mode==LiteGraph.SPLINE_LINK){t.moveTo(e[0],e[1]+c);var d=0,f=0,g=0,_=0;switch(a){case LiteGraph.LEFT:d=-.25*p;break;case LiteGraph.RIGHT:d=.25*p;break;case LiteGraph.UP:f=-.25*p;break;case LiteGraph.DOWN:f=.25*p}switch(u){case LiteGraph.LEFT:g=-.25*p;break;case LiteGraph.RIGHT:g=.25*p;break;case LiteGraph.UP:_=-.25*p;break;case LiteGraph.DOWN:_=.25*p}t.bezierCurveTo(e[0]+d,e[1]+f+c,n[0]+g,n[1]+_+c,n[0],n[1]+c)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){switch(t.moveTo(e[0],e[1]+c),d=0,f=0,g=0,_=0,a){case LiteGraph.LEFT:d=-1;break;case LiteGraph.RIGHT:d=1;break;case LiteGraph.UP:f=-1;break;case LiteGraph.DOWN:f=1}switch(u){case LiteGraph.LEFT:g=-1;break;case LiteGraph.RIGHT:g=1;break;case LiteGraph.UP:_=-1;break;case LiteGraph.DOWN:_=1}t.lineTo(e[0]+15*d,e[1]+15*f+c),t.lineTo(n[0]+15*g,n[1]+15*_+c),t.lineTo(n[0],n[1]+c)}else{if(this.links_render_mode!=LiteGraph.STRAIGHT_LINK)return;t.moveTo(e[0],e[1]);var v=e[0],m=e[1],y=n[0],b=n[1];a==LiteGraph.RIGHT?v+=10:m+=10,u==LiteGraph.LEFT?y-=10:b-=10,t.lineTo(v,m),t.lineTo(.5*(v+y),m),t.lineTo(.5*(v+y),b),t.lineTo(y,b),t.lineTo(n[0],n[1])}}this.render_connections_border&&this.ds.scale>.6&&!r&&(t.strokeStyle="rgba(0,0,0,0.5)",t.stroke()),t.lineWidth=this.connections_width,t.fillStyle=t.strokeStyle=s,t.stroke();var x=this.computeConnectionPoint(e,n,.5,a,u);if(i&&i._pos&&(i._pos[0]=x[0],i._pos[1]=x[1]),this.ds.scale>=.6&&this.highquality_render&&u!=LiteGraph.CENTER){if(this.render_connection_arrows){var A=this.computeConnectionPoint(e,n,.25,a,u),w=this.computeConnectionPoint(e,n,.26,a,u),E=this.computeConnectionPoint(e,n,.75,a,u),C=this.computeConnectionPoint(e,n,.76,a,u),T=0,O=0;this.render_curved_connections?(T=-Math.atan2(w[0]-A[0],w[1]-A[1]),O=-Math.atan2(C[0]-E[0],C[1]-E[1])):O=T=n[1]>e[1]?0:Math.PI,t.save(),t.translate(A[0],A[1]),t.rotate(T),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.restore(),t.save(),t.translate(E[0],E[1]),t.rotate(O),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.restore()}t.beginPath(),t.arc(x[0],x[1],5,0,2*Math.PI),t.fill()}if(o)for(t.fillStyle=s,h=0;h<5;++h){var S=(.001*LiteGraph.getTime()+.2*h)%1;x=this.computeConnectionPoint(e,n,S,a,u),t.beginPath(),t.arc(x[0],x[1],5,0,2*Math.PI),t.fill()}},LGraphCanvas.prototype.computeConnectionPoint=function(t,e,n,i,r){i=i||LiteGraph.RIGHT,r=r||LiteGraph.LEFT;var o=distance(t,e),s=t,a=[t[0],t[1]],u=[e[0],e[1]],l=e;switch(i){case LiteGraph.LEFT:a[0]+=-.25*o;break;case LiteGraph.RIGHT:a[0]+=.25*o;break;case LiteGraph.UP:a[1]+=-.25*o;break;case LiteGraph.DOWN:a[1]+=.25*o}switch(r){case LiteGraph.LEFT:u[0]+=-.25*o;break;case LiteGraph.RIGHT:u[0]+=.25*o;break;case LiteGraph.UP:u[1]+=-.25*o;break;case LiteGraph.DOWN:u[1]+=.25*o}var p=(1-n)*(1-n)*(1-n),h=(1-n)*(1-n)*3*n,c=3*(1-n)*(n*n),d=n*n*n;return[p*s[0]+h*a[0]+c*u[0]+d*l[0],p*s[1]+h*a[1]+c*u[1]+d*l[1]]},LGraphCanvas.prototype.drawExecutionOrder=function(t){t.shadowColor="transparent",t.globalAlpha=.25,t.textAlign="center",t.strokeStyle="white",t.globalAlpha=.75;for(var e=this.visible_nodes,n=0;n<e.length;++n){var i=e[n];t.fillStyle="black",t.fillRect(i.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,i.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),0==i.order&&t.strokeRect(i.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,i.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),t.fillStyle="#FFF",t.fillText(i.order,i.pos[0]+-.5*LiteGraph.NODE_TITLE_HEIGHT,i.pos[1]-6)}t.globalAlpha=1},LGraphCanvas.prototype.drawNodeWidgets=function(t,e,n,i){if(!t.widgets||!t.widgets.length)return 0;var r=t.size[0],o=t.widgets;e+=2;var s=LiteGraph.NODE_WIDGET_HEIGHT,a=this.ds.scale>.5;n.save(),n.globalAlpha=this.editor_alpha;for(var u=LiteGraph.WIDGET_OUTLINE_COLOR,l=LiteGraph.WIDGET_BGCOLOR,p=LiteGraph.WIDGET_TEXT_COLOR,h=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,c=15,d=0;d<o.length;++d){var f=o[d],g=e;f.y&&(g=f.y),f.last_y=g,n.strokeStyle=u,n.fillStyle="#222",n.textAlign="left",f.disabled&&(n.globalAlpha*=.5);var _=f.width||r;switch(f.type){case"button":f.clicked&&(n.fillStyle="#AAA",f.clicked=!1,this.dirty_canvas=!0),n.fillRect(c,g,_-30,s),a&&!f.disabled&&n.strokeRect(c,g,_-30,s),a&&(n.textAlign="center",n.fillStyle=p,n.fillText(f.label||f.name,.5*_,g+.7*s));break;case"toggle":if(n.textAlign="left",n.strokeStyle=u,n.fillStyle=l,n.beginPath(),a?n.roundRect(c,g,_-30,s,[.5*s]):n.rect(c,g,_-30,s),n.fill(),a&&!f.disabled&&n.stroke(),n.fillStyle=f.value?"#89A":"#333",n.beginPath(),n.arc(_-30,g+.5*s,.36*s,0,2*Math.PI),n.fill(),a){n.fillStyle=h;const t=f.label||f.name;null!=t&&n.fillText(t,30,g+.7*s),n.fillStyle=f.value?p:h,n.textAlign="right",n.fillText(f.value?f.options.on||"true":f.options.off||"false",_-40,g+.7*s)}break;case"slider":n.fillStyle=l,n.fillRect(c,g,_-30,s);var v=f.options.max-f.options.min,m=(f.value-f.options.min)/v;if(m<0&&(m=0),m>1&&(m=1),n.fillStyle=f.options.hasOwnProperty("slider_color")?f.options.slider_color:i==f?"#89A":"#678",n.fillRect(c,g,m*(_-30),s),a&&!f.disabled&&n.strokeRect(c,g,_-30,s),f.marker){var y=(f.marker-f.options.min)/v;y<0&&(y=0),y>1&&(y=1),n.fillStyle=f.options.hasOwnProperty("marker_color")?f.options.marker_color:"#AA9",n.fillRect(c+y*(_-30),g,2,s)}a&&(n.textAlign="center",n.fillStyle=p,n.fillText(f.label||f.name+"  "+Number(f.value).toFixed(null!=f.options.precision?f.options.precision:3),.5*_,g+.7*s));break;case"number":case"combo":if(n.textAlign="left",n.strokeStyle=u,n.fillStyle=l,n.beginPath(),a?n.roundRect(c,g,_-30,s,[.5*s]):n.rect(c,g,_-30,s),n.fill(),a)if(f.disabled||n.stroke(),n.fillStyle=p,f.disabled||(n.beginPath(),n.moveTo(31,g+5),n.lineTo(21,g+.5*s),n.lineTo(31,g+s-5),n.fill(),n.beginPath(),n.moveTo(_-c-16,g+5),n.lineTo(_-c-6,g+.5*s),n.lineTo(_-c-16,g+s-5),n.fill()),n.fillStyle=h,n.fillText(f.label||f.name,35,g+.7*s),n.fillStyle=p,n.textAlign="right","number"==f.type)n.fillText(Number(f.value).toFixed(void 0!==f.options.precision?f.options.precision:3),_-30-20,g+.7*s);else{var b=f.value;if(f.options.values){var x=f.options.values;x.constructor===Function&&(x=x()),x&&x.constructor!==Array&&(b=x[f.value])}n.fillText(b,_-30-20,g+.7*s)}break;case"string":case"text":if(n.textAlign="left",n.strokeStyle=u,n.fillStyle=l,n.beginPath(),a?n.roundRect(c,g,_-30,s,[.5*s]):n.rect(c,g,_-30,s),n.fill(),a){f.disabled||n.stroke(),n.save(),n.beginPath(),n.rect(c,g,_-30,s),n.clip(),n.fillStyle=h;const t=f.label||f.name;null!=t&&n.fillText(t,30,g+.7*s),n.fillStyle=p,n.textAlign="right",n.fillText(String(f.value).substr(0,30),_-30,g+.7*s),n.restore()}break;default:f.draw&&f.draw(n,t,_,g,s)}e+=(f.computeSize?f.computeSize(_)[1]:s)+4,n.globalAlpha=this.editor_alpha}n.restore(),n.textAlign="left"},LGraphCanvas.prototype.processNodeWidgets=function(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;for(var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow(),i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(w&&!w.disabled){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(w==active_widget||!(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||void 0===w.last_y)){var old_value=w.value;switch(w.type){case"button":event.type===LiteGraph.pointerevents_method+"down"&&(w.callback&&setTimeout((function(){w.callback(w,that,node,pos,event)}),20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var old_value=w.value,nvalue=clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout((function(){inner_value_change(w,w.value)}),20),this.dirty_canvas=!0;break;case"number":case"combo":var old_value=w.value;if(event.type==LiteGraph.pointerevents_method+"move"&&"number"==w.type)deltaX&&(w.value+=.1*deltaX*(w.options.step||1)),null!=w.options.min&&w.value<w.options.min&&(w.value=w.options.min),null!=w.options.max&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type==LiteGraph.pointerevents_method+"down"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;"number"!=w.type&&(values_list=values.constructor===Array?values:Object.keys(values));var delta=x<40?-1:x>widget_width-40?1:0;if("number"==w.type)w.value+=.1*delta*(w.options.step||1),null!=w.options.min&&w.value<w.options.min&&(w.value=w.options.min),null!=w.options.max&&w.value>w.options.max&&(w.value=w.options.max);else if(delta){var index=-1;this.last_mouseclick=0,index=values.constructor===Object?values_list.indexOf(String(w.value))+delta:values_list.indexOf(w.value)+delta,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{var text_values=values!=values_list?Object.values(values):values,menu=new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:inner_clicked.bind(w)},ref_window);function inner_clicked(t,e,n){return values!=values_list&&(t=text_values.indexOf(t)),this.value=t,inner_value_change(this,t),that.dirty_canvas=!0,!1}}}else if(event.type==LiteGraph.pointerevents_method+"up"&&"number"==w.type){var delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&0==delta&&this.prompt("Value",w.value,function(v){if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch(t){}this.value=Number(v),inner_value_change(this,this.value)}.bind(w),event)}old_value!=w.value&&setTimeout(function(){inner_value_change(this,this.value)}.bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type==LiteGraph.pointerevents_method+"down"&&(w.value=!w.value,setTimeout((function(){inner_value_change(w,w.value)}),20));break;case"string":case"text":event.type==LiteGraph.pointerevents_method+"down"&&this.prompt("Value",w.value,function(t){inner_value_change(this,t)}.bind(w),event,!!w.options&&w.options.multiline);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node))}return old_value!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,old_value,w),node.graph._version++),w}}}function inner_value_change(t,e){"number"==t.type&&(e=Number(e)),t.value=e,t.options&&t.options.property&&void 0!==node.properties[t.options.property]&&node.setProperty(t.options.property,e),t.callback&&t.callback(t.value,that,node,pos,event)}return null},LGraphCanvas.prototype.drawGroups=function(t,e){if(this.graph){var n=this.graph._groups;e.save(),e.globalAlpha=.5*this.editor_alpha;for(var i=0;i<n.length;++i){var r=n[i];if(overlapBounding(this.visible_area,r._bounding)){e.fillStyle=r.color||"#335",e.strokeStyle=r.color||"#335";var o=r._pos,s=r._size;e.globalAlpha=.25*this.editor_alpha,e.beginPath(),e.rect(o[0]+.5,o[1]+.5,s[0],s[1]),e.fill(),e.globalAlpha=this.editor_alpha,e.stroke(),e.beginPath(),e.moveTo(o[0]+s[0],o[1]+s[1]),e.lineTo(o[0]+s[0]-10,o[1]+s[1]),e.lineTo(o[0]+s[0],o[1]+s[1]-10),e.fill();var a=r.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;e.font=a+"px Arial",e.textAlign="left",e.fillText(r.title,o[0]+4,o[1]+a)}}e.restore()}},LGraphCanvas.prototype.adjustNodesSize=function(){for(var t=this.graph._nodes,e=0;e<t.length;++e)t[e].size=t[e].computeSize();this.setDirty(!0,!0)},LGraphCanvas.prototype.resize=function(t,e){if(!t&&!e){var n=this.canvas.parentNode;t=n.offsetWidth,e=n.offsetHeight}this.canvas.width==t&&this.canvas.height==e||(this.canvas.width=t,this.canvas.height=e,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))},LGraphCanvas.prototype.switchLiveMode=function(t){if(!t)return this.live_mode=!this.live_mode,this.dirty_canvas=!0,void(this.dirty_bgcanvas=!0);var e=this,n=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var i=setInterval((function(){e.editor_alpha*=n,e.dirty_canvas=!0,e.dirty_bgcanvas=!0,n<1&&e.editor_alpha<.01&&(clearInterval(i),n<1&&(e.live_mode=!0)),n>1&&e.editor_alpha>.99&&(clearInterval(i),e.editor_alpha=1)}),1)},LGraphCanvas.prototype.onNodeSelectionChange=function(t){},LGraphCanvas.onGroupAdd=function(t,e,n){var i=LGraphCanvas.active_canvas,r=(i.getCanvasWindow(),new LiteGraph.LGraphGroup);r.pos=i.convertEventToCanvasOffset(n),i.graph.add(r)},LGraphCanvas.getBoundaryNodes=function(t){let e=null,n=null,i=null,r=null;for(const o in t){const s=t[o],[a,u]=s.pos,[l,p]=s.size;(null===e||u<e.pos[1])&&(e=s),(null===n||a+l>n.pos[0]+n.size[0])&&(n=s),(null===i||u+p>i.pos[1]+i.size[1])&&(i=s),(null===r||a<r.pos[0])&&(r=s)}return{top:e,right:n,bottom:i,left:r}},LGraphCanvas.prototype.boundaryNodesForSelection=function(){return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))},LGraphCanvas.alignNodes=function(t,e,n){if(!t)return;const i=LGraphCanvas.active_canvas;let r=[];r=void 0===n?LGraphCanvas.getBoundaryNodes(t):{top:n,right:n,bottom:n,left:n};for(const[t,n]of Object.entries(i.selected_nodes))switch(e){case"right":n.pos[0]=r.right.pos[0]+r.right.size[0]-n.size[0];break;case"left":n.pos[0]=r.left.pos[0];break;case"top":n.pos[1]=r.top.pos[1];break;case"bottom":n.pos[1]=r.bottom.pos[1]+r.bottom.size[1]-n.size[1]}i.dirty_canvas=!0,i.dirty_bgcanvas=!0},LGraphCanvas.onNodeAlign=function(t,e,n,i,r){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:n,callback:function(t){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,t.toLowerCase(),r)},parentMenu:i})},LGraphCanvas.onGroupAlign=function(t,e,n,i){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:n,callback:function(t){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,t.toLowerCase())},parentMenu:i})},LGraphCanvas.onMenuAdd=function(t,e,n,i,r){var o=LGraphCanvas.active_canvas,s=o.getCanvasWindow(),a=o.graph;if(a)return function t(e,i){var u=LiteGraph.getNodeTypesCategories(o.filter||a.filter).filter((function(t){return t.startsWith(e)})),l=[];u.map((function(n){if(n){var i=new RegExp("^("+e+")"),r=n.replace(i,"").split("/")[0],o=""===e?r+"/":e+r+"/",s=r;-1!=s.indexOf("::")&&(s=s.split("::")[1]),-1===l.findIndex((function(t){return t.value===o}))&&l.push({value:o,content:s,has_submenu:!0,callback:function(e,n,i,r){t(e.value,r)}})}})),LiteGraph.getNodeTypesInCategory(e.slice(0,-1),o.filter||a.filter).map((function(t){if(!t.skip_list){var e={value:t.type,content:t.title,has_submenu:!1,callback:function(t,e,n,i){var s=i.getFirstEvent();o.graph.beforeChange();var a=LiteGraph.createNode(t.value);a&&(a.pos=o.convertEventToCanvasOffset(s),o.graph.add(a)),r&&r(a),o.graph.afterChange()}};l.push(e)}})),new LiteGraph.ContextMenu(l,{event:n,parentMenu:i},s)}("",i),!1},LGraphCanvas.onMenuCollapseAll=function(){},LGraphCanvas.onMenuNodeEdit=function(){},LGraphCanvas.showMenuNodeOptionalInputs=function(t,e,n,i,r){if(r){var o=this,s=LGraphCanvas.active_canvas.getCanvasWindow();e=r.optional_inputs,r.onGetInputs&&(e=r.onGetInputs());var a=[];if(e)for(var u=0;u<e.length;u++){var l=e[u];if(l){var p=l[0];l[2]||(l[2]={}),l[2].label&&(p=l[2].label),l[2].removable=!0;var h={content:p,value:l};l[1]==LiteGraph.ACTION&&(h.className="event"),a.push(h)}else a.push(null)}if(r.onMenuNodeInputs){var c=r.onMenuNodeInputs(a);c&&(a=c)}if(a.length)return new LiteGraph.ContextMenu(a,{event:n,callback:function(t,e,n){r&&(t.callback&&t.callback.call(o,r,t,e,n),t.value&&(r.graph.beforeChange(),r.addInput(t.value[0],t.value[1],t.value[2]),r.onNodeInputAdd&&r.onNodeInputAdd(t.value),r.setDirtyCanvas(!0,!0),r.graph.afterChange()))},parentMenu:i,node:r},s),!1;console.log("no input entries")}},LGraphCanvas.showMenuNodeOptionalOutputs=function(t,e,n,i,r){if(r){var o=this,s=LGraphCanvas.active_canvas.getCanvasWindow();e=r.optional_outputs,r.onGetOutputs&&(e=r.onGetOutputs());var a=[];if(e)for(var u=0;u<e.length;u++){var l=e[u];if(l){if(!r.flags||!r.flags.skip_repeated_outputs||-1==r.findOutputSlot(l[0])){var p=l[0];l[2]||(l[2]={}),l[2].label&&(p=l[2].label),l[2].removable=!0;var h={content:p,value:l};l[1]==LiteGraph.EVENT&&(h.className="event"),a.push(h)}}else a.push(null)}if(this.onMenuNodeOutputs&&(a=this.onMenuNodeOutputs(a)),LiteGraph.do_add_triggers_slots&&-1==r.findOutputSlot("onExecuted")&&a.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0}],className:"event"}),r.onMenuNodeOutputs){var c=r.onMenuNodeOutputs(a);c&&(a=c)}if(a.length)return new LiteGraph.ContextMenu(a,{event:n,callback:function t(e,n,s){if(r&&(e.callback&&e.callback.call(o,r,e,n,s),e.value)){var a=e.value[1];if(a&&(a.constructor===Object||a.constructor===Array)){var u=[];for(var l in a)u.push({content:l,value:a[l]});return new LiteGraph.ContextMenu(u,{event:n,callback:t,parentMenu:i,node:r}),!1}r.graph.beforeChange(),r.addOutput(e.value[0],e.value[1],e.value[2]),r.onNodeOutputAdd&&r.onNodeOutputAdd(e.value),r.setDirtyCanvas(!0,!0),r.graph.afterChange()}},parentMenu:i,node:r},s),!1}},LGraphCanvas.onShowMenuNodeProperties=function(t,e,n,i,r){if(r&&r.properties){var o=LGraphCanvas.active_canvas,s=o.getCanvasWindow(),a=[];for(var u in r.properties){"object"==typeof(t=void 0!==r.properties[u]?r.properties[u]:" ")&&(t=JSON.stringify(t));var l=r.getPropertyInfo(u);"enum"!=l.type&&"combo"!=l.type||(t=LGraphCanvas.getPropertyPrintableValue(t,l.values)),t=LGraphCanvas.decodeHTML(t),a.push({content:"<span class='property_name'>"+(l.label?l.label:u)+"</span><span class='property_value'>"+t+"</span>",value:u})}if(a.length)return new LiteGraph.ContextMenu(a,{event:n,callback:function(t,e,n,i){if(r){var s=this.getBoundingClientRect();o.showEditPropertyValue(r,t.value,{position:[s.left,s.top]})}},parentMenu:i,allow_html:!0,node:r},s),!1}},LGraphCanvas.decodeHTML=function(t){var e=document.createElement("div");return e.innerText=t,e.innerHTML},LGraphCanvas.onMenuResizeNode=function(t,e,n,i,r){if(r){var o=function(t){t.size=t.computeSize(),t.onResize&&t.onResize(t.size)},s=LGraphCanvas.active_canvas;if(!s.selected_nodes||Object.keys(s.selected_nodes).length<=1)o(r);else for(var a in s.selected_nodes)o(s.selected_nodes[a]);r.setDirtyCanvas(!0,!0)}},LGraphCanvas.prototype.showLinkMenu=function(t,e){var n=this,i=n.graph.getNodeById(t.origin_id),r=n.graph.getNodeById(t.target_id),o=!1;i&&i.outputs&&i.outputs[t.origin_slot]&&(o=i.outputs[t.origin_slot].type);var s=!1;r&&r.outputs&&r.outputs[t.target_slot]&&(s=r.inputs[t.target_slot].type);var a=new LiteGraph.ContextMenu(["Add Node",null,"Delete",null],{event:e,title:null!=t.data?t.data.constructor.name:null,callback:function(e,u,l){switch(e){case"Add Node":LGraphCanvas.onMenuAdd(null,null,l,a,(function(e){e.inputs&&e.inputs.length&&e.outputs&&e.outputs.length&&i.connectByType(t.origin_slot,e,o)&&(e.connectByType(t.target_slot,r,s),e.pos[0]-=.5*e.size[0])}));break;case"Delete":n.graph.removeLink(t.id)}}});return!1},LGraphCanvas.prototype.createDefaultNodeForSlot=function(t){t=t||{};var e=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},t),n=e.nodeFrom&&null!==e.slotFrom,i=!n&&e.nodeTo&&null!==e.slotTo;if(!n&&!i)return console.warn("No data passed to createDefaultNodeForSlot "+e.nodeFrom+" "+e.slotFrom+" "+e.nodeTo+" "+e.slotTo),!1;if(!e.nodeType)return console.warn("No type to createDefaultNodeForSlot"),!1;var r=n?e.nodeFrom:e.nodeTo,o=n?e.slotFrom:e.slotTo,s=!1;switch(typeof o){case"string":s=n?r.findOutputSlot(o,!1):r.findInputSlot(o,!1),o=n?r.outputs[o]:r.inputs[o];break;case"object":s=n?r.findOutputSlot(o.name):r.findInputSlot(o.name);break;case"number":s=o,o=n?r.outputs[o]:r.inputs[o];break;default:return console.warn("Cant get slot information "+o),!1}!1!==o&&!1!==s||console.warn("createDefaultNodeForSlot bad slotX "+o+" "+s);var a=o.type==LiteGraph.EVENT?"_event_":o.type,u=n?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(u&&u[a]){if(o.link,nodeNewType=!1,"object"==typeof u[a]||"array"==typeof u[a]){for(var l in u[a])if(e.nodeType==u[a][l]||"AUTO"==e.nodeType){nodeNewType=u[a][l];break}}else e.nodeType!=u[a]&&"AUTO"!=e.nodeType||(nodeNewType=u[a]);if(nodeNewType){var p=!1;"object"==typeof nodeNewType&&nodeNewType.node&&(p=nodeNewType,nodeNewType=nodeNewType.node);var h=LiteGraph.createNode(nodeNewType);if(h){if(p){if(p.properties)for(var c in p.properties)h.addProperty(c,p.properties[c]);if(p.inputs)for(var c in h.inputs=[],p.inputs)h.addOutput(p.inputs[c][0],p.inputs[c][1]);if(p.outputs)for(var c in h.outputs=[],p.outputs)h.addOutput(p.outputs[c][0],p.outputs[c][1]);p.title&&(h.title=p.title),p.json&&h.configure(p.json)}return this.graph.add(h),h.pos=[e.position[0]+e.posAdd[0]+(e.posSizeFix[0]?e.posSizeFix[0]*h.size[0]:0),e.position[1]+e.posAdd[1]+(e.posSizeFix[1]?e.posSizeFix[1]*h.size[1]:0)],n?e.nodeFrom.connectByType(s,h,a):e.nodeTo.connectByTypeOutput(s,h,a),!0}console.log("failed creating "+nodeNewType)}}return!1},LGraphCanvas.prototype.showConnectionMenu=function(t){t=t||{};var e=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},t),n=this,i=e.nodeFrom&&e.slotFrom,r=!i&&e.nodeTo&&e.slotTo;if(!i&&!r)return console.warn("No data passed to showConnectionMenu"),!1;var o=i?e.nodeFrom:e.nodeTo,s=i?e.slotFrom:e.slotTo,a=!1;switch(typeof s){case"string":a=i?o.findOutputSlot(s,!1):o.findInputSlot(s,!1),s=i?o.outputs[s]:o.inputs[s];break;case"object":a=i?o.findOutputSlot(s.name):o.findInputSlot(s.name);break;case"number":a=s,s=i?o.outputs[s]:o.inputs[s];break;default:return console.warn("Cant get slot information "+s),!1}var u=["Add Node",null];n.allow_searchbox&&(u.push("Search"),u.push(null));var l=s.type==LiteGraph.EVENT?"_event_":s.type,p=i?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(p&&p[l])if("object"==typeof p[l]||"array"==typeof p[l])for(var h in p[l])u.push(p[l][h]);else u.push(p[l]);var c=new LiteGraph.ContextMenu(u,{event:e.e,title:(s&&""!=s.name?s.name+(l?" | ":""):"")+(s&&l?l:""),callback:function(t,r,o){switch(t){case"Add Node":LGraphCanvas.onMenuAdd(null,null,o,c,(function(t){i?e.nodeFrom.connectByType(a,t,l):e.nodeTo.connectByTypeOutput(a,t,l)}));break;case"Search":i?n.showSearchBox(o,{node_from:e.nodeFrom,slot_from:s,type_filter_in:l}):n.showSearchBox(o,{node_to:e.nodeTo,slot_from:s,type_filter_out:l});break;default:n.createDefaultNodeForSlot(Object.assign(e,{position:[e.e.canvasX,e.e.canvasY],nodeType:t}))}}});return!1},LGraphCanvas.onShowPropertyEditor=function(t,e,n,i,r){var o=t.property||"title",s=r[o],a=document.createElement("div");a.is_modified=!1,a.className="graphdialog",a.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",a.close=function(){a.parentNode&&a.parentNode.removeChild(a)},a.querySelector(".name").innerText=o;var u=a.querySelector(".value");u&&(u.value=s,u.addEventListener("blur",(function(t){this.focus()})),u.addEventListener("keydown",(function(t){if(a.is_modified=!0,27==t.keyCode)a.close();else if(13==t.keyCode)f();else if(13!=t.keyCode&&"textarea"!=t.target.localName)return;t.preventDefault(),t.stopPropagation()})));var l=LGraphCanvas.active_canvas.canvas,p=l.getBoundingClientRect(),h=-20,c=-20;p&&(h-=p.left,c-=p.top),event?(a.style.left=event.clientX+h+"px",a.style.top=event.clientY+c+"px"):(a.style.left=.5*l.width+h+"px",a.style.top=.5*l.height+c+"px"),a.querySelector("button").addEventListener("click",f),l.parentNode.appendChild(a),u&&u.focus();var d=null;function f(){u&&function(e){"Number"==t.type?e=Number(e):"Boolean"==t.type&&(e=Boolean(e)),r[o]=e,a.parentNode&&a.parentNode.removeChild(a),r.setDirtyCanvas(!0,!0)}(u.value)}a.addEventListener("mouseleave",(function(t){LiteGraph.dialog_close_on_mouse_leave&&!a.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(d=setTimeout(a.close,LiteGraph.dialog_close_on_mouse_leave_delay))})),a.addEventListener("mouseenter",(function(t){LiteGraph.dialog_close_on_mouse_leave&&d&&clearTimeout(d)}))},LGraphCanvas.prototype.prompt=function(t,e,n,i,r){var o=this;t=t||"";var s=document.createElement("div");s.is_modified=!1,s.className="graphdialog rounded",s.innerHTML=r?"<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":"<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",s.close=function(){o.prompt_box=null,s.parentNode&&s.parentNode.removeChild(s)};var a=LGraphCanvas.active_canvas.canvas;a.parentNode.appendChild(s),this.ds.scale>1&&(s.style.transform="scale("+this.ds.scale+")");var u=null,l=!1;LiteGraph.pointerListenerAdd(s,"leave",(function(t){l||LiteGraph.dialog_close_on_mouse_leave&&!s.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(u=setTimeout(s.close,LiteGraph.dialog_close_on_mouse_leave_delay))})),LiteGraph.pointerListenerAdd(s,"enter",(function(t){LiteGraph.dialog_close_on_mouse_leave&&u&&clearTimeout(u)}));var p=s.querySelectorAll("select");p&&p.forEach((function(t){t.addEventListener("click",(function(t){l++})),t.addEventListener("blur",(function(t){l=0})),t.addEventListener("change",(function(t){l=-1}))})),o.prompt_box&&o.prompt_box.close(),o.prompt_box=s,s.querySelector(".name").innerText=t;var h=s.querySelector(".value");h.value=e;var c=h;c.addEventListener("keydown",(function(t){if(s.is_modified=!0,27==t.keyCode)s.close();else{if(13!=t.keyCode||"textarea"==t.target.localName)return;n&&n(this.value),s.close()}t.preventDefault(),t.stopPropagation()})),s.querySelector("button").addEventListener("click",(function(t){n&&n(c.value),o.setDirty(!0),s.close()}));var d=a.getBoundingClientRect(),f=-20,g=-20;return d&&(f-=d.left,g-=d.top),i?(s.style.left=i.clientX+f+"px",s.style.top=i.clientY+g+"px"):(s.style.left=.5*a.width+f+"px",s.style.top=.5*a.height+g+"px"),setTimeout((function(){c.focus()}),10),s},LGraphCanvas.search_limit=-1,LGraphCanvas.prototype.showSearchBox=function(t,e){var n={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled,type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};e=Object.assign(n,e||{});var i=this,r=LGraphCanvas.active_canvas,o=r.canvas,s=o.ownerDocument||document,a=document.createElement("div");if(a.className="litegraph litesearchbox graphdialog rounded",a.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",e.do_type_filter&&(a.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",a.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),a.innerHTML+="<div class='helper'></div>",s.fullscreenElement?s.fullscreenElement.appendChild(a):(s.body.appendChild(a),s.body.style.overflow="hidden"),e.do_type_filter)var u=a.querySelector(".slot_in_type_filter"),l=a.querySelector(".slot_out_type_filter");if(a.close=function(){i.search_box=null,this.blur(),o.focus(),s.body.style.overflow="",setTimeout((function(){i.canvas.focus()}),20),a.parentNode&&a.parentNode.removeChild(a)},this.ds.scale>1&&(a.style.transform="scale("+this.ds.scale+")"),e.hide_on_mouse_leave){var p=!1,h=null;LiteGraph.pointerListenerAdd(a,"enter",(function(t){h&&(clearTimeout(h),h=null)})),LiteGraph.pointerListenerAdd(a,"leave",(function(t){p||(h=setTimeout((function(){a.close()}),500))})),e.do_type_filter&&(u.addEventListener("click",(function(t){p++})),u.addEventListener("blur",(function(t){p=0})),u.addEventListener("change",(function(t){p=-1})),l.addEventListener("click",(function(t){p++})),l.addEventListener("blur",(function(t){p=0})),l.addEventListener("change",(function(t){p=-1})))}i.search_box&&i.search_box.close(),i.search_box=a;var c=a.querySelector(".helper"),d=null,f=null,g=null,_=a.querySelector("input");if(_&&(_.addEventListener("blur",(function(t){i.search_box&&this.focus()})),_.addEventListener("keydown",(function(t){if(38==t.keyCode)C(!1);else if(40==t.keyCode)C(!0);else if(27==t.keyCode)a.close();else{if(13!=t.keyCode)return f&&clearInterval(f),void(f=setTimeout(T,250));T(),g?E(g.innerHTML):d?E(d):a.close()}return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!0}))),e.do_type_filter){if(u){var v=(y=LiteGraph.slot_types_in).length;e.type_filter_in!=LiteGraph.EVENT&&e.type_filter_in!=LiteGraph.ACTION||(e.type_filter_in="_event_");for(var m=0;m<v;m++)(b=document.createElement("option")).value=y[m],b.innerHTML=y[m],u.appendChild(b),!1!==e.type_filter_in&&(e.type_filter_in+"").toLowerCase()==(y[m]+"").toLowerCase()&&(b.selected=!0);u.addEventListener("change",(function(){T()}))}if(l){var y;for(v=(y=LiteGraph.slot_types_out).length,e.type_filter_out!=LiteGraph.EVENT&&e.type_filter_out!=LiteGraph.ACTION||(e.type_filter_out="_event_"),m=0;m<v;m++){var b;(b=document.createElement("option")).value=y[m],b.innerHTML=y[m],l.appendChild(b),!1!==e.type_filter_out&&(e.type_filter_out+"").toLowerCase()==(y[m]+"").toLowerCase()&&(b.selected=!0)}l.addEventListener("change",(function(){T()}))}}var x=o.getBoundingClientRect(),A=(t?t.clientX:x.left+.5*x.width)-80,w=(t?t.clientY:x.top+.5*x.height)-20;function E(n){if(n)if(i.onSearchBoxSelection)i.onSearchBoxSelection(n,t,r);else{var o=LiteGraph.searchbox_extras[n.toLowerCase()];o&&(n=o.type),r.graph.beforeChange();var s=LiteGraph.createNode(n);if(s&&(s.pos=r.convertEventToCanvasOffset(t),r.graph.add(s,!1)),o&&o.data){if(o.data.properties)for(var u in o.data.properties)s.addProperty(u,o.data.properties[u]);if(o.data.inputs)for(var u in s.inputs=[],o.data.inputs)s.addOutput(o.data.inputs[u][0],o.data.inputs[u][1]);if(o.data.outputs)for(var u in s.outputs=[],o.data.outputs)s.addOutput(o.data.outputs[u][0],o.data.outputs[u][1]);o.data.title&&(s.title=o.data.title),o.data.json&&s.configure(o.data.json)}if(e.node_from){var l=!1;switch(typeof e.slot_from){case"string":l=e.node_from.findOutputSlot(e.slot_from);break;case"object":-1==(l=e.slot_from.name?e.node_from.findOutputSlot(e.slot_from.name):-1)&&void 0!==e.slot_from.slot_index&&(l=e.slot_from.slot_index);break;case"number":l=e.slot_from;break;default:l=0}void 0!==e.node_from.outputs[l]&&!1!==l&&l>-1&&e.node_from.connectByType(l,s,e.node_from.outputs[l].type)}if(e.node_to){switch(l=!1,typeof e.slot_from){case"string":l=e.node_to.findInputSlot(e.slot_from);break;case"object":-1==(l=e.slot_from.name?e.node_to.findInputSlot(e.slot_from.name):-1)&&void 0!==e.slot_from.slot_index&&(l=e.slot_from.slot_index);break;case"number":l=e.slot_from;break;default:l=0}void 0!==e.node_to.inputs[l]&&!1!==l&&l>-1&&e.node_to.connectByTypeOutput(l,s,e.node_to.inputs[l].type)}r.graph.afterChange()}a.close()}function C(t){var e=g;g&&g.classList.remove("selected"),g?(g=t?g.nextSibling:g.previousSibling)||(g=e):g=t?c.childNodes[0]:c.childNodes[c.childNodes.length],g&&(g.classList.add("selected"),g.scrollIntoView({block:"end",behavior:"smooth"}))}function T(){f=null;var t=_.value;if(d=null,c.innerHTML="",t||e.show_all_if_empty)if(i.onSearchBox){var n=i.onSearchBox(c,t,r);if(n)for(var o=0;o<n.length;++o)m(n[o])}else{var s=0;t=t.toLowerCase();var a=r.filter||r.graph.filter;if(e.do_type_filter&&i.search_box)var u=i.search_box.querySelector(".slot_in_type_filter"),l=i.search_box.querySelector(".slot_out_type_filter");else u=!1,l=!1;for(var o in LiteGraph.searchbox_extras){var p=LiteGraph.searchbox_extras[o];if(e.show_all_if_empty&&!t||-1!==p.desc.toLowerCase().indexOf(t)){var h=LiteGraph.registered_node_types[p.type];if((!h||h.filter==a)&&v(p.type)&&(m(p.desc,"searchbox_extra"),-1!==LGraphCanvas.search_limit&&s++>LGraphCanvas.search_limit))break}}var g=null;if(Array.prototype.filter)g=Object.keys(LiteGraph.registered_node_types).filter(v);else for(var o in g=[],LiteGraph.registered_node_types)v(o)&&g.push(o);for(o=0;o<g.length&&(m(g[o]),!(-1!==LGraphCanvas.search_limit&&s++>LGraphCanvas.search_limit));o++);if(e.show_general_after_typefiltered&&(u.value||l.value)){for(var o in filtered_extra=[],LiteGraph.registered_node_types)v(o,{inTypeOverride:!(!u||!u.value)&&"*",outTypeOverride:!(!l||!l.value)&&"*"})&&filtered_extra.push(o);for(o=0;o<filtered_extra.length&&(m(filtered_extra[o],"generic_type"),!(-1!==LGraphCanvas.search_limit&&s++>LGraphCanvas.search_limit));o++);}if((u.value||l.value)&&0==c.childNodes.length&&e.show_general_if_none_on_typefilter){for(var o in filtered_extra=[],LiteGraph.registered_node_types)v(o,{skipFilter:!0})&&filtered_extra.push(o);for(o=0;o<filtered_extra.length&&(m(filtered_extra[o],"not_in_filter"),!(-1!==LGraphCanvas.search_limit&&s++>LGraphCanvas.search_limit));o++);}function v(n,i){i=i||{};var r=Object.assign({skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},i),o=LiteGraph.registered_node_types[n];if(a&&o.filter!=a)return!1;if((!e.show_all_if_empty||t)&&-1===n.toLowerCase().indexOf(t))return!1;if(e.do_type_filter&&!r.skipFilter){var s=n,p=u.value;if(!1!==r.inTypeOverride&&(p=r.inTypeOverride),u&&p&&LiteGraph.registered_slot_in_types[p]&&LiteGraph.registered_slot_in_types[p].nodes&&!1===LiteGraph.registered_slot_in_types[p].nodes.includes(s))return!1;if(p=l.value,!1!==r.outTypeOverride&&(p=r.outTypeOverride),l&&p&&LiteGraph.registered_slot_out_types[p]&&LiteGraph.registered_slot_out_types[p].nodes&&!1===LiteGraph.registered_slot_out_types[p].nodes.includes(s))return!1}return!0}}function m(t,e){var n=document.createElement("div");d||(d=t),n.innerText=t,n.dataset.type=escape(t),n.className="litegraph lite-search-item",e&&(n.className+=" "+e),n.addEventListener("click",(function(t){E(unescape(this.dataset.type))})),c.appendChild(n)}}return a.style.left=A+"px",a.style.top=w+"px",t.layerY>x.height-200&&(c.style.maxHeight=x.height-t.layerY-20+"px"),_.focus(),e.show_all_on_open&&T(),a},LGraphCanvas.prototype.showEditPropertyValue=function(t,e,n){if(t&&void 0!==t.properties[e]){n=n||{};var i=t.getPropertyInfo(e),r=i.type,o="";if("string"==r||"number"==r||"array"==r||"object"==r)o="<input autofocus type='text' class='value'/>";else if("enum"!=r&&"combo"!=r||!i.values){if("boolean"!=r&&"toggle"!=r)return void console.warn("unknown type: "+r);o="<input autofocus type='checkbox' class='value' "+(t.properties[e]?"checked":"")+"/>"}else{for(var s in o="<select autofocus type='text' class='value'>",i.values){var a=s;i.values.constructor===Array&&(a=i.values[s]),o+="<option value='"+a+"' "+(a==t.properties[e]?"selected":"")+">"+i.values[s]+"</option>"}o+="</select>"}var u=this.createDialog("<span class='name'>"+(i.label?i.label:e)+"</span>"+o+"<button>OK</button>",n),l=!1;return"enum"!=r&&"combo"!=r||!i.values?"boolean"==r||"toggle"==r?(l=u.querySelector("input"))&&l.addEventListener("click",(function(t){u.modified(),h(!!l.checked)})):(l=u.querySelector("input"))&&(l.addEventListener("blur",(function(t){this.focus()})),a=void 0!==t.properties[e]?t.properties[e]:"","string"!==r&&(a=JSON.stringify(a)),l.value=a,l.addEventListener("keydown",(function(t){if(27==t.keyCode)u.close();else if(13==t.keyCode)p();else if(13!=t.keyCode)return void u.modified();t.preventDefault(),t.stopPropagation()}))):(l=u.querySelector("select")).addEventListener("change",(function(t){u.modified(),h(t.target.value)})),l&&l.focus(),u.querySelector("button").addEventListener("click",p),u}function p(){h(l.value)}function h(o){i&&i.values&&i.values.constructor===Object&&null!=i.values[o]&&(o=i.values[o]),"number"==typeof t.properties[e]&&(o=Number(o)),"array"!=r&&"object"!=r||(o=JSON.parse(o)),t.properties[e]=o,t.graph&&t.graph._version++,t.onPropertyChanged&&t.onPropertyChanged(e,o),n.onclose&&n.onclose(),u.close(),t.setDirtyCanvas(!0,!0)}},LGraphCanvas.prototype.createDialog=function(t,e){e=Object.assign({checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0},e||{});var n=document.createElement("div");n.className="graphdialog",n.innerHTML=t,n.is_modified=!1;var i=this.canvas.getBoundingClientRect(),r=-20,o=-20;if(i&&(r-=i.left,o-=i.top),e.position?(r+=e.position[0],o+=e.position[1]):e.event?(r+=e.event.clientX,o+=e.event.clientY):(r+=.5*this.canvas.width,o+=.5*this.canvas.height),n.style.left=r+"px",n.style.top=o+"px",this.canvas.parentNode.appendChild(n),e.checkForInput){var s=[];(s=n.querySelectorAll("input"))&&s.forEach((function(t){t.addEventListener("keydown",(function(t){if(n.modified(),27==t.keyCode)n.close();else if(13!=t.keyCode)return;t.preventDefault(),t.stopPropagation()})),t.focus()}))}n.modified=function(){n.is_modified=!0},n.close=function(){n.parentNode&&n.parentNode.removeChild(n)};var a=null,u=!1;n.addEventListener("mouseleave",(function(t){u||(e.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!n.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(a=setTimeout(n.close,LiteGraph.dialog_close_on_mouse_leave_delay))})),n.addEventListener("mouseenter",(function(t){(e.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&a&&clearTimeout(a)}));var l=n.querySelectorAll("select");return l&&l.forEach((function(t){t.addEventListener("click",(function(t){u++})),t.addEventListener("blur",(function(t){u=0})),t.addEventListener("change",(function(t){u=-1}))})),n},LGraphCanvas.prototype.createPanel=function(t,e){var n=(e=e||{}).window||window,i=document.createElement("div");if(i.className="litegraph dialog",i.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",i.header=i.querySelector(".dialog-header"),e.width&&(i.style.width=e.width+(e.width.constructor===Number?"px":"")),e.height&&(i.style.height=e.height+(e.height.constructor===Number?"px":"")),e.closable){var r=document.createElement("span");r.innerHTML="&#10005;",r.classList.add("close"),r.addEventListener("click",(function(){i.close()})),i.header.appendChild(r)}return i.title_element=i.querySelector(".dialog-title"),i.title_element.innerText=t,i.content=i.querySelector(".dialog-content"),i.alt_content=i.querySelector(".dialog-alt-content"),i.footer=i.querySelector(".dialog-footer"),i.close=function(){i.onClose&&"function"==typeof i.onClose&&i.onClose(),i.parentNode&&i.parentNode.removeChild(i),this.parentNode&&this.parentNode.removeChild(this)},i.toggleAltContent=function(t){if(void 0!==t)var e=t?"block":"none",n=t?"none":"block";else e="block"!=i.alt_content.style.display?"block":"none",n="block"!=i.alt_content.style.display?"none":"block";i.alt_content.style.display=e,i.content.style.display=n},i.toggleFooterVisibility=function(t){if(void 0!==t)var e=t?"block":"none";else e="block"!=i.footer.style.display?"block":"none";i.footer.style.display=e},i.clear=function(){this.content.innerHTML=""},i.addHTML=function(t,e,n){var r=document.createElement("div");return e&&(r.className=e),r.innerHTML=t,n?i.footer.appendChild(r):i.content.appendChild(r),r},i.addButton=function(t,e,n){var r=document.createElement("button");return r.innerText=t,r.options=n,r.classList.add("btn"),r.addEventListener("click",e),i.footer.appendChild(r),r},i.addSeparator=function(){var t=document.createElement("div");t.className="separator",i.content.appendChild(t)},i.addWidget=function(t,e,r,o,s){o=o||{};var a=String(r);"number"==(t=t.toLowerCase())&&(a=r.toFixed(3));var u=document.createElement("div");u.className="property",u.innerHTML="<span class='property_name'></span><span class='property_value'></span>",u.querySelector(".property_name").innerText=o.label||e;var l=u.querySelector(".property_value");function p(t,e){o.callback&&o.callback(t,e,o),s&&s(t,e,o)}return l.innerText=a,u.dataset.property=e,u.dataset.type=o.type||t,u.options=o,u.value=r,"code"==t?u.addEventListener("click",(function(t){i.inner_showCodePad(this.dataset.property)})):"boolean"==t?(u.classList.add("boolean"),r&&u.classList.add("bool-on"),u.addEventListener("click",(function(){var t=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",p(t,this.value)}))):"string"==t||"number"==t?(l.setAttribute("contenteditable",!0),l.addEventListener("keydown",(function(e){"Enter"!=e.code||"string"==t&&e.shiftKey||(e.preventDefault(),this.blur())})),l.addEventListener("blur",(function(){var t=this.innerText,e=this.parentNode.dataset.property;"number"==this.parentNode.dataset.type&&(t=Number(t)),p(e,t)}))):"enum"!=t&&"combo"!=t||(a=LGraphCanvas.getPropertyPrintableValue(r,o.values),l.innerText=a,l.addEventListener("click",(function(t){var e=o.values||[],i=this.parentNode.dataset.property,r=this;new LiteGraph.ContextMenu(e,{event:t,className:"dark",callback:function(t,e,n){return r.innerText=t,p(i,t),!1}},n)}))),i.content.appendChild(u),u},i.onOpen&&"function"==typeof i.onOpen&&i.onOpen(),i},LGraphCanvas.getPropertyPrintableValue=function(t,e){if(!e)return String(t);if(e.constructor===Array)return String(t);if(e.constructor===Object){var n="";for(var i in e)if(e[i]==t){n=i;break}return String(t)+" ("+n+")"}},LGraphCanvas.prototype.closePanels=function(){var t;(t=document.querySelector("#node-panel"))&&t.close(),(t=document.querySelector("#option-panel"))&&t.close()},LGraphCanvas.prototype.showShowGraphOptionsPanel=function(t,e,n,i){if(this.constructor&&"HTMLDivElement"==this.constructor.name){if(!(e&&e.event&&e.event.target&&e.event.target.lgraphcanvas))return void console.warn("Canvas not found");var r=e.event.target.lgraphcanvas}else r=this;r.closePanels();var o=r.getCanvasWindow();panel=r.createPanel("Options",{closable:!0,window:o,onOpen:function(){r.OPTIONPANEL_IS_OPEN=!0},onClose:function(){r.OPTIONPANEL_IS_OPEN=!1,r.options_panel=null}}),r.options_panel=panel,panel.id="option-panel",panel.classList.add("settings"),function(){panel.content.innerHTML="";var t=function(t,e,n){n&&n.key&&(t=n.key),n.values&&(e=Object.values(n.values).indexOf(e)),r[t]=e},e=LiteGraph.availableCanvasOptions;for(var n in e.sort(),e){var i=e[n];panel.addWidget("boolean",i,r[i],{key:i,on:"True",off:"False"},t)}r.links_render_mode,panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[r.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},t),panel.addSeparator(),panel.footer.innerHTML=""}(),r.canvas.parentNode.appendChild(panel)},LGraphCanvas.prototype.showShowNodePanel=function(t){this.SELECTED_NODE=t,this.closePanels();var e=this.getCanvasWindow(),n=this,i=this.createPanel(t.title||"",{closable:!0,window:e,onOpen:function(){n.NODEPANEL_IS_OPEN=!0},onClose:function(){n.NODEPANEL_IS_OPEN=!1,n.node_panel=null}});function r(){i.content.innerHTML="",i.addHTML("<span class='node_type'>"+t.type+"</span><span class='node_desc'>"+(t.constructor.desc||"")+"</span><span class='separator'></span>"),i.addHTML("<h3>Properties</h3>");var e=function(e,i){switch(n.graph.beforeChange(t),e){case"Title":t.title=i;break;case"Mode":var r=Object.values(LiteGraph.NODE_MODES).indexOf(i);r>=0&&LiteGraph.NODE_MODES[r]?t.changeMode(r):console.warn("unexpected mode: "+i);break;case"Color":LGraphCanvas.node_colors[i]?(t.color=LGraphCanvas.node_colors[i].color,t.bgcolor=LGraphCanvas.node_colors[i].bgcolor):console.warn("unexpected color: "+i);break;default:t.setProperty(e,i)}n.graph.afterChange(),n.dirty_canvas=!0};i.addWidget("string","Title",t.title,{},e),i.addWidget("combo","Mode",LiteGraph.NODE_MODES[t.mode],{values:LiteGraph.NODE_MODES},e);var r="";for(var o in void 0!==t.color&&(r=Object.keys(LGraphCanvas.node_colors).filter((function(e){return LGraphCanvas.node_colors[e].color==t.color}))),i.addWidget("combo","Color",r,{values:Object.keys(LGraphCanvas.node_colors)},e),t.properties){var s=t.properties[o],a=t.getPropertyInfo(o);a.type,t.onAddPropertyToPanel&&t.onAddPropertyToPanel(o,i)||i.addWidget(a.widget||a.type,o,s,a,e)}i.addSeparator(),t.onShowCustomPanelInfo&&t.onShowCustomPanelInfo(i),i.footer.innerHTML="",i.addButton("Delete",(function(){t.block_delete||(t.graph.remove(t),i.close())})).classList.add("delete")}n.node_panel=i,i.id="node-panel",i.node=t,i.classList.add("settings"),i.inner_showCodePad=function(e){i.classList.remove("settings"),i.classList.add("centered"),i.alt_content.innerHTML="<textarea class='code'></textarea>";var n=i.alt_content.querySelector("textarea"),o=function(){i.toggleAltContent(!1),i.toggleFooterVisibility(!0),n.parentNode.removeChild(n),i.classList.add("settings"),i.classList.remove("centered"),r()};n.value=t.properties[e],n.addEventListener("keydown",(function(i){"Enter"==i.code&&i.ctrlKey&&(t.setProperty(e,n.value),o())})),i.toggleAltContent(!0),i.toggleFooterVisibility(!1),n.style.height="calc(100% - 40px)";var s=i.addButton("Assign",(function(){t.setProperty(e,n.value),o()}));i.alt_content.appendChild(s);var a=i.addButton("Close",o);a.style.float="right",i.alt_content.appendChild(a)},r(),this.canvas.parentNode.appendChild(i)},LGraphCanvas.prototype.showSubgraphPropertiesDialog=function(t){console.log("showing subgraph properties dialog");var e=this.canvas.parentNode.querySelector(".subgraph_dialog");e&&e.close();var n=this.createPanel("Subgraph Inputs",{closable:!0,width:500});function i(){if(n.clear(),t.inputs)for(var e=0;e<t.inputs.length;++e){var r=t.inputs[e];if(!r.not_subgraph_input){var o=n.addHTML("<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>","subgraph_property");o.dataset.name=r.name,o.dataset.slot=e,o.querySelector(".name").innerText=r.name,o.querySelector(".type").innerText=r.type,o.querySelector("button").addEventListener("click",(function(e){t.removeInput(Number(this.parentNode.dataset.slot)),i()}))}}}return n.node=t,n.classList.add("subgraph_dialog"),n.addHTML(" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>","subgraph_property extra",!0).querySelector("button").addEventListener("click",(function(e){var n=this.parentNode,r=n.querySelector(".name").value,o=n.querySelector(".type").value;r&&-1==t.findInputSlot(r)&&(t.addInput(r,o),n.querySelector(".name").value="",n.querySelector(".type").value="",i())})),i(),this.canvas.parentNode.appendChild(n),n},LGraphCanvas.prototype.showSubgraphPropertiesDialogRight=function(t){var e=this.canvas.parentNode.querySelector(".subgraph_dialog");e&&e.close();var n=this.createPanel("Subgraph Outputs",{closable:!0,width:500});function i(){if(n.clear(),t.outputs)for(var e=0;e<t.outputs.length;++e){var r=t.outputs[e];if(!r.not_subgraph_output){var o=n.addHTML("<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>","subgraph_property");o.dataset.name=r.name,o.dataset.slot=e,o.querySelector(".name").innerText=r.name,o.querySelector(".type").innerText=r.type,o.querySelector("button").addEventListener("click",(function(e){t.removeOutput(Number(this.parentNode.dataset.slot)),i()}))}}}n.node=t,n.classList.add("subgraph_dialog");var r=n.addHTML(" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>","subgraph_property extra",!0);function o(){var e=this.parentNode,n=e.querySelector(".name").value,r=e.querySelector(".type").value;n&&-1==t.findOutputSlot(n)&&(t.addOutput(n,r),e.querySelector(".name").value="",e.querySelector(".type").value="",i())}return r.querySelector(".name").addEventListener("keydown",(function(t){13==t.keyCode&&o.apply(this)})),r.querySelector("button").addEventListener("click",(function(t){o.apply(this)})),i(),this.canvas.parentNode.appendChild(n),n},LGraphCanvas.prototype.checkPanels=function(){if(this.canvas)for(var t=this.canvas.parentNode.querySelectorAll(".litegraph.dialog"),e=0;e<t.length;++e){var n=t[e];n.node&&(n.node.graph&&n.graph==this.graph||n.close())}},LGraphCanvas.onMenuNodeCollapse=function(t,e,n,i,r){r.graph.beforeChange();var o=function(t){t.collapse()},s=LGraphCanvas.active_canvas;if(!s.selected_nodes||Object.keys(s.selected_nodes).length<=1)o(r);else for(var a in s.selected_nodes)o(s.selected_nodes[a]);r.graph.afterChange()},LGraphCanvas.onMenuNodePin=function(t,e,n,i,r){r.pin()},LGraphCanvas.onMenuNodeMode=function(t,e,n,i,r){return new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:n,callback:function(t){if(r){var e=Object.values(LiteGraph.NODE_MODES).indexOf(t),n=function(n){e>=0&&LiteGraph.NODE_MODES[e]?n.changeMode(e):(console.warn("unexpected mode: "+t),n.changeMode(LiteGraph.ALWAYS))},i=LGraphCanvas.active_canvas;if(!i.selected_nodes||Object.keys(i.selected_nodes).length<=1)n(r);else for(var o in i.selected_nodes)n(i.selected_nodes[o])}},parentMenu:i,node:r}),!1},LGraphCanvas.onMenuNodeColors=function(t,e,n,i,r){if(!r)throw"no node for color";var o=[];for(var s in o.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"}),LGraphCanvas.node_colors){var a=LGraphCanvas.node_colors[s];t={value:s,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+a.color+"; background-color:"+a.bgcolor+"'>"+s+"</span>"},o.push(t)}return new LiteGraph.ContextMenu(o,{event:n,callback:function(t){if(r){var e=t.value?LGraphCanvas.node_colors[t.value]:null,n=function(t){e?t.constructor===LiteGraph.LGraphGroup?t.color=e.groupcolor:(t.color=e.color,t.bgcolor=e.bgcolor):(delete t.color,delete t.bgcolor)},i=LGraphCanvas.active_canvas;if(!i.selected_nodes||Object.keys(i.selected_nodes).length<=1)n(r);else for(var o in i.selected_nodes)n(i.selected_nodes[o]);r.setDirtyCanvas(!0,!0)}},parentMenu:i,node:r}),!1},LGraphCanvas.onMenuNodeShapes=function(t,e,n,i,r){if(!r)throw"no node passed";return new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:n,callback:function(t){if(r){r.graph.beforeChange();var e=function(e){e.shape=t},n=LGraphCanvas.active_canvas;if(!n.selected_nodes||Object.keys(n.selected_nodes).length<=1)e(r);else for(var i in n.selected_nodes)e(n.selected_nodes[i]);r.graph.afterChange(),r.setDirtyCanvas(!0)}},parentMenu:i,node:r}),!1},LGraphCanvas.onMenuNodeRemove=function(t,e,n,i,r){if(!r)throw"no node passed";var o=r.graph;o.beforeChange();var s=function(t){!1!==t.removable&&o.remove(t)},a=LGraphCanvas.active_canvas;if(!a.selected_nodes||Object.keys(a.selected_nodes).length<=1)s(r);else for(var u in a.selected_nodes)s(a.selected_nodes[u]);o.afterChange(),r.setDirtyCanvas(!0,!0)},LGraphCanvas.onMenuNodeToSubgraph=function(t,e,n,i,r){var o=r.graph,s=LGraphCanvas.active_canvas;if(s){var a=Object.values(s.selected_nodes||{});a.length||(a=[r]);var u=LiteGraph.createNode("graph/subgraph");u.pos=r.pos.concat(),o.add(u),u.buildFromNodes(a),s.deselectAllNodes(),r.setDirtyCanvas(!0,!0)}},LGraphCanvas.onMenuNodeClone=function(t,e,n,i,r){r.graph.beforeChange();var o={},s=function(t){if(!1!==t.clonable){var e=t.clone();e&&(e.pos=[t.pos[0]+5,t.pos[1]+5],t.graph.add(e),o[e.id]=e)}},a=LGraphCanvas.active_canvas;if(!a.selected_nodes||Object.keys(a.selected_nodes).length<=1)s(r);else for(var u in a.selected_nodes)s(a.selected_nodes[u]);Object.keys(o).length&&a.selectNodes(o),r.graph.afterChange(),r.setDirtyCanvas(!0,!0)},LGraphCanvas.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}},LGraphCanvas.prototype.getCanvasMenuOptions=function(){var t=null;if(this.getMenuOptions?t=this.getMenuOptions():(t=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],Object.keys(this.selected_nodes).length>1&&t.push({content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&t.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var e=this.getExtraMenuOptions(this,t);e&&(t=t.concat(e))}return t},LGraphCanvas.prototype.getNodeMenuOptions=function(t){var e=null;if(t.getMenuOptions?e=t.getMenuOptions(this):(e=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],!1!==t.resizable&&e.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),e.push({content:"Collapse",callback:LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null)),t.onGetInputs){var n=t.onGetInputs();n&&n.length&&(e[0].disabled=!1)}if(t.onGetOutputs){var i=t.onGetOutputs();i&&i.length&&(e[1].disabled=!1)}if(t.getExtraMenuOptions){var r=t.getExtraMenuOptions(this,e);r&&(r.push(null),e=r.concat(e))}return!1!==t.clonable&&e.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&e.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign}),e.push(null,{content:"Remove",disabled:!(!1!==t.removable&&!t.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),t.graph&&t.graph.onGetNodeMenuOptions&&t.graph.onGetNodeMenuOptions(e,t),e},LGraphCanvas.prototype.getGroupMenuOptions=function(t){return[{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}]},LGraphCanvas.prototype.processContextMenu=function(t,e){var n=this,i=LGraphCanvas.active_canvas.getCanvasWindow(),r=null,o={event:e,callback:function(e,i,r){if(e){if("Remove Slot"==e.content){var o=e.slot;return t.graph.beforeChange(),o.input?t.removeInput(o.slot):o.output&&t.removeOutput(o.slot),void t.graph.afterChange()}if("Disconnect Links"==e.content)return o=e.slot,t.graph.beforeChange(),o.output?t.disconnectOutput(o.slot):o.input&&t.disconnectInput(o.slot),void t.graph.afterChange();if("Rename Slot"==e.content){var s=(o=e.slot).input?t.getInputInfo(o.slot):t.getOutputInfo(o.slot),a=n.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",i),u=a.querySelector("input");u&&s&&(u.value=s.label||"");var l=function(){t.graph.beforeChange(),u.value&&(s&&(s.label=u.value),n.setDirty(!0)),a.close(),t.graph.afterChange()};a.querySelector("button").addEventListener("click",l),u.addEventListener("keydown",(function(t){if(a.is_modified=!0,27==t.keyCode)a.close();else if(13==t.keyCode)l();else if(13!=t.keyCode&&"textarea"!=t.target.localName)return;t.preventDefault(),t.stopPropagation()})),u.focus()}}},extra:t};t&&(o.title=t.type);var s=null;if(t&&(s=t.getSlotInPosition(e.canvasX,e.canvasY),LGraphCanvas.active_node=t),s){if(r=[],t.getSlotMenuOptions)r=t.getSlotMenuOptions(s);else{s&&s.output&&s.output.links&&s.output.links.length&&r.push({content:"Disconnect Links",slot:s});var a=s.input||s.output;a.removable&&r.push(a.locked?"Cannot remove":{content:"Remove Slot",slot:s}),a.nameLocked||r.push({content:"Rename Slot",slot:s})}o.title=(s.input?s.input.type:s.output.type)||"*",s.input&&s.input.type==LiteGraph.ACTION&&(o.title="Action"),s.output&&s.output.type==LiteGraph.EVENT&&(o.title="Event")}else if(t)r=this.getNodeMenuOptions(t);else{r=this.getCanvasMenuOptions();var u=this.graph.getGroupOnPos(e.canvasX,e.canvasY);u&&r.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:u,options:this.getGroupMenuOptions(u)}})}r&&new LiteGraph.ContextMenu(r,o,i)},LiteGraph.compareObjects=compareObjects,LiteGraph.distance=distance,LiteGraph.colorToString=colorToString,LiteGraph.isInsideRectangle=isInsideRectangle,LiteGraph.growBounding=growBounding,LiteGraph.isInsideBounding=isInsideBounding,LiteGraph.overlapBounding=overlapBounding,LiteGraph.hex2num=hex2num,LiteGraph.num2hex=num2hex,ContextMenu.prototype.addItem=function(t,e,n){var i=this;n=n||{};var r=document.createElement("div");r.className="litemenu-entry submenu";var o=!1;function s(t){var e=this.value,r=!0;if(i.current_submenu&&i.current_submenu.close(t),n.callback&&!0===n.callback.call(this,e,n,t,i,n.node)&&(r=!1),e&&(e.callback&&!n.ignore_item_callbacks&&!0!==e.disabled&&!0===e.callback.call(this,e,n,t,i,n.extra)&&(r=!1),e.submenu)){if(!e.submenu.options)throw"ContextMenu submenu needs options";new i.constructor(e.submenu.options,{callback:e.submenu.callback,event:t,parentMenu:i,ignore_item_callbacks:e.submenu.ignore_item_callbacks,title:e.submenu.title,extra:e.submenu.extra,autoopen:n.autoopen}),r=!1}r&&!i.lock&&i.close()}return null===e?r.classList.add("separator"):(r.innerHTML=e&&e.title?e.title:t,r.value=e,e&&(e.disabled&&(o=!0,r.classList.add("disabled")),(e.submenu||e.has_submenu)&&r.classList.add("has_submenu")),"function"==typeof e?(r.dataset.value=t,r.onclick_callback=e):r.dataset.value=e,e.className&&(r.className+=" "+e.className)),this.root.appendChild(r),o||r.addEventListener("click",s),!o&&n.autoopen&&LiteGraph.pointerListenerAdd(r,"enter",(function(t){var e=this.value;e&&e.has_submenu&&s.call(this,t)})),r},ContextMenu.prototype.close=function(t,e){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.parentMenu&&!e&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,void 0===t?this.parentMenu.close():t&&!ContextMenu.isCursorOverElement(t,this.parentMenu.root)&&ContextMenu.trigger(this.parentMenu.root,LiteGraph.pointerevents_method+"leave",t)),this.current_submenu&&this.current_submenu.close(t,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer)},ContextMenu.trigger=function(t,e,n,i){var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,!0,!0,n),r.srcElement=i,t.dispatchEvent?t.dispatchEvent(r):t.__events&&t.__events.dispatchEvent(r),r},ContextMenu.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this},ContextMenu.prototype.getFirstEvent=function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event},ContextMenu.isCursorOverElement=function(t,e){var n=t.clientX,i=t.clientY,r=e.getBoundingClientRect();return!!r&&i>r.top&&i<r.top+r.height&&n>r.left&&n<r.left+r.width},LiteGraph.ContextMenu=ContextMenu,LiteGraph.closeAllContextMenus=function(t){var e=(t=t||window).document.querySelectorAll(".litecontextmenu");if(e.length){for(var n=[],i=0;i<e.length;i++)n.push(e[i]);for(i=0;i<n.length;i++)n[i].close?n[i].close():n[i].parentNode&&n[i].parentNode.removeChild(n[i])}},LiteGraph.extendClass=function(t,e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n]);if(e.prototype)for(var n in e.prototype)e.prototype.hasOwnProperty(n)&&(t.prototype.hasOwnProperty(n)||(e.prototype.__lookupGetter__(n)?t.prototype.__defineGetter__(n,e.prototype.__lookupGetter__(n)):t.prototype[n]=e.prototype[n],e.prototype.__lookupSetter__(n)&&t.prototype.__defineSetter__(n,e.prototype.__lookupSetter__(n))))},CurveEditor.sampleCurve=function(t,e){if(e){for(var n=0;n<e.length-1;++n){var i=e[n],r=e[n+1];if(!(r[0]<t)){var o=r[0]-i[0];if(Math.abs(o)<1e-5)return i[1];var s=(t-i[0])/o;return i[1]*(1-s)+r[1]*s}}return 0}},CurveEditor.prototype.draw=function(t,e,n,i,r,o){var s=this.points;if(s){this.size=e;var a=e[0]-2*this.margin,u=e[1]-2*this.margin;r=r||"#666",t.save(),t.translate(this.margin,this.margin),i&&(t.fillStyle="#111",t.fillRect(0,0,a,u),t.fillStyle="#222",t.fillRect(.5*a,0,1,u),t.strokeStyle="#333",t.strokeRect(0,0,a,u)),t.strokeStyle=r,o&&(t.globalAlpha=.5),t.beginPath();for(var l=0;l<s.length;++l){var p=s[l];t.lineTo(p[0]*a,(1-p[1])*u)}if(t.stroke(),t.globalAlpha=1,!o)for(l=0;l<s.length;++l)p=s[l],t.fillStyle=this.selected==l?"#FFF":this.nearest==l?"#DDD":"#AAA",t.beginPath(),t.arc(p[0]*a,(1-p[1])*u,2,0,2*Math.PI),t.fill();t.restore()}},CurveEditor.prototype.onMouseDown=function(t,e){var n=this.points;if(n&&!(t[1]<0)){var i=this.size[0]-2*this.margin,r=this.size[1]-2*this.margin,o=t[0]-this.margin,s=t[1]-this.margin,a=[o,s],u=30/e.ds.scale;if(this.selected=this.getCloserPoint(a,u),-1==this.selected){var l=[o/i,1-s/r];n.push(l),n.sort((function(t,e){return t[0]-e[0]})),this.selected=n.indexOf(l),this.must_update=!0}return-1!=this.selected||void 0}},CurveEditor.prototype.onMouseMove=function(t,e){var n=this.points;if(n){var i=this.selected;if(!(i<0)){var r=(t[0]-this.margin)/(this.size[0]-2*this.margin),o=(t[1]-this.margin)/(this.size[1]-2*this.margin),s=[t[0]-this.margin,t[1]-this.margin],a=30/e.ds.scale;this._nearest=this.getCloserPoint(s,a);var u=n[i];if(u){var l=0==i||i==n.length-1;if(!l&&(t[0]<-10||t[0]>this.size[0]+10||t[1]<-10||t[1]>this.size[1]+10))return n.splice(i,1),void(this.selected=-1);u[0]=l?0==i?0:1:clamp(r,0,1),u[1]=1-clamp(o,0,1),n.sort((function(t,e){return t[0]-e[0]})),this.selected=n.indexOf(u),this.must_update=!0}}}},CurveEditor.prototype.onMouseUp=function(t,e){return this.selected=-1,!1},CurveEditor.prototype.getCloserPoint=function(t,e){var n=this.points;if(!n)return-1;e=e||30;for(var i=this.size[0]-2*this.margin,r=this.size[1]-2*this.margin,o=n.length,s=[0,0],a=1e6,u=-1,l=0;l<o;++l){var p=n[l];s[0]=p[0]*i,s[1]=(1-p[1])*r,s[0],t[0];var h=vec2.distance(t,s);h>a||h>e||(u=l,a=h)}return u},LiteGraph.CurveEditor=CurveEditor,LiteGraph.getParameterNames=function(t){return(t+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},LiteGraph.pointerListenerAdd=function(t,e,n,i=!1){if(t&&t.addEventListener&&e&&"function"==typeof n){var r=LiteGraph.pointerevents_method,o=e;if("pointer"==r&&!window.PointerEvent)switch(console.warn("sMethod=='pointer' && !window.PointerEvent"),console.log("Converting pointer["+o+"] : down move up cancel enter TO touchstart touchmove touchend, etc .."),o){case"down":r="touch",o="start";break;case"move":case"cancel":r="touch";break;case"up":r="touch",o="end";break;case"enter":console.log("debug: Should I send a move event?");break;default:console.warn("PointerEvent not available in this browser ? The event "+o+" would not be called")}switch(o){case"down":case"up":case"move":case"over":case"out":case"enter":t.addEventListener(r+o,n,i);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if("mouse"!=r)return t.addEventListener(r+o,n,i);default:return t.addEventListener(o,n,i)}}},LiteGraph.pointerListenerRemove=function(t,e,n,i=!1){if(t&&t.removeEventListener&&e&&"function"==typeof n)switch(e){case"down":case"up":case"move":case"over":case"out":case"enter":"pointer"!=LiteGraph.pointerevents_method&&"mouse"!=LiteGraph.pointerevents_method||t.removeEventListener(LiteGraph.pointerevents_method+e,n,i);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if("pointer"==LiteGraph.pointerevents_method)return t.removeEventListener(LiteGraph.pointerevents_method+e,n,i);default:return t.removeEventListener(e,n,i)}},global.clamp=clamp,"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)})})(this),exports.LiteGraph=this.LiteGraph,exports.LGraph=this.LGraph,exports.LLink=this.LLink,exports.LGraphNode=this.LGraphNode,exports.LGraphGroup=this.LGraphGroup,exports.DragAndScale=this.DragAndScale,exports.LGraphCanvas=this.LGraphCanvas,exports.ContextMenu=this.ContextMenu,function(t){var e=t.LiteGraph;function n(){this.addOutput("in ms","number"),this.addOutput("in sec","number")}function i(){this.size=[140,80],this.properties={enabled:!0},this.enabled=!0,this.subgraph=new e.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onTrigger=this.onSubgraphTrigger.bind(this),this.subgraph.onInputAdded=this.onSubgraphNewInput.bind(this),this.subgraph.onInputRenamed=this.onSubgraphRenamedInput.bind(this),this.subgraph.onInputTypeChanged=this.onSubgraphTypeChangeInput.bind(this),this.subgraph.onInputRemoved=this.onSubgraphRemovedInput.bind(this),this.subgraph.onOutputAdded=this.onSubgraphNewOutput.bind(this),this.subgraph.onOutputRenamed=this.onSubgraphRenamedOutput.bind(this),this.subgraph.onOutputTypeChanged=this.onSubgraphTypeChangeOutput.bind(this),this.subgraph.onOutputRemoved=this.onSubgraphRemovedOutput.bind(this)}function r(){this.addOutput("","number"),this.name_in_graph="",this.properties={name:"",type:"number",value:0};var t=this;this.name_widget=this.addWidget("text","Name",this.properties.name,(function(e){e&&t.setProperty("name",e)})),this.type_widget=this.addWidget("text","Type",this.properties.type,(function(e){t.setProperty("type",e)})),this.value_widget=this.addWidget("number","Value",this.properties.value,(function(e){t.setProperty("value",e)})),this.widgets_up=!0,this.size=[180,90]}function o(){this.addInput("",""),this.name_in_graph="",this.properties={name:"",type:""},this.name_widget=this.addWidget("text","Name",this.properties.name,"name"),this.type_widget=this.addWidget("text","Type",this.properties.type,"type"),this.widgets_up=!0,this.size=[180,60]}function s(){this.addOutput("value","number"),this.addProperty("value",1),this.widget=this.addWidget("number","value",1,"value"),this.widgets_up=!0,this.size=[180,30]}function a(){this.addOutput("bool","boolean"),this.addProperty("value",!0),this.widget=this.addWidget("toggle","value",!0,"value"),this.serialize_widgets=!0,this.widgets_up=!0,this.size=[140,30]}function u(){this.addOutput("string","string"),this.addProperty("value",""),this.widget=this.addWidget("text","value","","value"),this.widgets_up=!0,this.size=[180,30]}function l(){this.addOutput("obj","object"),this.size=[120,30],this._object={}}function p(){this.addInput("url","string"),this.addOutput("file","string"),this.addProperty("url",""),this.addProperty("type","text"),this.widget=this.addWidget("text","url","","url"),this._data=null}function h(){this.addInput("parse",e.ACTION),this.addInput("json","string"),this.addOutput("done",e.EVENT),this.addOutput("object","object"),this.widget=this.addWidget("button","parse","",this.parse.bind(this)),this._str=null,this._obj=null}function c(){this.addOutput("data","object"),this.addProperty("value",""),this.widget=this.addWidget("text","json","","value"),this.widgets_up=!0,this.size=[140,30],this._value=null}function d(){this._value=[],this.addInput("json",""),this.addOutput("arrayOut","array"),this.addOutput("length","number"),this.addProperty("value","[]"),this.widget=this.addWidget("text","array",this.properties.value,"value"),this.widgets_up=!0,this.size=[140,50]}function f(){this.addInput("arr","array"),this.addInput("value",""),this.addOutput("arr","array"),this.properties={index:0},this.widget=this.addWidget("number","i",this.properties.index,"index",{precision:0,step:10,min:0})}function g(){this.addInput("array","array,table,string"),this.addInput("index","number"),this.addOutput("value",""),this.addProperty("index",0)}function _(){this.addInput("table","table"),this.addInput("row","number"),this.addInput("col","number"),this.addOutput("value",""),this.addProperty("row",0),this.addProperty("column",0)}function v(){this.addInput("obj","object"),this.addOutput("property",0),this.addProperty("value",0),this.widget=this.addWidget("text","prop.","",this.setValue.bind(this)),this.widgets_up=!0,this.size=[140,30],this._value=null}function m(){this.addInput("obj",""),this.addOutput("keys","array"),this.size=[140,30]}function y(){this.addInput("obj",""),this.addInput("value",""),this.addOutput("obj",""),this.properties={property:""},this.name_widget=this.addWidget("text","prop.",this.properties.property,"property")}function b(){this.addInput("A","object"),this.addInput("B","object"),this.addOutput("out","object"),this._result={};var t=this;this.addWidget("button","clear","",(function(){t._result={}})),this.size=this.computeSize()}function x(){this.size=[60,30],this.addInput("in"),this.addOutput("out"),this.properties={varname:"myname",container:x.LITEGRAPH},this.value=null}function A(){this.size=[60,30],this.addInput("data",0),this.addInput("download",e.ACTION),this.properties={filename:"data.json"},this.value=null;var t=this;this.addWidget("button","Download","",(function(e){t.value&&t.downloadAsFile()}))}function w(){this.size=[60,30],this.addInput("value",0,{label:""}),this.value=0}function E(){this.addInput("in",0),this.addOutput("out",0),this.size=[40,30]}function C(){this.mode=e.ON_EVENT,this.size=[80,30],this.addProperty("msg",""),this.addInput("log",e.EVENT),this.addInput("msg",0)}function T(){this.mode=e.ON_EVENT,this.addProperty("msg",""),this.addInput("",e.EVENT),this.widget=this.addWidget("text","Text","","msg"),this.widgets_up=!0,this.size=[200,30]}function O(){this.size=[60,30],this.addProperty("onExecute","return A;"),this.addInput("A",0),this.addInput("B",0),this.addOutput("out",0),this._func=null,this.data={}}function S(){this.addInput("A",0),this.addInput("B",0),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","==","enum",{values:S.values}),this.addWidget("combo","Op.",this.properties.OP,{property:"OP",values:S.values}),this.size=[80,60]}n.title="Time",n.desc="Time",n.prototype.onExecute=function(){this.setOutputData(0,1e3*this.graph.globaltime),this.setOutputData(1,this.graph.globaltime)},e.registerNodeType("basic/time",n),i.title="Subgraph",i.desc="Graph inside a node",i.title_color="#334",i.prototype.onGetInputs=function(){return[["enabled","boolean"]]},i.prototype.onDblClick=function(t,e,n){var i=this;setTimeout((function(){n.openSubgraph(i.subgraph)}),10)},i.prototype.onAction=function(t,e){this.subgraph.onAction(t,e)},i.prototype.onExecute=function(){if(this.enabled=this.getInputOrProperty("enabled"),this.enabled){if(this.inputs)for(var t=0;t<this.inputs.length;t++){var e=this.inputs[t],n=this.getInputData(t);this.subgraph.setInputData(e.name,n)}if(this.subgraph.runStep(),this.outputs)for(t=0;t<this.outputs.length;t++){var i=this.outputs[t];n=this.subgraph.getOutputData(i.name),this.setOutputData(t,n)}}},i.prototype.sendEventToAllNodes=function(t,e,n){this.enabled&&this.subgraph.sendEventToAllNodes(t,e,n)},i.prototype.onDrawBackground=function(t,n,i,r){if(this.flags.collapsed)return;var o=this.size[1]-e.NODE_TITLE_HEIGHT+.5,s=e.isInsideRectangle(r[0],r[1],this.pos[0],this.pos[1]+o,this.size[0],e.NODE_TITLE_HEIGHT);let a=e.isInsideRectangle(r[0],r[1],this.pos[0],this.pos[1]+o,this.size[0]/2,e.NODE_TITLE_HEIGHT);t.fillStyle=s?"#555":"#222",t.beginPath(),this._shape==e.BOX_SHAPE?a?t.rect(0,o,this.size[0]/2+1,e.NODE_TITLE_HEIGHT):t.rect(this.size[0]/2,o,this.size[0]/2+1,e.NODE_TITLE_HEIGHT):a?t.roundRect(0,o,this.size[0]/2+1,e.NODE_TITLE_HEIGHT,[0,0,8,8]):t.roundRect(this.size[0]/2,o,this.size[0]/2+1,e.NODE_TITLE_HEIGHT,[0,0,8,8]),s?t.fill():t.fillRect(0,o,this.size[0]+1,e.NODE_TITLE_HEIGHT),t.textAlign="center",t.font="24px Arial",t.fillStyle=s?"#DDD":"#999",t.fillText("+",.25*this.size[0],o+24),t.fillText("+",.75*this.size[0],o+24)},i.prototype.onMouseDown=function(t,n,i){var r=this.size[1]-e.NODE_TITLE_HEIGHT+.5;console.log(0),n[1]>r&&(n[0]<this.size[0]/2?(console.log(1),i.showSubgraphPropertiesDialog(this)):(console.log(2),i.showSubgraphPropertiesDialogRight(this)))},i.prototype.computeSize=function(){var t=this.inputs?this.inputs.length:0,n=this.outputs?this.outputs.length:0;return[200,Math.max(t,n)*e.NODE_SLOT_HEIGHT+e.NODE_TITLE_HEIGHT]},i.prototype.onSubgraphTrigger=function(t,e){var n=this.findOutputSlot(t);-1!=n&&this.triggerSlot(n)},i.prototype.onSubgraphNewInput=function(t,e){-1==this.findInputSlot(t)&&this.addInput(t,e)},i.prototype.onSubgraphRenamedInput=function(t,e){var n=this.findInputSlot(t);-1!=n&&(this.getInputInfo(n).name=e)},i.prototype.onSubgraphTypeChangeInput=function(t,e){var n=this.findInputSlot(t);-1!=n&&(this.getInputInfo(n).type=e)},i.prototype.onSubgraphRemovedInput=function(t){var e=this.findInputSlot(t);-1!=e&&this.removeInput(e)},i.prototype.onSubgraphNewOutput=function(t,e){-1==this.findOutputSlot(t)&&this.addOutput(t,e)},i.prototype.onSubgraphRenamedOutput=function(t,e){var n=this.findOutputSlot(t);-1!=n&&(this.getOutputInfo(n).name=e)},i.prototype.onSubgraphTypeChangeOutput=function(t,e){var n=this.findOutputSlot(t);-1!=n&&(this.getOutputInfo(n).type=e)},i.prototype.onSubgraphRemovedOutput=function(t){var e=this.findOutputSlot(t);-1!=e&&this.removeOutput(e)},i.prototype.getExtraMenuOptions=function(t){var e=this;return[{content:"Open",callback:function(){t.openSubgraph(e.subgraph)}}]},i.prototype.onResize=function(t){t[1]+=20},i.prototype.serialize=function(){var t=e.LGraphNode.prototype.serialize.call(this);return t.subgraph=this.subgraph.serialize(),t},i.prototype.reassignSubgraphUUIDs=function(t){const n={nodeIDs:{},linkIDs:{}};for(const i of t.nodes){const t=i.id,r=e.uuidv4();if(i.id=r,n.nodeIDs[t]||n.nodeIDs[r])throw new Error(`New/old node UUID wasn't unique in changed map! ${t} ${r}`);n.nodeIDs[t]=r,n.nodeIDs[r]=t}for(const i of t.links){const t=i[0],r=e.uuidv4();if(i[0]=r,n.linkIDs[t]||n.linkIDs[r])throw new Error(`New/old link UUID wasn't unique in changed map! ${t} ${r}`);n.linkIDs[t]=r,n.linkIDs[r]=t;const o=i[1],s=i[3];if(!n.nodeIDs[o])throw new Error(`Old node UUID not found in mapping! ${o}`);if(i[1]=n.nodeIDs[o],!n.nodeIDs[s])throw new Error(`Old node UUID not found in mapping! ${s}`);i[3]=n.nodeIDs[s]}for(const e of t.nodes){if(e.inputs)for(const t of e.inputs)t.link&&(t.link=n.linkIDs[t.link]);if(e.outputs)for(const t of e.outputs)t.links&&(t.links=t.links.map((t=>n.linkIDs[t])))}for(const e of t.nodes)if("graph/subgraph"===e.type){const t=reassignGraphUUIDs(e.subgraph);n.nodeIDs.assign(t.nodeIDs),n.linkIDs.assign(t.linkIDs)}},i.prototype.clone=function(){var t=e.createNode(this.type),n=this.serialize();if(e.use_uuids){const t=e.cloneObject(n.subgraph);this.reassignSubgraphUUIDs(t),n.subgraph=t}return delete n.id,delete n.inputs,delete n.outputs,t.configure(n),t},i.prototype.buildFromNodes=function(t){for(var e={},n=0,i=0;i<t.length;++i)e[(r=t[i]).id]=r,n=Math.min(r.pos[0],n),Math.max(r.pos[0],n);for(i=0;i<t.length;++i){var r;if((r=t[i]).inputs)for(var o=0;o<r.inputs.length;++o){var s=r.inputs[o];s&&s.link&&(l=r.graph.links[s.link])&&(e[l.origin_id]||this.subgraph.addInput(s.name,l.type))}if(r.outputs)for(o=0;o<r.outputs.length;++o){var a=r.outputs[o];if(a&&a.links&&a.links.length)for(var u=0;u<a.links.length;++u){var l;if((l=r.graph.links[a.links[u]])&&!e[l.target_id])break}}}},e.Subgraph=i,e.registerNodeType("graph/subgraph",i),r.title="Input",r.desc="Input of the graph",r.prototype.onConfigure=function(){this.updateType()},r.prototype.updateType=function(){var t=this.properties.type;this.type_widget.value=t,this.outputs[0].type!=t&&(e.isValidConnection(this.outputs[0].type,t)||this.disconnectOutput(0),this.outputs[0].type=t),"number"==t?(this.value_widget.type="number",this.value_widget.value=0):"boolean"==t?(this.value_widget.type="toggle",this.value_widget.value=!0):"string"==t?(this.value_widget.type="text",this.value_widget.value=""):(this.value_widget.type=null,this.value_widget.value=null),this.properties.value=this.value_widget.value,this.graph&&this.name_in_graph&&this.graph.changeInputType(this.name_in_graph,t)},r.prototype.onPropertyChanged=function(t,e){if("name"==t){if(""==e||e==this.name_in_graph||"enabled"==e)return!1;this.graph&&(this.name_in_graph?this.graph.renameInput(this.name_in_graph,e):this.graph.addInput(e,this.properties.type)),this.name_widget.value=e,this.name_in_graph=e}else"type"==t&&this.updateType()},r.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},r.prototype.onAction=function(t,n){this.properties.type==e.EVENT&&this.triggerSlot(0,n)},r.prototype.onExecute=function(){var t=this.properties.name,e=this.graph.inputs[t];e?this.setOutputData(0,void 0!==e.value?e.value:this.properties.value):this.setOutputData(0,this.properties.value)},r.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeInput(this.name_in_graph)},e.GraphInput=r,e.registerNodeType("graph/input",r),o.title="Output",o.desc="Output of the graph",o.prototype.onPropertyChanged=function(t,e){if("name"==t){if(""==e||e==this.name_in_graph||"enabled"==e)return!1;this.graph&&(this.name_in_graph?this.graph.renameOutput(this.name_in_graph,e):this.graph.addOutput(e,this.properties.type)),this.name_widget.value=e,this.name_in_graph=e}else"type"==t&&this.updateType()},o.prototype.updateType=function(){var t=this.properties.type;this.type_widget&&(this.type_widget.value=t),this.inputs[0].type!=t&&("action"!=t&&"event"!=t||(t=e.EVENT),e.isValidConnection(this.inputs[0].type,t)||this.disconnectInput(0),this.inputs[0].type=t),this.graph&&this.name_in_graph&&this.graph.changeOutputType(this.name_in_graph,t)},o.prototype.onExecute=function(){this._value=this.getInputData(0),this.graph.setOutputData(this.properties.name,this._value)},o.prototype.onAction=function(t,n){this.properties.type==e.ACTION&&this.graph.trigger(this.properties.name,n)},o.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeOutput(this.name_in_graph)},o.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},e.GraphOutput=o,e.registerNodeType("graph/output",o),s.title="Const Number",s.desc="Constant number",s.prototype.onExecute=function(){this.setOutputData(0,parseFloat(this.properties.value))},s.prototype.getTitle=function(){return this.flags.collapsed?this.properties.value:this.title},s.prototype.setValue=function(t){this.setProperty("value",t)},s.prototype.onDrawBackground=function(t){this.outputs[0].label=this.properties.value.toFixed(3)},e.registerNodeType("basic/const",s),a.title="Const Boolean",a.desc="Constant boolean",a.prototype.getTitle=s.prototype.getTitle,a.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},a.prototype.setValue=s.prototype.setValue,a.prototype.onGetInputs=function(){return[["toggle",e.ACTION]]},a.prototype.onAction=function(t){this.setValue(!this.properties.value)},e.registerNodeType("basic/boolean",a),u.title="Const String",u.desc="Constant string",u.prototype.getTitle=s.prototype.getTitle,u.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},u.prototype.setValue=s.prototype.setValue,u.prototype.onDropFile=function(t){var e=this,n=new FileReader;n.onload=function(t){e.setProperty("value",t.target.result)},n.readAsText(t)},e.registerNodeType("basic/string",u),l.title="Const Object",l.desc="Constant Object",l.prototype.onExecute=function(){this.setOutputData(0,this._object)},e.registerNodeType("basic/object",l),p.title="Const File",p.desc="Fetches a file from an url",p["@type"]={type:"enum",values:["text","arraybuffer","blob","json"]},p.prototype.onPropertyChanged=function(t,e){"url"==t&&(null==e||""==e?this._data=null:this.fetchFile(e))},p.prototype.onExecute=function(){var t=this.getInputData(0)||this.properties.url;!t||t==this._url&&this._type==this.properties.type||this.fetchFile(t),this.setOutputData(0,this._data)},p.prototype.setValue=s.prototype.setValue,p.prototype.fetchFile=function(t){var n=this;if(!t||t.constructor!==String)return n._data=null,void(n.boxcolor=null);this._url=t,this._type=this.properties.type,"http"==t.substr(0,4)&&e.proxy&&(t=e.proxy+t.substr(t.indexOf(":")+3)),fetch(t).then((function(t){if(!t.ok)throw new Error("File not found");return"arraybuffer"==n.properties.type?t.arrayBuffer():"text"==n.properties.type?t.text():"json"==n.properties.type?t.json():"blob"==n.properties.type?t.blob():void 0})).then((function(t){n._data=t,n.boxcolor="#AEA"})).catch((function(e){n._data=null,n.boxcolor="red",console.error("error fetching file:",t)}))},p.prototype.onDropFile=function(t){var e=this;this._url=t.name,this._type=this.properties.type,this.properties.url=t.name;var n=new FileReader;if(n.onload=function(t){e.boxcolor="#AEA";var n=t.target.result;"json"==e.properties.type&&(n=JSON.parse(n)),e._data=n},"arraybuffer"==e.properties.type)n.readAsArrayBuffer(t);else if("text"==e.properties.type||"json"==e.properties.type)n.readAsText(t);else if("blob"==e.properties.type)return n.readAsBinaryString(t)},e.registerNodeType("basic/file",p),h.title="JSON Parse",h.desc="Parses JSON String into object",h.prototype.parse=function(){if(this._str)try{this._str=this.getInputData(1),this._obj=JSON.parse(this._str),this.boxcolor="#AEA",this.triggerSlot(0)}catch(t){this.boxcolor="red"}},h.prototype.onExecute=function(){this._str=this.getInputData(1),this.setOutputData(1,this._obj)},h.prototype.onAction=function(t){"parse"==t&&this.parse()},e.registerNodeType("basic/jsonparse",h),c.title="Const Data",c.desc="Constant Data",c.prototype.onPropertyChanged=function(t,e){if(this.widget.value=e,null!=e&&""!=e)try{this._value=JSON.parse(e),this.boxcolor="#AEA"}catch(t){this.boxcolor="red"}},c.prototype.onExecute=function(){this.setOutputData(0,this._value)},c.prototype.setValue=s.prototype.setValue,e.registerNodeType("basic/data",c),d.title="Const Array",d.desc="Constant Array",d.prototype.onPropertyChanged=function(t,e){if(this.widget.value=e,null!=e&&""!=e)try{"["!=e[0]?this._value=JSON.parse("["+e+"]"):this._value=JSON.parse(e),this.boxcolor="#AEA"}catch(t){this.boxcolor="red"}},d.prototype.onExecute=function(){var t=this.getInputData(0);if(t&&t.length){this._value||(this._value=new Array),this._value.length=t.length;for(var e=0;e<t.length;++e)this._value[e]=t[e]}this.setOutputData(0,this._value),this.setOutputData(1,this._value&&this._value.length||0)},d.prototype.setValue=s.prototype.setValue,e.registerNodeType("basic/array",d),f.title="Set Array",f.desc="Sets index of array",f.prototype.onExecute=function(){var t=this.getInputData(0);if(t){var e=this.getInputData(1);void 0!==e&&(this.properties.index&&(t[Math.floor(this.properties.index)]=e),this.setOutputData(0,t))}},e.registerNodeType("basic/set_array",f),g.title="Array[i]",g.desc="Returns an element from an array",g.prototype.onExecute=function(){var t=this.getInputData(0),e=this.getInputData(1);null==e&&(e=this.properties.index),null!=t&&null!=e&&this.setOutputData(0,t[Math.floor(Number(e))])},e.registerNodeType("basic/array[]",g),_.title="Table[row][col]",_.desc="Returns an element from a table",_.prototype.onExecute=function(){var t=this.getInputData(0),e=this.getInputData(1),n=this.getInputData(2);null==e&&(e=this.properties.row),null==n&&(n=this.properties.column),null!=t&&null!=e&&null!=n&&((e=t[Math.floor(Number(e))])?this.setOutputData(0,e[Math.floor(Number(n))]):this.setOutputData(0,null))},e.registerNodeType("basic/table[][]",_),v.title="Object property",v.desc="Outputs the property of an object",v.prototype.setValue=function(t){this.properties.value=t,this.widget.value=t},v.prototype.getTitle=function(){return this.flags.collapsed?"in."+this.properties.value:this.title},v.prototype.onPropertyChanged=function(t,e){this.widget.value=e},v.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&this.setOutputData(0,t[this.properties.value])},e.registerNodeType("basic/object_property",v),m.title="Object keys",m.desc="Outputs an array with the keys of an object",m.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&this.setOutputData(0,Object.keys(t))},e.registerNodeType("basic/object_keys",m),y.title="Set Object",y.desc="Adds propertiesrty to object",y.prototype.onExecute=function(){var t=this.getInputData(0);if(t){var e=this.getInputData(1);void 0!==e&&(this.properties.property&&(t[this.properties.property]=e),this.setOutputData(0,t))}},e.registerNodeType("basic/set_object",y),b.title="Merge Objects",b.desc="Creates an object copying properties from others",b.prototype.onExecute=function(){var t=this.getInputData(0),e=this.getInputData(1),n=this._result;if(t)for(var i in t)n[i]=t[i];if(e)for(var i in e)n[i]=e[i];this.setOutputData(0,n)},e.registerNodeType("basic/merge_objects",b),x.title="Variable",x.desc="store/read variable value",x.LITEGRAPH=0,x.GRAPH=1,x.GLOBALSCOPE=2,x["@container"]={type:"enum",values:{litegraph:x.LITEGRAPH,graph:x.GRAPH,global:x.GLOBALSCOPE}},x.prototype.onExecute=function(){var t=this.getContainer();if(this.isInputConnected(0))return this.value=this.getInputData(0),t[this.properties.varname]=this.value,void this.setOutputData(0,this.value);this.setOutputData(0,t[this.properties.varname])},x.prototype.getContainer=function(){switch(this.properties.container){case x.GRAPH:return this.graph?this.graph.vars:{};case x.GLOBALSCOPE:return t;case x.LITEGRAPH:default:return e.Globals}},x.prototype.getTitle=function(){return this.properties.varname},e.registerNodeType("basic/variable",x),e.wrapFunctionAsNode("basic/length",(function(t){return t&&null!=t.length?Number(t.length):0}),[""],"number"),e.wrapFunctionAsNode("basic/not",(function(t){return!t}),[""],"boolean"),A.title="Download",A.desc="Download some data",A.prototype.downloadAsFile=function(){if(null!=this.value){var t;t=this.value.constructor===String?this.value:JSON.stringify(this.value);var e=new Blob([t]),n=URL.createObjectURL(e),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",this.properties.filename),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout((function(){URL.revokeObjectURL(n)}),6e4)}},A.prototype.onAction=function(t,e){var n=this;setTimeout((function(){n.downloadAsFile()}),100)},A.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},A.prototype.getTitle=function(){return this.flags.collapsed?this.properties.filename:this.title},e.registerNodeType("basic/download",A),w.title="Watch",w.desc="Show value of input",w.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},w.prototype.getTitle=function(){return this.flags.collapsed?this.inputs[0].label:this.title},w.toString=function(t){if(null==t)return"null";if(t.constructor===Number)return t.toFixed(3);if(t.constructor===Array){for(var e="[",n=0;n<t.length;++n)e+=w.toString(t[n])+(n+1!=t.length?",":"");return e+"]"}return String(t)},w.prototype.onDrawBackground=function(t){this.inputs[0].label=w.toString(this.value)},e.registerNodeType("basic/watch",w),E.title="Cast",E.desc="Allows to connect different types",E.prototype.onExecute=function(){this.setOutputData(0,this.getInputData(0))},e.registerNodeType("basic/cast",E),C.title="Console",C.desc="Show value inside the console",C.prototype.onAction=function(t,e){var n=this.getInputData(1);n||(n=this.properties.msg),n||(n="Event: "+e),"log"==t?console.log(n):"warn"==t?console.warn(n):"error"==t&&console.error(n)},C.prototype.onExecute=function(){var t=this.getInputData(1);t||(t=this.properties.msg),null!=t&&void 0!==t&&(this.properties.msg=t,console.log(t))},C.prototype.onGetInputs=function(){return[["log",e.ACTION],["warn",e.ACTION],["error",e.ACTION]]},e.registerNodeType("basic/console",C),T.title="Alert",T.desc="Show an alert window",T.color="#510",T.prototype.onConfigure=function(t){this.widget.value=t.properties.msg},T.prototype.onAction=function(t,e){var n=this.properties.msg;setTimeout((function(){alert(n)}),10)},e.registerNodeType("basic/alert",T),O.prototype.onConfigure=function(t){t.properties.onExecute&&e.allow_scripts?this.compileCode(t.properties.onExecute):console.warn("Script not compiled, LiteGraph.allow_scripts is false")},O.title="Script",O.desc="executes a code (max 256 characters)",O.widgets_info={onExecute:{type:"code"}},O.prototype.onPropertyChanged=function(t,n){"onExecute"==t&&e.allow_scripts?this.compileCode(n):console.warn("Script not compiled, LiteGraph.allow_scripts is false")},O.prototype.compileCode=function(t){if(this._func=null,t.length>256)console.warn("Script too long, max 256 chars");else{for(var e=t.toLowerCase(),n=["script","body","document","eval","nodescript","function"],i=0;i<n.length;++i)if(-1!=e.indexOf(n[i]))return void console.warn("invalid script");try{this._func=new Function("A","B","C","DATA","node",t)}catch(t){console.error("Error parsing script"),console.error(t)}}},O.prototype.onExecute=function(){if(this._func)try{var t=this.getInputData(0),e=this.getInputData(1),n=this.getInputData(2);this.setOutputData(0,this._func(t,e,n,this.data,this))}catch(t){console.error("Error in script"),console.error(t)}},O.prototype.onGetOutputs=function(){return[["C",""]]},e.registerNodeType("basic/script",O),S.values=["==","!="],S["@OP"]={type:"enum",title:"operation",values:S.values},S.title="Compare *",S.desc="evaluates condition between A and B",S.prototype.getTitle=function(){return"*A "+this.properties.OP+" *B"},S.prototype.onExecute=function(){var t=this.getInputData(0);void 0===t?t=this.properties.A:this.properties.A=t;var e=this.getInputData(1);void 0===e?e=this.properties.B:this.properties.B=e;var n=!1;if(typeof t==typeof e)switch(this.properties.OP){case"==":case"!=":switch(n=!0,typeof t){case"object":var i=Object.getOwnPropertyNames(t),r=Object.getOwnPropertyNames(e);if(i.length!=r.length){n=!1;break}for(var o=0;o<i.length;o++){var s=i[o];if(t[s]!==e[s]){n=!1;break}}break;default:n=t==e}"!="==this.properties.OP&&(n=!n)}this.setOutputData(0,n),this.setOutputData(1,!n)},e.registerNodeType("basic/CompareValues",S)}(this),function(t){var e=t.LiteGraph;function n(){this.size=[60,30],this.addInput("event",e.ACTION)}function i(){this.size=[60,30],this.addInput("if",""),this.addOutput("true",e.EVENT),this.addOutput("change",e.EVENT),this.addOutput("false",e.EVENT),this.properties={only_on_change:!0},this.prev=0}function r(){var t=this;this.addInput("",e.ACTION),this.addInput("",e.ACTION),this.addInput("",e.ACTION),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT),this.addWidget("button","+",null,(function(){t.addInput("",e.ACTION),t.addOutput("",e.EVENT)})),this.size=[90,70],this.flags={horizontal:!0,render_box:!1}}function o(){var t=this;this.addInput("",e.ACTION),this.addInput("",e.ACTION),this.addOutput("",e.EVENT),this.addWidget("button","+",null,(function(){t.addInput("",e.ACTION),t.size[0]=90})),this.size=[90,70],this.ready=[]}function s(){var t=this;this.properties={index:0},this.addInput("index","number"),this.addInput("step",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("index","number"),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT,{removable:!0}),this.addWidget("button","+",null,(function(){t.addOutput("",e.EVENT,{removable:!0})})),this.size=[120,120],this.flags={render_box:!1}}function a(){this.size=[60,30],this.addInput("event",e.ACTION),this.addOutput("event",e.EVENT),this.properties={equal_to:"",has_property:"",property_equal_to:""}}function u(){this.addInput("in",e.ACTION),this.addInput("cond","boolean"),this.addOutput("true",e.EVENT),this.addOutput("false",e.EVENT),this.size=[120,60],this._value=!1}function l(){this.addInput("inc",e.ACTION),this.addInput("dec",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("change",e.EVENT),this.addOutput("num","number"),this.addProperty("doCountExecution",!1,"boolean",{name:"Count Executions"}),this.addWidget("toggle","Count Exec.",this.properties.doCountExecution,"doCountExecution"),this.num=0}function p(){this.size=[60,30],this.addProperty("time_in_ms",1e3),this.addInput("event",e.ACTION),this.addOutput("on_time",e.EVENT),this._pending=[]}function h(){this.addProperty("interval",1e3),this.addProperty("event","tick"),this.addOutput("on_tick",e.EVENT),this.time=0,this.last_interval=1e3,this.triggered=!1}function c(){this.addInput("go",e.ACTION),this.addInput("green",e.ACTION),this.addInput("red",e.ACTION),this.addOutput("continue",e.EVENT),this.addOutput("blocked",e.EVENT),this.addOutput("is_green","boolean"),this._ready=!1,this.properties={};var t=this;this.addWidget("button","reset","",(function(){t._ready=!1}))}function d(){this.addInput("in",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("out",e.EVENT),this._once=!1,this.properties={};var t=this;this.addWidget("button","reset","",(function(){t._once=!1}))}function f(){this.addInput("data",0),this.addInput("assign",e.ACTION),this.addOutput("data",0),this._last_value=null,this.properties={data:null,serialize:!0};var t=this;this.addWidget("button","store","",(function(){t.properties.data=t._last_value}))}n.title="Log Event",n.desc="Log event in console",n.prototype.onAction=function(t,e,n){console.log(t,e)},e.registerNodeType("events/log",n),i.title="TriggerEvent",i.desc="Triggers event if input evaluates to true",i.prototype.onExecute=function(t,e){var n=this.getInputData(0),i=n!=this.prev;0===this.prev&&(i=!1);var r=i&&this.properties.only_on_change||!i&&!this.properties.only_on_change;n&&r&&this.triggerSlot(0,t,null,e),!n&&r&&this.triggerSlot(2,t,null,e),i&&this.triggerSlot(1,t,null,e),this.prev=n},e.registerNodeType("events/trigger",i),r.title="Sequence",r.desc="Triggers a sequence of events when an event arrives",r.prototype.getTitle=function(){return""},r.prototype.onAction=function(t,e,n){if(this.outputs){n=n||{};for(var i=0;i<this.outputs.length;++i)this.outputs[i],n.action_call?n.action_call=n.action_call+"_seq_"+i:n.action_call=this.id+"_"+(t||"action")+"_seq_"+i+"_"+Math.floor(9999*Math.random()),this.triggerSlot(i,e,null,n)}},e.registerNodeType("events/sequence",r),o.title="WaitAll",o.desc="Wait until all input events arrive then triggers output",o.prototype.getTitle=function(){return""},o.prototype.onDrawBackground=function(t){if(!this.flags.collapsed)for(var n=0;n<this.inputs.length;++n){var i=n*e.NODE_SLOT_HEIGHT+10;t.fillStyle=this.ready[n]?"#AFB":"#000",t.fillRect(20,i,10,10)}},o.prototype.onAction=function(t,e,n,i){if(null!=i){this.ready.length=this.outputs.length,this.ready[i]=!0;for(var r=0;r<this.ready.length;++r)if(!this.ready[r])return;this.reset(),this.triggerSlot(0)}},o.prototype.reset=function(){this.ready.length=0},e.registerNodeType("events/waitAll",o),s.title="Stepper",s.desc="Trigger events sequentially when an tick arrives",s.prototype.onDrawBackground=function(t){if(!this.flags.collapsed){var n=this.properties.index||0;t.fillStyle="#AFB";var i=this.size[0],r=(n+1)*e.NODE_SLOT_HEIGHT+4;t.beginPath(),t.moveTo(i-30,r),t.lineTo(i-30,r+e.NODE_SLOT_HEIGHT),t.lineTo(i-15,r+.5*e.NODE_SLOT_HEIGHT),t.fill()}},s.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&(t=Math.floor(t),(t=clamp(t,0,this.outputs?this.outputs.length-2:0))!=this.properties.index&&(this.properties.index=t,this.triggerSlot(t+1))),this.setOutputData(0,this.properties.index)},s.prototype.onAction=function(t,e){if("reset"==t)this.properties.index=0;else if("step"==t){this.triggerSlot(this.properties.index+1,e);var n=this.outputs?this.outputs.length-1:0;this.properties.index=(this.properties.index+1)%n}},e.registerNodeType("events/stepper",s),a.title="Filter Event",a.desc="Blocks events that do not match the filter",a.prototype.onAction=function(t,e,n){if(null!=e&&(!this.properties.equal_to||this.properties.equal_to==e)){if(this.properties.has_property){var i=e[this.properties.has_property];if(null==i)return;if(this.properties.property_equal_to&&this.properties.property_equal_to!=i)return}this.triggerSlot(0,e,null,n)}},e.registerNodeType("events/filter",a),u.title="Branch",u.desc="If condition is true, outputs triggers true, otherwise false",u.prototype.onExecute=function(){this._value=this.getInputData(1)},u.prototype.onAction=function(t,e,n){this._value=this.getInputData(1),this.triggerSlot(this._value?0:1,e,null,n)},e.registerNodeType("events/branch",u),l.title="Counter",l.desc="Counts events",l.prototype.getTitle=function(){return this.flags.collapsed?String(this.num):this.title},l.prototype.onAction=function(t,e,n){var i=this.num;"inc"==t?this.num+=1:"dec"==t?this.num-=1:"reset"==t&&(this.num=0),this.num!=i&&this.trigger("change",this.num)},l.prototype.onDrawBackground=function(t){this.flags.collapsed||(t.fillStyle="#AAA",t.font="20px Arial",t.textAlign="center",t.fillText(this.num,.5*this.size[0],.5*this.size[1]))},l.prototype.onExecute=function(){this.properties.doCountExecution&&(this.num+=1),this.setOutputData(1,this.num)},e.registerNodeType("events/counter",l),p.title="Delay",p.desc="Delays one event",p.prototype.onAction=function(t,e,n){var i=this.properties.time_in_ms;i<=0?this.trigger(null,e,n):this._pending.push([i,e])},p.prototype.onExecute=function(t,e){var n=1e3*this.graph.elapsed_time;this.isInputConnected(1)&&(this.properties.time_in_ms=this.getInputData(1));for(var i=0;i<this._pending.length;++i){var r=this._pending[i];r[0]-=n,r[0]>0||(this._pending.splice(i,1),--i,this.trigger(null,r[1],e))}},p.prototype.onGetInputs=function(){return[["event",e.ACTION],["time_in_ms","number"]]},e.registerNodeType("events/delay",p),h.title="Timer",h.desc="Sends an event every N milliseconds",h.prototype.onStart=function(){this.time=0},h.prototype.getTitle=function(){return"Timer: "+this.last_interval.toString()+"ms"},h.on_color="#AAA",h.off_color="#222",h.prototype.onDrawBackground=function(){this.boxcolor=this.triggered?h.on_color:h.off_color,this.triggered=!1},h.prototype.onExecute=function(){var t=1e3*this.graph.elapsed_time,e=0==this.time;this.time+=t,this.last_interval=Math.max(1,0|this.getInputOrProperty("interval")),e||!(this.time<this.last_interval||isNaN(this.last_interval))?(this.triggered=!0,this.time=this.time%this.last_interval,this.trigger("on_tick",this.properties.event),this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!0)):this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!1)},h.prototype.onGetInputs=function(){return[["interval","number"]]},h.prototype.onGetOutputs=function(){return[["tick","boolean"]]},e.registerNodeType("events/timer",h),c.title="Semaphore Event",c.desc="Until both events are not triggered, it doesnt continue.",c.prototype.onExecute=function(){this.setOutputData(1,this._ready),this.boxcolor=this._ready?"#9F9":"#FA5"},c.prototype.onAction=function(t,e){"go"==t?this.triggerSlot(this._ready?0:1):"green"==t?this._ready=!0:"red"==t&&(this._ready=!1)},e.registerNodeType("events/semaphore",c),d.title="Once",d.desc="Only passes an event once, then gets locked",d.prototype.onAction=function(t,e){"in"!=t||this._once?"reset"==t&&(this._once=!1):(this._once=!0,this.triggerSlot(0,e))},e.registerNodeType("events/once",d),f.title="Data Store",f.desc="Stores data and only changes when event is received",f.prototype.onExecute=function(){this._last_value=this.getInputData(0),this.setOutputData(0,this.properties.data)},f.prototype.onAction=function(t,e,n){this.properties.data=this._last_value},f.prototype.onSerialize=function(t){null!=t.data&&(0==this.properties.serialize||t.data.constructor!==String&&t.data.constructor!==Number&&t.data.constructor!==Boolean&&t.data.constructor!==Array&&t.data.constructor!==Object)&&(t.data=null)},e.registerNodeType("basic/data_store",f)}(this),function(t){var e=t.LiteGraph;function n(){this.addOutput("",e.EVENT),this.addOutput("","boolean"),this.addProperty("text","click me"),this.addProperty("font_size",30),this.addProperty("message",""),this.size=[164,84],this.clicked=!1}function i(){this.addInput("","boolean"),this.addInput("e",e.ACTION),this.addOutput("v","boolean"),this.addOutput("e",e.EVENT),this.properties={font:"",value:!1},this.size=[160,44]}function r(){this.addOutput("","number"),this.size=[80,60],this.properties={min:-1e3,max:1e3,value:1,step:1},this.old_y=-1,this._remainder=0,this._precision=0,this.mouse_captured=!1}function o(){this.addOutput("","string"),this.addOutput("change",e.EVENT),this.size=[80,60],this.properties={value:"A",values:"A;B;C"},this.old_y=-1,this.mouse_captured=!1,this._values=this.properties.values.split(";");var t=this;this.widgets_up=!0,this.widget=this.addWidget("combo","",this.properties.value,(function(e){t.properties.value=e,t.triggerSlot(1,e)}),{property:"value",values:this._values})}function s(){this.addOutput("","number"),this.size=[64,84],this.properties={min:0,max:1,value:.5,color:"#7AF",precision:2},this.value=-1}function a(){this.addOutput("","number"),this.properties={value:.5,min:0,max:1,text:"V"};var t=this;this.size=[140,40],this.slider=this.addWidget("slider","V",this.properties.value,(function(e){t.properties.value=e}),this.properties),this.widgets_up=!0}function u(){this.size=[160,26],this.addOutput("","number"),this.properties={color:"#7AF",min:0,max:1,value:.5},this.value=-1}function l(){this.size=[160,26],this.addInput("","number"),this.properties={min:0,max:1,value:0,color:"#AAF"}}function p(){this.addInputs("",0),this.properties={value:"...",font:"Arial",fontsize:18,color:"#AAA",align:"left",glowSize:0,decimals:1}}function h(){this.size=[200,100],this.properties={borderColor:"#ffffff",bgcolorTop:"#f0f0f0",bgcolorBottom:"#e0e0e0",shadowSize:2,borderRadius:3}}n.title="Button",n.desc="Triggers an event",n.font="Arial",n.prototype.onDrawForeground=function(t){if(!this.flags.collapsed){if(t.fillStyle="black",t.fillRect(11,11,this.size[0]-20,this.size[1]-20),t.fillStyle="#AAF",t.fillRect(9,9,this.size[0]-20,this.size[1]-20),t.fillStyle=this.clicked?"white":this.mouseOver?"#668":"#334",t.fillRect(10,10,this.size[0]-20,this.size[1]-20),this.properties.text||0===this.properties.text){var e=this.properties.font_size||30;t.textAlign="center",t.fillStyle=this.clicked?"black":"white",t.font=e+"px "+n.font,t.fillText(this.properties.text,.5*this.size[0],.5*this.size[1]+.3*e),t.textAlign="left"}}},n.prototype.onMouseDown=function(t,e){if(e[0]>1&&e[1]>1&&e[0]<this.size[0]-2&&e[1]<this.size[1]-2)return this.clicked=!0,this.setOutputData(1,this.clicked),this.triggerSlot(0,this.properties.message),!0},n.prototype.onExecute=function(){this.setOutputData(1,this.clicked)},n.prototype.onMouseUp=function(t){this.clicked=!1},e.registerNodeType("widget/button",n),i.title="Toggle",i.desc="Toggles between true or false",i.prototype.onDrawForeground=function(t){if(!this.flags.collapsed){var e=.5*this.size[1],n=.8*this.size[1];t.font=this.properties.font||(.8*e).toFixed(0)+"px Arial";var i=t.measureText(this.title).width,r=.5*(this.size[0]-(i+e));t.fillStyle="#AAA",t.fillRect(r,n-e,e,e),t.fillStyle=this.properties.value?"#AEF":"#000",t.fillRect(r+.25*e,n-e+.25*e,.5*e,.5*e),t.textAlign="left",t.fillStyle="#AAA",t.fillText(this.title,1.2*e+r,.85*n),t.textAlign="left"}},i.prototype.onAction=function(t){this.properties.value=!this.properties.value,this.trigger("e",this.properties.value)},i.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&(this.properties.value=t),this.setOutputData(0,this.properties.value)},i.prototype.onMouseDown=function(t,e){if(e[0]>1&&e[1]>1&&e[0]<this.size[0]-2&&e[1]<this.size[1]-2)return this.properties.value=!this.properties.value,this.graph._version++,this.trigger("e",this.properties.value),!0},e.registerNodeType("widget/toggle",i),r.title="Number",r.desc="Widget to select number value",r.pixels_threshold=10,r.markers_color="#666",r.prototype.onDrawForeground=function(t){var e=.5*this.size[0],n=this.size[1];n>30?(t.fillStyle=r.markers_color,t.beginPath(),t.moveTo(e,.1*n),t.lineTo(e+.1*n,.2*n),t.lineTo(e+-.1*n,.2*n),t.fill(),t.beginPath(),t.moveTo(e,.9*n),t.lineTo(e+.1*n,.8*n),t.lineTo(e+-.1*n,.8*n),t.fill(),t.font=(.7*n).toFixed(1)+"px Arial"):t.font=(.8*n).toFixed(1)+"px Arial",t.textAlign="center",t.font=(.7*n).toFixed(1)+"px Arial",t.fillStyle="#EEE",t.fillText(this.properties.value.toFixed(this._precision),e,.75*n)},r.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},r.prototype.onPropertyChanged=function(t,e){var n=(this.properties.step+"").split(".");this._precision=n.length>1?n[1].length:0},r.prototype.onMouseDown=function(t,e){if(!(e[1]<0))return this.old_y=t.canvasY,this.captureInput(!0),this.mouse_captured=!0,!0},r.prototype.onMouseMove=function(t){if(this.mouse_captured){var e=this.old_y-t.canvasY;t.shiftKey&&(e*=10),(t.metaKey||t.altKey)&&(e*=.1),this.old_y=t.canvasY;var n=this._remainder+e/r.pixels_threshold;this._remainder=n%1,n|=0;var i=clamp(this.properties.value+n*this.properties.step,this.properties.min,this.properties.max);this.properties.value=i,this.graph._version++,this.setDirtyCanvas(!0)}},r.prototype.onMouseUp=function(t,e){if(t.click_time<200){var n=e[1]>.5*this.size[1]?-1:1;this.properties.value=clamp(this.properties.value+n*this.properties.step,this.properties.min,this.properties.max),this.graph._version++,this.setDirtyCanvas(!0)}this.mouse_captured&&(this.mouse_captured=!1,this.captureInput(!1))},e.registerNodeType("widget/number",r),o.title="Combo",o.desc="Widget to select from a list",o.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},o.prototype.onPropertyChanged=function(t,e){"values"==t?(this._values=e.split(";"),this.widget.options.values=this._values):"value"==t&&(this.widget.value=e)},e.registerNodeType("widget/combo",o),s.title="Knob",s.desc="Circular controller",s.size=[80,100],s.prototype.onDrawForeground=function(t){if(!this.flags.collapsed){-1==this.value&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min));var e=.5*this.size[0],n=.5*this.size[1],i=.5*Math.min(this.size[0],this.size[1])-5;Math.floor(.05*i),t.globalAlpha=1,t.save(),t.translate(e,n),t.rotate(.75*Math.PI),t.fillStyle="rgba(0,0,0,0.5)",t.beginPath(),t.moveTo(0,0),t.arc(0,0,i,0,1.5*Math.PI),t.fill(),t.strokeStyle="black",t.fillStyle=this.properties.color,t.lineWidth=2,t.beginPath(),t.moveTo(0,0),t.arc(0,0,i-4,0,1.5*Math.PI*Math.max(.01,this.value)),t.closePath(),t.fill(),t.lineWidth=1,t.globalAlpha=1,t.restore(),t.fillStyle="black",t.beginPath(),t.arc(e,n,.75*i,0,2*Math.PI,!0),t.fill(),t.fillStyle=this.mouseOver?"white":this.properties.color,t.beginPath();var r=this.value*Math.PI*1.5+.75*Math.PI;t.arc(e+Math.cos(r)*i*.65,n+Math.sin(r)*i*.65,.05*i,0,2*Math.PI,!0),t.fill(),t.fillStyle=this.mouseOver?"white":"#AAA",t.font=Math.floor(.5*i)+"px Arial",t.textAlign="center",t.fillText(this.properties.value.toFixed(this.properties.precision),e,n+.15*i)}},s.prototype.onExecute=function(){this.setOutputData(0,this.properties.value),this.boxcolor=e.colorToString([this.value,this.value,this.value])},s.prototype.onMouseDown=function(t){return this.center=[.5*this.size[0],.5*this.size[1]+20],this.radius=.5*this.size[0],!(t.canvasY-this.pos[1]<20||e.distance([t.canvasX,t.canvasY],[this.pos[0]+this.center[0],this.pos[1]+this.center[1]])>this.radius||(this.oldmouse=[t.canvasX-this.pos[0],t.canvasY-this.pos[1]],this.captureInput(!0),0))},s.prototype.onMouseMove=function(t){if(this.oldmouse){var e=[t.canvasX-this.pos[0],t.canvasY-this.pos[1]],n=this.value;(n-=.01*(e[1]-this.oldmouse[1]))>1?n=1:n<0&&(n=0),this.value=n,this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.oldmouse=e,this.setDirtyCanvas(!0)}},s.prototype.onMouseUp=function(t){this.oldmouse&&(this.oldmouse=null,this.captureInput(!1))},s.prototype.onPropertyChanged=function(t,e){if("min"==t||"max"==t||"value"==t)return this.properties[t]=parseFloat(e),!0},e.registerNodeType("widget/knob",s),a.title="Inner Slider",a.prototype.onPropertyChanged=function(t,e){"value"==t&&(this.slider.value=e)},a.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},e.registerNodeType("widget/internal_slider",a),u.title="H.Slider",u.desc="Linear slider controller",u.prototype.onDrawForeground=function(t){-1==this.value&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min)),t.globalAlpha=1,t.lineWidth=1,t.fillStyle="#000",t.fillRect(2,2,this.size[0]-4,this.size[1]-4),t.fillStyle=this.properties.color,t.beginPath(),t.rect(4,4,(this.size[0]-8)*this.value,this.size[1]-8),t.fill()},u.prototype.onExecute=function(){this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.setOutputData(0,this.properties.value),this.boxcolor=e.colorToString([this.value,this.value,this.value])},u.prototype.onMouseDown=function(t){return!(t.canvasY-this.pos[1]<0||(this.oldmouse=[t.canvasX-this.pos[0],t.canvasY-this.pos[1]],this.captureInput(!0),0))},u.prototype.onMouseMove=function(t){if(this.oldmouse){var e=[t.canvasX-this.pos[0],t.canvasY-this.pos[1]],n=this.value;(n+=(e[0]-this.oldmouse[0])/this.size[0])>1?n=1:n<0&&(n=0),this.value=n,this.oldmouse=e,this.setDirtyCanvas(!0)}},u.prototype.onMouseUp=function(t){this.oldmouse=null,this.captureInput(!1)},u.prototype.onMouseLeave=function(t){},e.registerNodeType("widget/hslider",u),l.title="Progress",l.desc="Shows data in linear progress",l.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&(this.properties.value=t)},l.prototype.onDrawForeground=function(t){t.lineWidth=1,t.fillStyle=this.properties.color;var e=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min);e=Math.min(1,e),e=Math.max(0,e),t.fillRect(2,2,(this.size[0]-4)*e,this.size[1]-4)},e.registerNodeType("widget/progress",l),p.title="Text",p.desc="Shows the input value",p.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"led_text",text:"LED",type:"minibutton"},{name:"normal_text",text:"Normal",type:"minibutton"}],p.prototype.onDrawForeground=function(t){t.fillStyle=this.properties.color;var e=this.properties.value;this.properties.glowSize?(t.shadowColor=this.properties.color,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=this.properties.glowSize):t.shadowColor="transparent";var n=this.properties.fontsize;if(t.textAlign=this.properties.align,t.font=n.toString()+"px "+this.properties.font,this.str="number"==typeof e?e.toFixed(this.properties.decimals):e,"string"==typeof this.str)for(var i=this.str.replace(/[\r\n]/g,"\\n").split("\\n"),r=0;r<i.length;r++)t.fillText(i[r],"left"==this.properties.align?15:this.size[0]-15,-.15*n+n*(parseInt(r)+1));t.shadowColor="transparent",this.last_ctx=t,t.textAlign="left"},p.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&(this.properties.value=t)},p.prototype.resize=function(){if(this.last_ctx){var t=this.str.split("\\n");this.last_ctx.font=this.properties.fontsize+"px "+this.properties.font;for(var e=0,n=0;n<t.length;n++){var i=this.last_ctx.measureText(t[n]).width;e<i&&(e=i)}this.size[0]=e+20,this.size[1]=4+t.length*this.properties.fontsize,this.setDirtyCanvas(!0)}},p.prototype.onPropertyChanged=function(t,e){return this.properties[t]=e,this.str="number"==typeof e?e.toFixed(3):e,!0},e.registerNodeType("widget/text",p),h.title="Panel",h.desc="Non interactive panel",h.widgets=[{name:"update",text:"Update",type:"button"}],h.prototype.createGradient=function(t){""!=this.properties.bgcolorTop&&""!=this.properties.bgcolorBottom?(this.lineargradient=t.createLinearGradient(0,0,0,this.size[1]),this.lineargradient.addColorStop(0,this.properties.bgcolorTop),this.lineargradient.addColorStop(1,this.properties.bgcolorBottom)):this.lineargradient=0},h.prototype.onDrawForeground=function(t){this.flags.collapsed||(null==this.lineargradient&&this.createGradient(t),this.lineargradient&&(t.lineWidth=1,t.strokeStyle=this.properties.borderColor,t.fillStyle=this.lineargradient,this.properties.shadowSize?(t.shadowColor="#000",t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=this.properties.shadowSize):t.shadowColor="transparent",t.roundRect(0,0,this.size[0]-1,this.size[1]-1,this.properties.shadowSize),t.fill(),t.shadowColor="transparent",t.stroke()))},e.registerNodeType("widget/panel",h)}(this),function(t){var e=t.LiteGraph;function n(){this.addOutput("left_x_axis","number"),this.addOutput("left_y_axis","number"),this.addOutput("button_pressed",e.EVENT),this.properties={gamepad_index:0,threshold:.1},this._left_axis=new Float32Array(2),this._right_axis=new Float32Array(2),this._triggers=new Float32Array(2),this._previous_buttons=new Uint8Array(17),this._current_buttons=new Uint8Array(17)}n.title="Gamepad",n.desc="gets the input of the gamepad",n.CENTER=0,n.LEFT=1,n.RIGHT=2,n.UP=4,n.DOWN=8,n.zero=new Float32Array(2),n.buttons=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs","home"],n.prototype.onExecute=function(){var t=this.getGamepad(),e=this.properties.threshold||0;if(t&&(this._left_axis[0]=Math.abs(t.xbox.axes.lx)>e?t.xbox.axes.lx:0,this._left_axis[1]=Math.abs(t.xbox.axes.ly)>e?t.xbox.axes.ly:0,this._right_axis[0]=Math.abs(t.xbox.axes.rx)>e?t.xbox.axes.rx:0,this._right_axis[1]=Math.abs(t.xbox.axes.ry)>e?t.xbox.axes.ry:0,this._triggers[0]=Math.abs(t.xbox.axes.ltrigger)>e?t.xbox.axes.ltrigger:0,this._triggers[1]=Math.abs(t.xbox.axes.rtrigger)>e?t.xbox.axes.rtrigger:0),this.outputs)for(var i=0;i<this.outputs.length;i++){var r=this.outputs[i];if(r.links&&r.links.length){var o=null;if(t)switch(r.name){case"left_axis":o=this._left_axis;break;case"right_axis":o=this._right_axis;break;case"left_x_axis":o=this._left_axis[0];break;case"left_y_axis":o=this._left_axis[1];break;case"right_x_axis":o=this._right_axis[0];break;case"right_y_axis":o=this._right_axis[1];break;case"trigger_left":o=this._triggers[0];break;case"trigger_right":o=this._triggers[1];break;case"a_button":o=t.xbox.buttons.a?1:0;break;case"b_button":o=t.xbox.buttons.b?1:0;break;case"x_button":o=t.xbox.buttons.x?1:0;break;case"y_button":o=t.xbox.buttons.y?1:0;break;case"lb_button":o=t.xbox.buttons.lb?1:0;break;case"rb_button":o=t.xbox.buttons.rb?1:0;break;case"ls_button":o=t.xbox.buttons.ls?1:0;break;case"rs_button":o=t.xbox.buttons.rs?1:0;break;case"hat_left":o=t.xbox.hatmap&n.LEFT;break;case"hat_right":o=t.xbox.hatmap&n.RIGHT;break;case"hat_up":o=t.xbox.hatmap&n.UP;break;case"hat_down":o=t.xbox.hatmap&n.DOWN;break;case"hat":o=t.xbox.hatmap;break;case"start_button":o=t.xbox.buttons.start?1:0;break;case"back_button":o=t.xbox.buttons.back?1:0;break;case"button_pressed":for(var s=0;s<this._current_buttons.length;++s)this._current_buttons[s]&&!this._previous_buttons[s]&&this.triggerSlot(i,n.buttons[s])}else switch(r.name){case"button_pressed":break;case"left_axis":case"right_axis":o=n.zero;break;default:o=0}this.setOutputData(i,o)}}},n.mapping={a:0,b:1,x:2,y:3,lb:4,rb:5,lt:6,rt:7,back:8,start:9,ls:10,rs:11},n.mapping_array=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs"],n.prototype.getGamepad=function(){var t=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads;if(!t)return null;var e=t.call(navigator),i=null;this._previous_buttons.set(this._current_buttons);for(var r=this.properties.gamepad_index;r<4;r++)if(e[r]){i=e[r];var o=this.xbox_mapping;o||(o=this.xbox_mapping={axes:[],buttons:{},hat:"",hatmap:n.CENTER}),o.axes.lx=i.axes[0],o.axes.ly=i.axes[1],o.axes.rx=i.axes[2],o.axes.ry=i.axes[3],o.axes.ltrigger=i.buttons[6].value,o.axes.rtrigger=i.buttons[7].value,o.hat="",o.hatmap=n.CENTER;for(var s=0;s<i.buttons.length;s++)if(this._current_buttons[s]=i.buttons[s].pressed,s<12)o.buttons[n.mapping_array[s]]=i.buttons[s].pressed,i.buttons[s].was_pressed&&this.trigger(n.mapping_array[s]+"_button_event");else switch(s){case 12:i.buttons[s].pressed&&(o.hat+="up",o.hatmap|=n.UP);break;case 13:i.buttons[s].pressed&&(o.hat+="down",o.hatmap|=n.DOWN);break;case 14:i.buttons[s].pressed&&(o.hat+="left",o.hatmap|=n.LEFT);break;case 15:i.buttons[s].pressed&&(o.hat+="right",o.hatmap|=n.RIGHT);break;case 16:o.buttons.home=i.buttons[s].pressed}return i.xbox=o,i}},n.prototype.onDrawBackground=function(t){if(!this.flags.collapsed){var e=this._left_axis,n=this._right_axis;t.strokeStyle="#88A",t.strokeRect(.5*(e[0]+1)*this.size[0]-4,.5*(e[1]+1)*this.size[1]-4,8,8),t.strokeStyle="#8A8",t.strokeRect(.5*(n[0]+1)*this.size[0]-4,.5*(n[1]+1)*this.size[1]-4,8,8);var i=this.size[1]/this._current_buttons.length;t.fillStyle="#AEB";for(var r=0;r<this._current_buttons.length;++r)this._current_buttons[r]&&t.fillRect(0,i*r,6,i)}},n.prototype.onGetOutputs=function(){return[["left_axis","vec2"],["right_axis","vec2"],["left_x_axis","number"],["left_y_axis","number"],["right_x_axis","number"],["right_y_axis","number"],["trigger_left","number"],["trigger_right","number"],["a_button","number"],["b_button","number"],["x_button","number"],["y_button","number"],["lb_button","number"],["rb_button","number"],["ls_button","number"],["rs_button","number"],["start_button","number"],["back_button","number"],["a_button_event",e.EVENT],["b_button_event",e.EVENT],["x_button_event",e.EVENT],["y_button_event",e.EVENT],["lb_button_event",e.EVENT],["rb_button_event",e.EVENT],["ls_button_event",e.EVENT],["rs_button_event",e.EVENT],["start_button_event",e.EVENT],["back_button_event",e.EVENT],["hat_left","number"],["hat_right","number"],["hat_up","number"],["hat_down","number"],["hat","number"],["button_pressed",e.EVENT]]},e.registerNodeType("input/gamepad",n)}(this),function(t){var e=t.LiteGraph;function n(){this.addInput("in",0),this.addOutput("out",0),this.size=[80,30]}function i(){this.addInput("in"),this.addOutput("out"),this.size=[80,30]}function r(){this.addInput("in"),this.addOutput("out")}function o(){this.addInput("in","number",{locked:!0}),this.addOutput("out","number",{locked:!0}),this.addOutput("clamped","number",{locked:!0}),this.addProperty("in",0),this.addProperty("in_min",0),this.addProperty("in_max",1),this.addProperty("out_min",0),this.addProperty("out_max",1),this.size=[120,50]}function s(){this.addOutput("value","number"),this.addProperty("min",0),this.addProperty("max",1),this.size=[80,30]}function a(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("min",0),this.addProperty("max",1),this.addProperty("smooth",!0),this.addProperty("seed",0),this.addProperty("octaves",1),this.addProperty("persistence",.8),this.addProperty("speed",1),this.size=[90,30]}function u(){this.addOutput("out","number"),this.addProperty("min_time",1),this.addProperty("max_time",2),this.addProperty("duration",.2),this.size=[90,30],this._remaining_time=0,this._blink_time=0}function l(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("min",0),this.addProperty("max",1)}function p(){this.properties={f:.5},this.addInput("A","number"),this.addInput("B","number"),this.addOutput("out","number")}function h(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}function c(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}function d(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}function f(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.properties={A:0,B:1}}function g(){this.addInput("in","number",{label:""}),this.addOutput("out","number",{label:""}),this.size=[80,30],this.addProperty("factor",1)}function _(){this.addInput("v","boolean"),this.addInput("A"),this.addInput("B"),this.addOutput("out")}function v(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("samples",10),this._values=new Float32Array(10),this._current=0}function m(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("factor",.1),this.size=[80,30],this._value=null}function y(){this.addInput("A","number,array,object"),this.addInput("B","number"),this.addOutput("=","number"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","+","enum",{values:y.values}),this._func=y.funcs[this.properties.OP],this._result=[]}function b(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A==B","boolean"),this.addOutput("A!=B","boolean"),this.addProperty("A",0),this.addProperty("B",0)}function x(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP",">","enum",{values:x.values}),this.addWidget("combo","Cond.",this.properties.OP,{property:"OP",values:x.values}),this.size=[80,60]}function A(){this.addInput("in",0),this.addInput("cond","boolean"),this.addOutput("true",0),this.addOutput("false",0),this.size=[80,60]}function w(){this.addInput("inc","number"),this.addOutput("total","number"),this.addProperty("increment",1),this.addProperty("value",0)}function E(){this.addInput("v","number"),this.addOutput("sin","number"),this.addProperty("amplitude",1),this.addProperty("offset",0),this.bgImageUrl="nodes/imgs/icon-sin.png"}function C(){this.addInput("x","number"),this.addInput("y","number"),this.addOutput("","number"),this.properties={x:1,y:1,formula:"x+y"},this.code_widget=this.addWidget("text","F(x,y)",this.properties.formula,(function(t,e,n){n.properties.formula=t})),this.addWidget("toggle","allow",e.allow_scripts,(function(t){e.allow_scripts=t})),this._func=null}function T(){this.addInput("vec2","vec2"),this.addOutput("x","number"),this.addOutput("y","number")}function O(){this.addInputs([["x","number"],["y","number"]]),this.addOutput("vec2","vec2"),this.properties={x:0,y:0},this._data=new Float32Array(2)}function S(){this.addInput("vec3","vec3"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number")}function I(){this.addInputs([["x","number"],["y","number"],["z","number"]]),this.addOutput("vec3","vec3"),this.properties={x:0,y:0,z:0},this._data=new Float32Array(3)}function L(){this.addInput("vec4","vec4"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number"),this.addOutput("w","number")}function N(){this.addInputs([["x","number"],["y","number"],["z","number"],["w","number"]]),this.addOutput("vec4","vec4"),this.properties={x:0,y:0,z:0,w:0},this._data=new Float32Array(4)}n.title="Converter",n.desc="type A to type B",n.prototype.onExecute=function(){var t=this.getInputData(0);if(null!=t&&this.outputs)for(var e=0;e<this.outputs.length;e++){var n=this.outputs[e];if(n.links&&n.links.length){var i=null;switch(n.name){case"number":i=t.length?t[0]:parseFloat(t);break;case"vec2":case"vec3":case"vec4":i=null;var r=1;switch(n.name){case"vec2":r=2;break;case"vec3":r=3;break;case"vec4":r=4}if(i=new Float32Array(r),t.length)for(var o=0;o<t.length&&o<i.length;o++)i[o]=t[o];else i[0]=parseFloat(t)}this.setOutputData(e,i)}}},n.prototype.onGetOutputs=function(){return[["number","number"],["vec2","vec2"],["vec3","vec3"],["vec4","vec4"]]},e.registerNodeType("math/converter",n),i.title="Bypass",i.desc="removes the type",i.prototype.onExecute=function(){var t=this.getInputData(0);this.setOutputData(0,t)},e.registerNodeType("math/bypass",i),r.title="to Number",r.desc="Cast to number",r.prototype.onExecute=function(){var t=this.getInputData(0);this.setOutputData(0,Number(t))},e.registerNodeType("math/to_number",r),o.title="Range",o.desc="Convert a number from one range to another",o.prototype.getTitle=function(){return this.flags.collapsed?(this._last_v||0).toFixed(2):this.title},o.prototype.onExecute=function(){if(this.inputs)for(var t=0;t<this.inputs.length;t++){var e=this.inputs[t];void 0!==(n=this.getInputData(t))&&(this.properties[e.name]=n)}var n;null!=(n=this.properties.in)&&n.constructor===Number||(n=0);var i=this.properties.in_min,r=this.properties.in_max,o=this.properties.out_min,s=this.properties.out_max;this._last_v=(n-i)/(r-i)*(s-o)+o,this.setOutputData(0,this._last_v),this.setOutputData(1,clamp(this._last_v,o,s))},o.prototype.onDrawBackground=function(t){this._last_v?this.outputs[0].label=this._last_v.toFixed(3):this.outputs[0].label="?"},o.prototype.onGetInputs=function(){return[["in_min","number"],["in_max","number"],["out_min","number"],["out_max","number"]]},e.registerNodeType("math/range",o),s.title="Rand",s.desc="Random number",s.prototype.onExecute=function(){if(this.inputs)for(var t=0;t<this.inputs.length;t++){var e=this.inputs[t],n=this.getInputData(t);void 0!==n&&(this.properties[e.name]=n)}var i=this.properties.min,r=this.properties.max;this._last_v=Math.random()*(r-i)+i,this.setOutputData(0,this._last_v)},s.prototype.onDrawBackground=function(t){this.outputs[0].label=(this._last_v||0).toFixed(3)},s.prototype.onGetInputs=function(){return[["min","number"],["max","number"]]},e.registerNodeType("math/rand",s),a.title="Noise",a.desc="Random number with temporal continuity",a.data=null,a.getValue=function(t,e){if(!a.data){a.data=new Float32Array(1024);for(var n=0;n<a.data.length;++n)a.data[n]=Math.random()}(t%=1024)<0&&(t+=1024);var i=Math.floor(t);return t-=i,e&&(t=t*t*t*(t*(6*t-15)+10)),a.data[i]*(1-t)+a.data[1023==i?0:i+1]*t},a.prototype.onExecute=function(){var t=this.getInputData(0)||0,e=this.properties.octaves||1,n=0,i=1;t+=this.properties.seed||0;for(var r=this.properties.speed||1,o=0,s=0;s<e&&(n+=a.getValue(t*(1+s)*r,this.properties.smooth)*i,o+=i,!((i*=this.properties.persistence)<.001));++s);n/=o;var u=this.properties.min,l=this.properties.max;this._last_v=n*(l-u)+u,this.setOutputData(0,this._last_v)},a.prototype.onDrawBackground=function(t){this.outputs[0].label=(this._last_v||0).toFixed(3)},e.registerNodeType("math/noise",a),u.title="Spikes",u.desc="spike every random time",u.prototype.onExecute=function(){var t=this.graph.elapsed_time;this._remaining_time-=t,this._blink_time-=t;var e=0;if(this._blink_time>0){var n=this._blink_time/this.properties.duration;e=1/(Math.pow(8*n-4,4)+1)}this._remaining_time<0?(this._remaining_time=Math.random()*(this.properties.max_time-this.properties.min_time)+this.properties.min_time,this._blink_time=this.properties.duration,this.boxcolor="#FFF"):this.boxcolor="#000",this.setOutputData(0,e)},e.registerNodeType("math/spikes",u),l.title="Clamp",l.desc="Clamp number between min and max",l.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&(t=Math.max(this.properties.min,t),t=Math.min(this.properties.max,t),this.setOutputData(0,t))},l.prototype.getCode=function(t){var e="";return this.isInputConnected(0)&&(e+="clamp({{0}},"+this.properties.min+","+this.properties.max+")"),e},e.registerNodeType("math/clamp",l),p.title="Lerp",p.desc="Linear Interpolation",p.prototype.onExecute=function(){var t=this.getInputData(0);null==t&&(t=0);var e=this.getInputData(1);null==e&&(e=0);var n=this.properties.f,i=this.getInputData(2);void 0!==i&&(n=i),this.setOutputData(0,t*(1-n)+e*n)},p.prototype.onGetInputs=function(){return[["f","number"]]},e.registerNodeType("math/lerp",p),h.title="Abs",h.desc="Absolute",h.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&this.setOutputData(0,Math.abs(t))},e.registerNodeType("math/abs",h),c.title="Floor",c.desc="Floor number to remove fractional part",c.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&this.setOutputData(0,Math.floor(t))},e.registerNodeType("math/floor",c),d.title="Frac",d.desc="Returns fractional part",d.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&this.setOutputData(0,t%1)},e.registerNodeType("math/frac",d),f.title="Smoothstep",f.desc="Smoothstep",f.prototype.onExecute=function(){var t=this.getInputData(0);if(void 0!==t){var e=this.properties.A,n=this.properties.B;t=(t=clamp((t-e)/(n-e),0,1))*t*(3-2*t),this.setOutputData(0,t)}},e.registerNodeType("math/smoothstep",f),g.title="Scale",g.desc="v * factor",g.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&this.setOutputData(0,t*this.properties.factor)},e.registerNodeType("math/scale",g),_.title="Gate",_.desc="if v is true, then outputs A, otherwise B",_.prototype.onExecute=function(){var t=this.getInputData(0);this.setOutputData(0,this.getInputData(t?1:2))},e.registerNodeType("math/gate",_),v.title="Average",v.desc="Average Filter",v.prototype.onExecute=function(){var t=this.getInputData(0);null==t&&(t=0);var e=this._values.length;this._values[this._current%e]=t,this._current+=1,this._current>e&&(this._current=0);for(var n=0,i=0;i<e;++i)n+=this._values[i];this.setOutputData(0,n/e)},v.prototype.onPropertyChanged=function(t,e){e<1&&(e=1),this.properties.samples=Math.round(e);var n=this._values;this._values=new Float32Array(this.properties.samples),n.length<=this._values.length?this._values.set(n):this._values.set(n.subarray(0,this._values.length))},e.registerNodeType("math/average",v),m.title="TendTo",m.desc="moves the output value always closer to the input",m.prototype.onExecute=function(){var t=this.getInputData(0);null==t&&(t=0);var e=this.properties.factor;null==this._value?this._value=t:this._value=this._value*(1-e)+t*e,this.setOutputData(0,this._value)},e.registerNodeType("math/tendTo",m),y.values=["+","-","*","/","%","^","max","min"],y.funcs={"+":function(t,e){return t+e},"-":function(t,e){return t-e},x:function(t,e){return t*e},X:function(t,e){return t*e},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},"^":function(t,e){return Math.pow(t,e)},max:function(t,e){return Math.max(t,e)},min:function(t,e){return Math.min(t,e)}},y.title="Operation",y.desc="Easy math operators",y["@OP"]={type:"enum",title:"operation",values:y.values},y.size=[100,60],y.prototype.getTitle=function(){return"max"==this.properties.OP||"min"==this.properties.OP?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"},y.prototype.setValue=function(t){"string"==typeof t&&(t=parseFloat(t)),this.properties.value=t},y.prototype.onPropertyChanged=function(t,e){"OP"==t&&(this._func=y.funcs[this.properties.OP],this._func||(console.warn("Unknown operation: "+this.properties.OP),this._func=function(t){return t}))},y.prototype.onExecute=function(){var t=this.getInputData(0),e=this.getInputData(1);null!=t?t.constructor===Number&&(this.properties.A=t):t=this.properties.A,null!=e?this.properties.B=e:e=this.properties.B;var n,i=y.funcs[this.properties.OP];if(t.constructor===Number)n=0,n=i(t,e);else if(t.constructor===Array){(n=this._result).length=t.length;for(var r=0;r<t.length;++r)n[r]=i(t[r],e)}else for(var r in n={},t)n[r]=i(t[r],e);this.setOutputData(0,n)},y.prototype.onDrawBackground=function(t){this.flags.collapsed||(t.font="40px Arial",t.fillStyle="#666",t.textAlign="center",t.fillText(this.properties.OP,.5*this.size[0],.5*(this.size[1]+e.NODE_TITLE_HEIGHT)),t.textAlign="left")},e.registerNodeType("math/operation",y),e.registerSearchboxExtra("math/operation","MAX",{properties:{OP:"max"},title:"MAX()"}),e.registerSearchboxExtra("math/operation","MIN",{properties:{OP:"min"},title:"MIN()"}),b.title="Compare",b.desc="compares between two values",b.prototype.onExecute=function(){var t=this.getInputData(0),e=this.getInputData(1);void 0!==t?this.properties.A=t:t=this.properties.A,void 0!==e?this.properties.B=e:e=this.properties.B;for(var n=0,i=this.outputs.length;n<i;++n){var r=this.outputs[n];if(r.links&&r.links.length){var o;switch(r.name){case"A==B":o=t==e;break;case"A!=B":o=t!=e;break;case"A>B":o=t>e;break;case"A<B":o=t<e;break;case"A<=B":o=t<=e;break;case"A>=B":o=t>=e}this.setOutputData(n,o)}}},b.prototype.onGetOutputs=function(){return[["A==B","boolean"],["A!=B","boolean"],["A>B","boolean"],["A<B","boolean"],["A>=B","boolean"],["A<=B","boolean"]]},e.registerNodeType("math/compare",b),e.registerSearchboxExtra("math/compare","==",{outputs:[["A==B","boolean"]],title:"A==B"}),e.registerSearchboxExtra("math/compare","!=",{outputs:[["A!=B","boolean"]],title:"A!=B"}),e.registerSearchboxExtra("math/compare",">",{outputs:[["A>B","boolean"]],title:"A>B"}),e.registerSearchboxExtra("math/compare","<",{outputs:[["A<B","boolean"]],title:"A<B"}),e.registerSearchboxExtra("math/compare",">=",{outputs:[["A>=B","boolean"]],title:"A>=B"}),e.registerSearchboxExtra("math/compare","<=",{outputs:[["A<=B","boolean"]],title:"A<=B"}),x.values=[">","<","==","!=","<=",">=","||","&&"],x["@OP"]={type:"enum",title:"operation",values:x.values},x.title="Condition",x.desc="evaluates condition between A and B",x.prototype.getTitle=function(){return"A "+this.properties.OP+" B"},x.prototype.onExecute=function(){var t=this.getInputData(0);void 0===t?t=this.properties.A:this.properties.A=t;var e=this.getInputData(1);void 0===e?e=this.properties.B:this.properties.B=e;var n=!0;switch(this.properties.OP){case">":n=t>e;break;case"<":n=t<e;break;case"==":n=t==e;break;case"!=":n=t!=e;break;case"<=":n=t<=e;break;case">=":n=t>=e;break;case"||":n=t||e;break;case"&&":n=t&&e}this.setOutputData(0,n),this.setOutputData(1,!n)},e.registerNodeType("math/condition",x),A.title="Branch",A.desc="If condition is true, outputs IN in true, otherwise in false",A.prototype.onExecute=function(){var t=this.getInputData(0);this.getInputData(1)?(this.setOutputData(0,t),this.setOutputData(1,null)):(this.setOutputData(0,null),this.setOutputData(1,t))},e.registerNodeType("math/branch",A),w.title="Accumulate",w.desc="Increments a value every time",w.prototype.onExecute=function(){null===this.properties.value&&(this.properties.value=0);var t=this.getInputData(0);this.properties.value+=null!==t?t:this.properties.increment,this.setOutputData(0,this.properties.value)},e.registerNodeType("math/accumulate",w),E.title="Trigonometry",E.desc="Sin Cos Tan",E.prototype.onExecute=function(){var t=this.getInputData(0);null==t&&(t=0);var e=this.properties.amplitude,n=this.findInputSlot("amplitude");-1!=n&&(e=this.getInputData(n));var i=this.properties.offset;-1!=(n=this.findInputSlot("offset"))&&(i=this.getInputData(n));for(var r=0,o=this.outputs.length;r<o;++r){var s;switch(this.outputs[r].name){case"sin":s=Math.sin(t);break;case"cos":s=Math.cos(t);break;case"tan":s=Math.tan(t);break;case"asin":s=Math.asin(t);break;case"acos":s=Math.acos(t);break;case"atan":s=Math.atan(t)}this.setOutputData(r,e*s+i)}},E.prototype.onGetInputs=function(){return[["v","number"],["amplitude","number"],["offset","number"]]},E.prototype.onGetOutputs=function(){return[["sin","number"],["cos","number"],["tan","number"],["asin","number"],["acos","number"],["atan","number"]]},e.registerNodeType("math/trigonometry",E),e.registerSearchboxExtra("math/trigonometry","SIN()",{outputs:[["sin","number"]],title:"SIN()"}),e.registerSearchboxExtra("math/trigonometry","COS()",{outputs:[["cos","number"]],title:"COS()"}),e.registerSearchboxExtra("math/trigonometry","TAN()",{outputs:[["tan","number"]],title:"TAN()"}),C.title="Formula",C.desc="Compute formula",C.size=[160,100],v.prototype.onPropertyChanged=function(t,e){"formula"==t&&(this.code_widget.value=e)},C.prototype.onExecute=function(){if(e.allow_scripts){var t,n=this.getInputData(0),i=this.getInputData(1);null!=n?this.properties.x=n:n=this.properties.x,null!=i?this.properties.y=i:i=this.properties.y,this.properties.formula;try{this._func&&this._func_code==this.properties.formula||(this._func=new Function("x","y","TIME","return "+this.properties.formula),this._func_code=this.properties.formula),t=this._func(n,i,this.graph.globaltime),this.boxcolor=null}catch(t){this.boxcolor="red"}this.setOutputData(0,t)}},C.prototype.getTitle=function(){return this._func_code||"Formula"},C.prototype.onDrawBackground=function(){var t=this.properties.formula;this.outputs&&this.outputs.length&&(this.outputs[0].label=t)},e.registerNodeType("math/formula",C),T.title="Vec2->XY",T.desc="vector 2 to components",T.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&(this.setOutputData(0,t[0]),this.setOutputData(1,t[1]))},e.registerNodeType("math3d/vec2-to-xy",T),O.title="XY->Vec2",O.desc="components to vector2",O.prototype.onExecute=function(){var t=this.getInputData(0);null==t&&(t=this.properties.x);var e=this.getInputData(1);null==e&&(e=this.properties.y);var n=this._data;n[0]=t,n[1]=e,this.setOutputData(0,n)},e.registerNodeType("math3d/xy-to-vec2",O),S.title="Vec3->XYZ",S.desc="vector 3 to components",S.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&(this.setOutputData(0,t[0]),this.setOutputData(1,t[1]),this.setOutputData(2,t[2]))},e.registerNodeType("math3d/vec3-to-xyz",S),I.title="XYZ->Vec3",I.desc="components to vector3",I.prototype.onExecute=function(){var t=this.getInputData(0);null==t&&(t=this.properties.x);var e=this.getInputData(1);null==e&&(e=this.properties.y);var n=this.getInputData(2);null==n&&(n=this.properties.z);var i=this._data;i[0]=t,i[1]=e,i[2]=n,this.setOutputData(0,i)},e.registerNodeType("math3d/xyz-to-vec3",I),L.title="Vec4->XYZW",L.desc="vector 4 to components",L.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&(this.setOutputData(0,t[0]),this.setOutputData(1,t[1]),this.setOutputData(2,t[2]),this.setOutputData(3,t[3]))},e.registerNodeType("math3d/vec4-to-xyzw",L),N.title="XYZW->Vec4",N.desc="components to vector4",N.prototype.onExecute=function(){var t=this.getInputData(0);null==t&&(t=this.properties.x);var e=this.getInputData(1);null==e&&(e=this.properties.y);var n=this.getInputData(2);null==n&&(n=this.properties.z);var i=this.getInputData(3);null==i&&(i=this.properties.w);var r=this._data;r[0]=t,r[1]=e,r[2]=n,r[3]=i,this.setOutputData(0,r)},e.registerNodeType("math3d/xyzw-to-vec4",N)}(this),function(t){var e=t.LiteGraph;function n(){this.addInput("T","vec3"),this.addInput("R","vec3"),this.addInput("S","vec3"),this.addOutput("mat4","mat4"),this.properties={T:[0,0,0],R:[0,0,0],S:[1,1,1],R_in_degrees:!0},this._result=mat4.create(),this._must_update=!0}function i(){this.addInput("A","number,vec3"),this.addInput("B","number,vec3"),this.addOutput("=","number,vec3"),this.addProperty("OP","+","enum",{values:i.values}),this._result=vec3.create()}function r(){this.addInput("in","vec3"),this.addInput("f","number"),this.addOutput("out","vec3"),this.properties={f:1},this._data=new Float32Array(3)}function o(){this.addInput("in","vec3"),this.addOutput("out","number")}function s(){this.addInput("in","vec3"),this.addOutput("out","vec3"),this._data=new Float32Array(3)}function a(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addInput("f","vec3"),this.addOutput("out","vec3"),this.properties={f:.5},this._data=new Float32Array(3)}function u(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addOutput("out","number")}if(n.title="mat4",n.temp_quat=new Float32Array([0,0,0,1]),n.temp_mat4=new Float32Array(16),n.temp_vec3=new Float32Array(3),n.prototype.onPropertyChanged=function(t,e){this._must_update=!0},n.prototype.onExecute=function(){var t=this._result,e=n.temp_quat,i=n.temp_mat4,r=n.temp_vec3,o=this.getInputData(0),s=this.getInputData(1),a=this.getInputData(2);(this._must_update||o||s||a)&&(o=o||this.properties.T,s=s||this.properties.R,a=a||this.properties.S,mat4.identity(t),mat4.translate(t,t,o),this.properties.R_in_degrees?(r.set(s),vec3.scale(r,r,DEG2RAD),quat.fromEuler(e,r)):quat.fromEuler(e,s),mat4.fromQuat(i,e),mat4.multiply(t,t,i),mat4.scale(t,t,a)),this.setOutputData(0,t)},e.registerNodeType("math3d/mat4",n),i.values=["+","-","*","/","%","^","max","min","dot","cross"],e.registerSearchboxExtra("math3d/operation","CROSS()",{properties:{OP:"cross"},title:"CROSS()"}),e.registerSearchboxExtra("math3d/operation","DOT()",{properties:{OP:"dot"},title:"DOT()"}),i.title="Operation",i.desc="Easy math 3D operators",i["@OP"]={type:"enum",title:"operation",values:i.values},i.size=[100,60],i.prototype.getTitle=function(){return"max"==this.properties.OP||"min"==this.properties.OP?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"},i.prototype.onExecute=function(){var t=this.getInputData(0),e=this.getInputData(1);if(null!=t&&null!=e){t.constructor===Number&&(t=[t,t,t]),e.constructor===Number&&(e=[e,e,e]);var n=this._result;switch(this.properties.OP){case"+":n=vec3.add(n,t,e);break;case"-":n=vec3.sub(n,t,e);break;case"x":case"X":case"*":n=vec3.mul(n,t,e);break;case"/":n=vec3.div(n,t,e);break;case"%":n[0]=t[0]%e[0],n[1]=t[1]%e[1],n[2]=t[2]%e[2];break;case"^":n[0]=Math.pow(t[0],e[0]),n[1]=Math.pow(t[1],e[1]),n[2]=Math.pow(t[2],e[2]);break;case"max":n[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n[2]=Math.max(t[2],e[2]);break;case"min":n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n[2]=Math.min(t[2],e[2]);case"dot":n=vec3.dot(t,e);break;case"cross":vec3.cross(n,t,e);break;default:console.warn("Unknown operation: "+this.properties.OP)}this.setOutputData(0,n)}},i.prototype.onDrawBackground=function(t){this.flags.collapsed||(t.font="40px Arial",t.fillStyle="#666",t.textAlign="center",t.fillText(this.properties.OP,.5*this.size[0],.5*(this.size[1]+e.NODE_TITLE_HEIGHT)),t.textAlign="left")},e.registerNodeType("math3d/operation",i),r.title="vec3_scale",r.desc="scales the components of a vec3",r.prototype.onExecute=function(){var t=this.getInputData(0);if(null!=t){var e=this.getInputData(1);null==e&&(e=this.properties.f);var n=this._data;n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,this.setOutputData(0,n)}},e.registerNodeType("math3d/vec3-scale",r),o.title="vec3_length",o.desc="returns the module of a vector",o.prototype.onExecute=function(){var t=this.getInputData(0);if(null!=t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.setOutputData(0,e)}},e.registerNodeType("math3d/vec3-length",o),s.title="vec3_normalize",s.desc="returns the vector normalized",s.prototype.onExecute=function(){var t=this.getInputData(0);if(null!=t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),n=this._data;n[0]=t[0]/e,n[1]=t[1]/e,n[2]=t[2]/e,this.setOutputData(0,n)}},e.registerNodeType("math3d/vec3-normalize",s),a.title="vec3_lerp",a.desc="returns the interpolated vector",a.prototype.onExecute=function(){var t=this.getInputData(0);if(null!=t){var e=this.getInputData(1);if(null!=e){var n=this.getInputOrProperty("f"),i=this._data;i[0]=t[0]*(1-n)+e[0]*n,i[1]=t[1]*(1-n)+e[1]*n,i[2]=t[2]*(1-n)+e[2]*n,this.setOutputData(0,i)}}},e.registerNodeType("math3d/vec3-lerp",a),u.title="vec3_dot",u.desc="returns the dot product",u.prototype.onExecute=function(){var t=this.getInputData(0);if(null!=t){var e=this.getInputData(1);if(null!=e){var n=t[0]*e[0]+t[1]*e[1]+t[2]*e[2];this.setOutputData(0,n)}}},e.registerNodeType("math3d/vec3-dot",u),t.glMatrix){function l(){this.addOutput("quat","quat"),this.properties={x:0,y:0,z:0,w:1,normalize:!1},this._value=quat.create()}function p(){this.addInputs([["degrees","number"],["axis","vec3"]]),this.addOutput("quat","quat"),this.properties={angle:90,axis:vec3.fromValues(0,1,0)},this._value=quat.create()}function h(){this.addInput("euler","vec3"),this.addOutput("quat","quat"),this.properties={euler:[0,0,0],use_yaw_pitch_roll:!1},this._degs=vec3.create(),this._value=quat.create()}function c(){this.addInput(["quat","quat"]),this.addOutput("euler","vec3"),this._value=vec3.create()}function d(){this.addInputs([["vec3","vec3"],["quat","quat"]]),this.addOutput("result","vec3"),this.properties={vec:[0,0,1]}}function f(){this.addInputs([["A","quat"],["B","quat"]]),this.addOutput("A*B","quat"),this._value=quat.create()}function g(){this.addInputs([["A","quat"],["B","quat"],["factor","number"]]),this.addOutput("slerp","quat"),this.addProperty("factor",.5),this._value=quat.create()}function _(){this.addInput("vec3","vec3"),this.addOutput("remap","vec3"),this.addOutput("clamped","vec3"),this.properties={clamp:!0,range_min:[-1,-1,0],range_max:[1,1,0],target_min:[-1,-1,0],target_max:[1,1,0]},this._value=vec3.create(),this._clamped=vec3.create()}l.title="Quaternion",l.desc="quaternion",l.prototype.onExecute=function(){this._value[0]=this.getInputOrProperty("x"),this._value[1]=this.getInputOrProperty("y"),this._value[2]=this.getInputOrProperty("z"),this._value[3]=this.getInputOrProperty("w"),this.properties.normalize&&quat.normalize(this._value,this._value),this.setOutputData(0,this._value)},l.prototype.onGetInputs=function(){return[["x","number"],["y","number"],["z","number"],["w","number"]]},e.registerNodeType("math3d/quaternion",l),p.title="Rotation",p.desc="quaternion rotation",p.prototype.onExecute=function(){var t=this.getInputData(0);null==t&&(t=this.properties.angle);var e=this.getInputData(1);null==e&&(e=this.properties.axis);var n=quat.setAxisAngle(this._value,e,.0174532925*t);this.setOutputData(0,n)},e.registerNodeType("math3d/rotation",p),h.title="Euler->Quat",h.desc="Converts euler angles (in degrees) to quaternion",h.prototype.onExecute=function(){var t=this.getInputData(0);null==t&&(t=this.properties.euler),vec3.scale(this._degs,t,DEG2RAD),this.properties.use_yaw_pitch_roll&&(this._degs=[this._degs[2],this._degs[0],this._degs[1]]);var e=quat.fromEuler(this._value,this._degs);this.setOutputData(0,e)},e.registerNodeType("math3d/euler_to_quat",h),c.title="Euler->Quat",c.desc="Converts rotX,rotY,rotZ in degrees to quat",c.prototype.onExecute=function(){var t=this.getInputData(0);t&&(quat.toEuler(this._value,t),vec3.scale(this._value,this._value,DEG2RAD),this.setOutputData(0,this._value))},e.registerNodeType("math3d/quat_to_euler",c),d.title="Rot. Vec3",d.desc="rotate a point",d.prototype.onExecute=function(){var t=this.getInputData(0);null==t&&(t=this.properties.vec);var e=this.getInputData(1);null==e?this.setOutputData(t):this.setOutputData(0,vec3.transformQuat(vec3.create(),t,e))},e.registerNodeType("math3d/rotate_vec3",d),f.title="Mult. Quat",f.desc="rotate quaternion",f.prototype.onExecute=function(){var t=this.getInputData(0);if(null!=t){var e=this.getInputData(1);if(null!=e){var n=quat.multiply(this._value,t,e);this.setOutputData(0,n)}}},e.registerNodeType("math3d/mult-quat",f),g.title="Quat Slerp",g.desc="quaternion spherical interpolation",g.prototype.onExecute=function(){var t=this.getInputData(0);if(null!=t){var e=this.getInputData(1);if(null!=e){var n=this.properties.factor;null!=this.getInputData(2)&&(n=this.getInputData(2));var i=quat.slerp(this._value,t,e,n);this.setOutputData(0,i)}}},e.registerNodeType("math3d/quat-slerp",g),_.title="Remap Range",_.desc="remap a 3D range",_.prototype.onExecute=function(){var t=this.getInputData(0);t&&this._value.set(t);for(var e=this.properties.range_min,n=this.properties.range_max,i=this.properties.target_min,r=this.properties.target_max,o=0;o<3;++o){var s=n[o]-e[o];if(this._clamped[o]=clamp(this._value[o],e[o],n[o]),0!=s){var a=(this._value[o]-e[o])/s;this.properties.clamp&&(a=clamp(a,0,1));var u=r[o]-i[o];this._value[o]=i[o]+a*u}else this._value[o]=.5*(i[o]+r[o])}this.setOutputData(0,this._value),this.setOutputData(1,this._clamped)},e.registerNodeType("math3d/remap_range",_)}else e.debug&&console.warn("No glmatrix found, some Math3D nodes may not work")}(this),function(t){var e=t.LiteGraph;function n(){this.addInput("","string"),this.addOutput("table","table"),this.addOutput("rows","number"),this.addProperty("value",""),this.addProperty("separator",","),this._table=null}e.wrapFunctionAsNode("string/toString",(function(t){if(t&&t.constructor===Object)try{return JSON.stringify(t)}catch(e){return String(t)}return String(t)}),[""],"string"),e.wrapFunctionAsNode("string/compare",(function(t,e){return t==e}),["string","string"],"boolean"),e.wrapFunctionAsNode("string/concatenate",(function(t,e){return void 0===t?e:void 0===e?t:t+e}),["string","string"],"string"),e.wrapFunctionAsNode("string/contains",(function(t,e){return void 0!==t&&void 0!==e&&-1!=t.indexOf(e)}),["string","string"],"boolean"),e.wrapFunctionAsNode("string/toUpperCase",(function(t){return null!=t&&t.constructor===String?t.toUpperCase():t}),["string"],"string"),e.wrapFunctionAsNode("string/split",(function(t,e){if(null==e&&(e=this.properties.separator),null==t)return[];if(t.constructor===String)return t.split(e||" ");if(t.constructor===Array){for(var n=[],i=0;i<t.length;++i)"string"==typeof t[i]&&(n[i]=t[i].split(e||" "));return n}return null}),["string,array","string"],"array",{separator:","}),e.wrapFunctionAsNode("string/toFixed",(function(t){return null!=t&&t.constructor===Number?t.toFixed(this.properties.precision):t}),["number"],"string",{precision:0}),n.title="toTable",n.desc="Splits a string to table",n.prototype.onExecute=function(){var t=this.getInputData(0);if(t){var e=this.properties.separator||",";t==this._str&&e==this._last_separator||(this._last_separator=e,this._str=t,this._table=t.split("\n").map((function(t){return t.trim().split(e)}))),this.setOutputData(0,this._table),this.setOutputData(1,this._table?this._table.length:0)}},e.registerNodeType("string/toTable",n)}(this),function(t){var e=t.LiteGraph;function n(){this.addInput("sel","number"),this.addInput("A"),this.addInput("B"),this.addInput("C"),this.addInput("D"),this.addOutput("out"),this.selected=0}function i(){this.properties={sequence:"A,B,C"},this.addInput("index","number"),this.addInput("seq"),this.addOutput("out"),this.index=0,this.values=this.properties.sequence.split(",")}function r(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}function o(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}function s(){this.properties={},this.addInput("in","boolean"),this.addOutput("out","boolean")}function a(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}function u(){this.properties={},this.addInput("onTrigger",e.ACTION),this.addInput("condition","boolean"),this.addOutput("true",e.EVENT),this.addOutput("false",e.EVENT),this.mode=e.ON_TRIGGER}n.title="Selector",n.desc="selects an output",n.prototype.onDrawBackground=function(t){if(!this.flags.collapsed){t.fillStyle="#AFB";var n=(this.selected+1)*e.NODE_SLOT_HEIGHT+6;t.beginPath(),t.moveTo(50,n),t.lineTo(50,n+e.NODE_SLOT_HEIGHT),t.lineTo(34,n+.5*e.NODE_SLOT_HEIGHT),t.fill()}},n.prototype.onExecute=function(){var t=this.getInputData(0);null!=t&&t.constructor===Number||(t=0),this.selected=t=Math.round(t)%(this.inputs.length-1);var e=this.getInputData(t+1);void 0!==e&&this.setOutputData(0,e)},n.prototype.onGetInputs=function(){return[["E",0],["F",0],["G",0],["H",0]]},e.registerNodeType("logic/selector",n),i.title="Sequence",i.desc="select one element from a sequence from a string",i.prototype.onPropertyChanged=function(t,e){"sequence"==t&&(this.values=e.split(","))},i.prototype.onExecute=function(){var t=this.getInputData(1);t&&t!=this.current_sequence&&(this.values=t.split(","),this.current_sequence=t);var e=this.getInputData(0);null==e&&(e=0),this.index=e=Math.round(e)%this.values.length,this.setOutputData(0,this.values[e])},e.registerNodeType("logic/sequence",i),r.title="AND",r.desc="Return true if all inputs are true",r.prototype.onExecute=function(){var t=!0;for(var e in this.inputs)if(!this.getInputData(e)){t=!1;break}this.setOutputData(0,t)},r.prototype.onGetInputs=function(){return[["and","boolean"]]},e.registerNodeType("logic/AND",r),o.title="OR",o.desc="Return true if at least one input is true",o.prototype.onExecute=function(){var t=!1;for(var e in this.inputs)if(this.getInputData(e)){t=!0;break}this.setOutputData(0,t)},o.prototype.onGetInputs=function(){return[["or","boolean"]]},e.registerNodeType("logic/OR",o),s.title="NOT",s.desc="Return the logical negation",s.prototype.onExecute=function(){var t=!this.getInputData(0);this.setOutputData(0,t)},e.registerNodeType("logic/NOT",s),a.title="bool == bool",a.desc="Compare for logical equality",a.prototype.onExecute=function(){var t=null,e=!0;for(var n in this.inputs)if(null===t)t=this.getInputData(n);else if(t!=this.getInputData(n)){e=!1;break}this.setOutputData(0,e)},a.prototype.onGetInputs=function(){return[["bool","boolean"]]},e.registerNodeType("logic/CompareBool",a),u.title="Branch",u.desc="Branch execution on condition",u.prototype.onExecute=function(t,e){this.getInputData(1)?this.triggerSlot(0):this.triggerSlot(1)},e.registerNodeType("logic/IF",u)}(this),function(t){var e=t.LiteGraph;function n(){this.addInput("A","Number"),this.addInput("B","Number"),this.addInput("C","Number"),this.addInput("D","Number"),this.values=[[],[],[],[]],this.properties={scale:2}}function i(){this.addOutput("frame","image"),this.properties={url:""}}function r(){this.addInput("f","number"),this.addOutput("Color","color"),this.properties={colorA:"#444444",colorB:"#44AAFF",colorC:"#44FFAA",colorD:"#FFFFFF"}}function o(){this.addInput("","image,canvas"),this.size=[200,200]}function s(){this.addInputs([["img1","image"],["img2","image"],["fade","number"]]),this.addOutput("","image"),this.properties={fade:.5,width:512,height:512}}function a(){this.addInput("","image"),this.addOutput("","image"),this.properties={width:256,height:256,x:0,y:0,scale:1},this.size=[50,20]}function u(){this.addInput("clear",e.ACTION),this.addOutput("","canvas"),this.properties={width:512,height:512,autoclear:!0},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}function l(){this.addInput("canvas","canvas"),this.addInput("img","image,canvas"),this.addInput("x","number"),this.addInput("y","number"),this.properties={x:0,y:0,opacity:1}}function p(){this.addInput("canvas","canvas"),this.addInput("x","number"),this.addInput("y","number"),this.addInput("w","number"),this.addInput("h","number"),this.properties={x:0,y:0,w:10,h:10,color:"white",opacity:1}}function h(){this.addInput("t","number"),this.addOutputs([["frame","image"],["t","number"],["d","number"]]),this.properties={url:"",use_proxy:!0}}function c(){this.addOutput("Webcam","image"),this.properties={filterFacingMode:!1,facingMode:"user"},this.boxcolor="black",this.frame=0}n.title="Plot",n.desc="Plots data over time",n.colors=["#FFF","#F99","#9F9","#99F"],n.prototype.onExecute=function(t){if(!this.flags.collapsed)for(var e=this.size,n=0;n<4;++n){var i=this.getInputData(n);if(null!=i){var r=this.values[n];r.push(i),r.length>e[0]&&r.shift()}}},n.prototype.onDrawBackground=function(t){if(!this.flags.collapsed){var e=this.size,i=.5*e[1]/this.properties.scale,r=n.colors,o=.5*e[1];if(t.fillStyle="#000",t.fillRect(0,0,e[0],e[1]),t.strokeStyle="#555",t.beginPath(),t.moveTo(0,o),t.lineTo(e[0],o),t.stroke(),this.inputs)for(var s=0;s<4;++s){var a=this.values[s];if(this.inputs[s]&&this.inputs[s].link){t.strokeStyle=r[s],t.beginPath();var u=a[0]*i*-1+o;t.moveTo(0,clamp(u,0,e[1]));for(var l=1;l<a.length&&l<e[0];++l)u=a[l]*i*-1+o,t.lineTo(l,clamp(u,0,e[1]));t.stroke()}}}},e.registerNodeType("graphics/plot",n),i.title="Image",i.desc="Image loader",i.widgets=[{name:"load",text:"Load",type:"button"}],i.supported_extensions=["jpg","jpeg","png","gif"],i.prototype.onAdded=function(){""!=this.properties.url&&null==this.img&&this.loadImage(this.properties.url)},i.prototype.onDrawBackground=function(t){this.flags.collapsed||this.img&&this.size[0]>5&&this.size[1]>5&&this.img.width&&t.drawImage(this.img,0,0,this.size[0],this.size[1])},i.prototype.onExecute=function(){this.img||(this.boxcolor="#000"),this.img&&this.img.width?this.setOutputData(0,this.img):this.setOutputData(0,null),this.img&&this.img.dirty&&(this.img.dirty=!1)},i.prototype.onPropertyChanged=function(t,e){return this.properties[t]=e,"url"==t&&""!=e&&this.loadImage(e),!0},i.prototype.loadImage=function(t,n){if(""!=t){this.img=document.createElement("img"),"http"==t.substr(0,4)&&e.proxy&&(t=e.proxy+t.substr(t.indexOf(":")+3)),this.img.src=t,this.boxcolor="#F95";var i=this;this.img.onload=function(){n&&n(this),console.log("Image loaded, size: "+i.img.width+"x"+i.img.height),this.dirty=!0,i.boxcolor="#9F9",i.setDirtyCanvas(!0)},this.img.onerror=function(){console.log("error loading the image:"+t)}}else this.img=null},i.prototype.onWidget=function(t,e){"load"==e.name&&this.loadImage(this.properties.url)},i.prototype.onDropFile=function(t){var e=this;this._url&&URL.revokeObjectURL(this._url),this._url=URL.createObjectURL(t),this.properties.url=this._url,this.loadImage(this._url,(function(t){e.size[1]=t.height/t.width*e.size[0]}))},e.registerNodeType("graphics/image",i),r.title="Palette",r.desc="Generates a color",r.prototype.onExecute=function(){var t=[];null!=this.properties.colorA&&t.push(hex2num(this.properties.colorA)),null!=this.properties.colorB&&t.push(hex2num(this.properties.colorB)),null!=this.properties.colorC&&t.push(hex2num(this.properties.colorC)),null!=this.properties.colorD&&t.push(hex2num(this.properties.colorD));var e=this.getInputData(0);if(null==e&&(e=.5),e>1?e=1:e<0&&(e=0),0!=t.length){var n=[0,0,0];if(0==e)n=t[0];else if(1==e)n=t[t.length-1];else{var i=(t.length-1)*e,r=t[Math.floor(i)],o=t[Math.floor(i)+1],s=i-Math.floor(i);n[0]=r[0]*(1-s)+o[0]*s,n[1]=r[1]*(1-s)+o[1]*s,n[2]=r[2]*(1-s)+o[2]*s}for(var a=0;a<n.length;a++)n[a]/=255;this.boxcolor=colorToString(n),this.setOutputData(0,n)}},e.registerNodeType("color/palette",r),o.title="Frame",o.desc="Frame viewerew",o.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"view",text:"View Image",type:"button"}],o.prototype.onDrawBackground=function(t){this.frame&&!this.flags.collapsed&&t.drawImage(this.frame,0,0,this.size[0],this.size[1])},o.prototype.onExecute=function(){this.frame=this.getInputData(0),this.setDirtyCanvas(!0)},o.prototype.onWidget=function(t,e){if("resize"==e.name&&this.frame){var n=this.frame.width,i=this.frame.height;n||null==this.frame.videoWidth||(n=this.frame.videoWidth,i=this.frame.videoHeight),n&&i&&(this.size=[n,i]),this.setDirtyCanvas(!0,!0)}else"view"==e.name&&this.show()},o.prototype.show=function(){showElement&&this.frame&&showElement(this.frame)},e.registerNodeType("graphics/frame",o),s.title="Image fade",s.desc="Fades between images",s.widgets=[{name:"resizeA",text:"Resize to A",type:"button"},{name:"resizeB",text:"Resize to B",type:"button"}],s.prototype.onAdded=function(){this.createCanvas();var t=this.canvas.getContext("2d");t.fillStyle="#000",t.fillRect(0,0,this.properties.width,this.properties.height)},s.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},s.prototype.onExecute=function(){var t=this.canvas.getContext("2d");this.canvas.width=this.canvas.width;var e=this.getInputData(0);null!=e&&t.drawImage(e,0,0,this.canvas.width,this.canvas.height);var n=this.getInputData(2);null==n?n=this.properties.fade:this.properties.fade=n,t.globalAlpha=n;var i=this.getInputData(1);null!=i&&t.drawImage(i,0,0,this.canvas.width,this.canvas.height),t.globalAlpha=1,this.setOutputData(0,this.canvas),this.setDirtyCanvas(!0)},e.registerNodeType("graphics/imagefade",s),a.title="Crop",a.desc="Crop Image",a.prototype.onAdded=function(){this.createCanvas()},a.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},a.prototype.onExecute=function(){var t=this.getInputData(0);t&&(t.width?(this.canvas.getContext("2d").drawImage(t,-this.properties.x,-this.properties.y,t.width*this.properties.scale,t.height*this.properties.scale),this.setOutputData(0,this.canvas)):this.setOutputData(0,null))},a.prototype.onDrawBackground=function(t){this.flags.collapsed||this.canvas&&t.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,this.size[0],this.size[1])},a.prototype.onPropertyChanged=function(t,e){return this.properties[t]=e,"scale"==t?(this.properties[t]=parseFloat(e),0==this.properties[t]&&(console.error("Error in scale"),this.properties[t]=1)):this.properties[t]=parseInt(e),this.createCanvas(),!0},e.registerNodeType("graphics/cropImage",a),u.title="Canvas",u.desc="Canvas to render stuff",u.prototype.onExecute=function(){var t=this.canvas,e=0|this.properties.width,n=0|this.properties.height;t.width!=e&&(t.width=e),t.height!=n&&(t.height=n),this.properties.autoclear&&this.ctx.clearRect(0,0,t.width,t.height),this.setOutputData(0,t)},u.prototype.onAction=function(t,e){"clear"==t&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},e.registerNodeType("graphics/canvas",u),l.title="DrawImage",l.desc="Draws image into a canvas",l.prototype.onExecute=function(){var t=this.getInputData(0);if(t){var e=this.getInputOrProperty("img");if(e){var n=this.getInputOrProperty("x"),i=this.getInputOrProperty("y");t.getContext("2d").drawImage(e,n,i)}}},e.registerNodeType("graphics/drawImage",l),p.title="DrawRectangle",p.desc="Draws rectangle in canvas",p.prototype.onExecute=function(){var t=this.getInputData(0);if(t){var e=this.getInputOrProperty("x"),n=this.getInputOrProperty("y"),i=this.getInputOrProperty("w"),r=this.getInputOrProperty("h");t.getContext("2d").fillRect(e,n,i,r)}},e.registerNodeType("graphics/drawRectangle",p),h.title="Video",h.desc="Video playback",h.widgets=[{name:"play",text:"PLAY",type:"minibutton"},{name:"stop",text:"STOP",type:"minibutton"},{name:"demo",text:"Demo video",type:"button"},{name:"mute",text:"Mute video",type:"button"}],h.prototype.onExecute=function(){if(this.properties.url&&(this.properties.url!=this._video_url&&this.loadVideo(this.properties.url),this._video&&0!=this._video.width)){var t=this.getInputData(0);t&&t>=0&&t<=1&&(this._video.currentTime=t*this._video.duration,this._video.pause()),this._video.dirty=!0,this.setOutputData(0,this._video),this.setOutputData(1,this._video.currentTime),this.setOutputData(2,this._video.duration),this.setDirtyCanvas(!0)}},h.prototype.onStart=function(){this.play()},h.prototype.onStop=function(){this.stop()},h.prototype.loadVideo=function(t){this._video_url=t;var n=t.substr(0,10).indexOf(":"),i="";-1!=n&&(i=t.substr(0,n));var r="";i&&(r=(r=t.substr(0,t.indexOf("/",i.length+3))).substr(i.length+3)),this.properties.use_proxy&&i&&e.proxy&&r!=location.host&&(t=e.proxy+t.substr(t.indexOf(":")+3)),this._video=document.createElement("video"),this._video.src=t,this._video.type="type=video/mp4",this._video.muted=!0,this._video.autoplay=!0;var o=this;this._video.addEventListener("loadedmetadata",(function(t){console.log("Duration: "+this.duration+" seconds"),console.log("Size: "+this.videoWidth+","+this.videoHeight),o.setDirtyCanvas(!0),this.width=this.videoWidth,this.height=this.videoHeight})),this._video.addEventListener("progress",(function(t){console.log("video loading...")})),this._video.addEventListener("error",(function(t){if(console.error("Error loading video: "+this.src),this.error)switch(this.error.code){case this.error.MEDIA_ERR_ABORTED:console.error("You stopped the video.");break;case this.error.MEDIA_ERR_NETWORK:console.error("Network error - please try again later.");break;case this.error.MEDIA_ERR_DECODE:console.error("Video is broken..");break;case this.error.MEDIA_ERR_SRC_NOT_SUPPORTED:console.error("Sorry, your browser can't play this video.")}})),this._video.addEventListener("ended",(function(t){console.log("Video Ended."),this.play()}))},h.prototype.onPropertyChanged=function(t,e){return this.properties[t]=e,"url"==t&&""!=e&&this.loadVideo(e),!0},h.prototype.play=function(){this._video&&this._video.videoWidth&&this._video.play()},h.prototype.playPause=function(){this._video&&(this._video.paused?this.play():this.pause())},h.prototype.stop=function(){this._video&&(this._video.pause(),this._video.currentTime=0)},h.prototype.pause=function(){this._video&&(console.log("Video paused"),this._video.pause())},h.prototype.onWidget=function(t,e){},e.registerNodeType("graphics/video",h),c.title="Webcam",c.desc="Webcam image",c.is_webcam_open=!1,c.prototype.openStream=function(){if(navigator.mediaDevices.getUserMedia){this._waiting_confirmation=!0;var t={audio:!1,video:!this.properties.filterFacingMode||{facingMode:this.properties.facingMode}};navigator.mediaDevices.getUserMedia(t).then(this.streamReady.bind(this)).catch((function(t){console.log("Webcam rejected",t),e._webcam_stream=!1,c.is_webcam_open=!1,e.boxcolor="red",e.trigger("stream_error")}));var e=this}else console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags")},c.prototype.closeStream=function(){if(this._webcam_stream){var t=this._webcam_stream.getTracks();if(t.length)for(var e=0;e<t.length;++e)t[e].stop();c.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},c.prototype.onPropertyChanged=function(t,e){"facingMode"==t&&(this.properties.facingMode=e,this.closeStream(),this.openStream())},c.prototype.onRemoved=function(){this.closeStream()},c.prototype.streamReady=function(t){this._webcam_stream=t,this.boxcolor="green";var e=this._video;e||((e=document.createElement("video")).autoplay=!0,e.srcObject=t,this._video=e,e.onloadedmetadata=function(t){console.log(t),c.is_webcam_open=!0}),this.trigger("stream_ready",e)},c.prototype.onExecute=function(){if(null!=this._webcam_stream||this._waiting_confirmation||this.openStream(),this._video&&this._video.videoWidth){this._video.frame=++this.frame,this._video.width=this._video.videoWidth,this._video.height=this._video.videoHeight,this.setOutputData(0,this._video);for(var t=1;t<this.outputs.length;++t)if(this.outputs[t])switch(this.outputs[t].name){case"width":this.setOutputData(t,this._video.videoWidth);break;case"height":this.setOutputData(t,this._video.videoHeight)}}},c.prototype.getExtraMenuOptions=function(t){var e=this;return[{content:e.properties.show?"Hide Frame":"Show Frame",callback:function(){e.properties.show=!e.properties.show}}]},c.prototype.onDrawBackground=function(t){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._video&&(t.save(),t.drawImage(this._video,0,0,this.size[0],this.size[1]),t.restore())},c.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",e.EVENT],["stream_closed",e.EVENT],["stream_error",e.EVENT]]},e.registerNodeType("graphics/webcam",c)}(this),function(t){var e=t.LiteGraph,n=t.LGraphCanvas;function i(){this.addOutput("tex","Texture"),this.addOutput("name","string"),this.properties={name:"",filter:!0},this.size=[i.image_preview_size,i.image_preview_size]}function r(){this.addInput("Texture","Texture"),this.properties={flipY:!1},this.size=[i.image_preview_size,i.image_preview_size]}function o(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("name","string"),this.properties={name:"",generate_mipmaps:!1}}function s(){this.addInput("Texture","Texture"),this.addInput("TextureB","Texture"),this.addInput("value","number"),this.addOutput("Texture","Texture"),this.help="<p>pixelcode must be vec3, uvcode must be vec2, is optional</p>\t\t<p><strong>uv:</strong> tex. coords</p><p><strong>color:</strong> texture <strong>colorB:</strong> textureB</p><p><strong>time:</strong> scene time <strong>value:</strong> input value</p><p>For multiline you must type: result = ...</p>",this.properties={value:1,pixelcode:"color + colorB * value",uvcode:"",precision:i.DEFAULT},this.has_error=!1}function a(){this.addOutput("out","Texture"),this.properties={code:"",u_value:1,u_color:[1,1,1,1],width:512,height:512,precision:i.DEFAULT},this.properties.code=a.pixel_shader,this._uniforms={u_value:1,u_color:vec4.create(),in_texture:0,texSize:vec4.create(),time:0}}function u(){this.addInput("in","Texture"),this.addInput("scale","vec2"),this.addInput("offset","vec2"),this.addOutput("out","Texture"),this.properties={offset:vec2.fromValues(0,0),scale:vec2.fromValues(1,1),precision:i.DEFAULT}}function l(){this.addInput("in","Texture"),this.addInput("warp","Texture"),this.addInput("factor","number"),this.addOutput("out","Texture"),this.properties={factor:.01,scale:[1,1],offset:[0,0],precision:i.DEFAULT},this._uniforms={u_texture:0,u_textureB:1,u_factor:1,u_scale:vec2.create(),u_offset:vec2.create()}}function p(){this.addInput("Texture","Texture"),this.properties={additive:!1,antialiasing:!1,filter:!0,disable_alpha:!1,gamma:1,viewport:[0,0,1,1]},this.size[0]=130}function h(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:0,generate_mipmaps:!1,precision:i.DEFAULT}}function c(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={iterations:1,generate_mipmaps:!1,precision:i.DEFAULT}}function d(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:[512,512],generate_mipmaps:!1,precision:i.DEFAULT}}function f(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("avg","vec4"),this.addOutput("lum","number"),this.properties={use_previous_frame:!0,high_quality:!1},this._uniforms={u_texture:0,u_mipmap_offset:0},this._luminance=new Float32Array(4)}function g(){this.addInput("Texture","Texture"),this.addOutput("min_t","Texture"),this.addOutput("max_t","Texture"),this.addOutput("min","vec4"),this.addOutput("max","vec4"),this.properties={mode:"max",use_previous_frame:!0},this._uniforms={u_texture:0},this._max=new Float32Array(4),this._min=new Float32Array(4),this._textures_chain=[]}function _(){this.addInput("in","Texture"),this.addInput("factor","Number"),this.addOutput("out","Texture"),this.properties={factor:.5},this._uniforms={u_texture:0,u_textureB:1,u_factor:this.properties.factor}}function v(){this.addInput("in","Texture"),this.addOutput("avg","Texture"),this.addOutput("array","Texture"),this.properties={samples:64,frames_interval:1},this._uniforms={u_texture:0,u_textureB:1,u_samples:this.properties.samples,u_isamples:1/this.properties.samples},this.frame=0}function m(){this.addInput("Image","image"),this.addOutput("","Texture"),this.properties={}}function y(){this.addInput("Texture","Texture"),this.addInput("LUT","Texture"),this.addInput("Intensity","number"),this.addOutput("","Texture"),this.properties={enabled:!0,intensity:1,precision:i.DEFAULT,texture:null},y._shader||(y._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,y.pixel_shader))}function b(){this.addInput("Texture","Texture"),this.addInput("Atlas","Texture"),this.addOutput("","Texture"),this.properties={enabled:!0,num_row_symbols:4,symbol_size:16,brightness:1,colorize:!1,filter:!1,invert:!1,precision:i.DEFAULT,generate_mipmaps:!1,texture:null},b._shader||(b._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,b.pixel_shader)),this._uniforms={u_texture:0,u_textureB:1,u_row_simbols:4,u_simbol_size:16,u_res:vec2.create()}}function x(){this.addInput("Texture","Texture"),this.addOutput("R","Texture"),this.addOutput("G","Texture"),this.addOutput("B","Texture"),this.addOutput("A","Texture"),x._shader||(x._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,x.pixel_shader))}function A(){this.addInput("R","Texture"),this.addInput("G","Texture"),this.addInput("B","Texture"),this.addInput("A","Texture"),this.addOutput("Texture","Texture"),this.properties={precision:i.DEFAULT,R:1,G:1,B:1,A:1},this._color=vec4.create(),this._uniforms={u_textureR:0,u_textureG:1,u_textureB:2,u_textureA:3,u_color:this._color}}function w(){this.addOutput("Texture","Texture"),this._tex_color=vec4.create(),this.properties={color:vec4.create(),precision:i.DEFAULT}}function E(){this.addInput("A","color"),this.addInput("B","color"),this.addOutput("Texture","Texture"),this.properties={angle:0,scale:1,A:[0,0,0],B:[1,1,1],texture_size:32},E._shader||(E._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,E.pixel_shader)),this._uniforms={u_angle:0,u_colorA:vec3.create(),u_colorB:vec3.create()}}function C(){this.addInput("A","Texture"),this.addInput("B","Texture"),this.addInput("Mixer","Texture"),this.addOutput("Texture","Texture"),this.properties={factor:.5,size_from_biggest:!0,invert:!1,precision:i.DEFAULT},this._uniforms={u_textureA:0,u_textureB:1,u_textureMix:2,u_mix:vec4.create()}}function T(){this.addInput("Tex.","Texture"),this.addOutput("Edges","Texture"),this.properties={invert:!0,threshold:!1,factor:1,precision:i.DEFAULT},T._shader||(T._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,T.pixel_shader))}function O(){this.addInput("Texture","Texture"),this.addInput("Distance","number"),this.addInput("Range","number"),this.addOutput("Texture","Texture"),this.properties={distance:100,range:50,only_depth:!1,high_precision:!1},this._uniforms={u_texture:0,u_distance:100,u_range:50,u_camera_planes:null}}function S(){this.addInput("Texture","Texture"),this.addOutput("Texture","Texture"),this.properties={precision:i.DEFAULT,invert:!1},this._uniforms={u_texture:0,u_camera_planes:null,u_ires:vec2.create()}}function I(){this.addInput("Texture","Texture"),this.addInput("Iterations","number"),this.addInput("Intensity","number"),this.addOutput("Blurred","Texture"),this.properties={intensity:1,iterations:1,preserve_aspect:!1,scale:[1,1],precision:i.DEFAULT}}function L(){this.intensity=.5,this.persistence=.6,this.iterations=8,this.threshold=.8,this.scale=1,this.dirt_texture=null,this.dirt_factor=.5,this._textures=[],this._uniforms={u_intensity:1,u_texture:0,u_glow_texture:1,u_threshold:0,u_texel_size:vec2.create()}}function N(){this.addInput("in","Texture"),this.addInput("dirt","Texture"),this.addOutput("out","Texture"),this.addOutput("glow","Texture"),this.properties={enabled:!0,intensity:1,persistence:.99,iterations:16,threshold:0,scale:1,dirt_factor:.5,precision:i.DEFAULT},this.fx=new L}function D(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={intensity:1,radius:5}}function k(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={sigma:1.4,k:1.6,p:21.7,epsilon:79,phi:.017}}function G(){this.addOutput("Webcam","Texture"),this.properties={texture_name:"",facingMode:"user"},this.boxcolor="black",this.version=0}function P(){this.addInput("in","Texture"),this.addInput("f","number"),this.addOutput("out","Texture"),this.properties={enabled:!0,factor:1,precision:i.LOW},this._uniforms={u_texture:0,u_factor:1}}function B(){this.addInput("in",""),this.properties={precision:i.LOW,width:0,height:0,channels:1},this.addOutput("out","Texture")}function R(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={precision:i.LOW,split_channels:!1},this._values=new Uint8Array(1024),this._values.fill(255),this._curve_texture=null,this._uniforms={u_texture:0,u_curve:1,u_range:1},this._must_update=!0,this._points={RGB:[[0,0],[1,1]],R:[[0,0],[1,1]],G:[[0,0],[1,1]],B:[[0,0],[1,1]]},this.curve_editor=null,this.addWidget("toggle","Split Channels",!1,"split_channels"),this.addWidget("combo","Channel","RGB",{values:["RGB","R","G","B"]}),this.curve_offset=68,this.size=[240,160]}function M(){this.addInput("in","Texture"),this.addInput("exp","number"),this.addOutput("out","Texture"),this.properties={exposition:1,precision:i.LOW},this._uniforms={u_texture:0,u_exposition:1}}function z(){this.addInput("in","Texture"),this.addInput("avg","number,Texture"),this.addOutput("out","Texture"),this.properties={enabled:!0,scale:1,gamma:1,average_lum:1,lum_white:1,precision:i.LOW},this._uniforms={u_texture:0,u_lumwhite2:1,u_igamma:1,u_scale:1,u_average_lum:1}}function F(){this.addOutput("out","Texture"),this.properties={width:512,height:512,seed:0,persistence:.1,octaves:8,scale:1,offset:[0,0],amplitude:1,precision:i.DEFAULT},this._key=0,this._texture=null,this._uniforms={u_persistence:.1,u_seed:0,u_offset:vec2.create(),u_scale:1,u_viewport:vec2.create()}}function j(){this.addInput("v"),this.addOutput("out","Texture"),this.properties={code:j.default_code,width:512,height:512,clear:!0,precision:i.DEFAULT,use_html_canvas:!1},this._func=null,this._temp_texture=null,this.compileCode()}function H(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={key_color:vec3.fromValues(0,1,0),threshold:.8,slope:.2,precision:i.DEFAULT}}function U(){this.addInput("in","texture"),this.addInput("yaw","number"),this.addOutput("out","texture"),this.properties={yaw:0}}t.LGraphTexture=null,"undefined"!=typeof GL&&(n.link_type_colors.Texture="#987",t.LGraphTexture=i,i.title="Texture",i.desc="Texture",i.widgets_info={name:{widget:"texture"},filter:{widget:"checkbox"}},i.loadTextureCallback=null,i.image_preview_size=256,i.UNDEFINED=0,i.PASS_THROUGH=1,i.COPY=2,i.LOW=3,i.HIGH=4,i.REUSE=5,i.DEFAULT=2,i.MODE_VALUES={undefined:i.UNDEFINED,"pass through":i.PASS_THROUGH,copy:i.COPY,low:i.LOW,high:i.HIGH,reuse:i.REUSE,default:i.DEFAULT},i.getTexturesContainer=function(){return gl.textures},i.loadTexture=function(t,n){n=n||{};var r=t;return"http://"==r.substr(0,7)&&e.proxy&&(r=e.proxy+r.substr(7)),i.getTexturesContainer()[t]=GL.Texture.fromURL(r,n)},i.getTexture=function(t){var e=this.getTexturesContainer();if(!e)throw"Cannot load texture, container of textures not found";var n=e[t];return!n&&t&&":"!=t[0]?this.loadTexture(t):n},i.getTargetTexture=function(t,e,n){if(!t)throw"LGraphTexture.getTargetTexture expects a reference texture";var r=null;switch(n){case i.LOW:r=gl.UNSIGNED_BYTE;break;case i.HIGH:r=gl.HIGH_PRECISION_FORMAT;break;case i.REUSE:return t;case i.COPY:default:r=t?t.type:gl.UNSIGNED_BYTE}return e&&e.width==t.width&&e.height==t.height&&e.type==r&&e.format==t.format||(e=new GL.Texture(t.width,t.height,{type:r,format:t.format,filter:gl.LINEAR})),e},i.getTextureType=function(t,e){var n=e?e.type:gl.UNSIGNED_BYTE;switch(t){case i.HIGH:n=gl.HIGH_PRECISION_FORMAT;break;case i.LOW:n=gl.UNSIGNED_BYTE}return n},i.getWhiteTexture=function(){return this._white_texture?this._white_texture:this._white_texture=GL.Texture.fromMemory(1,1,[255,255,255,255],{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST})},i.getNoiseTexture=function(){if(this._noise_texture)return this._noise_texture;for(var t=new Uint8Array(1048576),e=0;e<1048576;++e)t[e]=255*Math.random();var n=GL.Texture.fromMemory(512,512,t,{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return this._noise_texture=n,n},i.prototype.onDropFile=function(t,e,n){if(t){var i=null;if("string"==typeof t)i=GL.Texture.fromURL(t);else if(-1!=e.toLowerCase().indexOf(".dds"))i=GL.Texture.fromDDSInMemory(t);else{var r=new Blob([n]),o=URL.createObjectURL(r);i=GL.Texture.fromURL(o)}this._drop_texture=i,this.properties.name=e}else this._drop_texture=null,this.properties.name=""},i.prototype.getExtraMenuOptions=function(t){var e=this;if(this._drop_texture)return[{content:"Clear",callback:function(){e._drop_texture=null,e.properties.name=""}}]},i.prototype.onExecute=function(){var t=null;if(this.isOutputConnected(1)&&(t=this.getInputData(0)),!t&&this._drop_texture&&(t=this._drop_texture),!t&&this.properties.name&&(t=i.getTexture(this.properties.name)),!t)return this.setOutputData(0,null),void this.setOutputData(1,"");this._last_tex=t,!1===this.properties.filter?t.setParameter(gl.TEXTURE_MAG_FILTER,gl.NEAREST):t.setParameter(gl.TEXTURE_MAG_FILTER,gl.LINEAR),this.setOutputData(0,t),this.setOutputData(1,t.fullpath||t.filename);for(var e=2;e<this.outputs.length;e++){var n=this.outputs[e];if(n){var r=null;"width"==n.name?r=t.width:"height"==n.name?r=t.height:"aspect"==n.name&&(r=t.width/t.height),this.setOutputData(e,r)}}},i.prototype.onResourceRenamed=function(t,e){this.properties.name==t&&(this.properties.name=e)},i.prototype.onDrawBackground=function(t){if(!(this.flags.collapsed||this.size[1]<=20))if(this._drop_texture&&t.webgl)t.drawImage(this._drop_texture,0,0,this.size[0],this.size[1]);else{if(this._last_preview_tex!=this._last_tex)if(t.webgl)this._canvas=this._last_tex;else{var e=i.generateLowResTexturePreview(this._last_tex);if(!e)return;this._last_preview_tex=this._last_tex,this._canvas=cloneCanvas(e)}this._canvas&&(t.save(),t.webgl||(t.translate(0,this.size[1]),t.scale(1,-1)),t.drawImage(this._canvas,0,0,this.size[0],this.size[1]),t.restore())}},i.generateLowResTexturePreview=function(t){if(!t)return null;var e=i.image_preview_size,n=t;if(t.format==gl.DEPTH_COMPONENT)return null;(t.width>e||t.height>e)&&(n=this._preview_temp_tex,this._preview_temp_tex||(n=new GL.Texture(e,e,{minFilter:gl.NEAREST}),this._preview_temp_tex=n),t.copyTo(n),t=n);var r=this._preview_canvas;return r||(r=createCanvas(e,e),this._preview_canvas=r),n&&n.toCanvas(r),r},i.prototype.getResources=function(t){return this.properties.name&&(t[this.properties.name]=GL.Texture),t},i.prototype.onGetInputs=function(){return[["in","Texture"]]},i.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["aspect","number"]]},i.replaceCode=function(t,e){return t.replace(/\{\{[a-zA-Z0-9_]*\}\}/g,(function(t){return t=t.replace(/[\{\}]/g,""),e[t]||""}))},e.registerNodeType("texture/texture",i),r.title="Preview",r.desc="Show a texture in the graph canvas",r.allow_preview=!1,r.prototype.onDrawBackground=function(t){if(!this.flags.collapsed&&(t.webgl||r.allow_preview)){var e=this.getInputData(0);if(e){var n;n=!e.handle&&t.webgl?e:i.generateLowResTexturePreview(e),t.save(),this.properties.flipY&&(t.translate(0,this.size[1]),t.scale(1,-1)),t.drawImage(n,0,0,this.size[0],this.size[1]),t.restore()}}},e.registerNodeType("texture/preview",r),o.title="Save",o.desc="Save a texture in the repository",o.prototype.getPreviewTexture=function(){return this._texture},o.prototype.onExecute=function(){var t=this.getInputData(0);t&&(this.properties.generate_mipmaps&&(t.bind(0),t.setParameter(gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR),gl.generateMipmap(t.texture_type),t.unbind(0)),this.properties.name&&(i.storeTexture?i.storeTexture(this.properties.name,t):i.getTexturesContainer()[this.properties.name]=t),this._texture=t,this.setOutputData(0,t),this.setOutputData(1,this.properties.name))},e.registerNodeType("texture/save",o),s.widgets_info={uvcode:{widget:"code"},pixelcode:{widget:"code"},precision:{widget:"combo",values:i.MODE_VALUES}},s.title="Operation",s.desc="Texture shader operation",s.presets={},s.prototype.getExtraMenuOptions=function(t){var e=this;return[{content:e.properties.show?"Hide Texture":"Show Texture",callback:function(){e.properties.show=!e.properties.show}}]},s.prototype.onPropertyChanged=function(){this.has_error=!1},s.prototype.onDrawBackground=function(t){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._tex&&this._tex.gl==t&&(t.save(),t.drawImage(this._tex,0,0,this.size[0],this.size[1]),t.restore())},s.prototype.onExecute=function(){var t=this.getInputData(0);if(this.isOutputConnected(0))if(this.properties.precision!==i.PASS_THROUGH){var e=this.getInputData(1);if(this.properties.uvcode||this.properties.pixelcode){var n=512,r=512;t?(n=t.width,r=t.height):e&&(n=e.width,r=e.height),e||(e=GL.Texture.getWhiteTexture());var o=i.getTextureType(this.properties.precision,t);t||this._tex?this._tex=i.getTargetTexture(t||this._tex,this._tex,this.properties.precision):this._tex=new GL.Texture(n,r,{type:o,format:gl.RGBA,filter:gl.LINEAR});var a="";this.properties.uvcode&&(a="uv = "+this.properties.uvcode,-1!=this.properties.uvcode.indexOf(";")&&(a=this.properties.uvcode));var u="";this.properties.pixelcode&&(u="result = "+this.properties.pixelcode,-1!=this.properties.pixelcode.indexOf(";")&&(u=this.properties.pixelcode));var l=this._shader;if(!(this.has_error||l&&this._shader_code==a+"|"+u)){var p=i.replaceCode(s.pixel_shader,{UV_CODE:a,PIXEL_CODE:u});try{l=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,p),this.boxcolor="#00FF00"}catch(t){return GL.Shader.dumpErrorToConsole(t,Shader.SCREEN_VERTEX_SHADER,p),this.boxcolor="#FF0000",void(this.has_error=!0)}this._shader=l,this._shader_code=a+"|"+u}if(this._shader){var h=this.getInputData(2);null!=h?this.properties.value=h:h=parseFloat(this.properties.value);var c=this.graph.getTime();this._tex.drawTo((function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),t&&t.bind(0),e&&e.bind(1);var i=Mesh.getScreenQuad();l.uniforms({u_texture:0,u_textureB:1,value:h,texSize:[n,r,1/n,1/r],time:c}).draw(i)})),this.setOutputData(0,this._tex)}}}else this.setOutputData(0,t)},s.pixel_shader="precision highp float;\n\t\t\n\t\tuniform sampler2D u_texture;\n\t\tuniform sampler2D u_textureB;\n\t\tvarying vec2 v_coord;\n\t\tuniform vec4 texSize;\n\t\tuniform float time;\n\t\tuniform float value;\n\t\t\n\t\tvoid main() {\n\t\t\tvec2 uv = v_coord;\n\t\t\t{{UV_CODE}};\n\t\t\tvec4 color4 = texture2D(u_texture, uv);\n\t\t\tvec3 color = color4.rgb;\n\t\t\tvec4 color4B = texture2D(u_textureB, uv);\n\t\t\tvec3 colorB = color4B.rgb;\n\t\t\tvec3 result = color;\n\t\t\tfloat alpha = 1.0;\n\t\t\t{{PIXEL_CODE}};\n\t\t\tgl_FragColor = vec4(result, alpha);\n\t\t}\n\t\t",s.registerPreset=function(t,e){s.presets[t]=e},s.registerPreset("",""),s.registerPreset("bypass","color"),s.registerPreset("add","color + colorB * value"),s.registerPreset("substract","(color - colorB) * value"),s.registerPreset("mate","mix( color, colorB, color4B.a * value)"),s.registerPreset("invert","vec3(1.0) - color"),s.registerPreset("multiply","color * colorB * value"),s.registerPreset("divide","(color / colorB) / value"),s.registerPreset("difference","abs(color - colorB) * value"),s.registerPreset("max","max(color, colorB) * value"),s.registerPreset("min","min(color, colorB) * value"),s.registerPreset("displace","texture2D(u_texture, uv + (colorB.xy - vec2(0.5)) * value).xyz"),s.registerPreset("grayscale","vec3(color.x + color.y + color.z) * value / 3.0"),s.registerPreset("saturation","mix( vec3(color.x + color.y + color.z) / 3.0, color, value )"),s.registerPreset("normalmap","\n\t\tfloat z0 = texture2D(u_texture, uv + vec2(-texSize.z, -texSize.w) ).x;\n\t\tfloat z1 = texture2D(u_texture, uv + vec2(0.0, -texSize.w) ).x;\n\t\tfloat z2 = texture2D(u_texture, uv + vec2(texSize.z, -texSize.w) ).x;\n\t\tfloat z3 = texture2D(u_texture, uv + vec2(-texSize.z, 0.0) ).x;\n\t\tfloat z4 = color.x;\n\t\tfloat z5 = texture2D(u_texture, uv + vec2(texSize.z, 0.0) ).x;\n\t\tfloat z6 = texture2D(u_texture, uv + vec2(-texSize.z, texSize.w) ).x;\n\t\tfloat z7 = texture2D(u_texture, uv + vec2(0.0, texSize.w) ).x;\n\t\tfloat z8 = texture2D(u_texture, uv + vec2(texSize.z, texSize.w) ).x;\n\t\tvec3 normal = vec3( z2 + 2.0*z4 + z7 - z0 - 2.0*z3 - z5, z5 + 2.0*z6 + z7 -z0 - 2.0*z1 - z2, 1.0 );\n\t\tnormal.xy *= value;\n\t\tresult.xyz = normalize(normal) * 0.5 + vec3(0.5);\n\t"),s.registerPreset("threshold","vec3(color.x > colorB.x * value ? 1.0 : 0.0,color.y > colorB.y * value ? 1.0 : 0.0,color.z > colorB.z * value ? 1.0 : 0.0)"),s.prototype.onInspect=function(t){var e=this;t.addCombo("Presets","",{values:Object.keys(s.presets),callback:function(n){var i=s.presets[n];i&&(e.setProperty("pixelcode",i),e.title=n,t.refresh())}})},e.registerNodeType("texture/operation",s),a.title="Shader",a.desc="Texture shader",a.widgets_info={code:{type:"code",lang:"glsl"},precision:{widget:"combo",values:i.MODE_VALUES}},a.prototype.onPropertyChanged=function(t,e){if("code"==t){var n=this.getShader();if(n){var i=n.uniformInfo;if(this.inputs)for(var r={},o=0;o<this.inputs.length;++o)(s=this.getInputInfo(o))&&(!i[s.name]||r[s.name]?(this.removeInput(o),o--):r[s.name]=!0);for(var o in i){var s;if(null!==(s=n.uniformInfo[o]).loc&&"time"!=o){var a="number";if(this._shader.samplers[o])a="texture";else switch(s.size){case 1:a="number";break;case 2:a="vec2";break;case 3:a="vec3";break;case 4:a="vec4";break;case 9:a="mat3";break;case 16:a="mat4";break;default:continue}var u=this.findInputSlot(o);if(-1!=u){var l=this.getInputInfo(u);if(l){if(l.type==a)continue;this.removeInput(u,a),this.addInput(o,a)}else this.addInput(o,a)}else this.addInput(o,a)}}}}},a.prototype.getShader=function(){return this._shader&&this._shader_code==this.properties.code?this._shader:(this._shader_code=this.properties.code,this._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,this.properties.code),this._shader?(this.boxcolor="green",this._shader):(this.boxcolor="red",null))},a.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=this.getShader();if(t){var e=0,n=null;if(this.inputs)for(var r=0;r<this.inputs.length;++r){var o=this.getInputInfo(r),s=this.getInputData(r);null!=s&&(s.constructor===GL.Texture&&(s.bind(e),n||(n=s),s=e,e++),t.setUniform(o.name,s))}var a=this._uniforms,u=i.getTextureType(this.properties.precision,n),l=0|this.properties.width,p=0|this.properties.height;0==l&&(l=n?n.width:gl.canvas.width),0==p&&(p=n?n.height:gl.canvas.height),a.texSize[0]=l,a.texSize[1]=p,a.texSize[2]=1/l,a.texSize[3]=1/p,a.time=this.graph.getTime(),a.u_value=this.properties.u_value,a.u_color.set(this.properties.u_color),this._tex&&this._tex.type==u&&this._tex.width==l&&this._tex.height==p||(this._tex=new GL.Texture(l,p,{type:u,format:gl.RGBA,filter:gl.LINEAR})),this._tex.drawTo((function(){t.uniforms(a).draw(GL.Mesh.getScreenQuad())})),this.setOutputData(0,this._tex)}}},a.pixel_shader="precision highp float;\n\nvarying vec2 v_coord;\nuniform float time; //time in seconds\nuniform vec4 texSize; //tex resolution\nuniform float u_value;\nuniform vec4 u_color;\n\nvoid main() {\n\tvec2 uv = v_coord;\n\tvec3 color = vec3(0.0);\n\t//your code here\n\tcolor.xy=uv;\n\n\tgl_FragColor = vec4(color, 1.0);\n}\n",e.registerNodeType("texture/shader",a),u.widgets_info={precision:{widget:"combo",values:i.MODE_VALUES}},u.title="Scale/Offset",u.desc="Applies an scaling and offseting",u.prototype.onExecute=function(){var t=this.getInputData(0);if(this.isOutputConnected(0)&&t)if(this.properties.precision!==i.PASS_THROUGH){var e=t.width,n=t.height,r=this.precision===i.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT;this.precision===i.DEFAULT&&(r=t.type),this._tex&&this._tex.width==e&&this._tex.height==n&&this._tex.type==r||(this._tex=new GL.Texture(e,n,{type:r,format:gl.RGBA,filter:gl.LINEAR}));var o=this._shader;o||(o=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,u.pixel_shader));var s=this.getInputData(1);s?(this.properties.scale[0]=s[0],this.properties.scale[1]=s[1]):s=this.properties.scale;var a=this.getInputData(2);a?(this.properties.offset[0]=a[0],this.properties.offset[1]=a[1]):a=this.properties.offset,this._tex.drawTo((function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),t.bind(0);var e=Mesh.getScreenQuad();o.uniforms({u_texture:0,u_scale:s,u_offset:a}).draw(e)})),this.setOutputData(0,this._tex)}else this.setOutputData(0,t)},u.pixel_shader="precision highp float;\n\t\t\n\t\tuniform sampler2D u_texture;\n\t\tuniform sampler2D u_textureB;\n\t\tvarying vec2 v_coord;\n\t\tuniform vec2 u_scale;\n\t\tuniform vec2 u_offset;\n\t\t\n\t\tvoid main() {\n\t\t\tvec2 uv = v_coord;\n\t\t\tuv = uv / u_scale - u_offset;\n\t\t\tgl_FragColor = texture2D(u_texture, uv);\n\t\t}\n\t\t",e.registerNodeType("texture/scaleOffset",u),l.widgets_info={precision:{widget:"combo",values:i.MODE_VALUES}},l.title="Warp",l.desc="Texture warp operation",l.prototype.onExecute=function(){var t=this.getInputData(0);if(this.isOutputConnected(0))if(this.properties.precision!==i.PASS_THROUGH){var e=this.getInputData(1),n=512,r=512;gl.UNSIGNED_BYTE,t?(n=t.width,r=t.height,t.type):e&&(n=e.width,r=e.height,e.type),t||this._tex?this._tex=i.getTargetTexture(t||this._tex,this._tex,this.properties.precision):this._tex=new GL.Texture(n,r,{type:this.precision===i.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT,format:gl.RGBA,filter:gl.LINEAR});var o=this._shader;o||(o=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,l.pixel_shader));var s=this.getInputData(2);null!=s?this.properties.factor=s:s=parseFloat(this.properties.factor);var a=this._uniforms;a.u_factor=s,a.u_scale.set(this.properties.scale),a.u_offset.set(this.properties.offset),this._tex.drawTo((function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),t&&t.bind(0),e&&e.bind(1);var n=Mesh.getScreenQuad();o.uniforms(a).draw(n)})),this.setOutputData(0,this._tex)}else this.setOutputData(0,t)},l.pixel_shader="precision highp float;\n\t\t\n\t\tuniform sampler2D u_texture;\n\t\tuniform sampler2D u_textureB;\n\t\tvarying vec2 v_coord;\n\t\tuniform float u_factor;\n\t\tuniform vec2 u_scale;\n\t\tuniform vec2 u_offset;\n\t\t\n\t\tvoid main() {\n\t\t\tvec2 uv = v_coord;\n\t\t\tuv += ( texture2D(u_textureB, uv).rg - vec2(0.5)) * u_factor * u_scale + u_offset;\n\t\t\tgl_FragColor = texture2D(u_texture, uv);\n\t\t}\n\t\t",e.registerNodeType("texture/warp",l),p.title="to Viewport",p.desc="Texture to viewport",p._prev_viewport=new Float32Array(4),p.prototype.onDrawBackground=function(t){if(!(this.flags.collapsed||this.size[1]<=40)){var e=this.getInputData(0);e&&t.drawImage(t==gl?e:gl.canvas,10,30,this.size[0]-20,this.size[1]-40)}},p.prototype.onExecute=function(){var t=this.getInputData(0);if(t){this.properties.disable_alpha?gl.disable(gl.BLEND):(gl.enable(gl.BLEND),this.properties.additive?gl.blendFunc(gl.SRC_ALPHA,gl.ONE):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)),gl.disable(gl.DEPTH_TEST);var e=this.properties.gamma||1;this.isInputConnected(1)&&(e=this.getInputData(1)),t.setParameter(gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST);var n=p._prev_viewport;n.set(gl.viewport_data);var i=this.properties.viewport;if(gl.viewport(n[0]+n[2]*i[0],n[1]+n[3]*i[1],n[2]*i[2],n[3]*i[3]),gl.getViewport(),this.properties.antialiasing){p._shader||(p._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,p.aa_pixel_shader));var r=Mesh.getScreenQuad();t.bind(0),p._shader.uniforms({u_texture:0,uViewportSize:[t.width,t.height],u_igamma:1/e,inverseVP:[1/t.width,1/t.height]}).draw(r)}else 1!=e?(p._gamma_shader||(p._gamma_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,p.gamma_pixel_shader)),t.toViewport(p._gamma_shader,{u_texture:0,u_igamma:1/e})):t.toViewport();gl.viewport(n[0],n[1],n[2],n[3])}},p.prototype.onGetInputs=function(){return[["gamma","number"]]},p.aa_pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform vec2 uViewportSize;\n\t\tuniform vec2 inverseVP;\n\t\tuniform float u_igamma;\n\t\t#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n\t\t#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n\t\t#define FXAA_SPAN_MAX     8.0\n\t\t\n\t\t/* from mitsuhiko/webgl-meincraft based on the code on geeks3d.com */\n\t\tvec4 applyFXAA(sampler2D tex, vec2 fragCoord)\n\t\t{\n\t\t\tvec4 color = vec4(0.0);\n\t\t\t/*vec2 inverseVP = vec2(1.0 / uViewportSize.x, 1.0 / uViewportSize.y);*/\n\t\t\tvec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;\n\t\t\tvec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;\n\t\t\tvec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;\n\t\t\tvec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;\n\t\t\tvec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;\n\t\t\tvec3 luma = vec3(0.299, 0.587, 0.114);\n\t\t\tfloat lumaNW = dot(rgbNW, luma);\n\t\t\tfloat lumaNE = dot(rgbNE, luma);\n\t\t\tfloat lumaSW = dot(rgbSW, luma);\n\t\t\tfloat lumaSE = dot(rgbSE, luma);\n\t\t\tfloat lumaM  = dot(rgbM,  luma);\n\t\t\tfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n\t\t\tfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\t\t\t\n\t\t\tvec2 dir;\n\t\t\tdir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n\t\t\tdir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\t\t\t\n\t\t\tfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\t\t\t\n\t\t\tfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n\t\t\tdir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * inverseVP;\n\t\t\t\n\t\t\tvec3 rgbA = 0.5 * (texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz + \n\t\t\t\ttexture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n\t\t\tvec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz + \n\t\t\t\ttexture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\t\t\t\n\t\t\t//return vec4(rgbA,1.0);\n\t\t\tfloat lumaB = dot(rgbB, luma);\n\t\t\tif ((lumaB < lumaMin) || (lumaB > lumaMax))\n\t\t\t\tcolor = vec4(rgbA, 1.0);\n\t\t\telse\n\t\t\t\tcolor = vec4(rgbB, 1.0);\n\t\t\tif(u_igamma != 1.0)\n\t\t\t\tcolor.xyz = pow( color.xyz, vec3(u_igamma) );\n\t\t\treturn color;\n\t\t}\n\t\t\n\t\tvoid main() {\n\t\t   gl_FragColor = applyFXAA( u_texture, v_coord * uViewportSize) ;\n\t\t}\n\t\t",p.gamma_pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform float u_igamma;\n\t\tvoid main() {\n\t\t\tvec4 color = texture2D( u_texture, v_coord);\n\t\t\tcolor.xyz = pow(color.xyz, vec3(u_igamma) );\n\t\t   gl_FragColor = color;\n\t\t}\n\t\t",e.registerNodeType("texture/toviewport",p),h.title="Copy",h.desc="Copy Texture",h.widgets_info={size:{widget:"combo",values:[0,32,64,128,256,512,1024,2048]},precision:{widget:"combo",values:i.MODE_VALUES}},h.prototype.onExecute=function(){var t=this.getInputData(0);if((t||this._temp_texture)&&this.isOutputConnected(0)){if(t){var e=t.width,n=t.height;0!=this.properties.size&&(e=this.properties.size,n=this.properties.size);var r=this._temp_texture,o=t.type;if(this.properties.precision===i.LOW?o=gl.UNSIGNED_BYTE:this.properties.precision===i.HIGH&&(o=gl.HIGH_PRECISION_FORMAT),!r||r.width!=e||r.height!=n||r.type!=o){var s=gl.LINEAR;this.properties.generate_mipmaps&&isPowerOfTwo(e)&&isPowerOfTwo(n)&&(s=gl.LINEAR_MIPMAP_LINEAR),this._temp_texture=new GL.Texture(e,n,{type:o,format:gl.RGBA,minFilter:s,magFilter:gl.LINEAR})}t.copyTo(this._temp_texture),this.properties.generate_mipmaps&&(this._temp_texture.bind(0),gl.generateMipmap(this._temp_texture.texture_type),this._temp_texture.unbind(0))}this.setOutputData(0,this._temp_texture)}},e.registerNodeType("texture/copy",h),c.title="Downsample",c.desc="Downsample Texture",c.widgets_info={iterations:{type:"number",step:1,precision:0,min:0},precision:{widget:"combo",values:i.MODE_VALUES}},c.prototype.onExecute=function(){var t=this.getInputData(0);if((t||this._temp_texture)&&this.isOutputConnected(0)&&t&&t.texture_type===GL.TEXTURE_2D)if(this.properties.iterations<1)this.setOutputData(0,t);else{var e=c._shader;e||(c._shader=e=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,c.pixel_shader));var n=0|t.width,r=0|t.height,o=t.type;this.properties.precision===i.LOW?o=gl.UNSIGNED_BYTE:this.properties.precision===i.HIGH&&(o=gl.HIGH_PRECISION_FORMAT);var s=this.properties.iterations||1,a=t,u=null,l=[],p={type:o,format:t.format},h=vec2.create(),d={u_offset:h};this._texture&&GL.Texture.releaseTemporary(this._texture);for(var f=0;f<s&&(h[0]=1/n,h[1]=1/r,n=n>>1||0,r=r>>1||0,u=GL.Texture.getTemporary(n,r,p),l.push(u),a.setParameter(GL.TEXTURE_MAG_FILTER,GL.NEAREST),a.copyTo(u,e,d),1!=n||1!=r);++f)a=u;for(this._texture=l.pop(),f=0;f<l.length;++f)GL.Texture.releaseTemporary(l[f]);this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},c.pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tuniform sampler2D u_texture;\n\t\tuniform vec2 u_offset;\n\t\tvarying vec2 v_coord;\n\t\t\n\t\tvoid main() {\n\t\t\tvec4 color = texture2D(u_texture, v_coord );\n\t\t\tcolor += texture2D(u_texture, v_coord + vec2( u_offset.x, 0.0 ) );\n\t\t\tcolor += texture2D(u_texture, v_coord + vec2( 0.0, u_offset.y ) );\n\t\t\tcolor += texture2D(u_texture, v_coord + vec2( u_offset.x, u_offset.y ) );\n\t\t   gl_FragColor = color * 0.25;\n\t\t}\n\t\t",e.registerNodeType("texture/downsample",c),d.title="Resize",d.desc="Resize Texture",d.widgets_info={iterations:{type:"number",step:1,precision:0,min:0},precision:{widget:"combo",values:i.MODE_VALUES}},d.prototype.onExecute=function(){var t=this.getInputData(0);if((t||this._temp_texture)&&this.isOutputConnected(0)&&t&&t.texture_type===GL.TEXTURE_2D){var e=0|this.properties.size[0],n=0|this.properties.size[1];0==e&&(e=t.width),0==n&&(n=t.height);var r=t.type;this.properties.precision===i.LOW?r=gl.UNSIGNED_BYTE:this.properties.precision===i.HIGH&&(r=gl.HIGH_PRECISION_FORMAT),this._texture&&this._texture.width==e&&this._texture.height==n&&this._texture.type==r||(this._texture=new GL.Texture(e,n,{type:r})),t.copyTo(this._texture),this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},e.registerNodeType("texture/resize",d),f.title="Average",f.desc="Compute a partial average (32 random samples) of a texture and stores it as a 1x1 pixel texture.\n If high_quality is true, then it generates the mipmaps first and reads from the lower one.",f.prototype.onExecute=function(){this.properties.use_previous_frame||this.updateAverage();var t=this._luminance;this.setOutputData(0,this._temp_texture),this.setOutputData(1,t),this.setOutputData(2,(t[0]+t[1]+t[2])/3)},f.prototype.onPreRenderExecute=function(){this.updateAverage()},f.prototype.updateAverage=function(){var t=this.getInputData(0);if(t&&(this.isOutputConnected(0)||this.isOutputConnected(1)||this.isOutputConnected(2))){if(!f._shader){f._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,f.pixel_shader);for(var e=new Float32Array(16),n=0;n<e.length;++n)e[n]=Math.random();f._shader.uniforms({u_samples_a:e.subarray(0,16),u_samples_b:e.subarray(16,32)})}var i=this._temp_texture,r=gl.UNSIGNED_BYTE;t.type!=r&&(r=gl.FLOAT),i&&i.type==r||(this._temp_texture=new GL.Texture(1,1,{type:r,format:gl.RGBA,filter:gl.NEAREST})),this._uniforms.u_mipmap_offset=0,this.properties.high_quality&&(this._temp_pot2_texture&&this._temp_pot2_texture.type==r||(this._temp_pot2_texture=new GL.Texture(512,512,{type:r,format:gl.RGBA,minFilter:gl.LINEAR_MIPMAP_LINEAR,magFilter:gl.LINEAR})),t.copyTo(this._temp_pot2_texture),(t=this._temp_pot2_texture).bind(0),gl.generateMipmap(GL.TEXTURE_2D),this._uniforms.u_mipmap_offset=9);var o=f._shader,s=this._uniforms;if(s.u_mipmap_offset=this.properties.mipmap_offset,gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo((function(){t.toViewport(o,s)})),this.isOutputConnected(1)||this.isOutputConnected(2)){var a=this._temp_texture.getPixels();if(a){var u=this._luminance;r=this._temp_texture.type,u.set(a),r==gl.UNSIGNED_BYTE?vec4.scale(u,u,1/255):r==GL.HALF_FLOAT||GL.HALF_FLOAT_OES}}}},f.pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tuniform mat4 u_samples_a;\n\t\tuniform mat4 u_samples_b;\n\t\tuniform sampler2D u_texture;\n\t\tuniform float u_mipmap_offset;\n\t\tvarying vec2 v_coord;\n\t\t\n\t\tvoid main() {\n\t\t\tvec4 color = vec4(0.0);\n\t\t\t//random average\n\t\t\tfor(int i = 0; i < 4; ++i)\n\t\t\t\tfor(int j = 0; j < 4; ++j)\n\t\t\t\t{\n\t\t\t\t\tcolor += texture2D(u_texture, vec2( u_samples_a[i][j], u_samples_b[i][j] ), u_mipmap_offset );\n\t\t\t\t\tcolor += texture2D(u_texture, vec2( 1.0 - u_samples_a[i][j], 1.0 - u_samples_b[i][j] ), u_mipmap_offset );\n\t\t\t\t}\n\t\t   gl_FragColor = color * 0.03125;\n\t\t}\n\t\t",e.registerNodeType("texture/average",f),g.widgets_info={mode:{widget:"combo",values:["min","max","avg"]}},g.title="MinMax",g.desc="Compute the scene min max",g.prototype.onExecute=function(){this.properties.use_previous_frame||this.update(),this.setOutputData(0,this._temp_texture),this.setOutputData(1,this._luminance)},g.prototype.onPreRenderExecute=function(){this.update()},g.prototype.update=function(){if((i=this.getInputData(0))&&(this.isOutputConnected(0)||this.isOutputConnected(1))){g._shader||(g._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,g.pixel_shader)),this._temp_texture;var t=gl.UNSIGNED_BYTE;i.type!=t&&(t=gl.FLOAT);var e=512;if(!this._textures_chain.length||this._textures_chain[0].type!=t)for(;n&&(this._textures_chain[n]=new GL.Texture(e,e,{type:t,format:gl.RGBA,filter:gl.NEAREST}),n++,1!=(e>>=2)););i.copyTo(this._textures_chain[0]),this._textures_chain[0];for(var n=1;n<=this._textures_chain.length;++n){var i;i=this._textures_chain[n]}var r=g._shader,o=this._uniforms;o.u_mipmap_offset=this.properties.mipmap_offset,gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo((function(){i.toViewport(r,o)}))}},g.pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tuniform mat4 u_samples_a;\n\t\tuniform mat4 u_samples_b;\n\t\tuniform sampler2D u_texture;\n\t\tuniform float u_mipmap_offset;\n\t\tvarying vec2 v_coord;\n\t\t\n\t\tvoid main() {\n\t\t\tvec4 color = vec4(0.0);\n\t\t\t//random average\n\t\t\tfor(int i = 0; i < 4; ++i)\n\t\t\t\tfor(int j = 0; j < 4; ++j)\n\t\t\t\t{\n\t\t\t\t\tcolor += texture2D(u_texture, vec2( u_samples_a[i][j], u_samples_b[i][j] ), u_mipmap_offset );\n\t\t\t\t\tcolor += texture2D(u_texture, vec2( 1.0 - u_samples_a[i][j], 1.0 - u_samples_b[i][j] ), u_mipmap_offset );\n\t\t\t\t}\n\t\t   gl_FragColor = color * 0.03125;\n\t\t}\n\t\t",_.title="Smooth",_.desc="Smooth texture over time",_.prototype.onExecute=function(){var t=this.getInputData(0);if(t&&this.isOutputConnected(0)){_._shader||(_._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,_.pixel_shader));var e=this._temp_texture;if(!e||e.type!=t.type||e.width!=t.width||e.height!=t.height){var n={type:t.type,format:gl.RGBA,filter:gl.NEAREST};this._temp_texture=new GL.Texture(t.width,t.height,n),this._temp_texture2=new GL.Texture(t.width,t.height,n),t.copyTo(this._temp_texture2)}var i=this._temp_texture,r=this._temp_texture2,o=_._shader,s=this._uniforms;s.u_factor=1-this.getInputOrProperty("factor"),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),i.drawTo((function(){r.bind(1),t.toViewport(o,s)})),this.setOutputData(0,i),this._temp_texture=r,this._temp_texture2=i}},_.pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tuniform sampler2D u_texture;\n\t\tuniform sampler2D u_textureB;\n\t\tuniform float u_factor;\n\t\tvarying vec2 v_coord;\n\t\t\n\t\tvoid main() {\n\t\t\tgl_FragColor = mix( texture2D( u_texture, v_coord ), texture2D( u_textureB, v_coord ), u_factor );\n\t\t}\n\t\t",e.registerNodeType("texture/temporal_smooth",_),v.title="Lineal Avg Smooth",v.desc="Smooth texture linearly over time",v["@samples"]={type:"number",min:1,max:64,step:1,precision:1},v.prototype.getPreviewTexture=function(){return this._temp_texture2},v.prototype.onExecute=function(){var t=this.getInputData(0);if(t&&this.isOutputConnected(0)){v._shader||(v._shader_copy=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,v.pixel_shader_copy),v._shader_avg=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,v.pixel_shader_avg));var e=clamp(this.properties.samples,0,64),n=this.frame,i=this.properties.frames_interval;if(0==i||n%i==0){var r=this._temp_texture;if(!r||r.type!=t.type||r.width!=e){var o={type:t.type,format:gl.RGBA,filter:gl.NEAREST};this._temp_texture=new GL.Texture(e,1,o),this._temp_texture2=new GL.Texture(e,1,o),this._temp_texture_out=new GL.Texture(1,1,o)}var s=this._temp_texture,a=this._temp_texture2,u=v._shader_copy,l=v._shader_avg,p=this._uniforms;p.u_samples=e,p.u_isamples=1/e,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),s.drawTo((function(){a.bind(1),t.toViewport(u,p)})),this._temp_texture_out.drawTo((function(){s.toViewport(l,p)})),this.setOutputData(0,this._temp_texture_out),this._temp_texture=a,this._temp_texture2=s}else this.setOutputData(0,this._temp_texture_out);this.setOutputData(1,this._temp_texture2),this.frame++}},v.pixel_shader_copy="precision highp float;\n\t\tprecision highp float;\n\t\tuniform sampler2D u_texture;\n\t\tuniform sampler2D u_textureB;\n\t\tuniform float u_isamples;\n\t\tvarying vec2 v_coord;\n\t\t\n\t\tvoid main() {\n\t\t\tif( v_coord.x <= u_isamples )\n\t\t\t\tgl_FragColor = texture2D( u_texture, vec2(0.5) );\n\t\t\telse\n\t\t\t\tgl_FragColor = texture2D( u_textureB, v_coord - vec2(u_isamples,0.0) );\n\t\t}\n\t\t",v.pixel_shader_avg="precision highp float;\n\t\tprecision highp float;\n\t\tuniform sampler2D u_texture;\n\t\tuniform int u_samples;\n\t\tuniform float u_isamples;\n\t\tvarying vec2 v_coord;\n\t\t\n\t\tvoid main() {\n\t\t\tvec4 color = vec4(0.0);\n\t\t\tfor(int i = 0; i < 64; ++i)\n\t\t\t{\n\t\t\t\tcolor += texture2D( u_texture, vec2( float(i)*u_isamples,0.0) );\n\t\t\t\tif(i == (u_samples - 1))\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tgl_FragColor = color * u_isamples;\n\t\t}\n\t\t",e.registerNodeType("texture/linear_avg_smooth",v),m.title="Image to Texture",m.desc="Uploads an image to the GPU",m.prototype.onExecute=function(){var t=this.getInputData(0);if(t){var e=t.videoWidth||t.width,n=t.videoHeight||t.height;if(t.gltexture)this.setOutputData(0,t.gltexture);else{var i=this._temp_texture;i&&i.width==e&&i.height==n||(this._temp_texture=new GL.Texture(e,n,{format:gl.RGBA,filter:gl.LINEAR}));try{this._temp_texture.uploadImage(t)}catch(t){return void console.error("image comes from an unsafe location, cannot be uploaded to webgl: "+t)}this.setOutputData(0,this._temp_texture)}}},e.registerNodeType("texture/imageToTexture",m),y.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:i.MODE_VALUES}},y.title="LUT",y.desc="Apply LUT to Texture",y.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=this.getInputData(0);if(this.properties.precision!==i.PASS_THROUGH&&!1!==this.properties.enabled){if(t){var e=this.getInputData(1);if(e||(e=i.getTexture(this.properties.texture)),e){e.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var n=this.properties.intensity;this.isInputConnected(2)&&(this.properties.intensity=n=this.getInputData(2)),this._tex=i.getTargetTexture(t,this._tex,this.properties.precision),this._tex.drawTo((function(){e.bind(1),t.toViewport(y._shader,{u_texture:0,u_textureB:1,u_amount:n})})),this.setOutputData(0,this._tex)}else this.setOutputData(0,t)}}else this.setOutputData(0,t)}},y.pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform sampler2D u_textureB;\n\t\tuniform float u_amount;\n\t\t\n\t\tvoid main() {\n\t\t\t lowp vec4 textureColor = clamp( texture2D(u_texture, v_coord), vec4(0.0), vec4(1.0) );\n\t\t\t mediump float blueColor = textureColor.b * 63.0;\n\t\t\t mediump vec2 quad1;\n\t\t\t quad1.y = floor(floor(blueColor) / 8.0);\n\t\t\t quad1.x = floor(blueColor) - (quad1.y * 8.0);\n\t\t\t mediump vec2 quad2;\n\t\t\t quad2.y = floor(ceil(blueColor) / 8.0);\n\t\t\t quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\t\t\t highp vec2 texPos1;\n\t\t\t texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n\t\t\t texPos1.y = 1.0 - ((quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));\n\t\t\t highp vec2 texPos2;\n\t\t\t texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n\t\t\t texPos2.y = 1.0 - ((quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));\n\t\t\t lowp vec4 newColor1 = texture2D(u_textureB, texPos1);\n\t\t\t lowp vec4 newColor2 = texture2D(u_textureB, texPos2);\n\t\t\t lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n\t\t\t gl_FragColor = vec4( mix( textureColor.rgb, newColor.rgb, u_amount), textureColor.w);\n\t\t}\n\t\t",e.registerNodeType("texture/LUT",y),b.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:i.MODE_VALUES}},b.title="Encode",b.desc="Apply a texture atlas to encode a texture",b.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=this.getInputData(0);if(this.properties.precision!==i.PASS_THROUGH&&!1!==this.properties.enabled){if(t){var e=this.getInputData(1);if(e||(e=i.getTexture(this.properties.texture)),e){e.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var n=this._uniforms;n.u_row_simbols=Math.floor(this.properties.num_row_symbols),n.u_symbol_size=this.properties.symbol_size,n.u_brightness=this.properties.brightness,n.u_invert=this.properties.invert?1:0,n.u_colorize=this.properties.colorize?1:0,this._tex=i.getTargetTexture(t,this._tex,this.properties.precision),n.u_res[0]=this._tex.width,n.u_res[1]=this._tex.height,this._tex.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),this._tex.drawTo((function(){e.bind(1),t.toViewport(b._shader,n)})),this.properties.generate_mipmaps&&(this._tex.bind(0),gl.generateMipmap(this._tex.texture_type),this._tex.unbind(0)),this.setOutputData(0,this._tex)}else this.setOutputData(0,t)}}else this.setOutputData(0,t)}},b.pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform sampler2D u_textureB;\n\t\tuniform float u_row_simbols;\n\t\tuniform float u_symbol_size;\n\t\tuniform float u_brightness;\n\t\tuniform float u_invert;\n\t\tuniform float u_colorize;\n\t\tuniform vec2 u_res;\n\t\t\n\t\tvoid main() {\n\t\t\tvec2 total_symbols = u_res / u_symbol_size;\n\t\t\tvec2 uv = floor(v_coord * total_symbols) / total_symbols; //pixelate \n\t\t\tvec2 local_uv = mod(v_coord * u_res, u_symbol_size) / u_symbol_size;\n\t\t\tlowp vec4 textureColor = texture2D(u_texture, uv );\n\t\t\tfloat lum = clamp(u_brightness * (textureColor.x + textureColor.y + textureColor.z)/3.0,0.0,1.0);\n\t\t\tif( u_invert == 1.0 ) lum = 1.0 - lum;\n\t\t\tfloat index = floor( lum * (u_row_simbols * u_row_simbols - 1.0));\n\t\t\tfloat col = mod( index, u_row_simbols );\n\t\t\tfloat row = u_row_simbols - floor( index / u_row_simbols ) - 1.0;\n\t\t\tvec2 simbol_uv = ( vec2( col, row ) + local_uv ) / u_row_simbols;\n\t\t\tvec4 color = texture2D( u_textureB, simbol_uv );\n\t\t\tif(u_colorize == 1.0)\n\t\t\t\tcolor *= textureColor;\n\t\t\tgl_FragColor = color;\n\t\t}\n\t\t",e.registerNodeType("texture/encode",b),x.title="Texture to Channels",x.desc="Split texture channels",x.prototype.onExecute=function(){var t=this.getInputData(0);if(t){this._channels||(this._channels=Array(4));for(var e=gl.RGB,n=0,i=0;i<4;i++)this.isOutputConnected(i)?(this._channels[i]&&this._channels[i].width==t.width&&this._channels[i].height==t.height&&this._channels[i].type==t.type&&this._channels[i].format==e||(this._channels[i]=new GL.Texture(t.width,t.height,{type:t.type,format:e,filter:gl.LINEAR})),n++):this._channels[i]=null;if(n){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var r=Mesh.getScreenQuad(),o=x._shader,s=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];for(i=0;i<4;i++)this._channels[i]&&(this._channels[i].drawTo((function(){t.bind(0),o.uniforms({u_texture:0,u_mask:s[i]}).draw(r)})),this.setOutputData(i,this._channels[i]))}}},x.pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform vec4 u_mask;\n\t\t\n\t\tvoid main() {\n\t\t   gl_FragColor = vec4( vec3( length( texture2D(u_texture, v_coord) * u_mask )), 1.0 );\n\t\t}\n\t\t",e.registerNodeType("texture/textureChannels",x),A.title="Channels to Texture",A.desc="Split texture channels",A.widgets_info={precision:{widget:"combo",values:i.MODE_VALUES}},A.prototype.onExecute=function(){var t=i.getWhiteTexture(),e=this.getInputData(0)||t,n=this.getInputData(1)||t,r=this.getInputData(2)||t,o=this.getInputData(3)||t;gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var s=Mesh.getScreenQuad();A._shader||(A._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,A.pixel_shader));var a=A._shader,u=Math.max(e.width,n.width,r.width,o.width),l=Math.max(e.height,n.height,r.height,o.height),p=this.properties.precision==i.HIGH?i.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;this._texture&&this._texture.width==u&&this._texture.height==l&&this._texture.type==p||(this._texture=new GL.Texture(u,l,{type:p,format:gl.RGBA,filter:gl.LINEAR}));var h=this._color;h[0]=this.properties.R,h[1]=this.properties.G,h[2]=this.properties.B,h[3]=this.properties.A;var c=this._uniforms;this._texture.drawTo((function(){e.bind(0),n.bind(1),r.bind(2),o.bind(3),a.uniforms(c).draw(s)})),this.setOutputData(0,this._texture)},A.pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_textureR;\n\t\tuniform sampler2D u_textureG;\n\t\tuniform sampler2D u_textureB;\n\t\tuniform sampler2D u_textureA;\n\t\tuniform vec4 u_color;\n\t\t\n\t\tvoid main() {\n\t\t   gl_FragColor = u_color * vec4( \t\t\t\t\ttexture2D(u_textureR, v_coord).r,\t\t\t\t\ttexture2D(u_textureG, v_coord).r,\t\t\t\t\ttexture2D(u_textureB, v_coord).r,\t\t\t\t\ttexture2D(u_textureA, v_coord).r);\n\t\t}\n\t\t",e.registerNodeType("texture/channelsTexture",A),w.title="Color",w.desc="Generates a 1x1 texture with a constant color",w.widgets_info={precision:{widget:"combo",values:i.MODE_VALUES}},w.prototype.onDrawBackground=function(t){var e=this.properties.color;t.fillStyle="rgb("+Math.floor(255*clamp(e[0],0,1))+","+Math.floor(255*clamp(e[1],0,1))+","+Math.floor(255*clamp(e[2],0,1))+")",this.flags.collapsed?this.boxcolor=t.fillStyle:t.fillRect(0,0,this.size[0],this.size[1])},w.prototype.onExecute=function(){var t=this.properties.precision==i.HIGH?i.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;this._tex&&this._tex.type==t||(this._tex=new GL.Texture(1,1,{format:gl.RGBA,type:t,minFilter:gl.NEAREST}));var e=this.properties.color;if(this.inputs)for(var n=0;n<this.inputs.length;n++){var r=this.inputs[n],o=this.getInputData(n);if(void 0!==o)switch(r.name){case"RGB":case"RGBA":e.set(o);break;case"R":e[0]=o;break;case"G":e[1]=o;break;case"B":e[2]=o;break;case"A":e[3]=o}}vec4.sqrDist(this._tex_color,e)>.001&&(this._tex_color.set(e),this._tex.fill(e)),this.setOutputData(0,this._tex)},w.prototype.onGetInputs=function(){return[["RGB","vec3"],["RGBA","vec4"],["R","number"],["G","number"],["B","number"],["A","number"]]},e.registerNodeType("texture/color",w),E.title="Gradient",E.desc="Generates a gradient",E["@A"]={type:"color"},E["@B"]={type:"color"},E["@texture_size"]={type:"enum",values:[32,64,128,256,512]},E.prototype.onExecute=function(){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var t=GL.Mesh.getScreenQuad(),e=E._shader,n=this.getInputData(0);n||(n=this.properties.A);var i=this.getInputData(1);i||(i=this.properties.B);for(var r=2;r<this.inputs.length;r++){var o=this.inputs[r],s=this.getInputData(r);void 0!==s&&(this.properties[o.name]=s)}var a=this._uniforms;this._uniforms.u_angle=this.properties.angle*DEG2RAD,this._uniforms.u_scale=this.properties.scale,vec3.copy(a.u_colorA,n),vec3.copy(a.u_colorB,i);var u=parseInt(this.properties.texture_size);this._tex&&this._tex.width==u||(this._tex=new GL.Texture(u,u,{format:gl.RGB,filter:gl.LINEAR})),this._tex.drawTo((function(){e.uniforms(a).draw(t)})),this.setOutputData(0,this._tex)},E.prototype.onGetInputs=function(){return[["angle","number"],["scale","number"]]},E.pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform float u_angle;\n\t\tuniform float u_scale;\n\t\tuniform vec3 u_colorA;\n\t\tuniform vec3 u_colorB;\n\t\t\n\t\tvec2 rotate(vec2 v, float angle)\n\t\t{\n\t\t\tvec2 result;\n\t\t\tfloat _cos = cos(angle);\n\t\t\tfloat _sin = sin(angle);\n\t\t\tresult.x = v.x * _cos - v.y * _sin;\n\t\t\tresult.y = v.x * _sin + v.y * _cos;\n\t\t\treturn result;\n\t\t}\n\t\tvoid main() {\n\t\t\tfloat f = (rotate(u_scale * (v_coord - vec2(0.5)), u_angle) + vec2(0.5)).x;\n\t\t\tvec3 color = mix(u_colorA,u_colorB,clamp(f,0.0,1.0));\n\t\t   gl_FragColor = vec4(color,1.0);\n\t\t}\n\t\t",e.registerNodeType("texture/gradient",E),C.title="Mix",C.desc="Generates a texture mixing two textures",C.widgets_info={precision:{widget:"combo",values:i.MODE_VALUES}},C.prototype.onExecute=function(){var t=this.getInputData(0);if(this.isOutputConnected(0))if(this.properties.precision!==i.PASS_THROUGH){var e=this.getInputData(1);if(t&&e){var n=this.getInputData(2),r=this.getInputData(3);this._tex=i.getTargetTexture(this.properties.size_from_biggest&&e.width>t.width?e:t,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var o=Mesh.getScreenQuad(),s=null,a=this._uniforms;if(n)(s=C._shader_tex)||(s=C._shader_tex=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,C.pixel_shader,{MIX_TEX:""}));else{(s=C._shader_factor)||(s=C._shader_factor=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,C.pixel_shader));var u=null==r?this.properties.factor:r;a.u_mix.set([u,u,u,u])}var l=this.properties.invert;this._tex.drawTo((function(){t.bind(l?1:0),e.bind(l?0:1),n&&n.bind(2),s.uniforms(a).draw(o)})),this.setOutputData(0,this._tex)}}else this.setOutputData(0,t)},C.prototype.onGetInputs=function(){return[["factor","number"]]},C.pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_textureA;\n\t\tuniform sampler2D u_textureB;\n\t\t#ifdef MIX_TEX\n\t\t\tuniform sampler2D u_textureMix;\n\t\t#else\n\t\t\tuniform vec4 u_mix;\n\t\t#endif\n\t\t\n\t\tvoid main() {\n\t\t\t#ifdef MIX_TEX\n\t\t\t   vec4 f = texture2D(u_textureMix, v_coord);\n\t\t\t#else\n\t\t\t   vec4 f = u_mix;\n\t\t\t#endif\n\t\t   gl_FragColor = mix( texture2D(u_textureA, v_coord), texture2D(u_textureB, v_coord), f );\n\t\t}\n\t\t",e.registerNodeType("texture/mix",C),T.title="Edges",T.desc="Detects edges",T.widgets_info={precision:{widget:"combo",values:i.MODE_VALUES}},T.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=this.getInputData(0);if(this.properties.precision!==i.PASS_THROUGH){if(t){this._tex=i.getTargetTexture(t,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var e=Mesh.getScreenQuad(),n=T._shader,r=this.properties.invert,o=this.properties.factor,s=this.properties.threshold?1:0;this._tex.drawTo((function(){t.bind(0),n.uniforms({u_texture:0,u_isize:[1/t.width,1/t.height],u_factor:o,u_threshold:s,u_invert:r?1:0}).draw(e)})),this.setOutputData(0,this._tex)}}else this.setOutputData(0,t)}},T.pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform vec2 u_isize;\n\t\tuniform int u_invert;\n\t\tuniform float u_factor;\n\t\tuniform float u_threshold;\n\t\t\n\t\tvoid main() {\n\t\t\tvec4 center = texture2D(u_texture, v_coord);\n\t\t\tvec4 up = texture2D(u_texture, v_coord + u_isize * vec2(0.0,1.0) );\n\t\t\tvec4 down = texture2D(u_texture, v_coord + u_isize * vec2(0.0,-1.0) );\n\t\t\tvec4 left = texture2D(u_texture, v_coord + u_isize * vec2(1.0,0.0) );\n\t\t\tvec4 right = texture2D(u_texture, v_coord + u_isize * vec2(-1.0,0.0) );\n\t\t\tvec4 diff = abs(center - up) + abs(center - down) + abs(center - left) + abs(center - right);\n\t\t\tdiff *= u_factor;\n\t\t\tif(u_invert == 1)\n\t\t\t\tdiff.xyz = vec3(1.0) - diff.xyz;\n\t\t\tif( u_threshold == 0.0 )\n\t\t\t\tgl_FragColor = vec4( diff.xyz, center.a );\n\t\t\telse\n\t\t\t\tgl_FragColor = vec4( diff.x > 0.5 ? 1.0 : 0.0, diff.y > 0.5 ? 1.0 : 0.0, diff.z > 0.5 ? 1.0 : 0.0, center.a );\n\t\t}\n\t\t",e.registerNodeType("texture/edges",T),O.title="Depth Range",O.desc="Generates a texture with a depth range",O.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=this.getInputData(0);if(t){var e=gl.UNSIGNED_BYTE;this.properties.high_precision&&(e=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),this._temp_texture&&this._temp_texture.type==e&&this._temp_texture.width==t.width&&this._temp_texture.height==t.height||(this._temp_texture=new GL.Texture(t.width,t.height,{type:e,format:gl.RGBA,filter:gl.LINEAR}));var n=this._uniforms,i=this.properties.distance;this.isInputConnected(1)&&(i=this.getInputData(1),this.properties.distance=i);var r=this.properties.range;this.isInputConnected(2)&&(r=this.getInputData(2),this.properties.range=r),n.u_distance=i,n.u_range=r,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var o=Mesh.getScreenQuad();O._shader||(O._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,O.pixel_shader),O._shader_onlydepth=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,O.pixel_shader,{ONLY_DEPTH:""}));var s,a=this.properties.only_depth?O._shader_onlydepth:O._shader;s=t.near_far_planes?t.near_far_planes:window.LS&&LS.Renderer._main_camera?LS.Renderer._main_camera._uniforms.u_camera_planes:[.1,1e3],n.u_camera_planes=s,this._temp_texture.drawTo((function(){t.bind(0),a.uniforms(n).draw(o)})),this._temp_texture.near_far_planes=s,this.setOutputData(0,this._temp_texture)}}},O.pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform vec2 u_camera_planes;\n\t\tuniform float u_distance;\n\t\tuniform float u_range;\n\t\t\n\t\tfloat LinearDepth()\n\t\t{\n\t\t\tfloat zNear = u_camera_planes.x;\n\t\t\tfloat zFar = u_camera_planes.y;\n\t\t\tfloat depth = texture2D(u_texture, v_coord).x;\n\t\t\tdepth = depth * 2.0 - 1.0;\n\t\t\treturn zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));\n\t\t}\n\t\t\n\t\tvoid main() {\n\t\t\tfloat depth = LinearDepth();\n\t\t\t#ifdef ONLY_DEPTH\n\t\t\t   gl_FragColor = vec4(depth);\n\t\t\t#else\n\t\t\t\tfloat diff = abs(depth * u_camera_planes.y - u_distance);\n\t\t\t\tfloat dof = 1.0;\n\t\t\t\tif(diff <= u_range)\n\t\t\t\t\tdof = diff / u_range;\n\t\t\t   gl_FragColor = vec4(dof);\n\t\t\t#endif\n\t\t}\n\t\t",e.registerNodeType("texture/depth_range",O),S.widgets_info={precision:{widget:"combo",values:i.MODE_VALUES}},S.title="Linear Depth",S.desc="Creates a color texture with linear depth",S.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=this.getInputData(0);if(t&&(t.format==gl.DEPTH_COMPONENT||t.format==gl.DEPTH_STENCIL)){var e=this.properties.precision==i.HIGH?gl.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;this._temp_texture&&this._temp_texture.type==e&&this._temp_texture.width==t.width&&this._temp_texture.height==t.height||(this._temp_texture=new GL.Texture(t.width,t.height,{type:e,format:gl.RGB,filter:gl.LINEAR}));var n=this._uniforms;n.u_invert=this.properties.invert?1:0,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var r=Mesh.getScreenQuad();S._shader||(S._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,S.pixel_shader));var o,s=S._shader;o=t.near_far_planes?t.near_far_planes:window.LS&&LS.Renderer._main_camera?LS.Renderer._main_camera._uniforms.u_camera_planes:[.1,1e3],n.u_camera_planes=o,n.u_ires.set([0,0]),this._temp_texture.drawTo((function(){t.bind(0),s.uniforms(n).draw(r)})),this._temp_texture.near_far_planes=o,this.setOutputData(0,this._temp_texture)}}},S.pixel_shader="precision highp float;\n\t\tprecision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform vec2 u_camera_planes;\n\t\tuniform int u_invert;\n\t\tuniform vec2 u_ires;\n\t\t\n\t\tvoid main() {\n\t\t\tfloat zNear = u_camera_planes.x;\n\t\t\tfloat zFar = u_camera_planes.y;\n\t\t\tfloat depth = texture2D(u_texture, v_coord + u_ires*0.5).x * 2.0 - 1.0;\n\t\t\tfloat f = zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));\n\t\t\tif( u_invert == 1 )\n\t\t\t\tf = 1.0 - f;\n\t\t\tgl_FragColor = vec4(vec3(f),1.0);\n\t\t}\n\t\t",e.registerNodeType("texture/linear_depth",S),I.title="Blur",I.desc="Blur a texture",I.widgets_info={precision:{widget:"combo",values:i.MODE_VALUES}},I.max_iterations=20,I.prototype.onExecute=function(){var t=this.getInputData(0);if(t&&this.isOutputConnected(0)){var n=this._final_texture;n&&n.width==t.width&&n.height==t.height&&n.type==t.type||(n=this._final_texture=new GL.Texture(t.width,t.height,{type:t.type,format:gl.RGBA,filter:gl.LINEAR}));var i=this.properties.iterations;if(this.isInputConnected(1)&&(i=this.getInputData(1),this.properties.iterations=i),0!=(i=Math.min(Math.floor(i),I.max_iterations))){var r=this.properties.intensity;this.isInputConnected(2)&&(r=this.getInputData(2),this.properties.intensity=r);var o=e.camera_aspect;o||void 0===window.gl||(o=gl.canvas.height/gl.canvas.width),o||(o=1),o=this.properties.preserve_aspect?o:1;var s=this.properties.scale||[1,1];t.applyBlur(o*s[0],s[1],r,n);for(var a=1;a<i;++a)n.applyBlur(o*s[0]*(a+1),s[1]*(a+1),r);this.setOutputData(0,n)}else this.setOutputData(0,t)}},e.registerNodeType("texture/blur",I),L.prototype.applyFX=function(t,e,n,i){var r=t.width,o=t.height,s={format:t.format,type:t.type,minFilter:GL.LINEAR,magFilter:GL.LINEAR,wrap:gl.CLAMP_TO_EDGE},a=this._uniforms,u=this._textures;(c=L._cut_shader)||(c=L._cut_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,L.cut_pixel_shader)),gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),a.u_threshold=this.threshold;var l=u[0]=GL.Texture.getTemporary(r,o,s);t.blit(l,c.uniforms(a));var p=l,h=this.iterations;h=0|clamp(h,1,16);var c,d=a.u_texel_size,f=this.intensity;a.u_intensity=1,a.u_delta=this.scale,(c=L._shader)||(c=L._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,L.scale_pixel_shader));for(var g=1;g<h&&((0|o)>1&&(o>>=1),!((r>>=1)<2));g++)l=u[g]=GL.Texture.getTemporary(r,o,s),d[0]=1/p.width,d[1]=1/p.height,p.blit(l,c.uniforms(a)),p=l;for(i&&(d[0]=1/p.width,d[1]=1/p.height,a.u_intensity=f,a.u_delta=1,p.blit(i,c.uniforms(a))),gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),a.u_intensity=this.persistence,a.u_delta=.5,g-=2;g>=0;g--)l=u[g],u[g]=null,d[0]=1/p.width,d[1]=1/p.height,p.blit(l,c.uniforms(a)),GL.Texture.releaseTemporary(p),p=l;if(gl.disable(gl.BLEND),n&&p.blit(n),e){var _=e,v=this.dirt_texture,m=this.dirt_factor;a.u_intensity=f,(c=v?L._dirt_final_shader:L._final_shader)||(c=v?L._dirt_final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,L.final_pixel_shader,{USE_DIRT:""}):L._final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,L.final_pixel_shader)),_.drawTo((function(){t.bind(0),p.bind(1),v&&(c.setUniform("u_dirt_factor",m),c.setUniform("u_dirt_texture",v.bind(2))),c.toViewport(a)}))}GL.Texture.releaseTemporary(p)},L.cut_pixel_shader="precision highp float;\n\tvarying vec2 v_coord;\n\tuniform sampler2D u_texture;\n\tuniform float u_threshold;\n\tvoid main() {\n\t\tgl_FragColor = max( texture2D( u_texture, v_coord ) - vec4( u_threshold ), vec4(0.0) );\n\t}",L.scale_pixel_shader="precision highp float;\n\tvarying vec2 v_coord;\n\tuniform sampler2D u_texture;\n\tuniform vec2 u_texel_size;\n\tuniform float u_delta;\n\tuniform float u_intensity;\n\t\n\tvec4 sampleBox(vec2 uv) {\n\t\tvec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;\n\t\tvec4 s = texture2D( u_texture, uv + o.xy ) + texture2D( u_texture, uv + o.zy) + texture2D( u_texture, uv + o.xw) + texture2D( u_texture, uv + o.zw);\n\t\treturn s * 0.25;\n\t}\n\tvoid main() {\n\t\tgl_FragColor = u_intensity * sampleBox( v_coord );\n\t}",L.final_pixel_shader="precision highp float;\n\tvarying vec2 v_coord;\n\tuniform sampler2D u_texture;\n\tuniform sampler2D u_glow_texture;\n\t#ifdef USE_DIRT\n\t\tuniform sampler2D u_dirt_texture;\n\t#endif\n\tuniform vec2 u_texel_size;\n\tuniform float u_delta;\n\tuniform float u_intensity;\n\tuniform float u_dirt_factor;\n\t\n\tvec4 sampleBox(vec2 uv) {\n\t\tvec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;\n\t\tvec4 s = texture2D( u_glow_texture, uv + o.xy ) + texture2D( u_glow_texture, uv + o.zy) + texture2D( u_glow_texture, uv + o.xw) + texture2D( u_glow_texture, uv + o.zw);\n\t\treturn s * 0.25;\n\t}\n\tvoid main() {\n\t\tvec4 glow = sampleBox( v_coord );\n\t\t#ifdef USE_DIRT\n\t\t\tglow = mix( glow, glow * texture2D( u_dirt_texture, v_coord ), u_dirt_factor );\n\t\t#endif\n\t\tgl_FragColor = texture2D( u_texture, v_coord ) + u_intensity * glow;\n\t}",N.title="Glow",N.desc="Filters a texture giving it a glow effect",N.widgets_info={iterations:{type:"number",min:0,max:16,step:1,precision:0},threshold:{type:"number",min:0,max:10,step:.01,precision:2},precision:{widget:"combo",values:i.MODE_VALUES}},N.prototype.onGetInputs=function(){return[["enabled","boolean"],["threshold","number"],["intensity","number"],["persistence","number"],["iterations","number"],["dirt_factor","number"]]},N.prototype.onGetOutputs=function(){return[["average","Texture"]]},N.prototype.onExecute=function(){var t=this.getInputData(0);if(t&&this.isAnyOutputConnected())if(this.properties.precision!==i.PASS_THROUGH&&!1!==this.getInputOrProperty("enabled")){t.width,t.height;var e=this.fx;e.threshold=this.getInputOrProperty("threshold"),e.iterations=this.getInputOrProperty("iterations"),e.intensity=this.getInputOrProperty("intensity"),e.persistence=this.getInputOrProperty("persistence"),e.dirt_texture=this.getInputData(1),e.dirt_factor=this.getInputOrProperty("dirt_factor"),e.scale=this.properties.scale;var n=i.getTextureType(this.properties.precision,t),r=null;this.isOutputConnected(2)&&((r=this._average_texture)&&r.type==t.type&&r.format==t.format||(r=this._average_texture=new GL.Texture(1,1,{type:t.type,format:t.format,filter:gl.LINEAR})));var o=null;this.isOutputConnected(1)&&((o=this._glow_texture)&&o.width==t.width&&o.height==t.height&&o.type==n&&o.format==t.format||(o=this._glow_texture=new GL.Texture(t.width,t.height,{type:n,format:t.format,filter:gl.LINEAR})));var s=null;this.isOutputConnected(0)&&((s=this._final_texture)&&s.width==t.width&&s.height==t.height&&s.type==n&&s.format==t.format||(s=this._final_texture=new GL.Texture(t.width,t.height,{type:n,format:t.format,filter:gl.LINEAR}))),e.applyFX(t,s,o,r),this.isOutputConnected(0)&&this.setOutputData(0,s),this.isOutputConnected(1)&&this.setOutputData(1,r),this.isOutputConnected(2)&&this.setOutputData(2,o)}else this.setOutputData(0,t)},e.registerNodeType("texture/glow",N),D.title="Kuwahara Filter",D.desc="Filters a texture giving an artistic oil canvas painting",D.max_radius=10,D._shaders=[],D.prototype.onExecute=function(){var t=this.getInputData(0);if(t&&this.isOutputConnected(0)){var n=this._temp_texture;n&&n.width==t.width&&n.height==t.height&&n.type==t.type||(this._temp_texture=new GL.Texture(t.width,t.height,{type:t.type,format:gl.RGBA,filter:gl.LINEAR}));var i=this.properties.radius;if(0!=(i=Math.min(Math.floor(i),D.max_radius))){var r=this.properties.intensity,o=e.camera_aspect;o||void 0===window.gl||(o=gl.canvas.height/gl.canvas.width),o||(o=1),o=this.properties.preserve_aspect?o:1,D._shaders[i]||(D._shaders[i]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,D.pixel_shader,{RADIUS:i.toFixed(0)}));var s=D._shaders[i],a=GL.Mesh.getScreenQuad();t.bind(0),this._temp_texture.drawTo((function(){s.uniforms({u_texture:0,u_intensity:r,u_resolution:[t.width,t.height],u_iResolution:[1/t.width,1/t.height]}).draw(a)})),this.setOutputData(0,this._temp_texture)}else this.setOutputData(0,t)}},D.pixel_shader="\nprecision highp float;\nvarying vec2 v_coord;\nuniform sampler2D u_texture;\nuniform float u_intensity;\nuniform vec2 u_resolution;\nuniform vec2 u_iResolution;\n#ifndef RADIUS\n\t#define RADIUS 7\n#endif\nvoid main() {\n\n\tconst int radius = RADIUS;\n\tvec2 fragCoord = v_coord;\n\tvec2 src_size = u_iResolution;\n\tvec2 uv = v_coord;\n\tfloat n = float((radius + 1) * (radius + 1));\n\tint i;\n\tint j;\n\tvec3 m0 = vec3(0.0); vec3 m1 = vec3(0.0); vec3 m2 = vec3(0.0); vec3 m3 = vec3(0.0);\n\tvec3 s0 = vec3(0.0); vec3 s1 = vec3(0.0); vec3 s2 = vec3(0.0); vec3 s3 = vec3(0.0);\n\tvec3 c;\n\t\n\tfor (int j = -radius; j <= 0; ++j)  {\n\t\tfor (int i = -radius; i <= 0; ++i)  {\n\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\n\t\t\tm0 += c;\n\t\t\ts0 += c * c;\n\t\t}\n\t}\n\t\n\tfor (int j = -radius; j <= 0; ++j)  {\n\t\tfor (int i = 0; i <= radius; ++i)  {\n\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\n\t\t\tm1 += c;\n\t\t\ts1 += c * c;\n\t\t}\n\t}\n\t\n\tfor (int j = 0; j <= radius; ++j)  {\n\t\tfor (int i = 0; i <= radius; ++i)  {\n\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\n\t\t\tm2 += c;\n\t\t\ts2 += c * c;\n\t\t}\n\t}\n\t\n\tfor (int j = 0; j <= radius; ++j)  {\n\t\tfor (int i = -radius; i <= 0; ++i)  {\n\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\n\t\t\tm3 += c;\n\t\t\ts3 += c * c;\n\t\t}\n\t}\n\t\n\tfloat min_sigma2 = 1e+2;\n\tm0 /= n;\n\ts0 = abs(s0 / n - m0 * m0);\n\t\n\tfloat sigma2 = s0.r + s0.g + s0.b;\n\tif (sigma2 < min_sigma2) {\n\t\tmin_sigma2 = sigma2;\n\t\tgl_FragColor = vec4(m0, 1.0);\n\t}\n\t\n\tm1 /= n;\n\ts1 = abs(s1 / n - m1 * m1);\n\t\n\tsigma2 = s1.r + s1.g + s1.b;\n\tif (sigma2 < min_sigma2) {\n\t\tmin_sigma2 = sigma2;\n\t\tgl_FragColor = vec4(m1, 1.0);\n\t}\n\t\n\tm2 /= n;\n\ts2 = abs(s2 / n - m2 * m2);\n\t\n\tsigma2 = s2.r + s2.g + s2.b;\n\tif (sigma2 < min_sigma2) {\n\t\tmin_sigma2 = sigma2;\n\t\tgl_FragColor = vec4(m2, 1.0);\n\t}\n\t\n\tm3 /= n;\n\ts3 = abs(s3 / n - m3 * m3);\n\t\n\tsigma2 = s3.r + s3.g + s3.b;\n\tif (sigma2 < min_sigma2) {\n\t\tmin_sigma2 = sigma2;\n\t\tgl_FragColor = vec4(m3, 1.0);\n\t}\n}\n",e.registerNodeType("texture/kuwahara",D),k.title="XDoG Filter",k.desc="Filters a texture giving an artistic ink style",k.max_radius=10,k._shaders=[],k.prototype.onExecute=function(){var t=this.getInputData(0);if(t&&this.isOutputConnected(0)){var e=this._temp_texture;e&&e.width==t.width&&e.height==t.height&&e.type==t.type||(this._temp_texture=new GL.Texture(t.width,t.height,{type:t.type,format:gl.RGBA,filter:gl.LINEAR})),k._xdog_shader||(k._xdog_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,k.xdog_pixel_shader));var n=k._xdog_shader,i=GL.Mesh.getScreenQuad(),r=this.properties.sigma,o=this.properties.k,s=this.properties.p,a=this.properties.epsilon,u=this.properties.phi;t.bind(0),this._temp_texture.drawTo((function(){n.uniforms({src:0,sigma:r,k:o,p:s,epsilon:a,phi:u,cvsWidth:t.width,cvsHeight:t.height}).draw(i)})),this.setOutputData(0,this._temp_texture)}},k.xdog_pixel_shader="\nprecision highp float;\nuniform sampler2D src;\n\nuniform float cvsHeight;\nuniform float cvsWidth;\n\nuniform float sigma;\nuniform float k;\nuniform float p;\nuniform float epsilon;\nuniform float phi;\nvarying vec2 v_coord;\n\nfloat cosh(float val)\n{\n\tfloat tmp = exp(val);\n\tfloat cosH = (tmp + 1.0 / tmp) / 2.0;\n\treturn cosH;\n}\n\nfloat tanh(float val)\n{\n\tfloat tmp = exp(val);\n\tfloat tanH = (tmp - 1.0 / tmp) / (tmp + 1.0 / tmp);\n\treturn tanH;\n}\n\nfloat sinh(float val)\n{\n\tfloat tmp = exp(val);\n\tfloat sinH = (tmp - 1.0 / tmp) / 2.0;\n\treturn sinH;\n}\n\nvoid main(void){\n\tvec3 destColor = vec3(0.0);\n\tfloat tFrag = 1.0 / cvsHeight;\n\tfloat sFrag = 1.0 / cvsWidth;\n\tvec2 Frag = vec2(sFrag,tFrag);\n\tvec2 uv = gl_FragCoord.st;\n\tfloat twoSigmaESquared = 2.0 * sigma * sigma;\n\tfloat twoSigmaRSquared = twoSigmaESquared * k * k;\n\tint halfWidth = int(ceil( 1.0 * sigma * k ));\n\n\tconst int MAX_NUM_ITERATION = 99999;\n\tvec2 sum = vec2(0.0);\n\tvec2 norm = vec2(0.0);\n\n\tfor(int cnt=0;cnt<MAX_NUM_ITERATION;cnt++){\n\t\tif(cnt > (2*halfWidth+1)*(2*halfWidth+1)){break;}\n\t\tint i = int(cnt / (2*halfWidth+1)) - halfWidth;\n\t\tint j = cnt - halfWidth - int(cnt / (2*halfWidth+1)) * (2*halfWidth+1);\n\n\t\tfloat d = length(vec2(i,j));\n\t\tvec2 kernel = vec2( exp( -d * d / twoSigmaESquared ), \n\t\t\t\t\t\t\texp( -d * d / twoSigmaRSquared ));\n\n\t\tvec2 L = texture2D(src, (uv + vec2(i,j)) * Frag).xx;\n\n\t\tnorm += kernel;\n\t\tsum += kernel * L;\n\t}\n\n\tsum /= norm;\n\n\tfloat H = 100.0 * ((1.0 + p) * sum.x - p * sum.y);\n\tfloat edge = ( H > epsilon )? 1.0 : 1.0 + tanh( phi * (H - epsilon));\n\tdestColor = vec3(edge);\n\tgl_FragColor = vec4(destColor, 1.0);\n}",e.registerNodeType("texture/xDoG",k),G.title="Webcam",G.desc="Webcam texture",G.is_webcam_open=!1,G.prototype.openStream=function(){if(navigator.getUserMedia){this._waiting_confirmation=!0;var t={audio:!1,video:{facingMode:this.properties.facingMode}};navigator.mediaDevices.getUserMedia(t).then(this.streamReady.bind(this)).catch((function(t){G.is_webcam_open=!1,console.log("Webcam rejected",t),e._webcam_stream=!1,e.boxcolor="red",e.trigger("stream_error")}));var e=this}},G.prototype.closeStream=function(){if(this._webcam_stream){var t=this._webcam_stream.getTracks();if(t.length)for(var e=0;e<t.length;++e)t[e].stop();G.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},G.prototype.streamReady=function(t){this._webcam_stream=t,this.boxcolor="green";var e=this._video;e||((e=document.createElement("video")).autoplay=!0,e.srcObject=t,this._video=e,e.onloadedmetadata=function(t){G.is_webcam_open=!0,console.log(t)}),this.trigger("stream_ready",e)},G.prototype.onPropertyChanged=function(t,e){"facingMode"==t&&(this.properties.facingMode=e,this.closeStream(),this.openStream())},G.prototype.onRemoved=function(){if(this._webcam_stream){var t=this._webcam_stream.getTracks();if(t.length)for(var e=0;e<t.length;++e)t[e].stop();this._webcam_stream=null,this._video=null}},G.prototype.onDrawBackground=function(t){this.flags.collapsed||this.size[1]<=20||this._video&&(t.save(),t.webgl?this._video_texture&&t.drawImage(this._video_texture,0,0,this.size[0],this.size[1]):t.drawImage(this._video,0,0,this.size[0],this.size[1]),t.restore())},G.prototype.onExecute=function(){if(null!=this._webcam_stream||this._waiting_confirmation||this.openStream(),this._video&&this._video.videoWidth){var t=this._video.videoWidth,e=this._video.videoHeight,n=this._video_texture;n&&n.width==t&&n.height==e||(this._video_texture=new GL.Texture(t,e,{format:gl.RGB,filter:gl.LINEAR})),this._video_texture.uploadImage(this._video),this._video_texture.version=++this.version,this.properties.texture_name&&(i.getTexturesContainer()[this.properties.texture_name]=this._video_texture),this.setOutputData(0,this._video_texture);for(var r=1;r<this.outputs.length;++r)if(this.outputs[r])switch(this.outputs[r].name){case"width":this.setOutputData(r,this._video.videoWidth);break;case"height":this.setOutputData(r,this._video.videoHeight)}}},G.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",e.EVENT],["stream_closed",e.EVENT],["stream_error",e.EVENT]]},e.registerNodeType("texture/webcam",G),P.title="Lens FX",P.desc="distortion and chromatic aberration",P.widgets_info={precision:{widget:"combo",values:i.MODE_VALUES}},P.prototype.onGetInputs=function(){return[["enabled","boolean"]]},P.prototype.onExecute=function(){var t=this.getInputData(0);if(t&&this.isOutputConnected(0))if(this.properties.precision!==i.PASS_THROUGH&&!1!==this.getInputOrProperty("enabled")){var e=this._temp_texture;e&&e.width==t.width&&e.height==t.height&&e.type==t.type||(e=this._temp_texture=new GL.Texture(t.width,t.height,{type:t.type,format:gl.RGBA,filter:gl.LINEAR}));var n=P._shader;n||(n=P._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,P.pixel_shader));var r=this.getInputData(1);null==r&&(r=this.properties.factor);var o=this._uniforms;o.u_factor=r,gl.disable(gl.DEPTH_TEST),e.drawTo((function(){t.bind(0),n.uniforms(o).draw(GL.Mesh.getScreenQuad())})),this.setOutputData(0,e)}else this.setOutputData(0,t)},P.pixel_shader="precision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform float u_factor;\n\t\tvec2 barrelDistortion(vec2 coord, float amt) {\n\t\t\tvec2 cc = coord - 0.5;\n\t\t\tfloat dist = dot(cc, cc);\n\t\t\treturn coord + cc * dist * amt;\n\t\t}\n\t\t\n\t\tfloat sat( float t )\n\t\t{\n\t\t\treturn clamp( t, 0.0, 1.0 );\n\t\t}\n\t\t\n\t\tfloat linterp( float t ) {\n\t\t\treturn sat( 1.0 - abs( 2.0*t - 1.0 ) );\n\t\t}\n\t\t\n\t\tfloat remap( float t, float a, float b ) {\n\t\t\treturn sat( (t - a) / (b - a) );\n\t\t}\n\t\t\n\t\tvec4 spectrum_offset( float t ) {\n\t\t\tvec4 ret;\n\t\t\tfloat lo = step(t,0.5);\n\t\t\tfloat hi = 1.0-lo;\n\t\t\tfloat w = linterp( remap( t, 1.0/6.0, 5.0/6.0 ) );\n\t\t\tret = vec4(lo,1.0,hi, 1.) * vec4(1.0-w, w, 1.0-w, 1.);\n\t\t\n\t\t\treturn pow( ret, vec4(1.0/2.2) );\n\t\t}\n\t\t\n\t\tconst float max_distort = 2.2;\n\t\tconst int num_iter = 12;\n\t\tconst float reci_num_iter_f = 1.0 / float(num_iter);\n\t\t\n\t\tvoid main()\n\t\t{\t\n\t\t\tvec2 uv=v_coord;\n\t\t\tvec4 sumcol = vec4(0.0);\n\t\t\tvec4 sumw = vec4(0.0);\t\n\t\t\tfor ( int i=0; i<num_iter;++i )\n\t\t\t{\n\t\t\t\tfloat t = float(i) * reci_num_iter_f;\n\t\t\t\tvec4 w = spectrum_offset( t );\n\t\t\t\tsumw += w;\n\t\t\t\tsumcol += w * texture2D( u_texture, barrelDistortion(uv, .6 * max_distort*t * u_factor ) );\n\t\t\t}\n\t\t\tgl_FragColor = sumcol / sumw;\n\t\t}",e.registerNodeType("texture/lensfx",P),B.title="Data->Tex",B.desc="Generates or applies a curve to a texture",B.widgets_info={precision:{widget:"combo",values:i.MODE_VALUES}},B.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=this.getInputData(0);if(t){var e=this.properties.channels,n=this.properties.width,r=this.properties.height;n&&r||(n=Math.floor(t.length/e),r=1);var o=gl.RGBA;3==e?o=gl.RGB:1==e&&(o=gl.LUMINANCE);var s=this._temp_texture,a=i.getTextureType(this.properties.precision);s&&s.width==n&&s.height==r&&s.type==a||(s=this._temp_texture=new GL.Texture(n,r,{type:a,format:o,filter:gl.LINEAR})),s.uploadData(t),this.setOutputData(0,s)}}},e.registerNodeType("texture/fromdata",B),R.title="Curve",R.desc="Generates or applies a curve to a texture",R.widgets_info={precision:{widget:"combo",values:i.MODE_VALUES}},R.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=this.getInputData(0),e=this._temp_texture;if(!t)return!this._must_update&&this._curve_texture||this.updateCurve(),void this.setOutputData(0,this._curve_texture);var n=i.getTextureType(this.properties.precision,t);e&&e.type==n&&e.width==t.width&&e.height==t.height&&e.format==t.format||(e=this._temp_texture=new GL.Texture(t.width,t.height,{type:n,format:t.format,filter:gl.LINEAR}));var r=R._shader;r||(r=R._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,R.pixel_shader)),!this._must_update&&this._curve_texture||this.updateCurve();var o=this._uniforms,s=this._curve_texture;e.drawTo((function(){gl.disable(gl.DEPTH_TEST),t.bind(0),s.bind(1),r.uniforms(o).draw(GL.Mesh.getScreenQuad())})),this.setOutputData(0,e)}},R.prototype.sampleCurve=function(t,e){if(e=e||this._points.RGB){for(var n=0;n<e.length-1;++n){var i=e[n],r=e[n+1];if(!(r[0]<t)){var o=r[0]-i[0];if(Math.abs(o)<1e-5)return i[1];var s=(t-i[0])/o;return i[1]*(1-s)+r[1]*s}}return 0}},R.prototype.updateCurve=function(){for(var t=this._values,e=t.length/4,n=this.properties.split_channels,i=0;i<e;++i){if(n)t[4*i]=clamp(255*this.sampleCurve(i/e,this._points.R),0,255),t[4*i+1]=clamp(255*this.sampleCurve(i/e,this._points.G),0,255),t[4*i+2]=clamp(255*this.sampleCurve(i/e,this._points.B),0,255);else{var r=this.sampleCurve(i/e);t[4*i]=t[4*i+1]=t[4*i+2]=clamp(255*r,0,255)}t[4*i+3]=255}this._curve_texture||(this._curve_texture=new GL.Texture(256,1,{format:gl.RGBA,magFilter:gl.LINEAR,wrap:gl.CLAMP_TO_EDGE})),this._curve_texture.uploadData(t,null,!0)},R.prototype.onSerialize=function(t){var e={};for(var n in this._points)e[n]=this._points[n].concat();t.curves=e},R.prototype.onConfigure=function(t){this._points=t.curves,this.curve_editor&&(curve_editor.points=this._points),this._must_update=!0},R.prototype.onMouseDown=function(t,e,n){if(this.curve_editor){var i=this.curve_editor.onMouseDown([e[0],e[1]-this.curve_offset],n);return i&&this.captureInput(!0),i}},R.prototype.onMouseMove=function(t,e,n){if(this.curve_editor)return this.curve_editor.onMouseMove([e[0],e[1]-this.curve_offset],n)},R.prototype.onMouseUp=function(t,e,n){if(this.curve_editor)return this.curve_editor.onMouseUp([e[0],e[1]-this.curve_offset],n);this.captureInput(!1)},R.channel_line_colors={RGB:"#666",R:"#F33",G:"#3F3",B:"#33F"},R.prototype.onDrawBackground=function(t,n){if(!this.flags.collapsed){this.curve_editor||(this.curve_editor=new e.CurveEditor(this._points.R)),t.save(),t.translate(0,this.curve_offset);var i=this.widgets[1].value;this.properties.split_channels?("RGB"==i&&(this.widgets[1].value=i="R",this.widgets[1].disabled=!1),this.curve_editor.points=this._points.R,this.curve_editor.draw(t,[this.size[0],this.size[1]-this.curve_offset],n,"#111",R.channel_line_colors.R,!0),t.globalCompositeOperation="lighten",this.curve_editor.points=this._points.G,this.curve_editor.draw(t,[this.size[0],this.size[1]-this.curve_offset],n,null,R.channel_line_colors.G,!0),this.curve_editor.points=this._points.B,this.curve_editor.draw(t,[this.size[0],this.size[1]-this.curve_offset],n,null,R.channel_line_colors.B,!0),t.globalCompositeOperation="source-over"):(this.widgets[1].value=i="RGB",this.widgets[1].disabled=!0),this.curve_editor.points=this._points[i],this.curve_editor.draw(t,[this.size[0],this.size[1]-this.curve_offset],n,this.properties.split_channels?null:"#111",R.channel_line_colors[i]),t.restore()}},R.pixel_shader="precision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform sampler2D u_curve;\n\t\tuniform float u_range;\n\t\t\n\t\tvoid main() {\n\t\t\tvec4 color = texture2D( u_texture, v_coord ) * u_range;\n\t\t\tcolor.x = texture2D( u_curve, vec2( color.x, 0.5 ) ).x;\n\t\t\tcolor.y = texture2D( u_curve, vec2( color.y, 0.5 ) ).y;\n\t\t\tcolor.z = texture2D( u_curve, vec2( color.z, 0.5 ) ).z;\n\t\t\t//color.w = texture2D( u_curve, vec2( color.w, 0.5 ) ).w;\n\t\t\tgl_FragColor = color;\n\t\t}",e.registerNodeType("texture/curve",R),M.title="Exposition",M.desc="Controls texture exposition",M.widgets_info={exposition:{widget:"slider",min:0,max:3},precision:{widget:"combo",values:i.MODE_VALUES}},M.prototype.onExecute=function(){var t=this.getInputData(0);if(t&&this.isOutputConnected(0)){var e=this._temp_texture;e&&e.width==t.width&&e.height==t.height&&e.type==t.type||(e=this._temp_texture=new GL.Texture(t.width,t.height,{type:t.type,format:gl.RGBA,filter:gl.LINEAR}));var n=M._shader;n||(n=M._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,M.pixel_shader)),this.properties.exposition;var i=this.getInputData(1);null!=i&&(this.properties.exposition=i);var r=this._uniforms;e.drawTo((function(){gl.disable(gl.DEPTH_TEST),t.bind(0),n.uniforms(r).draw(GL.Mesh.getScreenQuad())})),this.setOutputData(0,e)}},M.pixel_shader="precision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform float u_exposition;\n\t\t\n\t\tvoid main() {\n\t\t\tvec4 color = texture2D( u_texture, v_coord );\n\t\t\tgl_FragColor = vec4( color.xyz * u_exposition, color.a );\n\t\t}",e.registerNodeType("texture/exposition",M),z.title="Tone Mapping",z.desc="Applies Tone Mapping to convert from high to low",z.widgets_info={precision:{widget:"combo",values:i.MODE_VALUES}},z.prototype.onGetInputs=function(){return[["enabled","boolean"]]},z.prototype.onExecute=function(){var t=this.getInputData(0);if(t&&this.isOutputConnected(0))if(this.properties.precision!==i.PASS_THROUGH&&!1!==this.getInputOrProperty("enabled")){var e=this._temp_texture;e&&e.width==t.width&&e.height==t.height&&e.type==t.type||(e=this._temp_texture=new GL.Texture(t.width,t.height,{type:t.type,format:gl.RGBA,filter:gl.LINEAR}));var n=this.getInputData(1);null==n&&(n=this.properties.average_lum);var r=this._uniforms,o=null;n.constructor===Number?(this.properties.average_lum=n,r.u_average_lum=this.properties.average_lum,(o=z._shader)||(o=z._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,z.pixel_shader))):n.constructor===GL.Texture&&(r.u_average_texture=n.bind(1),(o=z._shader_texture)||(o=z._shader_texture=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,z.pixel_shader,{AVG_TEXTURE:""}))),r.u_lumwhite2=this.properties.lum_white*this.properties.lum_white,r.u_scale=this.properties.scale,r.u_igamma=1/this.properties.gamma,gl.disable(gl.DEPTH_TEST),e.drawTo((function(){t.bind(0),o.uniforms(r).draw(GL.Mesh.getScreenQuad())})),this.setOutputData(0,this._temp_texture)}else this.setOutputData(0,t)},z.pixel_shader="precision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform float u_scale;\n\t\t#ifdef AVG_TEXTURE\n\t\t\tuniform sampler2D u_average_texture;\n\t\t#else\n\t\t\tuniform float u_average_lum;\n\t\t#endif\n\t\tuniform float u_lumwhite2;\n\t\tuniform float u_igamma;\n\t\tvec3 RGB2xyY (vec3 rgb)\n\t\t{\n\t\t\t const mat3 RGB2XYZ = mat3(0.4124, 0.3576, 0.1805,\n\t\t\t\t\t\t\t\t\t   0.2126, 0.7152, 0.0722,\n\t\t\t\t\t\t\t\t\t   0.0193, 0.1192, 0.9505);\n\t\t\tvec3 XYZ = RGB2XYZ * rgb;\n\t\t\t\n\t\t\tfloat f = (XYZ.x + XYZ.y + XYZ.z);\n\t\t\treturn vec3(XYZ.x / f,\n\t\t\t\t\t\tXYZ.y / f,\n\t\t\t\t\t\tXYZ.y);\n\t\t}\n\t\t\n\t\tvoid main() {\n\t\t\tvec4 color = texture2D( u_texture, v_coord );\n\t\t\tvec3 rgb = color.xyz;\n\t\t\tfloat average_lum = 0.0;\n\t\t\t#ifdef AVG_TEXTURE\n\t\t\t\tvec3 pixel = texture2D(u_average_texture,vec2(0.5)).xyz;\n\t\t\t\taverage_lum = (pixel.x + pixel.y + pixel.z) / 3.0;\n\t\t\t#else\n\t\t\t\taverage_lum = u_average_lum;\n\t\t\t#endif\n\t\t\t//Ld - this part of the code is the same for both versions\n\t\t\tfloat lum = dot(rgb, vec3(0.2126, 0.7152, 0.0722));\n\t\t\tfloat L = (u_scale / average_lum) * lum;\n\t\t\tfloat Ld = (L * (1.0 + L / u_lumwhite2)) / (1.0 + L);\n\t\t\t//first\n\t\t\t//vec3 xyY = RGB2xyY(rgb);\n\t\t\t//xyY.z *= Ld;\n\t\t\t//rgb = xyYtoRGB(xyY);\n\t\t\t//second\n\t\t\trgb = (rgb / lum) * Ld;\n\t\t\trgb = max(rgb,vec3(0.001));\n\t\t\trgb = pow( rgb, vec3( u_igamma ) );\n\t\t\tgl_FragColor = vec4( rgb, color.a );\n\t\t}",e.registerNodeType("texture/tonemapping",z),F.title="Perlin",F.desc="Generates a perlin noise texture",F.widgets_info={precision:{widget:"combo",values:i.MODE_VALUES},width:{type:"number",precision:0,step:1},height:{type:"number",precision:0,step:1},octaves:{type:"number",precision:0,step:1,min:1,max:50}},F.prototype.onGetInputs=function(){return[["seed","number"],["persistence","number"],["octaves","number"],["scale","number"],["amplitude","number"],["offset","vec2"]]},F.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=0|this.properties.width,e=0|this.properties.height;0==t&&(t=gl.viewport_data[2]),0==e&&(e=gl.viewport_data[3]);var n=i.getTextureType(this.properties.precision),r=this._texture;r&&r.width==t&&r.height==e&&r.type==n||(r=this._texture=new GL.Texture(t,e,{type:n,format:gl.RGB,filter:gl.LINEAR}));var o=this.getInputOrProperty("persistence"),s=this.getInputOrProperty("octaves"),a=this.getInputOrProperty("offset"),u=this.getInputOrProperty("scale"),l=this.getInputOrProperty("amplitude"),p=this.getInputOrProperty("seed"),h=""+t+e+n+o+s+u+p+a[0]+a[1]+l;if(h!=this._key){this._key=h;var c=this._uniforms;c.u_persistence=o,c.u_octaves=s,c.u_offset.set(a),c.u_scale=u,c.u_amplitude=l,c.u_seed=128*p,c.u_viewport[0]=t,c.u_viewport[1]=e;var d=F._shader;d||(d=F._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,F.pixel_shader)),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),r.drawTo((function(){d.uniforms(c).draw(GL.Mesh.getScreenQuad())})),this.setOutputData(0,r)}else this.setOutputData(0,r)}},F.pixel_shader="precision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform vec2 u_offset;\n\t\tuniform float u_scale;\n\t\tuniform float u_persistence;\n\t\tuniform int u_octaves;\n\t\tuniform float u_amplitude;\n\t\tuniform vec2 u_viewport;\n\t\tuniform float u_seed;\n\t\t#define M_PI 3.14159265358979323846\n\t\t\n\t\tfloat rand(vec2 c){\treturn fract(sin(dot(c.xy ,vec2( 12.9898 + u_seed,78.233 + u_seed))) * 43758.5453); }\n\t\t\n\t\tfloat noise(vec2 p, float freq ){\n\t\t\tfloat unit = u_viewport.x/freq;\n\t\t\tvec2 ij = floor(p/unit);\n\t\t\tvec2 xy = mod(p,unit)/unit;\n\t\t\t//xy = 3.*xy*xy-2.*xy*xy*xy;\n\t\t\txy = .5*(1.-cos(M_PI*xy));\n\t\t\tfloat a = rand((ij+vec2(0.,0.)));\n\t\t\tfloat b = rand((ij+vec2(1.,0.)));\n\t\t\tfloat c = rand((ij+vec2(0.,1.)));\n\t\t\tfloat d = rand((ij+vec2(1.,1.)));\n\t\t\tfloat x1 = mix(a, b, xy.x);\n\t\t\tfloat x2 = mix(c, d, xy.x);\n\t\t\treturn mix(x1, x2, xy.y);\n\t\t}\n\t\t\n\t\tfloat pNoise(vec2 p, int res){\n\t\t\tfloat persistance = u_persistence;\n\t\t\tfloat n = 0.;\n\t\t\tfloat normK = 0.;\n\t\t\tfloat f = 4.;\n\t\t\tfloat amp = 1.0;\n\t\t\tint iCount = 0;\n\t\t\tfor (int i = 0; i<50; i++){\n\t\t\t\tn+=amp*noise(p, f);\n\t\t\t\tf*=2.;\n\t\t\t\tnormK+=amp;\n\t\t\t\tamp*=persistance;\n\t\t\t\tif (iCount >= res)\n\t\t\t\t\tbreak;\n\t\t\t\tiCount++;\n\t\t\t}\n\t\t\tfloat nf = n/normK;\n\t\t\treturn nf*nf*nf*nf;\n\t\t}\n\t\tvoid main() {\n\t\t\tvec2 uv = v_coord * u_scale * u_viewport + u_offset * u_scale;\n\t\t\tvec4 color = vec4( pNoise( uv, u_octaves ) * u_amplitude );\n\t\t\tgl_FragColor = color;\n\t\t}",e.registerNodeType("texture/perlin",F),j.title="Canvas2D",j.desc="Executes Canvas2D code inside a texture or the viewport.",j.help="Set width and height to 0 to match viewport size.",j.default_code="//vars: canvas,ctx,time\nctx.fillStyle='red';\nctx.fillRect(0,0,50,50);\n",j.widgets_info={precision:{widget:"combo",values:i.MODE_VALUES},code:{type:"code"},width:{type:"number",precision:0,step:1},height:{type:"number",precision:0,step:1}},j.prototype.onPropertyChanged=function(t,e){"code"==t&&this.compileCode(e)},j.prototype.compileCode=function(t){if(this._func=null,e.allow_scripts)try{this._func=new Function("canvas","ctx","time","script","v",t),this.boxcolor="#00FF00"}catch(t){this.boxcolor="#FF0000",console.error("Error parsing script"),console.error(t)}},j.prototype.onExecute=function(){var t=this._func;t&&this.isOutputConnected(0)&&this.executeDraw(t)},j.prototype.executeDraw=function(e){var n=this.properties.width||gl.canvas.width,r=this.properties.height||gl.canvas.height,o=this._temp_texture,s=i.getTextureType(this.properties.precision);o&&o.width==n&&o.height==r&&o.type==s||(o=this._temp_texture=new GL.Texture(n,r,{format:gl.RGBA,filter:gl.LINEAR,type:s}));var a=this.getInputData(0),u=this.properties,l=this,p=this.graph.getTime(),h=gl,c=gl.canvas;if(!this.properties.use_html_canvas&&t.enableWebGLCanvas||(this._canvas?(c=this._canvas,h=this._ctx):(c=this._canvas=createCanvas(n.height),h=this._ctx=c.getContext("2d")),c.width=n,c.height=r),h==gl)o.drawTo((function(){gl.start2D(),u.clear&&(gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT));try{e.draw?e.draw.call(l,c,h,p,e,a):e.call(l,c,h,p,e,a),l.boxcolor="#00FF00"}catch(t){l.boxcolor="#FF0000",console.error("Error executing script"),console.error(t)}gl.finish2D()}));else{u.clear&&h.clearRect(0,0,c.width,c.height);try{e.draw?e.draw.call(this,c,h,p,e,a):e.call(this,c,h,p,e,a),this.boxcolor="#00FF00"}catch(t){this.boxcolor="#FF0000",console.error("Error executing script"),console.error(t)}o.uploadImage(c)}this.setOutputData(0,o)},e.registerNodeType("texture/canvas2D",j),H.title="Matte",H.desc="Extracts background",H.widgets_info={key_color:{widget:"color"},precision:{widget:"combo",values:i.MODE_VALUES}},H.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=this.getInputData(0);if(this.properties.precision!==i.PASS_THROUGH){if(t){this._tex=i.getTargetTexture(t,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),this._uniforms||(this._uniforms={u_texture:0,u_key_color:this.properties.key_color,u_threshold:1,u_slope:1});var e=this._uniforms,n=Mesh.getScreenQuad(),r=H._shader;r||(r=H._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,H.pixel_shader)),e.u_key_color=this.properties.key_color,e.u_threshold=this.properties.threshold,e.u_slope=this.properties.slope,this._tex.drawTo((function(){t.bind(0),r.uniforms(e).draw(n)})),this.setOutputData(0,this._tex)}}else this.setOutputData(0,t)}},H.pixel_shader="precision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform vec3 u_key_color;\n\t\tuniform float u_threshold;\n\t\tuniform float u_slope;\n\t\t\n\t\tvoid main() {\n\t\t\tvec3 color = texture2D( u_texture, v_coord ).xyz;\n\t\t\tfloat diff = length( normalize(color) - normalize(u_key_color) );\n\t\t\tfloat edge = u_threshold * (1.0 - u_slope);\n\t\t\tfloat alpha = smoothstep( edge, u_threshold, diff);\n\t\t\tgl_FragColor = vec4( color, alpha );\n\t\t}",e.registerNodeType("texture/matte",H),U.title="CubemapToTexture2D",U.desc="Transforms a CUBEMAP texture into a TEXTURE2D in Polar Representation",U.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=this.getInputData(0);if(t&&t.texture_type==GL.TEXTURE_CUBE_MAP){!this._last_tex||this._last_tex.height==t.height&&this._last_tex.type==t.type||(this._last_tex=null);var e=this.getInputOrProperty("yaw");this._last_tex=GL.Texture.cubemapToTexture2D(t,t.height,this._last_tex,!0,e),this.setOutputData(0,this._last_tex)}}},e.registerNodeType("texture/cubemapToTexture2D",U))}(this),function(t){if("undefined"!=typeof GL){var e=t.LiteGraph,n=(t.LGraphCanvas,"#345"),i=e.Shaders={},r=(i.GLSL_types=["float","vec2","vec3","vec4","mat3","mat4","sampler2D","samplerCube"],i.GLSL_types_const=["float","vec2","vec3","vec4"]),o={radians:"T radians(T degrees)",degrees:"T degrees(T radians)",sin:"T sin(T angle)",cos:"T cos(T angle)",tan:"T tan(T angle)",asin:"T asin(T x)",acos:"T acos(T x)",atan:"T atan(T x)",atan2:"T atan(T x,T y)",pow:"T pow(T x,T y)",exp:"T exp(T x)",log:"T log(T x)",exp2:"T exp2(T x)",log2:"T log2(T x)",sqrt:"T sqrt(T x)",inversesqrt:"T inversesqrt(T x)",abs:"T abs(T x)",sign:"T sign(T x)",floor:"T floor(T x)",round:"T round(T x)",ceil:"T ceil(T x)",fract:"T fract(T x)",mod:"T mod(T x,T y)",min:"T min(T x,T y)",max:"T max(T x,T y)",clamp:"T clamp(T x,T minVal = 0.0,T maxVal = 1.0)",mix:"T mix(T x,T y,T a)",step:"T step(T edge, T edge2, T x)",smoothstep:"T smoothstep(T edge, T edge2, T x)",length:"float length(T x)",distance:"float distance(T p0, T p1)",normalize:"T normalize(T x)",dot:"float dot(T x,T y)",cross:"vec3 cross(vec3 x,vec3 y)",reflect:"vec3 reflect(vec3 V,vec3 N)",refract:"vec3 refract(vec3 V,vec3 N, float IOR)"},s={},a=[];c(),i.ALL_TYPES="float,vec2,vec3,vec4",i.registerShaderNode=d,i.getInputLinkID=g,i.getOutputLinkID=_,i.getShaderNodeVarName=f,i.parseGLSLDescriptions=c;var u=e.valueToGLSL=function(t,e,n){var i=5;if(null!=n&&(i=n),!e)if(t.constructor===Number)e="float";else{if(!t.length)throw"unknown type for glsl value: "+t.constructor;switch(t.length){case 2:e="vec2";break;case 3:e="vec3";break;case 4:e="vec4";break;case 9:e="mat3";break;case 16:e="mat4";break;default:throw"unknown type for glsl value size"}}switch(e){case"float":return t.toFixed(i);case"vec2":return"vec2("+t[0].toFixed(i)+","+t[1].toFixed(i)+")";case"color3":case"vec3":return"vec3("+t[0].toFixed(i)+","+t[1].toFixed(i)+","+t[2].toFixed(i)+")";case"color4":case"vec4":return"vec4("+t[0].toFixed(i)+","+t[1].toFixed(i)+","+t[2].toFixed(i)+","+t[3].toFixed(i)+")";case"mat3":return"mat3(1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0)";case"mat4":return"mat4(1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0)";default:throw e}return""},l=e.varToTypeGLSL=function(t,e,n){if(e==n)return t;if(null==t)switch(n){case"float":return"0.0";case"vec2":return"vec2(0.0)";case"vec3":return"vec3(0.0)";case"vec4":return"vec4(0.0,0.0,0.0,1.0)";default:return null}if(!n)throw"error: no output type specified";if("float"==n)switch(e){case"vec2":case"vec3":case"vec4":return t+".x";default:return"0.0"}else if("vec2"==n)switch(e){case"float":return"vec2("+t+")";case"vec3":case"vec4":return t+".xy";default:return"vec2(0.0)"}else if("vec3"==n)switch(e){case"float":return"vec3("+t+")";case"vec2":return"vec3("+t+",0.0)";case"vec4":return t+".xyz";default:return"vec3(0.0)"}else if("vec4"==n)switch(e){case"float":return"vec4("+t+")";case"vec2":return"vec4("+t+",0.0,1.0)";case"vec3":return"vec4("+t+",1.0)";default:return"vec4(0.0,0.0,0.0,1.0)"}throw"type cannot be converted"},h=e.convertVarToGLSLType=function(t,e,n){if(e==n)return t;if("float"==e)return n+"("+t+")";if("vec2"==n)return"vec2("+t+".xy)";if("vec3"==n){if("vec2"==e)return"vec3("+t+",0.0)";if("vec4"==e)return"vec4("+t+".xyz)"}if("vec4"==n){if("vec2"==e)return"vec4("+t+",0.0,0.0)";if("vec3"==n)return"vec4("+t+",1.0)"}return null};v.prototype.clear=function(){this._uniforms={},this._functions={},this._codeparts={},this._uniform_value=null,this.extra={}},v.prototype.addUniform=function(t,e,n){this._uniforms[t]=e,null!=n&&(this._uniform_value||(this._uniform_value={}),this._uniform_value[t]=n)},v.prototype.addFunction=function(t,e){this._functions[t]=e},v.prototype.addCode=function(t,e,n){for(var i in n=n||{"":""}){var r=i?i+"_"+t:t;this._codeparts[r]?this._codeparts[r]+=e+"\n":this._codeparts[r]=e+"\n"}},v.prototype.computeCodeBlocks=function(t,e){this.clear();var n=t.findNodesByType("shader::output/vertex");n=n&&n.length?n[0]:null;var i=t.findNodesByType("shader::output/fragcolor");if(!(i=i&&i.length?i[0]:null))return null;t.sendEventToAllNodes("clearDestination"),n&&n.propagateDestination("vs"),i&&i.propagateDestination("fs"),t.sendEventToAllNodes("onGetCode",this);var r="";for(var o in this._uniforms)r+="uniform "+this._uniforms[o]+" "+o+";\n";if(e)for(var o in e)r+="uniform "+e[o]+" "+o+";\n";var s="";for(var o in this._functions)s+="//"+o+"\n"+this._functions[o]+"\n";var a=this._codeparts;return a.uniforms=r,a.functions=s,a},v.prototype.computeShaderCode=function(t){var e=this.computeCodeBlocks(t);return{vs_code:GL.Shader.replaceCodeUsingContext(this.vs_template,e),fs_code:GL.Shader.replaceCodeUsingContext(this.fs_template,e)}},v.prototype.computeShader=function(t,n){var i=this.computeShaderCode(t);if(console.log(i.vs_code,i.fs_code),!e.catch_exceptions)return this._shader_error=!0,n?n.updateShader(i.vs_code,i.fs_code):n=new GL.Shader(i.vs_code,i.fs_code),this._shader_error=!1,n;try{return n?n.updateShader(i.vs_code,i.fs_code):n=new GL.Shader(i.vs_code,i.fs_code),this._shader_error=!1,n}catch(t){return this._shader_error||(console.error(t),-1!=t.indexOf("Fragment shader")?console.log(i.fs_code.split("\n").map((function(t,e){return e+".- "+t})).join("\n")):console.log(i.vs_code)),this._shader_error=!0,null}return null},v.prototype.getShader=function(t){if(this._shader&&this._shader._version==t._version)return this._shader;var e=this.computeShader(t,this._shader);return e?(this._shader=e,e._version=t._version,e):null},v.prototype.fillUniforms=function(t,e){if(this._uniform_value)for(var n in this._uniform_value){var i=this._uniform_value[n];null!=i&&(i.constructor===Function?t[n]=i.call(this,e):i.constructor===GL.Texture||(t[n]=i))}},e.ShaderContext=e.Shaders.Context=v,m.template="\n#define FRAGMENT\nprecision highp float;\nvarying vec2 v_coord;\n{{varying}}\n{{uniforms}}\n{{functions}}\n{{fs_functions}}\nvoid main() {\n\nvec2 uv = v_coord;\nvec4 fragcolor = vec4(0.0);\nvec4 fragcolor1 = vec4(0.0);\n{{fs_code}}\ngl_FragColor = fragcolor;\n}\n\t",m.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},m.title="ShaderGraph",m.desc="Builds a shader using a graph",m.input_node_type="input/uniform",m.output_node_type="output/fragcolor",m.title_color=n,m.prototype.onSerialize=function(t){t.subgraph=this.subgraph.serialize()},m.prototype.onConfigure=function(t){this.subgraph.configure(t.subgraph)},m.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=this.getInputData(0);t&&t.constructor!=GL.Texture&&(t=null);var e=0|this.properties.width,n=0|this.properties.height;0==e&&(e=t?t.width:gl.viewport_data[2]),0==n&&(n=t?t.height:gl.viewport_data[3]);var i=LGraphTexture.getTextureType(this.properties.precision,t),r=this._texture;r&&r.width==e&&r.height==n&&r.type==i||(r=this._texture=new GL.Texture(e,n,{type:i,format:this.alpha?gl.RGBA:gl.RGB,filter:gl.LINEAR}));var o=this.getShader(this.subgraph);if(o){var s=this._uniforms;this._context.fillUniforms(s);var a=0;if(this.inputs)for(var u=0;u<this.inputs.length;++u){var l=this.inputs[u],p=this.getInputData(u);"texture"==l.type&&(p||(p=GL.Texture.getWhiteTexture()),p=p.bind(a++)),null!=p&&(s["u_"+l.name]=p)}var h=GL.Mesh.getScreenQuad();gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),r.drawTo((function(){o.uniforms(s),o.draw(h)})),this.setOutputData(0,r)}}},m.prototype.onInputAdded=function(t){var n=e.createNode("shader::input/uniform");n.setProperty("name",t.name),n.setProperty("type",t.type),this.subgraph.add(n)},m.prototype.onInputRemoved=function(t,e){for(var n=this.subgraph.findNodesByType("shader::input/uniform"),i=0;i<n.length;++i){var r=n[i];r.properties.name==e.name&&this.subgraph.remove(r)}},m.prototype.computeSize=function(){var t=this.inputs?this.inputs.length:0,n=this.outputs?this.outputs.length:0;return[200,Math.max(t,n)*e.NODE_SLOT_HEIGHT+e.NODE_TITLE_HEIGHT+10]},m.prototype.getShader=function(){var t=this._context.getShader(this.subgraph);return this.boxcolor=t?null:"red",t},m.prototype.onDrawBackground=function(t,n,i,r){if(!this.flags.collapsed){var o=this.getOutputData(0),s=this.inputs?this.inputs.length*e.NODE_SLOT_HEIGHT:0;o&&t==o.gl&&this.size[1]>s+e.NODE_TITLE_HEIGHT&&t.drawImage(o,10,a,this.size[0]-20,this.size[1]-s-e.NODE_TITLE_HEIGHT);var a=this.size[1]-e.NODE_TITLE_HEIGHT+.5,u=e.isInsideRectangle(r[0],r[1],this.pos[0],this.pos[1]+a,this.size[0],e.NODE_TITLE_HEIGHT);t.fillStyle=u?"#555":"#222",t.beginPath(),this._shape==e.BOX_SHAPE?t.rect(0,a,this.size[0]+1,e.NODE_TITLE_HEIGHT):t.roundRect(0,a,this.size[0]+1,e.NODE_TITLE_HEIGHT,0,8),t.fill(),t.textAlign="center",t.font="24px Arial",t.fillStyle=u?"#DDD":"#999",t.fillText("+",.5*this.size[0],a+24)}},m.prototype.onMouseDown=function(t,n,i){var r=this.size[1]-e.NODE_TITLE_HEIGHT+.5;n[1]>r&&i.showSubgraphPropertiesDialog(this)},m.prototype.onDrawSubgraphBackground=function(t){},m.prototype.getExtraMenuOptions=function(t){var e=this;return[{content:"Print Code",callback:function(){var t=e._context.computeShaderCode();console.log(t.vs_code,t.fs_code)}}]},e.registerNodeType("texture/shaderGraph",m),y.title="Uniform",y.desc="Input data for the shader",y.prototype.getTitle=function(){return this.properties.name&&this.flags.collapsed?this.properties.type+" "+this.properties.name:"Uniform"},y.prototype.onPropertyChanged=function(t,e){this.outputs[0].name=this.properties.type+" "+this.properties.name},y.prototype.onGetCode=function(t){if(this.shader_destination){var e=this.properties.type;if(!e){if(!t.onGetPropertyInfo)return;var n=t.onGetPropertyInfo(this.property.name);if(!n)return;e=n.type}"number"==e?e="float":"texture"==e&&(e="sampler2D"),-1!=i.GLSL_types.indexOf(e)&&(t.addUniform("u_"+this.properties.name,e),this.setOutputData(0,e))}},y.prototype.getOutputVarName=function(t){return"u_"+this.properties.name},d("input/uniform",y),b.title="Attribute",b.desc="Input data from mesh attribute",b.prototype.getTitle=function(){return"att. "+this.properties.name},b.prototype.onGetCode=function(t){if(this.shader_destination){var e=this.properties.type;e&&-1!=i.GLSL_types.indexOf(e)&&("number"==e&&(e="float"),"coord"!=this.properties.name&&t.addCode("varying"," varying "+e+" v_"+this.properties.name+";"),this.setOutputData(0,e))}},b.prototype.getOutputVarName=function(t){return"v_"+this.properties.name},d("input/attribute",b),x.title="Sampler2D",x.desc="Reads a pixel from a texture",x.prototype.onGetCode=function(t){if(this.shader_destination){var e=g(this,0),n=f(this),i="vec4 "+n+" = vec4(0.0);\n";e&&(i+=n+" = texture2D("+e+","+(g(this,1)||t.buffer_names.uvs)+");\n"),_(this,0)&&(i+="vec4 "+_(this,0)+" = "+n+";\n"),_(this,1)&&(i+="vec3 "+_(this,1)+" = "+n+".xyz;\n"),t.addCode("code",i,this.shader_destination),this.setOutputData(0,"vec4"),this.setOutputData(1,"vec3")}},d("texture/sampler2D",x),A.title="const",A.prototype.getTitle=function(){return this.flags.collapsed?u(this.properties.value,this.properties.type,2):"Const"},A.prototype.onPropertyChanged=function(t,e){"type"==t&&(this.outputs[0].type!=e&&(this.disconnectOutput(0),this.outputs[0].type=e),this.widgets.length=1,this.updateWidgets()),"value"==t&&(e.length?(this.widgets[1].value=e[1],e.length>2&&(this.widgets[2].value=e[2]),e.length>3&&(this.widgets[3].value=e[3])):this.widgets[1].value=e)},A.prototype.updateWidgets=function(t){var e=this,n=(t=this.properties.value,{step:.01});switch(this.properties.type){case"float":this.properties.value=0,this.addWidget("number","v",0,{step:.01,property:"value"});break;case"vec2":this.properties.value=t&&2==t.length?[t[0],t[1]]:[0,0,0],this.addWidget("number","x",this.properties.value[0],(function(t){e.properties.value[0]=t}),n),this.addWidget("number","y",this.properties.value[1],(function(t){e.properties.value[1]=t}),n);break;case"vec3":this.properties.value=t&&3==t.length?[t[0],t[1],t[2]]:[0,0,0],this.addWidget("number","x",this.properties.value[0],(function(t){e.properties.value[0]=t}),n),this.addWidget("number","y",this.properties.value[1],(function(t){e.properties.value[1]=t}),n),this.addWidget("number","z",this.properties.value[2],(function(t){e.properties.value[2]=t}),n);break;case"vec4":this.properties.value=t&&4==t.length?[t[0],t[1],t[2],t[3]]:[0,0,0,0],this.addWidget("number","x",this.properties.value[0],(function(t){e.properties.value[0]=t}),n),this.addWidget("number","y",this.properties.value[1],(function(t){e.properties.value[1]=t}),n),this.addWidget("number","z",this.properties.value[2],(function(t){e.properties.value[2]=t}),n),this.addWidget("number","w",this.properties.value[3],(function(t){e.properties.value[3]=t}),n);break;default:console.error("unknown type for constant")}},A.prototype.onGetCode=function(t){if(this.shader_destination){var e=u(this.properties.value,this.properties.type),n=_(this,0);if(n){var i="\t"+this.properties.type+" "+n+" = "+e+";";t.addCode("code",i,this.shader_destination),this.setOutputData(0,this.properties.type)}}},d("const/const",A),w.title="vec2",w.varmodes=["xy","x","y"],w.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},w.prototype.onGetCode=function(t){if(this.shader_destination){for(var e=this.properties,n=f(this),i="\tvec2 "+n+" = "+u([e.x,e.y])+";\n",o=0;o<w.varmodes.length;++o){var s=w.varmodes[o],a=g(this,o);a&&(i+="\t"+n+"."+s+" = "+a+";\n")}for(o=0;o<w.varmodes.length;++o){s=w.varmodes[o];var l=_(this,o);if(l){var p=r[s.length-1];i+="\t"+p+" "+l+" = "+n+"."+s+";\n",this.setOutputData(o,p)}}t.addCode("code",i,this.shader_destination)}},d("const/vec2",w),E.title="vec3",E.varmodes=["xyz","x","y","z","xy","xz","yz"],E.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},E.prototype.onGetCode=function(t){if(this.shader_destination){for(var e=this.properties,n=f(this),i="vec3 "+n+" = "+u([e.x,e.y,e.z])+";\n",o=0;o<E.varmodes.length;++o){var s=E.varmodes[o],a=g(this,o);a&&(i+="\t"+n+"."+s+" = "+a+";\n")}for(o=0;o<E.varmodes.length;++o){s=E.varmodes[o];var l=_(this,o);if(l){var p=r[s.length-1];i+="\t"+p+" "+l+" = "+n+"."+s+";\n",this.setOutputData(o,p)}}t.addCode("code",i,this.shader_destination)}},d("const/vec3",E),C.title="vec4",C.varmodes=["xyzw","xyz","x","y","z","w","xy","yz","zw"],C.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},C.prototype.onGetCode=function(t){if(this.shader_destination){for(var e=this.properties,n=f(this),i="vec4 "+n+" = "+u([e.x,e.y,e.z,e.w])+";\n",o=0;o<C.varmodes.length;++o){var s=C.varmodes[o],a=g(this,o);a&&(i+="\t"+n+"."+s+" = "+a+";\n")}for(o=0;o<C.varmodes.length;++o){s=C.varmodes[o];var l=_(this,o);if(l){var p=r[s.length-1];i+="\t"+p+" "+l+" = "+n+"."+s+";\n",this.setOutputData(o,p)}}t.addCode("code",i,this.shader_destination)}},d("const/vec4",C),T.title="FragColor",T.desc="Pixel final color",T.prototype.onGetCode=function(t){var e=g(this,0);if(e){var n=this.getInputData(0),i=l(e,n,"vec4");t.addCode("fs_code","fragcolor = "+i+";")}},d("output/fragcolor",T),O.title="Operation",O.operations=["+","-","*","/"],O.prototype.getTitle=function(){return this.flags.collapsed?"A"+this.properties.operation+"B":"Operation"},O.prototype.onGetCode=function(t){if(this.shader_destination&&this.isOutputConnected(0)){for(var e=[],n=0;n<3;++n)e.push({name:g(this,n),type:this.getInputData(n)||"float"});var i=_(this,0);if(i){var r=e[0].type,o=r,s=this.properties.operation,a=[];for(n=0;n<2;++n){var u=e[n].name;null==u&&(u=null!=p.value?p.value:"(1.0)",e[n].type="float"),e[n].type!=r&&("float"!=e[n].type||"*"!=s&&"/"!=s)&&(u=h(u,e[n].type,r)),a.push(u)}t.addCode("code",o+" "+i+" = "+a[0]+s+a[1]+";",this.shader_destination),this.setOutputData(0,o)}}},d("math/operation",O),S.title="Func",S.prototype.onPropertyChanged=function(t,e){if(this.graph&&this.graph._version++,"func"==t){var n=s[e];if(!n)return;for(var r=n.params.length;r<this.inputs.length;++r)this.removeInput(r);for(r=0;r<n.params.length;++r){var o=n.params[r];this.inputs[r]?this.inputs[r].name=o.name+(o.value?" ("+o.value+")":""):this.addInput(o.name,i.ALL_TYPES)}}},S.prototype.getTitle=function(){return this.flags.collapsed?this.properties.func:"Func"},S.prototype.onGetCode=function(t){if(this.shader_destination&&this.isOutputConnected(0)){for(var e=[],n=0;n<3;++n)e.push({name:g(this,n),type:this.getInputData(n)||"float"});var i=_(this,0);if(i){var r=s[this.properties.func];if(r){var o=e[0].type,a=r.return_type;"T"==a&&(a=o);var u=[];for(n=0;n<r.params.length;++n){var l=r.params[n],p=e[n].name;null==p&&(p=null!=l.value?l.value:"(1.0)",e[n].type="float"),("T"==l.type&&e[n].type!=o||"T"!=l.type&&e[n].type!=o)&&(p=h(p,e[n].type,o)),u.push(p)}t.addFunction("round","float round(float v){ return floor(v+0.5); }\nvec2 round(vec2 v){ return floor(v+vec2(0.5));}\nvec3 round(vec3 v){ return floor(v+vec3(0.5));}\nvec4 round(vec4 v){ return floor(v+vec4(0.5)); }\n"),t.addCode("code",a+" "+i+" = "+r.func+"("+u.join(",")+");",this.shader_destination),this.setOutputData(0,a)}}}},d("math/func",S),I.title="Snippet",I.prototype.onPropertyChanged=function(t,e){this.graph&&this.graph._version++,"type"==t&&this.outputs[0].type!=e&&(this.disconnectOutput(0),this.outputs[0].type=e)},I.prototype.getTitle=function(){return this.flags.collapsed?this.properties.code:"Snippet"},I.prototype.onGetCode=function(t){if(this.shader_destination&&this.isOutputConnected(0)){var e=g(this,0);e||(e="1.0");var n=g(this,1);n||(n="1.0");var i=_(this,0);if(i){var r=this.getInputData(0)||"float",o=this.getInputData(1)||"float",s=this.properties.type;if("T"==r||"T"==o)return null;var a="funcSnippet"+this.id,u="\n"+s+" "+a+"( "+r+" A, "+o+" B) {\n";u+="\t"+s+" C = "+s+"(0.0);\n",u+="\t"+this.properties.code+";\n",u+="\treturn C;\n}\n",t.addCode("functions",u,this.shader_destination),t.addCode("code",s+" "+i+" = "+a+"("+e+","+n+");",this.shader_destination),this.setOutputData(0,s)}}},d("utils/snippet",I),L.title="Rand",L.prototype.onGetCode=function(t){if(this.shader_destination&&this.isOutputConnected(0)){var e=_(this,0);t.addUniform("u_rand"+this.id,"float",(function(){return Math.random()})),t.addCode("code","float "+e+" = u_rand"+this.id+";",this.shader_destination),this.setOutputData(0,"float")}},d("input/rand",L),N.NOISE_TYPES=["noise","rand"],N.title="noise",N.prototype.onGetCode=function(t){if(this.shader_destination&&this.isOutputConnected(0)){var e=g(this,0),n=_(this,0),i=this.getInputData(0);e||(i="vec2",e=t.buffer_names.uvs),t.addFunction("noise",N.shader_functions),t.addUniform("u_noise_scale"+this.id,"float",this.properties.scale),"float"==i?t.addCode("code","float "+n+" = snoise( vec2("+e+") * u_noise_scale"+this.id+");",this.shader_destination):"vec2"==i||"vec3"==i?t.addCode("code","float "+n+" = snoise("+e+" * u_noise_scale"+this.id+");",this.shader_destination):"vec4"==i&&t.addCode("code","float "+n+" = snoise("+e+".xyz * u_noise_scale"+this.id+");",this.shader_destination),this.setOutputData(0,"float")}},d("math/noise",N),N.shader_functions="\nvec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }\n\nfloat snoise(vec2 v){\n  const vec4 C = vec4(0.211324865405187, 0.366025403784439,-0.577350269189626, 0.024390243902439);\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n  vec2 i1;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n  i = mod(i, 289.0);\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n  + i.x + vec3(0.0, i1.x, 1.0 ));\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\nvec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\nvec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\n\nfloat snoise(vec3 v){ \n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //  x0 = x0 - 0. + 0.0 * C \n  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\n// Permutations\n  i = mod(i, 289.0 ); \n  vec4 p = permute( permute( permute( \n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients\n// ( N*N points uniformly over a square, mapped onto an octahedron.)\n  float n_ = 1.0/7.0; // N=7\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),dot(p2,x2), dot(p3,x3) ) );\n}\n\nvec3 hash3( vec2 p ){\n    vec3 q = vec3( dot(p,vec2(127.1,311.7)), \n\t\t\t\t   dot(p,vec2(269.5,183.3)), \n\t\t\t\t   dot(p,vec2(419.2,371.9)) );\n\treturn fract(sin(q)*43758.5453);\n}\nvec4 hash4( vec3 p ){\n    vec4 q = vec4( dot(p,vec3(127.1,311.7,257.3)), \n\t\t\t\t   dot(p,vec3(269.5,183.3,335.1)), \n\t\t\t\t   dot(p,vec3(314.5,235.1,467.3)), \n\t\t\t\t   dot(p,vec3(419.2,371.9,114.9)) );\n\treturn fract(sin(q)*43758.5453);\n}\n\nfloat iqnoise( in vec2 x, float u, float v ){\n    vec2 p = floor(x);\n    vec2 f = fract(x);\n\t\n\tfloat k = 1.0+63.0*pow(1.0-v,4.0);\n\t\n\tfloat va = 0.0;\n\tfloat wt = 0.0;\n    for( int j=-2; j<=2; j++ )\n    for( int i=-2; i<=2; i++ )\n    {\n        vec2 g = vec2( float(i),float(j) );\n\t\tvec3 o = hash3( p + g )*vec3(u,u,1.0);\n\t\tvec2 r = g - f + o.xy;\n\t\tfloat d = dot(r,r);\n\t\tfloat ww = pow( 1.0-smoothstep(0.0,1.414,sqrt(d)), k );\n\t\tva += o.z*ww;\n\t\twt += ww;\n    }\n\t\n    return va/wt;\n}\n",D.title="Time",D.prototype.onGetCode=function(t){if(this.shader_destination&&this.isOutputConnected(0)){var e=_(this,0);t.addUniform("u_time"+this.id,"float",(function(){return.001*getTime()})),t.addCode("code","float "+e+" = u_time"+this.id+";",this.shader_destination),this.setOutputData(0,"float")}},d("input/time",D),k.title="Dither",k.prototype.onGetCode=function(t){if(this.shader_destination&&this.isOutputConnected(0)){var e=g(this,0),n="float",i=_(this,0),r=this.getInputData(0);e=l(e,r,"float"),t.addFunction("dither8x8",k.dither_func),t.addCode("code",n+" "+i+" = dither8x8("+e+");",this.shader_destination),this.setOutputData(0,n)}},k.dither_values=[.515625,.140625,.640625,.046875,.546875,.171875,.671875,.765625,.265625,.890625,.390625,.796875,.296875,.921875,.421875,.203125,.703125,.078125,.578125,.234375,.734375,.109375,.609375,.953125,.453125,.828125,.328125,.984375,.484375,.859375,.359375,.0625,.5625,.1875,.6875,.03125,.53125,.15625,.65625,.8125,.3125,.9375,.4375,.78125,.28125,.90625,.40625,.25,.75,.125,.625,.21875,.71875,.09375,.59375,1.0001,.5,.875,.375,.96875,.46875,.84375,.34375],k.dither_func="\n\t\tfloat dither8x8(float brightness) {\n\t\t  vec2 position = vec2(0.0);\n\t\t  #ifdef FRAGMENT\n\t\t\tposition = gl_FragCoord.xy;\n\t\t  #endif\n\t\t  int x = int(mod(position.x, 8.0));\n\t\t  int y = int(mod(position.y, 8.0));\n\t\t  int index = x + y * 8;\n\t\t  float limit = 0.0;\n\t\t  if (x < 8) {\n\t\t\tif(index==0) limit = 0.015625;\n\t\t\t"+k.dither_values.map((function(t,e){return"else if(index== "+(e+1)+") limit = "+t+";"})).join("\n")+"\n\t\t  }\n\t\t  return brightness < limit ? 0.0 : 1.0;\n\t\t}\n",d("math/dither",k),G.title="Remap",G.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},G.prototype.onConnectionsChange=function(){var t=this.getInputDataType(0);this.outputs[0].type=t||"T"},G.prototype.onGetCode=function(t){if(this.shader_destination&&this.isOutputConnected(0)){var e=g(this,0),n=_(this,0);if(e||n){var i=this.getInputDataType(0);if(this.outputs[0].type=i,"T"!=i)if(e){var r=u(this.properties.min_value),o=u(this.properties.max_value),s=u(this.properties.min_value2),a=u(this.properties.max_value2);t.addCode("code",i+" "+n+" = ( ("+e+" - "+r+") / ("+o+" - "+r+") ) * ("+a+" - "+s+") + "+s+";",this.shader_destination),this.setOutputData(0,i)}else t.addCode("code","\t"+i+" "+n+" = "+i+"(0.0);\n");else console.warn("node type is T and cannot be resolved")}}},d("math/remap",G)}function c(){for(var t in a.length=0,o){var e=o[t],n=e.indexOf(" "),i=e.substr(0,n),r=e.indexOf("(",n),u=e.substr(n,r-n).trim(),l=e.substr(r+1,e.length-r-2).split(",");for(var p in l){var h=l[p].split(" ").filter((function(t){return t}));l[p]={type:h[0].trim(),name:h[1].trim()},"="==h[2]&&(l[p].value=h[3].trim())}s[t]={return_type:i,func:u,params:l},a.push(u)}}function d(t,i){i.color=n,i.filter="shader",i.prototype.clearDestination=function(){this.shader_destination={}},i.prototype.propagateDestination=function(t){if(this.shader_destination[t]=!0,this.inputs)for(var e=0;e<this.inputs.length;++e){var n=this.getInputNode(e);n&&n.propagateDestination(t)}},i.prototype.onPropertyChanged||(i.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++}),e.registerNodeType("shader::"+t,i)}function f(t,e){return"VAR_"+(e||"TEMP")+"_"+t.id}function g(t,e){if(!t.inputs)return null;var n=t.getInputLink(e);if(!n)return null;var i=t.graph.getNodeById(n.origin_id);return i?i.getOutputVarName?i.getOutputVarName(n.origin_slot):"link_"+i.id+"_"+n.origin_slot:null}function _(t,e){return t.isOutputConnected(e)?"link_"+t.id+"_"+e:null}function v(){this.vs_template="",this.fs_template="",this.buffer_names={uvs:"v_coord"},this.extra={},this._functions={},this._uniforms={},this._codeparts={},this._uniform_value=null}function m(){this.subgraph=new e.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.filter="shader",this.addInput("in","texture"),this.addOutput("out","texture"),this.properties={width:0,height:0,alpha:!1,precision:"undefined"!=typeof LGraphTexture?LGraphTexture.DEFAULT:2};var t=this.subgraph.findNodesByType("shader::input/uniform")[0];t.pos=[200,300];var n=e.createNode("shader::texture/sampler2D");n.pos=[400,300],this.subgraph.add(n);var i=e.createNode("shader::output/fragcolor");i.pos=[600,300],this.subgraph.add(i),t.connect(0,n),n.connect(0,i),this.size=[180,60],this.redraw_on_mouse=!0,this._uniforms={},this._shader=null,this._context=new v,this._context.vs_template="#define VERTEX\n"+GL.Shader.SCREEN_VERTEX_SHADER,this._context.fs_template=m.template}function y(){this.addOutput("out",""),this.properties={name:"",type:""}}function b(){this.addOutput("out","vec2"),this.properties={name:"coord",type:"vec2"}}function x(){this.addInput("tex","sampler2D"),this.addInput("uv","vec2"),this.addOutput("rgba","vec4"),this.addOutput("rgb","vec3")}function A(){this.addOutput("","float"),this.properties={type:"float",value:0},this.addWidget("combo","type","float",null,{values:r,property:"type"}),this.updateWidgets()}function w(){this.addInput("xy","vec2"),this.addInput("x","float"),this.addInput("y","float"),this.addOutput("xy","vec2"),this.addOutput("x","float"),this.addOutput("y","float"),this.properties={x:0,y:0}}function E(){this.addInput("xyz","vec3"),this.addInput("x","float"),this.addInput("y","float"),this.addInput("z","float"),this.addInput("xy","vec2"),this.addInput("xz","vec2"),this.addInput("yz","vec2"),this.addOutput("xyz","vec3"),this.addOutput("x","float"),this.addOutput("y","float"),this.addOutput("z","float"),this.addOutput("xy","vec2"),this.addOutput("xz","vec2"),this.addOutput("yz","vec2"),this.properties={x:0,y:0,z:0}}function C(){this.addInput("xyzw","vec4"),this.addInput("xyz","vec3"),this.addInput("x","float"),this.addInput("y","float"),this.addInput("z","float"),this.addInput("w","float"),this.addInput("xy","vec2"),this.addInput("yz","vec2"),this.addInput("zw","vec2"),this.addOutput("xyzw","vec4"),this.addOutput("xyz","vec3"),this.addOutput("x","float"),this.addOutput("y","float"),this.addOutput("z","float"),this.addOutput("xy","vec2"),this.addOutput("yz","vec2"),this.addOutput("zw","vec2"),this.properties={x:0,y:0,z:0,w:0}}function T(){this.addInput("color",i.ALL_TYPES),this.block_delete=!0}function O(){this.addInput("A",i.ALL_TYPES),this.addInput("B",i.ALL_TYPES),this.addOutput("out",""),this.properties={operation:"*"},this.addWidget("combo","op.",this.properties.operation,{property:"operation",values:O.operations})}function S(){this.addInput("A",i.ALL_TYPES),this.addInput("B",i.ALL_TYPES),this.addOutput("out",""),this.properties={func:"floor"},this._current="floor",this.addWidget("combo","func",this.properties.func,{property:"func",values:a})}function I(){this.addInput("A",i.ALL_TYPES),this.addInput("B",i.ALL_TYPES),this.addOutput("C","vec4"),this.properties={code:"C = A+B",type:"vec4"},this.addWidget("text","code",this.properties.code,{property:"code"}),this.addWidget("combo","type",this.properties.type,{values:["float","vec2","vec3","vec4"],property:"type"})}function L(){this.addOutput("out","float")}function N(){this.addInput("out",i.ALL_TYPES),this.addInput("scale","float"),this.addOutput("out","float"),this.properties={type:"noise",scale:1},this.addWidget("combo","type",this.properties.type,{property:"type",values:N.NOISE_TYPES}),this.addWidget("number","scale",this.properties.scale,{property:"scale"})}function D(){this.addOutput("out","float")}function k(){this.addInput("in","T"),this.addOutput("out","float")}function G(){this.addInput("",i.ALL_TYPES),this.addOutput("",""),this.properties={min_value:0,max_value:1,min_value2:0,max_value2:1},this.addWidget("number","min",0,{step:.1,property:"min_value"}),this.addWidget("number","max",1,{step:.1,property:"max_value"}),this.addWidget("number","min2",0,{step:.1,property:"min_value2"}),this.addWidget("number","max2",1,{step:.1,property:"max_value2"})}}(this),function(t){var e=t.LiteGraph,n=new Float32Array(16),r=new Float32Array(16),o=new Float32Array(16),s=new Float32Array(16),a={u_view:n,u_projection:r,u_viewprojection:o,u_model:s};function u(){return 1e5*Math.random()|0}function l(){this.addInput("obj",""),this.addInput("radius","number"),this.addOutput("out","geometry"),this.addOutput("points","[vec3]"),this.properties={radius:1,num_points:4096,generate_normals:!0,regular:!1,mode:l.SPHERE,force_update:!1},this.points=new Float32Array(3*this.properties.num_points),this.normals=new Float32Array(3*this.properties.num_points),this.must_update=!0,this.version=0;var t=this;this.addWidget("button","update",null,(function(){t.must_update=!0})),this.geometry={vertices:null,_id:u()},this._old_obj=null,this._last_radius=null}function p(t,e){var n=t.length,i=0,r=0,o=n;if(0==n)return-1;if(1==n)return 0;for(;o>=i;){var s=t[r=.5*(o+i)|0];if(s==e)return r;if(i==o-1)return i;s<e?i=r:o=r}return r}function h(){this.addInput("points","geometry"),this.addOutput("instances","[mat4]"),this.properties={mode:1,autoupdate:!0},this.must_update=!0,this.matrices=[],this.first_time=!0}function c(){this.addInput("in","geometry,[mat4]"),this.addInput("mat4","mat4"),this.addOutput("out","geometry"),this.properties={},this.geometry={type:"triangles",vertices:null,_id:u(),_version:0},this._last_geometry_id=-1,this._last_version=-1,this._last_key="",this.must_update=!0}function d(){this.addInput("sides","number"),this.addInput("radius","number"),this.addOutput("out","geometry"),this.properties={sides:6,radius:1,uvs:!1},this.geometry={type:"line_loop",vertices:null,_id:u()},this.geometry_id=-1,this.version=-1,this.must_update=!0,this.last_info={sides:-1,radius:-1}}function f(){this.addInput("","geometry"),this.addOutput("","geometry"),this.properties={top_cap:!0,bottom_cap:!0,offset:[0,100,0]},this.version=-1,this._last_geo_version=-1,this._must_update=!0}function g(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={code:"V[1] += 0.01 * Math.sin(I + T*0.001);",execute_every_frame:!1},this.geometry=null,this.geometry_id=-1,this.version=-1,this.must_update=!0,this.vertices=null,this.func=null}function _(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={min_dist:.4,max_dist:.5,max_connections:0,probability:1},this.geometry_id=-1,this.version=-1,this.my_version=1,this.must_update=!0}function v(){this.addInput("mesh","mesh"),this.addOutput("out","geometry"),this.geometry={},this.last_mesh=null}function m(){this.addInput("in","geometry"),this.addOutput("mesh","mesh"),this.properties={},this.version=-1,this.mesh=null}function y(){this.addInput("mesh","mesh"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,primitive:GL.TRIANGLES,additive:!1,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.model_matrix=mat4.create(),this.uniforms={u_color:this.color,u_model:this.model_matrix}}function b(){this.addInput("size","number"),this.addOutput("out","mesh"),this.properties={type:1,size:1,subdivisions:32},this.version=1e5*Math.random()|0,this.last_info={type:-1,size:-1,subdivisions:-1}}function x(){this.addInput("in","geometry"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,point_size:.1,fixed_size:!1,additive:!0,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.uniforms={u_point_size:1,u_perspective:1,u_point_perspective:1,u_color:this.color},this.geometry_id=-1,this.version=-1,this.mesh=null}e.LGraphRender={onRequestCameraMatrices:null},t.LGraphPoints3D=l,l.RECTANGLE=1,l.CIRCLE=2,l.CUBE=10,l.SPHERE=11,l.HEMISPHERE=12,l.INSIDE_SPHERE=13,l.OBJECT=20,l.OBJECT_UNIFORMLY=21,l.OBJECT_INSIDE=22,l.MODE_VALUES={rectangle:l.RECTANGLE,circle:l.CIRCLE,cube:l.CUBE,sphere:l.SPHERE,hemisphere:l.HEMISPHERE,inside_sphere:l.INSIDE_SPHERE,object:l.OBJECT,object_uniformly:l.OBJECT_UNIFORMLY,object_inside:l.OBJECT_INSIDE},l.widgets_info={mode:{widget:"combo",values:l.MODE_VALUES}},l.title="list of points",l.desc="returns an array of points",l.prototype.onPropertyChanged=function(t,e){this.must_update=!0},l.prototype.onExecute=function(){var t=this.getInputData(0);(t!=this._old_obj||t&&t._version!=this._old_obj_version)&&(this._old_obj=t,this.must_update=!0);var e=this.getInputData(1);null==e&&(e=this.properties.radius),this._last_radius!=e&&(this._last_radius=e,this.must_update=!0),(this.must_update||this.properties.force_update)&&(this.must_update=!1,this.updatePoints()),this.geometry.vertices=this.points,this.geometry.normals=this.normals,this.geometry._version=this.version,this.setOutputData(0,this.geometry)},l.prototype.updatePoints=function(){var t=0|this.properties.num_points;t<1&&(t=1),this.points&&this.points.length==3*t||(this.points=new Float32Array(3*t)),this.properties.generate_normals?this.normals&&this.normals.length==this.points.length||(this.normals=new Float32Array(this.points.length)):this.normals=null;var e=this._last_radius||this.properties.radius,n=this.properties.mode,i=this.getInputData(0);this._old_obj_version=i?i._version:null,this.points=l.generatePoints(e,t,n,this.points,this.normals,this.properties.regular,i),this.version++},l.generatePoints=function(t,e,n,i,r,o,s){var a=3*e;i&&i.length==a||(i=new Float32Array(a));var u=new Float32Array(3),p=new Float32Array([0,1,0]);if(o){if(n==l.RECTANGLE){for(var h=Math.floor(Math.sqrt(e)),c=0;c<h;++c)for(var d=0;d<h;++d)i[f=3*c+3*d*h]=(c/h-.5)*t*2,i[f+1]=0,i[f+2]=(d/h-.5)*t*2;if(i=new Float32Array(i.subarray(0,h*h*3)),r)for(c=0;c<r.length;c+=3)r.set(p,c)}else if(n==l.SPHERE){for(h=Math.floor(Math.sqrt(e)),c=0;c<h;++c)for(d=0;d<h;++d){var f=3*c+3*d*h;polarToCartesian(u,c/h*2*Math.PI,2*(d/h-.5)*Math.PI,t),i[f]=u[0],i[f+1]=u[1],i[f+2]=u[2]}i=new Float32Array(i.subarray(0,h*h*3)),r&&l.generateSphericalNormals(i,r)}else if(n==l.CIRCLE){for(c=0;c<a;c+=3){var g=2*Math.PI*(c/a);i[c]=Math.cos(g)*t,i[c+1]=0,i[c+2]=Math.sin(g)*t}if(r)for(c=0;c<r.length;c+=3)r.set(p,c)}}else if(n==l.RECTANGLE){for(c=0;c<a;c+=3)i[c]=(Math.random()-.5)*t*2,i[c+1]=0,i[c+2]=(Math.random()-.5)*t*2;if(r)for(c=0;c<r.length;c+=3)r.set(p,c)}else if(n==l.CUBE){for(c=0;c<a;c+=3)i[c]=(Math.random()-.5)*t*2,i[c+1]=(Math.random()-.5)*t*2,i[c+2]=(Math.random()-.5)*t*2;if(r)for(c=0;c<r.length;c+=3)r.set(p,c)}else n==l.SPHERE?(l.generateSphere(i,a,t),r&&l.generateSphericalNormals(i,r)):n==l.HEMISPHERE?(l.generateHemisphere(i,a,t),r&&l.generateSphericalNormals(i,r)):n==l.CIRCLE?(l.generateInsideCircle(i,a,t),r&&l.generateSphericalNormals(i,r)):n==l.INSIDE_SPHERE?(l.generateInsideSphere(i,a,t),r&&l.generateSphericalNormals(i,r)):n==l.OBJECT?l.generateFromObject(i,r,a,s,!1):n==l.OBJECT_UNIFORMLY?l.generateFromObject(i,r,a,s,!0):n==l.OBJECT_INSIDE?l.generateFromInsideObject(i,a,s):console.warn("wrong mode in LGraphPoints3D");return i},l.generateSphericalNormals=function(t,e){for(var n=new Float32Array(3),i=0;i<e.length;i+=3)n[0]=t[i],n[1]=t[i+1],n[2]=t[i+2],vec3.normalize(n,n),e.set(n,i)},l.generateSphere=function(t,e,n){for(var i=0;i<e;i+=3){var r=Math.random(),o=Math.random(),s=2*Math.cos(2*Math.PI*r)*Math.sqrt(o*(1-o)),a=1-2*o,u=2*Math.sin(2*Math.PI*r)*Math.sqrt(o*(1-o));t[i]=s*n,t[i+1]=a*n,t[i+2]=u*n}},l.generateHemisphere=function(t,e,n){for(var i=0;i<e;i+=3){var r=Math.random(),o=Math.random(),s=Math.cos(2*Math.PI*r)*Math.sqrt(1-o*o),a=o,u=Math.sin(2*Math.PI*r)*Math.sqrt(1-o*o);t[i]=s*n,t[i+1]=a*n,t[i+2]=u*n}},l.generateInsideCircle=function(t,e,n){for(var i=0;i<e;i+=3){var r=Math.random(),o=Math.random(),s=Math.cos(2*Math.PI*r)*Math.sqrt(1-o*o),a=Math.sin(2*Math.PI*r)*Math.sqrt(1-o*o);t[i]=s*n,t[i+1]=0,t[i+2]=a*n}},l.generateInsideSphere=function(t,e,n){for(var i=0;i<e;i+=3){var r=Math.random(),o=Math.random(),s=2*r*Math.PI,a=Math.acos(2*o-1),u=Math.cbrt(Math.random())*n,l=Math.sin(s),p=Math.cos(s),h=Math.sin(a),c=Math.cos(a);t[i]=u*h*p,t[i+1]=u*h*l,t[i+2]=u*c}},l.generateFromObject=function(t,e,n,i,r){if(i){var o=null,s=null,a=null,u=null;if(i.constructor===GL.Mesh&&(o=i.vertexBuffers.vertices.data,s=i.vertexBuffers.normals?i.vertexBuffers.normals.data:null,(a=i.indexBuffers.indices?i.indexBuffers.indices.data:null)||(a=i.indexBuffers.triangles?i.indexBuffers.triangles.data:null)),!o)return null;var l=a?a.length/3:o.length/9,h=0;if(r){u=new Float32Array(l);for(var c=0;c<l;++c){a?(A=3*a[3*c],w=3*a[3*c+1],E=3*a[3*c+2]):(A=9*c,w=9*c+3,E=9*c+6);var d=o.subarray(A,A+3),f=o.subarray(w,w+3),g=o.subarray(E,E+3),_=vec3.distance(d,f),v=vec3.distance(f,g),m=vec3.distance(g,d),y=(_+v+m)/2;h+=Math.sqrt(y*(y-_)*(y-v)*(y-m)),u[c]=h}for(c=0;c<l;++c)u[c]/=h}for(c=0;c<n;c+=3){var b=Math.random(),x=r?p(u,b):Math.floor(b*l),A=0,w=0,E=0;a?(A=3*a[3*x],w=3*a[3*x+1],E=3*a[3*x+2]):(A=9*x,w=9*x+3,E=9*x+6),y=Math.random();var C=Math.random(),T=Math.sqrt(y),O=1-T,S=T*(1-C),I=C*T;if(t[c]=O*o[A]+S*o[w]+I*o[E],t[c+1]=O*o[A+1]+S*o[w+1]+I*o[E+1],t[c+2]=O*o[A+2]+S*o[w+2]+I*o[E+2],e&&s){e[c]=O*s[A]+S*s[w]+I*s[E],e[c+1]=O*s[A+1]+S*s[w+1]+I*s[E+1],e[c+2]=O*s[A+2]+S*s[w+2]+I*s[E+2];var L=e.subarray(c,c+3);vec3.normalize(L,L)}}}},l.generateFromInsideObject=function(t,e,n){if(n&&n.constructor===GL.Mesh){var i=n.getBoundingBox();n.octree||(n.octree=new GL.Octree(n));for(var r=n.octree,o=vec3.create(),s=vec3.fromValues(1,0,0),a=vec3.create(),u=0,l=0;u<e&&l<10*t.length;){l+=1;var p=vec3.random(a);p[0]=(2*p[0]-1)*i[3]+i[0],p[1]=(2*p[1]-1)*i[4]+i[1],p[2]=(2*p[2]-1)*i[5]+i[2],o.set(p);var h=r.testRay(o,s,0,1e4,!0,GL.Octree.ALL);h&&h.length%2!=0&&(t.set(p,u),u+=3)}}},e.registerNodeType("geometry/points3D",l),h.NORMAL=0,h.VERTICAL=1,h.SPHERICAL=2,h.RANDOM=3,h.RANDOM_VERTICAL=4,h.modes={normal:0,vertical:1,spherical:2,random:3,random_vertical:4},h.widgets_info={mode:{widget:"combo",values:h.modes}},h.title="points to inst",h.prototype.onExecute=function(){var t=this.getInputData(0);t?this.isOutputConnected(0)&&(((t._version!=this._version||t._id!=this._geometry_id)&&this.properties.autoupdate||this.first_time)&&(this.first_time=!1,this.updateInstances(t)),this.setOutputData(0,this.matrices)):this.setOutputData(0,null)},h.prototype.updateInstances=function(t){var e=t.vertices;if(!e)return null;var n=t.normals,i=this.matrices,r=e.length/3;i.length!=r&&(i.length=r);for(var o=mat4.create(),s=vec3.create(),a=(vec3.create(),vec3.fromValues(0,1,0)),u=vec3.fromValues(0,0,-1),l=(vec3.fromValues(1,0,0),quat.create()),p=vec3.create(),c=vec3.create(),d=vec3.create(),f=0;f<e.length;f+=3){var g=f/3,_=i[g];_||(_=i[g]=mat4.create()),_.set(o);var v=e.subarray(f,f+3);switch(this.properties.mode){case h.NORMAL:if(mat4.setTranslation(_,v),n){var m=n.subarray(f,f+3);d.set(m),vec3.normalize(d,d),vec3.cross(c,u,d),vec3.normalize(c,c),vec3.cross(p,c,d),vec3.normalize(p,p),_.set(c,0),_.set(d,4),_.set(p,8),mat4.setTranslation(_,v)}break;case h.VERTICAL:mat4.setTranslation(_,v);break;case h.SPHERICAL:p.set(v),vec3.normalize(p,p),vec3.cross(c,a,p),vec3.normalize(c,c),vec3.cross(d,p,c),vec3.normalize(d,d),_.set(c,0),_.set(d,4),_.set(p,8),mat4.setTranslation(_,v);break;case h.RANDOM:s[0]=2*Math.random()-1,s[1]=2*Math.random()-1,s[2]=2*Math.random()-1,vec3.normalize(s,s),quat.setAxisAngle(l,s,2*Math.random()*Math.PI),mat4.fromQuat(_,l),mat4.setTranslation(_,v);break;case h.RANDOM_VERTICAL:quat.setAxisAngle(l,a,2*Math.random()*Math.PI),mat4.fromQuat(_,l),mat4.setTranslation(_,v)}}this._version=t._version,this._geometry_id=t._id},e.registerNodeType("geometry/points_to_instances",h),c.title="Transform",c.prototype.onExecute=function(){var t=this.getInputData(0),e=this.getInputData(1);if(t)if(t.constructor!==Array){if(t.vertices&&t.vertices.length){var n=t;if(this.outputs[0].type="geometry",this.isOutputConnected(0))if(e){var i=typedArrayToArray(e).join(",");(this.must_update||n._id!=this._last_geometry_id||n._version!=this._last_version||i!=this._last_key)&&(this.updateGeometry(n,e),this._last_key=i,this._last_version=n._version,this._last_geometry_id=n._id,this.must_update=!1),this.setOutputData(0,this.geometry)}else this.setOutputData(0,n)}}else{if(0==t.length)return;if(this.outputs[0].type="[mat4]",!this.isOutputConnected(0))return;if(!e)return void this.setOutputData(0,t);this._output||(this._output=new Array),this._output.length!=t.length&&(this._output.length=t.length);for(var r=0;r<t.length;++r){var o=this._output[r];o||(o=this._output[r]=mat4.create()),mat4.multiply(o,t[r],e)}this.setOutputData(0,this._output)}},c.prototype.updateGeometry=function(t,e){var n=t.vertices,i=this.geometry.vertices;i&&i.length==n.length||(i=this.geometry.vertices=new Float32Array(n.length));for(var r=vec3.create(),o=0,s=i.length;o<s;o+=3)r[0]=n[o],r[1]=n[o+1],r[2]=n[o+2],mat4.multiplyVec3(r,e,r),i[o]=r[0],i[o+1]=r[1],i[o+2]=r[2];if(t.normals){this.geometry.normals&&this.geometry.normals.length==t.normals.length||(this.geometry.normals=new Float32Array(t.normals.length));var a=this.geometry.normals,u=mat4.invert(mat4.create(),e);u&&mat4.transpose(u,u);var l=t.normals;for(o=0,s=a.length;o<s;o+=3)r[0]=l[o],r[1]=l[o+1],r[2]=l[o+2],mat4.multiplyVec3(r,u,r),a[o]=r[0],a[o+1]=r[1],a[o+2]=r[2]}this.geometry.type=t.type,this.geometry._version++},e.registerNodeType("geometry/transform",c),d.title="Polygon",d.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=this.getInputOrProperty("sides"),e=this.getInputOrProperty("radius");t=0|Math.max(3,t),this.last_info.sides==t&&this.last_info.radius==e||this.updateGeometry(t,e),this.setOutputData(0,this.geometry)}},d.prototype.updateGeometry=function(t,e){var n=3*t,i=this.geometry.vertices;i&&i.length==n||(i=this.geometry.vertices=new Float32Array(3*t));var r=2*Math.PI/t;this.properties.uvs&&(uvs=this.geometry.coords=new Float32Array(3*t));for(var o=0;o<t;++o){var s=r*-o,a=Math.cos(s)*e,u=Math.sin(s)*e;i[3*o]=a,i[3*o+1]=0,i[3*o+2]=u}this.geometry._id=++this.geometry_id,this.geometry._version=++this.version,this.last_info.sides=t,this.last_info.radius=e},e.registerNodeType("geometry/polygon",d),f.title="extrude",f.prototype.onPropertyChanged=function(t,e){this._must_update=!0},f.prototype.onExecute=function(){var t=this.getInputData(0);t&&this.isOutputConnected(0)&&((t.version!=this._last_geo_version||this._must_update)&&(this._geo=this.extrudeGeometry(t,this._geo),this._geo&&(this._geo.version=this.version++),this._must_update=!1),this.setOutputData(0,this._geo))},f.prototype.extrudeGeometry=function(t){var e=t.vertices,n=e.length/3,i=vec3.create(),r=vec3.create(),o=vec3.create(),s=vec3.create(),a=new Float32Array(this.properties.offset);if("line_loop"==t.type)for(var l=new Float32Array(6*n*3),p=0,h=0,c=e.length;h<c;h+=3)i[0]=e[h],i[1]=e[h+1],i[2]=e[h+2],h+3<c?(r[0]=e[h+3],r[1]=e[h+4],r[2]=e[h+5]):(r[0]=e[0],r[1]=e[1],r[2]=e[2]),vec3.add(o,i,a),vec3.add(s,r,a),l.set(i,p),p+=3,l.set(r,p),p+=3,l.set(o,p),p+=3,l.set(r,p),p+=3,l.set(s,p),p+=3,l.set(o,p),p+=3;return{_id:u(),type:"triangles",vertices:l}},e.registerNodeType("geometry/extrude",f),g.title="geoeval",g.desc="eval code",g.widgets_info={code:{widget:"code"}},g.prototype.onConfigure=function(t){this.compileCode()},g.prototype.compileCode=function(){if(this.properties.code)try{this.func=new Function("V","I","T",this.properties.code),this.boxcolor="#AFA",this.must_update=!0}catch(t){this.boxcolor="red"}},g.prototype.onPropertyChanged=function(t,e){"code"==t&&(this.properties.code=e,this.compileCode())},g.prototype.onExecute=function(){var t=this.getInputData(0);if(t)if(this.func){if(this.geometry_id!=t._id||this.version!=t._version||this.must_update||this.properties.execute_every_frame){this.must_update=!1,this.geometry_id=t._id,this.properties.execute_every_frame?this.version++:this.version=t._version;var e=this.func,n=getTime();for(var i in this.geometry||(this.geometry={}),t)null!=t[i]&&(t[i].constructor==Float32Array?this.geometry[i]=new Float32Array(t[i]):this.geometry[i]=t[i]);this.geometry._id=t._id,this.properties.execute_every_frame?this.geometry._version=this.version:this.geometry._version=t._version+1;var r=vec3.create(),o=this.vertices;for(o&&this.vertices.length==t.vertices.length?o.set(t.vertices):o=this.vertices=new Float32Array(t.vertices),i=0;i<o.length;i+=3)r[0]=o[i],r[1]=o[i+1],r[2]=o[i+2],e(r,i/3,n),o[i]=r[0],o[i+1]=r[1],o[i+2]=r[2];this.geometry.vertices=o}this.setOutputData(0,this.geometry)}else this.setOutputData(0,t)},e.registerNodeType("geometry/eval",g),_.title="connect points",_.desc="adds indices between near points",_.prototype.onPropertyChanged=function(t,e){this.must_update=!0},_.prototype.onExecute=function(){var t=this.getInputData(0);if(t){if(this.geometry_id!=t._id||this.version!=t._version||this.must_update){for(var e in this.must_update=!1,this.geometry_id=t._id,this.version=t._version,this.geometry={},t)this.geometry[e]=t[e];this.geometry._id=u(),this.geometry._version=this.my_version++;var n=t.vertices,i=n.length,r=this.properties.min_dist,o=this.properties.max_dist,s=this.properties.probability,a=this.properties.max_connections,l=[];for(e=0;e<i;e+=3)for(var p=n[e],h=n[e+1],c=n[e+2],d=0,f=e+3;f<i;f+=3){var g=n[f],_=n[f+1],v=n[f+2],m=Math.sqrt((p-g)*(p-g)+(h-_)*(h-_)+(c-v)*(c-v));if(!(m>o||m<r||s<1&&s<Math.random())&&(l.push(e/3,f/3),d+=1,a&&d>a))break}this.geometry.indices=this.indices=new Uint32Array(l)}this.indices&&this.indices.length?(this.geometry.indices=this.indices,this.setOutputData(0,this.geometry)):this.setOutputData(0,null)}},e.registerNodeType("geometry/connectPoints",_),"undefined"!=typeof GL&&(v.title="to geometry",v.desc="converts a mesh to geometry",v.prototype.onExecute=function(){var t=this.getInputData(0);if(t){if(t!=this.last_mesh){for(i in this.last_mesh=t,t.vertexBuffers){var e=t.vertexBuffers[i];this.geometry[i]=e.data}t.indexBuffers.triangles&&(this.geometry.indices=t.indexBuffers.triangles.data),this.geometry._id=u(),this.geometry._version=0}this.setOutputData(0,this.geometry),this.geometry&&this.setOutputData(1,this.geometry.vertices)}},e.registerNodeType("geometry/toGeometry",v),m.title="Geo to Mesh",m.prototype.updateMesh=function(t){for(var e in this.mesh||(this.mesh=new GL.Mesh),t)if("_"!=e[0]){var n=t[e],i=GL.Mesh.common_buffers[e];if(i||"indices"==e){var r=i?i.spacing:3,o=this.mesh.vertexBuffers[e];o&&o.data.length==n.length?(o.data.set(n),o.upload(GL.DYNAMIC_DRAW)):o=new GL.Buffer("indices"==e?GL.ELEMENT_ARRAY_BUFFER:GL.ARRAY_BUFFER,n,r,GL.DYNAMIC_DRAW),this.mesh.addBuffer(e,o)}}if(this.mesh.vertexBuffers.normals&&this.mesh.vertexBuffers.normals.data.length!=this.mesh.vertexBuffers.vertices.data.length){var s=new Float32Array([0,1,0]),a=new Float32Array(this.mesh.vertexBuffers.vertices.data.length);for(e=0;e<a.length;e+=3)a.set(s,e);o=new GL.Buffer(GL.ARRAY_BUFFER,a,3),this.mesh.addBuffer("normals",o)}return this.mesh.updateBoundingBox(),this.geometry_id=this.mesh.id=t._id,this.version=this.mesh.version=t._version,this.mesh},m.prototype.onExecute=function(){var t=this.getInputData(0);t&&(this.version==t._version&&this.geometry_id==t._id||this.updateMesh(t),this.setOutputData(0,this.mesh))},e.registerNodeType("geometry/toMesh",m),y.title="Render Mesh",y.desc="renders a mesh flat",y.PRIMITIVE_VALUES={points:GL.POINTS,lines:GL.LINES,line_loop:GL.LINE_LOOP,line_strip:GL.LINE_STRIP,triangles:GL.TRIANGLES,triangle_fan:GL.TRIANGLE_FAN,triangle_strip:GL.TRIANGLE_STRIP},y.widgets_info={primitive:{widget:"combo",values:y.PRIMITIVE_VALUES},color:{widget:"color"}},y.prototype.onExecute=function(){if(this.properties.enabled){var t=this.getInputData(0);if(t)if(e.LGraphRender.onRequestCameraMatrices){e.LGraphRender.onRequestCameraMatrices(n,r,o);var i=null;this.getInputData(2)?(i=gl.shaders.textured)||(i=gl.shaders.textured=new GL.Shader(x.vertex_shader_code,x.fragment_shader_code,{USE_TEXTURE:""})):(i=gl.shaders.flat)||(i=gl.shaders.flat=new GL.Shader(x.vertex_shader_code,x.fragment_shader_code)),this.color.set(this.properties.color),this.color[3]=this.properties.opacity;var s=this.model_matrix,u=this.getInputData(1);u?s.set(u):mat4.identity(s),this.uniforms.u_point_size=1;var l=this.properties.primitive;i.uniforms(a),i.uniforms(this.uniforms),this.properties.opacity>=1?gl.disable(gl.BLEND):gl.enable(gl.BLEND),gl.enable(gl.DEPTH_TEST),this.properties.additive?(gl.blendFunc(gl.SRC_ALPHA,gl.ONE),gl.depthMask(!1)):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);var p="indices";t.indexBuffers.triangles&&(p="triangles"),i.draw(t,l,p),gl.disable(gl.BLEND),gl.depthMask(!0)}else console.warn("cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph")}},e.registerNodeType("geometry/render_mesh",y),b.title="Primitive",b.VALID={CUBE:1,PLANE:2,CYLINDER:3,SPHERE:4,CIRCLE:5,HEMISPHERE:6,ICOSAHEDRON:7,CONE:8,QUAD:9},b.widgets_info={type:{widget:"combo",values:b.VALID}},b.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=this.getInputOrProperty("size");this.last_info.type==this.properties.type&&this.last_info.size==t&&this.last_info.subdivisions==this.properties.subdivisions||this.updateMesh(this.properties.type,t,this.properties.subdivisions),this.setOutputData(0,this._mesh)}},b.prototype.updateMesh=function(t,e,n){switch(n=0|Math.max(0,n),t){case 1:this._mesh=GL.Mesh.cube({size:e,normals:!0,coords:!0});break;case 2:this._mesh=GL.Mesh.plane({size:e,xz:!0,detail:n,normals:!0,coords:!0});break;case 3:this._mesh=GL.Mesh.cylinder({size:e,subdivisions:n,normals:!0,coords:!0});break;case 4:this._mesh=GL.Mesh.sphere({size:e,long:n,lat:n,normals:!0,coords:!0});break;case 5:this._mesh=GL.Mesh.circle({size:e,slices:n,normals:!0,coords:!0});break;case 6:this._mesh=GL.Mesh.sphere({size:e,long:n,lat:n,normals:!0,coords:!0,hemi:!0});break;case 7:this._mesh=GL.Mesh.icosahedron({size:e,subdivisions:n});break;case 8:this._mesh=GL.Mesh.cone({radius:e,height:e,subdivisions:n});break;case 9:this._mesh=GL.Mesh.plane({size:e,xz:!1,detail:n,normals:!0,coords:!0})}this.last_info.type=t,this.last_info.size=e,this.last_info.subdivisions=n,this._mesh.version=this.version++},e.registerNodeType("geometry/mesh_primitive",b),x.title="renderPoints",x.desc="render points with a texture",x.widgets_info={color:{widget:"color"}},x.prototype.updateMesh=function(t){this.buffer,this.buffer&&this.buffer.data&&this.buffer.data.length==t.vertices.length?(this.buffer.data.set(t.vertices),this.buffer.upload(GL.DYNAMIC_DRAW)):this.buffer=new GL.Buffer(GL.ARRAY_BUFFER,t.vertices,3,GL.DYNAMIC_DRAW),this.mesh||(this.mesh=new GL.Mesh),this.mesh.addBuffer("vertices",this.buffer),this.geometry_id=this.mesh.id=t._id,this.version=this.mesh.version=t._version},x.prototype.onExecute=function(){if(this.properties.enabled){var t=this.getInputData(0);if(t)if(this.version==t._version&&this.geometry_id==t._id||this.updateMesh(t),e.LGraphRender.onRequestCameraMatrices){e.LGraphRender.onRequestCameraMatrices(n,r,o);var i=null;this.getInputData(2)?(i=gl.shaders.textured_points)||(i=gl.shaders.textured_points=new GL.Shader(x.vertex_shader_code,x.fragment_shader_code,{USE_TEXTURED_POINTS:""})):(i=gl.shaders.points)||(i=gl.shaders.points=new GL.Shader(x.vertex_shader_code,x.fragment_shader_code,{USE_POINTS:""})),this.color.set(this.properties.color),this.color[3]=this.properties.opacity;var u=this.getInputData(1);u?s.set(u):mat4.identity(s),this.uniforms.u_point_size=this.properties.point_size,this.uniforms.u_point_perspective=this.properties.fixed_size?0:1,this.uniforms.u_perspective=gl.viewport_data[3]*r[5],i.uniforms(a),i.uniforms(this.uniforms),this.properties.opacity>=1?gl.disable(gl.BLEND):gl.enable(gl.BLEND),gl.enable(gl.DEPTH_TEST),this.properties.additive?(gl.blendFunc(gl.SRC_ALPHA,gl.ONE),gl.depthMask(!1)):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),i.draw(this.mesh,GL.POINTS),gl.disable(gl.BLEND),gl.depthMask(!0)}else console.warn("cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph")}},e.registerNodeType("geometry/render_points",x),x.vertex_shader_code="\t\tprecision mediump float;\n\t\tattribute vec3 a_vertex;\n\t\tvarying vec3 v_vertex;\n\t\tattribute vec3 a_normal;\n\t\tvarying vec3 v_normal;\n\t\t#ifdef USE_COLOR\n\t\t\tattribute vec4 a_color;\n\t\t\tvarying vec4 v_color;\n\t\t#endif\n\t\tattribute vec2 a_coord;\n\t\tvarying vec2 v_coord;\n\t\t#ifdef USE_SIZE\n\t\t\tattribute float a_extra;\n\t\t#endif\n\t\t#ifdef USE_INSTANCING\n\t\t\tattribute mat4 u_model;\n\t\t#else\n\t\t\tuniform mat4 u_model;\n\t\t#endif\n\t\tuniform mat4 u_viewprojection;\n\t\tuniform float u_point_size;\n\t\tuniform float u_perspective;\n\t\tuniform float u_point_perspective;\n\t\tfloat computePointSize(float radius, float w)\n\t\t{\n\t\t\tif(radius < 0.0)\n\t\t\t\treturn -radius;\n\t\t\treturn u_perspective * radius / w;\n\t\t}\n\t\tvoid main() {\n\t\t\tv_coord = a_coord;\n\t\t\t#ifdef USE_COLOR\n\t\t\t\tv_color = a_color;\n\t\t\t#endif\n\t\t\tv_vertex = ( u_model * vec4( a_vertex, 1.0 )).xyz;\n\t\t\tv_normal = ( u_model * vec4( a_normal, 0.0 )).xyz;\n\t\t\tgl_Position = u_viewprojection * vec4(v_vertex,1.0);\n\t\t\tgl_PointSize = u_point_size;\n\t\t\t#ifdef USE_SIZE\n\t\t\t\tgl_PointSize = a_extra;\n\t\t\t#endif\n\t\t\tif(u_point_perspective != 0.0)\n\t\t\t\tgl_PointSize = computePointSize( gl_PointSize, gl_Position.w );\n\t\t}\t",x.fragment_shader_code="\t\tprecision mediump float;\n\t\tuniform vec4 u_color;\n\t\t#ifdef USE_COLOR\n\t\t\tvarying vec4 v_color;\n\t\t#endif\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tvoid main() {\n\t\t\tvec4 color = u_color;\n\t\t\t#ifdef USE_TEXTURED_POINTS\n\t\t\t\tcolor *= texture2D(u_texture, gl_PointCoord.xy);\n\t\t\t#else\n\t\t\t\t#ifdef USE_TEXTURE\n\t\t\t\t  color *= texture2D(u_texture, v_coord);\n\t\t\t\t  if(color.a < 0.1)\n\t\t\t\t\tdiscard;\n\t\t\t\t#endif\n\t\t\t\t#ifdef USE_POINTS\n\t\t\t\t\tfloat dist = length( gl_PointCoord.xy - vec2(0.5) );\n\t\t\t\t\tif( dist > 0.45 )\n\t\t\t\t\t\tdiscard;\n\t\t\t\t#endif\n\t\t\t#endif\n\t\t\t#ifdef USE_COLOR\n\t\t\t\tcolor *= v_color;\n\t\t\t#endif\n\t\t\tgl_FragColor = color;\n\t\t}\t")}(this),function(t){var e=t.LiteGraph,n=t.LGraphTexture;if("undefined"!=typeof GL){function i(){this.addInput("Texture","Texture"),this.addInput("Aberration","number"),this.addInput("Distortion","number"),this.addInput("Blur","number"),this.addOutput("Texture","Texture"),this.properties={aberration:1,distortion:1,blur:1,precision:n.DEFAULT},i._shader||(i._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,i.pixel_shader),i._texture=new GL.Texture(3,1,{format:gl.RGB,wrap:gl.CLAMP_TO_EDGE,magFilter:gl.LINEAR,minFilter:gl.LINEAR,pixel_data:[255,0,0,0,255,0,0,0,255]}))}function r(){this.addInput("Texture","Texture"),this.addInput("Blurred","Texture"),this.addInput("Mask","Texture"),this.addInput("Threshold","number"),this.addOutput("Texture","Texture"),this.properties={shape:"",size:10,alpha:1,threshold:1,high_precision:!1}}function o(){this.addInput("Texture","Texture"),this.addInput("value1","number"),this.addInput("value2","number"),this.addOutput("Texture","Texture"),this.properties={fx:"halftone",value1:1,value2:1,precision:n.DEFAULT}}function s(){this.addInput("Tex.","Texture"),this.addInput("intensity","number"),this.addOutput("Texture","Texture"),this.properties={intensity:1,invert:!1,precision:n.DEFAULT},s._shader||(s._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,s.pixel_shader))}i.title="Lens",i.desc="Camera Lens distortion",i.widgets_info={precision:{widget:"combo",values:n.MODE_VALUES}},i.prototype.onExecute=function(){var t=this.getInputData(0);if(this.properties.precision!==n.PASS_THROUGH){if(t){this._tex=n.getTargetTexture(t,this._tex,this.properties.precision);var e=this.properties.aberration;this.isInputConnected(1)&&(e=this.getInputData(1),this.properties.aberration=e);var r=this.properties.distortion;this.isInputConnected(2)&&(r=this.getInputData(2),this.properties.distortion=r);var o=this.properties.blur;this.isInputConnected(3)&&(o=this.getInputData(3),this.properties.blur=o),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var s=Mesh.getScreenQuad(),a=i._shader;this._tex.drawTo((function(){t.bind(0),a.uniforms({u_texture:0,u_aberration:e,u_distortion:r,u_blur:o}).draw(s)})),this.setOutputData(0,this._tex)}}else this.setOutputData(0,t)},i.pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform vec2 u_camera_planes;\n\t\t\tuniform float u_aberration;\n\t\t\tuniform float u_distortion;\n\t\t\tuniform float u_blur;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec2 coord = v_coord;\n\t\t\t\tfloat dist = distance(vec2(0.5), coord);\n\t\t\t\tvec2 dist_coord = coord - vec2(0.5);\n\t\t\t\tfloat percent = 1.0 + ((0.5 - dist) / 0.5) * u_distortion;\n\t\t\t\tdist_coord *= percent;\n\t\t\t\tcoord = dist_coord + vec2(0.5);\n\t\t\t\tvec4 color = texture2D(u_texture,coord, u_blur * dist);\n\t\t\t\tcolor.r = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0+0.01*u_aberration), u_blur * dist ).r;\n\t\t\t\tcolor.b = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0-0.01*u_aberration), u_blur * dist ).b;\n\t\t\t\tgl_FragColor = color;\n\t\t\t}\n\t\t\t",e.registerNodeType("fx/lens",i),t.LGraphFXLens=i,r.title="Bokeh",r.desc="applies an Bokeh effect",r.widgets_info={shape:{widget:"texture"}},r.prototype.onExecute=function(){var t=this.getInputData(0),e=this.getInputData(1),i=this.getInputData(2);if(t&&i&&this.properties.shape){e||(e=t);var o=n.getTexture(this.properties.shape);if(o){var s=this.properties.threshold;this.isInputConnected(3)&&(s=this.getInputData(3),this.properties.threshold=s);var a=gl.UNSIGNED_BYTE;this.properties.high_precision&&(a=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),this._temp_texture&&this._temp_texture.type==a&&this._temp_texture.width==t.width&&this._temp_texture.height==t.height||(this._temp_texture=new GL.Texture(t.width,t.height,{type:a,format:gl.RGBA,filter:gl.LINEAR})),this.properties.size;var u=r._first_shader;u||(u=r._first_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,r._first_pixel_shader));var l=r._second_shader;l||(l=r._second_shader=new GL.Shader(r._second_vertex_shader,r._second_pixel_shader));var p=this._points_mesh;p&&p._width==t.width&&p._height==t.height&&2==p._spacing||(p=this.createPointsMesh(t.width,t.height,2));var h=Mesh.getScreenQuad(),c=this.properties.size,d=(this.properties.min_light,this.properties.alpha);gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo((function(){t.bind(0),e.bind(1),i.bind(2),u.uniforms({u_texture:0,u_texture_blur:1,u_mask:2,u_texsize:[t.width,t.height]}).draw(h)})),this._temp_texture.drawTo((function(){gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),t.bind(0),o.bind(3),l.uniforms({u_texture:0,u_mask:2,u_shape:3,u_alpha:d,u_threshold:s,u_pointSize:c,u_itexsize:[1/t.width,1/t.height]}).draw(p,gl.POINTS)})),this.setOutputData(0,this._temp_texture)}}else this.setOutputData(0,t)},r.prototype.createPointsMesh=function(t,e,n){for(var i=Math.round(t/n),r=Math.round(e/n),o=new Float32Array(i*r*2),s=-1,a=2/t*n,u=2/e*n,l=0;l<r;++l){for(var p=-1,h=0;h<i;++h){var c=l*i*2+2*h;o[c]=p,o[c+1]=s,p+=a}s+=u}return this._points_mesh=GL.Mesh.load({vertices2D:o}),this._points_mesh._width=t,this._points_mesh._height=e,this._points_mesh._spacing=n,this._points_mesh},r._first_pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform sampler2D u_texture_blur;\n\t\t\tuniform sampler2D u_mask;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\n\t\t\t\tvec4 blurred_color = texture2D(u_texture_blur, v_coord);\n\t\t\t\tfloat mask = texture2D(u_mask, v_coord).x;\n\t\t\t   gl_FragColor = mix(color, blurred_color, mask);\n\t\t\t}\n\t\t\t",r._second_vertex_shader="precision highp float;\n\t\t\tattribute vec2 a_vertex2D;\n\t\t\tvarying vec4 v_color;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform sampler2D u_mask;\n\t\t\tuniform vec2 u_itexsize;\n\t\t\tuniform float u_pointSize;\n\t\t\tuniform float u_threshold;\n\t\t\tvoid main() {\n\t\t\t\tvec2 coord = a_vertex2D * 0.5 + 0.5;\n\t\t\t\tv_color = texture2D( u_texture, coord );\n\t\t\t\tv_color += texture2D( u_texture, coord + vec2(u_itexsize.x, 0.0) );\n\t\t\t\tv_color += texture2D( u_texture, coord + vec2(0.0, u_itexsize.y));\n\t\t\t\tv_color += texture2D( u_texture, coord + u_itexsize);\n\t\t\t\tv_color *= 0.25;\n\t\t\t\tfloat mask = texture2D(u_mask, coord).x;\n\t\t\t\tfloat luminance = length(v_color) * mask;\n\t\t\t\t/*luminance /= (u_pointSize*u_pointSize)*0.01 */;\n\t\t\t\tluminance -= u_threshold;\n\t\t\t\tif(luminance < 0.0)\n\t\t\t\t{\n\t\t\t\t\tgl_Position.x = -100.0;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tgl_PointSize = u_pointSize;\n\t\t\t\tgl_Position = vec4(a_vertex2D,0.0,1.0);\n\t\t\t}\n\t\t\t",r._second_pixel_shader="precision highp float;\n\t\t\tvarying vec4 v_color;\n\t\t\tuniform sampler2D u_shape;\n\t\t\tuniform float u_alpha;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D( u_shape, gl_PointCoord );\n\t\t\t\tcolor *= v_color * u_alpha;\n\t\t\t\tgl_FragColor = color;\n\t\t\t}\n",e.registerNodeType("fx/bokeh",r),t.LGraphFXBokeh=r,o.title="FX",o.desc="applies an FX from a list",o.widgets_info={fx:{widget:"combo",values:["halftone","pixelate","lowpalette","noise","gamma"]},precision:{widget:"combo",values:n.MODE_VALUES}},o.shaders={},o.prototype.onExecute=function(){if(this.isOutputConnected(0)){var e=this.getInputData(0);if(this.properties.precision!==n.PASS_THROUGH){if(e){this._tex=n.getTargetTexture(e,this._tex,this.properties.precision);var i=this.properties.value1;this.isInputConnected(1)&&(i=this.getInputData(1),this.properties.value1=i);var r=this.properties.value2;this.isInputConnected(2)&&(r=this.getInputData(2),this.properties.value2=r);var s=this.properties.fx,a=o.shaders[s];if(!a){var u=o["pixel_shader_"+s];if(!u)return;a=o.shaders[s]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,u)}gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var l,p=Mesh.getScreenQuad(),h=t.LS?LS.Renderer._current_camera:null;l=h?[LS.Renderer._current_camera.near,LS.Renderer._current_camera.far]:[1,100];var c=null;"noise"==s&&(c=n.getNoiseTexture()),this._tex.drawTo((function(){e.bind(0),"noise"==s&&c.bind(1),a.uniforms({u_texture:0,u_noise:1,u_size:[e.width,e.height],u_rand:[Math.random(),Math.random()],u_value1:i,u_value2:r,u_camera_planes:l}).draw(p)})),this.setOutputData(0,this._tex)}}else this.setOutputData(0,e)}},o.pixel_shader_halftone="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform vec2 u_camera_planes;\n\t\t\tuniform vec2 u_size;\n\t\t\tuniform float u_value1;\n\t\t\tuniform float u_value2;\n\t\t\t\n\t\t\tfloat pattern() {\n\t\t\t\tfloat s = sin(u_value1 * 3.1415), c = cos(u_value1 * 3.1415);\n\t\t\t\tvec2 tex = v_coord * u_size.xy;\n\t\t\t\tvec2 point = vec2(\n\t\t\t\t   c * tex.x - s * tex.y ,\n\t\t\t\t   s * tex.x + c * tex.y \n\t\t\t\t) * u_value2;\n\t\t\t\treturn (sin(point.x) * sin(point.y)) * 4.0;\n\t\t\t}\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\n\t\t\t\tfloat average = (color.r + color.g + color.b) / 3.0;\n\t\t\t\tgl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\n\t\t\t}\n",o.pixel_shader_pixelate="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform vec2 u_camera_planes;\n\t\t\tuniform vec2 u_size;\n\t\t\tuniform float u_value1;\n\t\t\tuniform float u_value2;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec2 coord = vec2( floor(v_coord.x * u_value1) / u_value1, floor(v_coord.y * u_value2) / u_value2 );\n\t\t\t\tvec4 color = texture2D(u_texture, coord);\n\t\t\t\tgl_FragColor = color;\n\t\t\t}\n",o.pixel_shader_lowpalette="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform vec2 u_camera_planes;\n\t\t\tuniform vec2 u_size;\n\t\t\tuniform float u_value1;\n\t\t\tuniform float u_value2;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\n\t\t\t\tgl_FragColor = floor(color * u_value1) / u_value1;\n\t\t\t}\n",o.pixel_shader_noise="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform sampler2D u_noise;\n\t\t\tuniform vec2 u_size;\n\t\t\tuniform float u_value1;\n\t\t\tuniform float u_value2;\n\t\t\tuniform vec2 u_rand;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\n\t\t\t\tvec3 noise = texture2D(u_noise, v_coord * vec2(u_size.x / 512.0, u_size.y / 512.0) + u_rand).xyz - vec3(0.5);\n\t\t\t\tgl_FragColor = vec4( color.xyz + noise * u_value1, color.a );\n\t\t\t}\n",o.pixel_shader_gamma="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform float u_value1;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\n\t\t\t\tfloat gamma = 1.0 / u_value1;\n\t\t\t\tgl_FragColor = vec4( pow( color.xyz, vec3(gamma) ), color.a );\n\t\t\t}\n",e.registerNodeType("fx/generic",o),t.LGraphFXGeneric=o,s.title="Vigneting",s.desc="Vigneting",s.widgets_info={precision:{widget:"combo",values:n.MODE_VALUES}},s.prototype.onExecute=function(){var t=this.getInputData(0);if(this.properties.precision!==n.PASS_THROUGH){if(t){this._tex=n.getTargetTexture(t,this._tex,this.properties.precision);var e=this.properties.intensity;this.isInputConnected(1)&&(e=this.getInputData(1),this.properties.intensity=e),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var i=Mesh.getScreenQuad(),r=s._shader,o=this.properties.invert;this._tex.drawTo((function(){t.bind(0),r.uniforms({u_texture:0,u_intensity:e,u_isize:[1/t.width,1/t.height],u_invert:o?1:0}).draw(i)})),this.setOutputData(0,this._tex)}}else this.setOutputData(0,t)},s.pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform float u_intensity;\n\t\t\tuniform int u_invert;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tfloat luminance = 1.0 - length( v_coord - vec2(0.5) ) * 1.414;\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\n\t\t\t\tif(u_invert == 1)\n\t\t\t\t\tluminance = 1.0 - luminance;\n\t\t\t\tluminance = mix(1.0, luminance, u_intensity);\n\t\t\t   gl_FragColor = vec4( luminance * color.xyz, color.a);\n\t\t\t}\n\t\t\t",e.registerNodeType("fx/vigneting",s),t.LGraphFXVigneting=s}}(this),function(t){var e=t.LiteGraph,n="#243";function i(t){this.channel=0,this.cmd=0,this.data=new Uint32Array(3),t&&this.setup(t)}for(var r in e.MIDIEvent=i,i.prototype.fromJSON=function(t){this.setup(t.data)},i.prototype.setup=function(t){var e=t;t.constructor===Object&&(e=t.data),this.data.set(e);var n=e[0];this.status=n;var r=240&n;this.cmd=n>=240?n:r,this.cmd==i.NOTEON&&0==this.velocity&&(this.cmd=i.NOTEOFF),this.cmd_str=i.commands[this.cmd]||"",(r>=i.NOTEON||r<=i.NOTEOFF)&&(this.channel=15&n)},Object.defineProperty(i.prototype,"velocity",{get:function(){return this.cmd==i.NOTEON?this.data[2]:-1},set:function(t){this.data[2]=t},enumerable:!0}),i.notes=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],i.note_to_index={A:0,"A#":1,B:2,C:3,"C#":4,D:5,"D#":6,E:7,F:8,"F#":9,G:10,"G#":11},Object.defineProperty(i.prototype,"note",{get:function(){return this.cmd!=i.NOTEON?-1:i.toNoteString(this.data[1],!0)},set:function(t){throw"notes cannot be assigned this way, must modify the data[1]"},enumerable:!0}),Object.defineProperty(i.prototype,"octave",{get:function(){if(this.cmd!=i.NOTEON)return-1;var t=this.data[1]-24;return Math.floor(t/12+1)},set:function(t){throw"octave cannot be assigned this way, must modify the data[1]"},enumerable:!0}),i.prototype.getPitch=function(){return 440*Math.pow(2,(this.data[1]-69)/12)},i.computePitch=function(t){return 440*Math.pow(2,(t-69)/12)},i.prototype.getCC=function(){return this.data[1]},i.prototype.getCCValue=function(){return this.data[2]},i.prototype.getPitchBend=function(){return this.data[1]+(this.data[2]<<7)-8192},i.computePitchBend=function(t,e){return t+(e<<7)-8192},i.prototype.setCommandFromString=function(t){this.cmd=i.computeCommandFromString(t)},i.computeCommandFromString=function(t){if(!t)return 0;if(t&&t.constructor===Number)return t;switch(t=t.toUpperCase()){case"NOTE ON":case"NOTEON":case"NOTE OFF":case"NOTEOFF":return i.NOTEON;case"KEY PRESSURE":case"KEYPRESSURE":return i.KEYPRESSURE;case"CONTROLLER CHANGE":case"CONTROLLERCHANGE":case"CC":return i.CONTROLLERCHANGE;case"PROGRAM CHANGE":case"PROGRAMCHANGE":case"PC":return i.PROGRAMCHANGE;case"CHANNEL PRESSURE":case"CHANNELPRESSURE":return i.CHANNELPRESSURE;case"PITCH BEND":case"PITCHBEND":return i.PITCHBEND;case"TIME TICK":case"TIMETICK":return i.TIMETICK;default:return Number(t)}},i.toNoteString=function(t,e){var n=(t=Math.round(t))-21,r=Math.floor((t-24)/12+1);return(n%=12)<0&&(n=12+n),i.notes[n]+(e?"":r)},i.NoteStringToPitch=function(t){var e=(t=t.toUpperCase())[0],n=4;"#"==t[1]?(e+="#",t.length>2&&(n=Number(t[2]))):t.length>1&&(n=Number(t[1]));var r=i.note_to_index[e];return null==r?null:12*(n-1)+r+21},i.prototype.toString=function(){var t=this.channel+". ";switch(this.cmd){case i.NOTEON:t+="NOTEON "+i.toNoteString(this.data[1]);break;case i.NOTEOFF:t+="NOTEOFF "+i.toNoteString(this.data[1]);break;case i.CONTROLLERCHANGE:t+="CC "+this.data[1]+" "+this.data[2];break;case i.PROGRAMCHANGE:t+="PC "+this.data[1];break;case i.PITCHBEND:t+="PITCHBEND "+this.getPitchBend();break;case i.KEYPRESSURE:t+="KEYPRESS "+this.data[1]}return t},i.prototype.toHexString=function(){for(var t=0;t<this.data.length;t++)this.data[t].toString(16)},i.prototype.toJSON=function(){return{data:[this.data[0],this.data[1],this.data[2]],object_class:"MIDIEvent"}},i.NOTEOFF=128,i.NOTEON=144,i.KEYPRESSURE=160,i.CONTROLLERCHANGE=176,i.PROGRAMCHANGE=192,i.CHANNELPRESSURE=208,i.PITCHBEND=224,i.TIMETICK=248,i.commands={128:"note off",144:"note on",160:"key pressure",176:"controller change",192:"program change",208:"channel pressure",224:"pitch bend",240:"system",242:"Song pos",243:"Song select",246:"Tune request",248:"time tick",250:"Start Song",251:"Continue Song",252:"Stop Song",254:"Sensing",255:"Reset"},i.commands_short={128:"NOTEOFF",144:"NOTEOFF",160:"KEYP",176:"CC",192:"PC",208:"CP",224:"PB",240:"SYS",242:"POS",243:"SELECT",246:"TUNEREQ",248:"TT",250:"START",251:"CONTINUE",252:"STOP",254:"SENS",255:"RESET"},i.commands_reversed={},i.commands)i.commands_reversed[i.commands[r]]=r;function o(t,e){if(!navigator.requestMIDIAccess)return this.error="not suppoorted",void(e?e("Not supported"):console.error("MIDI NOT SUPPORTED, enable by chrome://flags"));this.on_ready=t,this.state={note:[],cc:[]},this.input_ports=null,this.input_ports_info=[],this.output_ports=null,this.output_ports_info=[],navigator.requestMIDIAccess().then(this.onMIDISuccess.bind(this),this.onMIDIFailure.bind(this))}function s(){this.addOutput("on_midi",e.EVENT),this.addOutput("out","midi"),this.properties={port:0},this._last_midi_event=null,this._current_midi_event=null,this.boxcolor="#AAA",this._last_time=0;var t=this;new o((function(e){t._midi=e,t._waiting&&t.onStart(),t._waiting=!1}))}function a(){this.addInput("send",e.EVENT),this.properties={port:0};var t=this;new o((function(e){t._midi=e,t.widget.options.values=t.getMIDIOutputs()})),this.widget=this.addWidget("combo","Device",this.properties.port,{property:"port",values:this.getMIDIOutputs.bind(this)}),this.size=[340,60]}function u(){this.addInput("on_midi",e.EVENT),this._str="",this.size=[200,40]}function l(){this.properties={channel:-1,cmd:-1,min_value:-1,max_value:-1};var t=this;this._learning=!1,this.addWidget("button","Learn","",(function(){t._learning=!0,t.boxcolor="#FA3"})),this.addInput("in",e.EVENT),this.addOutput("on_midi",e.EVENT),this.boxcolor="#AAA"}function p(){this.properties={channel:0,cmd:144,value1:1,value2:1},this.addInput("send",e.EVENT),this.addInput("assign",e.EVENT),this.addOutput("on_midi",e.EVENT),this.midi_event=new i,this.gate=!1}function h(){this.properties={cc:1,value:0},this.addOutput("value","number")}function c(){this.addInput("generate",e.ACTION),this.addInput("scale","string"),this.addInput("octave","number"),this.addOutput("note",e.EVENT),this.properties={notes:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#",octave:2,duration:.5,mode:"sequence"},this.notes_pitches=c.processScale(this.properties.notes),this.sequence_index=0}function d(){this.properties={amount:0},this.addInput("in",e.ACTION),this.addInput("amount","number"),this.addOutput("out",e.EVENT),this.midi_event=new i}function f(){this.properties={scale:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#"},this.addInput("note",e.ACTION),this.addInput("scale","string"),this.addOutput("out",e.EVENT),this.valid_notes=new Array(12),this.offset_notes=new Array(12),this.processScale(this.properties.scale)}function g(){this.properties={url:"",autoplay:!0},this.addInput("play",e.ACTION),this.addInput("pause",e.ACTION),this.addOutput("note",e.EVENT),this._midi=null,this._current_time=0,this._playing=!1,"undefined"==typeof MidiParser&&(console.error("midi-parser.js not included, LGMidiPlay requires that library: https://raw.githubusercontent.com/colxi/midi-parser-js/master/src/main.js"),this.boxcolor="red")}function _(){if(this.properties={volume:.5,duration:1},this.addInput("note",e.ACTION),this.addInput("volume","number"),this.addInput("duration","number"),this.addOutput("note",e.EVENT),"undefined"==typeof AudioSynth)console.error("Audiosynth.js not included, LGMidiPlay requires that library"),this.boxcolor="red";else{var t=this.synth=new AudioSynth;this.instrument=t.createInstrument("piano")}}function v(){this.properties={num_octaves:2,start_octave:2},this.addInput("note",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("note",e.EVENT),this.size=[400,100],this.keys=[],this._last_key=-1}o.input=null,o.MIDIEvent=i,o.prototype.onMIDISuccess=function(t){console.log("MIDI ready!"),console.log(t),this.midi=t,this.updatePorts(),this.on_ready&&this.on_ready(this)},o.prototype.updatePorts=function(){var t,e=this.midi;this.input_ports=e.inputs,this.input_ports_info=[],this.output_ports=e.outputs,this.output_ports_info=[];for(var n=0,i=(t=this.input_ports.values()).next();i&&!1===i.done;){var r=i.value;this.input_ports_info.push(r),console.log("Input port [type:'"+r.type+"'] id:'"+r.id+"' manufacturer:'"+r.manufacturer+"' name:'"+r.name+"' version:'"+r.version+"'"),n++,i=t.next()}for(this.num_input_ports=n,n=0,i=(t=this.output_ports.values()).next();i&&!1===i.done;)r=i.value,this.output_ports_info.push(r),console.log("Output port [type:'"+r.type+"'] id:'"+r.id+"' manufacturer:'"+r.manufacturer+"' name:'"+r.name+"' version:'"+r.version+"'"),n++,i=t.next();this.num_output_ports=n},o.prototype.onMIDIFailure=function(t){console.error("Failed to get MIDI access - "+t)},o.prototype.openInputPort=function(t,e){var n=this.input_ports.get("input-"+t);if(!n)return!1;o.input=this;var r=this;return n.onmidimessage=function(t){var n=new i(t.data);r.updateState(n),e&&e(t.data,n),o.on_message&&o.on_message(t.data,n)},console.log("port open: ",n),!0},o.parseMsg=function(t){},o.prototype.updateState=function(t){switch(t.cmd){case i.NOTEON:this.state.note[0|t.value1]=t.value2;break;case i.NOTEOFF:this.state.note[0|t.value1]=0;break;case i.CONTROLLERCHANGE:this.state.cc[t.getCC()]=t.getCCValue()}},o.prototype.sendMIDI=function(t,e){if(e){var n=this.output_ports_info[t];n&&(o.output=this,e.constructor===i?n.send(e.data):n.send(e))}},s.MIDIInterface=o,s.title="MIDI Input",s.desc="Reads MIDI from a input port",s.color=n,s.prototype.getPropertyInfo=function(t){if(this._midi&&"port"==t){for(var e={},n=0;n<this._midi.input_ports_info.length;++n){var i=this._midi.input_ports_info[n];e[n]=n+".- "+i.name+" version:"+i.version}return{type:"enum",values:e}}},s.prototype.onStart=function(){this._midi?this._midi.openInputPort(this.properties.port,this.onMIDIEvent.bind(this)):this._waiting=!0},s.prototype.onMIDIEvent=function(t,n){this._last_midi_event=n,this.boxcolor="#AFA",this._last_time=e.getTime(),this.trigger("on_midi",n),n.cmd==i.NOTEON?this.trigger("on_noteon",n):n.cmd==i.NOTEOFF?this.trigger("on_noteoff",n):n.cmd==i.CONTROLLERCHANGE?this.trigger("on_cc",n):n.cmd==i.PROGRAMCHANGE?this.trigger("on_pc",n):n.cmd==i.PITCHBEND&&this.trigger("on_pitchbend",n)},s.prototype.onDrawBackground=function(t){if(this.boxcolor="#AAA",!this.flags.collapsed&&this._last_midi_event){t.fillStyle="white";var n=e.getTime(),i=1-Math.max(0,.001*(n-this._last_time));if(i>0){var r=t.globalAlpha;t.globalAlpha*=i,t.font="12px Tahoma",t.fillText(this._last_midi_event.toString(),2,.5*this.size[1]+3),t.globalAlpha=r}}},s.prototype.onExecute=function(){if(this.outputs)for(var t=this._last_midi_event,e=0;e<this.outputs.length;++e){var n=null;switch(this.outputs[e].name){case"midi":n=this._midi;break;case"last_midi":n=t;break;default:continue}this.setOutputData(e,n)}},s.prototype.onGetOutputs=function(){return[["last_midi","midi"],["on_midi",e.EVENT],["on_noteon",e.EVENT],["on_noteoff",e.EVENT],["on_cc",e.EVENT],["on_pc",e.EVENT],["on_pitchbend",e.EVENT]]},e.registerNodeType("midi/input",s),a.MIDIInterface=o,a.title="MIDI Output",a.desc="Sends MIDI to output channel",a.color=n,a.prototype.onGetPropertyInfo=function(t){if(this._midi&&"port"==t)return{type:"enum",values:this.getMIDIOutputs()}},a.default_ports={0:"unknown"},a.prototype.getMIDIOutputs=function(){var t={};if(!this._midi)return a.default_ports;if(this._midi.output_ports_info)for(var e=0;e<this._midi.output_ports_info.length;++e){var n=this._midi.output_ports_info[e];if(n){var i=e+".- "+n.name+" version:"+n.version;t[e]=i}}return t},a.prototype.onAction=function(t,e){this._midi&&("send"==t&&this._midi.sendMIDI(this.properties.port,e),this.trigger("midi",e))},a.prototype.onGetInputs=function(){return[["send",e.ACTION]]},a.prototype.onGetOutputs=function(){return[["on_midi",e.EVENT]]},e.registerNodeType("midi/output",a),u.title="MIDI Show",u.desc="Shows MIDI in the graph",u.color=n,u.prototype.getTitle=function(){return this.flags.collapsed?this._str:this.title},u.prototype.onAction=function(t,e){e&&(e.constructor===i?this._str=e.toString():this._str="???")},u.prototype.onDrawForeground=function(t){this._str&&!this.flags.collapsed&&(t.font="30px Arial",t.fillText(this._str,10,.8*this.size[1]))},u.prototype.onGetInputs=function(){return[["in",e.ACTION]]},u.prototype.onGetOutputs=function(){return[["on_midi",e.EVENT]]},e.registerNodeType("midi/show",u),l.title="MIDI Filter",l.desc="Filters MIDI messages",l.color=n,l["@cmd"]={type:"enum",title:"Command",values:i.commands_reversed},l.prototype.getTitle=function(){var t=null;return t=-1==this.properties.cmd?"Nothing":i.commands_short[this.properties.cmd]||"Unknown",-1!=this.properties.min_value&&-1!=this.properties.max_value&&(t+=" "+(this.properties.min_value==this.properties.max_value?this.properties.max_value:this.properties.min_value+".."+this.properties.max_value)),"Filter: "+t},l.prototype.onPropertyChanged=function(t,e){if("cmd"==t){var n=Number(e);isNaN(n)&&(n=i.commands[e]||0),this.properties.cmd=n}},l.prototype.onAction=function(t,e){if(e&&e.constructor===i){if(this._learning)this._learning=!1,this.boxcolor="#AAA",this.properties.channel=e.channel,this.properties.cmd=e.cmd,this.properties.min_value=this.properties.max_value=e.data[1];else{if(-1!=this.properties.channel&&e.channel!=this.properties.channel)return;if(-1!=this.properties.cmd&&e.cmd!=this.properties.cmd)return;if(-1!=this.properties.min_value&&e.data[1]<this.properties.min_value)return;if(-1!=this.properties.max_value&&e.data[1]>this.properties.max_value)return}this.trigger("on_midi",e)}},e.registerNodeType("midi/filter",l),p.title="MIDIEvent",p.desc="Create a MIDI Event",p.color=n,p.prototype.onAction=function(t,e){if("assign"==t)return this.properties.channel=e.channel,this.properties.cmd=e.cmd,this.properties.value1=e.data[1],this.properties.value2=e.data[2],void(e.cmd==i.NOTEON?this.gate=!0:e.cmd==i.NOTEOFF&&(this.gate=!1));(e=this.midi_event).channel=this.properties.channel,this.properties.cmd&&this.properties.cmd.constructor===String?e.setCommandFromString(this.properties.cmd):e.cmd=this.properties.cmd,e.data[0]=e.cmd|e.channel,e.data[1]=Number(this.properties.value1),e.data[2]=Number(this.properties.value2),this.trigger("on_midi",e)},p.prototype.onExecute=function(){var t=this.properties;if(this.inputs)for(var e=0;e<this.inputs.length;++e){var n=this.inputs[e];if(-1!=n.link)switch(n.name){case"note":null!=(r=this.getInputData(e))&&(r.constructor===String&&(r=i.NoteStringToPitch(r)),this.properties.value1=(0|r)%255);break;case"cmd":null!=(r=this.getInputData(e))&&(this.properties.cmd=r);break;case"value1":null!=(r=this.getInputData(e))&&(this.properties.value1=clamp(0|r,0,127));break;case"value2":null!=(r=this.getInputData(e))&&(this.properties.value2=clamp(0|r,0,127))}}if(this.outputs)for(e=0;e<this.outputs.length;++e){var r=null;switch(this.outputs[e].name){case"midi":(r=new i).setup([t.cmd,t.value1,t.value2]),r.channel=t.channel;break;case"command":r=t.cmd;break;case"cc":r=t.value1;break;case"cc_value":r=t.value2;break;case"note":r=t.cmd==i.NOTEON||t.cmd==i.NOTEOFF?t.value1:null;break;case"velocity":r=t.cmd==i.NOTEON?t.value2:null;break;case"pitch":r=t.cmd==i.NOTEON?i.computePitch(t.value1):null;break;case"pitchbend":r=t.cmd==i.PITCHBEND?i.computePitchBend(t.value1,t.value2):null;break;case"gate":r=this.gate;break;default:continue}null!==r&&this.setOutputData(e,r)}},p.prototype.onPropertyChanged=function(t,e){"cmd"==t&&(this.properties.cmd=i.computeCommandFromString(e))},p.prototype.onGetInputs=function(){return[["cmd","number"],["note","number"],["value1","number"],["value2","number"]]},p.prototype.onGetOutputs=function(){return[["midi","midi"],["on_midi",e.EVENT],["command","number"],["note","number"],["velocity","number"],["cc","number"],["cc_value","number"],["pitch","number"],["gate","bool"],["pitchbend","number"]]},e.registerNodeType("midi/event",p),h.title="MIDICC",h.desc="gets a Controller Change",h.color=n,h.prototype.onExecute=function(){this.properties,o.input&&(this.properties.value=o.input.state.cc[this.properties.cc]),this.setOutputData(0,this.properties.value)},e.registerNodeType("midi/cc",h),c.title="MIDI Generator",c.desc="Generates a random MIDI note",c.color=n,c.processScale=function(t){for(var n=t.split(","),r=0;r<n.length;++r){var o=n[r];2==o.length&&"#"!=o[1]||o.length>2?n[r]=-e.MIDIEvent.NoteStringToPitch(o):n[r]=i.note_to_index[o]||0}return n},c.prototype.onPropertyChanged=function(t,e){"notes"==t&&(this.notes_pitches=c.processScale(e))},c.prototype.onExecute=function(){var t=this.getInputData(2);null!=t&&(this.properties.octave=t);var e=this.getInputData(1);e&&(this.notes_pitches=c.processScale(e))},c.prototype.onAction=function(t,e){var n,r=this.notes_pitches.length,o=0;"sequence"==this.properties.mode?o=this.sequence_index=(this.sequence_index+1)%r:"random"==this.properties.mode&&(o=Math.floor(Math.random()*r));var s=this.notes_pitches[o];n=s>=0?s+12*(this.properties.octave-1)+33:-s,(e=new i).setup([i.NOTEON,n,10]);var a=this.properties.duration||1;this.trigger("note",e),setTimeout(function(){var t=new i;t.setup([i.NOTEOFF,n,0]),this.trigger("note",t)}.bind(this),1e3*a)},e.registerNodeType("midi/generator",c),d.title="MIDI Transpose",d.desc="Transpose a MIDI note",d.color=n,d.prototype.onAction=function(t,e){e&&e.constructor===i&&(e.data[0]==i.NOTEON||e.data[0]==i.NOTEOFF?(this.midi_event=new i,this.midi_event.setup(e.data),this.midi_event.data[1]=Math.round(this.midi_event.data[1]+this.properties.amount),this.trigger("out",this.midi_event)):this.trigger("out",e))},d.prototype.onExecute=function(){var t=this.getInputData(1);null!=t&&(this.properties.amount=t)},e.registerNodeType("midi/transpose",d),f.title="MIDI Quantize Pitch",f.desc="Transpose a MIDI note tp fit an scale",f.color=n,f.prototype.onPropertyChanged=function(t,e){"scale"==t&&this.processScale(e)},f.prototype.processScale=function(t){this._current_scale=t,this.notes_pitches=c.processScale(t);for(var e=0;e<12;++e)this.valid_notes[e]=-1!=this.notes_pitches.indexOf(e);for(e=0;e<12;++e)if(this.valid_notes[e])this.offset_notes[e]=0;else for(var n=1;n<12;++n){if(this.valid_notes[(e-n)%12]){this.offset_notes[e]=-n;break}if(this.valid_notes[(e+n)%12]){this.offset_notes[e]=n;break}}},f.prototype.onAction=function(t,e){if(e&&e.constructor===i)if(e.data[0]==i.NOTEON||e.data[0]==i.NOTEOFF){this.midi_event=new i,this.midi_event.setup(e.data);var n=e.note,r=i.note_to_index[n],o=this.offset_notes[r];this.midi_event.data[1]+=o,this.trigger("out",this.midi_event)}else this.trigger("out",e)},f.prototype.onExecute=function(){var t=this.getInputData(1);null!=t&&t!=this._current_scale&&this.processScale(t)},e.registerNodeType("midi/quantize",f),g.title="MIDI fromFile",g.desc="Plays a MIDI file",g.color=n,g.prototype.onAction=function(t){"play"==t?this.play():"pause"==t&&(this._playing=!this._playing)},g.prototype.onPropertyChanged=function(t,e){"url"==t&&this.loadMIDIFile(e)},g.prototype.onExecute=function(){if(this._midi&&this._playing){this._current_time+=this.graph.elapsed_time;for(var t=100*this._current_time,e=0;e<this._midi.tracks;++e){var n=this._midi.track[e];n._last_pos||(n._last_pos=0,n._time=0);var r=n.event[n._last_pos];if(r&&n._time+r.deltaTime<=t&&(n._last_pos++,n._time+=r.deltaTime,r.data)){var o=r.type<<4+r.channel,s=new i;s.setup([o,r.data[0],r.data[1]]),this.trigger("note",s)}}}},g.prototype.play=function(){if(this._playing=!0,this._current_time=0,this._midi)for(var t=0;t<this._midi.tracks;++t){var e=this._midi.track[t];e._last_pos=0,e._time=0}},g.prototype.loadMIDIFile=function(t){var n=this;e.fetchFile(t,"arraybuffer",(function(t){n.boxcolor="#AFA",n._midi=MidiParser.parse(new Uint8Array(t)),n.properties.autoplay&&n.play()}),(function(t){n.boxcolor="#FAA",n._midi=null}))},g.prototype.onDropFile=function(t){this.properties.url="",this.loadMIDIFile(t)},e.registerNodeType("midi/fromFile",g),_.title="MIDI Play",_.desc="Plays a MIDI note",_.color=n,_.prototype.onAction=function(t,e){if(e&&e.constructor===i){if(this.instrument&&e.data[0]==i.NOTEON){var n=e.note;if(!n||"undefined"==n||n.constructor!==String)return;this.instrument.play(n,e.octave,this.properties.duration,this.properties.volume)}this.trigger("note",e)}},_.prototype.onExecute=function(){var t=this.getInputData(1);null!=t&&(this.properties.volume=t);var e=this.getInputData(2);null!=e&&(this.properties.duration=e)},e.registerNodeType("midi/play",_),v.title="MIDI Keys",v.desc="Keyboard to play notes",v.color=n,v.keys=[{x:0,w:1,h:1,t:0},{x:.75,w:.5,h:.6,t:1},{x:1,w:1,h:1,t:0},{x:1.75,w:.5,h:.6,t:1},{x:2,w:1,h:1,t:0},{x:2.75,w:.5,h:.6,t:1},{x:3,w:1,h:1,t:0},{x:4,w:1,h:1,t:0},{x:4.75,w:.5,h:.6,t:1},{x:5,w:1,h:1,t:0},{x:5.75,w:.5,h:.6,t:1},{x:6,w:1,h:1,t:0}],v.prototype.onDrawForeground=function(t){if(!this.flags.collapsed){var e=12*this.properties.num_octaves;this.keys.length=e;var n=this.size[0]/(7*this.properties.num_octaves),i=this.size[1];t.globalAlpha=1;for(var r=0;r<2;r++)for(var o=0;o<e;++o){var s=v.keys[o%12];if(s.t==r){var a=7*Math.floor(o/12)*n+s.x*n;t.fillStyle=0==r?this.keys[o]?"#CCC":"white":this.keys[o]?"#333":"black",t.fillRect(a+1,0,n*s.w-2,i*s.h)}}}},v.prototype.getKeyIndex=function(t){this.properties.num_octaves;for(var e=this.size[0]/(7*this.properties.num_octaves),n=this.size[1],i=1;i>=0;i--)for(var r=0;r<this.keys.length;++r){var o=v.keys[r%12];if(o.t==i){var s=7*Math.floor(r/12)*e+o.x*e,a=e*o.w,u=n*o.h;if(!(t[0]<s||t[0]>s+a||t[1]>u))return r}}return-1},v.prototype.onAction=function(t,e){if("reset"!=t){if(e&&e.constructor===i){var n=e,r=12*(this.properties.start_octave-1)+29,o=n.data[1]-r;o>=0&&o<this.keys.length&&(n.data[0]==i.NOTEON?this.keys[o]=!0:n.data[0]==i.NOTEOFF&&(this.keys[o]=!1)),this.trigger("note",n)}}else for(var s=0;s<this.keys.length;++s)this.keys[s]=!1},v.prototype.onMouseDown=function(t,e){if(!(e[1]<0)){var n=this.getKeyIndex(e);this.keys[n]=!0,this._last_key=n;var r=12*(this.properties.start_octave-1)+29+n,o=new i;return o.setup([i.NOTEON,r,100]),this.trigger("note",o),!0}},v.prototype.onMouseMove=function(t,e){if(!(e[1]<0||-1==this._last_key)){this.setDirtyCanvas(!0);var n=this.getKeyIndex(e);if(this._last_key==n)return!0;this.keys[this._last_key]=!1;var r,o=12*(this.properties.start_octave-1)+29+this._last_key;return(r=new i).setup([i.NOTEOFF,o,100]),this.trigger("note",r),this.keys[n]=!0,o=12*(this.properties.start_octave-1)+29+n,(r=new i).setup([i.NOTEON,o,100]),this.trigger("note",r),this._last_key=n,!0}},v.prototype.onMouseUp=function(t,e){if(!(e[1]<0)){var n=this.getKeyIndex(e);this.keys[n]=!1,this._last_key=-1;var r=12*(this.properties.start_octave-1)+29+n,o=new i;return o.setup([i.NOTEOFF,r,100]),this.trigger("note",o),!0}},e.registerNodeType("midi/keys",v)}(this),function(t){var e=t.LiteGraph,n={};function i(){this.properties={src:"",gain:.5,loop:!0,autoplay:!0,playbackRate:1},this._loading_audio=!1,this._audiobuffer=null,this._audionodes=[],this._last_sourcenode=null,this.addOutput("out","audio"),this.addInput("gain","number");var t=n.getAudioContext();this.audionode=t.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain,this.properties.src&&this.loadSound(this.properties.src)}function r(){this.properties={gain:.5},this._audionodes=[],this._media_stream=null,this.addOutput("out","audio"),this.addInput("gain","number");var t=n.getAudioContext();this.audionode=t.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain}function o(){this.properties={fftSize:2048,minDecibels:-100,maxDecibels:-10,smoothingTimeConstant:.5};var t=n.getAudioContext();this.audionode=t.createAnalyser(),this.audionode.graphnode=this,this.audionode.fftSize=this.properties.fftSize,this.audionode.minDecibels=this.properties.minDecibels,this.audionode.maxDecibels=this.properties.maxDecibels,this.audionode.smoothingTimeConstant=this.properties.smoothingTimeConstant,this.addInput("in","audio"),this.addOutput("freqs","array"),this.addOutput("samples","array"),this._freq_bin=null,this._time_bin=null}function s(){this.properties={gain:1},this.audionode=n.getAudioContext().createGain(),this.addInput("in","audio"),this.addInput("gain","number"),this.addOutput("out","audio")}function a(){this.properties={impulse_src:"",normalize:!0},this.audionode=n.getAudioContext().createConvolver(),this.addInput("in","audio"),this.addOutput("out","audio")}function u(){this.properties={threshold:-50,knee:40,ratio:12,reduction:-20,attack:0,release:.25},this.audionode=n.getAudioContext().createDynamicsCompressor(),this.addInput("in","audio"),this.addOutput("out","audio")}function l(){this.properties={},this.audionode=n.getAudioContext().createWaveShaper(),this.addInput("in","audio"),this.addInput("shape","waveshape"),this.addOutput("out","audio")}function p(){this.properties={gain1:.5,gain2:.5},this.audionode=n.getAudioContext().createGain(),this.audionode1=n.getAudioContext().createGain(),this.audionode1.gain.value=this.properties.gain1,this.audionode2=n.getAudioContext().createGain(),this.audionode2.gain.value=this.properties.gain2,this.audionode1.connect(this.audionode),this.audionode2.connect(this.audionode),this.addInput("in1","audio"),this.addInput("in1 gain","number"),this.addInput("in2","audio"),this.addInput("in2 gain","number"),this.addOutput("out","audio")}function h(){this.properties={A:.1,D:.1,S:.1,R:.1},this.audionode=n.getAudioContext().createGain(),this.audionode.gain.value=0,this.addInput("in","audio"),this.addInput("gate","boolean"),this.addOutput("out","audio"),this.gate=!1}function c(){this.properties={delayTime:.5},this.audionode=n.getAudioContext().createDelay(10),this.audionode.delayTime.value=this.properties.delayTime,this.addInput("in","audio"),this.addInput("time","number"),this.addOutput("out","audio")}function d(){this.properties={frequency:350,detune:0,Q:1},this.addProperty("type","lowpass","enum",{values:["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"]}),this.audionode=n.getAudioContext().createBiquadFilter(),this.addInput("in","audio"),this.addOutput("out","audio")}function f(){this.properties={frequency:440,detune:0,type:"sine"},this.addProperty("type","sine","enum",{values:["sine","square","sawtooth","triangle","custom"]}),this.audionode=n.getAudioContext().createOscillator(),this.addOutput("out","audio")}function g(){this.properties={continuous:!0,mark:-1},this.addInput("data","array"),this.addInput("mark","number"),this.size=[300,200],this._last_buffer=null}function _(){this.properties={band:440,amplitude:1},this.addInput("freqs","array"),this.addOutput("signal","number")}function v(){if(!v.default_code){var t=v.default_function.toString(),e=t.indexOf("{")+1,i=t.lastIndexOf("}");v.default_code=t.substr(e,i-e)}this.properties={code:v.default_code};var r=n.getAudioContext();r.createScriptProcessor?this.audionode=r.createScriptProcessor(4096,1,1):(console.warn("ScriptProcessorNode deprecated"),this.audionode=r.createGain()),this.processCode(),v._bypass_function||(v._bypass_function=this.audionode.onaudioprocess),this.addInput("in","audio"),this.addOutput("out","audio")}function m(){this.audionode=n.getAudioContext().destination,this.addInput("in","audio")}t.LGAudio=n,n.getAudioContext=function(){if(!this._audio_context){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,!window.AudioContext)return console.error("AudioContext not supported by browser"),null;this._audio_context=new AudioContext,this._audio_context.onmessage=function(t){console.log("msg",t)},this._audio_context.onended=function(t){console.log("ended",t)},this._audio_context.oncomplete=function(t){console.log("complete",t)}}return this._audio_context},n.connect=function(t,e){try{t.connect(e)}catch(t){console.warn("LGraphAudio:",t)}},n.disconnect=function(t,e){try{t.disconnect(e)}catch(t){console.warn("LGraphAudio:",t)}},n.changeAllAudiosConnections=function(t,e){if(t.inputs)for(var i=0;i<t.inputs.length;++i){var r=t.inputs[i];if(p=t.graph.links[r.link]){var o=t.graph.getNodeById(p.origin_id),s=null;s=o.getAudioNodeInOutputSlot?o.getAudioNodeInOutputSlot(p.origin_slot):o.audionode;var a=null;a=t.getAudioNodeInInputSlot?t.getAudioNodeInInputSlot(i):t.audionode,e?n.connect(s,a):n.disconnect(s,a)}}if(t.outputs)for(i=0;i<t.outputs.length;++i)for(var u=t.outputs[i],l=0;l<u.links.length;++l){var p;if(p=t.graph.links[u.links[l]]){s=null,s=t.getAudioNodeInOutputSlot?t.getAudioNodeInOutputSlot(i):t.audionode;var h=t.graph.getNodeById(p.target_id);a=null,a=h.getAudioNodeInInputSlot?h.getAudioNodeInInputSlot(p.target_slot):h.audionode,e?n.connect(s,a):n.disconnect(s,a)}}},n.onConnectionsChange=function(t,i,r,o){if(t==e.OUTPUT){var s=null;if(o&&(s=this.graph.getNodeById(o.target_id)),s){var a;a=this.getAudioNodeInOutputSlot?this.getAudioNodeInOutputSlot(i):this.audionode;var u;u=s.getAudioNodeInInputSlot?s.getAudioNodeInInputSlot(o.target_slot):s.audionode,r?n.connect(a,u):n.disconnect(a,u)}}},n.createAudioNodeWrapper=function(t){var e=t.prototype.onPropertyChanged;t.prototype.onPropertyChanged=function(t,n){e&&e.call(this,t,n),this.audionode&&void 0!==this.audionode[t]&&(void 0!==this.audionode[t].value?this.audionode[t].value=n:this.audionode[t]=n)},t.prototype.onConnectionsChange=n.onConnectionsChange},n.cached_audios={},n.loadSound=function(t,e,i){if(!n.cached_audios[t]||-1!=t.indexOf("blob:")){n.onProcessAudioURL&&(t=n.onProcessAudioURL(t));var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer";var o=n.getAudioContext();return r.onload=function(){console.log("AudioSource loaded"),o.decodeAudioData(r.response,(function(i){console.log("AudioSource decoded"),n.cached_audios[t]=i,e&&e(i)}),s)},r.send(),r}function s(t){console.log("Audio loading sample error:",t),i&&i(t)}e&&e(n.cached_audios[t])},i.desc="Plays an audio file",i["@src"]={widget:"resource"},i.supported_extensions=["wav","ogg","mp3"],i.prototype.onAdded=function(t){t.status===LGraph.STATUS_RUNNING&&this.onStart()},i.prototype.onStart=function(){this._audiobuffer&&this.properties.autoplay&&this.playBuffer(this._audiobuffer)},i.prototype.onStop=function(){this.stopAllSounds()},i.prototype.onPause=function(){this.pauseAllSounds()},i.prototype.onUnpause=function(){this.unpauseAllSounds()},i.prototype.onRemoved=function(){this.stopAllSounds(),this._dropped_url&&URL.revokeObjectURL(this._url)},i.prototype.stopAllSounds=function(){for(var t=0;t<this._audionodes.length;++t)this._audionodes[t].started&&(this._audionodes[t].started=!1,this._audionodes[t].stop());this._audionodes.length=0},i.prototype.pauseAllSounds=function(){n.getAudioContext().suspend()},i.prototype.unpauseAllSounds=function(){n.getAudioContext().resume()},i.prototype.onExecute=function(){if(this.inputs)for(var t=0;t<this.inputs.length;++t){var e=this.inputs[t];if(null!=e.link){var n=this.getInputData(t);if(void 0!==n)if("gain"==e.name)this.audionode.gain.value=n;else if("src"==e.name)this.setProperty("src",n);else if("playbackRate"==e.name){this.properties.playbackRate=n;for(var i=0;i<this._audionodes.length;++i)this._audionodes[i].playbackRate.value=n}}}if(this.outputs)for(t=0;t<this.outputs.length;++t)"buffer"==this.outputs[t].name&&this._audiobuffer&&this.setOutputData(t,this._audiobuffer)},i.prototype.onAction=function(t){this._audiobuffer&&("Play"==t?this.playBuffer(this._audiobuffer):"Stop"==t&&this.stopAllSounds())},i.prototype.onPropertyChanged=function(t,e){if("src"==t)this.loadSound(e);else if("gain"==t)this.audionode.gain.value=e;else if("playbackRate"==t)for(var n=0;n<this._audionodes.length;++n)this._audionodes[n].playbackRate.value=e},i.prototype.playBuffer=function(t){var e=this,i=n.getAudioContext().createBufferSource();return this._last_sourcenode=i,i.graphnode=this,i.buffer=t,i.loop=this.properties.loop,i.playbackRate.value=this.properties.playbackRate,this._audionodes.push(i),i.connect(this.audionode),this._audionodes.push(i),this.trigger("start"),i.onended=function(){e.trigger("ended");var t=e._audionodes.indexOf(i);-1!=t&&e._audionodes.splice(t,1)},i.started||(i.started=!0,i.start()),i},i.prototype.loadSound=function(t){var i=this;this._request&&(this._request.abort(),this._request=null),this._audiobuffer=null,this._loading_audio=!1,t&&(this._request=n.loadSound(t,(function(t){this.boxcolor=e.NODE_DEFAULT_BOXCOLOR,i._audiobuffer=t,i._loading_audio=!1,i.graph&&i.graph.status===LGraph.STATUS_RUNNING&&i.onStart()})),this._loading_audio=!0,this.boxcolor="#AA4")},i.prototype.onConnectionsChange=n.onConnectionsChange,i.prototype.onGetInputs=function(){return[["playbackRate","number"],["src","string"],["Play",e.ACTION],["Stop",e.ACTION]]},i.prototype.onGetOutputs=function(){return[["buffer","audiobuffer"],["start",e.EVENT],["ended",e.EVENT]]},i.prototype.onDropFile=function(t){this._dropped_url&&URL.revokeObjectURL(this._dropped_url);var e=URL.createObjectURL(t);this.properties.src=e,this.loadSound(e),this._dropped_url=e},i.title="Source",i.desc="Plays audio",e.registerNodeType("audio/source",i),r.prototype.onAdded=function(t){t.status===LGraph.STATUS_RUNNING&&this.onStart()},r.prototype.onStart=function(){null!=this._media_stream||this._waiting_confirmation||this.openStream()},r.prototype.onStop=function(){this.audionode.gain.value=0},r.prototype.onPause=function(){this.audionode.gain.value=0},r.prototype.onUnpause=function(){this.audionode.gain.value=this.properties.gain},r.prototype.onRemoved=function(){if(this.audionode.gain.value=0,this.audiosource_node&&(this.audiosource_node.disconnect(this.audionode),this.audiosource_node=null),this._media_stream){var t=this._media_stream.getTracks();t.length&&t[0].stop()}},r.prototype.openStream=function(){if(navigator.mediaDevices){this._waiting_confirmation=!0,navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(this.streamReady.bind(this)).catch((function(e){console.log("Media rejected",e),t._media_stream=!1,t.boxcolor="red"}));var t=this}else console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags")},r.prototype.streamReady=function(t){this._media_stream=t,this.audiosource_node&&this.audiosource_node.disconnect(this.audionode);var e=n.getAudioContext();this.audiosource_node=e.createMediaStreamSource(t),this.audiosource_node.graphnode=this,this.audiosource_node.connect(this.audionode),this.boxcolor="white"},r.prototype.onExecute=function(){if(null!=this._media_stream||this._waiting_confirmation||this.openStream(),this.inputs)for(var t=0;t<this.inputs.length;++t){var e=this.inputs[t];if(null!=e.link){var n=this.getInputData(t);void 0!==n&&"gain"==e.name&&(this.audionode.gain.value=this.properties.gain=n)}}},r.prototype.onAction=function(t){"Play"==t?this.audionode.gain.value=this.properties.gain:"Stop"==t&&(this.audionode.gain.value=0)},r.prototype.onPropertyChanged=function(t,e){"gain"==t&&(this.audionode.gain.value=e)},r.prototype.onConnectionsChange=n.onConnectionsChange,r.prototype.onGetInputs=function(){return[["playbackRate","number"],["Play",e.ACTION],["Stop",e.ACTION]]},r.title="MediaSource",r.desc="Plays microphone",e.registerNodeType("audio/media_source",r),o.prototype.onPropertyChanged=function(t,e){this.audionode[t]=e},o.prototype.onExecute=function(){if(this.isOutputConnected(0)){var t=this.audionode.frequencyBinCount;this._freq_bin&&this._freq_bin.length==t||(this._freq_bin=new Uint8Array(t)),this.audionode.getByteFrequencyData(this._freq_bin),this.setOutputData(0,this._freq_bin)}this.isOutputConnected(1)&&(t=this.audionode.frequencyBinCount,this._time_bin&&this._time_bin.length==t||(this._time_bin=new Uint8Array(t)),this.audionode.getByteTimeDomainData(this._time_bin),this.setOutputData(1,this._time_bin));for(var e=1;e<this.inputs.length;++e){var n=this.inputs[e];if(null!=n.link){var i=this.getInputData(e);void 0!==i&&(this.audionode[n.name].value=i)}}},o.prototype.onGetInputs=function(){return[["minDecibels","number"],["maxDecibels","number"],["smoothingTimeConstant","number"]]},o.prototype.onGetOutputs=function(){return[["freqs","array"],["samples","array"]]},o.title="Analyser",o.desc="Audio Analyser",e.registerNodeType("audio/analyser",o),s.prototype.onExecute=function(){if(this.inputs&&this.inputs.length)for(var t=1;t<this.inputs.length;++t){var e=this.inputs[t],n=this.getInputData(t);void 0!==n&&(this.audionode[e.name].value=n)}},n.createAudioNodeWrapper(s),s.title="Gain",s.desc="Audio gain",e.registerNodeType("audio/gain",s),n.createAudioNodeWrapper(a),a.prototype.onRemove=function(){this._dropped_url&&URL.revokeObjectURL(this._dropped_url)},a.prototype.onPropertyChanged=function(t,e){"impulse_src"==t?this.loadImpulse(e):"normalize"==t&&(this.audionode.normalize=e)},a.prototype.onDropFile=function(t){this._dropped_url&&URL.revokeObjectURL(this._dropped_url),this._dropped_url=URL.createObjectURL(t),this.properties.impulse_src=this._dropped_url,this.loadImpulse(this._dropped_url)},a.prototype.loadImpulse=function(t){var e=this;this._request&&(this._request.abort(),this._request=null),this._impulse_buffer=null,this._loading_impulse=!1,t&&(this._request=n.loadSound(t,(function(t){e._impulse_buffer=t,e.audionode.buffer=t,console.log("Impulse signal set"),e._loading_impulse=!1})),this._loading_impulse=!0)},a.title="Convolver",a.desc="Convolves the signal (used for reverb)",e.registerNodeType("audio/convolver",a),n.createAudioNodeWrapper(u),u.prototype.onExecute=function(){if(this.inputs&&this.inputs.length)for(var t=1;t<this.inputs.length;++t){var e=this.inputs[t];if(null!=e.link){var n=this.getInputData(t);void 0!==n&&(this.audionode[e.name].value=n)}}},u.prototype.onGetInputs=function(){return[["threshold","number"],["knee","number"],["ratio","number"],["reduction","number"],["attack","number"],["release","number"]]},u.title="DynamicsCompressor",u.desc="Dynamics Compressor",e.registerNodeType("audio/dynamicsCompressor",u),l.prototype.onExecute=function(){if(this.inputs&&this.inputs.length){var t=this.getInputData(1);void 0!==t&&(this.audionode.curve=t)}},l.prototype.setWaveShape=function(t){this.audionode.curve=t},n.createAudioNodeWrapper(l),p.prototype.getAudioNodeInInputSlot=function(t){return 0==t?this.audionode1:2==t?this.audionode2:void 0},p.prototype.onPropertyChanged=function(t,e){"gain1"==t?this.audionode1.gain.value=e:"gain2"==t&&(this.audionode2.gain.value=e)},p.prototype.onExecute=function(){if(this.inputs&&this.inputs.length)for(var t=1;t<this.inputs.length;++t){var e=this.inputs[t];if(null!=e.link&&"audio"!=e.type){var n=this.getInputData(t);void 0!==n&&(1==t?this.audionode1.gain.value=n:3==t&&(this.audionode2.gain.value=n))}}},n.createAudioNodeWrapper(p),p.title="Mixer",p.desc="Audio mixer",e.registerNodeType("audio/mixer",p),h.prototype.onExecute=function(){var t=n.getAudioContext().currentTime,e=this.audionode.gain,i=this.getInputData(1),r=this.getInputOrProperty("A"),o=this.getInputOrProperty("D"),s=this.getInputOrProperty("S"),a=this.getInputOrProperty("R");!this.gate&&i?(e.cancelScheduledValues(0),e.setValueAtTime(0,t),e.linearRampToValueAtTime(1,t+r),e.linearRampToValueAtTime(s,t+r+o)):this.gate&&!i&&(e.cancelScheduledValues(0),e.setValueAtTime(e.value,t),e.linearRampToValueAtTime(0,t+a)),this.gate=i},h.prototype.onGetInputs=function(){return[["A","number"],["D","number"],["S","number"],["R","number"]]},n.createAudioNodeWrapper(h),h.title="ADSR",h.desc="Audio envelope",e.registerNodeType("audio/adsr",h),n.createAudioNodeWrapper(c),c.prototype.onExecute=function(){var t=this.getInputData(1);void 0!==t&&(this.audionode.delayTime.value=t)},c.title="Delay",c.desc="Audio delay",e.registerNodeType("audio/delay",c),d.prototype.onExecute=function(){if(this.inputs&&this.inputs.length)for(var t=1;t<this.inputs.length;++t){var e=this.inputs[t];if(null!=e.link){var n=this.getInputData(t);void 0!==n&&(this.audionode[e.name].value=n)}}},d.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["Q","number"]]},n.createAudioNodeWrapper(d),d.title="BiquadFilter",d.desc="Audio filter",e.registerNodeType("audio/biquadfilter",d),f.prototype.onStart=function(){if(!this.audionode.started){this.audionode.started=!0;try{this.audionode.start()}catch(t){}}},f.prototype.onStop=function(){this.audionode.started&&(this.audionode.started=!1,this.audionode.stop())},f.prototype.onPause=function(){this.onStop()},f.prototype.onUnpause=function(){this.onStart()},f.prototype.onExecute=function(){if(this.inputs&&this.inputs.length)for(var t=0;t<this.inputs.length;++t){var e=this.inputs[t];if(null!=e.link){var n=this.getInputData(t);void 0!==n&&(this.audionode[e.name].value=n)}}},f.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["type","string"]]},n.createAudioNodeWrapper(f),f.title="Oscillator",f.desc="Oscillator",e.registerNodeType("audio/oscillator",f),g.prototype.onExecute=function(){this._last_buffer=this.getInputData(0);var t=this.getInputData(1);void 0!==t&&(this.properties.mark=t),this.setDirtyCanvas(!0,!1)},g.prototype.onDrawForeground=function(t){if(this._last_buffer){var e=this._last_buffer,i=e.length/this.size[0],r=this.size[1];t.fillStyle="black",t.fillRect(0,0,this.size[0],this.size[1]),t.strokeStyle="white",t.beginPath();var o=0;if(this.properties.continuous){t.moveTo(o,r);for(var s=0;s<e.length;s+=i)t.lineTo(o,r-e[0|s]/255*r),o++}else for(s=0;s<e.length;s+=i)t.moveTo(o+.5,r),t.lineTo(o+.5,r-e[0|s]/255*r),o++;if(t.stroke(),this.properties.mark>=0){var a=n.getAudioContext().sampleRate/e.length;(o=this.properties.mark/a*2/i)>=this.size[0]&&(o=this.size[0]-1),t.strokeStyle="red",t.beginPath(),t.moveTo(o,r),t.lineTo(o,0),t.stroke()}}},g.title="Visualization",g.desc="Audio Visualization",e.registerNodeType("audio/visualization",g),_.prototype.onExecute=function(){if(this._freqs=this.getInputData(0),this._freqs){var t=this.properties.band;void 0!==(i=this.getInputData(1))&&(t=i);var e=t/(n.getAudioContext().sampleRate/this._freqs.length)*2,i=0;if(e<0&&(i=this._freqs[0]),e>=this._freqs.length)i=this._freqs[this._freqs.length-1];else{var r=0|e,o=e-r;i=this._freqs[r]*(1-o)+this._freqs[r+1]*o}this.setOutputData(0,i/255*this.properties.amplitude)}},_.prototype.onGetInputs=function(){return[["band","number"]]},_.title="Signal",_.desc="extract the signal of some frequency",e.registerNodeType("audio/signal",_),v.prototype.onAdded=function(t){t.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback)},v["@code"]={widget:"code",type:"code"},v.prototype.onStart=function(){this.audionode.onaudioprocess=this._callback},v.prototype.onStop=function(){this.audionode.onaudioprocess=v._bypass_function},v.prototype.onPause=function(){this.audionode.onaudioprocess=v._bypass_function},v.prototype.onUnpause=function(){this.audionode.onaudioprocess=this._callback},v.prototype.onExecute=function(){},v.prototype.onRemoved=function(){this.audionode.onaudioprocess=v._bypass_function},v.prototype.processCode=function(){try{var t=new Function("properties",this.properties.code);this._script=new t(this.properties),this._old_code=this.properties.code,this._callback=this._script.onaudioprocess}catch(t){console.error("Error in onaudioprocess code",t),this._callback=v._bypass_function,this.audionode.onaudioprocess=this._callback}},v.prototype.onPropertyChanged=function(t,e){"code"==t&&(this.properties.code=e,this.processCode(),this.graph&&this.graph.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback))},v.default_function=function(){this.onaudioprocess=function(t){for(var e=t.inputBuffer,n=t.outputBuffer,i=0;i<n.numberOfChannels;i++)for(var r=e.getChannelData(i),o=n.getChannelData(i),s=0;s<e.length;s++)o[s]=r[s]}},n.createAudioNodeWrapper(v),v.title="Script",v.desc="apply script to signal",e.registerNodeType("audio/script",v),m.title="Destination",m.desc="Audio output",e.registerNodeType("audio/destination",m)}(this),function(t){var e=t.LiteGraph;function n(){this.size=[60,20],this.addInput("send",e.ACTION),this.addOutput("received",e.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"",room:"lgraph",only_send_changes:!0},this._ws=null,this._last_sent_data=[],this._last_received_data=[]}function i(){this.room_widget=this.addWidget("text","Room","lgraph",this.setRoom.bind(this)),this.addWidget("button","Reconnect",null,this.connectSocket.bind(this)),this.addInput("send",e.ACTION),this.addOutput("received",e.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"tamats.com:55000",room:"lgraph",only_send_changes:!0},this._server=null,this.connectSocket(),this._last_sent_data=[],this._last_received_data=[],"undefined"==typeof SillyClient&&console.warn("remember to add SillyClient.js to your project: https://tamats.com/projects/sillyserver/src/sillyclient.js")}function r(){this.addInput("request",e.ACTION),this.addInput("url","string"),this.addProperty("url",""),this.addOutput("ready",e.EVENT),this.addOutput("data","string"),this.addWidget("button","Fetch",null,this.fetch.bind(this)),this._data=null,this._fetching=null}n.title="WebSocket",n.desc="Send data through a websocket",n.prototype.onPropertyChanged=function(t,e){"url"==t&&this.connectSocket()},n.prototype.onExecute=function(){if(!this._ws&&this.properties.url&&this.connectSocket(),this._ws&&this._ws.readyState==WebSocket.OPEN){for(var t=this.properties.room,e=this.properties.only_send_changes,n=1;n<this.inputs.length;++n){var i=this.getInputData(n);if(null!=i){var r;try{r=JSON.stringify({type:0,room:t,channel:n,data:i})}catch(t){continue}e&&this._last_sent_data[n]==r||(this._last_sent_data[n]=r,this._ws.send(r))}}for(n=1;n<this.outputs.length;++n)this.setOutputData(n,this._last_received_data[n]);"#AFA"==this.boxcolor&&(this.boxcolor="#6C6")}},n.prototype.connectSocket=function(){var t=this,n=this.properties.url;"ws"!=n.substr(0,2)&&(n="ws://"+n),this._ws=new WebSocket(n),this._ws.onopen=function(){console.log("ready"),t.boxcolor="#6C6"},this._ws.onmessage=function(n){t.boxcolor="#AFA";var i=JSON.parse(n.data);if(!i.room||i.room==t.properties.room)if(1==i.type)if(i.data.object_class&&e[i.data.object_class]){var r=null;try{r=new e[i.data.object_class](i.data),t.triggerSlot(0,r)}catch(t){return}}else t.triggerSlot(0,i.data);else t._last_received_data[i.channel||0]=i.data},this._ws.onerror=function(e){console.log("couldnt connect to websocket"),t.boxcolor="#E88"},this._ws.onclose=function(e){console.log("connection closed"),t.boxcolor="#000"}},n.prototype.send=function(t){this._ws&&this._ws.readyState==WebSocket.OPEN&&this._ws.send(JSON.stringify({type:1,msg:t}))},n.prototype.onAction=function(t,e){this._ws&&this._ws.readyState==WebSocket.OPEN&&this._ws.send({type:1,room:this.properties.room,action:t,data:e})},n.prototype.onGetInputs=function(){return[["in",0]]},n.prototype.onGetOutputs=function(){return[["out",0]]},e.registerNodeType("network/websocket",n),i.title="SillyClient",i.desc="Connects to SillyServer to broadcast messages",i.prototype.onPropertyChanged=function(t,e){"room"==t&&(this.room_widget.value=e),this.connectSocket()},i.prototype.setRoom=function(t){this.properties.room=t,this.room_widget.value=t,this.connectSocket()},i.prototype.onDrawForeground=function(){for(var t=1;t<this.inputs.length;++t)this.inputs[t].label="in_"+t;for(t=1;t<this.outputs.length;++t)this.outputs[t].label="out_"+t},i.prototype.onExecute=function(){if(this._server&&this._server.is_connected){for(var t=this.properties.only_send_changes,e=1;e<this.inputs.length;++e){var n=this.getInputData(e),i=this._last_sent_data[e];if(null!=n){if(t){var r=!0;if(n&&n.length&&i&&i.length==n.length&&n.constructor!==String){for(var o=0;o<n.length;++o)if(i[o]!=n[o]){r=!1;break}}else this._last_sent_data[e]!=n&&(r=!1);if(r)continue}if(this._server.sendMessage({type:0,channel:e,data:n}),n.length&&n.constructor!==String)if(this._last_sent_data[e])for(this._last_sent_data[e].length=n.length,o=0;o<n.length;++o)this._last_sent_data[e][o]=n[o];else n.constructor===Array?this._last_sent_data[e]=n.concat():this._last_sent_data[e]=new n.constructor(n);else this._last_sent_data[e]=n}}for(e=1;e<this.outputs.length;++e)this.setOutputData(e,this._last_received_data[e]);"#AFA"==this.boxcolor&&(this.boxcolor="#6C6")}},i.prototype.connectSocket=function(){var t=this;if("undefined"==typeof SillyClient)return this._error||console.error("SillyClient node cannot be used, you must include SillyServer.js"),void(this._error=!0);if(this._server=new SillyClient,this._server.on_ready=function(){console.log("ready"),t.boxcolor="#6C6"},this._server.on_message=function(n,i){var r=null;try{r=JSON.parse(i)}catch(t){return}if(1==r.type)if(r.data.object_class&&e[r.data.object_class]){var o=null;try{o=new e[r.data.object_class](r.data),t.triggerSlot(0,o)}catch(t){return}}else t.triggerSlot(0,r.data);else t._last_received_data[r.channel||0]=r.data;t.boxcolor="#AFA"},this._server.on_error=function(e){console.log("couldnt connect to websocket"),t.boxcolor="#E88"},this._server.on_close=function(e){console.log("connection closed"),t.boxcolor="#000"},this.properties.url&&this.properties.room){try{this._server.connect(this.properties.url,this.properties.room)}catch(t){return console.error("SillyServer error: "+t),void(this._server=null)}this._final_url=this.properties.url+"/"+this.properties.room}},i.prototype.send=function(t){this._server&&this._server.is_connected&&this._server.sendMessage({type:1,data:t})},i.prototype.onAction=function(t,e){this._server&&this._server.is_connected&&this._server.sendMessage({type:1,action:t,data:e})},i.prototype.onGetInputs=function(){return[["in",0]]},i.prototype.onGetOutputs=function(){return[["out",0]]},e.registerNodeType("network/sillyclient",i),r.title="HTTP Request",r.desc="Fetch data through HTTP",r.prototype.fetch=function(){var t=this.properties.url;if(t){this.boxcolor="#FF0";var e=this;this._fetching=fetch(t).then((t=>{if(t.ok)return this.boxcolor="#0F0",t.text();this.boxcolor="#F00",e.trigger("error")})).then((t=>{e._data=t,e._fetching=null,e.trigger("ready")}))}},r.prototype.onAction=function(t){"request"==t&&this.fetch()},r.prototype.onExecute=function(){this.setOutputData(1,this._data)},r.prototype.onGetOutputs=function(){return[["error",e.EVENT]]},e.registerNodeType("network/httprequest",r)}(this)},146:(t,e)=>{"use strict";var n;!function(){var i=e||{}||this||window;void 0===(n=function(){return i}.apply(e,[]))||(t.exports=n),i.default=i;var r="http://www.w3.org/2000/xmlns/",o="http://www.w3.org/2000/svg",s=/url\(["']?(.+?)["']?\)/,a={woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"},u=function(t){return t instanceof HTMLElement||t instanceof SVGElement},l=function(t){if(!u(t))throw new Error("an HTMLElement or SVGElement is required; got "+t)},p=function(t){return new Promise((function(e,n){u(t)?e(t):n(new Error("an HTMLElement or SVGElement is required; got "+t))}))},h=function(t,e,n){var i=t.viewBox&&t.viewBox.baseVal&&t.viewBox.baseVal[n]||null!==e.getAttribute(n)&&!e.getAttribute(n).match(/%$/)&&parseInt(e.getAttribute(n))||t.getBoundingClientRect()[n]||parseInt(e.style[n])||parseInt(window.getComputedStyle(t).getPropertyValue(n));return null==i||isNaN(parseFloat(i))?0:i},c=function(t){for(var e=window.atob(t.split(",")[1]),n=t.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(e.length),r=new Uint8Array(i),o=0;o<e.length;o++)r[o]=e.charCodeAt(o);return new Blob([i],{type:n})},d={},f=null,g=function(t,e){var n=e||{},i=n.selectorRemap,r=n.modifyStyle,o=n.modifyCss,u=n.fonts,l=n.excludeUnusedCss,p=o||function(t,e){return(i?i(t):t)+"{"+(r?r(e):e)+"}\n"},h=[],c=void 0===u,g=u||[];return(f||(f=Array.from(document.styleSheets).map((function(t){try{return{rules:t.cssRules,href:t.href}}catch(e){return console.warn("Stylesheet could not be loaded: "+t.href,e),{}}})))).forEach((function(e){var n=e.rules,i=e.href;n&&Array.from(n).forEach((function(e){if(void 0!==e.style)if(function(t,e){if(e)try{return t.querySelector(e)||t.parentNode&&t.parentNode.querySelector(e)}catch(t){console.warn('Invalid CSS selector "'+e+'"',t)}}(t,e.selectorText))h.push(p(e.selectorText,e.style.cssText));else if(c&&e.cssText.match(/^@font-face/)){var n=function(t,e){var n=t.cssText.match(s),i=n&&n[1]||"";if(i&&!i.match(/^data:/)&&"about:blank"!==i){var r,o,u=i.startsWith("../")?e+"/../"+i:i.startsWith("./")?e+"/."+i:i;return{text:t.cssText,format:(r=u,o=Object.keys(a).filter((function(t){return r.indexOf("."+t)>0})).map((function(t){return a[t]})),o?o[0]:(console.error("Unknown font format for "+r+". Fonts may not be working correctly."),"application/octet-stream")),url:u}}}(e,i);n&&g.push(n)}else l||h.push(e.cssText)}))})),function(t){return Promise.all(t.map((function(t){return new Promise((function(e,n){if(d[t.url])return e(d[t.url]);var i=new XMLHttpRequest;i.addEventListener("load",(function(){var n=function(t){for(var e="",n=new Uint8Array(t),i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return window.btoa(e)}(i.response),r=t.text.replace(s,'url("data:'+t.format+";base64,"+n+'")')+"\n";d[t.url]=r,e(r)})),i.addEventListener("error",(function(n){console.warn("Failed to load font from: "+t.url,n),d[t.url]=null,e(null)})),i.addEventListener("abort",(function(n){console.warn("Aborted loading font from: "+t.url,n),e(null)})),i.open("GET",t.url),i.responseType="arraybuffer",i.send()}))}))).then((function(t){return t.filter((function(t){return t})).join("")}))}(g).then((function(t){return h.join("\n")+t}))},_=function(){if(!navigator.msSaveOrOpenBlob&&!("download"in document.createElement("a")))return{popup:window.open()}};i.prepareSvg=function(t,e,n){l(t);var i=e||{},s=i.left,a=void 0===s?0:s,u=i.top,p=void 0===u?0:u,c=i.width,d=i.height,f=i.scale,_=void 0===f?1:f,v=i.responsive,m=void 0!==v&&v,y=i.excludeCss,b=void 0!==y&&y;return function(t){return Promise.all(Array.from(t.querySelectorAll("image")).map((function(t){var e,n=t.getAttributeNS("http://www.w3.org/1999/xlink","href")||t.getAttribute("href");return n?((e=n)&&0===e.lastIndexOf("http",0)&&-1===e.lastIndexOf(window.location.host)&&(n+=(-1===n.indexOf("?")?"?":"&")+"t="+(new Date).valueOf()),new Promise((function(e,i){var r=document.createElement("canvas"),o=new Image;o.crossOrigin="anonymous",o.src=n,o.onerror=function(){return i(new Error("Could not load "+n))},o.onload=function(){r.width=o.width,r.height=o.height,r.getContext("2d").drawImage(o,0,0),t.setAttributeNS("http://www.w3.org/1999/xlink","href",r.toDataURL("image/png")),e(!0)}}))):Promise.resolve(null)})))}(t).then((function(){var i=t.cloneNode(!0);i.style.backgroundColor=(e||{}).backgroundColor||t.style.backgroundColor;var s=function(t,e,n,i){if("svg"===t.tagName)return{width:n||h(t,e,"width"),height:i||h(t,e,"height")};if(t.getBBox){var r=t.getBBox(),o=r.x,s=r.y;return{width:o+r.width,height:s+r.height}}}(t,i,c,d),u=s.width,l=s.height;if("svg"!==t.tagName){if(!t.getBBox)return void console.error("Attempted to render non-SVG element",t);null!=i.getAttribute("transform")&&i.setAttribute("transform",i.getAttribute("transform").replace(/translate\(.*?\)/,""));var f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.appendChild(i),i=f}if(i.setAttribute("version","1.1"),i.setAttribute("viewBox",[a,p,u,l].join(" ")),i.getAttribute("xmlns")||i.setAttributeNS(r,"xmlns",o),i.getAttribute("xmlns:xlink")||i.setAttributeNS(r,"xmlns:xlink","http://www.w3.org/1999/xlink"),m?(i.removeAttribute("width"),i.removeAttribute("height"),i.setAttribute("preserveAspectRatio","xMinYMin meet")):(i.setAttribute("width",u*_),i.setAttribute("height",l*_)),Array.from(i.querySelectorAll("foreignObject > *")).forEach((function(t){t.setAttributeNS(r,"xmlns","svg"===t.tagName?o:"http://www.w3.org/1999/xhtml")})),!b)return g(t,e).then((function(t){var e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML="<![CDATA[\n"+t+"\n]]>";var r=document.createElement("defs");r.appendChild(e),i.insertBefore(r,i.firstChild);var o=document.createElement("div");o.appendChild(i);var s=o.innerHTML.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');if("function"!=typeof n)return{src:s,width:u,height:l};n(s,u,l)}));var v=document.createElement("div");v.appendChild(i);var y=v.innerHTML;if("function"!=typeof n)return{src:y,width:u,height:l};n(y,u,l)}))},i.svgAsDataUri=function(t,e,n){return l(t),i.prepareSvg(t,e).then((function(t){var e=t.src,i=t.width,r=t.height,o="data:image/svg+xml;base64,"+window.btoa(decodeURIComponent(encodeURIComponent('<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>'+e).replace(/%([0-9A-F]{2})/g,(function(t,e){var n=String.fromCharCode("0x"+e);return"%"===n?"%25":n}))));return"function"==typeof n&&n(o,i,r),o}))},i.svgAsPngUri=function(t,e,n){l(t);var r=e||{},o=r.encoderType,s=void 0===o?"image/png":o,a=r.encoderOptions,u=void 0===a?.8:a,p=r.canvg,h=function(t){var e=t.src,i=t.width,r=t.height,o=document.createElement("canvas"),a=o.getContext("2d"),l=window.devicePixelRatio||1;o.width=i*l,o.height=r*l,o.style.width=o.width+"px",o.style.height=o.height+"px",a.setTransform(l,0,0,l,0,0),p?p(o,e):a.drawImage(e,0,0);var h=void 0;try{h=o.toDataURL(s,u)}catch(t){if("undefined"!=typeof SecurityError&&t instanceof SecurityError||"SecurityError"===t.name)return void console.error("Rendered SVG images cannot be downloaded in this browser.");throw t}return"function"==typeof n&&n(h,o.width,o.height),Promise.resolve(h)};return p?i.prepareSvg(t,e).then(h):i.svgAsDataUri(t,e).then((function(t){return new Promise((function(e,n){var i=new Image;i.onload=function(){return e(h({src:i,width:i.width,height:i.height}))},i.onerror=function(){n("There was an error loading the data URI as an image on the following SVG\n"+window.atob(t.slice(26))+"Open the following link to see browser's diagnosis\n"+t)},i.src=t}))}))},i.download=function(t,e,n){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(c(e),t);else{var i=document.createElement("a");if("download"in i){i.download=t,i.style.display="none",document.body.appendChild(i);try{var r=c(e),o=URL.createObjectURL(r);i.href=o,i.onclick=function(){return requestAnimationFrame((function(){return URL.revokeObjectURL(o)}))}}catch(t){console.error(t),console.warn("Error while getting object URL. Falling back to string URL."),i.href=e}i.click(),document.body.removeChild(i)}else n&&n.popup&&(n.popup.document.title=t,n.popup.location.replace(e))}},i.saveSvg=function(t,e,n){var r=_();return p(t).then((function(t){return i.svgAsDataUri(t,n||{})})).then((function(t){return i.download(e,t,r)}))},i.saveSvgAsPng=function(t,e,n){var r=_();return p(t).then((function(t){return i.svgAsPngUri(t,n||{})})).then((function(t){return i.download(e,t,r)}))}}()},72:t=>{"use strict";var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var o={},s=[],a=0;a<t.length;a++){var u=t[a],l=i.base?u[0]+i.base:u[0],p=o[l]||0,h="".concat(l," ").concat(p);o[l]=p+1;var c=n(h),d={css:u[1],media:u[2],sourceMap:u[3],supports:u[4],layer:u[5]};if(-1!==c)e[c].references++,e[c].updater(d);else{var f=r(d,i);i.byIndex=a,e.splice(a,0,{identifier:h,updater:f,references:1})}s.push(h)}return s}function r(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,r){var o=i(t=t||[],r=r||{});return function(t){t=t||[];for(var s=0;s<o.length;s++){var a=n(o[s]);e[a].references--}for(var u=i(t,r),l=0;l<o.length;l++){var p=n(o[l]);0===e[p].references&&(e[p].updater(),e.splice(p,1))}o=u}}},659:t=>{"use strict";var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},540:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},56:(t,e,n)=>{"use strict";t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},825:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},113:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var n=__webpack_module_cache__[t]={id:t,exports:{}};return __webpack_modules__[t].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var getCurrentScript=function(){var t=document.currentScript;if(!t){for(var e=document.getElementsByTagName("script"),n=[],i=0;i<e.length;i++)n.push(e[i]);t=(n=n.filter((function(t){return!t.async&&!t.text&&!t.textContent}))).slice(-1)[0]}return t},isLocalScript=function(t){return/\/_dash-component-suites\//.test(t.src)},url;if(Object.defineProperty(__webpack_require__,"p",{get:(url=getCurrentScript().src.split("/").slice(0,-1).join("/")+"/",function(){return url})}),"undefined"!=typeof jsonpScriptSrc){var __jsonpScriptSrc__=jsonpScriptSrc;jsonpScriptSrc=function(t){var e=getCurrentScript(),n=isLocalScript(e),i=__jsonpScriptSrc__(t);if(!n)return i;var r=i.split("/"),o=r.slice(-1)[0].split(".");return o.splice(1,0,"v0_0_1m1737944403"),r.splice(-1,1,o.join(".")),r.join("/")}}__webpack_require__.nc=void 0;var __webpack_exports__={};(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Litegraph:()=>Pu,Mermaid:()=>f,Reactflow:()=>du});const t=window.React;var e=__webpack_require__.n(t);const n=window.PropTypes;var i=__webpack_require__.n(n),r=__webpack_require__(146);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){u(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(t,e,n){return(e=function(t){var e=function(t){if("object"!=o(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==o(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(){l=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",p=s.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function c(t,e,n,i){var o=e&&e.prototype instanceof y?e:y,s=Object.create(o.prototype),a=new D(i||[]);return r(s,"_invoke",{value:S(t,n,a)}),s}function d(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",g="suspendedYield",_="executing",v="completed",m={};function y(){}function b(){}function x(){}var A={};h(A,a,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(k([])));E&&E!==n&&i.call(E,a)&&(A=E);var C=x.prototype=y.prototype=Object.create(A);function T(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function n(r,s,a,u){var l=d(t[r],t,s);if("throw"!==l.type){var p=l.arg,h=p.value;return h&&"object"==o(h)&&i.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):e.resolve(h).then((function(t){p.value=t,a(p)}),(function(t){return n("throw",t,a,u)}))}u(l.arg)}var s;r(this,"_invoke",{value:function(t,i){function r(){return new e((function(e,r){n(t,i,e,r)}))}return s=s?s.then(r,r):r()}})}function S(e,n,i){var r=f;return function(o,s){if(r===_)throw Error("Generator is already running");if(r===v){if("throw"===o)throw s;return{value:t,done:!0}}for(i.method=o,i.arg=s;;){var a=i.delegate;if(a){var u=I(a,i);if(u){if(u===m)continue;return u}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===f)throw r=v,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=_;var l=d(e,n,i);if("normal"===l.type){if(r=i.done?v:g,l.arg===m)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=v,i.method="throw",i.arg=l.arg)}}}function I(e,n){var i=n.method,r=e.iterator[i];if(r===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,I(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m;var o=d(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var s=o.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function D(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function k(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}throw new TypeError(o(e)+" is not iterable")}return b.prototype=x,r(C,"constructor",{value:x,configurable:!0}),r(x,"constructor",{value:b,configurable:!0}),b.displayName=h(x,p,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,h(t,p,"GeneratorFunction")),t.prototype=Object.create(C),t},e.awrap=function(t){return{__await:t}},T(O.prototype),h(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,n,i,r,o){void 0===o&&(o=Promise);var s=new O(c(t,n,i,r),o);return e.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},T(C),h(C,p,"Generator"),h(C,a,(function(){return this})),h(C,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=k,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(i,r){return a.type="throw",a.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var u=i.call(s,"catchLoc"),l=i.call(s,"finallyLoc");if(u&&l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;N(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:k(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),m}},e}function p(t,e,n,i,r,o,s){try{var a=t[o](s),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(i,r)}function h(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(t){p(o,i,r,s,a,"next",t)}function a(t){p(o,i,r,s,a,"throw",t)}s(void 0)}))}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}var d=function(n){var i,o,s=n.id,u=n.chart,p=n.config,d=n.className,f=n.export_trigger,g=n.setProps,_=(0,t.useRef)(null),v=(0,t.useRef)(null),m=(i=e().useState(f),o=2,function(t){if(Array.isArray(t))return t}(i)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o,s,a=[],u=!0,l=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(a.push(i.value),a.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw r}}return a}}(i,o)||function(t,e){if(t){if("string"==typeof t)return c(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}(i,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),y=m[0],b=m[1],x=function(){var t=h(l().mark((function t(){var e,n,i,o,s,a;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("Starting Mermaid diagram export..."),t.prev=1,e=_.current.querySelector("svg")){t.next=6;break}return console.error("SVG element not found in Mermaid diagram"),t.abrupt("return");case 6:return n=new Date,i="".concat(n.getFullYear(),"-").concat(String(n.getMonth()+1).padStart(2,"0"),"-").concat(String(n.getDate()).padStart(2,"0")),o="".concat(String(n.getHours()).padStart(2,"0")).concat(String(n.getMinutes()).padStart(2,"0")).concat(String(n.getSeconds()).padStart(2,"0")),s="mermaid_".concat(i,"_").concat(o,".png"),console.log("Found SVG, preparing to export...",{width:e.width.baseVal.value,height:e.height.baseVal.value,viewBox:e.getAttribute("viewBox")}),a={scale:2,backgroundColor:"#ffffff",encoderOptions:1,encoderType:"image/png",fonts:[],excludeUnusedCss:!0,width:e.width.baseVal.value,height:e.height.baseVal.value},t.prev=12,t.next=15,(0,r.svgAsPngUri)(e,a);case 15:return t.sent,console.log("Successfully generated PNG URI"),t.next=19,(0,r.saveSvgAsPng)(e,s,a);case 19:console.log("Export completed successfully"),t.next=26;break;case 22:throw t.prev=22,t.t0=t.catch(12),console.error("Error during PNG conversion:",t.t0),t.t0;case 26:t.next=31;break;case 28:t.prev=28,t.t1=t.catch(1),console.error("Error in generateImage:",t.t1);case 31:case"end":return t.stop()}}),t,null,[[1,28],[12,22]])})));return function(){return t.apply(this,arguments)}}();return(0,t.useEffect)((function(){f!==y&&(console.log("Export triggered"),x(),b(f),g&&g({export_trigger:f}))}),[f,y,g]),(0,t.useEffect)((function(){var t=function(){var t=h(l().mark((function t(){var e;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(_.current&&u){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,new Promise((function(t,e){if(window.mermaid)t();else{if(v.current)return v.current.addEventListener("load",(function(){return t()})),void v.current.addEventListener("error",(function(){return e()}));var n=document.createElement("script");n.src="https://unpkg.com/mermaid@11.4.1/dist/mermaid.min.js",n.async=!0,n.onload=function(){return t()},n.onerror=function(){return e()},v.current=n,document.body.appendChild(n)}}));case 5:if(window.mermaid&&(window.mermaid.initialize(a(a({},{startOnLoad:!0,theme:"default",securityLevel:"loose"}),p)),1)){t.next=7;break}throw new Error("Failed to initialize Mermaid");case 7:return _.current.innerHTML="",(e=document.createElement("pre")).className="mermaid",e.textContent=u,_.current.appendChild(e),t.next=14,window.mermaid.run({nodes:[e]});case 14:t.next=20;break;case 16:t.prev=16,t.t0=t.catch(2),console.error("Mermaid rendering error:",t.t0),_.current&&(_.current.innerHTML='\n                        <div style="color: red; padding: 10px; border: 1px solid red; border-radius: 4px;">\n                            Error rendering diagram: '.concat(t.t0.message||"Unknown error","\n                        </div>"));case 20:case"end":return t.stop()}}),t,null,[[2,16]])})));return function(){return t.apply(this,arguments)}}();return t(),function(){v.current&&v.current.parentNode&&(v.current.parentNode.removeChild(v.current),v.current=null)}}),[u,p]),e().createElement("div",{id:s,className:d,ref:_,style:{width:"100%",minHeight:"100px",backgroundColor:"#ffffff",padding:"20px"}})};d.defaultProps={className:"",config:null,export_trigger:0},d.propTypes={id:i().string.isRequired,chart:i().string.isRequired,config:i().object,className:i().string,export_trigger:i().number,setProps:i().func};const f=d;const g="undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?t.useEffect:t.useLayoutEffect;var _={value:()=>{}};function v(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new m(i)}function m(t){this._=t}function y(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}function b(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=_,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}m.prototype=v.prototype={constructor:m,on:function(t,e){var n,i,r=this._,o=(i=r,(t+"").trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!i.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),s=-1,a=o.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++s<a;)if(n=(t=o[s]).type)r[n]=b(r[n],t.name,e);else if(null==e)for(n in r)r[n]=b(r[n],t.name,null);return this}for(;++s<a;)if((n=(t=o[s]).type)&&(n=y(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new m(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),o=0;o<n;++o)r[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(i=this._[t]).length;o<n;++o)i[o].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,o=i.length;r<o;++r)i[r].value.apply(e,n)}};const x=v;function A(){}function w(t){return null==t?A:function(){return this.querySelector(t)}}function E(){return[]}function C(t){return null==t?E:function(){return this.querySelectorAll(t)}}function T(t){return function(){return this.matches(t)}}function O(t){return function(e){return e.matches(t)}}var S=Array.prototype.find;function I(){return this.firstElementChild}var L=Array.prototype.filter;function N(){return Array.from(this.children)}function D(t){return new Array(t.length)}function k(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function G(t,e,n,i,r,o){for(var s,a=0,u=e.length,l=o.length;a<l;++a)(s=e[a])?(s.__data__=o[a],i[a]=s):n[a]=new k(t,o[a]);for(;a<u;++a)(s=e[a])&&(r[a]=s)}function P(t,e,n,i,r,o,s){var a,u,l,p=new Map,h=e.length,c=o.length,d=new Array(h);for(a=0;a<h;++a)(u=e[a])&&(d[a]=l=s.call(u,u.__data__,a,e)+"",p.has(l)?r[a]=u:p.set(l,u));for(a=0;a<c;++a)l=s.call(t,o[a],a,o)+"",(u=p.get(l))?(i[a]=u,u.__data__=o[a],p.delete(l)):n[a]=new k(t,o[a]);for(a=0;a<h;++a)(u=e[a])&&p.get(d[a])===u&&(r[a]=u)}function B(t){return t.__data__}function R(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function M(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}k.prototype={constructor:k,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var z="http://www.w3.org/1999/xhtml";const F={svg:"http://www.w3.org/2000/svg",xhtml:z,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function j(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),F.hasOwnProperty(e)?{space:F[e],local:t}:t}function H(t){return function(){this.removeAttribute(t)}}function U(t){return function(){this.removeAttributeNS(t.space,t.local)}}function V(t,e){return function(){this.setAttribute(t,e)}}function W(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function X(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function Y(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function q(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Z(t){return function(){this.style.removeProperty(t)}}function K(t,e,n){return function(){this.style.setProperty(t,e,n)}}function $(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function Q(t,e){return t.style.getPropertyValue(e)||q(t).getComputedStyle(t,null).getPropertyValue(e)}function J(t){return function(){delete this[t]}}function tt(t,e){return function(){this[t]=e}}function et(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function nt(t){return t.trim().split(/^|\s+/)}function it(t){return t.classList||new rt(t)}function rt(t){this._node=t,this._names=nt(t.getAttribute("class")||"")}function ot(t,e){for(var n=it(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function st(t,e){for(var n=it(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function at(t){return function(){ot(this,t)}}function ut(t){return function(){st(this,t)}}function lt(t,e){return function(){(e.apply(this,arguments)?ot:st)(this,t)}}function pt(){this.textContent=""}function ht(t){return function(){this.textContent=t}}function ct(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function dt(){this.innerHTML=""}function ft(t){return function(){this.innerHTML=t}}function gt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function _t(){this.nextSibling&&this.parentNode.appendChild(this)}function vt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function mt(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===z&&e.documentElement.namespaceURI===z?e.createElement(t):e.createElementNS(n,t)}}function yt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function bt(t){var e=j(t);return(e.local?yt:mt)(e)}function xt(){return null}function At(){var t=this.parentNode;t&&t.removeChild(this)}function wt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Et(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ct(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,o=e.length;i<o;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function Tt(t,e,n){return function(){var i,r=this.__on,o=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===t.type&&i.name===t.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),void(i.value=e);this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function Ot(t,e,n){var i=q(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function St(t,e){return function(){return Ot(this,t,e)}}function It(t,e){return function(){return Ot(this,t,e.apply(this,arguments))}}rt.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Lt=[null];function Nt(t,e){this._groups=t,this._parents=e}function Dt(){return new Nt([[document.documentElement]],Lt)}Nt.prototype=Dt.prototype={constructor:Nt,select:function(t){"function"!=typeof t&&(t=w(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,s,a=e[r],u=a.length,l=i[r]=new Array(u),p=0;p<u;++p)(o=a[p])&&(s=t.call(o,o.__data__,p,a))&&("__data__"in o&&(s.__data__=o.__data__),l[p]=s);return new Nt(i,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}(t):C(t);for(var e=this._groups,n=e.length,i=[],r=[],o=0;o<n;++o)for(var s,a=e[o],u=a.length,l=0;l<u;++l)(s=a[l])&&(i.push(t.call(s,s.__data__,l,a)),r.push(s));return new Nt(i,r)},selectChild:function(t){return this.select(null==t?I:function(t){return function(){return S.call(this.children,t)}}("function"==typeof t?t:O(t)))},selectChildren:function(t){return this.selectAll(null==t?N:function(t){return function(){return L.call(this.children,t)}}("function"==typeof t?t:O(t)))},filter:function(t){"function"!=typeof t&&(t=T(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,s=e[r],a=s.length,u=i[r]=[],l=0;l<a;++l)(o=s[l])&&t.call(o,o.__data__,l,s)&&u.push(o);return new Nt(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,B);var n,i=e?P:G,r=this._parents,o=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var s=o.length,a=new Array(s),u=new Array(s),l=new Array(s),p=0;p<s;++p){var h=r[p],c=o[p],d=c.length,f=R(t.call(h,h&&h.__data__,p,r)),g=f.length,_=u[p]=new Array(g),v=a[p]=new Array(g);i(h,c,_,v,l[p]=new Array(d),f,e);for(var m,y,b=0,x=0;b<g;++b)if(m=_[b]){for(b>=x&&(x=b+1);!(y=v[x])&&++x<g;);m._next=y||null}}return(a=new Nt(a,r))._enter=u,a._exit=l,a},enter:function(){return new Nt(this._enter||this._groups.map(D),this._parents)},exit:function(){return new Nt(this._exit||this._groups.map(D),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,o=this.exit();return"function"==typeof t?(i=t(i))&&(i=i.selection()):i=i.append(t+""),null!=e&&(r=e(r))&&(r=r.selection()),null==n?o.remove():n(o),i&&r?i.merge(r).order():r},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,o=i.length,s=Math.min(r,o),a=new Array(r),u=0;u<s;++u)for(var l,p=n[u],h=i[u],c=p.length,d=a[u]=new Array(c),f=0;f<c;++f)(l=p[f]||h[f])&&(d[f]=l);for(;u<r;++u)a[u]=n[u];return new Nt(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],o=r.length-1,s=r[o];--o>=0;)(i=r[o])&&(s&&4^i.compareDocumentPosition(s)&&s.parentNode.insertBefore(i,s),s=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=M);for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var s,a=n[o],u=a.length,l=r[o]=new Array(u),p=0;p<u;++p)(s=a[p])&&(l[p]=s);l.sort(e)}return new Nt(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,o=i.length;r<o;++r){var s=i[r];if(s)return s}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,o=e[n],s=0,a=o.length;s<a;++s)(r=o[s])&&t.call(r,r.__data__,s,o);return this},attr:function(t,e){var n=j(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?U:H:"function"==typeof e?n.local?Y:X:n.local?W:V)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?Z:"function"==typeof e?$:K)(t,e,null==n?"":n)):Q(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?J:"function"==typeof e?et:tt)(t,e)):this.node()[t]},classed:function(t,e){var n=nt(t+"");if(arguments.length<2){for(var i=it(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?lt:e?at:ut)(n,e))},text:function(t){return arguments.length?this.each(null==t?pt:("function"==typeof t?ct:ht)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?dt:("function"==typeof t?gt:ft)(t)):this.node().innerHTML},raise:function(){return this.each(_t)},lower:function(){return this.each(vt)},append:function(t){var e="function"==typeof t?t:bt(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:bt(t),i=null==e?xt:"function"==typeof e?e:w(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(At)},clone:function(t){return this.select(t?Et:wt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,o=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}(t+""),s=o.length;if(!(arguments.length<2)){for(a=e?Tt:Ct,i=0;i<s;++i)this.each(a(o[i],e,n));return this}var a=this.node().__on;if(a)for(var u,l=0,p=a.length;l<p;++l)for(i=0,u=a[l];i<s;++i)if((r=o[i]).type===u.type&&r.name===u.name)return u.value},dispatch:function(t,e){return this.each(("function"==typeof e?It:St)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i,r=t[e],o=0,s=r.length;o<s;++o)(i=r[o])&&(yield i)}};const kt=Dt;function Gt(t){return"string"==typeof t?new Nt([[document.querySelector(t)]],[document.documentElement]):new Nt([[t]],Lt)}const Pt={passive:!1},Bt={capture:!0,passive:!1};function Rt(t){t.stopImmediatePropagation()}function Mt(t){t.preventDefault(),t.stopImmediatePropagation()}function zt(t){var e=t.document.documentElement,n=Gt(t).on("dragstart.drag",Mt,Bt);"onselectstart"in e?n.on("selectstart.drag",Mt,Bt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Ft(t,e){var n=t.document.documentElement,i=Gt(t).on("dragstart.drag",null);e&&(i.on("click.drag",Mt,Bt),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function jt(t){return((t=Math.exp(t))+1/t)/2}const Ht=function t(e,n,i){function r(t,r){var o,s,a=t[0],u=t[1],l=t[2],p=r[0],h=r[1],c=r[2],d=p-a,f=h-u,g=d*d+f*f;if(g<1e-12)s=Math.log(c/l)/e,o=function(t){return[a+t*d,u+t*f,l*Math.exp(e*t*s)]};else{var _=Math.sqrt(g),v=(c*c-l*l+i*g)/(2*l*n*_),m=(c*c-l*l-i*g)/(2*c*n*_),y=Math.log(Math.sqrt(v*v+1)-v),b=Math.log(Math.sqrt(m*m+1)-m);s=(b-y)/e,o=function(t){var i,r=t*s,o=jt(y),p=l/(n*_)*(o*(i=e*r+y,((i=Math.exp(2*i))-1)/(i+1))-function(t){return((t=Math.exp(t))-1/t)/2}(y));return[a+p*d,u+p*f,l*o/jt(e*r+y)]}}return o.duration=1e3*s*e/Math.SQRT2,o}return r.rho=function(e){var n=Math.max(.001,+e),i=n*n;return t(n,i,i*i)},r}(Math.SQRT2,2,4);function Ut(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,[(i=i.matrixTransform(e.getScreenCTM().inverse())).x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}var Vt,Wt,Xt=0,Yt=0,qt=0,Zt=0,Kt=0,$t=0,Qt="object"==typeof performance&&performance.now?performance:Date,Jt="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function te(){return Kt||(Jt(ee),Kt=Qt.now()+$t)}function ee(){Kt=0}function ne(){this._call=this._time=this._next=null}function ie(t,e,n){var i=new ne;return i.restart(t,e,n),i}function re(){Kt=(Zt=Qt.now())+$t,Xt=Yt=0;try{!function(){te(),++Xt;for(var t,e=Vt;e;)(t=Kt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Xt}()}finally{Xt=0,function(){for(var t,e,n=Vt,i=1/0;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Vt=e);Wt=t,se(i)}(),Kt=0}}function oe(){var t=Qt.now(),e=t-Zt;e>1e3&&($t-=e,Zt=t)}function se(t){Xt||(Yt&&(Yt=clearTimeout(Yt)),t-Kt>24?(t<1/0&&(Yt=setTimeout(re,t-Qt.now()-$t)),qt&&(qt=clearInterval(qt))):(qt||(Zt=Qt.now(),qt=setInterval(oe,1e3)),Xt=1,Jt(re)))}function ae(t,e,n){var i=new ne;return e=null==e?0:+e,i.restart((n=>{i.stop(),t(n+e)}),e,n),i}ne.prototype=ie.prototype={constructor:ne,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?te():+n)+(null==e?0:+e),this._next||Wt===this||(Wt?Wt._next=this:Vt=this,Wt=this),this._call=t,this._time=n,se()},stop:function(){this._call&&(this._call=null,this._time=1/0,se())}};var ue=x("start","end","cancel","interrupt"),le=[];function pe(t,e,n,i,r,o){var s=t.__transition;if(s){if(n in s)return}else t.__transition={};!function(t,e,n){var i,r=t.__transition;function o(u){var l,p,h,c;if(1!==n.state)return a();for(l in r)if((c=r[l]).name===n.name){if(3===c.state)return ae(o);4===c.state?(c.state=6,c.timer.stop(),c.on.call("interrupt",t,t.__data__,c.index,c.group),delete r[l]):+l<e&&(c.state=6,c.timer.stop(),c.on.call("cancel",t,t.__data__,c.index,c.group),delete r[l])}if(ae((function(){3===n.state&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(u))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(h=n.tween.length),l=0,p=-1;l<h;++l)(c=n.tween[l].value.call(t,t.__data__,n.index,n.group))&&(i[++p]=c);i.length=p+1}}function s(e){for(var r=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(a),n.state=5,1),o=-1,s=i.length;++o<s;)i[o].call(t,r);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){for(var i in n.state=6,n.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=n,n.timer=ie((function(t){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)}),0,n.time)}(t,n,{name:e,index:i,group:r,on:ue,tween:le,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function he(t,e){var n=de(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function ce(t,e){var n=de(t,e);if(n.state>3)throw new Error("too late; already running");return n}function de(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function fe(t,e){var n,i,r,o=t.__transition,s=!0;if(o){for(r in e=null==e?null:e+"",o)(n=o[r]).name===e?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete o[r]):s=!1;s&&delete t.__transition}}function ge(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var _e,ve=180/Math.PI,me={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ye(t,e,n,i,r,o){var s,a,u;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(u=t*n+e*i)&&(n-=t*u,i-=e*u),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,u/=a),t*i<e*n&&(t=-t,e=-e,u=-u,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(e,t)*ve,skewX:Math.atan(u)*ve,scaleX:s,scaleY:a}}function be(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(o,s){var a=[],u=[];return o=t(o),s=t(s),function(t,i,r,o,s,a){if(t!==r||i!==o){var u=s.push("translate(",null,e,null,n);a.push({i:u-4,x:ge(t,r)},{i:u-2,x:ge(i,o)})}else(r||o)&&s.push("translate("+r+e+o+n)}(o.translateX,o.translateY,s.translateX,s.translateY,a,u),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(r(n)+"rotate(",null,i)-2,x:ge(t,e)})):e&&n.push(r(n)+"rotate("+e+i)}(o.rotate,s.rotate,a,u),function(t,e,n,o){t!==e?o.push({i:n.push(r(n)+"skewX(",null,i)-2,x:ge(t,e)}):e&&n.push(r(n)+"skewX("+e+i)}(o.skewX,s.skewX,a,u),function(t,e,n,i,o,s){if(t!==n||e!==i){var a=o.push(r(o)+"scale(",null,",",null,")");s.push({i:a-4,x:ge(t,n)},{i:a-2,x:ge(e,i)})}else 1===n&&1===i||o.push(r(o)+"scale("+n+","+i+")")}(o.scaleX,o.scaleY,s.scaleX,s.scaleY,a,u),o=s=null,function(t){for(var e,n=-1,i=u.length;++n<i;)a[(e=u[n]).i]=e.x(t);return a.join("")}}}var xe=be((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?me:ye(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),Ae=be((function(t){return null==t?me:(_e||(_e=document.createElementNS("http://www.w3.org/2000/svg","g")),_e.setAttribute("transform",t),(t=_e.transform.baseVal.consolidate())?ye((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):me)}),", ",")",")");function we(t,e){var n,i;return function(){var r=ce(this,t),o=r.tween;if(o!==n)for(var s=0,a=(i=n=o).length;s<a;++s)if(i[s].name===e){(i=i.slice()).splice(s,1);break}r.tween=i}}function Ee(t,e,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var o=ce(this,t),s=o.tween;if(s!==i){r=(i=s).slice();for(var a={name:e,value:n},u=0,l=r.length;u<l;++u)if(r[u].name===e){r[u]=a;break}u===l&&r.push(a)}o.tween=r}}function Ce(t,e,n){var i=t._id;return t.each((function(){var t=ce(this,i);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return de(t,i).value[e]}}function Te(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Oe(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function Se(){}var Ie=.7,Le=1/Ie,Ne="\\s*([+-]?\\d+)\\s*",De="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ke="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ge=/^#([0-9a-f]{3,8})$/,Pe=new RegExp(`^rgb\\(${Ne},${Ne},${Ne}\\)$`),Be=new RegExp(`^rgb\\(${ke},${ke},${ke}\\)$`),Re=new RegExp(`^rgba\\(${Ne},${Ne},${Ne},${De}\\)$`),Me=new RegExp(`^rgba\\(${ke},${ke},${ke},${De}\\)$`),ze=new RegExp(`^hsl\\(${De},${ke},${ke}\\)$`),Fe=new RegExp(`^hsla\\(${De},${ke},${ke},${De}\\)$`),je={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function He(){return this.rgb().formatHex()}function Ue(){return this.rgb().formatRgb()}function Ve(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Ge.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?We(e):3===n?new qe(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Xe(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Xe(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Pe.exec(t))?new qe(e[1],e[2],e[3],1):(e=Be.exec(t))?new qe(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Re.exec(t))?Xe(e[1],e[2],e[3],e[4]):(e=Me.exec(t))?Xe(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=ze.exec(t))?tn(e[1],e[2]/100,e[3]/100,1):(e=Fe.exec(t))?tn(e[1],e[2]/100,e[3]/100,e[4]):je.hasOwnProperty(t)?We(je[t]):"transparent"===t?new qe(NaN,NaN,NaN,0):null}function We(t){return new qe(t>>16&255,t>>8&255,255&t,1)}function Xe(t,e,n,i){return i<=0&&(t=e=n=NaN),new qe(t,e,n,i)}function Ye(t,e,n,i){return 1===arguments.length?((r=t)instanceof Se||(r=Ve(r)),r?new qe((r=r.rgb()).r,r.g,r.b,r.opacity):new qe):new qe(t,e,n,null==i?1:i);var r}function qe(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function Ze(){return`#${Je(this.r)}${Je(this.g)}${Je(this.b)}`}function Ke(){const t=$e(this.opacity);return`${1===t?"rgb(":"rgba("}${Qe(this.r)}, ${Qe(this.g)}, ${Qe(this.b)}${1===t?")":`, ${t})`}`}function $e(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Qe(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Je(t){return((t=Qe(t))<16?"0":"")+t.toString(16)}function tn(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new nn(t,e,n,i)}function en(t){if(t instanceof nn)return new nn(t.h,t.s,t.l,t.opacity);if(t instanceof Se||(t=Ve(t)),!t)return new nn;if(t instanceof nn)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),o=Math.max(e,n,i),s=NaN,a=o-r,u=(o+r)/2;return a?(s=e===o?(n-i)/a+6*(n<i):n===o?(i-e)/a+2:(e-n)/a+4,a/=u<.5?o+r:2-o-r,s*=60):a=u>0&&u<1?0:s,new nn(s,a,u,t.opacity)}function nn(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function rn(t){return(t=(t||0)%360)<0?t+360:t}function on(t){return Math.max(0,Math.min(1,t||0))}function sn(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function an(t,e,n,i,r){var o=t*t,s=o*t;return((1-3*t+3*o-s)*e+(4-6*o+3*s)*n+(1+3*t+3*o-3*s)*i+s*r)/6}Te(Se,Ve,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:He,formatHex:He,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return en(this).formatHsl()},formatRgb:Ue,toString:Ue}),Te(qe,Ye,Oe(Se,{brighter(t){return t=null==t?Le:Math.pow(Le,t),new qe(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?Ie:Math.pow(Ie,t),new qe(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new qe(Qe(this.r),Qe(this.g),Qe(this.b),$e(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ze,formatHex:Ze,formatHex8:function(){return`#${Je(this.r)}${Je(this.g)}${Je(this.b)}${Je(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Ke,toString:Ke})),Te(nn,(function(t,e,n,i){return 1===arguments.length?en(t):new nn(t,e,n,null==i?1:i)}),Oe(Se,{brighter(t){return t=null==t?Le:Math.pow(Le,t),new nn(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?Ie:Math.pow(Ie,t),new nn(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new qe(sn(t>=240?t-240:t+120,r,i),sn(t,r,i),sn(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new nn(rn(this.h),on(this.s),on(this.l),$e(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=$e(this.opacity);return`${1===t?"hsl(":"hsla("}${rn(this.h)}, ${100*on(this.s)}%, ${100*on(this.l)}%${1===t?")":`, ${t})`}`}}));const un=t=>()=>t;function ln(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):un(isNaN(t)?e:t)}const pn=function t(e){var n=function(t){return 1==(t=+t)?ln:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):un(isNaN(e)?n:e)}}(e);function i(t,e){var i=n((t=Ye(t)).r,(e=Ye(e)).r),r=n(t.g,e.g),o=n(t.b,e.b),s=ln(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=r(e),t.b=o(e),t.opacity=s(e),t+""}}return i.gamma=t,i}(1);function hn(t){return function(e){var n,i,r=e.length,o=new Array(r),s=new Array(r),a=new Array(r);for(n=0;n<r;++n)i=Ye(e[n]),o[n]=i.r||0,s[n]=i.g||0,a[n]=i.b||0;return o=t(o),s=t(s),a=t(a),i.opacity=1,function(t){return i.r=o(t),i.g=s(t),i.b=a(t),i+""}}}hn((function(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],o=t[i+1],s=i>0?t[i-1]:2*r-o,a=i<e-1?t[i+2]:2*o-r;return an((n-i/e)*e,s,r,o,a)}})),hn((function(t){var e=t.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*e),r=t[(i+e-1)%e],o=t[i%e],s=t[(i+1)%e],a=t[(i+2)%e];return an((n-i/e)*e,r,o,s,a)}}));var cn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,dn=new RegExp(cn.source,"g");function fn(t,e){var n,i,r,o=cn.lastIndex=dn.lastIndex=0,s=-1,a=[],u=[];for(t+="",e+="";(n=cn.exec(t))&&(i=dn.exec(e));)(r=i.index)>o&&(r=e.slice(o,r),a[s]?a[s]+=r:a[++s]=r),(n=n[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,u.push({i:s,x:ge(n,i)})),o=dn.lastIndex;return o<e.length&&(r=e.slice(o),a[s]?a[s]+=r:a[++s]=r),a.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var n,i=0;i<e;++i)a[(n=u[i]).i]=n.x(t);return a.join("")})}function gn(t,e){var n;return("number"==typeof e?ge:e instanceof Ve?pn:(n=Ve(e))?(e=n,pn):fn)(t,e)}function _n(t){return function(){this.removeAttribute(t)}}function vn(t){return function(){this.removeAttributeNS(t.space,t.local)}}function mn(t,e,n){var i,r,o=n+"";return function(){var s=this.getAttribute(t);return s===o?null:s===i?r:r=e(i=s,n)}}function yn(t,e,n){var i,r,o=n+"";return function(){var s=this.getAttributeNS(t.space,t.local);return s===o?null:s===i?r:r=e(i=s,n)}}function bn(t,e,n){var i,r,o;return function(){var s,a,u=n(this);if(null!=u)return(s=this.getAttribute(t))===(a=u+"")?null:s===i&&a===r?o:(r=a,o=e(i=s,u));this.removeAttribute(t)}}function xn(t,e,n){var i,r,o;return function(){var s,a,u=n(this);if(null!=u)return(s=this.getAttributeNS(t.space,t.local))===(a=u+"")?null:s===i&&a===r?o:(r=a,o=e(i=s,u));this.removeAttributeNS(t.space,t.local)}}function An(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,r)),n}return r._value=e,r}function wn(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,r)),n}return r._value=e,r}function En(t,e){return function(){he(this,t).delay=+e.apply(this,arguments)}}function Cn(t,e){return e=+e,function(){he(this,t).delay=e}}function Tn(t,e){return function(){ce(this,t).duration=+e.apply(this,arguments)}}function On(t,e){return e=+e,function(){ce(this,t).duration=e}}var Sn=kt.prototype.constructor;function In(t){return function(){this.style.removeProperty(t)}}var Ln=0;function Nn(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function Dn(){return++Ln}var kn=kt.prototype;Nn.prototype=function(t){return kt().transition(t)}.prototype={constructor:Nn,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=w(t));for(var i=this._groups,r=i.length,o=new Array(r),s=0;s<r;++s)for(var a,u,l=i[s],p=l.length,h=o[s]=new Array(p),c=0;c<p;++c)(a=l[c])&&(u=t.call(a,a.__data__,c,l))&&("__data__"in a&&(u.__data__=a.__data__),h[c]=u,pe(h[c],e,n,c,h,de(a,n)));return new Nn(o,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=C(t));for(var i=this._groups,r=i.length,o=[],s=[],a=0;a<r;++a)for(var u,l=i[a],p=l.length,h=0;h<p;++h)if(u=l[h]){for(var c,d=t.call(u,u.__data__,h,l),f=de(u,n),g=0,_=d.length;g<_;++g)(c=d[g])&&pe(c,e,n,g,d,f);o.push(d),s.push(u)}return new Nn(o,s,e,n)},selectChild:kn.selectChild,selectChildren:kn.selectChildren,filter:function(t){"function"!=typeof t&&(t=T(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,s=e[r],a=s.length,u=i[r]=[],l=0;l<a;++l)(o=s[l])&&t.call(o,o.__data__,l,s)&&u.push(o);return new Nn(i,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,o=Math.min(i,r),s=new Array(i),a=0;a<o;++a)for(var u,l=e[a],p=n[a],h=l.length,c=s[a]=new Array(h),d=0;d<h;++d)(u=l[d]||p[d])&&(c[d]=u);for(;a<i;++a)s[a]=e[a];return new Nn(s,this._parents,this._name,this._id)},selection:function(){return new Sn(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=Dn(),i=this._groups,r=i.length,o=0;o<r;++o)for(var s,a=i[o],u=a.length,l=0;l<u;++l)if(s=a[l]){var p=de(s,e);pe(s,t,n,l,a,{time:p.time+p.delay+p.duration,delay:0,duration:p.duration,ease:p.ease})}return new Nn(i,this._parents,t,n)},call:kn.call,nodes:kn.nodes,node:kn.node,size:kn.size,empty:kn.empty,each:kn.each,on:function(t,e){var n=this._id;return arguments.length<2?de(this.node(),n).on.on(t):this.each(function(t,e,n){var i,r,o=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?he:ce;return function(){var s=o(this,t),a=s.on;a!==i&&(r=(i=a).copy()).on(e,n),s.on=r}}(n,t,e))},attr:function(t,e){var n=j(t),i="transform"===n?Ae:gn;return this.attrTween(t,"function"==typeof e?(n.local?xn:bn)(n,i,Ce(this,"attr."+t,e)):null==e?(n.local?vn:_n)(n):(n.local?yn:mn)(n,i,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var i=j(t);return this.tween(n,(i.local?An:wn)(i,e))},style:function(t,e,n){var i="transform"==(t+="")?xe:gn;return null==e?this.styleTween(t,function(t,e){var n,i,r;return function(){var o=Q(this,t),s=(this.style.removeProperty(t),Q(this,t));return o===s?null:o===n&&s===i?r:r=e(n=o,i=s)}}(t,i)).on("end.style."+t,In(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var i,r,o;return function(){var s=Q(this,t),a=n(this),u=a+"";return null==a&&(this.style.removeProperty(t),u=a=Q(this,t)),s===u?null:s===i&&u===r?o:(r=u,o=e(i=s,a))}}(t,i,Ce(this,"style."+t,e))).each(function(t,e){var n,i,r,o,s="style."+e,a="end."+s;return function(){var u=ce(this,t),l=u.on,p=null==u.value[s]?o||(o=In(e)):void 0;l===n&&r===p||(i=(n=l).copy()).on(a,r=p),u.on=i}}(this._id,t)):this.styleTween(t,function(t,e,n){var i,r,o=n+"";return function(){var s=Q(this,t);return s===o?null:s===i?r:r=e(i=s,n)}}(t,i,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;return this.tween(i,function(t,e,n){var i,r;function o(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&function(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}(t,o,n)),i}return o._value=e,o}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(Ce(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function i(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&function(t){return function(e){this.textContent=t.call(this,e)}}(i)),e}return i._value=t,i}(t))},remove:function(){return this.on("end.remove",(t=this._id,function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}));var t},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i,r=de(this.node(),n).tween,o=0,s=r.length;o<s;++o)if((i=r[o]).name===t)return i.value;return null}return this.each((null==e?we:Ee)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?En:Cn)(e,t)):de(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?Tn:On)(e,t)):de(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){ce(this,t).ease=e}}(e,t)):de(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;ce(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,i=n._id,r=n.size();return new Promise((function(o,s){var a={value:s},u={value:function(){0==--r&&o()}};n.each((function(){var n=ce(this,i),r=n.on;r!==t&&((e=(t=r).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(u)),n.on=e})),0===r&&o()}))},[Symbol.iterator]:kn[Symbol.iterator]};var Gn={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function Pn(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}kt.prototype.interrupt=function(t){return this.each((function(){fe(this,t)}))},kt.prototype.transition=function(t){var e,n;t instanceof Nn?(e=t._id,t=t._name):(e=Dn(),(n=Gn).time=te(),t=null==t?null:t+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var s,a=i[o],u=a.length,l=0;l<u;++l)(s=a[l])&&pe(s,t,e,l,a,n||Pn(s,e));return new Nn(i,this._parents,t,e)};const Bn=t=>()=>t;function Rn(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function Mn(t,e,n){this.k=t,this.x=e,this.y=n}Mn.prototype={constructor:Mn,scale:function(t){return 1===t?this:new Mn(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Mn(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var zn,Fn,jn,Hn,Un,Vn,Wn,Xn,Yn,qn,Zn,Kn,$n=new Mn(1,0,0);function Qn(t){t.stopImmediatePropagation()}function Jn(t){t.preventDefault(),t.stopImmediatePropagation()}function ti(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function ei(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function ni(){return this.__zoom||$n}function ii(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function ri(){return navigator.maxTouchPoints||"ontouchstart"in this}function oi(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function si(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ai(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function ui(t,e){if(t){if("string"==typeof t)return ai(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ai(t,e):void 0}}function li(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(o.push(i.value),!e||o.length!==e);s=!0);}catch(t){a=!0,r=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw r}}return o}}(t,e)||ui(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}Mn.prototype,(Fn=zn||(zn={})).Strict="strict",Fn.Loose="loose",(Hn=jn||(jn={})).Lines="lines",Hn.Dots="dots",(Vn=Un||(Un={})).Free="free",Vn.Vertical="vertical",Vn.Horizontal="horizontal",(Xn=Wn||(Wn={})).Bezier="default",Xn.Straight="straight",Xn.Step="step",Xn.SmoothStep="smoothstep",Xn.SimpleBezier="simplebezier",(qn=Yn||(Yn={})).Arrow="arrow",qn.ArrowClosed="arrowclosed",(Kn=Zn||(Zn={})).Left="left",Kn.Top="top",Kn.Right="right",Kn.Bottom="bottom";var pi=function(t){return{width:t.offsetWidth,height:t.offsetHeight}},hi=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(t,e),n)},ci=function(t,e){return{x:hi(t.x,e[0][0],e[1][0]),y:hi(t.y,e[0][1],e[1][1])}},di=function(t){var e,n;return(null===(e=t.getRootNode)||void 0===e?void 0:e.call(t))||(null===(n=window)||void 0===n?void 0:n.document)},fi=function(t,e){return{x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x2,e.x2),y2:Math.max(t.y2,e.y2)}},gi=function(t){var e=t.x,n=t.y;return{x:e,y:n,x2:e+t.width,y2:n+t.height}},_i=function(t){var e=t.x,n=t.y;return{x:e,y:n,width:t.x2-e,height:t.y2-n}},vi=function(t){return!isNaN(t)&&isFinite(t)},mi=Symbol("internals");function yi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function bi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?yi(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yi(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function xi(t,e){var n=t.find((function(t){return t.id===e.parentNode}));if(n){var i=e.position.x+e.width-n.width,r=e.position.y+e.height-n.height;if(i>0||r>0||e.position.x<0||e.position.y<0){var o,s;if(n.style=bi({},n.style)||{},n.style.width=null!==(o=n.style.width)&&void 0!==o?o:n.width,n.style.height=null!==(s=n.style.height)&&void 0!==s?s:n.height,i>0&&(n.style.width+=i),r>0&&(n.style.height+=r),e.position.x<0){var a=Math.abs(e.position.x);n.position.x=n.position.x-a,n.style.width+=a,e.position.x=0}if(e.position.y<0){var u=Math.abs(e.position.y);n.position.y=n.position.y-u,n.style.height+=u,e.position.y=0}n.width=n.style.width,n.height=n.style.height}}}function Ai(t,e){if(t.some((function(t){return"reset"===t.type})))return t.filter((function(t){return"reset"===t.type})).map((function(t){return t.item}));var n=t.filter((function(t){return"add"===t.type})).map((function(t){return t.item}));return e.reduce((function(e,n){var i=t.find((function(t){return t.id===n.id}));if(i)switch(i.type){case"select":return e.push(bi(bi({},n),{},{selected:i.selected})),e;case"position":var r=bi({},n);return void 0!==i.position&&(r.position=i.position),void 0!==i.positionAbsolute&&(r.positionAbsolute=i.positionAbsolute),void 0!==i.dragging&&(r.dragging=i.dragging),r.expandParent&&xi(e,r),e.push(r),e;case"dimensions":var o=bi({},n);return void 0!==i.dimensions&&(o.width=i.dimensions.width,o.height=i.dimensions.height),o.expandParent&&xi(e,o),e.push(o),e;case"remove":return e}return e.push(n),e}),n)}function wi(t,e){return Ai(t,e)}var Ei=function(t,e){return{id:t,type:"select",selected:e}};function Ci(t,e){return t.reduce((function(t,n){var i=e.includes(n.id);return!n.selected&&i?(n.selected=!0,t.push(Ei(n.id,!0))):n.selected&&!i&&(n.selected=!1,t.push(Ei(n.id,!1))),t}),[])}function Ti(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Oi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ti(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ti(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Si=function(t,e,n){var i=e.querySelectorAll(t);if(!i||!i.length)return null;var r=Array.from(i),o=e.getBoundingClientRect();return r.map((function(t){var e=t.getBoundingClientRect();return Oi({id:t.getAttribute("data-handleid"),position:t.getAttribute("data-handlepos"),x:(e.left-o.left)/n,y:(e.top-o.top)/n},pi(t))}))};function Ii(t,e,n){return void 0===n?n:function(i){var r=e().nodeInternals.get(t);n(i,Oi({},r))}}function Li(t){var e=t.id,n=t.store,i=n.getState(),r=i.addSelectedNodes,o=i.unselectNodesAndEdges,s=i.multiSelectionActive,a=i.nodeInternals.get(e);n.setState({nodesSelectionActive:!1}),a.selected?a.selected&&s&&o({nodes:[a]}):r([e])}function Ni(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Di(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ni(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ni(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ki=function(t,e){if(void 0===t)return"";if("string"==typeof t)return t;var n=e?"".concat(e,"__"):"";return"".concat(n).concat(Object.keys(t).sort().map((function(e){return"".concat(e,"=").concat(t[e])})).join("&"))},Gi=function(t,e){return t.source&&t.target?function(t,e){return e.some((function(e){return!(e.source!==t.source||e.target!==t.target||e.sourceHandle!==t.sourceHandle&&(e.sourceHandle||t.sourceHandle)||e.targetHandle!==t.targetHandle&&(e.targetHandle||t.targetHandle))}))}(a="id"in(u=t)&&"source"in u&&"target"in u?Di({},t):Di(Di({},t),{},{id:(n=t,i=n.source,r=n.sourceHandle,o=n.target,s=n.targetHandle,"reactflow__edge-".concat(i).concat(r||"","-").concat(o).concat(s||""))}),e)?e:e.concat(a):e;var n,i,r,o,s,a,u},Pi=function(t,e,n,i){var r=t.x,o=t.y,s=li(e,3),a=s[0],u=s[1],l=s[2],p=li(i,2),h=p[0],c=p[1],d={x:(r-a)/l,y:(o-u)/l};return n?{x:h*Math.round(d.x/h),y:c*Math.round(d.y/c)}:d},Bi=function(t){if(0===t.length)return{x:0,y:0,width:0,height:0};var e=t.reduce((function(t,e){var n=e.positionAbsolute,i=e.position,r=e.width,o=e.height;return fi(t,gi({x:n?n.x:i.x,y:n?n.y:i.y,width:r||0,height:o||0}))}),{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return _i(e)},Ri=function(t,e){var n=li(arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,1],3),i=n[0],r=n[1],o=n[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=gi({x:(e.x-i)/o,y:(e.y-r)/o,width:e.width/o,height:e.height/o}),l=[];return t.forEach((function(t){var e=t.positionAbsolute,n=t.width,i=t.height,r=t.selectable;if(a&&void 0!==r&&!r)return!1;var o=gi(Di(Di({},e),{},{width:n||0,height:i||0})),p=Math.max(0,Math.min(u.x2,o.x2)-Math.max(u.x,o.x)),h=Math.max(0,Math.min(u.y2,o.y2)-Math.max(u.y,o.y)),c=Math.ceil(p*h);(void 0===n||void 0===i||null===n||null===i||s&&c>0||c>=(n||0)*(i||0))&&l.push(t)})),l},Mi=function(t,e){var n=t.map((function(t){return t.id}));return e.filter((function(t){return n.includes(t.source)||n.includes(t.target)}))},zi=function(t,e,n,i,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.1,s=e/(t.width*(1+o)),a=n/(t.height*(1+o)),u=Math.min(s,a),l=hi(u,i,r);return[e/2-(t.x+t.width/2)*l,n/2-(t.y+t.height/2)*l,l]},Fi=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.transition().duration(e)};function ji(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Hi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ji(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ji(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ui(t,e,n,i){var r,o,s,a,u,l,p,h,c,d,f,g;if(!t.parentNode)return i;var _=e.get(t.parentNode);return Ui(_,e,n,{x:(null!==(r=i.x)&&void 0!==r?r:0)+(null!==(o=null===(s=_.position)||void 0===s?void 0:s.x)&&void 0!==o?o:0),y:(null!==(a=i.y)&&void 0!==a?a:0)+(null!==(u=null===(l=_.position)||void 0===l?void 0:l.y)&&void 0!==u?u:0),z:(null!==(p=null===(h=_[mi])||void 0===h?void 0:h.z)&&void 0!==p?p:0)>(null!==(c=i.z)&&void 0!==c?c:0)?null!==(d=null===(f=_[mi])||void 0===f?void 0:f.z)&&void 0!==d?d:0:null!==(g=i.z)&&void 0!==g?g:0})}function Vi(t,e){var n=new Map,i={};return t.forEach((function(t){var r,o=vi(t.zIndex)?t.zIndex:t.selected?1e3:0,s=e.get(t.id),a=Hi(Hi({width:null==s?void 0:s.width,height:null==s?void 0:s.height},t),{},{positionAbsolute:{x:t.position.x,y:t.position.y}});t.parentNode&&(a.parentNode=t.parentNode,i[t.parentNode]=!0),Object.defineProperty(a,mi,{enumerable:!1,value:{handleBounds:null==s||null===(r=s[mi])||void 0===r?void 0:r.handleBounds,z:o}}),n.set(t.id,a)})),n.forEach((function(t){if(t.parentNode&&!n.has(t.parentNode))throw new Error("Parent node ".concat(t.parentNode," not found"));if(t.parentNode||i[t.id]){var e,r,o=Ui(t,n,i,Hi(Hi({},t.position),{},{z:null!==(e=null===(r=t[mi])||void 0===r?void 0:r.z)&&void 0!==e?e:0})),s=o.x,a=o.y,u=o.z;t.positionAbsolute={x:s,y:a},t[mi].z=u,i[t.id]&&(t[mi].isParent=!0)}})),n}function Wi(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t(),i=n.nodeInternals,r=n.width,o=n.height,s=n.minZoom,a=n.maxZoom,u=n.d3Zoom,l=n.d3Selection,p=n.fitViewOnInitDone,h=n.fitViewOnInit;if((e.initial&&!p&&h||!e.initial)&&u&&l){var c=Array.from(i.values()).filter((function(t){return e.includeHiddenNodes?t.width&&t.height:!t.hidden})),d=c.every((function(t){return t.width&&t.height}));if(c.length>0&&d){var f,g,_,v=Bi(c),m=li(zi(v,r,o,null!==(f=e.minZoom)&&void 0!==f?f:s,null!==(g=e.maxZoom)&&void 0!==g?g:a,null!==(_=e.padding)&&void 0!==_?_:.1),3),y=m[0],b=m[1],x=m[2],A=$n.translate(y,b).scale(x);return"number"==typeof e.duration&&e.duration>0?u.transform(Fi(l,e.duration),A):u.transform(l,A),!0}}return!1}function Xi(t,e){return t.forEach((function(t){var n,i=e.get(t.id);i&&e.set(i.id,Hi(Hi({},i),{},(si(n={},mi,i[mi]),si(n,"selected",t.selected),n)))})),new Map(e)}function Yi(t,e){return e.map((function(e){var n=t.find((function(t){return t.id===e.id}));return n&&(e.selected=n.selected),e}))}function qi(t){var e=t.changedNodes,n=t.changedEdges,i=t.get,r=t.set,o=i(),s=o.nodeInternals,a=o.edges,u=o.onNodesChange,l=o.onEdgesChange,p=o.hasDefaultNodes,h=o.hasDefaultEdges;null!=e&&e.length&&(p&&r({nodeInternals:Xi(e,s)}),null==u||u(e)),null!=n&&n.length&&(h&&r({edges:Yi(n,a)}),null==l||l(n))}var Zi=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Ki={width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:Zi,nodeExtent:Zi,nodesSelectionActive:!1,userSelectionActive:!1,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionMode:zn.Strict,domNode:null,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,multiSelectionActive:!1,reactFlowVersion:"10.3.17",connectionStartHandle:null,connectOnClick:!0};function $i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Qi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$i(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ji=function(){const e=(0,t.createContext)(void 0);return{Provider:({initialStore:n,createStore:i,children:r})=>{const o=(0,t.useRef)();return o.current||(n&&(console.warn("Provider initialStore is deprecated and will be removed in the next version."),i||(i=()=>n)),o.current=i()),(0,t.createElement)(e.Provider,{value:o.current},r)},useStore:(n,i=Object.is)=>{const r=(0,t.useContext)(e);if(!r)throw new Error("Seems like you have not used zustand provider as an ancestor.");return r(n,i)},useStoreApi:()=>{const n=(0,t.useContext)(e);if(!n)throw new Error("Seems like you have not used zustand provider as an ancestor.");return(0,t.useMemo)((()=>({getState:n.getState,setState:n.setState,subscribe:n.subscribe,destroy:n.destroy})),[n])}}}(),tr=Ji.Provider,er=Ji.useStore,nr=Ji.useStoreApi,ir=function(){return function(e){const n=function(t){let e;const n=new Set,i=(t,i)=>{const r="function"==typeof t?t(e):t;if(r!==e){const t=e;e=i?r:Object.assign({},e,r),n.forEach((n=>n(e,t)))}},r=()=>e,o={setState:i,getState:r,subscribe:(t,i,o)=>i||o?((t,i=r,o=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let s=i(e);function a(){const n=i(e);if(!o(s,n)){const e=s;t(s=n,e)}}return n.add(a),()=>n.delete(a)})(t,i,o):(n.add(t),()=>n.delete(t)),destroy:()=>n.clear()};return e=t(i,r,o),o}(e),i=(e=n.getState,i=Object.is)=>{const[,r]=(0,t.useReducer)((t=>t+1),0),o=n.getState(),s=(0,t.useRef)(o),a=(0,t.useRef)(e),u=(0,t.useRef)(i),l=(0,t.useRef)(!1),p=(0,t.useRef)();let h;void 0===p.current&&(p.current=e(o));let c=!1;(s.current!==o||a.current!==e||u.current!==i||l.current)&&(h=e(o),c=!i(p.current,h)),g((()=>{c&&(p.current=h),s.current=o,a.current=e,u.current=i,l.current=!1}));const d=(0,t.useRef)(o);g((()=>{const t=()=>{try{const t=n.getState(),e=a.current(t);u.current(p.current,e)||(s.current=t,p.current=e,r())}catch(t){l.current=!0,r()}},e=n.subscribe(t);return n.getState()!==d.current&&t(),e}),[]);const f=c?h:p.current;return(0,t.useDebugValue)(f),f};return Object.assign(i,n),i[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const t=[i,n];return{next(){const e=t.length<=0;return{value:t.shift(),done:e}}}},i}((function(t,e){return Qi(Qi({},Ki),{},{setNodes:function(n){t({nodeInternals:Vi(n,e().nodeInternals)})},setEdges:function(n){var i=e().defaultEdgeOptions,r=void 0===i?{}:i;t({edges:n.map((function(t){return Qi(Qi({},r),t)}))})},setDefaultNodesAndEdges:function(e,n){var i=void 0!==e,r=void 0!==n,o=i?Vi(e,new Map):new Map;t({nodeInternals:o,edges:r?n:[],hasDefaultNodes:i,hasDefaultEdges:r})},updateNodeDimensions:function(n){var i=e(),r=i.onNodesChange,o=i.nodeInternals,s=i.fitViewOnInit,a=i.fitViewOnInitDone,u=i.fitViewOnInitOptions,l=i.domNode,p=null==l?void 0:l.querySelector(".react-flow__viewport");if(p){var h=window.getComputedStyle(p),c=new window.DOMMatrixReadOnly(h.transform).m22,d=n.reduce((function(t,e){var n=o.get(e.id);if(n){var i=pi(e.nodeElement);i.width&&i.height&&(n.width!==i.width||n.height!==i.height||e.forceUpdate)&&(o.set(n.id,Qi(Qi({},n),{},si({},mi,Qi(Qi({},n[mi]),{},{handleBounds:{source:Si(".source",e.nodeElement,c),target:Si(".target",e.nodeElement,c)}})),i)),t.push({id:n.id,type:"dimensions",dimensions:i}))}return t}),[]),f=a||s&&!a&&Wi(e,Qi({initial:!0},u));t({nodeInternals:new Map(o),fitViewOnInitDone:f}),(null==d?void 0:d.length)>0&&(null==r||r(d))}},updateNodePositions:function(n){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e(),s=o.onNodesChange,a=o.nodeInternals,u=o.hasDefaultNodes;if(u||s){var l=n.map((function(t){var e={id:t.id,type:"position",dragging:r};return i&&(e.positionAbsolute=t.positionAbsolute,e.position=t.position),e}));if(null!=l&&l.length){if(u){var p=Vi(wi(l,Array.from(a.values())),a);t({nodeInternals:p})}null==s||s(l)}}},addSelectedNodes:function(n){var i,r=e(),o=r.multiSelectionActive,s=r.nodeInternals,a=r.edges,u=null;o?i=n.map((function(t){return Ei(t,!0)})):(i=Ci(Array.from(s.values()),n),u=Ci(a,[])),qi({changedNodes:i,changedEdges:u,get:e,set:t})},addSelectedEdges:function(n){var i,r=e(),o=r.multiSelectionActive,s=r.edges,a=r.nodeInternals,u=null;o?i=n.map((function(t){return Ei(t,!0)})):(i=Ci(s,n),u=Ci(Array.from(a.values()),[])),qi({changedNodes:u,changedEdges:i,get:e,set:t})},unselectNodesAndEdges:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.nodes,r=n.edges,o=e(),s=o.nodeInternals,a=o.edges,u=r||a;qi({changedNodes:(i||Array.from(s.values())).map((function(t){return t.selected=!1,Ei(t.id,!1)})),changedEdges:u.map((function(t){return Ei(t.id,!1)})),get:e,set:t})},setMinZoom:function(n){var i=e(),r=i.d3Zoom,o=i.maxZoom;null==r||r.scaleExtent([n,o]),t({minZoom:n})},setMaxZoom:function(n){var i=e(),r=i.d3Zoom,o=i.minZoom;null==r||r.scaleExtent([o,n]),t({maxZoom:n})},setTranslateExtent:function(n){var i=e().d3Zoom;null==i||i.translateExtent(n),t({translateExtent:n})},resetSelectedElements:function(){var n=e(),i=n.nodeInternals,r=n.edges;qi({changedNodes:Array.from(i.values()).filter((function(t){return t.selected})).map((function(t){return Ei(t.id,!1)})),changedEdges:r.filter((function(t){return t.selected})).map((function(t){return Ei(t.id,!1)})),get:e,set:t})},setNodeExtent:function(n){var i=e().nodeInternals;i.forEach((function(t){t.positionAbsolute=ci(t.position,n)})),t({nodeExtent:n,nodeInternals:new Map(i)})},reset:function(){return t(Qi({},Ki))}})}))};function rr(t,e){if(Object.is(t,e))return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(let i=0;i<n.length;i++)if(!Object.prototype.hasOwnProperty.call(e,n[i])||!Object.is(t[n[i]],e[n[i]]))return!1;return!0}function or(t){return function(t){if(Array.isArray(t))return ai(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||ui(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var sr={zoomIn:function(){},zoomOut:function(){},zoomTo:function(t){},getZoom:function(){return 1},setViewport:function(t){},getViewport:function(){return{x:0,y:0,zoom:1}},fitView:function(){},setCenter:function(t,e){},fitBounds:function(t){},project:function(t){return t},viewportInitialized:!1},ar=function(t){return{d3Zoom:t.d3Zoom,d3Selection:t.d3Selection}};function ur(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function lr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ur(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ur(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function pr(){var e=function(){var e=nr(),n=er(ar,rr),i=n.d3Zoom,r=n.d3Selection;return(0,t.useMemo)((function(){return r&&i?{zoomIn:function(t){return i.scaleBy(Fi(r,null==t?void 0:t.duration),1.2)},zoomOut:function(t){return i.scaleBy(Fi(r,null==t?void 0:t.duration),1/1.2)},zoomTo:function(t,e){return i.scaleTo(Fi(r,null==e?void 0:e.duration),t)},getZoom:function(){return e.getState().transform[2]},setViewport:function(t,n){var o,s,a,u=li(e.getState().transform,3),l=u[0],p=u[1],h=u[2],c=$n.translate(null!==(o=t.x)&&void 0!==o?o:l,null!==(s=t.y)&&void 0!==s?s:p).scale(null!==(a=t.zoom)&&void 0!==a?a:h);i.transform(Fi(r,null==n?void 0:n.duration),c)},getViewport:function(){var t=li(e.getState().transform,3);return{x:t[0],y:t[1],zoom:t[2]}},fitView:function(t){return Wi(e.getState,t)},setCenter:function(t,n,o){var s=e.getState(),a=s.width,u=s.height,l=s.maxZoom,p=void 0!==(null==o?void 0:o.zoom)?o.zoom:l,h=a/2-t*p,c=u/2-n*p,d=$n.translate(h,c).scale(p);i.transform(Fi(r,null==o?void 0:o.duration),d)},fitBounds:function(t,n){var o,s=e.getState(),a=s.width,u=s.height,l=s.minZoom,p=s.maxZoom,h=li(zi(t,a,u,l,p,null!==(o=null==n?void 0:n.padding)&&void 0!==o?o:.1),3),c=h[0],d=h[1],f=h[2],g=$n.translate(c,d).scale(f);i.transform(Fi(r,null==n?void 0:n.duration),g)},project:function(t){var n=e.getState(),i=n.transform,r=n.snapToGrid,o=n.snapGrid;return Pi(t,i,r,o)},viewportInitialized:!0}:sr}),[i,r])}(),n=nr(),i=(0,t.useCallback)((function(){var t=n.getState().nodeInternals;return Array.from(t.values()).map((function(t){return lr({},t)}))}),[]),r=(0,t.useCallback)((function(t){return n.getState().nodeInternals.get(t)}),[]),o=(0,t.useCallback)((function(){var t=n.getState().edges;return(void 0===t?[]:t).map((function(t){return lr({},t)}))}),[]),s=(0,t.useCallback)((function(t){var e=n.getState().edges;return(void 0===e?[]:e).find((function(e){return e.id===t}))}),[]),a=(0,t.useCallback)((function(t){var e=n.getState(),i=e.nodeInternals,r=e.setNodes,o=e.hasDefaultNodes,s=e.onNodesChange,a=Array.from(i.values()),u="function"==typeof t?t(a):t;o?r(u):s&&s(0===u.length?a.map((function(t){return{type:"remove",id:t.id}})):u.map((function(t){return{item:t,type:"reset"}})))}),[]),u=(0,t.useCallback)((function(t){var e=n.getState(),i=e.edges,r=void 0===i?[]:i,o=e.setEdges,s=e.hasDefaultEdges,a=e.onEdgesChange,u="function"==typeof t?t(r):t;s?o(u):a&&a(0===u.length?r.map((function(t){return{type:"remove",id:t.id}})):u.map((function(t){return{item:t,type:"reset"}})))}),[]),l=(0,t.useCallback)((function(t){var e=Array.isArray(t)?t:[t],i=n.getState(),r=i.nodeInternals,o=i.setNodes,s=i.hasDefaultNodes,a=i.onNodesChange;if(s){var u=Array.from(r.values());o([].concat(u,or(e)))}else a&&a(e.map((function(t){return{item:t,type:"add"}})))}),[]),p=(0,t.useCallback)((function(t){var e=Array.isArray(t)?t:[t],i=n.getState(),r=i.edges,o=void 0===r?[]:r,s=i.setEdges,a=i.hasDefaultEdges,u=i.onEdgesChange;a?s([].concat(or(o),or(e))):u&&u(e.map((function(t){return{item:t,type:"add"}})))}),[]),h=(0,t.useCallback)((function(){var t=n.getState(),e=t.nodeInternals,i=t.edges,r=void 0===i?[]:i,o=t.transform,s=Array.from(e.values()),a=li(o,3),u=a[0],l=a[1],p=a[2];return{nodes:s.map((function(t){return lr({},t)})),edges:r.map((function(t){return lr({},t)})),viewport:{x:u,y:l,zoom:p}}}),[]);return(0,t.useMemo)((function(){return lr(lr({},e),{},{getNodes:i,getNode:r,getEdges:o,getEdge:s,setNodes:a,setEdges:u,addNodes:l,addEdges:p,toObject:h})}),[e,i,r,o,s,a,u,l,p,h])}function hr(t){if("string"==typeof t||"number"==typeof t)return""+t;let e="";if(Array.isArray(t))for(let n,i=0;i<t.length;i++)""!==(n=hr(t[i]))&&(e+=(e&&" ")+n);else for(let n in t)t[n]&&(e+=(e&&" ")+n);return e}function cr(t,e){if(null==t)return{};var n,i,r=function(t,e){if(null==t)return{};var n,i,r={},o=Object.keys(t);for(i=0;i<o.length;i++)n=o[i],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function dr(){return e().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},e().createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function fr(){return e().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},e().createElement("path",{d:"M0 0h32v4.2H0z"}))}function gr(){return e().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},e().createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function _r(){return e().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},e().createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function vr(){return e().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},e().createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}var mr=["children","className"];function yr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}var br=function(t){var n=t.children,i=t.className,r=cr(t,mr);return e().createElement("button",function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?yr(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({type:"button",className:hr(["react-flow__controls-button",i])},r),n)},xr=function(t){return t.nodesDraggable&&t.nodesConnectable&&t.elementsSelectable},Ar=function(n){var i=n.style,r=n.showZoom,o=void 0===r||r,s=n.showFitView,a=void 0===s||s,u=n.showInteractive,l=void 0===u||u,p=n.fitViewOptions,h=n.onZoomIn,c=n.onZoomOut,d=n.onFitView,f=n.onInteractiveChange,g=n.className,_=n.children,v=nr(),m=li((0,t.useState)(!1),2),y=m[0],b=m[1],x=er(xr),A=pr(),w=A.zoomIn,E=A.zoomOut,C=A.fitView;return(0,t.useEffect)((function(){b(!0)}),[]),y?e().createElement("div",{className:hr(["react-flow__controls",g]),style:i},o&&e().createElement(e().Fragment,null,e().createElement(br,{onClick:function(){null==w||w(),null==h||h()},className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in"},e().createElement(dr,null)),e().createElement(br,{onClick:function(){null==E||E(),null==c||c()},className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out"},e().createElement(fr,null))),a&&e().createElement(br,{className:"react-flow__controls-fitview",onClick:function(){null==C||C(p),null==d||d()},title:"fit view","aria-label":"fit view"},e().createElement(gr,null)),l&&e().createElement(br,{className:"react-flow__controls-interactive",onClick:function(){v.setState({nodesDraggable:!x,nodesConnectable:!x,elementsSelectable:!x}),null==f||f(!x)},title:"toggle interactivity","aria-label":"toggle interactivity"},x?e().createElement(vr,null):e().createElement(_r,null)),_):null};Ar.displayName="Controls";var wr=(0,t.memo)(Ar);const Er=t=>()=>t;function Cr(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:o,x:s,y:a,dx:u,dy:l,dispatch:p}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:p}})}function Tr(t){return!t.ctrlKey&&!t.button}function Or(){return this.parentNode}function Sr(t,e){return null==e?{x:t.x,y:t.y}:e}function Ir(){return navigator.maxTouchPoints||"ontouchstart"in this}Cr.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var Lr=["paid-pro","paid-sponsor","paid-enterprise","paid-custom"];function Nr(t){var n=t.proOptions,i=t.position,r=void 0===i?"bottom-right":i;if(null!=n&&n.account&&Lr.includes(null==n?void 0:n.account)&&null!=n&&n.hideAttribution)return null;var o="".concat(r).split("-");return e().createElement("div",{className:hr(["react-flow__attribution"].concat(or(o))),"data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev/pricing"},e().createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer"},"React Flow"))}var Dr=["x","y","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","children","className"];function kr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}var Gr=function(n){var i=n.x,r=n.y,o=n.label,s=n.labelStyle,a=void 0===s?{}:s,u=n.labelShowBg,l=void 0===u||u,p=n.labelBgStyle,h=void 0===p?{}:p,c=n.labelBgPadding,d=void 0===c?[2,4]:c,f=n.labelBgBorderRadius,g=void 0===f?2:f,_=n.children,v=n.className,m=cr(n,Dr),y=(0,t.useRef)(null),b=li((0,t.useState)({x:0,y:0,width:0,height:0}),2),x=b[0],A=b[1],w=hr(["react-flow__edge-textwrapper",v]);return(0,t.useEffect)((function(){if(y.current){var t=y.current.getBBox();A({x:t.x,y:t.y,width:t.width,height:t.height})}}),[o]),void 0!==o&&o?e().createElement("g",function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?kr(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({transform:"translate(".concat(i-x.width/2," ").concat(r-x.height/2,")"),className:w},m),l&&e().createElement("rect",{width:x.width+2*d[0],x:-d[0],y:-d[1],height:x.height+2*d[1],className:"react-flow__edge-textbg",style:h,rx:g,ry:g}),e().createElement("text",{className:"react-flow__edge-text",y:x.height/2,dy:"0.3em",ref:y,style:a},o),_):null},Pr=(0,t.memo)(Gr),Br=function(t){var n=t.path,i=t.centerX,r=t.centerY,o=t.label,s=t.labelStyle,a=t.labelShowBg,u=t.labelBgStyle,l=t.labelBgPadding,p=t.labelBgBorderRadius,h=t.style,c=t.markerEnd,d=t.markerStart,f=o?e().createElement(Pr,{x:i,y:r,label:o,labelStyle:s,labelShowBg:a,labelBgStyle:u,labelBgPadding:l,labelBgBorderRadius:p}):null;return e().createElement(e().Fragment,null,e().createElement("path",{style:h,d:n,className:"react-flow__edge-path",markerEnd:c,markerStart:d}),f)};function Rr(t){var e,n,i=t.pos,r=t.x1,o=t.y1,s=t.x2,a=t.y2;switch(i){case Zn.Left:case Zn.Right:e=.5*(r+s),n=o;break;case Zn.Top:case Zn.Bottom:e=r,n=.5*(o+a)}return[e,n]}function Mr(t){var e=t.sourceX,n=t.sourceY,i=t.sourcePosition,r=void 0===i?Zn.Bottom:i,o=t.targetX,s=t.targetY,a=t.targetPosition,u=void 0===a?Zn.Top:a,l=li(Rr({pos:r,x1:e,y1:n,x2:o,y2:s}),2),p=l[0],h=l[1],c=li(Rr({pos:u,x1:o,y1:s,x2:e,y2:n}),2),d=c[0],f=c[1];return"M".concat(e,",").concat(n," C").concat(p,",").concat(h," ").concat(d,",").concat(f," ").concat(o,",").concat(s)}var zr=(0,t.memo)((function(t){var n=t.sourceX,i=t.sourceY,r=t.targetX,o=t.targetY,s=t.sourcePosition,a=void 0===s?Zn.Bottom:s,u=t.targetPosition,l=void 0===u?Zn.Top:u,p=t.label,h=t.labelStyle,c=t.labelShowBg,d=t.labelBgStyle,f=t.labelBgPadding,g=t.labelBgBorderRadius,_=t.style,v=t.markerEnd,m=t.markerStart,y={sourceX:n,sourceY:i,sourcePosition:a,targetX:r,targetY:o,targetPosition:l},b=Mr(y),x=function(t){var e=t.sourceX,n=t.sourceY,i=t.sourcePosition,r=void 0===i?Zn.Bottom:i,o=t.targetX,s=t.targetY,a=t.targetPosition,u=void 0===a?Zn.Top:a,l=li(Rr({pos:r,x1:e,y1:n,x2:o,y2:s}),2),p=l[0],h=l[1],c=li(Rr({pos:u,x1:o,y1:s,x2:e,y2:n}),2),d=.125*e+.375*p+.375*c[0]+.125*o,f=.125*n+.375*h+.375*c[1]+.125*s;return[d,f,Math.abs(d-e),Math.abs(f-n)]}(y),A=li(x,2),w=A[0],E=A[1];return e().createElement(Br,{path:b,centerX:w,centerY:E,label:p,labelStyle:h,labelShowBg:c,labelBgStyle:d,labelBgPadding:f,labelBgBorderRadius:g,style:_,markerEnd:v,markerStart:m})}));function Fr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}var jr=[Zn.Left,Zn.Right],Hr=function(t){var e=t.sourceX,n=t.sourceY,i=t.targetX,r=t.targetY,o=t.sourcePosition,s=void 0===o?Zn.Bottom:o,a=t.targetPosition,u=void 0===a?Zn.Top:a,l=jr.includes(s),p=jr.includes(u);if(l&&!p||p&&!l){var h=l?Math.abs(i-e):0,c=e>i?e-h:e+h,d=l?0:Math.abs(r-n);return[c,n<r?n+d:n-d,h,d]}var f=Math.abs(i-e)/2,g=i<e?i+f:i-f,_=Math.abs(r-n)/2;return[g,r<n?r+_:r-_,f,_]};function Ur(t,e,n){return void 0===n?n:function(i){var r=e().edges.find((function(e){return e.id===t}));n(i,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Fr(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Fr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},r))}}var Vr=function(t,e,n){return"L ".concat(t,",").concat(e-n,"Q ").concat(t,",").concat(e," ").concat(t+n,",").concat(e)},Wr=function(t,e,n){return"L ".concat(t+n,",").concat(e,"Q ").concat(t,",").concat(e," ").concat(t,",").concat(e-n)},Xr=function(t,e,n){return"L ".concat(t,",").concat(e-n,"Q ").concat(t,",").concat(e," ").concat(t-n,",").concat(e)},Yr=function(t,e,n){return"L ".concat(t-n,",").concat(e,"Q ").concat(t,",").concat(e," ").concat(t,",").concat(e-n)},qr=function(t,e,n){return"L ".concat(t+n,",").concat(e,"Q ").concat(t,",").concat(e," ").concat(t,",").concat(e+n)},Zr=function(t,e,n){return"L ".concat(t,",").concat(e+n,"Q ").concat(t,",").concat(e," ").concat(t+n,",").concat(e)},Kr=function(t,e,n){return"L ".concat(t,",").concat(e+n,"Q ").concat(t,",").concat(e," ").concat(t-n,",").concat(e)},$r=function(t,e,n){return"L ".concat(t-n,",").concat(e,"Q ").concat(t,",").concat(e," ").concat(t,",").concat(e+n)};function Qr(t){var e=t.sourceX,n=t.sourceY,i=t.sourcePosition,r=void 0===i?Zn.Bottom:i,o=t.targetX,s=t.targetY,a=t.targetPosition,u=void 0===a?Zn.Top:a,l=t.borderRadius,p=void 0===l?5:l,h=t.centerX,c=t.centerY,d=li(Hr({sourceX:e,sourceY:n,targetX:o,targetY:s}),4),f=d[0],g=d[1],_=d[2],v=d[3],m=Math.min(p,Math.abs(o-e)),y=Math.min(p,Math.abs(s-n)),b=Math.min(m,y,_,v),x=[Zn.Left,Zn.Right],A=void 0!==h?h:f,w=void 0!==c?c:g,E=null,C=null;return e<=o?(E=n<=s?Vr(e,w,b):Zr(e,w,b),C=n<=s?$r(o,w,b):Yr(o,w,b)):(E=n<s?Xr(e,w,b):Kr(e,w,b),C=n<s?qr(o,w,b):Wr(o,w,b)),x.includes(r)&&x.includes(u)?e<=o?(E=n<=s?$r(A,n,b):Yr(A,n,b),C=n<=s?Vr(A,s,b):Zr(A,s,b)):(r===Zn.Right&&u===Zn.Left||r===Zn.Left&&u===Zn.Right||r===Zn.Left&&u===Zn.Left)&&(E=n<=s?qr(A,n,b):Wr(A,n,b),C=n<=s?Xr(A,s,b):Kr(A,s,b)):x.includes(r)&&!x.includes(u)?(E=e<=o?n<=s?$r(o,n,b):Yr(o,n,b):n<=s?qr(o,n,b):Wr(o,n,b),C=""):!x.includes(r)&&x.includes(u)&&(E=e<=o?n<=s?Vr(e,s,b):Zr(e,s,b):n<=s?Xr(e,s,b):Kr(e,s,b),C=""),"M ".concat(e,",").concat(n).concat(E).concat(C,"L ").concat(o,",").concat(s)}var Jr=(0,t.memo)((function(t){var n=t.sourceX,i=t.sourceY,r=t.targetX,o=t.targetY,s=t.label,a=t.labelStyle,u=t.labelShowBg,l=t.labelBgStyle,p=t.labelBgPadding,h=t.labelBgBorderRadius,c=t.style,d=t.sourcePosition,f=void 0===d?Zn.Bottom:d,g=t.targetPosition,_=void 0===g?Zn.Top:g,v=t.markerEnd,m=t.markerStart,y=t.borderRadius,b=void 0===y?5:y,x=li(Hr({sourceX:n,sourceY:i,targetX:r,targetY:o,sourcePosition:f,targetPosition:_}),2),A=x[0],w=x[1],E=Qr({sourceX:n,sourceY:i,sourcePosition:f,targetX:r,targetY:o,targetPosition:_,borderRadius:b});return e().createElement(Br,{path:E,centerX:A,centerY:w,label:s,labelStyle:a,labelShowBg:u,labelBgStyle:l,labelBgPadding:p,labelBgBorderRadius:h,style:c,markerEnd:v,markerStart:m})}));function to(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function eo(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?to(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):to(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var no=(0,t.memo)((function(t){return e().createElement(Jr,eo(eo({},t),{},{borderRadius:0}))})),io=(0,t.memo)((function(t){var n=t.sourceX,i=t.sourceY,r=t.targetX,o=t.targetY,s=t.label,a=t.labelStyle,u=t.labelShowBg,l=t.labelBgStyle,p=t.labelBgPadding,h=t.labelBgBorderRadius,c=t.style,d=t.markerEnd,f=t.markerStart,g=Math.abs(o-i)/2,_=o<i?o+g:o-g,v=Math.abs(r-n)/2,m=r<n?r+v:r-v,y="M ".concat(n,",").concat(i,"L ").concat(r,",").concat(o);return e().createElement(Br,{path:y,centerX:m,centerY:_,label:s,labelStyle:a,labelShowBg:u,labelBgStyle:l,labelBgPadding:p,labelBgBorderRadius:h,style:c,markerEnd:d,markerStart:f})}));function ro(t,e){return t>=0?.5*t:25*e*Math.sqrt(-t)}function oo(t){var e,n,i=t.pos,r=t.x1,o=t.y1,s=t.x2,a=t.y2,u=t.c;switch(i){case Zn.Left:e=r-ro(r-s,u),n=o;break;case Zn.Right:e=r+ro(s-r,u),n=o;break;case Zn.Top:e=r,n=o-ro(o-a,u);break;case Zn.Bottom:e=r,n=o+ro(a-o,u)}return[e,n]}function so(t){var e=t.sourceX,n=t.sourceY,i=t.sourcePosition,r=void 0===i?Zn.Bottom:i,o=t.targetX,s=t.targetY,a=t.targetPosition,u=void 0===a?Zn.Top:a,l=t.curvature,p=void 0===l?.25:l,h=li(oo({pos:r,x1:e,y1:n,x2:o,y2:s,c:p}),2),c=h[0],d=h[1],f=li(oo({pos:u,x1:o,y1:s,x2:e,y2:n,c:p}),2),g=f[0],_=f[1];return"M".concat(e,",").concat(n," C").concat(c,",").concat(d," ").concat(g,",").concat(_," ").concat(o,",").concat(s)}var ao=(0,t.memo)((function(t){var n=t.sourceX,i=t.sourceY,r=t.targetX,o=t.targetY,s=t.sourcePosition,a=void 0===s?Zn.Bottom:s,u=t.targetPosition,l=void 0===u?Zn.Top:u,p=t.label,h=t.labelStyle,c=t.labelShowBg,d=t.labelBgStyle,f=t.labelBgPadding,g=t.labelBgBorderRadius,_=t.style,v=t.markerEnd,m=t.markerStart,y={sourceX:n,sourceY:i,sourcePosition:a,targetX:r,targetY:o,targetPosition:l,curvature:t.curvature},b=so(y),x=function(t){var e=t.sourceX,n=t.sourceY,i=t.sourcePosition,r=void 0===i?Zn.Bottom:i,o=t.targetX,s=t.targetY,a=t.targetPosition,u=void 0===a?Zn.Top:a,l=t.curvature,p=void 0===l?.25:l,h=li(oo({pos:r,x1:e,y1:n,x2:o,y2:s,c:p}),2),c=h[0],d=h[1],f=li(oo({pos:u,x1:o,y1:s,x2:e,y2:n,c:p}),2),g=.125*e+.375*c+.375*f[0]+.125*o,_=.125*n+.375*d+.375*f[1]+.125*s;return[g,_,Math.abs(g-e),Math.abs(_-n)]}(y),A=li(x,2),w=A[0],E=A[1];return e().createElement(Br,{path:b,centerX:w,centerY:E,label:p,labelStyle:h,labelShowBg:c,labelBgStyle:d,labelBgPadding:f,labelBgBorderRadius:g,style:_,markerEnd:v,markerStart:m})})),uo=(0,t.createContext)(null),lo=uo.Provider;function po(t,e,n,i,r,o,s){var a=s.elementFromPoint(t.clientX,t.clientY),u=(null==a?void 0:a.classList.contains("target"))||!1,l=(null==a?void 0:a.classList.contains("source"))||!1,p={elementBelow:a,isValid:!1,connection:{source:null,target:null,sourceHandle:null,targetHandle:null},isHoveringHandle:!1};if(a&&(u||l)){p.isHoveringHandle=!0;var h=a.getAttribute("data-nodeid"),c=a.getAttribute("data-handleid"),d=n?{source:h,sourceHandle:c,target:i,targetHandle:r}:{source:i,sourceHandle:r,target:h,targetHandle:c};p.connection=d,(e!==zn.Strict||n&&l||!n&&u)&&(p.isValid=o(d))}return p}function ho(t){null==t||t.classList.remove("react-flow__handle-valid"),null==t||t.classList.remove("react-flow__handle-connecting")}function co(t){var e=t.event,n=t.handleId,i=t.nodeId,r=t.onConnect,o=t.isTarget,s=t.getState,a=t.setState,u=t.isValidConnection,l=t.elementEdgeUpdaterType,p=t.onEdgeUpdateEnd,h=e.target.closest(".react-flow"),c=di(e.target);if(c){var d=c.elementFromPoint(e.clientX,e.clientY),f=null==d?void 0:d.classList.contains("target"),g=null==d?void 0:d.classList.contains("source");if(h&&(f||g||l)){var _,v=s(),m=v.onConnectStart,y=v.connectionMode,b=l||(f?"target":"source"),x=h.getBoundingClientRect();a({connectionPosition:{x:e.clientX-x.left,y:e.clientY-x.top},connectionNodeId:i,connectionHandleId:n,connectionHandleType:b}),null==m||m(e,{nodeId:i,handleId:n,handleType:b}),c.addEventListener("mousemove",A),c.addEventListener("mouseup",(function t(e){var h=s(),d=h.onConnectStop,f=h.onConnectEnd,g=po(e,y,o,i,n,u,c),v=g.connection,m=g.isValid;null==d||d(e),m&&(null==r||r(v)),null==f||f(e),l&&p&&p(e),ho(_),a({connectionNodeId:null,connectionHandleId:null,connectionHandleType:null}),c.removeEventListener("mousemove",A),c.removeEventListener("mouseup",t)}))}}function A(t){a({connectionPosition:{x:t.clientX-x.left,y:t.clientY-x.top}});var e=po(t,y,o,i,n,u,c),r=e.connection,s=e.elementBelow,l=e.isValid;if(!e.isHoveringHandle)return ho(_);r.source!==r.target&&s&&(ho(_),_=s,s.classList.add("react-flow__handle-connecting"),s.classList.toggle("react-flow__handle-valid",l))}}uo.Consumer;var fo=["type","position","isValidConnection","isConnectable","id","onConnect","children","className","onMouseDown"];function go(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function _o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?go(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):go(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var vo=function(){return!0},mo=function(t){return{connectionStartHandle:t.connectionStartHandle,connectOnClick:t.connectOnClick}},yo=(0,t.forwardRef)((function(n,i){var r=n.type,o=void 0===r?"source":r,s=n.position,a=void 0===s?Zn.Top:s,u=n.isValidConnection,l=void 0===u?vo:u,p=n.isConnectable,h=void 0===p||p,c=n.id,d=n.onConnect,f=n.children,g=n.className,_=n.onMouseDown,v=cr(n,fo),m=nr(),y=(0,t.useContext)(uo),b=er(mo,rr),x=b.connectionStartHandle,A=b.connectOnClick,w=c||null,E="target"===o,C=function(t){var e=m.getState(),n=e.defaultEdgeOptions,i=e.onConnect,r=e.hasDefaultEdges,o=_o(_o({},n),t);if(r){var s=m.getState().edges;m.setState({edges:Gi(o,s)})}null==i||i(o),null==d||d(o)};return e().createElement("div",_o({"data-handleid":w,"data-nodeid":y,"data-handlepos":a,className:hr(["react-flow__handle","react-flow__handle-".concat(a),"nodrag",g,{source:!E,target:E,connectable:h,connecting:(null==x?void 0:x.nodeId)===y&&(null==x?void 0:x.handleId)===w&&(null==x?void 0:x.type)===o}]),onMouseDown:function(t){0===t.button&&co({event:t,handleId:w,nodeId:y,onConnect:C,isTarget:E,getState:m.getState,setState:m.setState,isValidConnection:l}),null==_||_(t)},onClick:A?function(t){var e=m.getState(),n=e.onClickConnectStart,i=e.onClickConnectStop,r=e.onClickConnectEnd,s=e.connectionMode;if(!x)return null==n||n(t,{nodeId:y,handleId:w,handleType:o}),void m.setState({connectionStartHandle:{nodeId:y,type:o,handleId:w}});var a=di(t.target),u=po(t,s,"target"===x.type,x.nodeId,x.handleId||null,l,a),p=u.connection,h=u.isValid;null==i||i(t),h&&C(p),null==r||r(t),m.setState({connectionStartHandle:null})}:void 0,ref:i},v),f)}));yo.displayName="Handle";var bo=(0,t.memo)(yo),xo=function(t){var n=t.data,i=t.isConnectable,r=t.targetPosition,o=void 0===r?Zn.Top:r,s=t.sourcePosition,a=void 0===s?Zn.Bottom:s;return e().createElement(e().Fragment,null,e().createElement(bo,{type:"target",position:o,isConnectable:i}),null==n?void 0:n.label,e().createElement(bo,{type:"source",position:a,isConnectable:i}))};xo.displayName="DefaultNode";var Ao=(0,t.memo)(xo),wo=function(t){var n=t.data,i=t.isConnectable,r=t.sourcePosition,o=void 0===r?Zn.Bottom:r;return e().createElement(e().Fragment,null,null==n?void 0:n.label,e().createElement(bo,{type:"source",position:o,isConnectable:i}))};wo.displayName="InputNode";var Eo=(0,t.memo)(wo),Co=function(t){var n=t.data,i=t.isConnectable,r=t.targetPosition,o=void 0===r?Zn.Top:r;return e().createElement(e().Fragment,null,e().createElement(bo,{type:"target",position:o,isConnectable:i}),null==n?void 0:n.label)};Co.displayName="OutputNode";var To=(0,t.memo)(Co),Oo=function(t){return{selectedNodes:Array.from(t.nodeInternals.values()).filter((function(t){return t.selected})),selectedEdges:t.edges.filter((function(t){return t.selected}))}},So=function(t,e){var n=t.selectedNodes.map((function(t){return t.id})),i=e.selectedNodes.map((function(t){return t.id})),r=t.selectedEdges.map((function(t){return t.id})),o=e.selectedEdges.map((function(t){return t.id}));return rr(n,i)&&rr(r,o)};function Io(e){var n=e.onSelectionChange,i=er(Oo,So),r=i.selectedNodes,o=i.selectedEdges;return(0,t.useEffect)((function(){n({nodes:r,edges:o})}),[r,o]),null}var Lo=(0,t.memo)(Io),No=function(t){return{setNodes:t.setNodes,setEdges:t.setEdges,setDefaultNodesAndEdges:t.setDefaultNodesAndEdges,setMinZoom:t.setMinZoom,setMaxZoom:t.setMaxZoom,setTranslateExtent:t.setTranslateExtent,setNodeExtent:t.setNodeExtent,reset:t.reset}};function Do(e,n){(0,t.useEffect)((function(){void 0!==e&&n(e)}),[e])}function ko(e,n,i){(0,t.useEffect)((function(){void 0!==n&&i(si({},e,n))}),[n])}var Go=function(e){var n=e.nodes,i=e.edges,r=e.defaultNodes,o=e.defaultEdges,s=e.onConnect,a=e.onConnectStart,u=e.onConnectStop,l=e.onConnectEnd,p=e.onClickConnectStart,h=e.onClickConnectStop,c=e.onClickConnectEnd,d=e.nodesDraggable,f=e.nodesConnectable,g=e.minZoom,_=e.maxZoom,v=e.nodeExtent,m=e.onNodesChange,y=e.onEdgesChange,b=e.elementsSelectable,x=e.connectionMode,A=e.snapGrid,w=e.snapToGrid,E=e.translateExtent,C=e.connectOnClick,T=e.defaultEdgeOptions,O=e.fitView,S=e.fitViewOptions,I=e.onNodesDelete,L=e.onEdgesDelete,N=e.onNodeDrag,D=e.onNodeDragStart,k=e.onNodeDragStop,G=e.onSelectionDrag,P=e.onSelectionDragStart,B=e.onSelectionDragStop,R=er(No,rr),M=R.setNodes,z=R.setEdges,F=R.setDefaultNodesAndEdges,j=R.setMinZoom,H=R.setMaxZoom,U=R.setTranslateExtent,V=R.setNodeExtent,W=R.reset,X=nr();return(0,t.useEffect)((function(){return F(r,o),function(){W()}}),[]),ko("defaultEdgeOptions",T,X.setState),ko("connectionMode",x,X.setState),ko("onConnect",s,X.setState),ko("onConnectStart",a,X.setState),ko("onConnectStop",u,X.setState),ko("onConnectEnd",l,X.setState),ko("onClickConnectStart",p,X.setState),ko("onClickConnectStop",h,X.setState),ko("onClickConnectEnd",c,X.setState),ko("nodesDraggable",d,X.setState),ko("nodesConnectable",f,X.setState),ko("elementsSelectable",b,X.setState),ko("snapToGrid",w,X.setState),ko("snapGrid",A,X.setState),ko("onNodesChange",m,X.setState),ko("onEdgesChange",y,X.setState),ko("connectOnClick",C,X.setState),ko("fitViewOnInit",O,X.setState),ko("fitViewOnInitOptions",S,X.setState),ko("onNodesDelete",I,X.setState),ko("onEdgesDelete",L,X.setState),ko("onNodeDrag",N,X.setState),ko("onNodeDragStart",D,X.setState),ko("onNodeDragStop",k,X.setState),ko("onSelectionDrag",G,X.setState),ko("onSelectionDragStart",P,X.setState),ko("onSelectionDragStop",B,X.setState),Do(n,M),Do(i,z),Do(r,M),Do(o,z),Do(g,j),Do(_,H),Do(E,U),Do(v,V),null},Po=function(t,e,n){return n===Zn.Left?t-e:n===Zn.Right?t+e:t},Bo=function(t,e,n){return n===Zn.Top?t-e:n===Zn.Bottom?t+e:t},Ro=function(t){var n=t.className,i=t.position,r=t.centerX,o=t.centerY,s=t.radius,a=void 0===s?10:s;return e().createElement("circle",{className:hr(["react-flow__edgeupdater",n]),cx:Po(r,a,i),cy:Bo(o,a,i),r:a,stroke:"transparent",fill:"transparent"})},Mo=function(n){var i=function(i){var r=i.id,o=i.className,s=i.type,a=i.data,u=i.onClick,l=i.onEdgeDoubleClick,p=i.selected,h=i.animated,c=i.label,d=i.labelStyle,f=i.labelShowBg,g=i.labelBgStyle,_=i.labelBgPadding,v=i.labelBgBorderRadius,m=i.style,y=i.source,b=i.target,x=i.sourceX,A=i.sourceY,w=i.targetX,E=i.targetY,C=i.sourcePosition,T=i.targetPosition,O=i.elementsSelectable,S=i.hidden,I=i.sourceHandleId,L=i.targetHandleId,N=i.onContextMenu,D=i.onMouseEnter,k=i.onMouseMove,G=i.onMouseLeave,P=i.edgeUpdaterRadius,B=i.onEdgeUpdate,R=i.onEdgeUpdateStart,M=i.onEdgeUpdateEnd,z=i.markerEnd,F=i.markerStart,j=i.rfId,H=li((0,t.useState)(!1),2),U=H[0],V=H[1],W=nr(),X=Ur(r,W.getState,l),Y=Ur(r,W.getState,N),q=Ur(r,W.getState,D),Z=Ur(r,W.getState,k),K=Ur(r,W.getState,G),$=function(t,e){var n=e?b:y,i=(e?L:I)||null,o=e?"target":"source",s=e,a=W.getState().edges.find((function(t){return t.id===r}));null==R||R(t,a,o);var u=M?function(t){return M(t,a,o)}:void 0;co({event:t,handleId:i,nodeId:n,onConnect:function(t){return null==B?void 0:B(a,t)},isTarget:s,getState:W.getState,setState:W.setState,isValidConnection:function(){return!0},elementEdgeUpdaterType:o,onEdgeUpdateEnd:u})},Q=function(){return V(!0)},J=function(){return V(!1)},tt=(0,t.useMemo)((function(){return"url(#".concat(ki(F,j),")")}),[F,j]),et=(0,t.useMemo)((function(){return"url(#".concat(ki(z,j),")")}),[z,j]);if(S)return null;var nt=!O&&!u,it=void 0!==B,rt=hr(["react-flow__edge","react-flow__edge-".concat(s),o,{selected:p,animated:h,inactive:nt,updating:U}]);return e().createElement("g",{className:rt,onClick:function(t){var e=W.getState(),n=e.edges,i=e.addSelectedEdges,o=n.find((function(t){return t.id===r}));O&&(W.setState({nodesSelectionActive:!1}),i([r])),null==u||u(t,o)},onDoubleClick:X,onContextMenu:Y,onMouseEnter:q,onMouseMove:Z,onMouseLeave:K},e().createElement(n,{id:r,source:y,target:b,selected:p,animated:h,label:c,labelStyle:d,labelShowBg:f,labelBgStyle:g,labelBgPadding:_,labelBgBorderRadius:v,data:a,style:m,sourceX:x,sourceY:A,targetX:w,targetY:E,sourcePosition:C,targetPosition:T,sourceHandleId:I,targetHandleId:L,markerStart:tt,markerEnd:et,"data-testid":"rf__edge-".concat(r)}),it&&e().createElement("g",{onMouseDown:function(t){return $(t,!0)},onMouseEnter:Q,onMouseOut:J},e().createElement(Ro,{position:C,centerX:x,centerY:A,radius:P})),it&&e().createElement("g",{onMouseDown:function(t){return $(t,!1)},onMouseEnter:Q,onMouseOut:J},e().createElement(Ro,{position:T,centerX:w,centerY:E,radius:P})))};return i.displayName="EdgeWrapper",(0,t.memo)(i)};function zo(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Fo(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?zo(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zo(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function jo(t){var e={default:Mo(t.default||ao),straight:Mo(t.bezier||io),step:Mo(t.step||no),smoothstep:Mo(t.step||Jr),simplebezier:Mo(t.simplebezier||zr)},n=Object.keys(t).filter((function(t){return!["default","bezier"].includes(t)})).reduce((function(e,n){return e[n]=Mo(t[n]||ao),e}),{});return Fo(Fo({},e),n)}function Ho(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=((null==n?void 0:n.x)||0)+e.x,r=((null==n?void 0:n.y)||0)+e.y,o=(null==n?void 0:n.width)||e.width,s=(null==n?void 0:n.height)||e.height;switch(t){case Zn.Top:return{x:i+o/2,y:r};case Zn.Right:return{x:i+o,y:r+s/2};case Zn.Bottom:return{x:i+o/2,y:r+s};case Zn.Left:return{x:i,y:r+s/2}}}function Uo(t,e){if(!t)return null;var n=null;return 1!==t.length&&e?e&&(n=t.find((function(t){return t.id===e}))):n=t[0],void 0===n?null:n}function Vo(t,e){var n,i,r,o,s,a=t.get(e),u=(null==a||null===(n=a[mi])||void 0===n?void 0:n.handleBounds)||null,l=!(a&&u&&a.width&&a.height&&void 0!==(null===(i=a.positionAbsolute)||void 0===i?void 0:i.x)&&void 0!==(null===(r=a.positionAbsolute)||void 0===r?void 0:r.y));return[{x:(null==a||null===(o=a.positionAbsolute)||void 0===o?void 0:o.x)||0,y:(null==a||null===(s=a.positionAbsolute)||void 0===s?void 0:s.y)||0,width:(null==a?void 0:a.width)||0,height:(null==a?void 0:a.height)||0},u,!l]}var Wo="undefined"!=typeof document?document:null,Xo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{target:Wo},i=li((0,t.useState)(!1),2),r=i[0],o=i[1],s=(0,t.useRef)(new Set([])),a=li((0,t.useMemo)((function(){if(null!==e){var t=(Array.isArray(e)?e:[e]).filter((function(t){return"string"==typeof t})).map((function(t){return t.split("+")})),n=t.reduce((function(t,e){return t.concat.apply(t,or(e))}),[]);return[t,n]}return[[],[]]}),[e]),2),u=a[0],l=a[1];return(0,t.useEffect)((function(){if(null!==e){var t,i,r=function(t){if(Zo(t))return!1;var e=qo(t.code,l);s.current.add(t[e]),Yo(u,s.current,!1)&&(t.preventDefault(),o(!0))},a=function(t){if(Zo(t))return!1;var e=qo(t.code,l);Yo(u,s.current,!0)?(o(!1),s.current.clear()):s.current.delete(t[e])},p=function(){s.current.clear(),o(!1)};return null==n||null===(t=n.target)||void 0===t||t.addEventListener("keydown",r),null==n||null===(i=n.target)||void 0===i||i.addEventListener("keyup",a),window.addEventListener("blur",p),function(){var t,e;null==n||null===(t=n.target)||void 0===t||t.removeEventListener("keydown",r),null==n||null===(e=n.target)||void 0===e||e.removeEventListener("keyup",a),window.removeEventListener("blur",p)}}}),[e,o]),r};function Yo(t,e,n){return t.filter((function(t){return n||t.length===e.size})).some((function(t){return t.every((function(t){return e.has(t)}))}))}function qo(t,e){return e.includes(t)?"code":"key"}function Zo(t){var e,n=(null===(e=t.composedPath)||void 0===e?void 0:e.call(t)[0])||t.target;return["INPUT","SELECT","TEXTAREA"].includes(null==n?void 0:n.nodeName)||(null==n?void 0:n.hasAttribute("contenteditable"))}var Ko=function(t){return{onNodesChange:t.onNodesChange,onEdgesChange:t.onEdgesChange}},$o=function(t){return{x:t.x,y:t.y,zoom:t.k}},Qo=function(t,e){return t.target.closest(".".concat(e))},Jo=function(t){return{d3Zoom:t.d3Zoom,d3Selection:t.d3Selection,d3ZoomHandler:t.d3ZoomHandler}},ts=function(n){var i=n.onMove,r=n.onMoveStart,o=n.onMoveEnd,s=n.zoomOnScroll,a=void 0===s||s,u=n.zoomOnPinch,l=void 0===u||u,p=n.panOnScroll,h=void 0!==p&&p,c=n.panOnScrollSpeed,d=void 0===c?.5:c,f=n.panOnScrollMode,g=void 0===f?Un.Free:f,_=n.zoomOnDoubleClick,v=void 0===_||_,m=n.selectionKeyPressed,y=n.elementsSelectable,b=n.panOnDrag,A=void 0===b||b,w=n.translateExtent,E=n.minZoom,C=n.maxZoom,T=n.defaultZoom,O=void 0===T?1:T,S=n.defaultPosition,I=void 0===S?[0,0]:S,L=n.zoomActivationKeyCode,N=n.preventScrolling,D=void 0===N||N,k=n.children,G=n.noWheelClassName,P=n.noPanClassName,B=nr(),R=(0,t.useRef)(!1),M=(0,t.useRef)(null),z=(0,t.useRef)({x:0,y:0,zoom:0}),F=er(Jo,rr),j=F.d3Zoom,H=F.d3Selection,U=F.d3ZoomHandler,V=Xo(L);return function(e){var n=nr();(0,t.useEffect)((function(){var t,i=function(){if(e.current){var t=pi(e.current);n.setState({width:t.width||500,height:t.height||500})}};return i(),window.onresize=i,e.current&&(t=new ResizeObserver((function(){return i()}))).observe(e.current),function(){window.onresize=null,t&&e.current&&t.unobserve(e.current)}}),[])}(M),(0,t.useEffect)((function(){if(M.current){var t,e=function(){var t,e,n,i=ti,r=ei,o=oi,s=ii,a=ri,u=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],p=250,h=Ht,c=x("start","zoom","end"),d=0,f=10;function g(t){t.property("__zoom",ni).on("wheel.zoom",w,{passive:!1}).on("mousedown.zoom",E).on("dblclick.zoom",C).filter(a).on("touchstart.zoom",T).on("touchmove.zoom",O).on("touchend.zoom touchcancel.zoom",S).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function _(t,e){return(e=Math.max(u[0],Math.min(u[1],e)))===t.k?t:new Mn(e,t.x,t.y)}function v(t,e,n){var i=e[0]-n[0]*t.k,r=e[1]-n[1]*t.k;return i===t.x&&r===t.y?t:new Mn(t.k,i,r)}function m(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function y(t,e,n,i){t.on("start.zoom",(function(){b(this,arguments).event(i).start()})).on("interrupt.zoom end.zoom",(function(){b(this,arguments).event(i).end()})).tween("zoom",(function(){var t=this,o=arguments,s=b(t,o).event(i),a=r.apply(t,o),u=null==n?m(a):"function"==typeof n?n.apply(t,o):n,l=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),p=t.__zoom,c="function"==typeof e?e.apply(t,o):e,d=h(p.invert(u).concat(l/p.k),c.invert(u).concat(l/c.k));return function(t){if(1===t)t=c;else{var e=d(t),n=l/e[2];t=new Mn(n,u[0]-e[0]*n,u[1]-e[1]*n)}s.zoom(null,t)}}))}function b(t,e,n){return!n&&t.__zooming||new A(t,e)}function A(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=r.apply(t,e),this.taps=0}function w(t,...e){if(i.apply(this,arguments)){var n=b(this,e).event(t),r=this.__zoom,a=Math.max(u[0],Math.min(u[1],r.k*Math.pow(2,s.apply(this,arguments)))),p=Ut(t);if(n.wheel)n.mouse[0][0]===p[0]&&n.mouse[0][1]===p[1]||(n.mouse[1]=r.invert(n.mouse[0]=p)),clearTimeout(n.wheel);else{if(r.k===a)return;n.mouse=[p,r.invert(p)],fe(this),n.start()}Jn(t),n.wheel=setTimeout((function(){n.wheel=null,n.end()}),150),n.zoom("mouse",o(v(_(r,a),n.mouse[0],n.mouse[1]),n.extent,l))}}function E(t,...e){if(!n&&i.apply(this,arguments)){var r=t.currentTarget,s=b(this,e,!0).event(t),a=Gt(t.view).on("mousemove.zoom",(function(t){if(Jn(t),!s.moved){var e=t.clientX-p,n=t.clientY-h;s.moved=e*e+n*n>d}s.event(t).zoom("mouse",o(v(s.that.__zoom,s.mouse[0]=Ut(t,r),s.mouse[1]),s.extent,l))}),!0).on("mouseup.zoom",(function(t){a.on("mousemove.zoom mouseup.zoom",null),Ft(t.view,s.moved),Jn(t),s.event(t).end()}),!0),u=Ut(t,r),p=t.clientX,h=t.clientY;zt(t.view),Qn(t),s.mouse=[u,this.__zoom.invert(u)],fe(this),s.start()}}function C(t,...e){if(i.apply(this,arguments)){var n=this.__zoom,s=Ut(t.changedTouches?t.changedTouches[0]:t,this),a=n.invert(s),u=n.k*(t.shiftKey?.5:2),h=o(v(_(n,u),s,a),r.apply(this,e),l);Jn(t),p>0?Gt(this).transition().duration(p).call(y,h,s,t):Gt(this).call(g.transform,h,s,t)}}function T(n,...r){if(i.apply(this,arguments)){var o,s,a,u,l=n.touches,p=l.length,h=b(this,r,n.changedTouches.length===p).event(n);for(Qn(n),s=0;s<p;++s)u=[u=Ut(a=l[s],this),this.__zoom.invert(u),a.identifier],h.touch0?h.touch1||h.touch0[2]===u[2]||(h.touch1=u,h.taps=0):(h.touch0=u,o=!0,h.taps=1+!!t);t&&(t=clearTimeout(t)),o&&(h.taps<2&&(e=u[0],t=setTimeout((function(){t=null}),500)),fe(this),h.start())}}function O(t,...e){if(this.__zooming){var n,i,r,s,a=b(this,e).event(t),u=t.changedTouches,p=u.length;for(Jn(t),n=0;n<p;++n)r=Ut(i=u[n],this),a.touch0&&a.touch0[2]===i.identifier?a.touch0[0]=r:a.touch1&&a.touch1[2]===i.identifier&&(a.touch1[0]=r);if(i=a.that.__zoom,a.touch1){var h=a.touch0[0],c=a.touch0[1],d=a.touch1[0],f=a.touch1[1],g=(g=d[0]-h[0])*g+(g=d[1]-h[1])*g,m=(m=f[0]-c[0])*m+(m=f[1]-c[1])*m;i=_(i,Math.sqrt(g/m)),r=[(h[0]+d[0])/2,(h[1]+d[1])/2],s=[(c[0]+f[0])/2,(c[1]+f[1])/2]}else{if(!a.touch0)return;r=a.touch0[0],s=a.touch0[1]}a.zoom("touch",o(v(i,r,s),a.extent,l))}}function S(t,...i){if(this.__zooming){var r,o,s=b(this,i).event(t),a=t.changedTouches,u=a.length;for(Qn(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),500),r=0;r<u;++r)o=a[r],s.touch0&&s.touch0[2]===o.identifier?delete s.touch0:s.touch1&&s.touch1[2]===o.identifier&&delete s.touch1;if(s.touch1&&!s.touch0&&(s.touch0=s.touch1,delete s.touch1),s.touch0)s.touch0[1]=this.__zoom.invert(s.touch0[0]);else if(s.end(),2===s.taps&&(o=Ut(o,this),Math.hypot(e[0]-o[0],e[1]-o[1])<f)){var l=Gt(this).on("dblclick.zoom");l&&l.apply(this,arguments)}}}return g.transform=function(t,e,n,i){var r=t.selection?t.selection():t;r.property("__zoom",ni),t!==r?y(t,e,n,i):r.interrupt().each((function(){b(this,arguments).event(i).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},g.scaleBy=function(t,e,n,i){g.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)}),n,i)},g.scaleTo=function(t,e,n,i){g.transform(t,(function(){var t=r.apply(this,arguments),i=this.__zoom,s=null==n?m(t):"function"==typeof n?n.apply(this,arguments):n,a=i.invert(s),u="function"==typeof e?e.apply(this,arguments):e;return o(v(_(i,u),s,a),t,l)}),n,i)},g.translateBy=function(t,e,n,i){g.transform(t,(function(){return o(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),r.apply(this,arguments),l)}),null,i)},g.translateTo=function(t,e,n,i,s){g.transform(t,(function(){var t=r.apply(this,arguments),s=this.__zoom,a=null==i?m(t):"function"==typeof i?i.apply(this,arguments):i;return o($n.translate(a[0],a[1]).scale(s.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,l)}),i,s)},A.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=Gt(this.that).datum();c.call(t,this.that,new Rn(t,{sourceEvent:this.sourceEvent,target:g,type:t,transform:this.that.__zoom,dispatch:c}),e)}},g.wheelDelta=function(t){return arguments.length?(s="function"==typeof t?t:Bn(+t),g):s},g.filter=function(t){return arguments.length?(i="function"==typeof t?t:Bn(!!t),g):i},g.touchable=function(t){return arguments.length?(a="function"==typeof t?t:Bn(!!t),g):a},g.extent=function(t){return arguments.length?(r="function"==typeof t?t:Bn([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),g):r},g.scaleExtent=function(t){return arguments.length?(u[0]=+t[0],u[1]=+t[1],g):[u[0],u[1]]},g.translateExtent=function(t){return arguments.length?(l[0][0]=+t[0][0],l[1][0]=+t[1][0],l[0][1]=+t[0][1],l[1][1]=+t[1][1],g):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},g.constrain=function(t){return arguments.length?(o=t,g):o},g.duration=function(t){return arguments.length?(p=+t,g):p},g.interpolate=function(t){return arguments.length?(h=t,g):h},g.on=function(){var t=c.on.apply(c,arguments);return t===c?g:t},g.clickDistance=function(t){return arguments.length?(d=(t=+t)*t,g):Math.sqrt(d)},g.tapDistance=function(t){return arguments.length?(f=+t,g):f},g}().scaleExtent([E,C]).translateExtent(w),n=Gt(M.current).call(e),i=hi(I[0],w[0][0],w[1][0]),r=hi(I[1],w[0][1],w[1][1]),o=hi(O,E,C),s=$n.translate(i,r).scale(o);e.transform(n,s),B.setState({d3Zoom:e,d3Selection:n,d3ZoomHandler:n.on("wheel.zoom"),transform:[i,r,o],domNode:null===(t=n.node())||void 0===t?void 0:t.closest(".react-flow")})}}),[]),(0,t.useEffect)((function(){H&&j&&(h&&!V?H.on("wheel",(function(t){if(Qo(t,G))return!1;t.preventDefault(),t.stopImmediatePropagation();var e=H.property("__zoom").k||1;if(t.ctrlKey&&l){var n=Ut(t),i=-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*10,r=e*Math.pow(2,i);j.scaleTo(H,r,n)}else{var o=1===t.deltaMode?20:1,s=g===Un.Vertical?0:t.deltaX*o,a=g===Un.Horizontal?0:t.deltaY*o;j.translateBy(H,-s/e*d,-a/e*d)}})).on("wheel.zoom",null):void 0!==U&&H.on("wheel",(function(t){if(!D||Qo(t,G))return null;t.preventDefault()})).on("wheel.zoom",U))}),[h,g,H,j,U,V,l,D,G]),(0,t.useEffect)((function(){j&&(m&&!R.current?j.on("zoom",null):m||j.on("zoom",(function(t){if(B.setState({transform:[t.transform.x,t.transform.y,t.transform.k]}),i){var e=$o(t.transform);i(t.sourceEvent,e)}})))}),[m,j,i]),(0,t.useEffect)((function(){j&&j.on("start",(function(t){if(R.current=!0,r){var e=$o(t.transform);z.current=e,r(t.sourceEvent,e)}}))}),[j,r]),(0,t.useEffect)((function(){j&&j.on("end",(function(t){if(R.current=!1,o&&(n=z.current,i=t.transform,n.x!==i.x||n.y!==i.y||n.zoom!==i.k)){var e=$o(t.transform);z.current=e,o(t.sourceEvent,e)}var n,i}))}),[j,o]),(0,t.useEffect)((function(){j&&j.filter((function(t){var e=V||a,n=l&&t.ctrlKey;return!(!(A||e||h||v||l)||m||!v&&"dblclick"===t.type||Qo(t,G)&&"wheel"===t.type||Qo(t,P)&&"wheel"!==t.type||!l&&t.ctrlKey&&"wheel"===t.type||!(e||h||n||"wheel"!==t.type)||!(A||"mousedown"!==t.type&&"touchstart"!==t.type)||t.ctrlKey&&"wheel"!==t.type||t.button)}))}),[j,a,l,h,v,A,m,y,V]),e().createElement("div",{className:"react-flow__renderer react-flow__container",ref:M},k)};function es(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function ns(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?es(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):es(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function is(t,e){return{x:t.clientX-e.left,y:t.clientY-e.top}}var rs=function(t){return{userSelectionActive:t.userSelectionActive,elementsSelectable:t.elementsSelectable}},os={startX:0,startY:0,x:0,y:0,width:0,height:0,draw:!1},ss=(0,t.memo)((function(n){var i=n.selectionKeyPressed,r=nr(),o=(0,t.useRef)(0),s=(0,t.useRef)(0),a=(0,t.useRef)(),u=li((0,t.useState)(os),2),l=u[0],p=u[1],h=er(rs,rr),c=h.userSelectionActive;if(!h.elementsSelectable||!c&&!i)return null;var d=function(){p(os),r.setState({userSelectionActive:!1}),o.current=0,s.current=0};return e().createElement("div",{className:"react-flow__selectionpane react-flow__container",onMouseDown:function(t){var e=t.target.closest(".react-flow");a.current=e.getBoundingClientRect();var n=is(t,a.current);p({width:0,height:0,startX:n.x,startY:n.y,x:n.x,y:n.y,draw:!0}),r.setState({userSelectionActive:!0,nodesSelectionActive:!1})},onMouseMove:function(t){var e,n;if(i&&l.draw&&a.current){var u=is(t,a.current),h=null!==(e=l.startX)&&void 0!==e?e:0,c=null!==(n=l.startY)&&void 0!==n?n:0,d=ns(ns({},l),{},{x:u.x<h?u.x:h,y:u.y<c?u.y:c,width:Math.abs(u.x-h),height:Math.abs(u.y-c)}),f=r.getState(),g=f.nodeInternals,_=f.edges,v=f.transform,m=f.onNodesChange,y=f.onEdgesChange,b=Array.from(g.values()),x=Ri(g,d,v,!1,!0),A=Mi(x,_).map((function(t){return t.id})),w=x.map((function(t){return t.id}));if(o.current!==w.length){o.current=w.length;var E=Ci(b,w);E.length&&(null==m||m(E))}if(s.current!==A.length){s.current=A.length;var C=Ci(_,A);C.length&&(null==y||y(C))}p(d)}},onMouseUp:function(){r.setState({nodesSelectionActive:o.current>0}),d()},onMouseLeave:function(){r.setState({nodesSelectionActive:!1}),d()}},l.draw&&e().createElement("div",{className:"react-flow__selection react-flow__container",style:{width:l.width,height:l.height,transform:"translate(".concat(l.x,"px, ").concat(l.y,"px)")}}))}));function as(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function us(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?as(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):as(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ls(t,e){if(!t.parentNode)return!1;var n=e.get(t.parentNode);return!!n&&(!!n.selected||ls(n,e))}function ps(t,e,n){var i=t;do{var r;if(null!==(r=i)&&void 0!==r&&r.matches(e))return!0;if(i===n.current)return!1;i=i.parentElement}while(i);return!1}function hs(t,e,n){return Array.from(t.values()).filter((function(e){return(e.selected||e.id===n)&&(!e.parentNode||!ls(e,t))})).map((function(t){var n,i,r,o;return{id:t.id,position:t.position||{x:0,y:0},positionAbsolute:t.positionAbsolute||{x:0,y:0},distance:{x:e.x-(null!==(n=null===(i=t.positionAbsolute)||void 0===i?void 0:i.x)&&void 0!==n?n:0),y:e.y-(null!==(r=null===(o=t.positionAbsolute)||void 0===o?void 0:o.y)&&void 0!==r?r:0)},delta:{x:0,y:0},extent:t.extent,parentNode:t.parentNode,width:t.width,height:t.height}}))}function cs(t){var e=t.nodeId,n=t.dragItems,i=t.nodeInternals,r=n.map((function(t){return us(us({},i.get(t.id)),{},{position:t.position,positionAbsolute:t.positionAbsolute})}));return[e?r.find((function(t){return t.id===e})):r[0],r]}function ds(t){return function(e,n,i){return null==t?void 0:t(e,i)}}function fs(e){var n=e.nodeRef,i=e.disabled,r=void 0!==i&&i,o=e.noDragClassName,s=e.handleSelector,a=e.nodeId,u=e.isSelectable,l=e.selectNodesOnDrag,p=li((0,t.useState)(!1),2),h=p[0],c=p[1],d=nr(),f=(0,t.useRef)(),g=(0,t.useRef)({x:null,y:null}),_=(0,t.useCallback)((function(t){var e=t.sourceEvent,n=d.getState(),i=n.transform,r=n.snapGrid,o=n.snapToGrid,s=e.touches?e.touches[0].clientX:e.clientX,a=e.touches?e.touches[0].clientY:e.clientY;return Pi({x:s,y:a},i,o,r)}),[]);return(0,t.useEffect)((function(){if(null!=n&&n.current){var t=Gt(n.current);if(!r){var e=function(){var t,e,n,i,r=Tr,o=Or,s=Sr,a=Ir,u={},l=x("start","drag","end"),p=0,h=0;function c(t){t.on("mousedown.drag",d).filter(a).on("touchstart.drag",_).on("touchmove.drag",v,Pt).on("touchend.drag touchcancel.drag",m).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(s,a){if(!i&&r.call(this,s,a)){var u=y(this,o.call(this,s,a),s,a,"mouse");u&&(Gt(s.view).on("mousemove.drag",f,Bt).on("mouseup.drag",g,Bt),zt(s.view),Rt(s),n=!1,t=s.clientX,e=s.clientY,u("start",s))}}function f(i){if(Mt(i),!n){var r=i.clientX-t,o=i.clientY-e;n=r*r+o*o>h}u.mouse("drag",i)}function g(t){Gt(t.view).on("mousemove.drag mouseup.drag",null),Ft(t.view,n),Mt(t),u.mouse("end",t)}function _(t,e){if(r.call(this,t,e)){var n,i,s=t.changedTouches,a=o.call(this,t,e),u=s.length;for(n=0;n<u;++n)(i=y(this,a,t,e,s[n].identifier,s[n]))&&(Rt(t),i("start",t,s[n]))}}function v(t){var e,n,i=t.changedTouches,r=i.length;for(e=0;e<r;++e)(n=u[i[e].identifier])&&(Mt(t),n("drag",t,i[e]))}function m(t){var e,n,r=t.changedTouches,o=r.length;for(i&&clearTimeout(i),i=setTimeout((function(){i=null}),500),e=0;e<o;++e)(n=u[r[e].identifier])&&(Rt(t),n("end",t,r[e]))}function y(t,e,n,i,r,o){var a,h,d,f=l.copy(),g=Ut(o||n,e);if(null!=(d=s.call(t,new Cr("beforestart",{sourceEvent:n,target:c,identifier:r,active:p,x:g[0],y:g[1],dx:0,dy:0,dispatch:f}),i)))return a=d.x-g[0]||0,h=d.y-g[1]||0,function n(o,s,l){var _,v=g;switch(o){case"start":u[r]=n,_=p++;break;case"end":delete u[r],--p;case"drag":g=Ut(l||s,e),_=p}f.call(o,t,new Cr(o,{sourceEvent:s,subject:d,target:c,identifier:r,active:_,x:g[0]+a,y:g[1]+h,dx:g[0]-v[0],dy:g[1]-v[1],dispatch:f}),i)}}return c.filter=function(t){return arguments.length?(r="function"==typeof t?t:Er(!!t),c):r},c.container=function(t){return arguments.length?(o="function"==typeof t?t:Er(t),c):o},c.subject=function(t){return arguments.length?(s="function"==typeof t?t:Er(t),c):s},c.touchable=function(t){return arguments.length?(a="function"==typeof t?t:Er(!!t),c):a},c.on=function(){var t=l.on.apply(l,arguments);return t===l?c:t},c.clickDistance=function(t){return arguments.length?(h=(t=+t)*t,c):Math.sqrt(h)},c}().on("start",(function(t){var e,n=d.getState(),i=n.nodeInternals,r=n.multiSelectionActive,o=n.unselectNodesAndEdges,s=n.onNodeDragStart,p=n.onSelectionDragStart,h=a?s:ds(p);l||r||!a||null!==(e=i.get(a))&&void 0!==e&&e.selected||o(),a&&u&&l&&Li({id:a,store:d});var c=_(t);if(g.current=c,f.current=hs(i,c,a),h&&f.current){var v=li(cs({nodeId:a,dragItems:f.current,nodeInternals:i}),2),m=v[0],y=v[1];h(t.sourceEvent,m,y)}})).on("drag",(function(t){var e=d.getState(),n=e.updateNodePositions,i=e.snapToGrid,r=e.snapGrid,o=e.nodeInternals,s=e.nodeExtent,u=e.onNodeDrag,l=e.onSelectionDrag,p=_(t);if((g.current.x!==p.x||g.current.y!==p.y)&&f.current){g.current=p,f.current=f.current.map((function(t){return function(t,e,n,i,r,o){var s=li(i,2),a=s[0],u=s[1],l=t.extent||o,p={x:e.x-t.distance.x,y:e.y-t.distance.y};if(n&&(p.x=a*Math.round(p.x/a),p.y=u*Math.round(p.y/u)),"parent"===t.extent)if(t.parentNode&&t.width&&t.height){var h=r.get(t.parentNode);l=null!=h&&h.positionAbsolute&&null!=h&&h.width&&null!=h&&h.height?[[h.positionAbsolute.x,h.positionAbsolute.y],[h.positionAbsolute.x+h.width-t.width,h.positionAbsolute.y+h.height-t.height]]:l}else l=o;else if(t.extent&&t.parentNode){var c,d,f,g,_=r.get(t.parentNode),v=null!==(c=null==_||null===(d=_.positionAbsolute)||void 0===d?void 0:d.x)&&void 0!==c?c:0,m=null!==(f=null==_||null===(g=_.positionAbsolute)||void 0===g?void 0:g.y)&&void 0!==f?f:0;l=[[t.extent[0][0]+v,t.extent[0][1]+m],[t.extent[1][0]+v,t.extent[1][1]+m]]}var y={x:0,y:0};if(t.parentNode){var b,x,A,w,E=r.get(t.parentNode);y={x:null!==(b=null==E||null===(x=E.positionAbsolute)||void 0===x?void 0:x.x)&&void 0!==b?b:0,y:null!==(A=null==E||null===(w=E.positionAbsolute)||void 0===w?void 0:w.y)&&void 0!==A?A:0}}return t.positionAbsolute=l?ci(p,l):p,t.position={x:t.positionAbsolute.x-y.x,y:t.positionAbsolute.y-y.y},t}(t,p,i,r,o,s)}));var h=a?u:ds(l);if(n(f.current,!0,!0),c(!0),h){var v=li(cs({nodeId:a,dragItems:f.current,nodeInternals:o}),2),m=v[0],y=v[1];h(t.sourceEvent,m,y)}}t.on("end",(function(t){if(c(!1),f.current){var e=d.getState(),n=e.updateNodePositions,i=e.nodeInternals,r=e.onNodeDragStop,o=e.onSelectionDragStop,s=a?r:ds(o);if(n(f.current,!1,!1),s){var u=li(cs({nodeId:a,dragItems:f.current,nodeInternals:i}),2),l=u[0],p=u[1];s(t.sourceEvent,l,p)}}}))})).filter((function(t){var e=t.target;return!t.button&&(!o||!ps(e,".".concat(o),n))&&(!s||ps(e,s,n))}));return t.call(e),function(){t.on(".drag",null)}}t.on(".drag",null)}}),[n,r,o,s,u,d,a,l,_]),h}function gs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}var _s=function(t){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?gs(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gs(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({transformString:"translate(".concat(t.transform[0],"px,").concat(t.transform[1],"px) scale(").concat(t.transform[2],")"),userSelectionActive:t.userSelectionActive},Bi(Array.from(t.nodeInternals.values()).filter((function(t){return t.selected}))))},vs=function(t){var e=Array.from(t.nodeInternals.values()).filter((function(t){return t.selected}));return Bi(e)};function ms(n){var i=n.onSelectionContextMenu,r=n.noPanClassName,o=nr(),s=er(_s,rr),a=s.transformString,u=s.userSelectionActive,l=er(vs,rr),p=l.width,h=l.height,c=l.x,d=l.y,f=(0,t.useRef)(null);if(fs({nodeRef:f}),u||!p||!h)return null;var g=i?function(t){var e=Array.from(o.getState().nodeInternals.values()).filter((function(t){return t.selected}));i(t,e)}:void 0;return e().createElement("div",{className:hr(["react-flow__nodesselection","react-flow__container",r]),style:{transform:a}},e().createElement("div",{ref:f,className:"react-flow__nodesselection-rect",onContextMenu:g,style:{width:p,height:h,top:d,left:c}}))}var ys=(0,t.memo)(ms),bs=function(t){return t.nodesSelectionActive},xs=function(n){var i=n.children,r=n.onPaneClick,o=n.onPaneContextMenu,s=n.onPaneScroll,a=n.deleteKeyCode,u=n.onMove,l=n.onMoveStart,p=n.onMoveEnd,h=n.selectionKeyCode,c=n.multiSelectionKeyCode,d=n.zoomActivationKeyCode,f=n.elementsSelectable,g=n.zoomOnScroll,_=n.zoomOnPinch,v=n.panOnScroll,m=n.panOnScrollSpeed,y=n.panOnScrollMode,b=n.zoomOnDoubleClick,x=n.panOnDrag,A=n.translateExtent,w=n.minZoom,E=n.maxZoom,C=n.defaultZoom,T=n.defaultPosition,O=n.preventScrolling,S=n.onSelectionContextMenu,I=n.noWheelClassName,L=n.noPanClassName,N=nr(),D=er(bs),k=Xo(h);!function(e){var n=e.deleteKeyCode,i=e.multiSelectionKeyCode,r=nr(),o=er(Ko,rr),s=o.onNodesChange,a=o.onEdgesChange,u=Xo(n),l=Xo(i);(0,t.useEffect)((function(){var t=r.getState(),e=t.nodeInternals,n=t.edges,i=t.hasDefaultNodes,o=t.hasDefaultEdges,l=t.onNodesDelete,p=t.onEdgesDelete,h=Array.from(e.values()).reduce((function(t,e){return(!e.selected&&e.parentNode&&t.find((function(t){return t.id===e.parentNode}))||e.selected)&&t.push(e),t}),[]),c=n.filter((function(t){return t.selected}));if(u&&(h||c)){var d=Mi(h,n),f=[].concat(or(c),or(d)),g=f.reduce((function(t,e){return t.includes(e.id)||t.push(e.id),t}),[]);if((o||i)&&(o&&r.setState({edges:n.filter((function(t){return!g.includes(t.id)}))}),i&&(h.forEach((function(t){e.delete(t.id)})),r.setState({nodeInternals:new Map(e)}))),g.length>0&&(null==p||p(f),a)){var _=g.map((function(t){return{id:t,type:"remove"}}));a(_)}if(h.length>0&&(null==l||l(h),s)){var v=h.map((function(t){return{id:t.id,type:"remove"}}));s(v)}r.setState({nodesSelectionActive:!1})}}),[u,s,a]),(0,t.useEffect)((function(){r.setState({multiSelectionActive:l})}),[l])}({deleteKeyCode:a,multiSelectionKeyCode:c});var G=o?function(t){return o(t)}:void 0,P=s?function(t){return s(t)}:void 0;return e().createElement(ts,{onMove:u,onMoveStart:l,onMoveEnd:p,selectionKeyPressed:k,elementsSelectable:f,zoomOnScroll:g,zoomOnPinch:_,panOnScroll:v,panOnScrollSpeed:m,panOnScrollMode:y,zoomOnDoubleClick:b,panOnDrag:x,translateExtent:A,minZoom:w,maxZoom:E,defaultZoom:C,defaultPosition:T,zoomActivationKeyCode:d,preventScrolling:O,noWheelClassName:I,noPanClassName:L},i,e().createElement(ss,{selectionKeyPressed:k}),D&&e().createElement(ys,{onSelectionContextMenu:S,noPanClassName:L}),e().createElement("div",{className:"react-flow__pane react-flow__container",onClick:function(t){null==r||r(t),N.getState().resetSelectedElements(),N.setState({nodesSelectionActive:!1})},onContextMenu:G,onWheel:P}))};xs.displayName="FlowRenderer";var As=(0,t.memo)(xs),ws=function(t){return{nodesDraggable:t.nodesDraggable,nodesConnectable:t.nodesConnectable,elementsSelectable:t.elementsSelectable,updateNodeDimensions:t.updateNodeDimensions}},Es=function(n){var i,r=er(ws,rr),o=r.nodesDraggable,s=r.nodesConnectable,a=r.elementsSelectable,u=r.updateNodeDimensions,l=(i=n.onlyRenderVisibleElements,er((0,t.useCallback)((function(t){return i?Ri(t.nodeInternals,{x:0,y:0,width:t.width,height:t.height},t.transform,!0):Array.from(t.nodeInternals.values())}),[i]))),p=(0,t.useRef)(),h=(0,t.useMemo)((function(){if("undefined"==typeof ResizeObserver)return null;var t=new ResizeObserver((function(t){var e=t.map((function(t){return{id:t.target.getAttribute("data-id"),nodeElement:t.target,forceUpdate:!0}}));u(e)}));return p.current=t,t}),[]);return(0,t.useEffect)((function(){return function(){var t;null==p||null===(t=p.current)||void 0===t||t.disconnect()}}),[]),e().createElement("div",{className:"react-flow__nodes react-flow__container"},l.map((function(t){var i,r,u,l,p,c,d,f=t.type||"default";n.nodeTypes[f]||(f="default");var g=n.nodeTypes[f]||n.nodeTypes.default,_=!!(t.draggable||o&&void 0===t.draggable),v=!!(t.selectable||a&&void 0===t.selectable),m=!!(t.connectable||s&&void 0===t.connectable);return e().createElement(g,{key:t.id,id:t.id,className:t.className,style:t.style,type:f,data:t.data,sourcePosition:t.sourcePosition||Zn.Bottom,targetPosition:t.targetPosition||Zn.Top,hidden:t.hidden,xPos:null!==(i=null===(r=t.positionAbsolute)||void 0===r?void 0:r.x)&&void 0!==i?i:0,yPos:null!==(u=null===(l=t.positionAbsolute)||void 0===l?void 0:l.y)&&void 0!==u?u:0,selectNodesOnDrag:n.selectNodesOnDrag,onClick:n.onNodeClick,onMouseEnter:n.onNodeMouseEnter,onMouseMove:n.onNodeMouseMove,onMouseLeave:n.onNodeMouseLeave,onContextMenu:n.onNodeContextMenu,onDoubleClick:n.onNodeDoubleClick,selected:!!t.selected,isDraggable:_,isSelectable:v,isConnectable:m,resizeObserver:h,dragHandle:t.dragHandle,zIndex:null!==(p=null===(c=t[mi])||void 0===c?void 0:c.z)&&void 0!==p?p:0,isParent:!(null===(d=t[mi])||void 0===d||!d.isParent),noDragClassName:n.noDragClassName,noPanClassName:n.noPanClassName,initialized:!!t.width&&!!t.height})})))};Es.displayName="NodeRenderer";var Cs,Ts=(0,t.memo)(Es);function Os(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Ss(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Os(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Os(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Is,Ls=(si(Cs={},Zn.Left,Zn.Right),si(Cs,Zn.Right,Zn.Left),si(Cs,Zn.Top,Zn.Bottom),si(Cs,Zn.Bottom,Zn.Top),Cs),Ns=function(n){var i,r,o,s,a,u=n.connectionNodeId,l=n.connectionHandleType,p=n.connectionLineStyle,h=n.connectionLineType,c=void 0===h?Wn.Bezier:h,d=n.isConnectable,f=n.CustomConnectionLineComponent,g=er((0,t.useCallback)((function(t){return{fromNode:t.nodeInternals.get(u),handleId:t.connectionHandleId,toX:(t.connectionPosition.x-t.transform[0])/t.transform[2],toY:(t.connectionPosition.y-t.transform[1])/t.transform[2]}}),[u]),rr),_=g.fromNode,v=g.handleId,m=g.toX,y=g.toY,b=null==_||null===(i=_[mi])||void 0===i?void 0:i.handleBounds;if(!_||!d||null==b||!b[l])return null;var x=b[l],A=v?x.find((function(t){return t.id===v})):x[0],w=A?A.x+A.width/2:(null!==(r=null==_?void 0:_.width)&&void 0!==r?r:0)/2,E=A?A.y+A.height/2:null!==(o=null==_?void 0:_.height)&&void 0!==o?o:0,C=((null==_||null===(s=_.positionAbsolute)||void 0===s?void 0:s.x)||0)+w,T=((null==_||null===(a=_.positionAbsolute)||void 0===a?void 0:a.y)||0)+E,O=null==A?void 0:A.position;if(!O)return null;var S,I,L,N,D,k,G=Ls[O];switch(l){case"source":S=C,I=T,L=O,N=m,D=y,k=G;break;case"target":S=m,I=y,L=G,N=C,D=T,k=O}if(f)return e().createElement("g",{className:"react-flow__connection"},e().createElement(f,{connectionLineType:c,connectionLineStyle:p,fromNode:_,fromHandle:A,fromX:C,fromY:T,toX:m,toY:y,fromPosition:O,toPosition:G,sourcePosition:L,targetPosition:k,sourceNode:_,sourceHandle:A,targetX:N,targetY:D,sourceX:S,sourceY:I}));var P,B={sourceX:S,sourceY:I,sourcePosition:L,targetX:N,targetY:D,targetPosition:k};return P=c===Wn.Bezier?so(B):c===Wn.Step?Qr(Ss(Ss({},B),{},{borderRadius:0})):c===Wn.SmoothStep?Qr(B):c===Wn.SimpleBezier?Mr(B):"M".concat(S,",").concat(I," ").concat(N,",").concat(D),e().createElement("g",{className:"react-flow__connection"},e().createElement("path",{d:P,className:"react-flow__connection-path",style:p}))};function Ds(t){return Ds="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ds(t)}var ks=(si(Is={},Yn.Arrow,(function(t){var n=t.color,i=void 0===n?"none":n,r=t.strokeWidth,o=void 0===r?1:r;return e().createElement("polyline",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:o,fill:"none",points:"-5,-4 0,0 -5,4"})})),si(Is,Yn.ArrowClosed,(function(t){var n=t.color,i=void 0===n?"none":n,r=t.strokeWidth,o=void 0===r?1:r;return e().createElement("polyline",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:o,fill:i,points:"-5,-4 0,0 -5,4 -5,-4"})})),Is);function Gs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}var Ps=function(n){var i=n.id,r=n.type,o=n.color,s=n.width,a=void 0===s?12.5:s,u=n.height,l=void 0===u?12.5:u,p=n.markerUnits,h=void 0===p?"strokeWidth":p,c=n.strokeWidth,d=n.orient,f=void 0===d?"auto":d,g=function(e){return(0,t.useMemo)((function(){return ks.hasOwnProperty(e)?ks[e]:function(){return null}}),[e])}(r);return e().createElement("marker",{className:"react-flow__arrowhead",id:i,markerWidth:"".concat(a),markerHeight:"".concat(l),viewBox:"-10 -10 20 20",markerUnits:h,orient:f,refX:"0",refY:"0"},e().createElement(g,{color:o,strokeWidth:c}))},Bs=function(n){var i=n.defaultColor,r=n.rfId,o=er((0,t.useCallback)(function(t){var e=t.defaultColor,n=t.rfId;return function(t){var i=[];return t.edges.reduce((function(t,r){return[r.markerStart,r.markerEnd].forEach((function(r){if(r&&"object"===Ds(r)){var o=ki(r,n);i.includes(o)||(t.push(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Gs(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Gs(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({id:o,color:r.color||e},r)),i.push(o))}})),t}),[]).sort((function(t,e){return t.id.localeCompare(e.id)}))}}({defaultColor:i,rfId:r}),[i,r]),(function(t,e){return!(t.length!==e.length||t.some((function(t,n){return t.id!==e[n].id})))}));return e().createElement("defs",null,o.map((function(t){return e().createElement(Ps,{id:t.id,key:t.id,type:t.type,color:t.color,width:t.width,height:t.height,markerUnits:t.markerUnits,strokeWidth:t.strokeWidth,orient:t.orient})})))};Bs.displayName="MarkerDefinitions";var Rs=(0,t.memo)(Bs),Ms=[{level:0,isMaxLevel:!0,edges:[]}];var zs=function(t){return{connectionNodeId:t.connectionNodeId,connectionHandleType:t.connectionHandleType,nodesConnectable:t.nodesConnectable,elementsSelectable:t.elementsSelectable,width:t.width,height:t.height,connectionMode:t.connectionMode,nodeInternals:t.nodeInternals}},Fs=function(n){var i=er(zs,rr),r=i.connectionNodeId,o=i.connectionHandleType,s=i.nodesConnectable,a=i.elementsSelectable,u=i.width,l=i.height,p=i.connectionMode,h=i.nodeInternals,c=function(e,n,i){return function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=-1,r=t.reduce((function(t,r){var o,s,a,u,l=vi(r.zIndex),p=l?r.zIndex:0;return n&&(p=l?r.zIndex:Math.max((null===(o=e.get(r.source))||void 0===o||null===(s=o[mi])||void 0===s?void 0:s.z)||0,(null===(a=e.get(r.target))||void 0===a||null===(u=a[mi])||void 0===u?void 0:u.z)||0)),t[p]?t[p].push(r):t[p]=[r],i=p>i?p:i,t}),{}),o=Object.entries(r).map((function(t){var e=li(t,2),n=+e[0];return{edges:e[1],level:n,isMaxLevel:n===i}}));return 0===o.length?Ms:o}(er((0,t.useCallback)((function(t){return e?t.edges.filter((function(e){var i=n.get(e.source),r=n.get(e.target);return(null==i?void 0:i.width)&&(null==i?void 0:i.height)&&(null==r?void 0:r.width)&&(null==r?void 0:r.height)&&function(t){var e=t.sourcePos,n=t.targetPos,i=t.sourceWidth,r=t.sourceHeight,o=t.targetWidth,s=t.targetHeight,a=t.width,u=t.height,l=t.transform,p={x:Math.min(e.x,n.x),y:Math.min(e.y,n.y),x2:Math.max(e.x+i,n.x+o),y2:Math.max(e.y+r,n.y+s)};p.x===p.x2&&(p.x2+=1),p.y===p.y2&&(p.y2+=1);var h=gi({x:(0-l[0])/l[2],y:(0-l[1])/l[2],width:a/l[2],height:u/l[2]}),c=Math.max(0,Math.min(h.x2,p.x2)-Math.max(h.x,p.x)),d=Math.max(0,Math.min(h.y2,p.y2)-Math.max(h.y,p.y));return Math.ceil(c*d)>0}({sourcePos:i.positionAbsolute||{x:0,y:0},targetPos:r.positionAbsolute||{x:0,y:0},sourceWidth:i.width,sourceHeight:i.height,targetWidth:r.width,targetHeight:r.height,width:t.width,height:t.height,transform:t.transform})})):t.edges}),[e,n])),n,i)}(n.onlyRenderVisibleElements,h,n.elevateEdgesOnSelect);if(!u)return null;var d=n.connectionLineType,f=n.defaultMarkerColor,g=n.connectionLineStyle,_=n.connectionLineComponent,v=n.connectionLineContainerStyle,m=r&&o;return e().createElement(e().Fragment,null,c.map((function(t){var i=t.level,r=t.edges,o=t.isMaxLevel;return e().createElement("svg",{key:i,style:{zIndex:i},width:u,height:l,className:"react-flow__edges react-flow__container"},o&&e().createElement(Rs,{defaultColor:f,rfId:n.rfId}),e().createElement("g",null,r.map((function(t){var i=li(Vo(h,t.source),3),r=i[0],o=i[1],s=i[2],u=li(Vo(h,t.target),3),l=u[0],c=u[1],d=u[2];if(!s||!d)return null;var f=t.type||"default";n.edgeTypes[f]||(console.warn('[React Flow]: Edge type "'.concat(f,'" not found. Using fallback type "default". Help: https://reactflow.dev/error#300')),f="default");var g=n.edgeTypes[f]||n.edgeTypes.default,_=p===zn.Strict?c.target:c.target||c.source,v=Uo(o.source,t.sourceHandle||null),m=Uo(_,t.targetHandle||null),y=(null==v?void 0:v.position)||Zn.Bottom,b=(null==m?void 0:m.position)||Zn.Top;if(!v)return null;if(!m)return null;var x=function(t,e,n,i,r,o){var s=Ho(n,t,e),a=Ho(o,i,r);return{sourceX:s.x,sourceY:s.y,targetX:a.x,targetY:a.y}}(r,v,y,l,m,b),A=x.sourceX,w=x.sourceY,E=x.targetX,C=x.targetY;return e().createElement(g,{key:t.id,id:t.id,className:hr([t.className,n.noPanClassName]),type:f,data:t.data,selected:!!t.selected,animated:!!t.animated,hidden:!!t.hidden,label:t.label,labelStyle:t.labelStyle,labelShowBg:t.labelShowBg,labelBgStyle:t.labelBgStyle,labelBgPadding:t.labelBgPadding,labelBgBorderRadius:t.labelBgBorderRadius,style:t.style,source:t.source,target:t.target,sourceHandleId:t.sourceHandle,targetHandleId:t.targetHandle,markerEnd:t.markerEnd,markerStart:t.markerStart,sourceX:A,sourceY:w,targetX:E,targetY:C,sourcePosition:y,targetPosition:b,elementsSelectable:a,onEdgeUpdate:n.onEdgeUpdate,onContextMenu:n.onEdgeContextMenu,onMouseEnter:n.onEdgeMouseEnter,onMouseMove:n.onEdgeMouseMove,onMouseLeave:n.onEdgeMouseLeave,onClick:n.onEdgeClick,edgeUpdaterRadius:n.edgeUpdaterRadius,onEdgeDoubleClick:n.onEdgeDoubleClick,onEdgeUpdateStart:n.onEdgeUpdateStart,onEdgeUpdateEnd:n.onEdgeUpdateEnd,rfId:n.rfId})}))))})),m&&e().createElement("svg",{style:v,width:u,height:l,className:"react-flow__edges react-flow__connectionline react-flow__container"},e().createElement(Ns,{connectionNodeId:r,connectionHandleType:o,connectionLineStyle:g,connectionLineType:d,isConnectable:s,CustomConnectionLineComponent:_})))};Fs.displayName="EdgeRenderer";var js=(0,t.memo)(Fs),Hs=function(t){return"translate(".concat(t.transform[0],"px,").concat(t.transform[1],"px) scale(").concat(t.transform[2],")")};function Us(t){var n=t.children,i=er(Hs);return e().createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:i}},n)}var Vs=function(n){var i=n.nodeTypes,r=n.edgeTypes,o=n.onMove,s=n.onMoveStart,a=n.onMoveEnd,u=n.onInit,l=n.onNodeClick,p=n.onEdgeClick,h=n.onNodeDoubleClick,c=n.onEdgeDoubleClick,d=n.onNodeMouseEnter,f=n.onNodeMouseMove,g=n.onNodeMouseLeave,_=n.onNodeContextMenu,v=n.onSelectionContextMenu,m=n.connectionLineType,y=n.connectionLineStyle,b=n.connectionLineComponent,x=n.connectionLineContainerStyle,A=n.selectionKeyCode,w=n.multiSelectionKeyCode,E=n.zoomActivationKeyCode,C=n.deleteKeyCode,T=n.onlyRenderVisibleElements,O=n.elementsSelectable,S=n.selectNodesOnDrag,I=n.translateExtent,L=n.minZoom,N=n.maxZoom,D=n.defaultZoom,k=n.defaultPosition,G=n.preventScrolling,P=n.defaultMarkerColor,B=n.zoomOnScroll,R=n.zoomOnPinch,M=n.panOnScroll,z=n.panOnScrollSpeed,F=n.panOnScrollMode,j=n.zoomOnDoubleClick,H=n.panOnDrag,U=n.onPaneClick,V=n.onPaneScroll,W=n.onPaneContextMenu,X=n.onEdgeUpdate,Y=n.onEdgeContextMenu,q=n.onEdgeMouseEnter,Z=n.onEdgeMouseMove,K=n.onEdgeMouseLeave,$=n.edgeUpdaterRadius,Q=n.onEdgeUpdateStart,J=n.onEdgeUpdateEnd,tt=n.noDragClassName,et=n.noWheelClassName,nt=n.noPanClassName,it=n.elevateEdgesOnSelect,rt=n.id;return function(e){var n=pr(),i=(0,t.useRef)(!1);(0,t.useEffect)((function(){!i.current&&n.viewportInitialized&&e&&(setTimeout((function(){return e(n)}),1),i.current=!0)}),[e,n.viewportInitialized])}(u),e().createElement(As,{onPaneClick:U,onPaneContextMenu:W,onPaneScroll:V,deleteKeyCode:C,selectionKeyCode:A,multiSelectionKeyCode:w,zoomActivationKeyCode:E,elementsSelectable:O,onMove:o,onMoveStart:s,onMoveEnd:a,zoomOnScroll:B,zoomOnPinch:R,zoomOnDoubleClick:j,panOnScroll:M,panOnScrollSpeed:z,panOnScrollMode:F,panOnDrag:H,translateExtent:I,minZoom:L,maxZoom:N,defaultZoom:D,defaultPosition:k,onSelectionContextMenu:v,preventScrolling:G,noDragClassName:tt,noWheelClassName:et,noPanClassName:nt},e().createElement(Us,null,e().createElement(js,{edgeTypes:r,onEdgeClick:p,onEdgeDoubleClick:c,connectionLineType:m,connectionLineStyle:y,connectionLineComponent:b,connectionLineContainerStyle:x,onEdgeUpdate:X,onlyRenderVisibleElements:T,onEdgeContextMenu:Y,onEdgeMouseEnter:q,onEdgeMouseMove:Z,onEdgeMouseLeave:K,onEdgeUpdateStart:Q,onEdgeUpdateEnd:J,edgeUpdaterRadius:$,defaultMarkerColor:P,noPanClassName:nt,elevateEdgesOnSelect:!!it,rfId:rt}),e().createElement(Ts,{nodeTypes:i,onNodeClick:l,onNodeDoubleClick:h,onNodeMouseEnter:d,onNodeMouseMove:f,onNodeMouseLeave:g,onNodeContextMenu:_,selectNodesOnDrag:S,onlyRenderVisibleElements:T,noPanClassName:nt,noDragClassName:tt})))};Vs.displayName="GraphView";var Ws=(0,t.memo)(Vs),Xs=function(){return null};function Ys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function qs(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ys(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ys(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}Xs.displayName="GroupNode";var Zs=function(n){var i=function(i){var r=i.id,o=i.type,s=i.data,a=i.xPos,u=i.yPos,l=i.selected,p=i.onClick,h=i.onMouseEnter,c=i.onMouseMove,d=i.onMouseLeave,f=i.onContextMenu,g=i.onDoubleClick,_=i.style,v=i.className,m=i.isDraggable,y=i.isSelectable,b=i.isConnectable,x=i.selectNodesOnDrag,A=i.sourcePosition,w=i.targetPosition,E=i.hidden,C=i.resizeObserver,T=i.dragHandle,O=i.zIndex,S=i.isParent,I=i.noPanClassName,L=i.noDragClassName,N=i.initialized,D=nr(),k=(0,t.useRef)(null),G=(0,t.useRef)(A),P=(0,t.useRef)(w),B=(0,t.useRef)(o),R=y||m||p||h||c||d,M=Ii(r,D.getState,h),z=Ii(r,D.getState,c),F=Ii(r,D.getState,d),j=Ii(r,D.getState,f),H=Ii(r,D.getState,g);(0,t.useEffect)((function(){if(k.current&&!E){var t=k.current;return null==C||C.observe(t),function(){return null==C?void 0:C.unobserve(t)}}}),[E]),(0,t.useEffect)((function(){var t=B.current!==o,e=G.current!==A,n=P.current!==w;k.current&&(t||e||n)&&(t&&(B.current=o),e&&(G.current=A),n&&(P.current=w),D.getState().updateNodeDimensions([{id:r,nodeElement:k.current,forceUpdate:!0}]))}),[r,o,A,w]);var U=fs({nodeRef:k,disabled:E||!m,noDragClassName:L,handleSelector:T,nodeId:r,isSelectable:y,selectNodesOnDrag:x});return E?null:e().createElement("div",{className:hr(["react-flow__node","react-flow__node-".concat(o),I,v,{selected:l,selectable:y,parent:S}]),ref:k,style:qs({zIndex:O,transform:"translate(".concat(a,"px,").concat(u,"px)"),pointerEvents:R?"all":"none",visibility:N?"visible":"hidden"},_),onMouseEnter:M,onMouseMove:z,onMouseLeave:F,onContextMenu:j,onClick:function(t){if(!y||x&&m||Li({id:r,store:D}),p){var e=D.getState().nodeInternals.get(r);p(t,qs({},e))}},onDoubleClick:H,"data-testid":"rf__node-".concat(r),"data-id":r},e().createElement(lo,{value:r},e().createElement(n,{id:r,data:s,type:o,xPos:a,yPos:u,selected:l,isConnectable:b,sourcePosition:A,targetPosition:w,dragging:U,dragHandle:T,zIndex:O})))};return i.displayName="NodeWrapper",(0,t.memo)(i)};function Ks(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function $s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ks(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ks(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Qs(t){var e={input:Zs(t.input||Eo),default:Zs(t.default||Ao),output:Zs(t.output||To),group:Zs(t.group||Xs)},n=Object.keys(t).filter((function(t){return!["input","default","output","group"].includes(t)})).reduce((function(e,n){return e[n]=Zs(t[n]||Ao),e}),{});return $s($s({},e),n)}function Js(e,n){return(0,t.useRef)(null),(0,t.useMemo)((function(){return n(e)}),[e])}function ta(t){if(t&&"undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");e.appendChild(n),n.appendChild(document.createTextNode(t))}}var ea=function(t){var n=t.children,i=!0;try{nr()}catch(t){i=!1}return i?e().createElement(e().Fragment,null,n):e().createElement(tr,{createStore:ir},n)};ea.displayName="ReactFlowWrapper";var na=["nodes","edges","defaultNodes","defaultEdges","className","nodeTypes","edgeTypes","onNodeClick","onEdgeClick","onInit","onMove","onMoveStart","onMoveEnd","onConnect","onConnectStart","onConnectStop","onConnectEnd","onClickConnectStart","onClickConnectStop","onClickConnectEnd","onNodeMouseEnter","onNodeMouseMove","onNodeMouseLeave","onNodeContextMenu","onNodeDoubleClick","onNodeDragStart","onNodeDrag","onNodeDragStop","onNodesDelete","onEdgesDelete","onSelectionChange","onSelectionDragStart","onSelectionDrag","onSelectionDragStop","onSelectionContextMenu","connectionMode","connectionLineType","connectionLineStyle","connectionLineComponent","connectionLineContainerStyle","deleteKeyCode","selectionKeyCode","multiSelectionKeyCode","zoomActivationKeyCode","snapToGrid","snapGrid","onlyRenderVisibleElements","selectNodesOnDrag","nodesDraggable","nodesConnectable","elementsSelectable","minZoom","maxZoom","defaultZoom","defaultPosition","translateExtent","preventScrolling","nodeExtent","defaultMarkerColor","zoomOnScroll","zoomOnPinch","panOnScroll","panOnScrollSpeed","panOnScrollMode","zoomOnDoubleClick","panOnDrag","onPaneClick","onPaneScroll","onPaneContextMenu","children","onEdgeUpdate","onEdgeContextMenu","onEdgeDoubleClick","onEdgeMouseEnter","onEdgeMouseMove","onEdgeMouseLeave","onEdgeUpdateStart","onEdgeUpdateEnd","edgeUpdaterRadius","onNodesChange","onEdgesChange","noDragClassName","noWheelClassName","noPanClassName","fitView","fitViewOptions","connectOnClick","attributionPosition","proOptions","defaultEdgeOptions","elevateEdgesOnSelect"];function ia(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function ra(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ia(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ia(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}ta(".react-flow{height:100%;overflow:hidden;position:relative;width:100%}.react-flow__container{height:100%;left:0;position:absolute;top:0;width:100%}.react-flow__pane{z-index:1}.react-flow__viewport{pointer-events:none;transform-origin:0 0;z-index:2}.react-flow__renderer{z-index:4}.react-flow__selectionpane{z-index:5}.react-flow .react-flow__edges{overflow:visible;pointer-events:none}.react-flow .react-flow__connectionline{z-index:1001}.react-flow__edge{pointer-events:visibleStroke}.react-flow__edge.inactive{pointer-events:none}@-webkit-keyframes dashdraw{0%{stroke-dashoffset:10}}@keyframes dashdraw{0%{stroke-dashoffset:10}}.react-flow__edge-path{fill:none}.react-flow__edge-textwrapper{pointer-events:all}.react-flow__edge-text{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.react-flow__connection{pointer-events:none}.react-flow__connection .animated{stroke-dasharray:5;-webkit-animation:dashdraw .5s linear infinite;animation:dashdraw .5s linear infinite}.react-flow__connection-path{fill:none}.react-flow__nodes{pointer-events:none;transform-origin:0 0}.react-flow__node{box-sizing:border-box;pointer-events:all;position:absolute;transform-origin:0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.react-flow__nodesselection{pointer-events:none;transform-origin:left top;z-index:3}.react-flow__nodesselection-rect{cursor:-webkit-grab;cursor:grab;pointer-events:all;position:absolute}.react-flow__handle{pointer-events:none;position:absolute}.react-flow__handle.connectable{pointer-events:all}.react-flow__handle-bottom{bottom:-4px;left:50%;top:auto;transform:translate(-50%)}.react-flow__handle-top{left:50%;top:-4px;transform:translate(-50%)}.react-flow__handle-left{left:-4px;top:50%;transform:translateY(-50%)}.react-flow__handle-right{right:-4px;top:50%;transform:translateY(-50%)}.react-flow__edgeupdater{cursor:move;pointer-events:all}.react-flow__controls{bottom:20px;left:15px;position:absolute;z-index:5}.react-flow__controls-button{border:none;height:24px;width:24px}.react-flow__controls-button svg{width:100%}.react-flow__minimap{bottom:20px;position:absolute;right:15px;z-index:5}.react-flow__attribution{background:hsla(0,0%,100%,.5);color:#999;font-size:10px;padding:2px 3px;position:absolute;z-index:1000}.react-flow__attribution a{color:#555;text-decoration:none}.react-flow__attribution.top{top:0}.react-flow__attribution.bottom{bottom:0}.react-flow__attribution.left{left:0}.react-flow__attribution.right{right:0}.react-flow__attribution.center{left:50%;transform:translateX(-50%)}"),ta(".react-flow__edge.selected .react-flow__edge-path{stroke:#555}.react-flow__edge.animated path{stroke-dasharray:5;-webkit-animation:dashdraw .5s linear infinite;animation:dashdraw .5s linear infinite}.react-flow__edge.updating .react-flow__edge-path{stroke:#777}.react-flow__edge-path{stroke:#b1b1b7;stroke-width:1}.react-flow__edge-text{font-size:10px}.react-flow__edge-textbg{fill:#fff}.react-flow__connection-path{stroke:#b1b1b7;stroke-width:1}.react-flow__node{cursor:-webkit-grab;cursor:grab}.react-flow__node-default,.react-flow__node-group,.react-flow__node-input,.react-flow__node-output{background:#fff;border:1px solid #1a192b;border-radius:3px;color:#222;font-size:12px;padding:10px;text-align:center;width:150px}.react-flow__node-default.selected,.react-flow__node-group.selected,.react-flow__node-input.selected,.react-flow__node-output.selected{box-shadow:0 0 0 .5px #1a192b}.react-flow__node-default .react-flow__handle,.react-flow__node-group .react-flow__handle,.react-flow__node-input .react-flow__handle,.react-flow__node-output .react-flow__handle{background:#1a192b}.react-flow__node-default.selectable:hover,.react-flow__node-group.selectable:hover,.react-flow__node-input.selectable:hover,.react-flow__node-output.selectable:hover{box-shadow:0 1px 4px 1px rgba(0,0,0,.08)}.react-flow__node-default.selectable.selected,.react-flow__node-group.selectable.selected,.react-flow__node-input.selectable.selected,.react-flow__node-output.selectable.selected{box-shadow:0 0 0 .5px #1a192b}.react-flow__node-group{background:hsla(0,0%,94%,.25);border-color:#1a192b}.react-flow__nodesselection-rect,.react-flow__selection{background:rgba(0,89,220,.08);border:1px dotted rgba(0,89,220,.8)}.react-flow__handle{background:#555;border:1px solid #fff;border-radius:100%;height:6px;width:6px}.react-flow__handle.connectable{cursor:crosshair}.react-flow__minimap{background-color:#fff}.react-flow__controls{box-shadow:0 0 2px 1px rgba(0,0,0,.08)}.react-flow__controls-button{align-items:center;background:#fefefe;border-bottom:1px solid #eee;box-sizing:content-box;cursor:pointer;display:flex;height:16px;justify-content:center;padding:5px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:16px}.react-flow__controls-button svg{max-height:12px;max-width:12px}.react-flow__controls-button:hover{background:#f4f4f4}");var oa={input:Eo,default:Ao,output:To},sa={default:ao,straight:io,step:no,smoothstep:Jr,simplebezier:zr},aa=[15,15],ua=[0,0],la=(0,t.forwardRef)((function(t,n){var i=t.nodes,r=t.edges,o=t.defaultNodes,s=t.defaultEdges,a=t.className,u=t.nodeTypes,l=void 0===u?oa:u,p=t.edgeTypes,h=void 0===p?sa:p,c=t.onNodeClick,d=t.onEdgeClick,f=t.onInit,g=t.onMove,_=t.onMoveStart,v=t.onMoveEnd,m=t.onConnect,y=t.onConnectStart,b=t.onConnectStop,x=t.onConnectEnd,A=t.onClickConnectStart,w=t.onClickConnectStop,E=t.onClickConnectEnd,C=t.onNodeMouseEnter,T=t.onNodeMouseMove,O=t.onNodeMouseLeave,S=t.onNodeContextMenu,I=t.onNodeDoubleClick,L=t.onNodeDragStart,N=t.onNodeDrag,D=t.onNodeDragStop,k=t.onNodesDelete,G=t.onEdgesDelete,P=t.onSelectionChange,B=t.onSelectionDragStart,R=t.onSelectionDrag,M=t.onSelectionDragStop,z=t.onSelectionContextMenu,F=t.connectionMode,j=void 0===F?zn.Strict:F,H=t.connectionLineType,U=void 0===H?Wn.Bezier:H,V=t.connectionLineStyle,W=t.connectionLineComponent,X=t.connectionLineContainerStyle,Y=t.deleteKeyCode,q=void 0===Y?"Backspace":Y,Z=t.selectionKeyCode,K=void 0===Z?"Shift":Z,$=t.multiSelectionKeyCode,Q=void 0===$?"Meta":$,J=t.zoomActivationKeyCode,tt=void 0===J?"Meta":J,et=t.snapToGrid,nt=void 0!==et&&et,it=t.snapGrid,rt=void 0===it?aa:it,ot=t.onlyRenderVisibleElements,st=void 0!==ot&&ot,at=t.selectNodesOnDrag,ut=void 0===at||at,lt=t.nodesDraggable,pt=t.nodesConnectable,ht=t.elementsSelectable,ct=t.minZoom,dt=void 0===ct?.5:ct,ft=t.maxZoom,gt=void 0===ft?2:ft,_t=t.defaultZoom,vt=void 0===_t?1:_t,mt=t.defaultPosition,yt=void 0===mt?ua:mt,bt=t.translateExtent,xt=void 0===bt?Zi:bt,At=t.preventScrolling,wt=void 0===At||At,Et=t.nodeExtent,Ct=t.defaultMarkerColor,Tt=void 0===Ct?"#b1b1b7":Ct,Ot=t.zoomOnScroll,St=void 0===Ot||Ot,It=t.zoomOnPinch,Lt=void 0===It||It,Nt=t.panOnScroll,Dt=void 0!==Nt&&Nt,kt=t.panOnScrollSpeed,Gt=void 0===kt?.5:kt,Pt=t.panOnScrollMode,Bt=void 0===Pt?Un.Free:Pt,Rt=t.zoomOnDoubleClick,Mt=void 0===Rt||Rt,zt=t.panOnDrag,Ft=void 0===zt||zt,jt=t.onPaneClick,Ht=t.onPaneScroll,Ut=t.onPaneContextMenu,Vt=t.children,Wt=t.onEdgeUpdate,Xt=t.onEdgeContextMenu,Yt=t.onEdgeDoubleClick,qt=t.onEdgeMouseEnter,Zt=t.onEdgeMouseMove,Kt=t.onEdgeMouseLeave,$t=t.onEdgeUpdateStart,Qt=t.onEdgeUpdateEnd,Jt=t.edgeUpdaterRadius,te=void 0===Jt?10:Jt,ee=t.onNodesChange,ne=t.onEdgesChange,ie=t.noDragClassName,re=void 0===ie?"nodrag":ie,oe=t.noWheelClassName,se=void 0===oe?"nowheel":oe,ae=t.noPanClassName,ue=void 0===ae?"nopan":ae,le=t.fitView,pe=void 0!==le&&le,he=t.fitViewOptions,ce=t.connectOnClick,de=void 0===ce||ce,fe=t.attributionPosition,ge=t.proOptions,_e=t.defaultEdgeOptions,ve=t.elevateEdgesOnSelect,me=void 0!==ve&&ve,ye=cr(t,na),be=Js(l,Qs),xe=Js(h,jo);return e().createElement("div",ra(ra({},ye),{},{ref:n,className:hr(["react-flow",a])}),e().createElement(ea,null,e().createElement(Ws,{onInit:f,onMove:g,onMoveStart:_,onMoveEnd:v,onNodeClick:c,onEdgeClick:d,onNodeMouseEnter:C,onNodeMouseMove:T,onNodeMouseLeave:O,onNodeContextMenu:S,onNodeDoubleClick:I,nodeTypes:be,edgeTypes:xe,connectionLineType:U,connectionLineStyle:V,connectionLineComponent:W,connectionLineContainerStyle:X,selectionKeyCode:K,deleteKeyCode:q,multiSelectionKeyCode:Q,zoomActivationKeyCode:tt,onlyRenderVisibleElements:st,selectNodesOnDrag:ut,translateExtent:xt,minZoom:dt,maxZoom:gt,defaultZoom:vt,defaultPosition:yt,preventScrolling:wt,zoomOnScroll:St,zoomOnPinch:Lt,zoomOnDoubleClick:Mt,panOnScroll:Dt,panOnScrollSpeed:Gt,panOnScrollMode:Bt,panOnDrag:Ft,onPaneClick:jt,onPaneScroll:Ht,onPaneContextMenu:Ut,onSelectionContextMenu:z,onEdgeUpdate:Wt,onEdgeContextMenu:Xt,onEdgeDoubleClick:Yt,onEdgeMouseEnter:qt,onEdgeMouseMove:Zt,onEdgeMouseLeave:Kt,onEdgeUpdateStart:$t,onEdgeUpdateEnd:Qt,edgeUpdaterRadius:te,defaultMarkerColor:Tt,noDragClassName:re,noWheelClassName:se,noPanClassName:ue,elevateEdgesOnSelect:me,id:null==ye?void 0:ye.id}),e().createElement(Go,{nodes:i,edges:r,defaultNodes:o,defaultEdges:s,onConnect:m,onConnectStart:y,onConnectStop:b,onConnectEnd:x,onClickConnectStart:A,onClickConnectStop:w,onClickConnectEnd:E,nodesDraggable:lt,nodesConnectable:pt,elementsSelectable:ht,minZoom:dt,maxZoom:gt,nodeExtent:Et,onNodesChange:ee,onEdgesChange:ne,snapToGrid:nt,snapGrid:rt,connectionMode:j,translateExtent:xt,connectOnClick:de,defaultEdgeOptions:_e,fitView:pe,fitViewOptions:he,onNodesDelete:k,onEdgesDelete:G,onNodeDragStart:L,onNodeDrag:N,onNodeDragStop:D,onSelectionDrag:R,onSelectionDragStart:B,onSelectionDragStop:M}),P&&e().createElement(Lo,{onSelectionChange:P}),Vt,e().createElement(Nr,{proOptions:ge,position:fe})))}));la.displayName="ReactFlow";var pa=function(t){var n=t.children;return e().createElement(tr,{createStore:ir},n)};function ha(e){return function(n){var i=li((0,t.useState)(n),2),r=i[0],o=i[1],s=(0,t.useCallback)((function(t){return o((function(n){return e(t,n)}))}),[]);return[r,o,s]}}pa.displayName="ReactFlowProvider",ha(wi),ha((function(t,e){return Ai(t,e)}));var ca=function(t){var n=t.x,i=t.y,r=t.width,o=t.height,s=t.style,a=t.color,u=t.strokeColor,l=t.strokeWidth,p=t.className,h=t.borderRadius,c=t.shapeRendering,d=s||{},f=d.background,g=d.backgroundColor,_=a||f||g;return e().createElement("rect",{className:hr(["react-flow__minimap-node",p]),x:n,y:i,rx:h,ry:h,width:r,height:o,fill:_,stroke:u,strokeWidth:l,shapeRendering:c})};ca.displayName="MiniMapNode";var da=(0,t.memo)(ca),fa=function(t){return{viewBBox:{x:-t.transform[0]/t.transform[2],y:-t.transform[1]/t.transform[2],width:t.width/t.transform[2],height:t.height/t.transform[2]},nodes:Array.from(t.nodeInternals.values())}},ga=function(t){return t instanceof Function?t:function(){return t}},_a=function(t){var n,i,r,o,s=t.style,a=t.className,u=t.nodeStrokeColor,l=void 0===u?"#555":u,p=t.nodeColor,h=void 0===p?"#fff":p,c=t.nodeClassName,d=void 0===c?"":c,f=t.nodeBorderRadius,g=void 0===f?5:f,_=t.nodeStrokeWidth,v=void 0===_?2:_,m=t.maskColor,y=void 0===m?"rgb(240, 242, 243, 0.7)":m,b=er(fa,rr),x=b.viewBBox,A=b.nodes,w=null!==(n=null==s?void 0:s.width)&&void 0!==n?n:200,E=null!==(i=null==s?void 0:s.height)&&void 0!==i?i:150,C=ga(h),T=ga(l),O=ga(d),S=A.length>0?(r=Bi(A),o=x,_i(fi(gi(r),gi(o)))):x,I=S.width/w,L=S.height/E,N=Math.max(I,L),D=N*w,k=N*E,G=5*N,P=S.x-(D-S.width)/2-G,B=S.y-(k-S.height)/2-G,R=D+2*G,M=k+2*G,z="undefined"==typeof window||window.chrome?"crispEdges":"geometricPrecision";return e().createElement("svg",{width:w,height:E,viewBox:"".concat(P," ").concat(B," ").concat(R," ").concat(M),style:s,className:hr(["react-flow__minimap",a])},A.filter((function(t){return!t.hidden&&t.width&&t.height})).map((function(t){var n,i,r,o;return e().createElement(da,{key:t.id,x:null!==(n=null===(i=t.positionAbsolute)||void 0===i?void 0:i.x)&&void 0!==n?n:0,y:null!==(r=null===(o=t.positionAbsolute)||void 0===o?void 0:o.y)&&void 0!==r?r:0,width:t.width,height:t.height,style:t.style,className:O(t),color:C(t),borderRadius:g,strokeColor:T(t),strokeWidth:v,shapeRendering:z})})),e().createElement("path",{className:"react-flow__minimap-mask",d:"M".concat(P-G,",").concat(B-G,"h").concat(R+2*G,"v").concat(M+2*G,"h").concat(-R-2*G,"z\n        M").concat(x.x,",").concat(x.y,"h").concat(x.width,"v").concat(x.height,"h").concat(-x.width,"z"),fill:y,fillRule:"evenodd"}))};_a.displayName="MiniMap";var va,ma=(0,t.memo)(_a);function ya(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function ba(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ya(Object(n),!0).forEach((function(e){si(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ya(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var xa=(si(va={},jn.Dots,"#81818a"),si(va,jn.Lines,"#eee"),va),Aa=function(t){return t.transform},wa=function(n){var i=n.variant,r=void 0===i?jn.Dots:i,o=n.gap,s=void 0===o?15:o,a=n.size,u=void 0===a?.4:a,l=n.color,p=n.style,h=n.className,c=(0,t.useRef)(null),d=li((0,t.useState)(null),2),f=d[0],g=d[1],_=li(er(Aa),3),v=_[0],m=_[1],y=_[2];(0,t.useEffect)((function(){var t=document.querySelectorAll(".react-flow__background"),e=Array.from(t).findIndex((function(t){return t===c.current}));g("pattern-".concat(e))}),[]);var b=s*y||1,x=v%b,A=m%b,w=r===jn.Lines,E=l||xa[r],C=w?function(t,n,i){return e().createElement("path",{stroke:i,strokeWidth:n,d:"M".concat(t/2," 0 V").concat(t," M0 ").concat(t/2," H").concat(t)})}(b,u,E):function(t,n){return e().createElement("circle",{cx:t,cy:t,r:t,fill:n})}(u*y,E);return e().createElement("svg",{className:hr(["react-flow__background","react-flow__container",h]),style:ba(ba({},p),{},{width:"100%",height:"100%"}),ref:c},f&&e().createElement(e().Fragment,null,e().createElement("pattern",{id:f,x,y:A,width:b,height:b,patternUnits:"userSpaceOnUse"},C),e().createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#".concat(f,")")})))};wa.displayName="Background";var Ea=(0,t.memo)(wa);const Ca=(()=>{let t=0;return()=>(t+=1,`u${`0000${(Math.random()*36**4|0).toString(36)}`.slice(-4)}${t}`)})();function Ta(t){const e=[];for(let n=0,i=t.length;n<i;n++)e.push(t[n]);return e}function Oa(t,e){const n=(t.ownerDocument.defaultView||window).getComputedStyle(t).getPropertyValue(e);return n?parseFloat(n.replace("px","")):0}function Sa(t,e={}){return{width:e.width||function(t){const e=Oa(t,"border-left-width"),n=Oa(t,"border-right-width");return t.clientWidth+e+n}(t),height:e.height||function(t){const e=Oa(t,"border-top-width"),n=Oa(t,"border-bottom-width");return t.clientHeight+e+n}(t)}}const Ia=16384;function La(t){return new Promise(((e,n)=>{const i=new Image;i.decode=()=>e(i),i.onload=()=>e(i),i.onerror=n,i.crossOrigin="anonymous",i.decoding="async",i.src=t}))}const Na=(t,e)=>{if(t instanceof e)return!0;const n=Object.getPrototypeOf(t);return null!==n&&(n.constructor.name===e.name||Na(n,e))};function Da(t,e,n){const i=window.getComputedStyle(t,n),r=i.getPropertyValue("content");if(""===r||"none"===r)return;const o=Ca();try{e.className=`${e.className} ${o}`}catch(t){return}const s=document.createElement("style");s.appendChild(function(t,e,n){const i=`.${t}:${e}`,r=n.cssText?function(t){const e=t.getPropertyValue("content");return`${t.cssText} content: '${e.replace(/'|"/g,"")}';`}(n):function(t){return Ta(t).map((e=>`${e}: ${t.getPropertyValue(e)}${t.getPropertyPriority(e)?" !important":""};`)).join(" ")}(n);return document.createTextNode(`${i}{${r}}`)}(o,n,i)),e.appendChild(s)}const ka="application/font-woff",Ga="image/jpeg",Pa={woff:ka,woff2:ka,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Ga,jpeg:Ga,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function Ba(t){const e=function(t){const e=/\.([^./]*?)$/g.exec(t);return e?e[1]:""}(t).toLowerCase();return Pa[e]||""}function Ra(t){return-1!==t.search(/^(data:)/)}function Ma(t,e){return`data:${e};base64,${t}`}async function za(t,e,n){const i=await fetch(t,e);if(404===i.status)throw new Error(`Resource "${i.url}" not found`);const r=await i.blob();return new Promise(((t,e)=>{const o=new FileReader;o.onerror=e,o.onloadend=()=>{try{t(n({res:i,result:o.result}))}catch(t){e(t)}},o.readAsDataURL(r)}))}const Fa={};async function ja(t,e,n){const i=function(t,e,n){let i=t.replace(/\?.*/,"");return n&&(i=t),/ttf|otf|eot|woff2?/i.test(i)&&(i=i.replace(/.*\//,"")),e?`[${e}]${i}`:i}(t,e,n.includeQueryParams);if(null!=Fa[i])return Fa[i];let r;n.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());try{const i=await za(t,n.fetchRequestInit,(({res:t,result:n})=>(e||(e=t.headers.get("Content-Type")||""),function(t){return t.split(/,/)[1]}(n))));r=Ma(i,e)}catch(e){r=n.imagePlaceholder||"";let i=`Failed to fetch resource: ${t}`;e&&(i="string"==typeof e?e:e.message),i&&console.warn(i)}return Fa[i]=r,r}const Ha=t=>null!=t.tagName&&"SLOT"===t.tagName.toUpperCase();async function Ua(t,e,n){return n||!e.filter||e.filter(t)?Promise.resolve(t).then((t=>async function(t,e){return Na(t,HTMLCanvasElement)?async function(t){const e=t.toDataURL();return"data:,"===e?t.cloneNode(!1):La(e)}(t):Na(t,HTMLVideoElement)?async function(t,e){if(t.currentSrc){const e=document.createElement("canvas"),n=e.getContext("2d");return e.width=t.clientWidth,e.height=t.clientHeight,null==n||n.drawImage(t,0,0,e.width,e.height),La(e.toDataURL())}const n=t.poster,i=Ba(n);return La(await ja(n,i,e))}(t,e):Na(t,HTMLIFrameElement)?async function(t){var e;try{if(null===(e=null==t?void 0:t.contentDocument)||void 0===e?void 0:e.body)return await Ua(t.contentDocument.body,{},!0)}catch(t){}return t.cloneNode(!1)}(t):t.cloneNode(!1)}(t,e))).then((n=>async function(t,e,n){var i,r;let o=[];return o=Ha(t)&&t.assignedNodes?Ta(t.assignedNodes()):Na(t,HTMLIFrameElement)&&(null===(i=t.contentDocument)||void 0===i?void 0:i.body)?Ta(t.contentDocument.body.childNodes):Ta((null!==(r=t.shadowRoot)&&void 0!==r?r:t).childNodes),0===o.length||Na(t,HTMLVideoElement)||await o.reduce(((t,i)=>t.then((()=>Ua(i,n))).then((t=>{t&&e.appendChild(t)}))),Promise.resolve()),e}(t,n,e))).then((e=>function(t,e){return Na(e,Element)&&(function(t,e){const n=e.style;if(!n)return;const i=window.getComputedStyle(t);i.cssText?(n.cssText=i.cssText,n.transformOrigin=i.transformOrigin):Ta(i).forEach((r=>{let o=i.getPropertyValue(r);if("font-size"===r&&o.endsWith("px")){const t=Math.floor(parseFloat(o.substring(0,o.length-2)))-.1;o=`${t}px`}Na(t,HTMLIFrameElement)&&"display"===r&&"inline"===o&&(o="block"),"d"===r&&e.getAttribute("d")&&(o=`path(${e.getAttribute("d")})`),n.setProperty(r,o,i.getPropertyPriority(r))}))}(t,e),function(t,e){Da(t,e,":before"),Da(t,e,":after")}(t,e),function(t,e){Na(t,HTMLTextAreaElement)&&(e.innerHTML=t.value),Na(t,HTMLInputElement)&&e.setAttribute("value",t.value)}(t,e),function(t,e){if(Na(t,HTMLSelectElement)){const n=e,i=Array.from(n.children).find((e=>t.value===e.getAttribute("value")));i&&i.setAttribute("selected","")}}(t,e)),e}(t,e))).then((t=>async function(t,e){const n=t.querySelectorAll?t.querySelectorAll("use"):[];if(0===n.length)return t;const i={};for(let r=0;r<n.length;r++){const o=n[r].getAttribute("xlink:href");if(o){const n=t.querySelector(o),r=document.querySelector(o);n||!r||i[o]||(i[o]=await Ua(r,e,!0))}}const r=Object.values(i);if(r.length){const e="http://www.w3.org/1999/xhtml",n=document.createElementNS(e,"svg");n.setAttribute("xmlns",e),n.style.position="absolute",n.style.width="0",n.style.height="0",n.style.overflow="hidden",n.style.display="none";const i=document.createElementNS(e,"defs");n.appendChild(i);for(let t=0;t<r.length;t++)i.appendChild(r[t]);t.appendChild(n)}return t}(t,e))):null}const Va=/url\((['"]?)([^'"]+?)\1\)/g,Wa=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Xa=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Ya(t){return-1!==t.search(Va)}async function qa(t,e,n){if(!Ya(t))return t;const i=function(t,{preferredFontFormat:e}){return e?t.replace(Xa,(t=>{for(;;){const[n,,i]=Wa.exec(t)||[];if(!i)return"";if(i===e)return`src: ${n};`}})):t}(t,n),r=function(t){const e=[];return t.replace(Va,((t,n,i)=>(e.push(i),t))),e.filter((t=>!Ra(t)))}(i);return r.reduce(((t,i)=>t.then((t=>async function(t,e,n,i,r){try{const o=n?function(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;const n=document.implementation.createHTMLDocument(),i=n.createElement("base"),r=n.createElement("a");return n.head.appendChild(i),n.body.appendChild(r),e&&(i.href=e),r.href=t,r.href}(e,n):e,s=Ba(e);let a;return a=r?Ma(await r(o),s):await ja(o,s,i),t.replace(function(t){const e=t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}(e),`$1${a}$3`)}catch(t){}return t}(t,i,e,n)))),Promise.resolve(i))}async function Za(t,e,n){var i;const r=null===(i=e.style)||void 0===i?void 0:i.getPropertyValue(t);if(r){const i=await qa(r,null,n);return e.style.setProperty(t,i,e.style.getPropertyPriority(t)),!0}return!1}async function Ka(t,e){Na(t,Element)&&(await async function(t,e){await Za("background",t,e)||await Za("background-image",t,e),await Za("mask",t,e)||await Za("mask-image",t,e)}(t,e),await async function(t,e){const n=Na(t,HTMLImageElement);if((!n||Ra(t.src))&&(!Na(t,SVGImageElement)||Ra(t.href.baseVal)))return;const i=n?t.src:t.href.baseVal,r=await ja(i,Ba(i),e);await new Promise(((e,i)=>{t.onload=e,t.onerror=i;const o=t;o.decode&&(o.decode=e),"lazy"===o.loading&&(o.loading="eager"),n?(t.srcset="",t.src=r):t.href.baseVal=r}))}(t,e),await async function(t,e){const n=Ta(t.childNodes).map((t=>Ka(t,e)));await Promise.all(n).then((()=>t))}(t,e))}const $a={};async function Qa(t){let e=$a[t];if(null!=e)return e;const n=await fetch(t);return e={url:t,cssText:await n.text()},$a[t]=e,e}async function Ja(t,e){let n=t.cssText;const i=/url\(["']?([^"')]+)["']?\)/g,r=(n.match(/url\([^)]+\)/g)||[]).map((async r=>{let o=r.replace(i,"$1");return o.startsWith("https://")||(o=new URL(o,t.url).href),za(o,e.fetchRequestInit,(({result:t})=>(n=n.replace(r,`url(${t})`),[r,t])))}));return Promise.all(r).then((()=>n))}function tu(t){if(null==t)return[];const e=[];let n=t.replace(/(\/\*[\s\S]*?\*\/)/gi,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const t=i.exec(n);if(null===t)break;e.push(t[0])}n=n.replace(i,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let t=r.exec(n);if(null===t){if(t=o.exec(n),null===t)break;r.lastIndex=o.lastIndex}else o.lastIndex=r.lastIndex;e.push(t[0])}return e}async function eu(t,e){const n=null!=e.fontEmbedCSS?e.fontEmbedCSS:e.skipFonts?null:await async function(t,e){const n=await async function(t,e){if(null==t.ownerDocument)throw new Error("Provided element is not within a Document");const n=Ta(t.ownerDocument.styleSheets),i=await async function(t,e){const n=[],i=[];return t.forEach((n=>{if("cssRules"in n)try{Ta(n.cssRules||[]).forEach(((t,r)=>{if(t.type===CSSRule.IMPORT_RULE){let o=r+1;const s=Qa(t.href).then((t=>Ja(t,e))).then((t=>tu(t).forEach((t=>{try{n.insertRule(t,t.startsWith("@import")?o+=1:n.cssRules.length)}catch(e){console.error("Error inserting rule from remote css",{rule:t,error:e})}})))).catch((t=>{console.error("Error loading remote css",t.toString())}));i.push(s)}}))}catch(r){const o=t.find((t=>null==t.href))||document.styleSheets[0];null!=n.href&&i.push(Qa(n.href).then((t=>Ja(t,e))).then((t=>tu(t).forEach((t=>{o.insertRule(t,n.cssRules.length)})))).catch((t=>{console.error("Error loading remote stylesheet",t)}))),console.error("Error inlining remote css file",r)}})),Promise.all(i).then((()=>(t.forEach((t=>{if("cssRules"in t)try{Ta(t.cssRules||[]).forEach((t=>{n.push(t)}))}catch(e){console.error(`Error while reading CSS rules from ${t.href}`,e)}})),n)))}(n,e);return function(t){return t.filter((t=>t.type===CSSRule.FONT_FACE_RULE)).filter((t=>Ya(t.style.getPropertyValue("src"))))}(i)}(t,e);return(await Promise.all(n.map((t=>{const n=t.parentStyleSheet?t.parentStyleSheet.href:null;return qa(t.cssText,n,e)})))).join("\n")}(t,e);if(n){const e=document.createElement("style"),i=document.createTextNode(n);e.appendChild(i),t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}}async function nu(t,e={}){const{width:n,height:i}=Sa(t,e),r=await Ua(t,e,!0);return await eu(r,e),await Ka(r,e),function(t,e){const{style:n}=t;e.backgroundColor&&(n.backgroundColor=e.backgroundColor),e.width&&(n.width=`${e.width}px`),e.height&&(n.height=`${e.height}px`);const i=e.style;null!=i&&Object.keys(i).forEach((t=>{n[t]=i[t]}))}(r,e),await async function(t,e,n){const i="http://www.w3.org/2000/svg",r=document.createElementNS(i,"svg"),o=document.createElementNS(i,"foreignObject");return r.setAttribute("width",`${e}`),r.setAttribute("height",`${n}`),r.setAttribute("viewBox",`0 0 ${e} ${n}`),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),r.appendChild(o),o.appendChild(t),async function(t){return Promise.resolve().then((()=>(new XMLSerializer).serializeToString(t))).then(encodeURIComponent).then((t=>`data:image/svg+xml;charset=utf-8,${t}`))}(r)}(r,n,i)}function iu(t){return iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},iu(t)}var ru=["id","nodes","edges","style","export_trigger"];function ou(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,su(i.key),i)}}function su(t){var e=function(t){if("object"!=iu(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=iu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==iu(e)?e:e+""}function au(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(au=function(){return!!t})()}function uu(t){return uu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},uu(t)}function lu(t,e){return lu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},lu(t,e)}function pu(){return pu=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},pu.apply(null,arguments)}function hu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}var cu=function(n){var i,r,o=n.id,s=n.nodes,a=n.edges,u=(n.style,n.export_trigger),l=function(t,e){if(null==t)return{};var n,i,r=function(t,e){if(null==t)return{};var n={};for(var i in t)if({}.hasOwnProperty.call(t,i)){if(e.includes(i))continue;n[i]=t[i]}return n}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],e.includes(n)||{}.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}(n,ru),p=pr(),h=(i=(0,t.useState)(u),r=2,function(t){if(Array.isArray(t))return t}(i)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o,s,a=[],u=!0,l=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(a.push(i.value),a.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw r}}return a}}(i,r)||function(t,e){if(t){if("string"==typeof t)return hu(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?hu(t,e):void 0}}(i,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=h[0],d=h[1],f=(0,t.useCallback)((function(){if(console.log("Starting image generation process..."),p)try{var t=p.getNodes(),e=Bi(t);console.log("Node bounds:",e);var n=Math.max(e.width+200,800),i=Math.max(e.height+200,600),r=zi(e,n,i,.5,2),o=document.querySelector(".react-flow__viewport");if(!o)return void console.error("Flow element not found");(async function(t,e={}){return(await async function(t,e={}){const{width:n,height:i}=Sa(t,e),r=await nu(t,e),o=await La(r),s=document.createElement("canvas"),a=s.getContext("2d"),u=e.pixelRatio||function(){let t,e;try{e=process}catch(t){}const n=e&&e.env?e.env.devicePixelRatio:null;return n&&(t=parseInt(n,10),Number.isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}(),l=e.canvasWidth||n,p=e.canvasHeight||i;return s.width=l*u,s.height=p*u,e.skipAutoScale||function(t){(t.width>Ia||t.height>Ia)&&(t.width>Ia&&t.height>Ia?t.width>t.height?(t.height*=Ia/t.width,t.width=Ia):(t.width*=Ia/t.height,t.height=Ia):t.width>Ia?(t.height*=Ia/t.width,t.width=Ia):(t.width*=Ia/t.height,t.height=Ia))}(s),s.style.width=`${l}`,s.style.height=`${p}`,e.backgroundColor&&(a.fillStyle=e.backgroundColor,a.fillRect(0,0,s.width,s.height)),a.drawImage(o,0,0,s.width,s.height),s}(t,e)).toDataURL()})(o,{backgroundColor:"#f8f8fa",width:n,height:i,style:{width:String(n),height:String(i),transform:"translate(".concat(r[0],"px, ").concat(r[1],"px) scale(").concat(r[2],")")}}).then((function(t){var e=new Date,n="".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-").concat(String(e.getDate()).padStart(2,"0")),i="".concat(String(e.getHours()).padStart(2,"0")).concat(String(e.getMinutes()).padStart(2,"0")).concat(String(e.getSeconds()).padStart(2,"0")),r="flowchart_".concat(n,"_").concat(i,".png"),o=document.createElement("a");o.setAttribute("download",r),o.setAttribute("href",t),o.click(),console.log("Export completed successfully")})).catch((function(t){console.error("Error in toPng conversion:",t)}))}catch(t){console.error("Error in generateImage:",t)}else console.error("Flow instance not ready")}),[p]);return(0,t.useEffect)((function(){u!==c&&(console.log("Export triggered"),f(),d(u),l.setProps&&l.setProps({export_trigger:u}))}),[u,f,c,l.setProps]),e().createElement("div",{id:o,style:{width:"100%",height:"100%",position:"relative"}},e().createElement(la,pu({nodes:s,edges:a},l),e().createElement(wr,null),e().createElement(ma,null),e().createElement(Ea,null)))},du=function(t){function n(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),function(t,e,n){return e=uu(e),function(t,e){if(e&&("object"==iu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,au()?Reflect.construct(e,n||[],uu(t).constructor):e.apply(t,n))}(this,n,arguments)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lu(t,e)}(n,t),i=n,(r=[{key:"render",value:function(){var t=this.props,n=t.id,i=t.nodes,r=t.edges,o=t.node_types,s=t.edge_types,a=t.min_zoom,u=t.max_zoom,l=t.default_zoom,p=t.default_position,h=t.fit_view,c=t.snap_to_grid,d=t.snap_grid,f=t.nodes_draggable,g=t.nodes_connectable,_=t.elements_selectable,v=t.pan_on_drag,m=t.pan_on_scroll,y=t.zoom_on_scroll,b=t.zoom_on_pinch,x=t.connection_mode,A=t.style,w=t.className,E=t.export_trigger,C=t.setProps;return e().createElement("div",{style:A},e().createElement(pa,null,e().createElement(cu,{id:n,nodes:i,edges:r,nodeTypes:o,edgeTypes:s,minZoom:a,maxZoom:u,defaultZoom:l,defaultPosition:p,fitView:h,snapToGrid:c,snapGrid:d,nodesDraggable:f,nodesConnectable:g,elementsSelectable:_,panOnDrag:v,panOnScroll:m,zoomOnScroll:y,zoomOnPinch:b,connectionMode:x,className:w,export_trigger:E,onNodesChange:function(t){C&&C({nodes_change:t})},onEdgesChange:function(t){C&&C({edges_change:t})},onConnect:function(t){C&&C({connect:t})},onNodeClick:function(t,e){C&&C({clicked_node:e})},onEdgeClick:function(t,e){C&&C({clicked_edge:e})}})))}}])&&ou(i.prototype,r),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,r}(t.Component);du.defaultProps={min_zoom:.5,max_zoom:2,default_zoom:1,default_position:[0,0],fit_view:!1,snap_to_grid:!1,snap_grid:[15,15],nodes_draggable:!0,nodes_connectable:!0,elements_selectable:!0,pan_on_drag:!0,pan_on_scroll:!1,zoom_on_scroll:!0,zoom_on_pinch:!0,connection_mode:"strict",nodes_change:null,edges_change:null,connect:null,clicked_node:null,clicked_edge:null,export_trigger:0},du.propTypes={id:i().string,nodes:i().arrayOf(i().object).isRequired,edges:i().arrayOf(i().object).isRequired,nodes_change:i().array,edges_change:i().array,connect:i().object,clicked_node:i().object,clicked_edge:i().object,node_types:i().object,edge_types:i().object,min_zoom:i().number,max_zoom:i().number,default_zoom:i().number,default_position:i().arrayOf(i().number),fit_view:i().bool,snap_to_grid:i().bool,snap_grid:i().arrayOf(i().number),nodes_draggable:i().bool,nodes_connectable:i().bool,elements_selectable:i().bool,pan_on_drag:i().bool,pan_on_scroll:i().bool,zoom_on_scroll:i().bool,zoom_on_pinch:i().bool,connection_mode:i().oneOf(["strict","loose"]),style:i().object,className:i().string,export_trigger:i().number,setProps:i().func};var fu=__webpack_require__(463),gu=__webpack_require__(72),_u=__webpack_require__.n(gu),vu=__webpack_require__(825),mu=__webpack_require__.n(vu),yu=__webpack_require__(659),bu=__webpack_require__.n(yu),xu=__webpack_require__(56),Au=__webpack_require__.n(xu),wu=__webpack_require__(540),Eu=__webpack_require__.n(wu),Cu=__webpack_require__(113),Tu=__webpack_require__.n(Cu),Ou=__webpack_require__(827),Su={};function Iu(t){return Iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Iu(t)}function Lu(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Gu(i.key),i)}}function Nu(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Nu=function(){return!!t})()}function Du(t){return Du=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Du(t)}function ku(t,e){return ku=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ku(t,e)}function Gu(t){var e=function(t){if("object"!=Iu(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Iu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Iu(e)?e:e+""}Su.styleTagTransform=Tu(),Su.setAttributes=Au(),Su.insert=bu().bind(null,"head"),Su.domAPI=mu(),Su.insertStyleElement=Eu(),_u()(Ou.A,Su),Ou.A&&Ou.A.locals&&Ou.A.locals;var Pu=function(t){function n(t){var i,r,o,s;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),i=function(t,e,n){return e=Du(e),function(t,e){if(e&&("object"==Iu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Nu()?Reflect.construct(e,n||[],Du(t).constructor):e.apply(t,n))}(this,n,[t]),r=i,s=function(){if(i.graph){var t=i.graph.serialize();console.log(" Serialized Data:",t),i.props.setProps&&i.props.setProps({serializedGraph:t})}else console.warn("No graph initialized")},(o=Gu(o="handleSerialize"))in r?Object.defineProperty(r,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[o]=s,i.canvasRef=e().createRef(),i.graph=null,i.canvas=null,console.log("Component initialized"),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ku(t,e)}(n,t),i=n,(r=[{key:"componentDidMount",value:function(){this.initGraph(),console.log("componentDidMount initialized"),this.props.setProps&&this.props.setProps({serializeGraph:this.handleSerialize}),console.log("serializeGraph initialized")}},{key:"componentDidUpdate",value:function(t){t.nodes!==this.props.nodes&&this.updateNodes(),t.width===this.props.width&&t.height===this.props.height||this.canvas&&this.canvas.resize(this.props.width,this.props.height),this.props.serialize&&!t.serialize&&(this.handleSerialize(),this.props.setProps({serialize:!1}))}},{key:"componentWillUnmount",value:function(){this.graph&&(this.graph.stop(),this.graph.clear()),this.canvas&&this.canvas.clear()}},{key:"initGraph",value:function(){var t=this.props,e=t.id,n=t.width,i=t.height;this.canvasRef.current&&(this.canvasRef.current.width=n,this.canvasRef.current.height=i,this.graph=new fu.LGraph,this.canvas=new fu.LGraphCanvas("#".concat(e),this.graph),this.canvas&&(this.canvas.resize(n,i),this.updateNodes(),this.props.autostart&&this.graph.start(),this.setupPointerEvents()),this.canvas.onShowNodePanel=function(){return!1})}},{key:"updateNodes",value:function(){var t=this;this.graph&&this.props.nodes&&(this.graph.clear(),this.props.nodes.forEach((function(e){var n=fu.LiteGraph.createNode(e.type);n&&(n.pos=e.pos||[0,0],e.properties&&Object.assign(n.properties,e.properties),t.graph.add(n))})),this.props.connections&&this.props.connections.forEach((function(e){var n=t.graph.getNodeById(e.origin_id),i=t.graph.getNodeById(e.target_id);n&&i&&n.connect(e.origin_slot,i,e.target_slot)})))}},{key:"setupPointerEvents",value:function(){var t=this;this.graph&&this.canvas&&(this.graph.onNodeAdded=function(e){if(t.props.setProps){var n={id:e.id,type:e.type,pos:e.pos};t.props.setProps({lastNodeAdded:n,onNodeAdded:null})}},this.canvas.onNodeDblClicked=function(e,n){if(console.log("Node double clicked:",e),t.props.setProps){var i,r,o=e?{id:e.id,type:e.type,pos:e.pos,properties:e.properties||{},title:e.title,inputs:(null===(i=e.inputs)||void 0===i?void 0:i.map((function(t){return{name:t.name,type:t.type,link:t.link}})))||[],outputs:(null===(r=e.outputs)||void 0===r?void 0:r.map((function(t){return{name:t.name,type:t.type,links:t.links}})))||[]}:null;t.props.setProps({nodeDblClicked:o,onNodeDblClicked:null})}},this.graph.onNodeRemoved=function(e){t.props.setProps&&t.props.setProps({lastNodeRemoved:e.id,onNodeRemoved:null})},this.graph.onConnectionChange=function(e,n,i){if(t.props.setProps){var r=i?createPointerEvent("pointerup",i):null,o={output:null==e?void 0:e.id,input:null==n?void 0:n.id,event:r};t.props.setProps({lastConnectionChange:o,onConnectionChange:null})}})}},{key:"render",value:function(){var t=this.props,n=t.id,i=t.width,r=t.height,o=t.className;return e().createElement("div",{style:{width:i,height:r}},e().createElement("canvas",{ref:this.canvasRef,id:n,className:o,style:{width:"100%",height:"100%",position:"relative",touchAction:"none",border:"1px solid #000"}}))}}])&&Lu(i.prototype,r),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,r}(t.Component);Pu.defaultProps={width:1024,height:720,autostart:!0,nodes:[],connections:[],serialize:!1,lastNodeAdded:null,lastNodeRemoved:null,lastConnectionChange:null,onNodeAdded:null,onNodeRemoved:null,onConnectionChange:null,onNodeDblClicked:null},Pu.propTypes={id:i().string.isRequired,width:i().number,height:i().number,autostart:i().bool,nodes:i().arrayOf(i().shape({type:i().string.isRequired,pos:i().arrayOf(i().number),properties:i().object})),connections:i().arrayOf(i().shape({origin_id:i().number.isRequired,target_id:i().number.isRequired,origin_slot:i().number.isRequired,target_slot:i().number.isRequired})),className:i().string,lastNodeAdded:i().object,lastNodeRemoved:i().number,lastConnectionChange:i().object,serializedGraph:i().object,onNodeAdded:i().object,onNodeRemoved:i().number,onConnectionChange:i().object,nodeDblClicked:i().shape({id:i().number,type:i().string,pos:i().arrayOf(i().number),properties:i().object,title:i().string,inputs:i().arrayOf(i().shape({name:i().string,type:i().string,link:i().any})),outputs:i().arrayOf(i().shape({name:i().string,type:i().string,links:i().any})),event:i().object}),setProps:i().func,onNodeDblClicked:i().func,serialize:i().bool}})(),window.dash_diagram=__webpack_exports__})();
//# sourceMappingURL=dash_diagram.min.js.map