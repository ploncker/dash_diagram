{"version":3,"file":"dash_diagram.min.js","mappings":"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","sources":["webpack:///./node_modules/litegraph.js/css/litegraph.css","webpack:///./node_modules/css-loader/dist/runtime/api.js","webpack:///./node_modules/css-loader/dist/runtime/sourceMaps.js","webpack:///./node_modules/litegraph.js/build/litegraph.js","webpack:///./node_modules/save-svg-as-png/lib/saveSvgAsPng.js","webpack:///./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js","webpack:///./node_modules/style-loader/dist/runtime/insertBySelector.js","webpack:///./node_modules/style-loader/dist/runtime/insertStyleElement.js","webpack:///./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js","webpack:///./node_modules/style-loader/dist/runtime/styleDomAPI.js","webpack:///./node_modules/style-loader/dist/runtime/styleTagTransform.js","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///webpack/runtime/compat","webpack:///webpack/runtime/nonce","webpack:///external window \"React\"","webpack:///external window \"PropTypes\"","webpack:///./src/lib/components/Mermaid.react.js","webpack:///./node_modules/zustand/esm/index.js","webpack:///./node_modules/d3-dispatch/src/dispatch.js","webpack:///./node_modules/d3-selection/src/selector.js","webpack:///./node_modules/d3-selection/src/selectorAll.js","webpack:///./node_modules/d3-selection/src/matcher.js","webpack:///./node_modules/d3-selection/src/selection/selectChild.js","webpack:///./node_modules/d3-selection/src/selection/selectChildren.js","webpack:///./node_modules/d3-selection/src/selection/sparse.js","webpack:///./node_modules/d3-selection/src/selection/enter.js","webpack:///./node_modules/d3-selection/src/selection/data.js","webpack:///./node_modules/d3-selection/src/selection/sort.js","webpack:///./node_modules/d3-selection/src/namespaces.js","webpack:///./node_modules/d3-selection/src/namespace.js","webpack:///./node_modules/d3-selection/src/selection/attr.js","webpack:///./node_modules/d3-selection/src/window.js","webpack:///./node_modules/d3-selection/src/selection/style.js","webpack:///./node_modules/d3-selection/src/selection/property.js","webpack:///./node_modules/d3-selection/src/selection/classed.js","webpack:///./node_modules/d3-selection/src/selection/text.js","webpack:///./node_modules/d3-selection/src/selection/html.js","webpack:///./node_modules/d3-selection/src/selection/raise.js","webpack:///./node_modules/d3-selection/src/selection/lower.js","webpack:///./node_modules/d3-selection/src/creator.js","webpack:///./node_modules/d3-selection/src/selection/insert.js","webpack:///./node_modules/d3-selection/src/selection/remove.js","webpack:///./node_modules/d3-selection/src/selection/clone.js","webpack:///./node_modules/d3-selection/src/selection/on.js","webpack:///./node_modules/d3-selection/src/selection/dispatch.js","webpack:///./node_modules/d3-selection/src/selection/index.js","webpack:///./node_modules/d3-selection/src/selection/select.js","webpack:///./node_modules/d3-selection/src/selection/selectAll.js","webpack:///./node_modules/d3-selection/src/array.js","webpack:///./node_modules/d3-selection/src/selection/filter.js","webpack:///./node_modules/d3-selection/src/constant.js","webpack:///./node_modules/d3-selection/src/selection/exit.js","webpack:///./node_modules/d3-selection/src/selection/join.js","webpack:///./node_modules/d3-selection/src/selection/merge.js","webpack:///./node_modules/d3-selection/src/selection/order.js","webpack:///./node_modules/d3-selection/src/selection/call.js","webpack:///./node_modules/d3-selection/src/selection/nodes.js","webpack:///./node_modules/d3-selection/src/selection/node.js","webpack:///./node_modules/d3-selection/src/selection/size.js","webpack:///./node_modules/d3-selection/src/selection/empty.js","webpack:///./node_modules/d3-selection/src/selection/each.js","webpack:///./node_modules/d3-selection/src/selection/append.js","webpack:///./node_modules/d3-selection/src/selection/datum.js","webpack:///./node_modules/d3-selection/src/selection/iterator.js","webpack:///./node_modules/d3-selection/src/select.js","webpack:///./node_modules/d3-drag/src/noevent.js","webpack:///./node_modules/d3-drag/src/nodrag.js","webpack:///./node_modules/d3-interpolate/src/zoom.js","webpack:///./node_modules/d3-selection/src/pointer.js","webpack:///./node_modules/d3-selection/src/sourceEvent.js","webpack:///./node_modules/d3-timer/src/timer.js","webpack:///./node_modules/d3-timer/src/timeout.js","webpack:///./node_modules/d3-transition/src/transition/schedule.js","webpack:///./node_modules/d3-transition/src/interrupt.js","webpack:///./node_modules/d3-interpolate/src/number.js","webpack:///./node_modules/d3-interpolate/src/transform/decompose.js","webpack:///./node_modules/d3-interpolate/src/transform/parse.js","webpack:///./node_modules/d3-interpolate/src/transform/index.js","webpack:///./node_modules/d3-transition/src/transition/tween.js","webpack:///./node_modules/d3-color/src/define.js","webpack:///./node_modules/d3-color/src/color.js","webpack:///./node_modules/d3-interpolate/src/basis.js","webpack:///./node_modules/d3-interpolate/src/constant.js","webpack:///./node_modules/d3-interpolate/src/color.js","webpack:///./node_modules/d3-interpolate/src/rgb.js","webpack:///./node_modules/d3-interpolate/src/basisClosed.js","webpack:///./node_modules/d3-interpolate/src/string.js","webpack:///./node_modules/d3-transition/src/transition/interpolate.js","webpack:///./node_modules/d3-transition/src/transition/attr.js","webpack:///./node_modules/d3-transition/src/transition/attrTween.js","webpack:///./node_modules/d3-transition/src/transition/delay.js","webpack:///./node_modules/d3-transition/src/transition/duration.js","webpack:///./node_modules/d3-transition/src/transition/selection.js","webpack:///./node_modules/d3-transition/src/transition/style.js","webpack:///./node_modules/d3-transition/src/transition/index.js","webpack:///./node_modules/d3-transition/src/transition/select.js","webpack:///./node_modules/d3-transition/src/transition/selectAll.js","webpack:///./node_modules/d3-transition/src/transition/filter.js","webpack:///./node_modules/d3-transition/src/transition/merge.js","webpack:///./node_modules/d3-transition/src/transition/transition.js","webpack:///./node_modules/d3-transition/src/transition/on.js","webpack:///./node_modules/d3-transition/src/transition/styleTween.js","webpack:///./node_modules/d3-transition/src/transition/text.js","webpack:///./node_modules/d3-transition/src/transition/textTween.js","webpack:///./node_modules/d3-transition/src/transition/remove.js","webpack:///./node_modules/d3-transition/src/transition/ease.js","webpack:///./node_modules/d3-transition/src/transition/easeVarying.js","webpack:///./node_modules/d3-transition/src/transition/end.js","webpack:///./node_modules/d3-transition/src/selection/transition.js","webpack:///./node_modules/d3-ease/src/cubic.js","webpack:///./node_modules/d3-transition/src/selection/index.js","webpack:///./node_modules/d3-transition/src/selection/interrupt.js","webpack:///./node_modules/d3-zoom/src/constant.js","webpack:///./node_modules/d3-zoom/src/event.js","webpack:///./node_modules/d3-zoom/src/transform.js","webpack:///./node_modules/react-flow-renderer/dist/esm/index-a12c80bd.js","webpack:///./node_modules/d3-zoom/src/noevent.js","webpack:///./node_modules/d3-zoom/src/zoom.js","webpack:///./node_modules/zustand/esm/context.js","webpack:///./node_modules/zustand/esm/shallow.js","webpack:///./node_modules/react-flow-renderer/dist/esm/useReactFlow-993c30ca.js","webpack:///./node_modules/classcat/index.js","webpack:///./node_modules/react-flow-renderer/dist/esm/index-20df97c0.js","webpack:///./node_modules/d3-drag/src/constant.js","webpack:///./node_modules/d3-drag/src/event.js","webpack:///./node_modules/d3-drag/src/drag.js","webpack:///./node_modules/react-flow-renderer/dist/esm/index.js","webpack:///./node_modules/react-flow-renderer/dist/esm/index2.js","webpack:///./node_modules/react-flow-renderer/dist/esm/index3.js","webpack:///./node_modules/html-to-image/es/util.js","webpack:///./node_modules/html-to-image/es/clone-pseudos.js","webpack:///./node_modules/html-to-image/es/mimes.js","webpack:///./node_modules/html-to-image/es/dataurl.js","webpack:///./node_modules/html-to-image/es/clone-node.js","webpack:///./node_modules/html-to-image/es/embed-resources.js","webpack:///./node_modules/html-to-image/es/embed-images.js","webpack:///./node_modules/html-to-image/es/embed-webfonts.js","webpack:///./node_modules/html-to-image/es/index.js","webpack:///./node_modules/html-to-image/es/apply-style.js","webpack:///./src/lib/components/Reactflow.react.js","webpack:///./node_modules/litegraph.js/css/litegraph.css?7c37","webpack:///./src/lib/components/Litegraph.react.js"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `/* this CSS contains only the basic CSS needed to run the app and use it */\n\n.lgraphcanvas {\n    /*cursor: crosshair;*/\n    user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n\toutline: none;\n    font-family: Tahoma, sans-serif;\n}\n\n.lgraphcanvas * {\n    box-sizing: border-box;\n}\n\n.litegraph.litecontextmenu {\n    font-family: Tahoma, sans-serif;\n    position: fixed;\n    top: 100px;\n    left: 100px;\n    min-width: 100px;\n    color: #aaf;\n    padding: 0;\n    box-shadow: 0 0 10px black !important;\n    background-color: #2e2e2e !important;\n\tz-index: 10;\n}\n\n.litegraph.litecontextmenu.dark {\n    background-color: #000 !important;\n}\n\n.litegraph.litecontextmenu .litemenu-title img {\n    margin-top: 2px;\n    margin-left: 2px;\n    margin-right: 4px;\n}\n\n.litegraph.litecontextmenu .litemenu-entry {\n    margin: 2px;\n    padding: 2px;\n}\n\n.litegraph.litecontextmenu .litemenu-entry.submenu {\n    background-color: #2e2e2e !important;\n}\n\n.litegraph.litecontextmenu.dark .litemenu-entry.submenu {\n    background-color: #000 !important;\n}\n\n.litegraph .litemenubar ul {\n    font-family: Tahoma, sans-serif;\n    margin: 0;\n    padding: 0;\n}\n\n.litegraph .litemenubar li {\n    font-size: 14px;\n    color: #999;\n    display: inline-block;\n    min-width: 50px;\n    padding-left: 10px;\n    padding-right: 10px;\n    user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    cursor: pointer;\n}\n\n.litegraph .litemenubar li:hover {\n    background-color: #777;\n    color: #eee;\n}\n\n.litegraph .litegraph .litemenubar-panel {\n    position: absolute;\n    top: 5px;\n    left: 5px;\n    min-width: 100px;\n    background-color: #444;\n    box-shadow: 0 0 3px black;\n    padding: 4px;\n    border-bottom: 2px solid #aaf;\n    z-index: 10;\n}\n\n.litegraph .litemenu-entry,\n.litemenu-title {\n    font-size: 12px;\n    color: #aaa;\n    padding: 0 0 0 4px;\n    margin: 2px;\n    padding-left: 2px;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    user-select: none;\n    cursor: pointer;\n}\n\n.litegraph .litemenu-entry .icon {\n    display: inline-block;\n    width: 12px;\n    height: 12px;\n    margin: 2px;\n    vertical-align: top;\n}\n\n.litegraph .litemenu-entry.checked .icon {\n    background-color: #aaf;\n}\n\n.litegraph .litemenu-entry .more {\n    float: right;\n    padding-right: 5px;\n}\n\n.litegraph .litemenu-entry.disabled {\n    opacity: 0.5;\n    cursor: default;\n}\n\n.litegraph .litemenu-entry.separator {\n    display: block;\n    border-top: 1px solid #333;\n    border-bottom: 1px solid #666;\n    width: 100%;\n    height: 0px;\n    margin: 3px 0 2px 0;\n    background-color: transparent;\n    padding: 0 !important;\n    cursor: default !important;\n}\n\n.litegraph .litemenu-entry.has_submenu {\n    border-right: 2px solid cyan;\n}\n\n.litegraph .litemenu-title {\n    color: #dde;\n    background-color: #111;\n    margin: 0;\n    padding: 2px;\n    cursor: default;\n}\n\n.litegraph .litemenu-entry:hover:not(.disabled):not(.separator) {\n    background-color: #444 !important;\n    color: #eee;\n    transition: all 0.2s;\n}\n\n.litegraph .litemenu-entry .property_name {\n    display: inline-block;\n    text-align: left;\n    min-width: 80px;\n    min-height: 1.2em;\n}\n\n.litegraph .litemenu-entry .property_value {\n    display: inline-block;\n    background-color: rgba(0, 0, 0, 0.5);\n    text-align: right;\n    min-width: 80px;\n    min-height: 1.2em;\n    vertical-align: middle;\n    padding-right: 10px;\n}\n\n.litegraph.litesearchbox {\n    font-family: Tahoma, sans-serif;\n    position: absolute;\n    background-color: rgba(0, 0, 0, 0.5);\n    padding-top: 4px;\n}\n\n.litegraph.litesearchbox input,\n.litegraph.litesearchbox select {\n    margin-top: 3px;\n    min-width: 60px;\n    min-height: 1.5em;\n    background-color: black;\n    border: 0;\n    color: white;\n    padding-left: 10px;\n    margin-right: 5px;\n}\n\n.litegraph.litesearchbox .name {\n    display: inline-block;\n    min-width: 60px;\n    min-height: 1.5em;\n    padding-left: 10px;\n}\n\n.litegraph.litesearchbox .helper {\n    overflow: auto;\n    max-height: 200px;\n    margin-top: 2px;\n}\n\n.litegraph.lite-search-item {\n    font-family: Tahoma, sans-serif;\n    background-color: rgba(0, 0, 0, 0.5);\n    color: white;\n    padding-top: 2px;\n}\n\n.litegraph.lite-search-item.not_in_filter{\n    /*background-color: rgba(50, 50, 50, 0.5);*/\n    /*color: #999;*/\n    color: #B99;\n    font-style: italic;\n}\n\n.litegraph.lite-search-item.generic_type{\n    /*background-color: rgba(50, 50, 50, 0.5);*/\n    /*color: #DD9;*/\n    color: #999;\n    font-style: italic;\n}\n\n.litegraph.lite-search-item:hover,\n.litegraph.lite-search-item.selected {\n    cursor: pointer;\n    background-color: white;\n    color: black;\n}\n\n/* DIALOGs ******/\n\n.litegraph .dialog {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    margin-top: -150px;\n    margin-left: -200px;\n\n    background-color: #2A2A2A;\n\n    min-width: 400px;\n    min-height: 200px;\n\tbox-shadow: 0 0 4px #111;\n    border-radius: 6px;\n}\n\n.litegraph .dialog.settings {\n\tleft: 10px;\n\ttop: 10px;\n\theight: calc( 100% - 20px );\n\tmargin: auto;\n    max-width: 50%;\n}\n\n.litegraph .dialog.centered {\n    top: 50px;\n    left: 50%;\n    position: absolute;\n    transform: translateX(-50%);\n    min-width: 600px;\n    min-height: 300px;\n    height: calc( 100% - 100px );\n\tmargin: auto;\n}\n\n.litegraph .dialog .close {\n    float: right;\n\tmargin: 4px;\n\tmargin-right: 10px;\n\tcursor: pointer;\n\tfont-size: 1.4em;\n}\n\n.litegraph .dialog .close:hover {\n\tcolor: white;\n}\n\n.litegraph .dialog .dialog-header {\n\tcolor: #AAA;\n\tborder-bottom: 1px solid #161616;\n}\n\n.litegraph .dialog .dialog-header { height: 40px; }\n.litegraph .dialog .dialog-footer { height: 50px; padding: 10px; border-top: 1px solid #1a1a1a;}\n\n.litegraph .dialog .dialog-header .dialog-title {\n    font: 20px \"Arial\";\n    margin: 4px;\n    padding: 4px 10px;\n    display: inline-block;\n}\n\n.litegraph .dialog .dialog-content, .litegraph .dialog .dialog-alt-content {\n    height: calc(100% - 90px);\n    width: 100%;\n\tmin-height: 100px;\n    display: inline-block;\n\tcolor: #AAA;\n    /*background-color: black;*/\n    overflow: auto;\n}\n\n.litegraph .dialog .dialog-content h3 {\n\tmargin: 10px;\n}\n\n.litegraph .dialog .dialog-content .connections {\n\tflex-direction: row;\n}\n\n.litegraph .dialog .dialog-content .connections .connections_side {\n\twidth: calc(50% - 5px);\n\tmin-height: 100px;\n\tbackground-color: black;\n\tdisplay: flex;\n}\n\n.litegraph .dialog .node_type {\n\tfont-size: 1.2em;\n\tdisplay: block;\n\tmargin: 10px;\n}\n\n.litegraph .dialog .node_desc {\n\topacity: 0.5;\n\tdisplay: block;\n\tmargin: 10px;\n}\n\n.litegraph .dialog .separator {\n\tdisplay: block;\n\twidth: calc( 100% - 4px );\n\theight: 1px;\n\tborder-top: 1px solid #000;\n\tborder-bottom: 1px solid #333;\n\tmargin: 10px 2px;\n\tpadding: 0;\n}\n\n.litegraph .dialog .property {\n\tmargin-bottom: 2px;\n\tpadding: 4px;\n}\n\n.litegraph .dialog .property:hover {\n\tbackground: #545454;\n}\n\n.litegraph .dialog .property_name {\n\tcolor: #737373;\n    display: inline-block;\n    text-align: left;\n    vertical-align: top;\n    width: 160px;\n\tpadding-left: 4px;\n\toverflow: hidden;\n    margin-right: 6px;\n}\n\n.litegraph .dialog .property:hover .property_name {\n    color: white;\n}\n\n.litegraph .dialog .property_value {\n    display: inline-block;\n    text-align: right;\n\tcolor: #AAA;\n\tbackground-color: #1A1A1A;\n    /*width: calc( 100% - 122px );*/\n    max-width: calc( 100% - 162px );\n    min-width: 200px;\n\tmax-height: 300px;\n    min-height: 20px;\n    padding: 4px;\n\tpadding-right: 12px;\n\toverflow: hidden;\n\tcursor: pointer;\n\tborder-radius: 3px;\n}\n\n.litegraph .dialog .property_value:hover {\n\tcolor: white;\n}\n\n.litegraph .dialog .property.boolean .property_value {\n\tpadding-right: 30px;\n    color: #A88;\n    /*width: auto;\n    float: right;*/\n}\n\n.litegraph .dialog .property.boolean.bool-on .property_name{\n    color: #8A8;\n}\n.litegraph .dialog .property.boolean.bool-on .property_value{\n    color: #8A8;\n}\n\n.litegraph .dialog .btn {\n\tborder: 0;\n\tborder-radius: 4px;\n    padding: 4px 20px;\n    margin-left: 0px;\n    background-color: #060606;\n    color: #8e8e8e;\n}\n\n.litegraph .dialog .btn:hover {\n    background-color: #111;\n    color: #FFF;\n}\n\n.litegraph .dialog .btn.delete:hover {\n    background-color: #F33;\n    color: black;\n}\n\n.litegraph .subgraph_property {\n\tpadding: 4px;\n}\n\n.litegraph .subgraph_property:hover {\n\tbackground-color: #333;\n}\n\n.litegraph .subgraph_property.extra {\n    margin-top: 8px;\n}\n\n.litegraph .subgraph_property span.name {\n\tfont-size: 1.3em;\n\tpadding-left: 4px;\n}\n\n.litegraph .subgraph_property span.type {\n\topacity: 0.5;\n\tmargin-right: 20px;\n\tpadding-left: 4px;\n}\n\n.litegraph .subgraph_property span.label {\n\tdisplay: inline-block;\n\twidth: 60px;\n\tpadding:  0px 10px;\n}\n\n.litegraph .subgraph_property input {\n\twidth: 140px;\n\tcolor: #999;\n\tbackground-color: #1A1A1A;\n\tborder-radius: 4px;\n\tborder: 0;\n\tmargin-right: 10px;\n\tpadding: 4px;\n\tpadding-left: 10px;\n}\n\n.litegraph .subgraph_property button {\n\tbackground-color: #1c1c1c;\n\tcolor: #aaa;\n\tborder: 0;\n\tborder-radius: 2px;\n\tpadding: 4px 10px;\n\tcursor: pointer;\n}\n\n.litegraph .subgraph_property.extra {\n\tcolor: #ccc;\n}\n\n.litegraph .subgraph_property.extra input {\n\tbackground-color: #111;\n}\n\n.litegraph .bullet_icon {\n\tmargin-left: 10px;\n\tborder-radius: 10px;\n\twidth: 12px;\n\theight: 12px;\n\tbackground-color: #666;\n\tdisplay: inline-block;\n\tmargin-top: 2px;\n\tmargin-right: 4px;\n    transition: background-color 0.1s ease 0s;\n    -moz-transition: background-color 0.1s ease 0s;\n}\n\n.litegraph .bullet_icon:hover {\n\tbackground-color: #698;\n\tcursor: pointer;\n} \n\n/* OLD */\n\n.graphcontextmenu {\n    padding: 4px;\n    min-width: 100px;\n}\n\n.graphcontextmenu-title {\n    color: #dde;\n    background-color: #222;\n    margin: 0;\n    padding: 2px;\n    cursor: default;\n}\n\n.graphmenu-entry {\n    box-sizing: border-box;\n    margin: 2px;\n    padding-left: 20px;\n    user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    transition: all linear 0.3s;\n}\n\n.graphmenu-entry.event,\n.litemenu-entry.event {\n    border-left: 8px solid orange;\n    padding-left: 12px;\n}\n\n.graphmenu-entry.disabled {\n    opacity: 0.3;\n}\n\n.graphmenu-entry.submenu {\n    border-right: 2px solid #eee;\n}\n\n.graphmenu-entry:hover {\n    background-color: #555;\n}\n\n.graphmenu-entry.separator {\n    background-color: #111;\n    border-bottom: 1px solid #666;\n    height: 1px;\n    width: calc(100% - 20px);\n    -moz-width: calc(100% - 20px);\n    -webkit-width: calc(100% - 20px);\n}\n\n.graphmenu-entry .property_name {\n    display: inline-block;\n    text-align: left;\n    min-width: 80px;\n    min-height: 1.2em;\n}\n\n.graphmenu-entry .property_value,\n.litemenu-entry .property_value {\n    display: inline-block;\n    background-color: rgba(0, 0, 0, 0.5);\n    text-align: right;\n    min-width: 80px;\n    min-height: 1.2em;\n    vertical-align: middle;\n    padding-right: 10px;\n}\n\n.graphdialog {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    min-height: 2em;\n    background-color: #333;\n    font-size: 1.2em;\n    box-shadow: 0 0 10px black !important;\n\tz-index: 10;\n}\n\n.graphdialog.rounded {\n    border-radius: 12px;\n    padding-right: 2px;\n}\n\n.graphdialog .name {\n    display: inline-block;\n    min-width: 60px;\n    min-height: 1.5em;\n    padding-left: 10px;\n}\n\n.graphdialog input,\n.graphdialog textarea,\n.graphdialog select {\n    margin: 3px;\n    min-width: 60px;\n    min-height: 1.5em;\n    background-color: black;\n    border: 0;\n    color: white;\n    padding-left: 10px;\n    outline: none;\n}\n\n.graphdialog textarea {\n\tmin-height: 150px;\n}\n\n.graphdialog button {\n    margin-top: 3px;\n    vertical-align: top;\n    background-color: #999;\n\tborder: 0;\n}\n\n.graphdialog button.rounded,\n.graphdialog input.rounded {\n    border-radius: 0 12px 12px 0;\n}\n\n.graphdialog .helper {\n    overflow: auto;\n    max-height: 200px;\n}\n\n.graphdialog .help-item {\n    padding-left: 10px;\n}\n\n.graphdialog .help-item:hover,\n.graphdialog .help-item.selected {\n    cursor: pointer;\n    background-color: white;\n    color: black;\n}\n\n.litegraph .dialog {\n    min-height: 0;\n}\n.litegraph .dialog .dialog-content {\ndisplay: block;\n}\n.litegraph .dialog .dialog-content .subgraph_property {\npadding: 5px;\n}\n.litegraph .dialog .dialog-footer {\nmargin: 0;\n}\n.litegraph .dialog .dialog-footer .subgraph_property {\nmargin-top: 0;\ndisplay: flex;\nalign-items: center;\npadding: 5px;\n}\n.litegraph .dialog .dialog-footer .subgraph_property .name {\nflex: 1;\n}\n.litegraph .graphdialog {\ndisplay: flex;\nalign-items: center;\nborder-radius: 20px;\npadding: 4px 10px;\nposition: fixed;\n}\n.litegraph .graphdialog .name {\npadding: 0;\nmin-height: 0;\nfont-size: 16px;\nvertical-align: middle;\n}\n.litegraph .graphdialog .value {\nfont-size: 16px;\nmin-height: 0;\nmargin: 0 10px;\npadding: 2px 5px;\n}\n.litegraph .graphdialog input[type=\"checkbox\"] {\nwidth: 16px;\nheight: 16px;\n}\n.litegraph .graphdialog button {\npadding: 4px 18px;\nborder-radius: 20px;\ncursor: pointer;\n}\n  \n`, \"\",{\"version\":3,\"sources\":[\"webpack://./node_modules/litegraph.js/css/litegraph.css\"],\"names\":[],\"mappings\":\"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B,eAAe;IACf,iBAAiB;IACjB,kBAAkB;AACtB;;AAEA;;;IAGI,WAAW;IACX,eAAe;IACf,iBAAiB;IACjB,uBAAuB;IACvB,SAAS;IACT,YAAY;IACZ,kBAAkB;IAClB,aAAa;AACjB;;AAEA;CACC,iBAAiB;AAClB;;AAEA;IACI,eAAe;IACf,mBAAmB;IACnB,sBAAsB;CACzB,SAAS;AACV;;AAEA;;IAEI,4BAA4B;AAChC;;AAEA;IACI,cAAc;IACd,iBAAiB;AACrB;;AAEA;IACI,kBAAkB;AACtB;;AAEA;;IAEI,eAAe;IACf,uBAAuB;IACvB,YAAY;AAChB;;AAEA;IACI,aAAa;AACjB;AACA;AACA,cAAc;AACd;AACA;AACA,YAAY;AACZ;AACA;AACA,SAAS;AACT;AACA;AACA,aAAa;AACb,aAAa;AACb,mBAAmB;AACnB,YAAY;AACZ;AACA;AACA,OAAO;AACP;AACA;AACA,aAAa;AACb,mBAAmB;AACnB,mBAAmB;AACnB,iBAAiB;AACjB,eAAe;AACf;AACA;AACA,UAAU;AACV,aAAa;AACb,eAAe;AACf,sBAAsB;AACtB;AACA;AACA,eAAe;AACf,aAAa;AACb,cAAc;AACd,gBAAgB;AAChB;AACA;AACA,WAAW;AACX,YAAY;AACZ;AACA;AACA,iBAAiB;AACjB,mBAAmB;AACnB,eAAe;AACf\",\"sourcesContent\":[\"/* this CSS contains only the basic CSS needed to run the app and use it */\\n\\n.lgraphcanvas {\\n    /*cursor: crosshair;*/\\n    user-select: none;\\n    -moz-user-select: none;\\n    -webkit-user-select: none;\\n\\toutline: none;\\n    font-family: Tahoma, sans-serif;\\n}\\n\\n.lgraphcanvas * {\\n    box-sizing: border-box;\\n}\\n\\n.litegraph.litecontextmenu {\\n    font-family: Tahoma, sans-serif;\\n    position: fixed;\\n    top: 100px;\\n    left: 100px;\\n    min-width: 100px;\\n    color: #aaf;\\n    padding: 0;\\n    box-shadow: 0 0 10px black !important;\\n    background-color: #2e2e2e !important;\\n\\tz-index: 10;\\n}\\n\\n.litegraph.litecontextmenu.dark {\\n    background-color: #000 !important;\\n}\\n\\n.litegraph.litecontextmenu .litemenu-title img {\\n    margin-top: 2px;\\n    margin-left: 2px;\\n    margin-right: 4px;\\n}\\n\\n.litegraph.litecontextmenu .litemenu-entry {\\n    margin: 2px;\\n    padding: 2px;\\n}\\n\\n.litegraph.litecontextmenu .litemenu-entry.submenu {\\n    background-color: #2e2e2e !important;\\n}\\n\\n.litegraph.litecontextmenu.dark .litemenu-entry.submenu {\\n    background-color: #000 !important;\\n}\\n\\n.litegraph .litemenubar ul {\\n    font-family: Tahoma, sans-serif;\\n    margin: 0;\\n    padding: 0;\\n}\\n\\n.litegraph .litemenubar li {\\n    font-size: 14px;\\n    color: #999;\\n    display: inline-block;\\n    min-width: 50px;\\n    padding-left: 10px;\\n    padding-right: 10px;\\n    user-select: none;\\n    -moz-user-select: none;\\n    -webkit-user-select: none;\\n    cursor: pointer;\\n}\\n\\n.litegraph .litemenubar li:hover {\\n    background-color: #777;\\n    color: #eee;\\n}\\n\\n.litegraph .litegraph .litemenubar-panel {\\n    position: absolute;\\n    top: 5px;\\n    left: 5px;\\n    min-width: 100px;\\n    background-color: #444;\\n    box-shadow: 0 0 3px black;\\n    padding: 4px;\\n    border-bottom: 2px solid #aaf;\\n    z-index: 10;\\n}\\n\\n.litegraph .litemenu-entry,\\n.litemenu-title {\\n    font-size: 12px;\\n    color: #aaa;\\n    padding: 0 0 0 4px;\\n    margin: 2px;\\n    padding-left: 2px;\\n    -moz-user-select: none;\\n    -webkit-user-select: none;\\n    user-select: none;\\n    cursor: pointer;\\n}\\n\\n.litegraph .litemenu-entry .icon {\\n    display: inline-block;\\n    width: 12px;\\n    height: 12px;\\n    margin: 2px;\\n    vertical-align: top;\\n}\\n\\n.litegraph .litemenu-entry.checked .icon {\\n    background-color: #aaf;\\n}\\n\\n.litegraph .litemenu-entry .more {\\n    float: right;\\n    padding-right: 5px;\\n}\\n\\n.litegraph .litemenu-entry.disabled {\\n    opacity: 0.5;\\n    cursor: default;\\n}\\n\\n.litegraph .litemenu-entry.separator {\\n    display: block;\\n    border-top: 1px solid #333;\\n    border-bottom: 1px solid #666;\\n    width: 100%;\\n    height: 0px;\\n    margin: 3px 0 2px 0;\\n    background-color: transparent;\\n    padding: 0 !important;\\n    cursor: default !important;\\n}\\n\\n.litegraph .litemenu-entry.has_submenu {\\n    border-right: 2px solid cyan;\\n}\\n\\n.litegraph .litemenu-title {\\n    color: #dde;\\n    background-color: #111;\\n    margin: 0;\\n    padding: 2px;\\n    cursor: default;\\n}\\n\\n.litegraph .litemenu-entry:hover:not(.disabled):not(.separator) {\\n    background-color: #444 !important;\\n    color: #eee;\\n    transition: all 0.2s;\\n}\\n\\n.litegraph .litemenu-entry .property_name {\\n    display: inline-block;\\n    text-align: left;\\n    min-width: 80px;\\n    min-height: 1.2em;\\n}\\n\\n.litegraph .litemenu-entry .property_value {\\n    display: inline-block;\\n    background-color: rgba(0, 0, 0, 0.5);\\n    text-align: right;\\n    min-width: 80px;\\n    min-height: 1.2em;\\n    vertical-align: middle;\\n    padding-right: 10px;\\n}\\n\\n.litegraph.litesearchbox {\\n    font-family: Tahoma, sans-serif;\\n    position: absolute;\\n    background-color: rgba(0, 0, 0, 0.5);\\n    padding-top: 4px;\\n}\\n\\n.litegraph.litesearchbox input,\\n.litegraph.litesearchbox select {\\n    margin-top: 3px;\\n    min-width: 60px;\\n    min-height: 1.5em;\\n    background-color: black;\\n    border: 0;\\n    color: white;\\n    padding-left: 10px;\\n    margin-right: 5px;\\n}\\n\\n.litegraph.litesearchbox .name {\\n    display: inline-block;\\n    min-width: 60px;\\n    min-height: 1.5em;\\n    padding-left: 10px;\\n}\\n\\n.litegraph.litesearchbox .helper {\\n    overflow: auto;\\n    max-height: 200px;\\n    margin-top: 2px;\\n}\\n\\n.litegraph.lite-search-item {\\n    font-family: Tahoma, sans-serif;\\n    background-color: rgba(0, 0, 0, 0.5);\\n    color: white;\\n    padding-top: 2px;\\n}\\n\\n.litegraph.lite-search-item.not_in_filter{\\n    /*background-color: rgba(50, 50, 50, 0.5);*/\\n    /*color: #999;*/\\n    color: #B99;\\n    font-style: italic;\\n}\\n\\n.litegraph.lite-search-item.generic_type{\\n    /*background-color: rgba(50, 50, 50, 0.5);*/\\n    /*color: #DD9;*/\\n    color: #999;\\n    font-style: italic;\\n}\\n\\n.litegraph.lite-search-item:hover,\\n.litegraph.lite-search-item.selected {\\n    cursor: pointer;\\n    background-color: white;\\n    color: black;\\n}\\n\\n/* DIALOGs ******/\\n\\n.litegraph .dialog {\\n    position: absolute;\\n    top: 50%;\\n    left: 50%;\\n    margin-top: -150px;\\n    margin-left: -200px;\\n\\n    background-color: #2A2A2A;\\n\\n    min-width: 400px;\\n    min-height: 200px;\\n\\tbox-shadow: 0 0 4px #111;\\n    border-radius: 6px;\\n}\\n\\n.litegraph .dialog.settings {\\n\\tleft: 10px;\\n\\ttop: 10px;\\n\\theight: calc( 100% - 20px );\\n\\tmargin: auto;\\n    max-width: 50%;\\n}\\n\\n.litegraph .dialog.centered {\\n    top: 50px;\\n    left: 50%;\\n    position: absolute;\\n    transform: translateX(-50%);\\n    min-width: 600px;\\n    min-height: 300px;\\n    height: calc( 100% - 100px );\\n\\tmargin: auto;\\n}\\n\\n.litegraph .dialog .close {\\n    float: right;\\n\\tmargin: 4px;\\n\\tmargin-right: 10px;\\n\\tcursor: pointer;\\n\\tfont-size: 1.4em;\\n}\\n\\n.litegraph .dialog .close:hover {\\n\\tcolor: white;\\n}\\n\\n.litegraph .dialog .dialog-header {\\n\\tcolor: #AAA;\\n\\tborder-bottom: 1px solid #161616;\\n}\\n\\n.litegraph .dialog .dialog-header { height: 40px; }\\n.litegraph .dialog .dialog-footer { height: 50px; padding: 10px; border-top: 1px solid #1a1a1a;}\\n\\n.litegraph .dialog .dialog-header .dialog-title {\\n    font: 20px \\\"Arial\\\";\\n    margin: 4px;\\n    padding: 4px 10px;\\n    display: inline-block;\\n}\\n\\n.litegraph .dialog .dialog-content, .litegraph .dialog .dialog-alt-content {\\n    height: calc(100% - 90px);\\n    width: 100%;\\n\\tmin-height: 100px;\\n    display: inline-block;\\n\\tcolor: #AAA;\\n    /*background-color: black;*/\\n    overflow: auto;\\n}\\n\\n.litegraph .dialog .dialog-content h3 {\\n\\tmargin: 10px;\\n}\\n\\n.litegraph .dialog .dialog-content .connections {\\n\\tflex-direction: row;\\n}\\n\\n.litegraph .dialog .dialog-content .connections .connections_side {\\n\\twidth: calc(50% - 5px);\\n\\tmin-height: 100px;\\n\\tbackground-color: black;\\n\\tdisplay: flex;\\n}\\n\\n.litegraph .dialog .node_type {\\n\\tfont-size: 1.2em;\\n\\tdisplay: block;\\n\\tmargin: 10px;\\n}\\n\\n.litegraph .dialog .node_desc {\\n\\topacity: 0.5;\\n\\tdisplay: block;\\n\\tmargin: 10px;\\n}\\n\\n.litegraph .dialog .separator {\\n\\tdisplay: block;\\n\\twidth: calc( 100% - 4px );\\n\\theight: 1px;\\n\\tborder-top: 1px solid #000;\\n\\tborder-bottom: 1px solid #333;\\n\\tmargin: 10px 2px;\\n\\tpadding: 0;\\n}\\n\\n.litegraph .dialog .property {\\n\\tmargin-bottom: 2px;\\n\\tpadding: 4px;\\n}\\n\\n.litegraph .dialog .property:hover {\\n\\tbackground: #545454;\\n}\\n\\n.litegraph .dialog .property_name {\\n\\tcolor: #737373;\\n    display: inline-block;\\n    text-align: left;\\n    vertical-align: top;\\n    width: 160px;\\n\\tpadding-left: 4px;\\n\\toverflow: hidden;\\n    margin-right: 6px;\\n}\\n\\n.litegraph .dialog .property:hover .property_name {\\n    color: white;\\n}\\n\\n.litegraph .dialog .property_value {\\n    display: inline-block;\\n    text-align: right;\\n\\tcolor: #AAA;\\n\\tbackground-color: #1A1A1A;\\n    /*width: calc( 100% - 122px );*/\\n    max-width: calc( 100% - 162px );\\n    min-width: 200px;\\n\\tmax-height: 300px;\\n    min-height: 20px;\\n    padding: 4px;\\n\\tpadding-right: 12px;\\n\\toverflow: hidden;\\n\\tcursor: pointer;\\n\\tborder-radius: 3px;\\n}\\n\\n.litegraph .dialog .property_value:hover {\\n\\tcolor: white;\\n}\\n\\n.litegraph .dialog .property.boolean .property_value {\\n\\tpadding-right: 30px;\\n    color: #A88;\\n    /*width: auto;\\n    float: right;*/\\n}\\n\\n.litegraph .dialog .property.boolean.bool-on .property_name{\\n    color: #8A8;\\n}\\n.litegraph .dialog .property.boolean.bool-on .property_value{\\n    color: #8A8;\\n}\\n\\n.litegraph .dialog .btn {\\n\\tborder: 0;\\n\\tborder-radius: 4px;\\n    padding: 4px 20px;\\n    margin-left: 0px;\\n    background-color: #060606;\\n    color: #8e8e8e;\\n}\\n\\n.litegraph .dialog .btn:hover {\\n    background-color: #111;\\n    color: #FFF;\\n}\\n\\n.litegraph .dialog .btn.delete:hover {\\n    background-color: #F33;\\n    color: black;\\n}\\n\\n.litegraph .subgraph_property {\\n\\tpadding: 4px;\\n}\\n\\n.litegraph .subgraph_property:hover {\\n\\tbackground-color: #333;\\n}\\n\\n.litegraph .subgraph_property.extra {\\n    margin-top: 8px;\\n}\\n\\n.litegraph .subgraph_property span.name {\\n\\tfont-size: 1.3em;\\n\\tpadding-left: 4px;\\n}\\n\\n.litegraph .subgraph_property span.type {\\n\\topacity: 0.5;\\n\\tmargin-right: 20px;\\n\\tpadding-left: 4px;\\n}\\n\\n.litegraph .subgraph_property span.label {\\n\\tdisplay: inline-block;\\n\\twidth: 60px;\\n\\tpadding:  0px 10px;\\n}\\n\\n.litegraph .subgraph_property input {\\n\\twidth: 140px;\\n\\tcolor: #999;\\n\\tbackground-color: #1A1A1A;\\n\\tborder-radius: 4px;\\n\\tborder: 0;\\n\\tmargin-right: 10px;\\n\\tpadding: 4px;\\n\\tpadding-left: 10px;\\n}\\n\\n.litegraph .subgraph_property button {\\n\\tbackground-color: #1c1c1c;\\n\\tcolor: #aaa;\\n\\tborder: 0;\\n\\tborder-radius: 2px;\\n\\tpadding: 4px 10px;\\n\\tcursor: pointer;\\n}\\n\\n.litegraph .subgraph_property.extra {\\n\\tcolor: #ccc;\\n}\\n\\n.litegraph .subgraph_property.extra input {\\n\\tbackground-color: #111;\\n}\\n\\n.litegraph .bullet_icon {\\n\\tmargin-left: 10px;\\n\\tborder-radius: 10px;\\n\\twidth: 12px;\\n\\theight: 12px;\\n\\tbackground-color: #666;\\n\\tdisplay: inline-block;\\n\\tmargin-top: 2px;\\n\\tmargin-right: 4px;\\n    transition: background-color 0.1s ease 0s;\\n    -moz-transition: background-color 0.1s ease 0s;\\n}\\n\\n.litegraph .bullet_icon:hover {\\n\\tbackground-color: #698;\\n\\tcursor: pointer;\\n} \\n\\n/* OLD */\\n\\n.graphcontextmenu {\\n    padding: 4px;\\n    min-width: 100px;\\n}\\n\\n.graphcontextmenu-title {\\n    color: #dde;\\n    background-color: #222;\\n    margin: 0;\\n    padding: 2px;\\n    cursor: default;\\n}\\n\\n.graphmenu-entry {\\n    box-sizing: border-box;\\n    margin: 2px;\\n    padding-left: 20px;\\n    user-select: none;\\n    -moz-user-select: none;\\n    -webkit-user-select: none;\\n    transition: all linear 0.3s;\\n}\\n\\n.graphmenu-entry.event,\\n.litemenu-entry.event {\\n    border-left: 8px solid orange;\\n    padding-left: 12px;\\n}\\n\\n.graphmenu-entry.disabled {\\n    opacity: 0.3;\\n}\\n\\n.graphmenu-entry.submenu {\\n    border-right: 2px solid #eee;\\n}\\n\\n.graphmenu-entry:hover {\\n    background-color: #555;\\n}\\n\\n.graphmenu-entry.separator {\\n    background-color: #111;\\n    border-bottom: 1px solid #666;\\n    height: 1px;\\n    width: calc(100% - 20px);\\n    -moz-width: calc(100% - 20px);\\n    -webkit-width: calc(100% - 20px);\\n}\\n\\n.graphmenu-entry .property_name {\\n    display: inline-block;\\n    text-align: left;\\n    min-width: 80px;\\n    min-height: 1.2em;\\n}\\n\\n.graphmenu-entry .property_value,\\n.litemenu-entry .property_value {\\n    display: inline-block;\\n    background-color: rgba(0, 0, 0, 0.5);\\n    text-align: right;\\n    min-width: 80px;\\n    min-height: 1.2em;\\n    vertical-align: middle;\\n    padding-right: 10px;\\n}\\n\\n.graphdialog {\\n    position: absolute;\\n    top: 10px;\\n    left: 10px;\\n    min-height: 2em;\\n    background-color: #333;\\n    font-size: 1.2em;\\n    box-shadow: 0 0 10px black !important;\\n\\tz-index: 10;\\n}\\n\\n.graphdialog.rounded {\\n    border-radius: 12px;\\n    padding-right: 2px;\\n}\\n\\n.graphdialog .name {\\n    display: inline-block;\\n    min-width: 60px;\\n    min-height: 1.5em;\\n    padding-left: 10px;\\n}\\n\\n.graphdialog input,\\n.graphdialog textarea,\\n.graphdialog select {\\n    margin: 3px;\\n    min-width: 60px;\\n    min-height: 1.5em;\\n    background-color: black;\\n    border: 0;\\n    color: white;\\n    padding-left: 10px;\\n    outline: none;\\n}\\n\\n.graphdialog textarea {\\n\\tmin-height: 150px;\\n}\\n\\n.graphdialog button {\\n    margin-top: 3px;\\n    vertical-align: top;\\n    background-color: #999;\\n\\tborder: 0;\\n}\\n\\n.graphdialog button.rounded,\\n.graphdialog input.rounded {\\n    border-radius: 0 12px 12px 0;\\n}\\n\\n.graphdialog .helper {\\n    overflow: auto;\\n    max-height: 200px;\\n}\\n\\n.graphdialog .help-item {\\n    padding-left: 10px;\\n}\\n\\n.graphdialog .help-item:hover,\\n.graphdialog .help-item.selected {\\n    cursor: pointer;\\n    background-color: white;\\n    color: black;\\n}\\n\\n.litegraph .dialog {\\n    min-height: 0;\\n}\\n.litegraph .dialog .dialog-content {\\ndisplay: block;\\n}\\n.litegraph .dialog .dialog-content .subgraph_property {\\npadding: 5px;\\n}\\n.litegraph .dialog .dialog-footer {\\nmargin: 0;\\n}\\n.litegraph .dialog .dialog-footer .subgraph_property {\\nmargin-top: 0;\\ndisplay: flex;\\nalign-items: center;\\npadding: 5px;\\n}\\n.litegraph .dialog .dialog-footer .subgraph_property .name {\\nflex: 1;\\n}\\n.litegraph .graphdialog {\\ndisplay: flex;\\nalign-items: center;\\nborder-radius: 20px;\\npadding: 4px 10px;\\nposition: fixed;\\n}\\n.litegraph .graphdialog .name {\\npadding: 0;\\nmin-height: 0;\\nfont-size: 16px;\\nvertical-align: middle;\\n}\\n.litegraph .graphdialog .value {\\nfont-size: 16px;\\nmin-height: 0;\\nmargin: 0 10px;\\npadding: 2px 5px;\\n}\\n.litegraph .graphdialog input[type=\\\"checkbox\\\"] {\\nwidth: 16px;\\nheight: 16px;\\n}\\n.litegraph .graphdialog button {\\npadding: 4px 18px;\\nborder-radius: 20px;\\ncursor: pointer;\\n}\\n  \\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","//packer version\n\n\n(function(global) {\n    // *************************************************************\n    //   LiteGraph CLASS                                     *******\n    // *************************************************************\n\n    /**\n     * The Global Scope. It contains all the registered node classes.\n     *\n     * @class LiteGraph\n     * @constructor\n     */\n\n    var LiteGraph = (global.LiteGraph = {\n        VERSION: 0.4,\n\n        CANVAS_GRID_SIZE: 10,\n\n        NODE_TITLE_HEIGHT: 30,\n        NODE_TITLE_TEXT_Y: 20,\n        NODE_SLOT_HEIGHT: 20,\n        NODE_WIDGET_HEIGHT: 20,\n        NODE_WIDTH: 140,\n        NODE_MIN_WIDTH: 50,\n        NODE_COLLAPSED_RADIUS: 10,\n        NODE_COLLAPSED_WIDTH: 80,\n        NODE_TITLE_COLOR: \"#999\",\n        NODE_SELECTED_TITLE_COLOR: \"#FFF\",\n        NODE_TEXT_SIZE: 14,\n        NODE_TEXT_COLOR: \"#AAA\",\n        NODE_SUBTEXT_SIZE: 12,\n        NODE_DEFAULT_COLOR: \"#333\",\n        NODE_DEFAULT_BGCOLOR: \"#353535\",\n        NODE_DEFAULT_BOXCOLOR: \"#666\",\n        NODE_DEFAULT_SHAPE: \"box\",\n        NODE_BOX_OUTLINE_COLOR: \"#FFF\",\n        DEFAULT_SHADOW_COLOR: \"rgba(0,0,0,0.5)\",\n        DEFAULT_GROUP_FONT: 24,\n\n        WIDGET_BGCOLOR: \"#222\",\n        WIDGET_OUTLINE_COLOR: \"#666\",\n        WIDGET_TEXT_COLOR: \"#DDD\",\n        WIDGET_SECONDARY_TEXT_COLOR: \"#999\",\n\n        LINK_COLOR: \"#9A9\",\n        EVENT_LINK_COLOR: \"#A86\",\n        CONNECTING_LINK_COLOR: \"#AFA\",\n\n        MAX_NUMBER_OF_NODES: 1000, //avoid infinite loops\n        DEFAULT_POSITION: [100, 100], //default node position\n        VALID_SHAPES: [\"default\", \"box\", \"round\", \"card\"], //,\"circle\"\n\n        //shapes are used for nodes but also for slots\n        BOX_SHAPE: 1,\n        ROUND_SHAPE: 2,\n        CIRCLE_SHAPE: 3,\n        CARD_SHAPE: 4,\n        ARROW_SHAPE: 5,\n        GRID_SHAPE: 6, // intended for slot arrays\n\n        //enums\n        INPUT: 1,\n        OUTPUT: 2,\n\n        EVENT: -1, //for outputs\n        ACTION: -1, //for inputs\n\n        NODE_MODES: [\"Always\", \"On Event\", \"Never\", \"On Trigger\"], // helper, will add \"On Request\" and more in the future\n        NODE_MODES_COLORS:[\"#666\",\"#422\",\"#333\",\"#224\",\"#626\"], // use with node_box_coloured_by_mode\n        ALWAYS: 0,\n        ON_EVENT: 1,\n        NEVER: 2,\n        ON_TRIGGER: 3,\n\n        UP: 1,\n        DOWN: 2,\n        LEFT: 3,\n        RIGHT: 4,\n        CENTER: 5,\n\n        LINK_RENDER_MODES: [\"Straight\", \"Linear\", \"Spline\"], // helper\n        STRAIGHT_LINK: 0,\n        LINEAR_LINK: 1,\n        SPLINE_LINK: 2,\n\n        NORMAL_TITLE: 0,\n        NO_TITLE: 1,\n        TRANSPARENT_TITLE: 2,\n        AUTOHIDE_TITLE: 3,\n        VERTICAL_LAYOUT: \"vertical\", // arrange nodes vertically\n\n        proxy: null, //used to redirect calls\n        node_images_path: \"\",\n\n        debug: false,\n        catch_exceptions: true,\n        throw_errors: true,\n        allow_scripts: false, //if set to true some nodes like Formula would be allowed to evaluate code that comes from unsafe sources (like node configuration), which could lead to exploits\n        use_deferred_actions: true, //executes actions during the graph execution flow\n        registered_node_types: {}, //nodetypes by string\n        node_types_by_file_extension: {}, //used for dropping files in the canvas\n        Nodes: {}, //node types by classname\n\t\tGlobals: {}, //used to store vars between graphs\n\n        searchbox_extras: {}, //used to add extra features to the search box\n        auto_sort_node_types: false, // [true!] If set to true, will automatically sort node types / categories in the context menus\n\t\t\n\t\tnode_box_coloured_when_on: false, // [true!] this make the nodes box (top left circle) coloured when triggered (execute/action), visual feedback\n        node_box_coloured_by_mode: false, // [true!] nodebox based on node mode, visual feedback\n        \n        dialog_close_on_mouse_leave: true, // [false on mobile] better true if not touch device, TODO add an helper/listener to close if false\n        dialog_close_on_mouse_leave_delay: 500,\n        \n        shift_click_do_break_link_from: false, // [false!] prefer false if results too easy to break links - implement with ALT or TODO custom keys\n        click_do_break_link_to: false, // [false!]prefer false, way too easy to break links\n        \n        search_hide_on_mouse_leave: true, // [false on mobile] better true if not touch device, TODO add an helper/listener to close if false\n        search_filter_enabled: false, // [true!] enable filtering slots type in the search widget, !requires auto_load_slot_types or manual set registered_slot_[in/out]_types and slot_types_[in/out]\n        search_show_all_on_open: true, // [true!] opens the results list when opening the search widget\n        \n        auto_load_slot_types: false, // [if want false, use true, run, get vars values to be statically set, than disable] nodes types and nodeclass association with node types need to be calculated, if dont want this, calculate once and set registered_slot_[in/out]_types and slot_types_[in/out]\n        \n\t\t// set these values if not using auto_load_slot_types\n        registered_slot_in_types: {}, // slot types for nodeclass\n        registered_slot_out_types: {}, // slot types for nodeclass\n        slot_types_in: [], // slot types IN\n        slot_types_out: [], // slot types OUT\n        slot_types_default_in: [], // specify for each IN slot type a(/many) default node(s), use single string, array, or object (with node, title, parameters, ..) like for search\n\t\tslot_types_default_out: [], // specify for each OUT slot type a(/many) default node(s), use single string, array, or object (with node, title, parameters, ..) like for search\n\t\t\n\t\talt_drag_do_clone_nodes: false, // [true!] very handy, ALT click to clone and drag the new node\n\n\t\tdo_add_triggers_slots: false, // [true!] will create and connect event slots when using action/events connections, !WILL CHANGE node mode when using onTrigger (enable mode colors), onExecuted does not need this\n\t\t\n\t\tallow_multi_output_for_events: true, // [false!] being events, it is strongly reccomended to use them sequentially, one by one\n\n\t\tmiddle_click_slot_add_default_node: false, //[true!] allows to create and connect a ndoe clicking with the third button (wheel)\n\t\t\n\t\trelease_link_on_empty_shows_menu: false, //[true!] dragging a link to empty space will open a menu, add from list, search or defaults\n\t\t\n        pointerevents_method: \"mouse\", // \"mouse\"|\"pointer\" use mouse for retrocompatibility issues? (none found @ now)\n        // TODO implement pointercancel, gotpointercapture, lostpointercapture, (pointerover, pointerout if necessary)\n\n        ctrl_shift_v_paste_connect_unselected_outputs: false, //[true!] allows ctrl + shift + v to paste nodes with the outputs of the unselected nodes connected with the inputs of the newly pasted nodes\n\n        // if true, all newly created nodes/links will use string UUIDs for their id fields instead of integers.\n        // use this if you must have node IDs that are unique across all graphs and subgraphs.\n        use_uuids: false,\n\n        /**\n         * Register a node class so it can be listed when the user wants to create a new one\n         * @method registerNodeType\n         * @param {String} type name of the node and path\n         * @param {Class} base_class class containing the structure of a node\n         */\n\n        registerNodeType: function(type, base_class) {\n            if (!base_class.prototype) {\n                throw \"Cannot register a simple object, it must be a class with a prototype\";\n            }\n            base_class.type = type;\n\n            if (LiteGraph.debug) {\n                console.log(\"Node registered: \" + type);\n            }\n\n            const classname = base_class.name;\n\n            const pos = type.lastIndexOf(\"/\");\n            base_class.category = type.substring(0, pos);\n\n            if (!base_class.title) {\n                base_class.title = classname;\n            }\n\n            //extend class\n            for (var i in LGraphNode.prototype) {\n                if (!base_class.prototype[i]) {\n                    base_class.prototype[i] = LGraphNode.prototype[i];\n                }\n            }\n\n            const prev = this.registered_node_types[type];\n            if(prev) {\n                console.log(\"replacing node type: \" + type);\n            }\n            if( !Object.prototype.hasOwnProperty.call( base_class.prototype, \"shape\") ) {\n                Object.defineProperty(base_class.prototype, \"shape\", {\n                    set: function(v) {\n                        switch (v) {\n                            case \"default\":\n                                delete this._shape;\n                                break;\n                            case \"box\":\n                                this._shape = LiteGraph.BOX_SHAPE;\n                                break;\n                            case \"round\":\n                                this._shape = LiteGraph.ROUND_SHAPE;\n                                break;\n                            case \"circle\":\n                                this._shape = LiteGraph.CIRCLE_SHAPE;\n                                break;\n                            case \"card\":\n                                this._shape = LiteGraph.CARD_SHAPE;\n                                break;\n                            default:\n                                this._shape = v;\n                        }\n                    },\n                    get: function() {\n                        return this._shape;\n                    },\n                    enumerable: true,\n                    configurable: true\n                });\n                \n\n                //used to know which nodes to create when dragging files to the canvas\n                if (base_class.supported_extensions) {\n                    for (let i in base_class.supported_extensions) {\n                        const ext = base_class.supported_extensions[i];\n                        if(ext && ext.constructor === String) {\n                            this.node_types_by_file_extension[ ext.toLowerCase() ] = base_class;\n                        }\n                    }\n                }\n            }\n\n            this.registered_node_types[type] = base_class;\n            if (base_class.constructor.name) {\n                this.Nodes[classname] = base_class;\n            }\n            if (LiteGraph.onNodeTypeRegistered) {\n                LiteGraph.onNodeTypeRegistered(type, base_class);\n            }\n            if (prev && LiteGraph.onNodeTypeReplaced) {\n                LiteGraph.onNodeTypeReplaced(type, base_class, prev);\n            }\n\n            //warnings\n            if (base_class.prototype.onPropertyChange) {\n                console.warn(\n                    \"LiteGraph node class \" +\n                        type +\n                        \" has onPropertyChange method, it must be called onPropertyChanged with d at the end\"\n                );\n            }\n            \n            // TODO one would want to know input and ouput :: this would allow through registerNodeAndSlotType to get all the slots types\n            if (this.auto_load_slot_types) {\n                new base_class(base_class.title || \"tmpnode\");\n            }\n        },\n\n        /**\n         * removes a node type from the system\n         * @method unregisterNodeType\n         * @param {String|Object} type name of the node or the node constructor itself\n         */\n        unregisterNodeType: function(type) {\n            const base_class =\n                type.constructor === String\n                    ? this.registered_node_types[type]\n                    : type;\n            if (!base_class) {\n                throw \"node type not found: \" + type;\n            }\n            delete this.registered_node_types[base_class.type];\n            if (base_class.constructor.name) {\n                delete this.Nodes[base_class.constructor.name];\n            }\n        },\n\n        /**\n        * Save a slot type and his node\n        * @method registerSlotType\n        * @param {String|Object} type name of the node or the node constructor itself\n        * @param {String} slot_type name of the slot type (variable type), eg. string, number, array, boolean, ..\n        */\n        registerNodeAndSlotType: function(type, slot_type, out){\n            out = out || false;\n            const base_class =\n                type.constructor === String &&\n                this.registered_node_types[type] !== \"anonymous\"\n                    ? this.registered_node_types[type]\n                    : type;\n\n            const class_type = base_class.constructor.type;\n\n            let allTypes = [];\n            if (typeof slot_type === \"string\") {\n                allTypes = slot_type.split(\",\");\n            } else if (slot_type == this.EVENT || slot_type == this.ACTION) {\n                allTypes = [\"_event_\"];\n            } else {\n                allTypes = [\"*\"];\n            }\n\n            for (let i = 0; i < allTypes.length; ++i) {\n                let slotType = allTypes[i];\n                if (slotType === \"\") {\n                    slotType = \"*\";\n                }\n                const registerTo = out\n                    ? \"registered_slot_out_types\"\n                    : \"registered_slot_in_types\";\n                if (this[registerTo][slotType] === undefined) {\n                    this[registerTo][slotType] = { nodes: [] };\n                }\n                if (!this[registerTo][slotType].nodes.includes(class_type)) {\n                    this[registerTo][slotType].nodes.push(class_type);\n                }\n\n                // check if is a new type\n                if (!out) {\n                    if (!this.slot_types_in.includes(slotType.toLowerCase())) {\n                        this.slot_types_in.push(slotType.toLowerCase());\n                        this.slot_types_in.sort();\n                    }\n                } else {\n                    if (!this.slot_types_out.includes(slotType.toLowerCase())) {\n                        this.slot_types_out.push(slotType.toLowerCase());\n                        this.slot_types_out.sort();\n                    }\n                }\n            }\n        },\n        \n        /**\n         * Create a new nodetype by passing an object with some properties\n         * like onCreate, inputs:Array, outputs:Array, properties, onExecute\n         * @method buildNodeClassFromObject\n         * @param {String} name node name with namespace (p.e.: 'math/sum')\n         * @param {Object} object methods expected onCreate, inputs, outputs, properties, onExecute\n         */\n         buildNodeClassFromObject: function(\n            name,\n            object\n        ) {\n            var ctor_code = \"\";\n            if(object.inputs)\n            for(var i=0; i < object.inputs.length; ++i)\n            {\n                var _name = object.inputs[i][0];\n                var _type = object.inputs[i][1];\n                if(_type && _type.constructor === String)\n                    _type = '\"'+_type+'\"';\n                ctor_code += \"this.addInput('\"+_name+\"',\"+_type+\");\\n\";\n            }\n            if(object.outputs)\n            for(var i=0; i < object.outputs.length; ++i)\n            {\n                var _name = object.outputs[i][0];\n                var _type = object.outputs[i][1];\n                if(_type && _type.constructor === String)\n                    _type = '\"'+_type+'\"';\n                ctor_code += \"this.addOutput('\"+_name+\"',\"+_type+\");\\n\";\n            }\n            if(object.properties)\n            for(var i in object.properties)\n            {\n                var prop = object.properties[i];\n                if(prop && prop.constructor === String)\n                    prop = '\"'+prop+'\"';\n                ctor_code += \"this.addProperty('\"+i+\"',\"+prop+\");\\n\";\n            }\n            ctor_code += \"if(this.onCreate)this.onCreate()\";\n            var classobj = Function(ctor_code);\n            for(var i in object)\n                if(i!=\"inputs\" && i!=\"outputs\" && i!=\"properties\")\n                    classobj.prototype[i] = object[i];\n            classobj.title = object.title || name.split(\"/\").pop();\n            classobj.desc = object.desc || \"Generated from object\";\n            this.registerNodeType(name, classobj);\n            return classobj;\n        },\n        \n        /**\n         * Create a new nodetype by passing a function, it wraps it with a proper class and generates inputs according to the parameters of the function.\n         * Useful to wrap simple methods that do not require properties, and that only process some input to generate an output.\n         * @method wrapFunctionAsNode\n         * @param {String} name node name with namespace (p.e.: 'math/sum')\n         * @param {Function} func\n         * @param {Array} param_types [optional] an array containing the type of every parameter, otherwise parameters will accept any type\n         * @param {String} return_type [optional] string with the return type, otherwise it will be generic\n         * @param {Object} properties [optional] properties to be configurable\n         */\n        wrapFunctionAsNode: function(\n            name,\n            func,\n            param_types,\n            return_type,\n            properties\n        ) {\n            var params = Array(func.length);\n            var code = \"\";\n            if(param_types !== null) //null means no inputs\n            {\n                var names = LiteGraph.getParameterNames(func);\n                for (var i = 0; i < names.length; ++i) {\n                    var type = 0;\n                    if(param_types)\n                    {\n                        //type = param_types[i] != null ? \"'\" + param_types[i] + \"'\" : \"0\";\n                        if( param_types[i] != null && param_types[i].constructor === String )\n                            type = \"'\" + param_types[i] + \"'\" ;\n                        else if( param_types[i] != null )\n                            type = param_types[i];\n                    } \n                    code +=\n                        \"this.addInput('\" +\n                        names[i] +\n                        \"',\" +\n                        type +\n                        \");\\n\";\n                }\n            }\n            if(return_type !== null) //null means no output\n            code +=\n                \"this.addOutput('out',\" +\n                (return_type != null ? (return_type.constructor === String ? \"'\" + return_type + \"'\" : return_type) : 0) +\n                \");\\n\";\n            if (properties) {\n                code +=\n                    \"this.properties = \" + JSON.stringify(properties) + \";\\n\";\n            }\n            var classobj = Function(code);\n            classobj.title = name.split(\"/\").pop();\n            classobj.desc = \"Generated from \" + func.name;\n            classobj.prototype.onExecute = function onExecute() {\n                for (var i = 0; i < params.length; ++i) {\n                    params[i] = this.getInputData(i);\n                }\n                var r = func.apply(this, params);\n                this.setOutputData(0, r);\n            };\n            this.registerNodeType(name, classobj);\n            return classobj;\n        },\n\n        /**\n         * Removes all previously registered node's types\n         */\n        clearRegisteredTypes: function() {\n            this.registered_node_types = {};\n            this.node_types_by_file_extension = {};\n            this.Nodes = {};\n            this.searchbox_extras = {};\n        },\n\n        /**\n         * Adds this method to all nodetypes, existing and to be created\n         * (You can add it to LGraphNode.prototype but then existing node types wont have it)\n         * @method addNodeMethod\n         * @param {Function} func\n         */\n        addNodeMethod: function(name, func) {\n            LGraphNode.prototype[name] = func;\n            for (var i in this.registered_node_types) {\n                var type = this.registered_node_types[i];\n                if (type.prototype[name]) {\n                    type.prototype[\"_\" + name] = type.prototype[name];\n                } //keep old in case of replacing\n                type.prototype[name] = func;\n            }\n        },\n\n        /**\n         * Create a node of a given type with a name. The node is not attached to any graph yet.\n         * @method createNode\n         * @param {String} type full name of the node class. p.e. \"math/sin\"\n         * @param {String} name a name to distinguish from other nodes\n         * @param {Object} options to set options\n         */\n\n        createNode: function(type, title, options) {\n            var base_class = this.registered_node_types[type];\n            if (!base_class) {\n                if (LiteGraph.debug) {\n                    console.log(\n                        'GraphNode type \"' + type + '\" not registered.'\n                    );\n                }\n                return null;\n            }\n\n            var prototype = base_class.prototype || base_class;\n\n            title = title || base_class.title || type;\n\n            var node = null;\n\n            if (LiteGraph.catch_exceptions) {\n                try {\n                    node = new base_class(title);\n                } catch (err) {\n                    console.error(err);\n                    return null;\n                }\n            } else {\n                node = new base_class(title);\n            }\n\n            node.type = type;\n\n            if (!node.title && title) {\n                node.title = title;\n            }\n            if (!node.properties) {\n                node.properties = {};\n            }\n            if (!node.properties_info) {\n                node.properties_info = [];\n            }\n            if (!node.flags) {\n                node.flags = {};\n            }\n            if (!node.size) {\n                node.size = node.computeSize();\n\t\t\t\t//call onresize?\n            }\n            if (!node.pos) {\n                node.pos = LiteGraph.DEFAULT_POSITION.concat();\n            }\n            if (!node.mode) {\n                node.mode = LiteGraph.ALWAYS;\n            }\n\n            //extra options\n            if (options) {\n                for (var i in options) {\n                    node[i] = options[i];\n                }\n            }\n\n\t\t\t// callback\n            if ( node.onNodeCreated ) {\n                node.onNodeCreated();\n            }\n            \n            return node;\n        },\n\n        /**\n         * Returns a registered node type with a given name\n         * @method getNodeType\n         * @param {String} type full name of the node class. p.e. \"math/sin\"\n         * @return {Class} the node class\n         */\n        getNodeType: function(type) {\n            return this.registered_node_types[type];\n        },\n\n        /**\n         * Returns a list of node types matching one category\n         * @method getNodeType\n         * @param {String} category category name\n         * @return {Array} array with all the node classes\n         */\n\n        getNodeTypesInCategory: function(category, filter) {\n            var r = [];\n            for (var i in this.registered_node_types) {\n                var type = this.registered_node_types[i];\n                if (type.filter != filter) {\n                    continue;\n                }\n\n                if (category == \"\") {\n                    if (type.category == null) {\n                        r.push(type);\n                    }\n                } else if (type.category == category) {\n                    r.push(type);\n                }\n            }\n\n            if (this.auto_sort_node_types) {\n                r.sort(function(a,b){return a.title.localeCompare(b.title)});\n            }\n\n            return r;\n        },\n\n        /**\n         * Returns a list with all the node type categories\n         * @method getNodeTypesCategories\n         * @param {String} filter only nodes with ctor.filter equal can be shown\n         * @return {Array} array with all the names of the categories\n         */\n        getNodeTypesCategories: function( filter ) {\n            var categories = { \"\": 1 };\n            for (var i in this.registered_node_types) {\n\t\t\t\tvar type = this.registered_node_types[i];\n                if ( type.category && !type.skip_list )\n                {\n\t\t\t\t\tif(type.filter != filter)\n\t\t\t\t\t\tcontinue;\n                    categories[type.category] = 1;\n                }\n            }\n            var result = [];\n            for (var i in categories) {\n                result.push(i);\n            }\n            return this.auto_sort_node_types ? result.sort() : result;\n        },\n\n        //debug purposes: reloads all the js scripts that matches a wildcard\n        reloadNodes: function(folder_wildcard) {\n            var tmp = document.getElementsByTagName(\"script\");\n            //weird, this array changes by its own, so we use a copy\n            var script_files = [];\n            for (var i=0; i < tmp.length; i++) {\n                script_files.push(tmp[i]);\n            }\n\n            var docHeadObj = document.getElementsByTagName(\"head\")[0];\n            folder_wildcard = document.location.href + folder_wildcard;\n\n            for (var i=0; i < script_files.length; i++) {\n                var src = script_files[i].src;\n                if (\n                    !src ||\n                    src.substr(0, folder_wildcard.length) != folder_wildcard\n                ) {\n                    continue;\n                }\n\n                try {\n                    if (LiteGraph.debug) {\n                        console.log(\"Reloading: \" + src);\n                    }\n                    var dynamicScript = document.createElement(\"script\");\n                    dynamicScript.type = \"text/javascript\";\n                    dynamicScript.src = src;\n                    docHeadObj.appendChild(dynamicScript);\n                    docHeadObj.removeChild(script_files[i]);\n                } catch (err) {\n                    if (LiteGraph.throw_errors) {\n                        throw err;\n                    }\n                    if (LiteGraph.debug) {\n                        console.log(\"Error while reloading \" + src);\n                    }\n                }\n            }\n\n            if (LiteGraph.debug) {\n                console.log(\"Nodes reloaded\");\n            }\n        },\n\n        //separated just to improve if it doesn't work\n        cloneObject: function(obj, target) {\n            if (obj == null) {\n                return null;\n            }\n            var r = JSON.parse(JSON.stringify(obj));\n            if (!target) {\n                return r;\n            }\n\n            for (var i in r) {\n                target[i] = r[i];\n            }\n            return target;\n        },\n\n        /*\n         * https://gist.github.com/jed/982883?permalink_comment_id=852670#gistcomment-852670\n         */\n        uuidv4: function() {\n            return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,a=>(a^Math.random()*16>>a/4).toString(16));\n        },\n\n        /**\n         * Returns if the types of two slots are compatible (taking into account wildcards, etc)\n         * @method isValidConnection\n         * @param {String} type_a\n         * @param {String} type_b\n         * @return {Boolean} true if they can be connected\n         */\n        isValidConnection: function(type_a, type_b) {\n\t\t\tif (type_a==\"\" || type_a===\"*\") type_a = 0;\n\t\t\tif (type_b==\"\" || type_b===\"*\") type_b = 0;\n            if (\n                !type_a //generic output\n                || !type_b // generic input\n                || type_a == type_b //same type (is valid for triggers)\n                || (type_a == LiteGraph.EVENT && type_b == LiteGraph.ACTION)\n            ) {\n                return true;\n            }\n\n            // Enforce string type to handle toLowerCase call (-1 number not ok)\n            type_a = String(type_a);\n            type_b = String(type_b);\n            type_a = type_a.toLowerCase();\n            type_b = type_b.toLowerCase();\n\n            // For nodes supporting multiple connection types\n            if (type_a.indexOf(\",\") == -1 && type_b.indexOf(\",\") == -1) {\n                return type_a == type_b;\n            }\n\n            // Check all permutations to see if one is valid\n            var supported_types_a = type_a.split(\",\");\n            var supported_types_b = type_b.split(\",\");\n            for (var i = 0; i < supported_types_a.length; ++i) {\n                for (var j = 0; j < supported_types_b.length; ++j) {\n                    if(this.isValidConnection(supported_types_a[i],supported_types_b[j])){\n\t\t\t\t\t//if (supported_types_a[i] == supported_types_b[j]) {\n                        return true;\n                    }\n                }\n            }\n\n            return false;\n        },\n\n        /**\n         * Register a string in the search box so when the user types it it will recommend this node\n         * @method registerSearchboxExtra\n         * @param {String} node_type the node recommended\n         * @param {String} description text to show next to it\n         * @param {Object} data it could contain info of how the node should be configured\n         * @return {Boolean} true if they can be connected\n         */\n        registerSearchboxExtra: function(node_type, description, data) {\n            this.searchbox_extras[description.toLowerCase()] = {\n                type: node_type,\n                desc: description,\n                data: data\n            };\n        },\n\n        /**\n         * Wrapper to load files (from url using fetch or from file using FileReader)\n         * @method fetchFile\n         * @param {String|File|Blob} url the url of the file (or the file itself)\n         * @param {String} type an string to know how to fetch it: \"text\",\"arraybuffer\",\"json\",\"blob\"\n         * @param {Function} on_complete callback(data)\n         * @param {Function} on_error in case of an error\n         * @return {FileReader|Promise} returns the object used to \n         */\n\t\tfetchFile: function( url, type, on_complete, on_error ) {\n\t\t\tvar that = this;\n\t\t\tif(!url)\n\t\t\t\treturn null;\n\n\t\t\ttype = type || \"text\";\n\t\t\tif( url.constructor === String )\n\t\t\t{\n\t\t\t\tif (url.substr(0, 4) == \"http\" && LiteGraph.proxy) {\n\t\t\t\t\turl = LiteGraph.proxy + url.substr(url.indexOf(\":\") + 3);\n\t\t\t\t}\n\t\t\t\treturn fetch(url)\n\t\t\t\t.then(function(response) {\n\t\t\t\t\tif(!response.ok)\n\t\t\t\t\t\t throw new Error(\"File not found\"); //it will be catch below\n\t\t\t\t\tif(type == \"arraybuffer\")\n\t\t\t\t\t\treturn response.arrayBuffer();\n\t\t\t\t\telse if(type == \"text\" || type == \"string\")\n\t\t\t\t\t\treturn response.text();\n\t\t\t\t\telse if(type == \"json\")\n\t\t\t\t\t\treturn response.json();\n\t\t\t\t\telse if(type == \"blob\")\n\t\t\t\t\t\treturn response.blob();\n\t\t\t\t})\n\t\t\t\t.then(function(data) {\n\t\t\t\t\tif(on_complete)\n\t\t\t\t\t\ton_complete(data);\n\t\t\t\t})\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\tconsole.error(\"error fetching file:\",url);\n\t\t\t\t\tif(on_error)\n\t\t\t\t\t\ton_error(error);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if( url.constructor === File || url.constructor === Blob)\n\t\t\t{\n\t\t\t\tvar reader = new FileReader();\n\t\t\t\treader.onload = function(e)\n\t\t\t\t{\n\t\t\t\t\tvar v = e.target.result;\n\t\t\t\t\tif( type == \"json\" )\n\t\t\t\t\t\tv = JSON.parse(v);\n\t\t\t\t\tif(on_complete)\n\t\t\t\t\t\ton_complete(v);\n\t\t\t\t}\n\t\t\t\tif(type == \"arraybuffer\")\n\t\t\t\t\treturn reader.readAsArrayBuffer(url);\n\t\t\t\telse if(type == \"text\" || type == \"json\")\n\t\t\t\t\treturn reader.readAsText(url);\n\t\t\t\telse if(type == \"blob\")\n\t\t\t\t\treturn reader.readAsBinaryString(url);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n    });\n\n    //timer that works everywhere\n    if (typeof performance != \"undefined\") {\n        LiteGraph.getTime = performance.now.bind(performance);\n    } else if (typeof Date != \"undefined\" && Date.now) {\n        LiteGraph.getTime = Date.now.bind(Date);\n    } else if (typeof process != \"undefined\") {\n        LiteGraph.getTime = function() {\n            var t = process.hrtime();\n            return t[0] * 0.001 + t[1] * 1e-6;\n        };\n    } else {\n        LiteGraph.getTime = function getTime() {\n            return new Date().getTime();\n        };\n    }\n\n    //*********************************************************************************\n    // LGraph CLASS\n    //*********************************************************************************\n\n    /**\n     * LGraph is the class that contain a full graph. We instantiate one and add nodes to it, and then we can run the execution loop.\n\t * supported callbacks:\n\t\t+ onNodeAdded: when a new node is added to the graph\n\t\t+ onNodeRemoved: when a node inside this graph is removed\n\t\t+ onNodeConnectionChange: some connection has changed in the graph (connected or disconnected)\n     *\n     * @class LGraph\n     * @constructor\n     * @param {Object} o data from previous serialization [optional]\n     */\n\n    function LGraph(o) {\n        if (LiteGraph.debug) {\n            console.log(\"Graph created\");\n        }\n        this.list_of_graphcanvas = null;\n        this.clear();\n\n        if (o) {\n            this.configure(o);\n        }\n    }\n\n    global.LGraph = LiteGraph.LGraph = LGraph;\n\n    //default supported types\n    LGraph.supported_types = [\"number\", \"string\", \"boolean\"];\n\n    //used to know which types of connections support this graph (some graphs do not allow certain types)\n    LGraph.prototype.getSupportedTypes = function() {\n        return this.supported_types || LGraph.supported_types;\n    };\n\n    LGraph.STATUS_STOPPED = 1;\n    LGraph.STATUS_RUNNING = 2;\n\n    /**\n     * Removes all nodes from this graph\n     * @method clear\n     */\n\n    LGraph.prototype.clear = function() {\n        this.stop();\n        this.status = LGraph.STATUS_STOPPED;\n\n        this.last_node_id = 0;\n        this.last_link_id = 0;\n\n        this._version = -1; //used to detect changes\n\n        //safe clear\n        if (this._nodes) {\n            for (var i = 0; i < this._nodes.length; ++i) {\n                var node = this._nodes[i];\n                if (node.onRemoved) {\n                    node.onRemoved();\n                }\n            }\n        }\n\n        //nodes\n        this._nodes = [];\n        this._nodes_by_id = {};\n        this._nodes_in_order = []; //nodes sorted in execution order\n        this._nodes_executable = null; //nodes that contain onExecute sorted in execution order\n\n        //other scene stuff\n        this._groups = [];\n\n        //links\n        this.links = {}; //container with all the links\n\n        //iterations\n        this.iteration = 0;\n\n        //custom data\n        this.config = {};\n\t\tthis.vars = {};\n\t\tthis.extra = {}; //to store custom data\n\n        //timing\n        this.globaltime = 0;\n        this.runningtime = 0;\n        this.fixedtime = 0;\n        this.fixedtime_lapse = 0.01;\n        this.elapsed_time = 0.01;\n        this.last_update_time = 0;\n        this.starttime = 0;\n\n        this.catch_errors = true;\n\n        this.nodes_executing = [];\n        this.nodes_actioning = [];\n        this.nodes_executedAction = [];\n        \n        //subgraph_data\n        this.inputs = {};\n        this.outputs = {};\n\n        //notify canvas to redraw\n        this.change();\n\n        this.sendActionToCanvas(\"clear\");\n    };\n\n    /**\n     * Attach Canvas to this graph\n     * @method attachCanvas\n     * @param {GraphCanvas} graph_canvas\n     */\n\n    LGraph.prototype.attachCanvas = function(graphcanvas) {\n        if (graphcanvas.constructor != LGraphCanvas) {\n            throw \"attachCanvas expects a LGraphCanvas instance\";\n        }\n        if (graphcanvas.graph && graphcanvas.graph != this) {\n            graphcanvas.graph.detachCanvas(graphcanvas);\n        }\n\n        graphcanvas.graph = this;\n\n        if (!this.list_of_graphcanvas) {\n            this.list_of_graphcanvas = [];\n        }\n        this.list_of_graphcanvas.push(graphcanvas);\n    };\n\n    /**\n     * Detach Canvas from this graph\n     * @method detachCanvas\n     * @param {GraphCanvas} graph_canvas\n     */\n    LGraph.prototype.detachCanvas = function(graphcanvas) {\n        if (!this.list_of_graphcanvas) {\n            return;\n        }\n\n        var pos = this.list_of_graphcanvas.indexOf(graphcanvas);\n        if (pos == -1) {\n            return;\n        }\n        graphcanvas.graph = null;\n        this.list_of_graphcanvas.splice(pos, 1);\n    };\n\n    /**\n     * Starts running this graph every interval milliseconds.\n     * @method start\n     * @param {number} interval amount of milliseconds between executions, if 0 then it renders to the monitor refresh rate\n     */\n\n    LGraph.prototype.start = function(interval) {\n        if (this.status == LGraph.STATUS_RUNNING) {\n            return;\n        }\n        this.status = LGraph.STATUS_RUNNING;\n\n        if (this.onPlayEvent) {\n            this.onPlayEvent();\n        }\n\n        this.sendEventToAllNodes(\"onStart\");\n\n        //launch\n        this.starttime = LiteGraph.getTime();\n        this.last_update_time = this.starttime;\n        interval = interval || 0;\n        var that = this;\n\n\t\t//execute once per frame\n        if ( interval == 0 && typeof window != \"undefined\" && window.requestAnimationFrame ) {\n            function on_frame() {\n                if (that.execution_timer_id != -1) {\n                    return;\n                }\n                window.requestAnimationFrame(on_frame);\n\t\t\t\tif(that.onBeforeStep)\n\t\t\t\t\tthat.onBeforeStep();\n                that.runStep(1, !that.catch_errors);\n\t\t\t\tif(that.onAfterStep)\n\t\t\t\t\tthat.onAfterStep();\n            }\n            this.execution_timer_id = -1;\n            on_frame();\n        } else { //execute every 'interval' ms\n            this.execution_timer_id = setInterval(function() {\n                //execute\n\t\t\t\tif(that.onBeforeStep)\n\t\t\t\t\tthat.onBeforeStep();\n                that.runStep(1, !that.catch_errors);\n\t\t\t\tif(that.onAfterStep)\n\t\t\t\t\tthat.onAfterStep();\n            }, interval);\n        }\n    };\n\n    /**\n     * Stops the execution loop of the graph\n     * @method stop execution\n     */\n\n    LGraph.prototype.stop = function() {\n        if (this.status == LGraph.STATUS_STOPPED) {\n            return;\n        }\n\n        this.status = LGraph.STATUS_STOPPED;\n\n        if (this.onStopEvent) {\n            this.onStopEvent();\n        }\n\n        if (this.execution_timer_id != null) {\n            if (this.execution_timer_id != -1) {\n                clearInterval(this.execution_timer_id);\n            }\n            this.execution_timer_id = null;\n        }\n\n        this.sendEventToAllNodes(\"onStop\");\n    };\n\n    /**\n     * Run N steps (cycles) of the graph\n     * @method runStep\n     * @param {number} num number of steps to run, default is 1\n     * @param {Boolean} do_not_catch_errors [optional] if you want to try/catch errors \n     * @param {number} limit max number of nodes to execute (used to execute from start to a node)\n     */\n\n    LGraph.prototype.runStep = function(num, do_not_catch_errors, limit ) {\n        num = num || 1;\n\n        var start = LiteGraph.getTime();\n        this.globaltime = 0.001 * (start - this.starttime);\n\n        //not optimal: executes possible pending actions in node, problem is it is not optimized\n        //it is done here as if it was done in the later loop it wont be called in the node missed the onExecute\n        \n        //from now on it will iterate only on executable nodes which is faster\n        var nodes = this._nodes_executable\n            ? this._nodes_executable\n            : this._nodes;\n        if (!nodes) {\n            return;\n        }\n\n\t\tlimit = limit || nodes.length;\n\n        if (do_not_catch_errors) {\n            //iterations\n            for (var i = 0; i < num; i++) {\n                for (var j = 0; j < limit; ++j) {\n                    var node = nodes[j];\n                    if(LiteGraph.use_deferred_actions && node._waiting_actions && node._waiting_actions.length)\n                        node.executePendingActions();\n                    if (node.mode == LiteGraph.ALWAYS && node.onExecute) {\n                        //wrap node.onExecute();\n\t\t\t\t\t\tnode.doExecute();\n                    }\n                }\n\n                this.fixedtime += this.fixedtime_lapse;\n                if (this.onExecuteStep) {\n                    this.onExecuteStep();\n                }\n            }\n\n            if (this.onAfterExecute) {\n                this.onAfterExecute();\n            }\n        } else { //catch errors\n            try {\n                //iterations\n                for (var i = 0; i < num; i++) {\n                    for (var j = 0; j < limit; ++j) {\n                        var node = nodes[j];\n                        if(LiteGraph.use_deferred_actions && node._waiting_actions && node._waiting_actions.length)\n                            node.executePendingActions();\n                        if (node.mode == LiteGraph.ALWAYS && node.onExecute) {\n                            node.onExecute();\n                        }\n                    }\n\n                    this.fixedtime += this.fixedtime_lapse;\n                    if (this.onExecuteStep) {\n                        this.onExecuteStep();\n                    }\n                }\n\n                if (this.onAfterExecute) {\n                    this.onAfterExecute();\n                }\n                this.errors_in_execution = false;\n            } catch (err) {\n                this.errors_in_execution = true;\n                if (LiteGraph.throw_errors) {\n                    throw err;\n                }\n                if (LiteGraph.debug) {\n                    console.log(\"Error during execution: \" + err);\n                }\n                this.stop();\n            }\n        }\n\n        var now = LiteGraph.getTime();\n        var elapsed = now - start;\n        if (elapsed == 0) {\n            elapsed = 1;\n        }\n        this.execution_time = 0.001 * elapsed;\n        this.globaltime += 0.001 * elapsed;\n        this.iteration += 1;\n        this.elapsed_time = (now - this.last_update_time) * 0.001;\n        this.last_update_time = now;\n        this.nodes_executing = [];\n        this.nodes_actioning = [];\n        this.nodes_executedAction = [];\n    };\n\n    /**\n     * Updates the graph execution order according to relevance of the nodes (nodes with only outputs have more relevance than\n     * nodes with only inputs.\n     * @method updateExecutionOrder\n     */\n    LGraph.prototype.updateExecutionOrder = function() {\n        this._nodes_in_order = this.computeExecutionOrder(false);\n        this._nodes_executable = [];\n        for (var i = 0; i < this._nodes_in_order.length; ++i) {\n            if (this._nodes_in_order[i].onExecute) {\n                this._nodes_executable.push(this._nodes_in_order[i]);\n            }\n        }\n    };\n\n    //This is more internal, it computes the executable nodes in order and returns it\n    LGraph.prototype.computeExecutionOrder = function(\n        only_onExecute,\n        set_level\n    ) {\n        var L = [];\n        var S = [];\n        var M = {};\n        var visited_links = {}; //to avoid repeating links\n        var remaining_links = {}; //to a\n\n        //search for the nodes without inputs (starting nodes)\n        for (var i = 0, l = this._nodes.length; i < l; ++i) {\n            var node = this._nodes[i];\n            if (only_onExecute && !node.onExecute) {\n                continue;\n            }\n\n            M[node.id] = node; //add to pending nodes\n\n            var num = 0; //num of input connections\n            if (node.inputs) {\n                for (var j = 0, l2 = node.inputs.length; j < l2; j++) {\n                    if (node.inputs[j] && node.inputs[j].link != null) {\n                        num += 1;\n                    }\n                }\n            }\n\n            if (num == 0) {\n                //is a starting node\n                S.push(node);\n                if (set_level) {\n                    node._level = 1;\n                }\n            } //num of input links\n            else {\n                if (set_level) {\n                    node._level = 0;\n                }\n                remaining_links[node.id] = num;\n            }\n        }\n\n        while (true) {\n            if (S.length == 0) {\n                break;\n            }\n\n            //get an starting node\n            var node = S.shift();\n            L.push(node); //add to ordered list\n            delete M[node.id]; //remove from the pending nodes\n\n            if (!node.outputs) {\n                continue;\n            }\n\n            //for every output\n            for (var i = 0; i < node.outputs.length; i++) {\n                var output = node.outputs[i];\n                //not connected\n                if (\n                    output == null ||\n                    output.links == null ||\n                    output.links.length == 0\n                ) {\n                    continue;\n                }\n\n                //for every connection\n                for (var j = 0; j < output.links.length; j++) {\n                    var link_id = output.links[j];\n                    var link = this.links[link_id];\n                    if (!link) {\n                        continue;\n                    }\n\n                    //already visited link (ignore it)\n                    if (visited_links[link.id]) {\n                        continue;\n                    }\n\n                    var target_node = this.getNodeById(link.target_id);\n                    if (target_node == null) {\n                        visited_links[link.id] = true;\n                        continue;\n                    }\n\n                    if (\n                        set_level &&\n                        (!target_node._level ||\n                            target_node._level <= node._level)\n                    ) {\n                        target_node._level = node._level + 1;\n                    }\n\n                    visited_links[link.id] = true; //mark as visited\n                    remaining_links[target_node.id] -= 1; //reduce the number of links remaining\n                    if (remaining_links[target_node.id] == 0) {\n                        S.push(target_node);\n                    } //if no more links, then add to starters array\n                }\n            }\n        }\n\n        //the remaining ones (loops)\n        for (var i in M) {\n            L.push(M[i]);\n        }\n\n        if (L.length != this._nodes.length && LiteGraph.debug) {\n            console.warn(\"something went wrong, nodes missing\");\n        }\n\n        var l = L.length;\n\n        //save order number in the node\n        for (var i = 0; i < l; ++i) {\n            L[i].order = i;\n        }\n\n        //sort now by priority\n        L = L.sort(function(A, B) {\n            var Ap = A.constructor.priority || A.priority || 0;\n            var Bp = B.constructor.priority || B.priority || 0;\n            if (Ap == Bp) {\n                //if same priority, sort by order\n                return A.order - B.order;\n            }\n            return Ap - Bp; //sort by priority\n        });\n\n        //save order number in the node, again...\n        for (var i = 0; i < l; ++i) {\n            L[i].order = i;\n        }\n\n        return L;\n    };\n\n    /**\n     * Returns all the nodes that could affect this one (ancestors) by crawling all the inputs recursively.\n     * It doesn't include the node itself\n     * @method getAncestors\n     * @return {Array} an array with all the LGraphNodes that affect this node, in order of execution\n     */\n    LGraph.prototype.getAncestors = function(node) {\n        var ancestors = [];\n        var pending = [node];\n        var visited = {};\n\n        while (pending.length) {\n            var current = pending.shift();\n            if (!current.inputs) {\n                continue;\n            }\n            if (!visited[current.id] && current != node) {\n                visited[current.id] = true;\n                ancestors.push(current);\n            }\n\n            for (var i = 0; i < current.inputs.length; ++i) {\n                var input = current.getInputNode(i);\n                if (input && ancestors.indexOf(input) == -1) {\n                    pending.push(input);\n                }\n            }\n        }\n\n        ancestors.sort(function(a, b) {\n            return a.order - b.order;\n        });\n        return ancestors;\n    };\n\n    /**\n     * Positions every node in a more readable manner\n     * @method arrange\n     */\n    LGraph.prototype.arrange = function (margin, layout) {\n        margin = margin || 100;\n\n        const nodes = this.computeExecutionOrder(false, true);\n        const columns = [];\n        for (let i = 0; i < nodes.length; ++i) {\n            const node = nodes[i];\n            const col = node._level || 1;\n            if (!columns[col]) {\n                columns[col] = [];\n            }\n            columns[col].push(node);\n        }\n\n        let x = margin;\n\n        for (let i = 0; i < columns.length; ++i) {\n            const column = columns[i];\n            if (!column) {\n                continue;\n            }\n            let max_size = 100;\n            let y = margin + LiteGraph.NODE_TITLE_HEIGHT;\n            for (let j = 0; j < column.length; ++j) {\n                const node = column[j];\n                node.pos[0] = (layout == LiteGraph.VERTICAL_LAYOUT) ? y : x;\n                node.pos[1] = (layout == LiteGraph.VERTICAL_LAYOUT) ? x : y;\n                const max_size_index = (layout == LiteGraph.VERTICAL_LAYOUT) ? 1 : 0;\n                if (node.size[max_size_index] > max_size) {\n                    max_size = node.size[max_size_index];\n                }\n                const node_size_index = (layout == LiteGraph.VERTICAL_LAYOUT) ? 0 : 1;\n                y += node.size[node_size_index] + margin + LiteGraph.NODE_TITLE_HEIGHT;\n            }\n            x += max_size + margin;\n        }\n\n        this.setDirtyCanvas(true, true);\n    };\n\n    /**\n     * Returns the amount of time the graph has been running in milliseconds\n     * @method getTime\n     * @return {number} number of milliseconds the graph has been running\n     */\n    LGraph.prototype.getTime = function() {\n        return this.globaltime;\n    };\n\n    /**\n     * Returns the amount of time accumulated using the fixedtime_lapse var. This is used in context where the time increments should be constant\n     * @method getFixedTime\n     * @return {number} number of milliseconds the graph has been running\n     */\n\n    LGraph.prototype.getFixedTime = function() {\n        return this.fixedtime;\n    };\n\n    /**\n     * Returns the amount of time it took to compute the latest iteration. Take into account that this number could be not correct\n     * if the nodes are using graphical actions\n     * @method getElapsedTime\n     * @return {number} number of milliseconds it took the last cycle\n     */\n\n    LGraph.prototype.getElapsedTime = function() {\n        return this.elapsed_time;\n    };\n\n    /**\n     * Sends an event to all the nodes, useful to trigger stuff\n     * @method sendEventToAllNodes\n     * @param {String} eventname the name of the event (function to be called)\n     * @param {Array} params parameters in array format\n     */\n    LGraph.prototype.sendEventToAllNodes = function(eventname, params, mode) {\n        mode = mode || LiteGraph.ALWAYS;\n\n        var nodes = this._nodes_in_order ? this._nodes_in_order : this._nodes;\n        if (!nodes) {\n            return;\n        }\n\n        for (var j = 0, l = nodes.length; j < l; ++j) {\n            var node = nodes[j];\n\n            if (\n                node.constructor === LiteGraph.Subgraph &&\n                eventname != \"onExecute\"\n            ) {\n                if (node.mode == mode) {\n                    node.sendEventToAllNodes(eventname, params, mode);\n                }\n                continue;\n            }\n\n            if (!node[eventname] || node.mode != mode) {\n                continue;\n            }\n            if (params === undefined) {\n                node[eventname]();\n            } else if (params && params.constructor === Array) {\n                node[eventname].apply(node, params);\n            } else {\n                node[eventname](params);\n            }\n        }\n    };\n\n    LGraph.prototype.sendActionToCanvas = function(action, params) {\n        if (!this.list_of_graphcanvas) {\n            return;\n        }\n\n        for (var i = 0; i < this.list_of_graphcanvas.length; ++i) {\n            var c = this.list_of_graphcanvas[i];\n            if (c[action]) {\n                c[action].apply(c, params);\n            }\n        }\n    };\n\n    /**\n     * Adds a new node instance to this graph\n     * @method add\n     * @param {LGraphNode} node the instance of the node\n     */\n\n    LGraph.prototype.add = function(node, skip_compute_order) {\n        if (!node) {\n            return;\n        }\n\n        //groups\n        if (node.constructor === LGraphGroup) {\n            this._groups.push(node);\n            this.setDirtyCanvas(true);\n            this.change();\n            node.graph = this;\n            this._version++;\n            return;\n        }\n\n        //nodes\n        if (node.id != -1 && this._nodes_by_id[node.id] != null) {\n            console.warn(\n                \"LiteGraph: there is already a node with this ID, changing it\"\n            );\n            if (LiteGraph.use_uuids) {\n                node.id = LiteGraph.uuidv4();\n            }\n            else {\n                node.id = ++this.last_node_id;\n            }\n        }\n\n        if (this._nodes.length >= LiteGraph.MAX_NUMBER_OF_NODES) {\n            throw \"LiteGraph: max number of nodes in a graph reached\";\n        }\n\n        //give him an id\n        if (LiteGraph.use_uuids) {\n            if (node.id == null || node.id == -1)\n                node.id = LiteGraph.uuidv4();\n        }\n        else {\n            if (node.id == null || node.id == -1) {\n                node.id = ++this.last_node_id;\n            } else if (this.last_node_id < node.id) {\n                this.last_node_id = node.id;\n            }\n        }\n\n        node.graph = this;\n        this._version++;\n\n        this._nodes.push(node);\n        this._nodes_by_id[node.id] = node;\n\n        if (node.onAdded) {\n            node.onAdded(this);\n        }\n\n        if (this.config.align_to_grid) {\n            node.alignToGrid();\n        }\n\n        if (!skip_compute_order) {\n            this.updateExecutionOrder();\n        }\n\n        if (this.onNodeAdded) {\n            this.onNodeAdded(node);\n        }\n\n        this.setDirtyCanvas(true);\n        this.change();\n\n        return node; //to chain actions\n    };\n\n    /**\n     * Removes a node from the graph\n     * @method remove\n     * @param {LGraphNode} node the instance of the node\n     */\n\n    LGraph.prototype.remove = function(node) {\n        if (node.constructor === LiteGraph.LGraphGroup) {\n            var index = this._groups.indexOf(node);\n            if (index != -1) {\n                this._groups.splice(index, 1);\n            }\n            node.graph = null;\n            this._version++;\n            this.setDirtyCanvas(true, true);\n            this.change();\n            return;\n        }\n\n        if (this._nodes_by_id[node.id] == null) {\n            return;\n        } //not found\n\n        if (node.ignore_remove) {\n            return;\n        } //cannot be removed\n\n\t\tthis.beforeChange(); //sure? - almost sure is wrong\n\n        //disconnect inputs\n        if (node.inputs) {\n            for (var i = 0; i < node.inputs.length; i++) {\n                var slot = node.inputs[i];\n                if (slot.link != null) {\n                    node.disconnectInput(i);\n                }\n            }\n        }\n\n        //disconnect outputs\n        if (node.outputs) {\n            for (var i = 0; i < node.outputs.length; i++) {\n                var slot = node.outputs[i];\n                if (slot.links != null && slot.links.length) {\n                    node.disconnectOutput(i);\n                }\n            }\n        }\n\n        //node.id = -1; //why?\n\n        //callback\n        if (node.onRemoved) {\n            node.onRemoved();\n        }\n\n        node.graph = null;\n        this._version++;\n\n        //remove from canvas render\n        if (this.list_of_graphcanvas) {\n            for (var i = 0; i < this.list_of_graphcanvas.length; ++i) {\n                var canvas = this.list_of_graphcanvas[i];\n                if (canvas.selected_nodes[node.id]) {\n                    delete canvas.selected_nodes[node.id];\n                }\n                if (canvas.node_dragged == node) {\n                    canvas.node_dragged = null;\n                }\n            }\n        }\n\n        //remove from containers\n        var pos = this._nodes.indexOf(node);\n        if (pos != -1) {\n            this._nodes.splice(pos, 1);\n        }\n        delete this._nodes_by_id[node.id];\n\n        if (this.onNodeRemoved) {\n            this.onNodeRemoved(node);\n        }\n\n\t\t//close panels\n\t\tthis.sendActionToCanvas(\"checkPanels\");\n\n        this.setDirtyCanvas(true, true);\n\t\tthis.afterChange(); //sure? - almost sure is wrong\n        this.change();\n\n        this.updateExecutionOrder();\n    };\n\n    /**\n     * Returns a node by its id.\n     * @method getNodeById\n     * @param {Number} id\n     */\n\n    LGraph.prototype.getNodeById = function(id) {\n        if (id == null) {\n            return null;\n        }\n        return this._nodes_by_id[id];\n    };\n\n    /**\n     * Returns a list of nodes that matches a class\n     * @method findNodesByClass\n     * @param {Class} classObject the class itself (not an string)\n     * @return {Array} a list with all the nodes of this type\n     */\n    LGraph.prototype.findNodesByClass = function(classObject, result) {\n        result = result || [];\n        result.length = 0;\n        for (var i = 0, l = this._nodes.length; i < l; ++i) {\n            if (this._nodes[i].constructor === classObject) {\n                result.push(this._nodes[i]);\n            }\n        }\n        return result;\n    };\n\n    /**\n     * Returns a list of nodes that matches a type\n     * @method findNodesByType\n     * @param {String} type the name of the node type\n     * @return {Array} a list with all the nodes of this type\n     */\n    LGraph.prototype.findNodesByType = function(type, result) {\n        var type = type.toLowerCase();\n        result = result || [];\n        result.length = 0;\n        for (var i = 0, l = this._nodes.length; i < l; ++i) {\n            if (this._nodes[i].type.toLowerCase() == type) {\n                result.push(this._nodes[i]);\n            }\n        }\n        return result;\n    };\n\n    /**\n     * Returns the first node that matches a name in its title\n     * @method findNodeByTitle\n     * @param {String} name the name of the node to search\n     * @return {Node} the node or null\n     */\n    LGraph.prototype.findNodeByTitle = function(title) {\n        for (var i = 0, l = this._nodes.length; i < l; ++i) {\n            if (this._nodes[i].title == title) {\n                return this._nodes[i];\n            }\n        }\n        return null;\n    };\n\n    /**\n     * Returns a list of nodes that matches a name\n     * @method findNodesByTitle\n     * @param {String} name the name of the node to search\n     * @return {Array} a list with all the nodes with this name\n     */\n    LGraph.prototype.findNodesByTitle = function(title) {\n        var result = [];\n        for (var i = 0, l = this._nodes.length; i < l; ++i) {\n            if (this._nodes[i].title == title) {\n                result.push(this._nodes[i]);\n            }\n        }\n        return result;\n    };\n\n    /**\n     * Returns the top-most node in this position of the canvas\n     * @method getNodeOnPos\n     * @param {number} x the x coordinate in canvas space\n     * @param {number} y the y coordinate in canvas space\n     * @param {Array} nodes_list a list with all the nodes to search from, by default is all the nodes in the graph\n     * @return {LGraphNode} the node at this position or null\n     */\n    LGraph.prototype.getNodeOnPos = function(x, y, nodes_list, margin) {\n        nodes_list = nodes_list || this._nodes;\n\t\tvar nRet = null;\n        for (var i = nodes_list.length - 1; i >= 0; i--) {\n            var n = nodes_list[i];\n            if (n.isPointInside(x, y, margin)) {\n                // check for lesser interest nodes (TODO check for overlapping, use the top)\n\t\t\t\t/*if (typeof n == \"LGraphGroup\"){\n\t\t\t\t\tnRet = n;\n\t\t\t\t}else{*/\n\t\t\t\t\treturn n;\n\t\t\t\t/*}*/\n            }\n        }\n        return nRet;\n    };\n\n    /**\n     * Returns the top-most group in that position\n     * @method getGroupOnPos\n     * @param {number} x the x coordinate in canvas space\n     * @param {number} y the y coordinate in canvas space\n     * @return {LGraphGroup} the group or null\n     */\n    LGraph.prototype.getGroupOnPos = function(x, y) {\n        for (var i = this._groups.length - 1; i >= 0; i--) {\n            var g = this._groups[i];\n            if (g.isPointInside(x, y, 2, true)) {\n                return g;\n            }\n        }\n        return null;\n    };\n\n    /**\n     * Checks that the node type matches the node type registered, used when replacing a nodetype by a newer version during execution\n     * this replaces the ones using the old version with the new version\n     * @method checkNodeTypes\n     */\n    LGraph.prototype.checkNodeTypes = function() {\n        var changes = false;\n        for (var i = 0; i < this._nodes.length; i++) {\n            var node = this._nodes[i];\n            var ctor = LiteGraph.registered_node_types[node.type];\n            if (node.constructor == ctor) {\n                continue;\n            }\n            console.log(\"node being replaced by newer version: \" + node.type);\n            var newnode = LiteGraph.createNode(node.type);\n            changes = true;\n            this._nodes[i] = newnode;\n            newnode.configure(node.serialize());\n            newnode.graph = this;\n            this._nodes_by_id[newnode.id] = newnode;\n            if (node.inputs) {\n                newnode.inputs = node.inputs.concat();\n            }\n            if (node.outputs) {\n                newnode.outputs = node.outputs.concat();\n            }\n        }\n        this.updateExecutionOrder();\n    };\n\n    // ********** GLOBALS *****************\n\n    LGraph.prototype.onAction = function(action, param, options) {\n        this._input_nodes = this.findNodesByClass(\n            LiteGraph.GraphInput,\n            this._input_nodes\n        );\n        for (var i = 0; i < this._input_nodes.length; ++i) {\n            var node = this._input_nodes[i];\n            if (node.properties.name != action) {\n                continue;\n            }\n            //wrap node.onAction(action, param);\n            node.actionDo(action, param, options);\n            break;\n        }\n    };\n\n    LGraph.prototype.trigger = function(action, param) {\n        if (this.onTrigger) {\n            this.onTrigger(action, param);\n        }\n    };\n\n    /**\n     * Tell this graph it has a global graph input of this type\n     * @method addGlobalInput\n     * @param {String} name\n     * @param {String} type\n     * @param {*} value [optional]\n     */\n    LGraph.prototype.addInput = function(name, type, value) {\n        var input = this.inputs[name];\n        if (input) {\n            //already exist\n            return;\n        }\n\n\t\tthis.beforeChange();\n        this.inputs[name] = { name: name, type: type, value: value };\n        this._version++;\n\t\tthis.afterChange();\n\n        if (this.onInputAdded) {\n            this.onInputAdded(name, type);\n        }\n\n        if (this.onInputsOutputsChange) {\n            this.onInputsOutputsChange();\n        }\n    };\n\n    /**\n     * Assign a data to the global graph input\n     * @method setGlobalInputData\n     * @param {String} name\n     * @param {*} data\n     */\n    LGraph.prototype.setInputData = function(name, data) {\n        var input = this.inputs[name];\n        if (!input) {\n            return;\n        }\n        input.value = data;\n    };\n\n    /**\n     * Returns the current value of a global graph input\n     * @method getInputData\n     * @param {String} name\n     * @return {*} the data\n     */\n    LGraph.prototype.getInputData = function(name) {\n        var input = this.inputs[name];\n        if (!input) {\n            return null;\n        }\n        return input.value;\n    };\n\n    /**\n     * Changes the name of a global graph input\n     * @method renameInput\n     * @param {String} old_name\n     * @param {String} new_name\n     */\n    LGraph.prototype.renameInput = function(old_name, name) {\n        if (name == old_name) {\n            return;\n        }\n\n        if (!this.inputs[old_name]) {\n            return false;\n        }\n\n        if (this.inputs[name]) {\n            console.error(\"there is already one input with that name\");\n            return false;\n        }\n\n        this.inputs[name] = this.inputs[old_name];\n        delete this.inputs[old_name];\n        this._version++;\n\n        if (this.onInputRenamed) {\n            this.onInputRenamed(old_name, name);\n        }\n\n        if (this.onInputsOutputsChange) {\n            this.onInputsOutputsChange();\n        }\n    };\n\n    /**\n     * Changes the type of a global graph input\n     * @method changeInputType\n     * @param {String} name\n     * @param {String} type\n     */\n    LGraph.prototype.changeInputType = function(name, type) {\n        if (!this.inputs[name]) {\n            return false;\n        }\n\n        if (\n            this.inputs[name].type &&\n            String(this.inputs[name].type).toLowerCase() ==\n                String(type).toLowerCase()\n        ) {\n            return;\n        }\n\n        this.inputs[name].type = type;\n        this._version++;\n        if (this.onInputTypeChanged) {\n            this.onInputTypeChanged(name, type);\n        }\n    };\n\n    /**\n     * Removes a global graph input\n     * @method removeInput\n     * @param {String} name\n     * @param {String} type\n     */\n    LGraph.prototype.removeInput = function(name) {\n        if (!this.inputs[name]) {\n            return false;\n        }\n\n        delete this.inputs[name];\n        this._version++;\n\n        if (this.onInputRemoved) {\n            this.onInputRemoved(name);\n        }\n\n        if (this.onInputsOutputsChange) {\n            this.onInputsOutputsChange();\n        }\n        return true;\n    };\n\n    /**\n     * Creates a global graph output\n     * @method addOutput\n     * @param {String} name\n     * @param {String} type\n     * @param {*} value\n     */\n    LGraph.prototype.addOutput = function(name, type, value) {\n        this.outputs[name] = { name: name, type: type, value: value };\n        this._version++;\n\n        if (this.onOutputAdded) {\n            this.onOutputAdded(name, type);\n        }\n\n        if (this.onInputsOutputsChange) {\n            this.onInputsOutputsChange();\n        }\n    };\n\n    /**\n     * Assign a data to the global output\n     * @method setOutputData\n     * @param {String} name\n     * @param {String} value\n     */\n    LGraph.prototype.setOutputData = function(name, value) {\n        var output = this.outputs[name];\n        if (!output) {\n            return;\n        }\n        output.value = value;\n    };\n\n    /**\n     * Returns the current value of a global graph output\n     * @method getOutputData\n     * @param {String} name\n     * @return {*} the data\n     */\n    LGraph.prototype.getOutputData = function(name) {\n        var output = this.outputs[name];\n        if (!output) {\n            return null;\n        }\n        return output.value;\n    };\n\n    /**\n     * Renames a global graph output\n     * @method renameOutput\n     * @param {String} old_name\n     * @param {String} new_name\n     */\n    LGraph.prototype.renameOutput = function(old_name, name) {\n        if (!this.outputs[old_name]) {\n            return false;\n        }\n\n        if (this.outputs[name]) {\n            console.error(\"there is already one output with that name\");\n            return false;\n        }\n\n        this.outputs[name] = this.outputs[old_name];\n        delete this.outputs[old_name];\n        this._version++;\n\n        if (this.onOutputRenamed) {\n            this.onOutputRenamed(old_name, name);\n        }\n\n        if (this.onInputsOutputsChange) {\n            this.onInputsOutputsChange();\n        }\n    };\n\n    /**\n     * Changes the type of a global graph output\n     * @method changeOutputType\n     * @param {String} name\n     * @param {String} type\n     */\n    LGraph.prototype.changeOutputType = function(name, type) {\n        if (!this.outputs[name]) {\n            return false;\n        }\n\n        if (\n            this.outputs[name].type &&\n            String(this.outputs[name].type).toLowerCase() ==\n                String(type).toLowerCase()\n        ) {\n            return;\n        }\n\n        this.outputs[name].type = type;\n        this._version++;\n        if (this.onOutputTypeChanged) {\n            this.onOutputTypeChanged(name, type);\n        }\n    };\n\n    /**\n     * Removes a global graph output\n     * @method removeOutput\n     * @param {String} name\n     */\n    LGraph.prototype.removeOutput = function(name) {\n        if (!this.outputs[name]) {\n            return false;\n        }\n        delete this.outputs[name];\n        this._version++;\n\n        if (this.onOutputRemoved) {\n            this.onOutputRemoved(name);\n        }\n\n        if (this.onInputsOutputsChange) {\n            this.onInputsOutputsChange();\n        }\n        return true;\n    };\n\n    LGraph.prototype.triggerInput = function(name, value) {\n        var nodes = this.findNodesByTitle(name);\n        for (var i = 0; i < nodes.length; ++i) {\n            nodes[i].onTrigger(value);\n        }\n    };\n\n    LGraph.prototype.setCallback = function(name, func) {\n        var nodes = this.findNodesByTitle(name);\n        for (var i = 0; i < nodes.length; ++i) {\n            nodes[i].setTrigger(func);\n        }\n    };\n\n\t//used for undo, called before any change is made to the graph\n    LGraph.prototype.beforeChange = function(info) {\n        if (this.onBeforeChange) {\n            this.onBeforeChange(this,info);\n        }\n        this.sendActionToCanvas(\"onBeforeChange\", this);\n    };\n\n\t//used to resend actions, called after any change is made to the graph\n    LGraph.prototype.afterChange = function(info) {\n        if (this.onAfterChange) {\n            this.onAfterChange(this,info);\n        }\n        this.sendActionToCanvas(\"onAfterChange\", this);\n    };\n\n    LGraph.prototype.connectionChange = function(node, link_info) {\n        this.updateExecutionOrder();\n        if (this.onConnectionChange) {\n            this.onConnectionChange(node);\n        }\n        this._version++;\n        this.sendActionToCanvas(\"onConnectionChange\");\n    };\n\n    /**\n     * returns if the graph is in live mode\n     * @method isLive\n     */\n\n    LGraph.prototype.isLive = function() {\n        if (!this.list_of_graphcanvas) {\n            return false;\n        }\n\n        for (var i = 0; i < this.list_of_graphcanvas.length; ++i) {\n            var c = this.list_of_graphcanvas[i];\n            if (c.live_mode) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    /**\n     * clears the triggered slot animation in all links (stop visual animation)\n     * @method clearTriggeredSlots\n     */\n    LGraph.prototype.clearTriggeredSlots = function() {\n        for (var i in this.links) {\n            var link_info = this.links[i];\n            if (!link_info) {\n                continue;\n            }\n            if (link_info._last_time) {\n                link_info._last_time = 0;\n            }\n        }\n    };\n\n    /* Called when something visually changed (not the graph!) */\n    LGraph.prototype.change = function() {\n        if (LiteGraph.debug) {\n            console.log(\"Graph changed\");\n        }\n        this.sendActionToCanvas(\"setDirty\", [true, true]);\n        if (this.on_change) {\n            this.on_change(this);\n        }\n    };\n\n    LGraph.prototype.setDirtyCanvas = function(fg, bg) {\n        this.sendActionToCanvas(\"setDirty\", [fg, bg]);\n    };\n\n    /**\n     * Destroys a link\n     * @method removeLink\n     * @param {Number} link_id\n     */\n    LGraph.prototype.removeLink = function(link_id) {\n        var link = this.links[link_id];\n        if (!link) {\n            return;\n        }\n        var node = this.getNodeById(link.target_id);\n        if (node) {\n            node.disconnectInput(link.target_slot);\n        }\n    };\n\n    //save and recover app state ***************************************\n    /**\n     * Creates a Object containing all the info about this graph, it can be serialized\n     * @method serialize\n     * @return {Object} value of the node\n     */\n    LGraph.prototype.serialize = function() {\n        var nodes_info = [];\n        for (var i = 0, l = this._nodes.length; i < l; ++i) {\n            nodes_info.push(this._nodes[i].serialize());\n        }\n\n        //pack link info into a non-verbose format\n        var links = [];\n        for (var i in this.links) {\n            //links is an OBJECT\n            var link = this.links[i];\n            if (!link.serialize) {\n                //weird bug I havent solved yet\n                console.warn(\n                    \"weird LLink bug, link info is not a LLink but a regular object\"\n                );\n                var link2 = new LLink();\n                for (var j in link) { \n                    link2[j] = link[j];\n                }\n                this.links[i] = link2;\n                link = link2;\n            }\n\n            links.push(link.serialize());\n        }\n\n        var groups_info = [];\n        for (var i = 0; i < this._groups.length; ++i) {\n            groups_info.push(this._groups[i].serialize());\n        }\n\n        var data = {\n            last_node_id: this.last_node_id,\n            last_link_id: this.last_link_id,\n            nodes: nodes_info,\n            links: links,\n            groups: groups_info,\n            config: this.config,\n\t\t\textra: this.extra,\n            version: LiteGraph.VERSION\n        };\n\n\t\tif(this.onSerialize)\n\t\t\tthis.onSerialize(data);\n\n        return data;\n    };\n\n    /**\n     * Configure a graph from a JSON string\n     * @method configure\n     * @param {String} str configure a graph from a JSON string\n     * @param {Boolean} returns if there was any error parsing\n     */\n    LGraph.prototype.configure = function(data, keep_old) {\n        if (!data) {\n            return;\n        }\n\n        if (!keep_old) {\n            this.clear();\n        }\n\n        var nodes = data.nodes;\n\n        //decode links info (they are very verbose)\n        if (data.links && data.links.constructor === Array) {\n            var links = [];\n            for (var i = 0; i < data.links.length; ++i) {\n                var link_data = data.links[i];\n\t\t\t\tif(!link_data) //weird bug\n\t\t\t\t{\n\t\t\t\t\tconsole.warn(\"serialized graph link data contains errors, skipping.\");\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n                var link = new LLink();\n                link.configure(link_data);\n                links[link.id] = link;\n            }\n            data.links = links;\n        }\n\n        //copy all stored fields\n        for (var i in data) {\n\t\t\tif(i == \"nodes\" || i == \"groups\" ) //links must be accepted\n\t\t\t\tcontinue;\n            this[i] = data[i];\n        }\n\n        var error = false;\n\n        //create nodes\n        this._nodes = [];\n        if (nodes) {\n            for (var i = 0, l = nodes.length; i < l; ++i) {\n                var n_info = nodes[i]; //stored info\n                var node = LiteGraph.createNode(n_info.type, n_info.title);\n                if (!node) {\n                    if (LiteGraph.debug) {\n                        console.log(\n                            \"Node not found or has errors: \" + n_info.type\n                        );\n                    }\n\n                    //in case of error we create a replacement node to avoid losing info\n                    node = new LGraphNode();\n                    node.last_serialization = n_info;\n                    node.has_errors = true;\n                    error = true;\n                    //continue;\n                }\n\n                node.id = n_info.id; //id it or it will create a new id\n                this.add(node, true); //add before configure, otherwise configure cannot create links\n            }\n\n            //configure nodes afterwards so they can reach each other\n            for (var i = 0, l = nodes.length; i < l; ++i) {\n                var n_info = nodes[i];\n                var node = this.getNodeById(n_info.id);\n                if (node) {\n                    node.configure(n_info);\n                }\n            }\n        }\n\n        //groups\n        this._groups.length = 0;\n        if (data.groups) {\n            for (var i = 0; i < data.groups.length; ++i) {\n                var group = new LiteGraph.LGraphGroup();\n                group.configure(data.groups[i]);\n                this.add(group);\n            }\n        }\n\n        this.updateExecutionOrder();\n\n\t\tthis.extra = data.extra || {};\n\n\t\tif(this.onConfigure)\n\t\t\tthis.onConfigure(data);\n\n        this._version++;\n        this.setDirtyCanvas(true, true);\n        return error;\n    };\n\n    LGraph.prototype.load = function(url, callback) {\n        var that = this;\n\n\t\t//from file\n\t\tif(url.constructor === File || url.constructor === Blob)\n\t\t{\n\t\t\tvar reader = new FileReader();\n\t\t\treader.addEventListener('load', function(event) {\n\t\t\t\tvar data = JSON.parse(event.target.result);\n\t\t\t\tthat.configure(data);\n\t\t\t\tif(callback)\n\t\t\t\t\tcallback();\n\t\t\t});\n\t\t\t\n\t\t\treader.readAsText(url);\n\t\t\treturn;\n\t\t}\n\n\t\t//is a string, then an URL\n        var req = new XMLHttpRequest();\n        req.open(\"GET\", url, true);\n        req.send(null);\n        req.onload = function(oEvent) {\n            if (req.status !== 200) {\n                console.error(\"Error loading graph:\", req.status, req.response);\n                return;\n            }\n            var data = JSON.parse( req.response );\n            that.configure(data);\n\t\t\tif(callback)\n\t\t\t\tcallback();\n        };\n        req.onerror = function(err) {\n            console.error(\"Error loading graph:\", err);\n        };\n    };\n\n    LGraph.prototype.onNodeTrace = function(node, msg, color) {\n        //TODO\n    };\n\n    //this is the class in charge of storing link information\n    function LLink(id, type, origin_id, origin_slot, target_id, target_slot) {\n        this.id = id;\n        this.type = type;\n        this.origin_id = origin_id;\n        this.origin_slot = origin_slot;\n        this.target_id = target_id;\n        this.target_slot = target_slot;\n\n        this._data = null;\n        this._pos = new Float32Array(2); //center\n    }\n\n    LLink.prototype.configure = function(o) {\n        if (o.constructor === Array) {\n            this.id = o[0];\n            this.origin_id = o[1];\n            this.origin_slot = o[2];\n            this.target_id = o[3];\n            this.target_slot = o[4];\n            this.type = o[5];\n        } else {\n            this.id = o.id;\n            this.type = o.type;\n            this.origin_id = o.origin_id;\n            this.origin_slot = o.origin_slot;\n            this.target_id = o.target_id;\n            this.target_slot = o.target_slot;\n        }\n    };\n\n    LLink.prototype.serialize = function() {\n        return [\n            this.id,\n            this.origin_id,\n            this.origin_slot,\n            this.target_id,\n            this.target_slot,\n            this.type\n        ];\n    };\n\n    LiteGraph.LLink = LLink;\n\n    // *************************************************************\n    //   Node CLASS                                          *******\n    // *************************************************************\n\n    /*\n\ttitle: string\n\tpos: [x,y]\n\tsize: [x,y]\n\n\tinput|output: every connection\n\t\t+  { name:string, type:string, pos: [x,y]=Optional, direction: \"input\"|\"output\", links: Array });\n\n\tgeneral properties:\n\t\t+ clip_area: if you render outside the node, it will be clipped\n\t\t+ unsafe_execution: not allowed for safe execution\n\t\t+ skip_repeated_outputs: when adding new outputs, it wont show if there is one already connected\n\t\t+ resizable: if set to false it wont be resizable with the mouse\n\t\t+ horizontal: slots are distributed horizontally\n\t\t+ widgets_start_y: widgets start at y distance from the top of the node\n\t\n\tflags object:\n\t\t+ collapsed: if it is collapsed\n\n\tsupported callbacks:\n\t\t+ onAdded: when added to graph (warning: this is called BEFORE the node is configured when loading)\n\t\t+ onRemoved: when removed from graph\n\t\t+ onStart:\twhen the graph starts playing\n\t\t+ onStop:\twhen the graph stops playing\n\t\t+ onDrawForeground: render the inside widgets inside the node\n\t\t+ onDrawBackground: render the background area inside the node (only in edit mode)\n\t\t+ onMouseDown\n\t\t+ onMouseMove\n\t\t+ onMouseUp\n\t\t+ onMouseEnter\n\t\t+ onMouseLeave\n\t\t+ onExecute: execute the node\n\t\t+ onPropertyChanged: when a property is changed in the panel (return true to skip default behaviour)\n\t\t+ onGetInputs: returns an array of possible inputs\n\t\t+ onGetOutputs: returns an array of possible outputs\n\t\t+ onBounding: in case this node has a bigger bounding than the node itself (the callback receives the bounding as [x,y,w,h])\n\t\t+ onDblClick: double clicked in the node\n\t\t+ onInputDblClick: input slot double clicked (can be used to automatically create a node connected)\n\t\t+ onOutputDblClick: output slot double clicked (can be used to automatically create a node connected)\n\t\t+ onConfigure: called after the node has been configured\n\t\t+ onSerialize: to add extra info when serializing (the callback receives the object that should be filled with the data)\n\t\t+ onSelected\n\t\t+ onDeselected\n\t\t+ onDropItem : DOM item dropped over the node\n\t\t+ onDropFile : file dropped over the node\n\t\t+ onConnectInput : if returns false the incoming connection will be canceled\n\t\t+ onConnectionsChange : a connection changed (new one or removed) (LiteGraph.INPUT or LiteGraph.OUTPUT, slot, true if connected, link_info, input_info )\n\t\t+ onAction: action slot triggered\n\t\t+ getExtraMenuOptions: to add option to context menu\n*/\n\n    /**\n     * Base Class for all the node type classes\n     * @class LGraphNode\n     * @param {String} name a name for the node\n     */\n\n    function LGraphNode(title) {\n        this._ctor(title);\n    }\n\n    global.LGraphNode = LiteGraph.LGraphNode = LGraphNode;\n\n    LGraphNode.prototype._ctor = function(title) {\n        this.title = title || \"Unnamed\";\n        this.size = [LiteGraph.NODE_WIDTH, 60];\n        this.graph = null;\n\n        this._pos = new Float32Array(10, 10);\n\n        Object.defineProperty(this, \"pos\", {\n            set: function(v) {\n                if (!v || v.length < 2) {\n                    return;\n                }\n                this._pos[0] = v[0];\n                this._pos[1] = v[1];\n            },\n            get: function() {\n                return this._pos;\n            },\n            enumerable: true\n        });\n\n        if (LiteGraph.use_uuids) {\n            this.id = LiteGraph.uuidv4();\n        }\n        else {\n            this.id = -1; //not know till not added\n        }\n        this.type = null;\n\n        //inputs available: array of inputs\n        this.inputs = [];\n        this.outputs = [];\n        this.connections = [];\n\n        //local data\n        this.properties = {}; //for the values\n        this.properties_info = []; //for the info\n\n        this.flags = {};\n    };\n\n    /**\n     * configure a node from an object containing the serialized info\n     * @method configure\n     */\n    LGraphNode.prototype.configure = function(info) {\n        if (this.graph) {\n            this.graph._version++;\n        }\n        for (var j in info) {\n            if (j == \"properties\") {\n                //i don't want to clone properties, I want to reuse the old container\n                for (var k in info.properties) {\n                    this.properties[k] = info.properties[k];\n                    if (this.onPropertyChanged) {\n                        this.onPropertyChanged( k, info.properties[k] );\n                    }\n                }\n                continue;\n            }\n\n            if (info[j] == null) {\n                continue;\n            } else if (typeof info[j] == \"object\") {\n                //object\n                if (this[j] && this[j].configure) {\n                    this[j].configure(info[j]);\n                } else {\n                    this[j] = LiteGraph.cloneObject(info[j], this[j]);\n                }\n            } //value\n            else {\n                this[j] = info[j];\n            }\n        }\n\n        if (!info.title) {\n            this.title = this.constructor.title;\n        }\n\n\t\tif (this.inputs) {\n\t\t\tfor (var i = 0; i < this.inputs.length; ++i) {\n\t\t\t\tvar input = this.inputs[i];\n\t\t\t\tvar link_info = this.graph ? this.graph.links[input.link] : null;\n\t\t\t\tif (this.onConnectionsChange)\n\t\t\t\t\tthis.onConnectionsChange( LiteGraph.INPUT, i, true, link_info, input ); //link_info has been created now, so its updated\n\n\t\t\t\tif( this.onInputAdded )\n\t\t\t\t\tthis.onInputAdded(input);\n\n\t\t\t}\n\t\t}\n\n\t\tif (this.outputs) {\n\t\t\tfor (var i = 0; i < this.outputs.length; ++i) {\n\t\t\t\tvar output = this.outputs[i];\n\t\t\t\tif (!output.links) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfor (var j = 0; j < output.links.length; ++j) {\n\t\t\t\t\tvar link_info = this.graph \t? this.graph.links[output.links[j]] : null;\n\t\t\t\t\tif (this.onConnectionsChange)\n\t\t\t\t\t\tthis.onConnectionsChange( LiteGraph.OUTPUT, i, true, link_info, output ); //link_info has been created now, so its updated\n\t\t\t\t}\n\n\t\t\t\tif( this.onOutputAdded )\n\t\t\t\t\tthis.onOutputAdded(output);\n\t\t\t}\n        }\n\n\t\tif( this.widgets )\n\t\t{\n\t\t\tfor (var i = 0; i < this.widgets.length; ++i)\n\t\t\t{\n\t\t\t\tvar w = this.widgets[i];\n\t\t\t\tif(!w)\n\t\t\t\t\tcontinue;\n\t\t\t\tif(w.options && w.options.property && (this.properties[ w.options.property ] != undefined))\n\t\t\t\t\tw.value = JSON.parse( JSON.stringify( this.properties[ w.options.property ] ) );\n\t\t\t}\n\t\t\tif (info.widgets_values) {\n\t\t\t\tfor (var i = 0; i < info.widgets_values.length; ++i) {\n\t\t\t\t\tif (this.widgets[i]) {\n\t\t\t\t\t\tthis.widgets[i].value = info.widgets_values[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n        if (this.onConfigure) {\n            this.onConfigure(info);\n        }\n    };\n\n    /**\n     * serialize the content\n     * @method serialize\n     */\n\n    LGraphNode.prototype.serialize = function() {\n        //create serialization object\n        var o = {\n            id: this.id,\n            type: this.type,\n            pos: this.pos,\n            size: this.size,\n            flags: LiteGraph.cloneObject(this.flags),\n\t\t\torder: this.order,\n            mode: this.mode\n        };\n\n        //special case for when there were errors\n        if (this.constructor === LGraphNode && this.last_serialization) {\n            return this.last_serialization;\n        }\n\n        if (this.inputs) {\n            o.inputs = this.inputs;\n        }\n\n        if (this.outputs) {\n            //clear outputs last data (because data in connections is never serialized but stored inside the outputs info)\n            for (var i = 0; i < this.outputs.length; i++) {\n                delete this.outputs[i]._data;\n            }\n            o.outputs = this.outputs;\n        }\n\n        if (this.title && this.title != this.constructor.title) {\n            o.title = this.title;\n        }\n\n        if (this.properties) {\n            o.properties = LiteGraph.cloneObject(this.properties);\n        }\n\n        if (this.widgets && this.serialize_widgets) {\n            o.widgets_values = [];\n            for (var i = 0; i < this.widgets.length; ++i) {\n\t\t\t\tif(this.widgets[i])\n\t                o.widgets_values[i] = this.widgets[i].value;\n\t\t\t\telse\n\t\t\t\t\to.widgets_values[i] = null;\n            }\n        }\n\n        if (!o.type) {\n            o.type = this.constructor.type;\n        }\n\n        if (this.color) {\n            o.color = this.color;\n        }\n        if (this.bgcolor) {\n            o.bgcolor = this.bgcolor;\n        }\n        if (this.boxcolor) {\n            o.boxcolor = this.boxcolor;\n        }\n        if (this.shape) {\n            o.shape = this.shape;\n        }\n\n        if (this.onSerialize) {\n            if (this.onSerialize(o)) {\n                console.warn(\n                    \"node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter\"\n                );\n            }\n        }\n\n        return o;\n    };\n\n    /* Creates a clone of this node */\n    LGraphNode.prototype.clone = function() {\n        var node = LiteGraph.createNode(this.type);\n        if (!node) {\n            return null;\n        }\n\n        //we clone it because serialize returns shared containers\n        var data = LiteGraph.cloneObject(this.serialize());\n\n        //remove links\n        if (data.inputs) {\n            for (var i = 0; i < data.inputs.length; ++i) {\n                data.inputs[i].link = null;\n            }\n        }\n\n        if (data.outputs) {\n            for (var i = 0; i < data.outputs.length; ++i) {\n                if (data.outputs[i].links) {\n                    data.outputs[i].links.length = 0;\n                }\n            }\n        }\n\n        delete data[\"id\"];\n\n        if (LiteGraph.use_uuids) {\n            data[\"id\"] = LiteGraph.uuidv4()\n        }\n\n        //remove links\n        node.configure(data);\n\n        return node;\n    };\n\n    /**\n     * serialize and stringify\n     * @method toString\n     */\n\n    LGraphNode.prototype.toString = function() {\n        return JSON.stringify(this.serialize());\n    };\n    //LGraphNode.prototype.deserialize = function(info) {} //this cannot be done from within, must be done in LiteGraph\n\n    /**\n     * get the title string\n     * @method getTitle\n     */\n\n    LGraphNode.prototype.getTitle = function() {\n        return this.title || this.constructor.title;\n    };\n\n    /**\n     * sets the value of a property\n     * @method setProperty\n     * @param {String} name\n     * @param {*} value\n     */\n    LGraphNode.prototype.setProperty = function(name, value) {\n        if (!this.properties) {\n            this.properties = {};\n        }\n\t\tif( value === this.properties[name] )\n\t\t\treturn;\n\t\tvar prev_value = this.properties[name];\n        this.properties[name] = value;\n        if (this.onPropertyChanged) {\n            if( this.onPropertyChanged(name, value, prev_value) === false ) //abort change\n\t\t\t\tthis.properties[name] = prev_value;\n        }\n\t\tif(this.widgets) //widgets could be linked to properties\n\t\t\tfor(var i = 0; i < this.widgets.length; ++i)\n\t\t\t{\n\t\t\t\tvar w = this.widgets[i];\n\t\t\t\tif(!w)\n\t\t\t\t\tcontinue;\n\t\t\t\tif(w.options.property == name)\n\t\t\t\t{\n\t\t\t\t\tw.value = value;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n    };\n\n    // Execution *************************\n    /**\n     * sets the output data\n     * @method setOutputData\n     * @param {number} slot\n     * @param {*} data\n     */\n    LGraphNode.prototype.setOutputData = function(slot, data) {\n        if (!this.outputs) {\n            return;\n        }\n\n        //this maybe slow and a niche case\n        //if(slot && slot.constructor === String)\n        //\tslot = this.findOutputSlot(slot);\n\n        if (slot == -1 || slot >= this.outputs.length) {\n            return;\n        }\n\n        var output_info = this.outputs[slot];\n        if (!output_info) {\n            return;\n        }\n\n        //store data in the output itself in case we want to debug\n        output_info._data = data;\n\n        //if there are connections, pass the data to the connections\n        if (this.outputs[slot].links) {\n            for (var i = 0; i < this.outputs[slot].links.length; i++) {\n                var link_id = this.outputs[slot].links[i];\n\t\t\t\tvar link = this.graph.links[link_id];\n\t\t\t\tif(link)\n\t\t\t\t\tlink.data = data;\n            }\n        }\n    };\n\n    /**\n     * sets the output data type, useful when you want to be able to overwrite the data type\n     * @method setOutputDataType\n     * @param {number} slot\n     * @param {String} datatype\n     */\n    LGraphNode.prototype.setOutputDataType = function(slot, type) {\n        if (!this.outputs) {\n            return;\n        }\n        if (slot == -1 || slot >= this.outputs.length) {\n            return;\n        }\n        var output_info = this.outputs[slot];\n        if (!output_info) {\n            return;\n        }\n        //store data in the output itself in case we want to debug\n        output_info.type = type;\n\n        //if there are connections, pass the data to the connections\n        if (this.outputs[slot].links) {\n            for (var i = 0; i < this.outputs[slot].links.length; i++) {\n                var link_id = this.outputs[slot].links[i];\n                this.graph.links[link_id].type = type;\n            }\n        }\n    };\n\n    /**\n     * Retrieves the input data (data traveling through the connection) from one slot\n     * @method getInputData\n     * @param {number} slot\n     * @param {boolean} force_update if set to true it will force the connected node of this slot to output data into this link\n     * @return {*} data or if it is not connected returns undefined\n     */\n    LGraphNode.prototype.getInputData = function(slot, force_update) {\n        if (!this.inputs) {\n            return;\n        } //undefined;\n\n        if (slot >= this.inputs.length || this.inputs[slot].link == null) {\n            return;\n        }\n\n        var link_id = this.inputs[slot].link;\n        var link = this.graph.links[link_id];\n        if (!link) {\n            //bug: weird case but it happens sometimes\n            return null;\n        }\n\n        if (!force_update) {\n            return link.data;\n        }\n\n        //special case: used to extract data from the incoming connection before the graph has been executed\n        var node = this.graph.getNodeById(link.origin_id);\n        if (!node) {\n            return link.data;\n        }\n\n        if (node.updateOutputData) {\n            node.updateOutputData(link.origin_slot);\n        } else if (node.onExecute) {\n            node.onExecute();\n        }\n\n        return link.data;\n    };\n\n    /**\n     * Retrieves the input data type (in case this supports multiple input types)\n     * @method getInputDataType\n     * @param {number} slot\n     * @return {String} datatype in string format\n     */\n    LGraphNode.prototype.getInputDataType = function(slot) {\n        if (!this.inputs) {\n            return null;\n        } //undefined;\n\n        if (slot >= this.inputs.length || this.inputs[slot].link == null) {\n            return null;\n        }\n        var link_id = this.inputs[slot].link;\n        var link = this.graph.links[link_id];\n        if (!link) {\n            //bug: weird case but it happens sometimes\n            return null;\n        }\n        var node = this.graph.getNodeById(link.origin_id);\n        if (!node) {\n            return link.type;\n        }\n        var output_info = node.outputs[link.origin_slot];\n        if (output_info) {\n            return output_info.type;\n        }\n        return null;\n    };\n\n    /**\n     * Retrieves the input data from one slot using its name instead of slot number\n     * @method getInputDataByName\n     * @param {String} slot_name\n     * @param {boolean} force_update if set to true it will force the connected node of this slot to output data into this link\n     * @return {*} data or if it is not connected returns null\n     */\n    LGraphNode.prototype.getInputDataByName = function(\n        slot_name,\n        force_update\n    ) {\n        var slot = this.findInputSlot(slot_name);\n        if (slot == -1) {\n            return null;\n        }\n        return this.getInputData(slot, force_update);\n    };\n\n    /**\n     * tells you if there is a connection in one input slot\n     * @method isInputConnected\n     * @param {number} slot\n     * @return {boolean}\n     */\n    LGraphNode.prototype.isInputConnected = function(slot) {\n        if (!this.inputs) {\n            return false;\n        }\n        return slot < this.inputs.length && this.inputs[slot].link != null;\n    };\n\n    /**\n     * tells you info about an input connection (which node, type, etc)\n     * @method getInputInfo\n     * @param {number} slot\n     * @return {Object} object or null { link: id, name: string, type: string or 0 }\n     */\n    LGraphNode.prototype.getInputInfo = function(slot) {\n        if (!this.inputs) {\n            return null;\n        }\n        if (slot < this.inputs.length) {\n            return this.inputs[slot];\n        }\n        return null;\n    };\n\n    /**\n     * Returns the link info in the connection of an input slot\n     * @method getInputLink\n     * @param {number} slot\n     * @return {LLink} object or null\n     */\n    LGraphNode.prototype.getInputLink = function(slot) {\n        if (!this.inputs) {\n            return null;\n        }\n        if (slot < this.inputs.length) {\n            var slot_info = this.inputs[slot];\n\t\t\treturn this.graph.links[ slot_info.link ];\n        }\n        return null;\n    };\n\n    /**\n     * returns the node connected in the input slot\n     * @method getInputNode\n     * @param {number} slot\n     * @return {LGraphNode} node or null\n     */\n    LGraphNode.prototype.getInputNode = function(slot) {\n        if (!this.inputs) {\n            return null;\n        }\n        if (slot >= this.inputs.length) {\n            return null;\n        }\n        var input = this.inputs[slot];\n        if (!input || input.link === null) {\n            return null;\n        }\n        var link_info = this.graph.links[input.link];\n        if (!link_info) {\n            return null;\n        }\n        return this.graph.getNodeById(link_info.origin_id);\n    };\n\n    /**\n     * returns the value of an input with this name, otherwise checks if there is a property with that name\n     * @method getInputOrProperty\n     * @param {string} name\n     * @return {*} value\n     */\n    LGraphNode.prototype.getInputOrProperty = function(name) {\n        if (!this.inputs || !this.inputs.length) {\n            return this.properties ? this.properties[name] : null;\n        }\n\n        for (var i = 0, l = this.inputs.length; i < l; ++i) {\n            var input_info = this.inputs[i];\n            if (name == input_info.name && input_info.link != null) {\n                var link = this.graph.links[input_info.link];\n                if (link) {\n                    return link.data;\n                }\n            }\n        }\n        return this.properties[name];\n    };\n\n    /**\n     * tells you the last output data that went in that slot\n     * @method getOutputData\n     * @param {number} slot\n     * @return {Object}  object or null\n     */\n    LGraphNode.prototype.getOutputData = function(slot) {\n        if (!this.outputs) {\n            return null;\n        }\n        if (slot >= this.outputs.length) {\n            return null;\n        }\n\n        var info = this.outputs[slot];\n        return info._data;\n    };\n\n    /**\n     * tells you info about an output connection (which node, type, etc)\n     * @method getOutputInfo\n     * @param {number} slot\n     * @return {Object}  object or null { name: string, type: string, links: [ ids of links in number ] }\n     */\n    LGraphNode.prototype.getOutputInfo = function(slot) {\n        if (!this.outputs) {\n            return null;\n        }\n        if (slot < this.outputs.length) {\n            return this.outputs[slot];\n        }\n        return null;\n    };\n\n    /**\n     * tells you if there is a connection in one output slot\n     * @method isOutputConnected\n     * @param {number} slot\n     * @return {boolean}\n     */\n    LGraphNode.prototype.isOutputConnected = function(slot) {\n        if (!this.outputs) {\n            return false;\n        }\n        return (\n            slot < this.outputs.length &&\n            this.outputs[slot].links &&\n            this.outputs[slot].links.length\n        );\n    };\n\n    /**\n     * tells you if there is any connection in the output slots\n     * @method isAnyOutputConnected\n     * @return {boolean}\n     */\n    LGraphNode.prototype.isAnyOutputConnected = function() {\n        if (!this.outputs) {\n            return false;\n        }\n        for (var i = 0; i < this.outputs.length; ++i) {\n            if (this.outputs[i].links && this.outputs[i].links.length) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    /**\n     * retrieves all the nodes connected to this output slot\n     * @method getOutputNodes\n     * @param {number} slot\n     * @return {array}\n     */\n    LGraphNode.prototype.getOutputNodes = function(slot) {\n        if (!this.outputs || this.outputs.length == 0) {\n            return null;\n        }\n\n        if (slot >= this.outputs.length) {\n            return null;\n        }\n\n        var output = this.outputs[slot];\n        if (!output.links || output.links.length == 0) {\n            return null;\n        }\n\n        var r = [];\n        for (var i = 0; i < output.links.length; i++) {\n            var link_id = output.links[i];\n            var link = this.graph.links[link_id];\n            if (link) {\n                var target_node = this.graph.getNodeById(link.target_id);\n                if (target_node) {\n                    r.push(target_node);\n                }\n            }\n        }\n        return r;\n    };\n\n    LGraphNode.prototype.addOnTriggerInput = function(){\n        var trigS = this.findInputSlot(\"onTrigger\");\n        if (trigS == -1){ //!trigS || \n            var input = this.addInput(\"onTrigger\", LiteGraph.EVENT, {optional: true, nameLocked: true});\n            return this.findInputSlot(\"onTrigger\");\n        }\n        return trigS;\n    }\n    \n    LGraphNode.prototype.addOnExecutedOutput = function(){\n        var trigS = this.findOutputSlot(\"onExecuted\");\n        if (trigS == -1){ //!trigS || \n            var output = this.addOutput(\"onExecuted\", LiteGraph.ACTION, {optional: true, nameLocked: true});\n            return this.findOutputSlot(\"onExecuted\");\n        }\n        return trigS;\n    }\n    \n    LGraphNode.prototype.onAfterExecuteNode = function(param, options){\n        var trigS = this.findOutputSlot(\"onExecuted\");\n        if (trigS != -1){\n            \n            //console.debug(this.id+\":\"+this.order+\" triggering slot onAfterExecute\");\n            //console.debug(param);\n            //console.debug(options);\n            this.triggerSlot(trigS, param, null, options);\n            \n        }\n    }    \n    \n    LGraphNode.prototype.changeMode = function(modeTo){\n        switch(modeTo){\n            case LiteGraph.ON_EVENT:\n                // this.addOnExecutedOutput();\n                break;\n                \n            case LiteGraph.ON_TRIGGER:\n                this.addOnTriggerInput();\n                this.addOnExecutedOutput();\n                break;\n                \n            case LiteGraph.NEVER:\n                break;\n                \n            case LiteGraph.ALWAYS:\n                break;\n                \n            case LiteGraph.ON_REQUEST:\n                break;\n            \n            default:\n                return false;\n                break;\n        }\n        this.mode = modeTo;\n        return true;\n    };\n\n    /**\n     * Triggers the execution of actions that were deferred when the action was triggered\n     * @method executePendingActions\n     */    \n    LGraphNode.prototype.executePendingActions = function() {\n        if(!this._waiting_actions || !this._waiting_actions.length)\n            return;\n        for(var i = 0; i < this._waiting_actions.length;++i)\n        {\n            var p = this._waiting_actions[i];\n            this.onAction(p[0],p[1],p[2],p[3],p[4]);\n        }        \n        this._waiting_actions.length = 0;\n    }\n\n    \n    /**\n     * Triggers the node code execution, place a boolean/counter to mark the node as being executed\n     * @method doExecute\n     * @param {*} param\n     * @param {*} options\n     */\n    LGraphNode.prototype.doExecute = function(param, options) {\n        options = options || {};\n        if (this.onExecute){\n            \n            // enable this to give the event an ID\n\t\t\tif (!options.action_call) options.action_call = this.id+\"_exec_\"+Math.floor(Math.random()*9999);\n            \n            this.graph.nodes_executing[this.id] = true; //.push(this.id);\n\n            this.onExecute(param, options);\n            \n            this.graph.nodes_executing[this.id] = false; //.pop();\n            \n            // save execution/action ref\n            this.exec_version = this.graph.iteration;\n            if(options && options.action_call){\n                this.action_call = options.action_call; // if (param)\n                this.graph.nodes_executedAction[this.id] = options.action_call;\n            }\n        }\n        else {\n        }\n        this.execute_triggered = 2; // the nFrames it will be used (-- each step), means \"how old\" is the event\n        if(this.onAfterExecuteNode) this.onAfterExecuteNode(param, options); // callback\n    };\n    \n    /**\n     * Triggers an action, wrapped by logics to control execution flow\n     * @method actionDo\n     * @param {String} action name\n     * @param {*} param\n     */\n    LGraphNode.prototype.actionDo = function(action, param, options, action_slot ) {\n        options = options || {};\n        if (this.onAction){\n            \n\t\t\t// enable this to give the event an ID\n            if (!options.action_call) options.action_call = this.id+\"_\"+(action?action:\"action\")+\"_\"+Math.floor(Math.random()*9999);\n            \n            this.graph.nodes_actioning[this.id] = (action?action:\"actioning\"); //.push(this.id);\n            \n            this.onAction(action, param, options, action_slot);\n            \n            this.graph.nodes_actioning[this.id] = false; //.pop();\n            \n            // save execution/action ref\n            if(options && options.action_call){\n                this.action_call = options.action_call; // if (param)\n                this.graph.nodes_executedAction[this.id] = options.action_call;\n            }\n        }\n        this.action_triggered = 2; // the nFrames it will be used (-- each step), means \"how old\" is the event\n        if(this.onAfterExecuteNode) this.onAfterExecuteNode(param, options);\n    };\n    \n    /**\n     * Triggers an event in this node, this will trigger any output with the same name\n     * @method trigger\n     * @param {String} event name ( \"on_play\", ... ) if action is equivalent to false then the event is send to all\n     * @param {*} param\n     */\n    LGraphNode.prototype.trigger = function(action, param, options) {\n        if (!this.outputs || !this.outputs.length) {\n            return;\n        }\n\n        if (this.graph)\n            this.graph._last_trigger_time = LiteGraph.getTime();\n\n        for (var i = 0; i < this.outputs.length; ++i) {\n            var output = this.outputs[i];\n            if ( !output || output.type !== LiteGraph.EVENT || (action && output.name != action) )\n                continue;\n            this.triggerSlot(i, param, null, options);\n        }\n    };\n\n    /**\n     * Triggers a slot event in this node: cycle output slots and launch execute/action on connected nodes\n     * @method triggerSlot\n     * @param {Number} slot the index of the output slot\n     * @param {*} param\n     * @param {Number} link_id [optional] in case you want to trigger and specific output link in a slot\n     */\n    LGraphNode.prototype.triggerSlot = function(slot, param, link_id, options) {\n        options = options || {};\n        if (!this.outputs) {\n            return;\n        }\n\n\t\tif(slot == null)\n\t\t{\n\t\t\tconsole.error(\"slot must be a number\");\n\t\t\treturn;\n\t\t}\n\n\t\tif(slot.constructor !== Number)\n\t\t\tconsole.warn(\"slot must be a number, use node.trigger('name') if you want to use a string\");\n\n        var output = this.outputs[slot];\n        if (!output) {\n            return;\n        }\n\n        var links = output.links;\n        if (!links || !links.length) {\n            return;\n        }\n\n        if (this.graph) {\n            this.graph._last_trigger_time = LiteGraph.getTime();\n        }\n\n        //for every link attached here\n        for (var k = 0; k < links.length; ++k) {\n            var id = links[k];\n            if (link_id != null && link_id != id) {\n                //to skip links\n                continue;\n            }\n            var link_info = this.graph.links[links[k]];\n            if (!link_info) {\n                //not connected\n                continue;\n            }\n            link_info._last_time = LiteGraph.getTime();\n            var node = this.graph.getNodeById(link_info.target_id);\n            if (!node) {\n                //node not found?\n                continue;\n            }\n\n            //used to mark events in graph\n            var target_connection = node.inputs[link_info.target_slot];\n\n\t\t\tif (node.mode === LiteGraph.ON_TRIGGER)\n\t\t\t{\n\t\t\t\t// generate unique trigger ID if not present\n\t\t\t\tif (!options.action_call) options.action_call = this.id+\"_trigg_\"+Math.floor(Math.random()*9999);\n                if (node.onExecute) {\n                    // -- wrapping node.onExecute(param); --\n                    node.doExecute(param, options);\n                }\n\t\t\t}\n\t\t\telse if (node.onAction) {\n                // generate unique action ID if not present\n\t\t\t\tif (!options.action_call) options.action_call = this.id+\"_act_\"+Math.floor(Math.random()*9999);\n                //pass the action name\n                var target_connection = node.inputs[link_info.target_slot];\n\n                //instead of executing them now, it will be executed in the next graph loop, to ensure data flow\n                if(LiteGraph.use_deferred_actions && node.onExecute)\n                {\n                    if(!node._waiting_actions)\n                        node._waiting_actions = [];\n                    node._waiting_actions.push([target_connection.name, param, options, link_info.target_slot]);\n                }\n                else\n                {\n                    // wrap node.onAction(target_connection.name, param);\n                    node.actionDo( target_connection.name, param, options, link_info.target_slot );\n                }\n            }\n        }\n    };\n\n    /**\n     * clears the trigger slot animation\n     * @method clearTriggeredSlot\n     * @param {Number} slot the index of the output slot\n     * @param {Number} link_id [optional] in case you want to trigger and specific output link in a slot\n     */\n    LGraphNode.prototype.clearTriggeredSlot = function(slot, link_id) {\n        if (!this.outputs) {\n            return;\n        }\n\n        var output = this.outputs[slot];\n        if (!output) {\n            return;\n        }\n\n        var links = output.links;\n        if (!links || !links.length) {\n            return;\n        }\n\n        //for every link attached here\n        for (var k = 0; k < links.length; ++k) {\n            var id = links[k];\n            if (link_id != null && link_id != id) {\n                //to skip links\n                continue;\n            }\n            var link_info = this.graph.links[links[k]];\n            if (!link_info) {\n                //not connected\n                continue;\n            }\n            link_info._last_time = 0;\n        }\n    };\n\n    /**\n     * changes node size and triggers callback\n     * @method setSize\n     * @param {vec2} size\n     */\n    LGraphNode.prototype.setSize = function(size)\n\t{\n\t\tthis.size = size;\n\t\tif(this.onResize)\n\t\t\tthis.onResize(this.size);\n\t}\n\n    /**\n     * add a new property to this node\n     * @method addProperty\n     * @param {string} name\n     * @param {*} default_value\n     * @param {string} type string defining the output type (\"vec3\",\"number\",...)\n     * @param {Object} extra_info this can be used to have special properties of the property (like values, etc)\n     */\n    LGraphNode.prototype.addProperty = function(\n        name,\n        default_value,\n        type,\n        extra_info\n    ) {\n        var o = { name: name, type: type, default_value: default_value };\n        if (extra_info) {\n            for (var i in extra_info) {\n                o[i] = extra_info[i];\n            }\n        }\n        if (!this.properties_info) {\n            this.properties_info = [];\n        }\n        this.properties_info.push(o);\n        if (!this.properties) {\n            this.properties = {};\n        }\n        this.properties[name] = default_value;\n        return o;\n    };\n\n    //connections\n\n    /**\n     * add a new output slot to use in this node\n     * @method addOutput\n     * @param {string} name\n     * @param {string} type string defining the output type (\"vec3\",\"number\",...)\n     * @param {Object} extra_info this can be used to have special properties of an output (label, special color, position, etc)\n     */\n    LGraphNode.prototype.addOutput = function(name, type, extra_info) {\n        var output = { name: name, type: type, links: null };\n        if (extra_info) {\n            for (var i in extra_info) {\n                output[i] = extra_info[i];\n            }\n        }\n\n        if (!this.outputs) {\n            this.outputs = [];\n        }\n        this.outputs.push(output);\n        if (this.onOutputAdded) {\n            this.onOutputAdded(output);\n        }\n        \n        if (LiteGraph.auto_load_slot_types) LiteGraph.registerNodeAndSlotType(this,type,true);\n        \n        this.setSize( this.computeSize() );\n        this.setDirtyCanvas(true, true);\n        return output;\n    };\n\n    /**\n     * add a new output slot to use in this node\n     * @method addOutputs\n     * @param {Array} array of triplets like [[name,type,extra_info],[...]]\n     */\n    LGraphNode.prototype.addOutputs = function(array) {\n        for (var i = 0; i < array.length; ++i) {\n            var info = array[i];\n            var o = { name: info[0], type: info[1], link: null };\n            if (array[2]) {\n                for (var j in info[2]) {\n                    o[j] = info[2][j];\n                }\n            }\n\n            if (!this.outputs) {\n                this.outputs = [];\n            }\n            this.outputs.push(o);\n            if (this.onOutputAdded) {\n                this.onOutputAdded(o);\n            }\n            \n            if (LiteGraph.auto_load_slot_types) LiteGraph.registerNodeAndSlotType(this,info[1],true);\n            \n        }\n\n        this.setSize( this.computeSize() );\n        this.setDirtyCanvas(true, true);\n    };\n\n    /**\n     * remove an existing output slot\n     * @method removeOutput\n     * @param {number} slot\n     */\n    LGraphNode.prototype.removeOutput = function(slot) {\n        this.disconnectOutput(slot);\n        this.outputs.splice(slot, 1);\n        for (var i = slot; i < this.outputs.length; ++i) {\n            if (!this.outputs[i] || !this.outputs[i].links) {\n                continue;\n            }\n            var links = this.outputs[i].links;\n            for (var j = 0; j < links.length; ++j) {\n                var link = this.graph.links[links[j]];\n                if (!link) {\n                    continue;\n                }\n                link.origin_slot -= 1;\n            }\n        }\n\n        this.setSize( this.computeSize() );\n        if (this.onOutputRemoved) {\n            this.onOutputRemoved(slot);\n        }\n        this.setDirtyCanvas(true, true);\n    };\n\n    /**\n     * add a new input slot to use in this node\n     * @method addInput\n     * @param {string} name\n     * @param {string} type string defining the input type (\"vec3\",\"number\",...), it its a generic one use 0\n     * @param {Object} extra_info this can be used to have special properties of an input (label, color, position, etc)\n     */\n    LGraphNode.prototype.addInput = function(name, type, extra_info) {\n        type = type || 0;\n        var input = { name: name, type: type, link: null };\n        if (extra_info) {\n            for (var i in extra_info) {\n                input[i] = extra_info[i];\n            }\n        }\n\n        if (!this.inputs) {\n            this.inputs = [];\n        }\n\n        this.inputs.push(input);\n        this.setSize( this.computeSize() );\n\n        if (this.onInputAdded) {\n            this.onInputAdded(input);\n\t\t}\n        \n        LiteGraph.registerNodeAndSlotType(this,type);\n\n        this.setDirtyCanvas(true, true);\n        return input;\n    };\n\n    /**\n     * add several new input slots in this node\n     * @method addInputs\n     * @param {Array} array of triplets like [[name,type,extra_info],[...]]\n     */\n    LGraphNode.prototype.addInputs = function(array) {\n        for (var i = 0; i < array.length; ++i) {\n            var info = array[i];\n            var o = { name: info[0], type: info[1], link: null };\n            if (array[2]) {\n                for (var j in info[2]) {\n                    o[j] = info[2][j];\n                }\n            }\n\n            if (!this.inputs) {\n                this.inputs = [];\n            }\n            this.inputs.push(o);\n            if (this.onInputAdded) {\n                this.onInputAdded(o);\n            }\n            \n            LiteGraph.registerNodeAndSlotType(this,info[1]);\n        }\n\n        this.setSize( this.computeSize() );\n        this.setDirtyCanvas(true, true);\n    };\n\n    /**\n     * remove an existing input slot\n     * @method removeInput\n     * @param {number} slot\n     */\n    LGraphNode.prototype.removeInput = function(slot) {\n        this.disconnectInput(slot);\n        var slot_info = this.inputs.splice(slot, 1);\n        for (var i = slot; i < this.inputs.length; ++i) {\n            if (!this.inputs[i]) {\n                continue;\n            }\n            var link = this.graph.links[this.inputs[i].link];\n            if (!link) {\n                continue;\n            }\n            link.target_slot -= 1;\n        }\n        this.setSize( this.computeSize() );\n        if (this.onInputRemoved) {\n            this.onInputRemoved(slot, slot_info[0] );\n        }\n        this.setDirtyCanvas(true, true);\n    };\n\n    /**\n     * add an special connection to this node (used for special kinds of graphs)\n     * @method addConnection\n     * @param {string} name\n     * @param {string} type string defining the input type (\"vec3\",\"number\",...)\n     * @param {[x,y]} pos position of the connection inside the node\n     * @param {string} direction if is input or output\n     */\n    LGraphNode.prototype.addConnection = function(name, type, pos, direction) {\n        var o = {\n            name: name,\n            type: type,\n            pos: pos,\n            direction: direction,\n            links: null\n        };\n        this.connections.push(o);\n        return o;\n    };\n\n    /**\n     * computes the minimum size of a node according to its inputs and output slots\n     * @method computeSize\n     * @param {vec2} minHeight\n     * @return {vec2} the total size\n     */\n    LGraphNode.prototype.computeSize = function(out) {\n        if (this.constructor.size) {\n            return this.constructor.size.concat();\n        }\n\n        var rows = Math.max(\n            this.inputs ? this.inputs.length : 1,\n            this.outputs ? this.outputs.length : 1\n        );\n        var size = out || new Float32Array([0, 0]);\n        rows = Math.max(rows, 1);\n        var font_size = LiteGraph.NODE_TEXT_SIZE; //although it should be graphcanvas.inner_text_font size\n\n        var title_width = compute_text_size(this.title);\n        var input_width = 0;\n        var output_width = 0;\n\n        if (this.inputs) {\n            for (var i = 0, l = this.inputs.length; i < l; ++i) {\n                var input = this.inputs[i];\n                var text = input.label || input.name || \"\";\n                var text_width = compute_text_size(text);\n                if (input_width < text_width) {\n                    input_width = text_width;\n                }\n            }\n        }\n\n        if (this.outputs) {\n            for (var i = 0, l = this.outputs.length; i < l; ++i) {\n                var output = this.outputs[i];\n                var text = output.label || output.name || \"\";\n                var text_width = compute_text_size(text);\n                if (output_width < text_width) {\n                    output_width = text_width;\n                }\n            }\n        }\n\n        size[0] = Math.max(input_width + output_width + 10, title_width);\n        size[0] = Math.max(size[0], LiteGraph.NODE_WIDTH);\n        if (this.widgets && this.widgets.length) {\n            size[0] = Math.max(size[0], LiteGraph.NODE_WIDTH * 1.5);\n        }\n\n        size[1] = (this.constructor.slot_start_y || 0) + rows * LiteGraph.NODE_SLOT_HEIGHT;\n\n        var widgets_height = 0;\n        if (this.widgets && this.widgets.length) {\n            for (var i = 0, l = this.widgets.length; i < l; ++i) {\n                if (this.widgets[i].computeSize)\n                    widgets_height += this.widgets[i].computeSize(size[0])[1] + 4;\n                else\n                    widgets_height += LiteGraph.NODE_WIDGET_HEIGHT + 4;\n            }\n            widgets_height += 8;\n        }\n\n        //compute height using widgets height\n        if( this.widgets_up )\n            size[1] = Math.max( size[1], widgets_height );\n        else if( this.widgets_start_y != null )\n            size[1] = Math.max( size[1], widgets_height + this.widgets_start_y );\n        else\n            size[1] += widgets_height;\n\n        function compute_text_size(text) {\n            if (!text) {\n                return 0;\n            }\n            return font_size * text.length * 0.6;\n        }\n\n        if (\n            this.constructor.min_height &&\n            size[1] < this.constructor.min_height\n        ) {\n            size[1] = this.constructor.min_height;\n        }\n\n        size[1] += 6; //margin\n\n        return size;\n    };\n\n    /**\n     * returns all the info available about a property of this node.\n     *\n     * @method getPropertyInfo\n     * @param {String} property name of the property\n     * @return {Object} the object with all the available info\n    */\n    LGraphNode.prototype.getPropertyInfo = function( property )\n\t{\n        var info = null;\n\n\t\t//there are several ways to define info about a property\n\t\t//legacy mode\n\t\tif (this.properties_info) {\n            for (var i = 0; i < this.properties_info.length; ++i) {\n                if (this.properties_info[i].name == property) {\n                    info = this.properties_info[i];\n                    break;\n                }\n            }\n        }\n\t\t//litescene mode using the constructor\n\t\tif(this.constructor[\"@\" + property])\n\t\t\tinfo = this.constructor[\"@\" + property];\n\n\t\tif(this.constructor.widgets_info && this.constructor.widgets_info[property])\n\t\t\tinfo = this.constructor.widgets_info[property];\n\n\t\t//litescene mode using the constructor\n\t\tif (!info && this.onGetPropertyInfo) {\n            info = this.onGetPropertyInfo(property);\n        }\n\n        if (!info)\n            info = {};\n\t\tif(!info.type)\n\t\t\tinfo.type = typeof this.properties[property];\n\t\tif(info.widget == \"combo\")\n\t\t\tinfo.type = \"enum\";\n\n\t\treturn info;\n\t}\n\n    /**\n     * Defines a widget inside the node, it will be rendered on top of the node, you can control lots of properties\n     *\n     * @method addWidget\n     * @param {String} type the widget type (could be \"number\",\"string\",\"combo\"\n     * @param {String} name the text to show on the widget\n     * @param {String} value the default value\n     * @param {Function|String} callback function to call when it changes (optionally, it can be the name of the property to modify)\n     * @param {Object} options the object that contains special properties of this widget \n     * @return {Object} the created widget object\n     */\n    LGraphNode.prototype.addWidget = function( type, name, value, callback, options )\n\t{\n        if (!this.widgets) {\n            this.widgets = [];\n        }\n\n\t\tif(!options && callback && callback.constructor === Object)\n\t\t{\n\t\t\toptions = callback;\n\t\t\tcallback = null;\n\t\t}\n\n\t\tif(options && options.constructor === String) //options can be the property name\n\t\t\toptions = { property: options };\n\n\t\tif(callback && callback.constructor === String) //callback can be the property name\n\t\t{\n\t\t\tif(!options)\n\t\t\t\toptions = {};\n\t\t\toptions.property = callback;\n\t\t\tcallback = null;\n\t\t}\n\n\t\tif(callback && callback.constructor !== Function)\n\t\t{\n\t\t\tconsole.warn(\"addWidget: callback must be a function\");\n\t\t\tcallback = null;\n\t\t}\n\n        var w = {\n            type: type.toLowerCase(),\n            name: name,\n            value: value,\n            callback: callback,\n            options: options || {}\n        };\n\n        if (w.options.y !== undefined) {\n            w.y = w.options.y;\n        }\n\n        if (!callback && !w.options.callback && !w.options.property) {\n            console.warn(\"LiteGraph addWidget(...) without a callback or property assigned\");\n        }\n        if (type == \"combo\" && !w.options.values) {\n            throw \"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }\";\n        }\n        this.widgets.push(w);\n\t\tthis.setSize( this.computeSize() );\n        return w;\n    };\n\n    LGraphNode.prototype.addCustomWidget = function(custom_widget) {\n        if (!this.widgets) {\n            this.widgets = [];\n        }\n        this.widgets.push(custom_widget);\n        return custom_widget;\n    };\n\n    /**\n     * returns the bounding of the object, used for rendering purposes\n     * @method getBounding\n     * @param out {Float32Array[4]?} [optional] a place to store the output, to free garbage\n     * @param compute_outer {boolean?} [optional] set to true to include the shadow and connection points in the bounding calculation\n     * @return {Float32Array[4]} the bounding box in format of [topleft_cornerx, topleft_cornery, width, height]\n     */\n    LGraphNode.prototype.getBounding = function(out, compute_outer) {\n        out = out || new Float32Array(4);\n        const nodePos = this.pos;\n        const isCollapsed = this.flags.collapsed;\n        const nodeSize = this.size;\n        \n        let left_offset = 0;\n        // 1 offset due to how nodes are rendered\n        let right_offset =  1 ;\n        let top_offset = 0;\n        let bottom_offset = 0;\n        \n        if (compute_outer) {\n            // 4 offset for collapsed node connection points\n            left_offset = 4;\n            // 6 offset for right shadow and collapsed node connection points\n            right_offset = 6 + left_offset;\n            // 4 offset for collapsed nodes top connection points\n            top_offset = 4;\n            // 5 offset for bottom shadow and collapsed node connection points\n            bottom_offset = 5 + top_offset;\n        }\n        \n        out[0] = nodePos[0] - left_offset;\n        out[1] = nodePos[1] - LiteGraph.NODE_TITLE_HEIGHT - top_offset;\n        out[2] = isCollapsed ?\n            (this._collapsed_width || LiteGraph.NODE_COLLAPSED_WIDTH) + right_offset :\n            nodeSize[0] + right_offset;\n        out[3] = isCollapsed ?\n            LiteGraph.NODE_TITLE_HEIGHT + bottom_offset :\n            nodeSize[1] + LiteGraph.NODE_TITLE_HEIGHT + bottom_offset;\n\n        if (this.onBounding) {\n            this.onBounding(out);\n        }\n        return out;\n    };\n\n    /**\n     * checks if a point is inside the shape of a node\n     * @method isPointInside\n     * @param {number} x\n     * @param {number} y\n     * @return {boolean}\n     */\n    LGraphNode.prototype.isPointInside = function(x, y, margin, skip_title) {\n        margin = margin || 0;\n\n        var margin_top = this.graph && this.graph.isLive() ? 0 : LiteGraph.NODE_TITLE_HEIGHT;\n        if (skip_title) {\n            margin_top = 0;\n        }\n        if (this.flags && this.flags.collapsed) {\n            //if ( distance([x,y], [this.pos[0] + this.size[0]*0.5, this.pos[1] + this.size[1]*0.5]) < LiteGraph.NODE_COLLAPSED_RADIUS)\n            if (\n                isInsideRectangle(\n                    x,\n                    y,\n                    this.pos[0] - margin,\n                    this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT - margin,\n                    (this._collapsed_width || LiteGraph.NODE_COLLAPSED_WIDTH) +\n                        2 * margin,\n                    LiteGraph.NODE_TITLE_HEIGHT + 2 * margin\n                )\n            ) {\n                return true;\n            }\n        } else if (\n            this.pos[0] - 4 - margin < x &&\n            this.pos[0] + this.size[0] + 4 + margin > x &&\n            this.pos[1] - margin_top - margin < y &&\n            this.pos[1] + this.size[1] + margin > y\n        ) {\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * checks if a point is inside a node slot, and returns info about which slot\n     * @method getSlotInPosition\n     * @param {number} x\n     * @param {number} y\n     * @return {Object} if found the object contains { input|output: slot object, slot: number, link_pos: [x,y] }\n     */\n    LGraphNode.prototype.getSlotInPosition = function(x, y) {\n        //search for inputs\n        var link_pos = new Float32Array(2);\n        if (this.inputs) {\n            for (var i = 0, l = this.inputs.length; i < l; ++i) {\n                var input = this.inputs[i];\n                this.getConnectionPos(true, i, link_pos);\n                if (\n                    isInsideRectangle(\n                        x,\n                        y,\n                        link_pos[0] - 10,\n                        link_pos[1] - 5,\n                        20,\n                        10\n                    )\n                ) {\n                    return { input: input, slot: i, link_pos: link_pos };\n                }\n            }\n        }\n\n        if (this.outputs) {\n            for (var i = 0, l = this.outputs.length; i < l; ++i) {\n                var output = this.outputs[i];\n                this.getConnectionPos(false, i, link_pos);\n                if (\n                    isInsideRectangle(\n                        x,\n                        y,\n                        link_pos[0] - 10,\n                        link_pos[1] - 5,\n                        20,\n                        10\n                    )\n                ) {\n                    return { output: output, slot: i, link_pos: link_pos };\n                }\n            }\n        }\n\n        return null;\n    };\n\n    /**\n     * returns the input slot with a given name (used for dynamic slots), -1 if not found\n     * @method findInputSlot\n     * @param {string} name the name of the slot\n     * @param {boolean} returnObj if the obj itself wanted\n     * @return {number_or_object} the slot (-1 if not found)\n     */\n    LGraphNode.prototype.findInputSlot = function(name,  returnObj) {\n        if (!this.inputs) {\n            return -1;\n        }\n        for (var i = 0, l = this.inputs.length; i < l; ++i) {\n            if (name == this.inputs[i].name) {\n                return !returnObj ? i : this.inputs[i];\n            }\n        }\n        return -1;\n    };\n\n    /**\n     * returns the output slot with a given name (used for dynamic slots), -1 if not found\n     * @method findOutputSlot\n     * @param {string} name the name of the slot\n     * @param {boolean} returnObj if the obj itself wanted\n     * @return {number_or_object} the slot (-1 if not found)\n     */\n    LGraphNode.prototype.findOutputSlot = function(name, returnObj) {\n        returnObj = returnObj || false;\n        if (!this.outputs) {\n            return -1;\n        }\n        for (var i = 0, l = this.outputs.length; i < l; ++i) {\n            if (name == this.outputs[i].name) {\n                return !returnObj ? i : this.outputs[i];\n            }\n        }\n        return -1;\n    };\n    \n    // TODO refactor: USE SINGLE findInput/findOutput functions! :: merge options\n    \n    /**\n     * returns the first free input slot\n     * @method findInputSlotFree\n     * @param {object} options\n     * @return {number_or_object} the slot (-1 if not found)\n     */\n    LGraphNode.prototype.findInputSlotFree = function(optsIn) {\n        var optsIn = optsIn || {};\n        var optsDef = {returnObj: false\n                        ,typesNotAccepted: []\n                      };\n        var opts = Object.assign(optsDef,optsIn);\n        if (!this.inputs) {\n            return -1;\n        }\n        for (var i = 0, l = this.inputs.length; i < l; ++i) {\n            if (this.inputs[i].link && this.inputs[i].link != null) {\n                continue;\n            }\n            if (opts.typesNotAccepted && opts.typesNotAccepted.includes && opts.typesNotAccepted.includes(this.inputs[i].type)){\n                continue;\n            }\n            return !opts.returnObj ? i : this.inputs[i];\n        }\n        return -1;\n    };\n\n    /**\n     * returns the first output slot free\n     * @method findOutputSlotFree\n     * @param {object} options\n     * @return {number_or_object} the slot (-1 if not found)\n     */\n    LGraphNode.prototype.findOutputSlotFree = function(optsIn) {\n        var optsIn = optsIn || {};\n        var optsDef = { returnObj: false\n                        ,typesNotAccepted: []\n                      };\n        var opts = Object.assign(optsDef,optsIn);\n        if (!this.outputs) {\n            return -1;\n        }\n        for (var i = 0, l = this.outputs.length; i < l; ++i) {\n            if (this.outputs[i].links && this.outputs[i].links != null) {\n                continue;\n            }\n            if (opts.typesNotAccepted && opts.typesNotAccepted.includes && opts.typesNotAccepted.includes(this.outputs[i].type)){\n                continue;\n            }\n            return !opts.returnObj ? i : this.outputs[i];\n        }\n        return -1;\n    };\n    \n    /**\n     * findSlotByType for INPUTS\n     */\n    LGraphNode.prototype.findInputSlotByType = function(type, returnObj, preferFreeSlot, doNotUseOccupied) {\n        return this.findSlotByType(true, type, returnObj, preferFreeSlot, doNotUseOccupied);\n    };\n\n    /**\n     * findSlotByType for OUTPUTS\n     */\n    LGraphNode.prototype.findOutputSlotByType = function(type, returnObj, preferFreeSlot, doNotUseOccupied) {\n        return this.findSlotByType(false, type, returnObj, preferFreeSlot, doNotUseOccupied);\n    };\n    \n    /**\n     * returns the output (or input) slot with a given type, -1 if not found\n     * @method findSlotByType\n     * @param {boolean} input uise inputs instead of outputs\n     * @param {string} type the type of the slot\n     * @param {boolean} returnObj if the obj itself wanted\n     * @param {boolean} preferFreeSlot if we want a free slot (if not found, will return the first of the type anyway)\n     * @return {number_or_object} the slot (-1 if not found)\n     */\n    LGraphNode.prototype.findSlotByType = function(input, type, returnObj, preferFreeSlot, doNotUseOccupied) {\n        input = input || false;\n        returnObj = returnObj || false;\n        preferFreeSlot = preferFreeSlot || false;\n        doNotUseOccupied = doNotUseOccupied || false;\n        var aSlots = input ? this.inputs : this.outputs;\n        if (!aSlots) {\n            return -1;\n        }\n\t\t// !! empty string type is considered 0, * !!\n\t\tif (type == \"\" || type == \"*\") type = 0; \n        for (var i = 0, l = aSlots.length; i < l; ++i) {\n            var tFound = false;\n            var aSource = (type+\"\").toLowerCase().split(\",\");\n            var aDest = aSlots[i].type==\"0\"||aSlots[i].type==\"*\"?\"0\":aSlots[i].type;\n\t\t\taDest = (aDest+\"\").toLowerCase().split(\",\");\n            for(var sI=0;sI<aSource.length;sI++){\n                for(var dI=0;dI<aDest.length;dI++){\n\t\t\t\t\tif (aSource[sI]==\"_event_\") aSource[sI] = LiteGraph.EVENT;\n\t\t\t\t\tif (aDest[sI]==\"_event_\") aDest[sI] = LiteGraph.EVENT;\n\t\t\t\t\tif (aSource[sI]==\"*\") aSource[sI] = 0;\n\t\t\t\t\tif (aDest[sI]==\"*\") aDest[sI] = 0;\n\t\t\t\t\tif (aSource[sI] == aDest[dI]) {\n                        if (preferFreeSlot && aSlots[i].links && aSlots[i].links !== null) continue;\n                        return !returnObj ? i : aSlots[i];\n                    }\n                }\n            }\n        }\n        // if didnt find some, stop checking for free slots\n        if (preferFreeSlot && !doNotUseOccupied){\n            for (var i = 0, l = aSlots.length; i < l; ++i) {\n                var tFound = false;\n                var aSource = (type+\"\").toLowerCase().split(\",\");\n                var aDest = aSlots[i].type==\"0\"||aSlots[i].type==\"*\"?\"0\":aSlots[i].type;\n\t\t\t\taDest = (aDest+\"\").toLowerCase().split(\",\");\n                for(var sI=0;sI<aSource.length;sI++){\n                    for(var dI=0;dI<aDest.length;dI++){\n\t\t\t\t\t\tif (aSource[sI]==\"*\") aSource[sI] = 0;\n\t\t\t\t\t\tif (aDest[sI]==\"*\") aDest[sI] = 0;\n                        if (aSource[sI] == aDest[dI]) {\n                            return !returnObj ? i : aSlots[i];\n                        }\n                    }\n                }\n            }\n        }\n        return -1;\n    };\n\n    /**\n     * connect this node output to the input of another node BY TYPE\n     * @method connectByType\n     * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n     * @param {LGraphNode} node the target node\n     * @param {string} target_type the input slot type of the target node\n     * @return {Object} the link_info is created, otherwise null\n     */\n    LGraphNode.prototype.connectByType = function(slot, target_node, target_slotType, optsIn) {\n        var optsIn = optsIn || {};\n        var optsDef = { createEventInCase: true\n\t\t\t\t\t   \t,firstFreeIfOutputGeneralInCase: true\n                        ,generalTypeInCase: true\n                      };\n        var opts = Object.assign(optsDef,optsIn);\n        if (target_node && target_node.constructor === Number) {\n            target_node = this.graph.getNodeById(target_node);\n        }\n        var target_slot = target_node.findInputSlotByType(target_slotType, false, true);\n        if (target_slot >= 0 && target_slot !== null){\n            //console.debug(\"CONNbyTYPE type \"+target_slotType+\" for \"+target_slot)\n            return this.connect(slot, target_node, target_slot);\n        }else{\n            //console.log(\"type \"+target_slotType+\" not found or not free?\")\n            if (opts.createEventInCase && target_slotType == LiteGraph.EVENT){\n                // WILL CREATE THE onTrigger IN SLOT\n\t\t\t\t//console.debug(\"connect WILL CREATE THE onTrigger \"+target_slotType+\" to \"+target_node);\n                return this.connect(slot, target_node, -1);\n            }\n\t\t\t// connect to the first general output slot if not found a specific type and \n            if (opts.generalTypeInCase){\n                var target_slot = target_node.findInputSlotByType(0, false, true, true);\n\t\t\t\t//console.debug(\"connect TO a general type (*, 0), if not found the specific type \",target_slotType,\" to \",target_node,\"RES_SLOT:\",target_slot);\n                if (target_slot >= 0){\n                    return this.connect(slot, target_node, target_slot);\n                }\n            }\n            // connect to the first free input slot if not found a specific type and this output is general\n            if (opts.firstFreeIfOutputGeneralInCase && (target_slotType == 0 || target_slotType == \"*\" || target_slotType == \"\")){\n                var target_slot = target_node.findInputSlotFree({typesNotAccepted: [LiteGraph.EVENT] });\n\t\t\t\t//console.debug(\"connect TO TheFirstFREE \",target_slotType,\" to \",target_node,\"RES_SLOT:\",target_slot);\n                if (target_slot >= 0){\n\t\t\t\t\treturn this.connect(slot, target_node, target_slot);\n                }\n            }\n\t\t\t\n\t\t\tconsole.debug(\"no way to connect type: \",target_slotType,\" to targetNODE \",target_node);\n\t\t\t//TODO filter\n\t\t\t\n            return null;\n        }\n    }\n    \n    /**\n     * connect this node input to the output of another node BY TYPE\n     * @method connectByType\n     * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n     * @param {LGraphNode} node the target node\n     * @param {string} target_type the output slot type of the target node\n     * @return {Object} the link_info is created, otherwise null\n     */\n    LGraphNode.prototype.connectByTypeOutput = function(slot, source_node, source_slotType, optsIn) {\n        var optsIn = optsIn || {};\n        var optsDef = { createEventInCase: true\n                        ,firstFreeIfInputGeneralInCase: true\n                        ,generalTypeInCase: true\n                      };\n        var opts = Object.assign(optsDef,optsIn);\n        if (source_node && source_node.constructor === Number) {\n            source_node = this.graph.getNodeById(source_node);\n        }\n        var source_slot = source_node.findOutputSlotByType(source_slotType, false, true);\n        if (source_slot >= 0 && source_slot !== null){\n            //console.debug(\"CONNbyTYPE OUT! type \"+source_slotType+\" for \"+source_slot)\n            return source_node.connect(source_slot, this, slot);\n        }else{\n            \n            // connect to the first general output slot if not found a specific type and \n            if (opts.generalTypeInCase){\n                var source_slot = source_node.findOutputSlotByType(0, false, true, true);\n                if (source_slot >= 0){\n                    return source_node.connect(source_slot, this, slot);\n                }\n            }\n            \n            if (opts.createEventInCase && source_slotType == LiteGraph.EVENT){\n                // WILL CREATE THE onExecuted OUT SLOT\n\t\t\t\tif (LiteGraph.do_add_triggers_slots){\n\t\t\t\t\tvar source_slot = source_node.addOnExecutedOutput();\n\t\t\t\t\treturn source_node.connect(source_slot, this, slot);\n\t\t\t\t}\n            }\n            // connect to the first free output slot if not found a specific type and this input is general\n            if (opts.firstFreeIfInputGeneralInCase && (source_slotType == 0 || source_slotType == \"*\" || source_slotType == \"\")){\n                var source_slot = source_node.findOutputSlotFree({typesNotAccepted: [LiteGraph.EVENT] });\n                if (source_slot >= 0){\n                    return source_node.connect(source_slot, this, slot);\n                }\n            }\n            \n\t\t\tconsole.debug(\"no way to connect byOUT type: \",source_slotType,\" to sourceNODE \",source_node);\n\t\t\t//TODO filter\n\t\t\t\n            //console.log(\"type OUT! \"+source_slotType+\" not found or not free?\")\n            return null;\n        }\n    }\n    \n    /**\n     * connect this node output to the input of another node\n     * @method connect\n     * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n     * @param {LGraphNode} node the target node\n     * @param {number_or_string} target_slot the input slot of the target node (could be the number of the slot or the string with the name of the slot, or -1 to connect a trigger)\n     * @return {Object} the link_info is created, otherwise null\n     */\n    LGraphNode.prototype.connect = function(slot, target_node, target_slot) {\n        target_slot = target_slot || 0;\n\n        if (!this.graph) {\n            //could be connected before adding it to a graph\n            console.log(\n                \"Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them.\"\n            ); //due to link ids being associated with graphs\n            return null;\n        }\n\n        //seek for the output slot\n        if (slot.constructor === String) {\n            slot = this.findOutputSlot(slot);\n            if (slot == -1) {\n                if (LiteGraph.debug) {\n                    console.log(\"Connect: Error, no slot of name \" + slot);\n                }\n                return null;\n            }\n        } else if (!this.outputs || slot >= this.outputs.length) {\n            if (LiteGraph.debug) {\n                console.log(\"Connect: Error, slot number not found\");\n            }\n            return null;\n        }\n\n        if (target_node && target_node.constructor === Number) {\n            target_node = this.graph.getNodeById(target_node);\n        }\n        if (!target_node) {\n            throw \"target node is null\";\n        }\n\n        //avoid loopback\n        if (target_node == this) {\n            return null;\n        }\n\n        //you can specify the slot by name\n        if (target_slot.constructor === String) {\n            target_slot = target_node.findInputSlot(target_slot);\n            if (target_slot == -1) {\n                if (LiteGraph.debug) {\n                    console.log(\n                        \"Connect: Error, no slot of name \" + target_slot\n                    );\n                }\n                return null;\n            }\n        } else if (target_slot === LiteGraph.EVENT) {\n            \n            if (LiteGraph.do_add_triggers_slots){\n\t            //search for first slot with event? :: NO this is done outside\n\t\t\t\t//console.log(\"Connect: Creating triggerEvent\");\n\t            // force mode\n\t            target_node.changeMode(LiteGraph.ON_TRIGGER);\n\t            target_slot = target_node.findInputSlot(\"onTrigger\");\n        \t}else{\n            \treturn null; // -- break --\n\t\t\t}\n        } else if (\n            !target_node.inputs ||\n            target_slot >= target_node.inputs.length\n        ) {\n            if (LiteGraph.debug) {\n                console.log(\"Connect: Error, slot number not found\");\n            }\n            return null;\n        }\n\n\t\tvar changed = false;\n\n        var input = target_node.inputs[target_slot];\n        var link_info = null;\n        var output = this.outputs[slot];\n        \n        if (!this.outputs[slot]){\n            /*console.debug(\"Invalid slot passed: \"+slot);\n            console.debug(this.outputs);*/\n            return null;\n        }\n\n        // allow target node to change slot\n        if (target_node.onBeforeConnectInput) {\n            // This way node can choose another slot (or make a new one?)\n            target_slot = target_node.onBeforeConnectInput(target_slot); //callback\n        }\n\n\t\t//check target_slot and check connection types\n        if (target_slot===false || target_slot===null || !LiteGraph.isValidConnection(output.type, input.type))\n\t\t{\n\t        this.setDirtyCanvas(false, true);\n\t\t\tif(changed)\n\t\t        this.graph.connectionChange(this, link_info);\n\t\t\treturn null;\n\t\t}else{\n\t\t\t//console.debug(\"valid connection\",output.type, input.type);\n\t\t}\n\n        //allows nodes to block connection, callback\n        if (target_node.onConnectInput) {\n            if ( target_node.onConnectInput(target_slot, output.type, output, this, slot) === false ) {\n                return null;\n            }\n        }\n        if (this.onConnectOutput) { // callback\n            if ( this.onConnectOutput(slot, input.type, input, target_node, target_slot) === false ) {\n                return null;\n            }\n        }\n\n        //if there is something already plugged there, disconnect\n        if (target_node.inputs[target_slot] && target_node.inputs[target_slot].link != null) {\n\t\t\tthis.graph.beforeChange();\n            target_node.disconnectInput(target_slot, {doProcessChange: false});\n\t\t\tchanged = true;\n        }\n        if (output.links !== null && output.links.length){\n            switch(output.type){\n                case LiteGraph.EVENT:\n                    if (!LiteGraph.allow_multi_output_for_events){\n                        this.graph.beforeChange();\n                        this.disconnectOutput(slot, false, {doProcessChange: false}); // Input(target_slot, {doProcessChange: false});\n                        changed = true;\n                    }\n                break;\n                default:\n                break;\n            }\n        }\n\n        var nextId\n        if (LiteGraph.use_uuids)\n            nextId = LiteGraph.uuidv4();\n        else\n            nextId = ++this.graph.last_link_id;\n        \n\t\t//create link class\n\t\tlink_info = new LLink(\n\t\t\tnextId,\n\t\t\tinput.type || output.type,\n\t\t\tthis.id,\n\t\t\tslot,\n\t\t\ttarget_node.id,\n\t\t\ttarget_slot\n\t\t);\n\n\t\t//add to graph links list\n\t\tthis.graph.links[link_info.id] = link_info;\n\n\t\t//connect in output\n\t\tif (output.links == null) {\n\t\t\toutput.links = [];\n\t\t}\n\t\toutput.links.push(link_info.id);\n\t\t//connect in input\n\t\ttarget_node.inputs[target_slot].link = link_info.id;\n\t\tif (this.graph) {\n\t\t\tthis.graph._version++;\n\t\t}\n\t\tif (this.onConnectionsChange) {\n\t\t\tthis.onConnectionsChange(\n\t\t\t\tLiteGraph.OUTPUT,\n\t\t\t\tslot,\n\t\t\t\ttrue,\n\t\t\t\tlink_info,\n\t\t\t\toutput\n\t\t\t);\n\t\t} //link_info has been created now, so its updated\n\t\tif (target_node.onConnectionsChange) {\n\t\t\ttarget_node.onConnectionsChange(\n\t\t\t\tLiteGraph.INPUT,\n\t\t\t\ttarget_slot,\n\t\t\t\ttrue,\n\t\t\t\tlink_info,\n\t\t\t\tinput\n\t\t\t);\n\t\t}\n\t\tif (this.graph && this.graph.onNodeConnectionChange) {\n\t\t\tthis.graph.onNodeConnectionChange(\n\t\t\t\tLiteGraph.INPUT,\n\t\t\t\ttarget_node,\n\t\t\t\ttarget_slot,\n\t\t\t\tthis,\n\t\t\t\tslot\n\t\t\t);\n\t\t\tthis.graph.onNodeConnectionChange(\n\t\t\t\tLiteGraph.OUTPUT,\n\t\t\t\tthis,\n\t\t\t\tslot,\n\t\t\t\ttarget_node,\n\t\t\t\ttarget_slot\n\t\t\t);\n\t\t}\n\n        this.setDirtyCanvas(false, true);\n\t\tthis.graph.afterChange();\n\t\tthis.graph.connectionChange(this, link_info);\n\n        return link_info;\n    };\n\n    /**\n     * disconnect one output to an specific node\n     * @method disconnectOutput\n     * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n     * @param {LGraphNode} target_node the target node to which this slot is connected [Optional, if not target_node is specified all nodes will be disconnected]\n     * @return {boolean} if it was disconnected successfully\n     */\n    LGraphNode.prototype.disconnectOutput = function(slot, target_node) {\n        if (slot.constructor === String) {\n            slot = this.findOutputSlot(slot);\n            if (slot == -1) {\n                if (LiteGraph.debug) {\n                    console.log(\"Connect: Error, no slot of name \" + slot);\n                }\n                return false;\n            }\n        } else if (!this.outputs || slot >= this.outputs.length) {\n            if (LiteGraph.debug) {\n                console.log(\"Connect: Error, slot number not found\");\n            }\n            return false;\n        }\n\n        //get output slot\n        var output = this.outputs[slot];\n        if (!output || !output.links || output.links.length == 0) {\n            return false;\n        }\n\n        //one of the output links in this slot\n        if (target_node) {\n            if (target_node.constructor === Number) {\n                target_node = this.graph.getNodeById(target_node);\n            }\n            if (!target_node) {\n                throw \"Target Node not found\";\n            }\n\n            for (var i = 0, l = output.links.length; i < l; i++) {\n                var link_id = output.links[i];\n                var link_info = this.graph.links[link_id];\n\n                //is the link we are searching for...\n                if (link_info.target_id == target_node.id) {\n                    output.links.splice(i, 1); //remove here\n                    var input = target_node.inputs[link_info.target_slot];\n                    input.link = null; //remove there\n                    delete this.graph.links[link_id]; //remove the link from the links pool\n                    if (this.graph) {\n                        this.graph._version++;\n                    }\n                    if (target_node.onConnectionsChange) {\n                        target_node.onConnectionsChange(\n                            LiteGraph.INPUT,\n                            link_info.target_slot,\n                            false,\n                            link_info,\n                            input\n                        );\n                    } //link_info hasn't been modified so its ok\n                    if (this.onConnectionsChange) {\n                        this.onConnectionsChange(\n                            LiteGraph.OUTPUT,\n                            slot,\n                            false,\n                            link_info,\n                            output\n                        );\n                    }\n                    if (this.graph && this.graph.onNodeConnectionChange) {\n                        this.graph.onNodeConnectionChange(\n                            LiteGraph.OUTPUT,\n                            this,\n                            slot\n                        );\n                    }\n                    if (this.graph && this.graph.onNodeConnectionChange) {\n                        this.graph.onNodeConnectionChange(\n                            LiteGraph.OUTPUT,\n                            this,\n                            slot\n                        );\n                        this.graph.onNodeConnectionChange(\n                            LiteGraph.INPUT,\n                            target_node,\n                            link_info.target_slot\n                        );\n                    }\n                    break;\n                }\n            }\n        } //all the links in this output slot\n        else {\n            for (var i = 0, l = output.links.length; i < l; i++) {\n                var link_id = output.links[i];\n                var link_info = this.graph.links[link_id];\n                if (!link_info) {\n                    //bug: it happens sometimes\n                    continue;\n                }\n\n                var target_node = this.graph.getNodeById(link_info.target_id);\n                var input = null;\n                if (this.graph) {\n                    this.graph._version++;\n                }\n                if (target_node) {\n                    input = target_node.inputs[link_info.target_slot];\n                    input.link = null; //remove other side link\n                    if (target_node.onConnectionsChange) {\n                        target_node.onConnectionsChange(\n                            LiteGraph.INPUT,\n                            link_info.target_slot,\n                            false,\n                            link_info,\n                            input\n                        );\n                    } //link_info hasn't been modified so its ok\n                    if (this.graph && this.graph.onNodeConnectionChange) {\n                        this.graph.onNodeConnectionChange(\n                            LiteGraph.INPUT,\n                            target_node,\n                            link_info.target_slot\n                        );\n                    }\n                }\n                delete this.graph.links[link_id]; //remove the link from the links pool\n                if (this.onConnectionsChange) {\n                    this.onConnectionsChange(\n                        LiteGraph.OUTPUT,\n                        slot,\n                        false,\n                        link_info,\n                        output\n                    );\n                }\n                if (this.graph && this.graph.onNodeConnectionChange) {\n                    this.graph.onNodeConnectionChange(\n                        LiteGraph.OUTPUT,\n                        this,\n                        slot\n                    );\n                    this.graph.onNodeConnectionChange(\n                        LiteGraph.INPUT,\n                        target_node,\n                        link_info.target_slot\n                    );\n                }\n            }\n            output.links = null;\n        }\n\n        this.setDirtyCanvas(false, true);\n        this.graph.connectionChange(this);\n        return true;\n    };\n\n    /**\n     * disconnect one input\n     * @method disconnectInput\n     * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n     * @return {boolean} if it was disconnected successfully\n     */\n    LGraphNode.prototype.disconnectInput = function(slot) {\n        //seek for the output slot\n        if (slot.constructor === String) {\n            slot = this.findInputSlot(slot);\n            if (slot == -1) {\n                if (LiteGraph.debug) {\n                    console.log(\"Connect: Error, no slot of name \" + slot);\n                }\n                return false;\n            }\n        } else if (!this.inputs || slot >= this.inputs.length) {\n            if (LiteGraph.debug) {\n                console.log(\"Connect: Error, slot number not found\");\n            }\n            return false;\n        }\n\n        var input = this.inputs[slot];\n        if (!input) {\n            return false;\n        }\n\n        var link_id = this.inputs[slot].link;\n\t\tif(link_id != null)\n\t\t{\n\t\t\tthis.inputs[slot].link = null;\n\n\t\t\t//remove other side\n\t\t\tvar link_info = this.graph.links[link_id];\n\t\t\tif (link_info) {\n\t\t\t\tvar target_node = this.graph.getNodeById(link_info.origin_id);\n\t\t\t\tif (!target_node) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar output = target_node.outputs[link_info.origin_slot];\n\t\t\t\tif (!output || !output.links || output.links.length == 0) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t//search in the inputs list for this link\n\t\t\t\tfor (var i = 0, l = output.links.length; i < l; i++) {\n\t\t\t\t\tif (output.links[i] == link_id) {\n\t\t\t\t\t\toutput.links.splice(i, 1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tdelete this.graph.links[link_id]; //remove from the pool\n\t\t\t\tif (this.graph) {\n\t\t\t\t\tthis.graph._version++;\n\t\t\t\t}\n\t\t\t\tif (this.onConnectionsChange) {\n\t\t\t\t\tthis.onConnectionsChange(\n\t\t\t\t\t\tLiteGraph.INPUT,\n\t\t\t\t\t\tslot,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tlink_info,\n\t\t\t\t\t\tinput\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (target_node.onConnectionsChange) {\n\t\t\t\t\ttarget_node.onConnectionsChange(\n\t\t\t\t\t\tLiteGraph.OUTPUT,\n\t\t\t\t\t\ti,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tlink_info,\n\t\t\t\t\t\toutput\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (this.graph && this.graph.onNodeConnectionChange) {\n\t\t\t\t\tthis.graph.onNodeConnectionChange(\n\t\t\t\t\t\tLiteGraph.OUTPUT,\n\t\t\t\t\t\ttarget_node,\n\t\t\t\t\t\ti\n\t\t\t\t\t);\n\t\t\t\t\tthis.graph.onNodeConnectionChange(LiteGraph.INPUT, this, slot);\n\t\t\t\t}\n\t\t\t}\n\t\t} //link != null\n\n        this.setDirtyCanvas(false, true);\n\t\tif(this.graph)\n\t        this.graph.connectionChange(this);\n        return true;\n    };\n\n    /**\n     * returns the center of a connection point in canvas coords\n     * @method getConnectionPos\n     * @param {boolean} is_input true if if a input slot, false if it is an output\n     * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n     * @param {vec2} out [optional] a place to store the output, to free garbage\n     * @return {[x,y]} the position\n     **/\n    LGraphNode.prototype.getConnectionPos = function(\n        is_input,\n        slot_number,\n        out\n    ) {\n        out = out || new Float32Array(2);\n        var num_slots = 0;\n        if (is_input && this.inputs) {\n            num_slots = this.inputs.length;\n        }\n        if (!is_input && this.outputs) {\n            num_slots = this.outputs.length;\n        }\n\n        var offset = LiteGraph.NODE_SLOT_HEIGHT * 0.5;\n\n        if (this.flags.collapsed) {\n            var w = this._collapsed_width || LiteGraph.NODE_COLLAPSED_WIDTH;\n            if (this.horizontal) {\n                out[0] = this.pos[0] + w * 0.5;\n                if (is_input) {\n                    out[1] = this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT;\n                } else {\n                    out[1] = this.pos[1];\n                }\n            } else {\n                if (is_input) {\n                    out[0] = this.pos[0];\n                } else {\n                    out[0] = this.pos[0] + w;\n                }\n                out[1] = this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT * 0.5;\n            }\n            return out;\n        }\n\n        //weird feature that never got finished\n        if (is_input && slot_number == -1) {\n            out[0] = this.pos[0] + LiteGraph.NODE_TITLE_HEIGHT * 0.5;\n            out[1] = this.pos[1] + LiteGraph.NODE_TITLE_HEIGHT * 0.5;\n            return out;\n        }\n\n        //hard-coded pos\n        if (\n            is_input &&\n            num_slots > slot_number &&\n            this.inputs[slot_number].pos\n        ) {\n            out[0] = this.pos[0] + this.inputs[slot_number].pos[0];\n            out[1] = this.pos[1] + this.inputs[slot_number].pos[1];\n            return out;\n        } else if (\n            !is_input &&\n            num_slots > slot_number &&\n            this.outputs[slot_number].pos\n        ) {\n            out[0] = this.pos[0] + this.outputs[slot_number].pos[0];\n            out[1] = this.pos[1] + this.outputs[slot_number].pos[1];\n            return out;\n        }\n\n        //horizontal distributed slots\n        if (this.horizontal) {\n            out[0] =\n                this.pos[0] + (slot_number + 0.5) * (this.size[0] / num_slots);\n            if (is_input) {\n                out[1] = this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT;\n            } else {\n                out[1] = this.pos[1] + this.size[1];\n            }\n            return out;\n        }\n\n        //default vertical slots\n        if (is_input) {\n            out[0] = this.pos[0] + offset;\n        } else {\n            out[0] = this.pos[0] + this.size[0] + 1 - offset;\n        }\n        out[1] =\n            this.pos[1] +\n            (slot_number + 0.7) * LiteGraph.NODE_SLOT_HEIGHT +\n            (this.constructor.slot_start_y || 0);\n        return out;\n    };\n\n    /* Force align to grid */\n    LGraphNode.prototype.alignToGrid = function() {\n        this.pos[0] =\n            LiteGraph.CANVAS_GRID_SIZE *\n            Math.round(this.pos[0] / LiteGraph.CANVAS_GRID_SIZE);\n        this.pos[1] =\n            LiteGraph.CANVAS_GRID_SIZE *\n            Math.round(this.pos[1] / LiteGraph.CANVAS_GRID_SIZE);\n    };\n\n    /* Console output */\n    LGraphNode.prototype.trace = function(msg) {\n        if (!this.console) {\n            this.console = [];\n        }\n\n        this.console.push(msg);\n        if (this.console.length > LGraphNode.MAX_CONSOLE) {\n            this.console.shift();\n        }\n\n\t\tif(this.graph.onNodeTrace)\n\t        this.graph.onNodeTrace(this, msg);\n    };\n\n    /* Forces to redraw or the main canvas (LGraphNode) or the bg canvas (links) */\n    LGraphNode.prototype.setDirtyCanvas = function(\n        dirty_foreground,\n        dirty_background\n    ) {\n        if (!this.graph) {\n            return;\n        }\n        this.graph.sendActionToCanvas(\"setDirty\", [\n            dirty_foreground,\n            dirty_background\n        ]);\n    };\n\n    LGraphNode.prototype.loadImage = function(url) {\n        var img = new Image();\n        img.src = LiteGraph.node_images_path + url;\n        img.ready = false;\n\n        var that = this;\n        img.onload = function() {\n            this.ready = true;\n            that.setDirtyCanvas(true);\n        };\n        return img;\n    };\n\n    //safe LGraphNode action execution (not sure if safe)\n    /*\nLGraphNode.prototype.executeAction = function(action)\n{\n\tif(action == \"\") return false;\n\n\tif( action.indexOf(\";\") != -1 || action.indexOf(\"}\") != -1)\n\t{\n\t\tthis.trace(\"Error: Action contains unsafe characters\");\n\t\treturn false;\n\t}\n\n\tvar tokens = action.split(\"(\");\n\tvar func_name = tokens[0];\n\tif( typeof(this[func_name]) != \"function\")\n\t{\n\t\tthis.trace(\"Error: Action not found on node: \" + func_name);\n\t\treturn false;\n\t}\n\n\tvar code = action;\n\n\ttry\n\t{\n\t\tvar _foo = eval;\n\t\teval = null;\n\t\t(new Function(\"with(this) { \" + code + \"}\")).call(this);\n\t\teval = _foo;\n\t}\n\tcatch (err)\n\t{\n\t\tthis.trace(\"Error executing action {\" + action + \"} :\" + err);\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n*/\n\n    /* Allows to get onMouseMove and onMouseUp events even if the mouse is out of focus */\n    LGraphNode.prototype.captureInput = function(v) {\n        if (!this.graph || !this.graph.list_of_graphcanvas) {\n            return;\n        }\n\n        var list = this.graph.list_of_graphcanvas;\n\n        for (var i = 0; i < list.length; ++i) {\n            var c = list[i];\n            //releasing somebody elses capture?!\n            if (!v && c.node_capturing_input != this) {\n                continue;\n            }\n\n            //change\n            c.node_capturing_input = v ? this : null;\n        }\n    };\n\n    /**\n     * Collapse the node to make it smaller on the canvas\n     * @method collapse\n     **/\n    LGraphNode.prototype.collapse = function(force) {\n        this.graph._version++;\n        if (this.constructor.collapsable === false && !force) {\n            return;\n        }\n        if (!this.flags.collapsed) {\n            this.flags.collapsed = true;\n        } else {\n            this.flags.collapsed = false;\n        }\n        this.setDirtyCanvas(true, true);\n    };\n\n    /**\n     * Forces the node to do not move or realign on Z\n     * @method pin\n     **/\n\n    LGraphNode.prototype.pin = function(v) {\n        this.graph._version++;\n        if (v === undefined) {\n            this.flags.pinned = !this.flags.pinned;\n        } else {\n            this.flags.pinned = v;\n        }\n    };\n\n    LGraphNode.prototype.localToScreen = function(x, y, graphcanvas) {\n        return [\n            (x + this.pos[0]) * graphcanvas.scale + graphcanvas.offset[0],\n            (y + this.pos[1]) * graphcanvas.scale + graphcanvas.offset[1]\n        ];\n    };\n\n    function LGraphGroup(title) {\n        this._ctor(title);\n    }\n\n    global.LGraphGroup = LiteGraph.LGraphGroup = LGraphGroup;\n\n    LGraphGroup.prototype._ctor = function(title) {\n        this.title = title || \"Group\";\n        this.font_size = 24;\n        this.color = LGraphCanvas.node_colors.pale_blue\n            ? LGraphCanvas.node_colors.pale_blue.groupcolor\n            : \"#AAA\";\n        this._bounding = new Float32Array([10, 10, 140, 80]);\n        this._pos = this._bounding.subarray(0, 2);\n        this._size = this._bounding.subarray(2, 4);\n        this._nodes = [];\n        this.graph = null;\n\n        Object.defineProperty(this, \"pos\", {\n            set: function(v) {\n                if (!v || v.length < 2) {\n                    return;\n                }\n                this._pos[0] = v[0];\n                this._pos[1] = v[1];\n            },\n            get: function() {\n                return this._pos;\n            },\n            enumerable: true\n        });\n\n        Object.defineProperty(this, \"size\", {\n            set: function(v) {\n                if (!v || v.length < 2) {\n                    return;\n                }\n                this._size[0] = Math.max(140, v[0]);\n                this._size[1] = Math.max(80, v[1]);\n            },\n            get: function() {\n                return this._size;\n            },\n            enumerable: true\n        });\n    };\n\n    LGraphGroup.prototype.configure = function(o) {\n        this.title = o.title;\n        this._bounding.set(o.bounding);\n        this.color = o.color;\n        this.font_size = o.font_size;\n    };\n\n    LGraphGroup.prototype.serialize = function() {\n        var b = this._bounding;\n        return {\n            title: this.title,\n            bounding: [\n                Math.round(b[0]),\n                Math.round(b[1]),\n                Math.round(b[2]),\n                Math.round(b[3])\n            ],\n            color: this.color,\n            font_size: this.font_size\n        };\n    };\n\n    LGraphGroup.prototype.move = function(deltax, deltay, ignore_nodes) {\n        this._pos[0] += deltax;\n        this._pos[1] += deltay;\n        if (ignore_nodes) {\n            return;\n        }\n        for (var i = 0; i < this._nodes.length; ++i) {\n            var node = this._nodes[i];\n            node.pos[0] += deltax;\n            node.pos[1] += deltay;\n        }\n    };\n\n    LGraphGroup.prototype.recomputeInsideNodes = function() {\n        this._nodes.length = 0;\n        var nodes = this.graph._nodes;\n        var node_bounding = new Float32Array(4);\n\n        for (var i = 0; i < nodes.length; ++i) {\n            var node = nodes[i];\n            node.getBounding(node_bounding);\n            if (!overlapBounding(this._bounding, node_bounding)) {\n                continue;\n            } //out of the visible area\n            this._nodes.push(node);\n        }\n    };\n\n    LGraphGroup.prototype.isPointInside = LGraphNode.prototype.isPointInside;\n    LGraphGroup.prototype.setDirtyCanvas = LGraphNode.prototype.setDirtyCanvas;\n\n    //****************************************\n\n    //Scale and Offset\n    function DragAndScale(element, skip_events) {\n        this.offset = new Float32Array([0, 0]);\n        this.scale = 1;\n        this.max_scale = 10;\n        this.min_scale = 0.1;\n        this.onredraw = null;\n        this.enabled = true;\n        this.last_mouse = [0, 0];\n        this.element = null;\n        this.visible_area = new Float32Array(4);\n\n        if (element) {\n            this.element = element;\n            if (!skip_events) {\n                this.bindEvents(element);\n            }\n        }\n    }\n\n    LiteGraph.DragAndScale = DragAndScale;\n\n    DragAndScale.prototype.bindEvents = function(element) {\n        this.last_mouse = new Float32Array(2);\n\n        this._binded_mouse_callback = this.onMouse.bind(this);\n\n\t\tLiteGraph.pointerListenerAdd(element,\"down\", this._binded_mouse_callback);\n\t\tLiteGraph.pointerListenerAdd(element,\"move\", this._binded_mouse_callback);\n\t\tLiteGraph.pointerListenerAdd(element,\"up\", this._binded_mouse_callback);\n\n        element.addEventListener(\n            \"mousewheel\",\n            this._binded_mouse_callback,\n            false\n        );\n        element.addEventListener(\"wheel\", this._binded_mouse_callback, false);\n    };\n\n    DragAndScale.prototype.computeVisibleArea = function( viewport ) {\n        if (!this.element) {\n            this.visible_area[0] = this.visible_area[1] = this.visible_area[2] = this.visible_area[3] = 0;\n            return;\n        }\n        var width = this.element.width;\n        var height = this.element.height;\n        var startx = -this.offset[0];\n        var starty = -this.offset[1];\n\t\tif( viewport )\n\t\t{\n\t\t\tstartx += viewport[0] / this.scale;\n\t\t\tstarty += viewport[1] / this.scale;\n\t\t\twidth = viewport[2];\n\t\t\theight = viewport[3];\n\t\t}\n        var endx = startx + width / this.scale;\n        var endy = starty + height / this.scale;\n        this.visible_area[0] = startx;\n        this.visible_area[1] = starty;\n        this.visible_area[2] = endx - startx;\n        this.visible_area[3] = endy - starty;\n    };\n\n    DragAndScale.prototype.onMouse = function(e) {\n        if (!this.enabled) {\n            return;\n        }\n\n        var canvas = this.element;\n        var rect = canvas.getBoundingClientRect();\n        var x = e.clientX - rect.left;\n        var y = e.clientY - rect.top;\n        e.canvasx = x;\n        e.canvasy = y;\n        e.dragging = this.dragging;\n        \n\t\tvar is_inside = !this.viewport || ( this.viewport && x >= this.viewport[0] && x < (this.viewport[0] + this.viewport[2]) && y >= this.viewport[1] && y < (this.viewport[1] + this.viewport[3]) );\n\n\t\t//console.log(\"pointerevents: DragAndScale onMouse \"+e.type+\" \"+is_inside);\n\t\t\n        var ignore = false;\n        if (this.onmouse) {\n            ignore = this.onmouse(e);\n        }\n\n        if (e.type == LiteGraph.pointerevents_method+\"down\" && is_inside) {\n            this.dragging = true;\n\t\t\tLiteGraph.pointerListenerRemove(canvas,\"move\",this._binded_mouse_callback);\n\t\t\tLiteGraph.pointerListenerAdd(document,\"move\",this._binded_mouse_callback);\n\t\t\tLiteGraph.pointerListenerAdd(document,\"up\",this._binded_mouse_callback);\n        } else if (e.type == LiteGraph.pointerevents_method+\"move\") {\n            if (!ignore) {\n                var deltax = x - this.last_mouse[0];\n                var deltay = y - this.last_mouse[1];\n                if (this.dragging) {\n                    this.mouseDrag(deltax, deltay);\n                }\n            }\n        } else if (e.type == LiteGraph.pointerevents_method+\"up\") {\n            this.dragging = false;\n\t\t\tLiteGraph.pointerListenerRemove(document,\"move\",this._binded_mouse_callback);\n\t\t\tLiteGraph.pointerListenerRemove(document,\"up\",this._binded_mouse_callback);\n\t\t\tLiteGraph.pointerListenerAdd(canvas,\"move\",this._binded_mouse_callback);\n        } else if ( is_inside &&\n            (e.type == \"mousewheel\" ||\n            e.type == \"wheel\" ||\n            e.type == \"DOMMouseScroll\")\n        ) {\n            e.eventType = \"mousewheel\";\n            if (e.type == \"wheel\") {\n                e.wheel = -e.deltaY;\n            } else {\n                e.wheel =\n                    e.wheelDeltaY != null ? e.wheelDeltaY : e.detail * -60;\n            }\n\n            //from stack overflow\n            e.delta = e.wheelDelta\n                ? e.wheelDelta / 40\n                : e.deltaY\n                ? -e.deltaY / 3\n                : 0;\n            this.changeDeltaScale(1.0 + e.delta * 0.05);\n        }\n\n        this.last_mouse[0] = x;\n        this.last_mouse[1] = y;\n\n\t\tif(is_inside)\n\t\t{\n\t        e.preventDefault();\n\t\t    e.stopPropagation();\n\t\t    return false;\n\t\t}\n    };\n\n    DragAndScale.prototype.toCanvasContext = function(ctx) {\n        ctx.scale(this.scale, this.scale);\n        ctx.translate(this.offset[0], this.offset[1]);\n    };\n\n    DragAndScale.prototype.convertOffsetToCanvas = function(pos) {\n        //return [pos[0] / this.scale - this.offset[0], pos[1] / this.scale - this.offset[1]];\n        return [\n            (pos[0] + this.offset[0]) * this.scale,\n            (pos[1] + this.offset[1]) * this.scale\n        ];\n    };\n\n    DragAndScale.prototype.convertCanvasToOffset = function(pos, out) {\n        out = out || [0, 0];\n        out[0] = pos[0] / this.scale - this.offset[0];\n        out[1] = pos[1] / this.scale - this.offset[1];\n        return out;\n    };\n\n    DragAndScale.prototype.mouseDrag = function(x, y) {\n        this.offset[0] += x / this.scale;\n        this.offset[1] += y / this.scale;\n\n        if (this.onredraw) {\n            this.onredraw(this);\n        }\n    };\n\n    DragAndScale.prototype.changeScale = function(value, zooming_center) {\n        if (value < this.min_scale) {\n            value = this.min_scale;\n        } else if (value > this.max_scale) {\n            value = this.max_scale;\n        }\n\n        if (value == this.scale) {\n            return;\n        }\n\n        if (!this.element) {\n            return;\n        }\n\n        var rect = this.element.getBoundingClientRect();\n        if (!rect) {\n            return;\n        }\n\n        zooming_center = zooming_center || [\n            rect.width * 0.5,\n            rect.height * 0.5\n        ];\n        var center = this.convertCanvasToOffset(zooming_center);\n        this.scale = value;\n        if (Math.abs(this.scale - 1) < 0.01) {\n            this.scale = 1;\n        }\n\n        var new_center = this.convertCanvasToOffset(zooming_center);\n        var delta_offset = [\n            new_center[0] - center[0],\n            new_center[1] - center[1]\n        ];\n\n        this.offset[0] += delta_offset[0];\n        this.offset[1] += delta_offset[1];\n\n        if (this.onredraw) {\n            this.onredraw(this);\n        }\n    };\n\n    DragAndScale.prototype.changeDeltaScale = function(value, zooming_center) {\n        this.changeScale(this.scale * value, zooming_center);\n    };\n\n    DragAndScale.prototype.reset = function() {\n        this.scale = 1;\n        this.offset[0] = 0;\n        this.offset[1] = 0;\n    };\n\n    //*********************************************************************************\n    // LGraphCanvas: LGraph renderer CLASS\n    //*********************************************************************************\n\n    /**\n     * This class is in charge of rendering one graph inside a canvas. And provides all the interaction required.\n     * Valid callbacks are: onNodeSelected, onNodeDeselected, onShowNodePanel, onNodeDblClicked\n     *\n     * @class LGraphCanvas\n     * @constructor\n     * @param {HTMLCanvas} canvas the canvas where you want to render (it accepts a selector in string format or the canvas element itself)\n     * @param {LGraph} graph [optional]\n     * @param {Object} options [optional] { skip_rendering, autoresize, viewport }\n     */\n    function LGraphCanvas(canvas, graph, options) {\n        this.options = options = options || {};\n\n        //if(graph === undefined)\n        //\tthrow (\"No graph assigned\");\n        this.background_image = LGraphCanvas.DEFAULT_BACKGROUND_IMAGE;\n\n        if (canvas && canvas.constructor === String) {\n            canvas = document.querySelector(canvas);\n        }\n\n        this.ds = new DragAndScale();\n        this.zoom_modify_alpha = true; //otherwise it generates ugly patterns when scaling down too much\n\n        this.title_text_font = \"\" + LiteGraph.NODE_TEXT_SIZE + \"px Arial\";\n        this.inner_text_font =\n            \"normal \" + LiteGraph.NODE_SUBTEXT_SIZE + \"px Arial\";\n        this.node_title_color = LiteGraph.NODE_TITLE_COLOR;\n        this.default_link_color = LiteGraph.LINK_COLOR;\n        this.default_connection_color = {\n            input_off: \"#778\",\n            input_on: \"#7F7\", //\"#BBD\"\n            output_off: \"#778\",\n            output_on: \"#7F7\" //\"#BBD\"\n\t\t};\n        this.default_connection_color_byType = {\n            /*number: \"#7F7\",\n            string: \"#77F\",\n            boolean: \"#F77\",*/\n        }\n        this.default_connection_color_byTypeOff = {\n            /*number: \"#474\",\n            string: \"#447\",\n            boolean: \"#744\",*/\n        };\n\n        this.highquality_render = true;\n        this.use_gradients = false; //set to true to render titlebar with gradients\n        this.editor_alpha = 1; //used for transition\n        this.pause_rendering = false;\n        this.clear_background = true;\n        this.clear_background_color = \"#222\";\n\n\t\tthis.read_only = false; //if set to true users cannot modify the graph\n        this.render_only_selected = true;\n        this.live_mode = false;\n        this.show_info = true;\n        this.allow_dragcanvas = true;\n        this.allow_dragnodes = true;\n        this.allow_interaction = true; //allow to control widgets, buttons, collapse, etc\n        this.multi_select = false; //allow selecting multi nodes without pressing extra keys\n        this.allow_searchbox = true;\n        this.allow_reconnect_links = true; //allows to change a connection with having to redo it again\n\t\tthis.align_to_grid = false; //snap to grid\n\n        this.drag_mode = false;\n        this.dragging_rectangle = null;\n\n        this.filter = null; //allows to filter to only accept some type of nodes in a graph\n\n\t\tthis.set_canvas_dirty_on_mouse_event = true; //forces to redraw the canvas if the mouse does anything\n        this.always_render_background = false;\n        this.render_shadows = true;\n        this.render_canvas_border = true;\n        this.render_connections_shadows = false; //too much cpu\n        this.render_connections_border = true;\n        this.render_curved_connections = false;\n        this.render_connection_arrows = false;\n        this.render_collapsed_slots = true;\n        this.render_execution_order = false;\n        this.render_title_colored = true;\n\t\tthis.render_link_tooltip = true;\n\n        this.links_render_mode = LiteGraph.SPLINE_LINK;\n\n        this.mouse = [0, 0]; //mouse in canvas coordinates, where 0,0 is the top-left corner of the blue rectangle\n        this.graph_mouse = [0, 0]; //mouse in graph coordinates, where 0,0 is the top-left corner of the blue rectangle\n\t\tthis.canvas_mouse = this.graph_mouse; //LEGACY: REMOVE THIS, USE GRAPH_MOUSE INSTEAD\n\n        //to personalize the search box\n        this.onSearchBox = null;\n        this.onSearchBoxSelection = null;\n\n        //callbacks\n        this.onMouse = null;\n        this.onDrawBackground = null; //to render background objects (behind nodes and connections) in the canvas affected by transform\n        this.onDrawForeground = null; //to render foreground objects (above nodes and connections) in the canvas affected by transform\n        this.onDrawOverlay = null; //to render foreground objects not affected by transform (for GUIs)\n\t\tthis.onDrawLinkTooltip = null; //called when rendering a tooltip\n\t\tthis.onNodeMoved = null; //called after moving a node\n\t\tthis.onSelectionChange = null; //called if the selection changes\n\t\tthis.onConnectingChange = null; //called before any link changes\n\t\tthis.onBeforeChange = null; //called before modifying the graph\n\t\tthis.onAfterChange = null; //called after modifying the graph\n\n        this.connections_width = 3;\n        this.round_radius = 8;\n\n        this.current_node = null;\n        this.node_widget = null; //used for widgets\n\t\tthis.over_link_center = null;\n        this.last_mouse_position = [0, 0];\n        this.visible_area = this.ds.visible_area;\n        this.visible_links = [];\n\n\t\tthis.viewport = options.viewport || null; //to constraint render area to a portion of the canvas\n\n        //link canvas and graph\n        if (graph) {\n            graph.attachCanvas(this);\n        }\n\n        this.setCanvas(canvas,options.skip_events);\n        this.clear();\n\n        if (!options.skip_render) {\n            this.startRendering();\n        }\n\n        this.autoresize = options.autoresize;\n    }\n\n    global.LGraphCanvas = LiteGraph.LGraphCanvas = LGraphCanvas;\n\n\tLGraphCanvas.DEFAULT_BACKGROUND_IMAGE = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=\";\n\n    LGraphCanvas.link_type_colors = {\n        \"-1\": LiteGraph.EVENT_LINK_COLOR,\n        number: \"#AAA\",\n        node: \"#DCA\"\n    };\n    LGraphCanvas.gradients = {}; //cache of gradients\n\n    /**\n     * clears all the data inside\n     *\n     * @method clear\n     */\n    LGraphCanvas.prototype.clear = function() {\n        this.frame = 0;\n        this.last_draw_time = 0;\n        this.render_time = 0;\n        this.fps = 0;\n\n        //this.scale = 1;\n        //this.offset = [0,0];\n\n        this.dragging_rectangle = null;\n\n        this.selected_nodes = {};\n        this.selected_group = null;\n\n        this.visible_nodes = [];\n        this.node_dragged = null;\n        this.node_over = null;\n        this.node_capturing_input = null;\n        this.connecting_node = null;\n        this.highlighted_links = {};\n\n\t\tthis.dragging_canvas = false;\n\n        this.dirty_canvas = true;\n        this.dirty_bgcanvas = true;\n        this.dirty_area = null;\n\n        this.node_in_panel = null;\n        this.node_widget = null;\n\n        this.last_mouse = [0, 0];\n        this.last_mouseclick = 0;\n\t  \tthis.pointer_is_down = false;\n\t  \tthis.pointer_is_double = false;\n        this.visible_area.set([0, 0, 0, 0]);\n\n        if (this.onClear) {\n            this.onClear();\n        }\n    };\n\n    /**\n     * assigns a graph, you can reassign graphs to the same canvas\n     *\n     * @method setGraph\n     * @param {LGraph} graph\n     */\n    LGraphCanvas.prototype.setGraph = function(graph, skip_clear) {\n        if (this.graph == graph) {\n            return;\n        }\n\n        if (!skip_clear) {\n            this.clear();\n        }\n\n        if (!graph && this.graph) {\n            this.graph.detachCanvas(this);\n            return;\n        }\n\n        graph.attachCanvas(this);\n\n\t\t//remove the graph stack in case a subgraph was open\n\t\tif (this._graph_stack)\n\t\t\tthis._graph_stack = null;\n\n        this.setDirty(true, true);\n    };\n\n    /**\n     * returns the top level graph (in case there are subgraphs open on the canvas)\n     *\n     * @method getTopGraph\n     * @return {LGraph} graph\n     */\n\tLGraphCanvas.prototype.getTopGraph = function()\n\t{\n\t\tif(this._graph_stack.length)\n\t\t\treturn this._graph_stack[0];\n\t\treturn this.graph;\n\t}\n\n    /**\n     * opens a graph contained inside a node in the current graph\n     *\n     * @method openSubgraph\n     * @param {LGraph} graph\n     */\n    LGraphCanvas.prototype.openSubgraph = function(graph) {\n        if (!graph) {\n            throw \"graph cannot be null\";\n        }\n\n        if (this.graph == graph) {\n            throw \"graph cannot be the same\";\n        }\n\n        this.clear();\n\n        if (this.graph) {\n            if (!this._graph_stack) {\n                this._graph_stack = [];\n            }\n            this._graph_stack.push(this.graph);\n        }\n\n        graph.attachCanvas(this);\n\t\tthis.checkPanels();\n        this.setDirty(true, true);\n    };\n\n    /**\n     * closes a subgraph contained inside a node\n     *\n     * @method closeSubgraph\n     * @param {LGraph} assigns a graph\n     */\n    LGraphCanvas.prototype.closeSubgraph = function() {\n        if (!this._graph_stack || this._graph_stack.length == 0) {\n            return;\n        }\n        var subgraph_node = this.graph._subgraph_node;\n        var graph = this._graph_stack.pop();\n        this.selected_nodes = {};\n        this.highlighted_links = {};\n        graph.attachCanvas(this);\n        this.setDirty(true, true);\n        if (subgraph_node) {\n            this.centerOnNode(subgraph_node);\n            this.selectNodes([subgraph_node]);\n        }\n        // when close sub graph back to offset [0, 0] scale 1\n        this.ds.offset = [0, 0]\n        this.ds.scale = 1\n    };\n\n    /**\n     * returns the visually active graph (in case there are more in the stack)\n     * @method getCurrentGraph\n     * @return {LGraph} the active graph\n     */\n    LGraphCanvas.prototype.getCurrentGraph = function() {\n        return this.graph;\n    };\n\n    /**\n     * assigns a canvas\n     *\n     * @method setCanvas\n     * @param {Canvas} assigns a canvas (also accepts the ID of the element (not a selector)\n     */\n    LGraphCanvas.prototype.setCanvas = function(canvas, skip_events) {\n        var that = this;\n\n        if (canvas) {\n            if (canvas.constructor === String) {\n                canvas = document.getElementById(canvas);\n                if (!canvas) {\n                    throw \"Error creating LiteGraph canvas: Canvas not found\";\n                }\n            }\n        }\n\n        if (canvas === this.canvas) {\n            return;\n        }\n\n        if (!canvas && this.canvas) {\n            //maybe detach events from old_canvas\n            if (!skip_events) {\n                this.unbindEvents();\n            }\n        }\n\n        this.canvas = canvas;\n        this.ds.element = canvas;\n\n        if (!canvas) {\n            return;\n        }\n\n        //this.canvas.tabindex = \"1000\";\n        canvas.className += \" lgraphcanvas\";\n        canvas.data = this;\n        canvas.tabindex = \"1\"; //to allow key events\n\n        //bg canvas: used for non changing stuff\n        this.bgcanvas = null;\n        if (!this.bgcanvas) {\n            this.bgcanvas = document.createElement(\"canvas\");\n            this.bgcanvas.width = this.canvas.width;\n            this.bgcanvas.height = this.canvas.height;\n        }\n\n        if (canvas.getContext == null) {\n            if (canvas.localName != \"canvas\") {\n                throw \"Element supplied for LGraphCanvas must be a <canvas> element, you passed a \" +\n                    canvas.localName;\n            }\n            throw \"This browser doesn't support Canvas\";\n        }\n\n        var ctx = (this.ctx = canvas.getContext(\"2d\"));\n        if (ctx == null) {\n            if (!canvas.webgl_enabled) {\n                console.warn(\n                    \"This canvas seems to be WebGL, enabling WebGL renderer\"\n                );\n            }\n            this.enableWebGL();\n        }\n\n        //input:  (move and up could be unbinded)\n        // why here? this._mousemove_callback = this.processMouseMove.bind(this);\n        // why here? this._mouseup_callback = this.processMouseUp.bind(this);\n\n        if (!skip_events) {\n            this.bindEvents();\n        }\n    };\n\n    //used in some events to capture them\n    LGraphCanvas.prototype._doNothing = function doNothing(e) {\n    \t//console.log(\"pointerevents: _doNothing \"+e.type);\n        e.preventDefault();\n        return false;\n    };\n    LGraphCanvas.prototype._doReturnTrue = function doNothing(e) {\n        e.preventDefault();\n        return true;\n    };\n\n    /**\n     * binds mouse, keyboard, touch and drag events to the canvas\n     * @method bindEvents\n     **/\n    LGraphCanvas.prototype.bindEvents = function() {\n        if (this._events_binded) {\n            console.warn(\"LGraphCanvas: events already binded\");\n            return;\n        }\n\n        //console.log(\"pointerevents: bindEvents\");\n        \n        var canvas = this.canvas;\n\n        var ref_window = this.getCanvasWindow();\n        var document = ref_window.document; //hack used when moving canvas between windows\n\n        this._mousedown_callback = this.processMouseDown.bind(this);\n        this._mousewheel_callback = this.processMouseWheel.bind(this);\n        // why mousemove and mouseup were not binded here?\n        this._mousemove_callback = this.processMouseMove.bind(this);\n        this._mouseup_callback = this.processMouseUp.bind(this);\n        \n        //touch events -- TODO IMPLEMENT\n        //this._touch_callback = this.touchHandler.bind(this);\n\n\t\tLiteGraph.pointerListenerAdd(canvas,\"down\", this._mousedown_callback, true); //down do not need to store the binded\n        canvas.addEventListener(\"mousewheel\", this._mousewheel_callback, false);\n\n        LiteGraph.pointerListenerAdd(canvas,\"up\", this._mouseup_callback, true); // CHECK: ??? binded or not\n\t\tLiteGraph.pointerListenerAdd(canvas,\"move\", this._mousemove_callback);\n        \n        canvas.addEventListener(\"contextmenu\", this._doNothing);\n        canvas.addEventListener(\n            \"DOMMouseScroll\",\n            this._mousewheel_callback,\n            false\n        );\n\n        //touch events -- THIS WAY DOES NOT WORK, finish implementing pointerevents, than clean the touchevents\n        /*if( 'touchstart' in document.documentElement )\n        {\n            canvas.addEventListener(\"touchstart\", this._touch_callback, true);\n            canvas.addEventListener(\"touchmove\", this._touch_callback, true);\n            canvas.addEventListener(\"touchend\", this._touch_callback, true);\n            canvas.addEventListener(\"touchcancel\", this._touch_callback, true);\n        }*/\n\n        //Keyboard ******************\n        this._key_callback = this.processKey.bind(this);\n        canvas.setAttribute(\"tabindex\",1); //otherwise key events are ignored\n        canvas.addEventListener(\"keydown\", this._key_callback, true);\n        document.addEventListener(\"keyup\", this._key_callback, true); //in document, otherwise it doesn't fire keyup\n\n        //Dropping Stuff over nodes ************************************\n        this._ondrop_callback = this.processDrop.bind(this);\n\n        canvas.addEventListener(\"dragover\", this._doNothing, false);\n        canvas.addEventListener(\"dragend\", this._doNothing, false);\n        canvas.addEventListener(\"drop\", this._ondrop_callback, false);\n        canvas.addEventListener(\"dragenter\", this._doReturnTrue, false);\n\n        this._events_binded = true;\n    };\n\n    /**\n     * unbinds mouse events from the canvas\n     * @method unbindEvents\n     **/\n    LGraphCanvas.prototype.unbindEvents = function() {\n        if (!this._events_binded) {\n            console.warn(\"LGraphCanvas: no events binded\");\n            return;\n        }\n\n        //console.log(\"pointerevents: unbindEvents\");\n        \n        var ref_window = this.getCanvasWindow();\n        var document = ref_window.document;\n\n\t\tLiteGraph.pointerListenerRemove(this.canvas,\"move\", this._mousedown_callback);\n        LiteGraph.pointerListenerRemove(this.canvas,\"up\", this._mousedown_callback);\n        LiteGraph.pointerListenerRemove(this.canvas,\"down\", this._mousedown_callback);\n        this.canvas.removeEventListener(\n            \"mousewheel\",\n            this._mousewheel_callback\n        );\n        this.canvas.removeEventListener(\n            \"DOMMouseScroll\",\n            this._mousewheel_callback\n        );\n        this.canvas.removeEventListener(\"keydown\", this._key_callback);\n        document.removeEventListener(\"keyup\", this._key_callback);\n        this.canvas.removeEventListener(\"contextmenu\", this._doNothing);\n        this.canvas.removeEventListener(\"drop\", this._ondrop_callback);\n        this.canvas.removeEventListener(\"dragenter\", this._doReturnTrue);\n\n        //touch events -- THIS WAY DOES NOT WORK, finish implementing pointerevents, than clean the touchevents\n        /*this.canvas.removeEventListener(\"touchstart\", this._touch_callback );\n        this.canvas.removeEventListener(\"touchmove\", this._touch_callback );\n        this.canvas.removeEventListener(\"touchend\", this._touch_callback );\n        this.canvas.removeEventListener(\"touchcancel\", this._touch_callback );*/\n\n        this._mousedown_callback = null;\n        this._mousewheel_callback = null;\n        this._key_callback = null;\n        this._ondrop_callback = null;\n\n        this._events_binded = false;\n    };\n\n    LGraphCanvas.getFileExtension = function(url) {\n        var question = url.indexOf(\"?\");\n        if (question != -1) {\n            url = url.substr(0, question);\n        }\n        var point = url.lastIndexOf(\".\");\n        if (point == -1) {\n            return \"\";\n        }\n        return url.substr(point + 1).toLowerCase();\n    };\n\n    /**\n     * this function allows to render the canvas using WebGL instead of Canvas2D\n     * this is useful if you plant to render 3D objects inside your nodes, it uses litegl.js for webgl and canvas2DtoWebGL to emulate the Canvas2D calls in webGL\n     * @method enableWebGL\n     **/\n    LGraphCanvas.prototype.enableWebGL = function() {\n        if (typeof GL === \"undefined\") {\n            throw \"litegl.js must be included to use a WebGL canvas\";\n        }\n        if (typeof enableWebGLCanvas === \"undefined\") {\n            throw \"webglCanvas.js must be included to use this feature\";\n        }\n\n        this.gl = this.ctx = enableWebGLCanvas(this.canvas);\n        this.ctx.webgl = true;\n        this.bgcanvas = this.canvas;\n        this.bgctx = this.gl;\n        this.canvas.webgl_enabled = true;\n\n        /*\n\tGL.create({ canvas: this.bgcanvas });\n\tthis.bgctx = enableWebGLCanvas( this.bgcanvas );\n\twindow.gl = this.gl;\n\t*/\n    };\n\n    /**\n     * marks as dirty the canvas, this way it will be rendered again\n     *\n     * @class LGraphCanvas\n     * @method setDirty\n     * @param {bool} fgcanvas if the foreground canvas is dirty (the one containing the nodes)\n     * @param {bool} bgcanvas if the background canvas is dirty (the one containing the wires)\n     */\n    LGraphCanvas.prototype.setDirty = function(fgcanvas, bgcanvas) {\n        if (fgcanvas) {\n            this.dirty_canvas = true;\n        }\n        if (bgcanvas) {\n            this.dirty_bgcanvas = true;\n        }\n    };\n\n    /**\n     * Used to attach the canvas in a popup\n     *\n     * @method getCanvasWindow\n     * @return {window} returns the window where the canvas is attached (the DOM root node)\n     */\n    LGraphCanvas.prototype.getCanvasWindow = function() {\n        if (!this.canvas) {\n            return window;\n        }\n        var doc = this.canvas.ownerDocument;\n        return doc.defaultView || doc.parentWindow;\n    };\n\n    /**\n     * starts rendering the content of the canvas when needed\n     *\n     * @method startRendering\n     */\n    LGraphCanvas.prototype.startRendering = function() {\n        if (this.is_rendering) {\n            return;\n        } //already rendering\n\n        this.is_rendering = true;\n        renderFrame.call(this);\n\n        function renderFrame() {\n            if (!this.pause_rendering) {\n                this.draw();\n            }\n\n            var window = this.getCanvasWindow();\n            if (this.is_rendering) {\n                window.requestAnimationFrame(renderFrame.bind(this));\n            }\n        }\n    };\n\n    /**\n     * stops rendering the content of the canvas (to save resources)\n     *\n     * @method stopRendering\n     */\n    LGraphCanvas.prototype.stopRendering = function() {\n        this.is_rendering = false;\n        /*\n\tif(this.rendering_timer_id)\n\t{\n\t\tclearInterval(this.rendering_timer_id);\n\t\tthis.rendering_timer_id = null;\n\t}\n\t*/\n    };\n\n    /* LiteGraphCanvas input */\n\n\t//used to block future mouse events (because of im gui)\n\tLGraphCanvas.prototype.blockClick = function()\n\t{\n\t\tthis.block_click = true;\n\t\tthis.last_mouseclick = 0;\n\t}\n\t\n    LGraphCanvas.prototype.processMouseDown = function(e) {\n    \t\n\t\tif( this.set_canvas_dirty_on_mouse_event )\n\t\t\tthis.dirty_canvas = true;\n\t\t\n\t\tif (!this.graph) {\n            return;\n        }\n\n        this.adjustMouseEvent(e);\n\n        var ref_window = this.getCanvasWindow();\n        var document = ref_window.document;\n        LGraphCanvas.active_canvas = this;\n        var that = this;\n\n\t\tvar x = e.clientX;\n\t\tvar y = e.clientY;\n\t\t//console.log(y,this.viewport);\n\t\t//console.log(\"pointerevents: processMouseDown pointerId:\"+e.pointerId+\" which:\"+e.which+\" isPrimary:\"+e.isPrimary+\" :: x y \"+x+\" \"+y);\n\n\t\tthis.ds.viewport = this.viewport;\n\t\tvar is_inside = !this.viewport || ( this.viewport && x >= this.viewport[0] && x < (this.viewport[0] + this.viewport[2]) && y >= this.viewport[1] && y < (this.viewport[1] + this.viewport[3]) );\n\n        //move mouse move event to the window in case it drags outside of the canvas\n\t\tif(!this.options.skip_events)\n\t\t{\n\t\t\tLiteGraph.pointerListenerRemove(this.canvas,\"move\", this._mousemove_callback);\n\t\t\tLiteGraph.pointerListenerAdd(ref_window.document,\"move\", this._mousemove_callback,true); //catch for the entire window\n\t\t\tLiteGraph.pointerListenerAdd(ref_window.document,\"up\", this._mouseup_callback,true);\n\t\t}\n\n\t\tif(!is_inside){\n\t\t\treturn;\n\t\t}\n\n        var node = this.graph.getNodeOnPos( e.canvasX, e.canvasY, this.visible_nodes, 5 );\n        var skip_dragging = false;\n        var skip_action = false;\n        var now = LiteGraph.getTime();\n\t\tvar is_primary = (e.isPrimary === undefined || !e.isPrimary);\n        var is_double_click = (now - this.last_mouseclick < 300) && is_primary;\n\t\tthis.mouse[0] = e.clientX;\n\t\tthis.mouse[1] = e.clientY;\n        this.graph_mouse[0] = e.canvasX;\n        this.graph_mouse[1] = e.canvasY;\n\t\tthis.last_click_position = [this.mouse[0],this.mouse[1]];\n\t  \t\n\t  \tif (this.pointer_is_down && is_primary ){\n\t\t  this.pointer_is_double = true;\n\t\t  //console.log(\"pointerevents: pointer_is_double start\");\n\t\t}else{\n\t\t  this.pointer_is_double = false;\n\t\t}\n\t  \tthis.pointer_is_down = true;\n\t  \n\t  \t\n        this.canvas.focus();\n\n        LiteGraph.closeAllContextMenus(ref_window);\n\n        if (this.onMouse)\n\t\t{\n            if (this.onMouse(e) == true)\n                return;\n        }\n\n\t\t//left button mouse / single finger\n        if (e.which == 1 && !this.pointer_is_double)\n\t\t{\n            if (e.ctrlKey)\n\t\t\t{\n                this.dragging_rectangle = new Float32Array(4);\n                this.dragging_rectangle[0] = e.canvasX;\n                this.dragging_rectangle[1] = e.canvasY;\n                this.dragging_rectangle[2] = 1;\n                this.dragging_rectangle[3] = 1;\n                skip_action = true;\n            }\n\n            // clone node ALT dragging\n            if (LiteGraph.alt_drag_do_clone_nodes && e.altKey && node && this.allow_interaction && !skip_action && !this.read_only)\n            {\n                if (cloned = node.clone()){\n                    cloned.pos[0] += 5;\n                    cloned.pos[1] += 5;\n                    this.graph.add(cloned,false,{doCalcSize: false});\n                    node = cloned;\n                    skip_action = true;\n                    if (!block_drag_node) {\n                        if (this.allow_dragnodes) {\n\t\t\t\t\t\t\tthis.graph.beforeChange();\n                            this.node_dragged = node;\n                        }\n                        if (!this.selected_nodes[node.id]) {\n                            this.processNodeSelected(node, e);\n                        }\n                    }\n                }\n            }\n            \n            var clicking_canvas_bg = false;\n\n            //when clicked on top of a node\n            //and it is not interactive\n            if (node && (this.allow_interaction || node.flags.allow_interaction) && !skip_action && !this.read_only) {\n                if (!this.live_mode && !node.flags.pinned) {\n                    this.bringToFront(node);\n                } //if it wasn't selected?\n\n                //not dragging mouse to connect two slots\n                if ( this.allow_interaction && !this.connecting_node && !node.flags.collapsed && !this.live_mode ) {\n                    //Search for corner for resize\n                    if ( !skip_action &&\n                        node.resizable !== false &&\n                        isInsideRectangle( e.canvasX,\n                            e.canvasY,\n                            node.pos[0] + node.size[0] - 5,\n                            node.pos[1] + node.size[1] - 5,\n                            10,\n                            10\n                        )\n                    ) {\n\t\t\t\t\t\tthis.graph.beforeChange();\n                        this.resizing_node = node;\n                        this.canvas.style.cursor = \"se-resize\";\n                        skip_action = true;\n                    } else {\n                        //search for outputs\n                        if (node.outputs) {\n                            for ( var i = 0, l = node.outputs.length; i < l; ++i ) {\n                                var output = node.outputs[i];\n                                var link_pos = node.getConnectionPos(false, i);\n                                if (\n                                    isInsideRectangle(\n                                        e.canvasX,\n                                        e.canvasY,\n                                        link_pos[0] - 15,\n                                        link_pos[1] - 10,\n                                        30,\n                                        20\n                                    )\n                                ) {\n                                    this.connecting_node = node;\n                                    this.connecting_output = output;\n                                    this.connecting_output.slot_index = i;\n                                    this.connecting_pos = node.getConnectionPos( false, i );\n                                    this.connecting_slot = i;\n\n                                    if (LiteGraph.shift_click_do_break_link_from){\n                                        if (e.shiftKey) {\n                                            node.disconnectOutput(i);\n                                        }\n                                    }\n\n                                    if (is_double_click) {\n                                        if (node.onOutputDblClick) {\n                                            node.onOutputDblClick(i, e);\n                                        }\n                                    } else {\n                                        if (node.onOutputClick) {\n                                            node.onOutputClick(i, e);\n                                        }\n                                    }\n\n                                    skip_action = true;\n                                    break;\n                                }\n                            }\n                        }\n\n                        //search for inputs\n                        if (node.inputs) {\n                            for ( var i = 0, l = node.inputs.length; i < l; ++i ) {\n                                var input = node.inputs[i];\n                                var link_pos = node.getConnectionPos(true, i);\n                                if (\n                                    isInsideRectangle(\n                                        e.canvasX,\n                                        e.canvasY,\n                                        link_pos[0] - 15,\n                                        link_pos[1] - 10,\n                                        30,\n                                        20\n                                    )\n                                ) {\n                                    if (is_double_click) {\n                                        if (node.onInputDblClick) {\n                                            node.onInputDblClick(i, e);\n                                        }\n                                    } else {\n                                        if (node.onInputClick) {\n                                            node.onInputClick(i, e);\n                                        }\n                                    }\n\n                                    if (input.link !== null) {\n                                        var link_info = this.graph.links[\n                                            input.link\n                                        ]; //before disconnecting\n                                        if (LiteGraph.click_do_break_link_to){\n                                            node.disconnectInput(i);\n                                            this.dirty_bgcanvas = true;\n                                            skip_action = true;\n                                        }else{\n                                            // do same action as has not node ?\n                                        }\n\n                                        if (\n                                            this.allow_reconnect_links ||\n\t\t\t\t\t\t\t\t\t\t\t//this.move_destination_link_without_shift ||\n                                            e.shiftKey\n                                        ) {\n                                            if (!LiteGraph.click_do_break_link_to){\n                                                node.disconnectInput(i);\n                                            }\n                                            this.connecting_node = this.graph._nodes_by_id[\n                                                link_info.origin_id\n                                            ];\n                                            this.connecting_slot =\n                                                link_info.origin_slot;\n                                            this.connecting_output = this.connecting_node.outputs[\n                                                this.connecting_slot\n                                            ];\n                                            this.connecting_pos = this.connecting_node.getConnectionPos( false, this.connecting_slot );\n                                            \n                                            this.dirty_bgcanvas = true;\n                                            skip_action = true;\n                                        }\n\n                                        \n                                    }else{\n                                        // has not node\n                                    }\n                                    \n                                    if (!skip_action){\n                                        // connect from in to out, from to to from\n                                        this.connecting_node = node;\n                                        this.connecting_input = input;\n                                        this.connecting_input.slot_index = i;\n                                        this.connecting_pos = node.getConnectionPos( true, i );\n                                        this.connecting_slot = i;\n                                        \n                                        this.dirty_bgcanvas = true;\n                                        skip_action = true;\n                                    }\n                                }\n                            }\n                        }\n                    } //not resizing\n                }\n\n                //it wasn't clicked on the links boxes\n                if (!skip_action) {\n                    var block_drag_node = false;\n\t\t\t\t\tvar pos = [e.canvasX - node.pos[0], e.canvasY - node.pos[1]];\n\n                    //widgets\n                    var widget = this.processNodeWidgets( node, this.graph_mouse, e );\n                    if (widget) {\n                        block_drag_node = true;\n                        this.node_widget = [node, widget];\n                    }\n\n                    //double clicking\n                    if (this.allow_interaction && is_double_click && this.selected_nodes[node.id]) {\n                        //double click node\n                        if (node.onDblClick) {\n                            node.onDblClick( e, pos, this );\n                        }\n                        this.processNodeDblClicked(node);\n                        block_drag_node = true;\n                    }\n\n                    //if do not capture mouse\n                    if ( node.onMouseDown && node.onMouseDown( e, pos, this ) ) {\n                        block_drag_node = true;\n                    } else {\n\t\t\t\t\t\t//open subgraph button\n\t\t\t\t\t\tif(node.subgraph && !node.skip_subgraph_button)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif ( !node.flags.collapsed && pos[0] > node.size[0] - LiteGraph.NODE_TITLE_HEIGHT && pos[1] < 0 ) {\n\t\t\t\t\t\t\t\tvar that = this;\n\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\tthat.openSubgraph(node.subgraph);\n\t\t\t\t\t\t\t\t}, 10);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.live_mode) {\n\t\t\t\t\t\t\tclicking_canvas_bg = true;\n\t                        block_drag_node = true;\n\t\t\t\t\t\t}\n                    }\n\n                    if (!block_drag_node) {\n                        if (this.allow_dragnodes) {\n\t\t\t\t\t\t\tthis.graph.beforeChange();\n                            this.node_dragged = node;\n                        }\n                        this.processNodeSelected(node, e);\n                    } else { // double-click\n                        /**\n                         * Don't call the function if the block is already selected.\n                         * Otherwise, it could cause the block to be unselected while its panel is open.\n                         */\n                        if (!node.is_selected) this.processNodeSelected(node, e);\n                    }\n\n                    this.dirty_canvas = true;\n                }\n            } //clicked outside of nodes\n            else {\n\t\t\t\tif (!skip_action){\n\t\t\t\t\t//search for link connector\n\t\t\t\t\tif(!this.read_only) {\n\t\t\t\t\t\tfor (var i = 0; i < this.visible_links.length; ++i) {\n\t\t\t\t\t\t\tvar link = this.visible_links[i];\n\t\t\t\t\t\t\tvar center = link._pos;\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!center ||\n\t\t\t\t\t\t\t\te.canvasX < center[0] - 4 ||\n\t\t\t\t\t\t\t\te.canvasX > center[0] + 4 ||\n\t\t\t\t\t\t\t\te.canvasY < center[1] - 4 ||\n\t\t\t\t\t\t\t\te.canvasY > center[1] + 4\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//link clicked\n\t\t\t\t\t\t\tthis.showLinkMenu(link, e);\n\t\t\t\t\t\t\tthis.over_link_center = null; //clear tooltip\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selected_group = this.graph.getGroupOnPos( e.canvasX, e.canvasY );\n\t\t\t\t\tthis.selected_group_resizing = false;\n\t\t\t\t\tif (this.selected_group && !this.read_only ) {\n\t\t\t\t\t\tif (e.ctrlKey) {\n\t\t\t\t\t\t\tthis.dragging_rectangle = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar dist = distance( [e.canvasX, e.canvasY], [ this.selected_group.pos[0] + this.selected_group.size[0], this.selected_group.pos[1] + this.selected_group.size[1] ] );\n\t\t\t\t\t\tif (dist * this.ds.scale < 10) {\n\t\t\t\t\t\t\tthis.selected_group_resizing = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.selected_group.recomputeInsideNodes();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (is_double_click && !this.read_only && this.allow_searchbox) {\n\t\t\t\t\t\tthis.showSearchBox(e);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t}\n\n\t\t\t\t\tclicking_canvas_bg = true;\n\t\t\t\t}\n            }\n\n            if (!skip_action && clicking_canvas_bg && this.allow_dragcanvas) {\n            \t//console.log(\"pointerevents: dragging_canvas start\");\n            \tthis.dragging_canvas = true;\n            }\n            \n        } else if (e.which == 2) {\n            //middle button\n        \t\n\t\t\tif (LiteGraph.middle_click_slot_add_default_node){\n\t\t\t\tif (node && this.allow_interaction && !skip_action && !this.read_only){\n\t\t\t\t\t//not dragging mouse to connect two slots\n\t\t\t\t\tif (\n\t\t\t\t\t\t!this.connecting_node &&\n\t\t\t\t\t\t!node.flags.collapsed &&\n\t\t\t\t\t\t!this.live_mode\n\t\t\t\t\t) {\n\t\t\t\t\t\tvar mClikSlot = false;\n\t\t\t\t\t\tvar mClikSlot_index = false;\n\t\t\t\t\t\tvar mClikSlot_isOut = false;\n\t\t\t\t\t\t//search for outputs\n\t\t\t\t\t\tif (node.outputs) {\n\t\t\t\t\t\t\tfor ( var i = 0, l = node.outputs.length; i < l; ++i ) {\n\t\t\t\t\t\t\t\tvar output = node.outputs[i];\n\t\t\t\t\t\t\t\tvar link_pos = node.getConnectionPos(false, i);\n\t\t\t\t\t\t\t\tif (isInsideRectangle(e.canvasX,e.canvasY,link_pos[0] - 15,link_pos[1] - 10,30,20)) {\n\t\t\t\t\t\t\t\t\tmClikSlot = output;\n\t\t\t\t\t\t\t\t\tmClikSlot_index = i;\n\t\t\t\t\t\t\t\t\tmClikSlot_isOut = true;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//search for inputs\n\t\t\t\t\t\tif (node.inputs) {\n\t\t\t\t\t\t\tfor ( var i = 0, l = node.inputs.length; i < l; ++i ) {\n\t\t\t\t\t\t\t\tvar input = node.inputs[i];\n\t\t\t\t\t\t\t\tvar link_pos = node.getConnectionPos(true, i);\n\t\t\t\t\t\t\t\tif (isInsideRectangle(e.canvasX,e.canvasY,link_pos[0] - 15,link_pos[1] - 10,30,20)) {\n\t\t\t\t\t\t\t\t\tmClikSlot = input;\n\t\t\t\t\t\t\t\t\tmClikSlot_index = i;\n\t\t\t\t\t\t\t\t\tmClikSlot_isOut = false;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//console.log(\"middleClickSlots? \"+mClikSlot+\" & \"+(mClikSlot_index!==false));\n\t\t\t\t\t\tif (mClikSlot && mClikSlot_index!==false){\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar alphaPosY = 0.5-((mClikSlot_index+1)/((mClikSlot_isOut?node.outputs.length:node.inputs.length)));\n\t\t\t\t\t\t\tvar node_bounding = node.getBounding();\n\t\t\t\t\t\t\t// estimate a position: this is a bad semi-bad-working mess .. REFACTOR with a correct autoplacement that knows about the others slots and nodes\n\t\t\t\t\t\t\tvar posRef = [\t(!mClikSlot_isOut?node_bounding[0]:node_bounding[0]+node_bounding[2])// + node_bounding[0]/this.canvas.width*150\n\t\t\t\t\t\t\t\t\t\t\t,e.canvasY-80// + node_bounding[0]/this.canvas.width*66 // vertical \"derive\"\n\t\t\t\t\t\t\t\t\t\t  ];\n\t\t\t\t\t\t\tvar nodeCreated = this.createDefaultNodeForSlot({   \tnodeFrom: !mClikSlot_isOut?null:node\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,slotFrom: !mClikSlot_isOut?null:mClikSlot_index\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,nodeTo: !mClikSlot_isOut?node:null\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,slotTo: !mClikSlot_isOut?mClikSlot_index:null\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,position: posRef //,e: e\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,nodeType: \"AUTO\" //nodeNewType\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,posAdd:[!mClikSlot_isOut?-30:30, -alphaPosY*130] //-alphaPosY*30]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,posSizeFix:[!mClikSlot_isOut?-1:0, 0] //-alphaPosY*2*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (!skip_action && this.allow_dragcanvas) {\n            \t//console.log(\"pointerevents: dragging_canvas start from middle button\");\n            \tthis.dragging_canvas = true;\n            }\n\n        \t\n        } else if (e.which == 3 || this.pointer_is_double) {\n\t\t\t\n            //right button\n\t\t\tif (this.allow_interaction && !skip_action && !this.read_only){\n\t\t\t\t\n\t\t\t\t// is it hover a node ?\n\t\t\t\tif (node){\n\t\t\t\t\tif(Object.keys(this.selected_nodes).length\n\t\t\t\t\t   && (this.selected_nodes[node.id] || e.shiftKey || e.ctrlKey || e.metaKey)\n\t\t\t\t\t){\n\t\t\t\t\t\t// is multiselected or using shift to include the now node\n\t\t\t\t\t\tif (!this.selected_nodes[node.id]) this.selectNodes([node],true); // add this if not present\n\t\t\t\t\t}else{\n\t\t\t\t\t\t// update selection\n\t\t\t\t\t\tthis.selectNodes([node]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// show menu on this node\n\t\t\t\tthis.processContextMenu(node, e);\n\t\t\t}\n\t\t\t\n        }\n\n        //TODO\n        //if(this.node_selected != prev_selected)\n        //\tthis.onNodeSelectionChange(this.node_selected);\n\n        this.last_mouse[0] = e.clientX;\n        this.last_mouse[1] = e.clientY;\n        this.last_mouseclick = LiteGraph.getTime();\n        this.last_mouse_dragging = true;\n\n        /*\n\tif( (this.dirty_canvas || this.dirty_bgcanvas) && this.rendering_timer_id == null)\n\t\tthis.draw();\n\t*/\n\n        this.graph.change();\n\n        //this is to ensure to defocus(blur) if a text input element is on focus\n        if (\n            !ref_window.document.activeElement ||\n            (ref_window.document.activeElement.nodeName.toLowerCase() !=\n                \"input\" &&\n                ref_window.document.activeElement.nodeName.toLowerCase() !=\n                    \"textarea\")\n        ) {\n            e.preventDefault();\n        }\n        e.stopPropagation();\n\n        if (this.onMouseDown) {\n            this.onMouseDown(e);\n        }\n\n        return false;\n    };\n\n    /**\n     * Called when a mouse move event has to be processed\n     * @method processMouseMove\n     **/\n    LGraphCanvas.prototype.processMouseMove = function(e) {\n        if (this.autoresize) {\n            this.resize();\n        }\n\n\t\tif( this.set_canvas_dirty_on_mouse_event )\n\t\t\tthis.dirty_canvas = true;\n\n        if (!this.graph) {\n            return;\n        }\n\n        LGraphCanvas.active_canvas = this;\n        this.adjustMouseEvent(e);\n        var mouse = [e.clientX, e.clientY];\n\t\tthis.mouse[0] = mouse[0];\n\t\tthis.mouse[1] = mouse[1];\n        var delta = [\n            mouse[0] - this.last_mouse[0],\n            mouse[1] - this.last_mouse[1]\n        ];\n        this.last_mouse = mouse;\n        this.graph_mouse[0] = e.canvasX;\n        this.graph_mouse[1] = e.canvasY;\n\n        //console.log(\"pointerevents: processMouseMove \"+e.pointerId+\" \"+e.isPrimary);\n        \n\t\tif(this.block_click)\n\t\t{\n\t\t\t//console.log(\"pointerevents: processMouseMove block_click\");\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t}\n\n        e.dragging = this.last_mouse_dragging;\n\n        if (this.node_widget) {\n            this.processNodeWidgets(\n                this.node_widget[0],\n                this.graph_mouse,\n                e,\n                this.node_widget[1]\n            );\n            this.dirty_canvas = true;\n        }\n\n        //get node over\n        var node = this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes);\n\n        if (this.dragging_rectangle)\n\t\t{\n            this.dragging_rectangle[2] = e.canvasX - this.dragging_rectangle[0];\n            this.dragging_rectangle[3] = e.canvasY - this.dragging_rectangle[1];\n            this.dirty_canvas = true;\n        } \n\t\telse if (this.selected_group && !this.read_only)\n\t\t{\n            //moving/resizing a group\n            if (this.selected_group_resizing) {\n                this.selected_group.size = [\n                    e.canvasX - this.selected_group.pos[0],\n                    e.canvasY - this.selected_group.pos[1]\n                ];\n            } else {\n                var deltax = delta[0] / this.ds.scale;\n                var deltay = delta[1] / this.ds.scale;\n                this.selected_group.move(deltax, deltay, e.ctrlKey);\n                if (this.selected_group._nodes.length) {\n                    this.dirty_canvas = true;\n                }\n            }\n            this.dirty_bgcanvas = true;\n        } else if (this.dragging_canvas) {\n        \t////console.log(\"pointerevents: processMouseMove is dragging_canvas\");\n            this.ds.offset[0] += delta[0] / this.ds.scale;\n            this.ds.offset[1] += delta[1] / this.ds.scale;\n            this.dirty_canvas = true;\n            this.dirty_bgcanvas = true;\n        } else if ((this.allow_interaction || (node && node.flags.allow_interaction)) && !this.read_only) {\n            if (this.connecting_node) {\n                this.dirty_canvas = true;\n            }\n\n            //remove mouseover flag\n            for (var i = 0, l = this.graph._nodes.length; i < l; ++i) {\n                if (this.graph._nodes[i].mouseOver && node != this.graph._nodes[i] ) {\n                    //mouse leave\n                    this.graph._nodes[i].mouseOver = false;\n                    if (this.node_over && this.node_over.onMouseLeave) {\n                        this.node_over.onMouseLeave(e);\n                    }\n                    this.node_over = null;\n                    this.dirty_canvas = true;\n                }\n            }\n\n            //mouse over a node\n            if (node) {\n\n\t\t\t\tif(node.redraw_on_mouse)\n                    this.dirty_canvas = true;\n\n                //this.canvas.style.cursor = \"move\";\n                if (!node.mouseOver) {\n                    //mouse enter\n                    node.mouseOver = true;\n                    this.node_over = node;\n                    this.dirty_canvas = true;\n\n                    if (node.onMouseEnter) {\n                        node.onMouseEnter(e);\n                    }\n                }\n\n                //in case the node wants to do something\n                if (node.onMouseMove) {\n                    node.onMouseMove( e, [e.canvasX - node.pos[0], e.canvasY - node.pos[1]], this );\n                }\n\n                //if dragging a link\n                if (this.connecting_node) {\n                    \n                    if (this.connecting_output){\n                        \n                        var pos = this._highlight_input || [0, 0]; //to store the output of isOverNodeInput\n\n                        //on top of input\n                        if (this.isOverNodeBox(node, e.canvasX, e.canvasY)) {\n                            //mouse on top of the corner box, don't know what to do\n                        } else {\n                            //check if I have a slot below de mouse\n                            var slot = this.isOverNodeInput( node, e.canvasX, e.canvasY, pos );\n                            if (slot != -1 && node.inputs[slot]) {\n                                var slot_type = node.inputs[slot].type;\n                                if ( LiteGraph.isValidConnection( this.connecting_output.type, slot_type ) ) {\n                                    this._highlight_input = pos;\n\t\t\t\t\t\t\t\t\tthis._highlight_input_slot = node.inputs[slot]; // XXX CHECK THIS\n                                }\n                            } else {\n                                this._highlight_input = null;\n\t\t\t\t\t\t\t\tthis._highlight_input_slot = null;  // XXX CHECK THIS\n                            }\n                        }\n                        \n                    }else if(this.connecting_input){\n                        \n                        var pos = this._highlight_output || [0, 0]; //to store the output of isOverNodeOutput\n\n                        //on top of output\n                        if (this.isOverNodeBox(node, e.canvasX, e.canvasY)) {\n                            //mouse on top of the corner box, don't know what to do\n                        } else {\n                            //check if I have a slot below de mouse\n                            var slot = this.isOverNodeOutput( node, e.canvasX, e.canvasY, pos );\n                            if (slot != -1 && node.outputs[slot]) {\n                                var slot_type = node.outputs[slot].type;\n                                if ( LiteGraph.isValidConnection( this.connecting_input.type, slot_type ) ) {\n                                    this._highlight_output = pos;\n                                }\n                            } else {\n                                this._highlight_output = null;\n                            }\n                        }\n                    }\n                }\n\n                //Search for corner\n                if (this.canvas) {\n                    if (\n                        isInsideRectangle(\n                            e.canvasX,\n                            e.canvasY,\n                            node.pos[0] + node.size[0] - 5,\n                            node.pos[1] + node.size[1] - 5,\n                            5,\n                            5\n                        )\n                    ) {\n                        this.canvas.style.cursor = \"se-resize\";\n                    } else {\n                        this.canvas.style.cursor = \"crosshair\";\n                    }\n                }\n            } else { //not over a node\n\n                //search for link connector\n\t\t\t\tvar over_link = null;\n\t\t\t\tfor (var i = 0; i < this.visible_links.length; ++i) {\n\t\t\t\t\tvar link = this.visible_links[i];\n\t\t\t\t\tvar center = link._pos;\n\t\t\t\t\tif (\n\t\t\t\t\t\t!center ||\n\t\t\t\t\t\te.canvasX < center[0] - 4 ||\n\t\t\t\t\t\te.canvasX > center[0] + 4 ||\n\t\t\t\t\t\te.canvasY < center[1] - 4 ||\n\t\t\t\t\t\te.canvasY > center[1] + 4\n\t\t\t\t\t) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tover_link = link;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif( over_link != this.over_link_center )\n\t\t\t\t{\n\t\t\t\t\tthis.over_link_center = over_link;\n\t                this.dirty_canvas = true;\n\t\t\t\t}\n\n\t\t\t\tif (this.canvas) {\n\t                this.canvas.style.cursor = \"\";\n\t\t\t\t}\n\t\t\t} //end\n\n\t\t\t//send event to node if capturing input (used with widgets that allow drag outside of the area of the node)\n            if ( this.node_capturing_input && this.node_capturing_input != node && this.node_capturing_input.onMouseMove ) {\n                this.node_capturing_input.onMouseMove(e,[e.canvasX - this.node_capturing_input.pos[0],e.canvasY - this.node_capturing_input.pos[1]], this);\n            }\n\n\t\t\t//node being dragged\n            if (this.node_dragged && !this.live_mode) {\n\t\t\t\t//console.log(\"draggin!\",this.selected_nodes);\n                for (var i in this.selected_nodes) {\n                    var n = this.selected_nodes[i];\n                    n.pos[0] += delta[0] / this.ds.scale;\n                    n.pos[1] += delta[1] / this.ds.scale;\n                    if (!n.is_selected) this.processNodeSelected(n, e); /*\n                     * Don't call the function if the block is already selected.\n                     * Otherwise, it could cause the block to be unselected while dragging.\n                     */\n                }\n\n                this.dirty_canvas = true;\n                this.dirty_bgcanvas = true;\n            }\n\n            if (this.resizing_node && !this.live_mode) {\n                //convert mouse to node space\n\t\t\t\tvar desired_size = [ e.canvasX - this.resizing_node.pos[0], e.canvasY - this.resizing_node.pos[1] ];\n\t\t\t\tvar min_size = this.resizing_node.computeSize();\n\t\t\t\tdesired_size[0] = Math.max( min_size[0], desired_size[0] );\n\t\t\t\tdesired_size[1] = Math.max( min_size[1], desired_size[1] );\n\t\t\t\tthis.resizing_node.setSize( desired_size );\n\n                this.canvas.style.cursor = \"se-resize\";\n                this.dirty_canvas = true;\n                this.dirty_bgcanvas = true;\n            }\n        }\n\n        e.preventDefault();\n        return false;\n    };\n\n    /**\n     * Called when a mouse up event has to be processed\n     * @method processMouseUp\n     **/\n    LGraphCanvas.prototype.processMouseUp = function(e) {\n\n\t\tvar is_primary = ( e.isPrimary === undefined || e.isPrimary );\n\n    \t//early exit for extra pointer\n    \tif(!is_primary){\n    \t\t/*e.stopPropagation();\n        \te.preventDefault();*/\n    \t\t//console.log(\"pointerevents: processMouseUp pointerN_stop \"+e.pointerId+\" \"+e.isPrimary);\n    \t\treturn false;\n    \t}\n    \t\n    \t//console.log(\"pointerevents: processMouseUp \"+e.pointerId+\" \"+e.isPrimary+\" :: \"+e.clientX+\" \"+e.clientY);\n    \t\n\t\tif( this.set_canvas_dirty_on_mouse_event )\n\t\t\tthis.dirty_canvas = true;\n\n        if (!this.graph)\n            return;\n\n        var window = this.getCanvasWindow();\n        var document = window.document;\n        LGraphCanvas.active_canvas = this;\n\n        //restore the mousemove event back to the canvas\n\t\tif(!this.options.skip_events)\n\t\t{\n\t\t\t//console.log(\"pointerevents: processMouseUp adjustEventListener\");\n\t\t\tLiteGraph.pointerListenerRemove(document,\"move\", this._mousemove_callback,true);\n\t\t\tLiteGraph.pointerListenerAdd(this.canvas,\"move\", this._mousemove_callback,true);\n\t\t\tLiteGraph.pointerListenerRemove(document,\"up\", this._mouseup_callback,true);\n\t\t}\n\n        this.adjustMouseEvent(e);\n        var now = LiteGraph.getTime();\n        e.click_time = now - this.last_mouseclick;\n        this.last_mouse_dragging = false;\n\t\tthis.last_click_position = null;\n\n\t\tif(this.block_click)\n\t\t{\n\t\t\t//console.log(\"pointerevents: processMouseUp block_clicks\");\n\t\t\tthis.block_click = false; //used to avoid sending twice a click in a immediate button\n\t\t}\n\n\t\t//console.log(\"pointerevents: processMouseUp which: \"+e.which);\n\t\t\n        if (e.which == 1) {\n\n\t\t\tif( this.node_widget )\n\t\t\t{\n\t\t\t\tthis.processNodeWidgets( this.node_widget[0], this.graph_mouse, e );\n\t\t\t}\n\n            //left button\n            this.node_widget = null;\n\n            if (this.selected_group) {\n                var diffx =\n                    this.selected_group.pos[0] -\n                    Math.round(this.selected_group.pos[0]);\n                var diffy =\n                    this.selected_group.pos[1] -\n                    Math.round(this.selected_group.pos[1]);\n                this.selected_group.move(diffx, diffy, e.ctrlKey);\n                this.selected_group.pos[0] = Math.round(\n                    this.selected_group.pos[0]\n                );\n                this.selected_group.pos[1] = Math.round(\n                    this.selected_group.pos[1]\n                );\n                if (this.selected_group._nodes.length) {\n                    this.dirty_canvas = true;\n                }\n                this.selected_group = null;\n            }\n            this.selected_group_resizing = false;\n\n\t\t\tvar node = this.graph.getNodeOnPos(\n\t\t\t\t\t\t\te.canvasX,\n\t\t\t\t\t\t\te.canvasY,\n\t\t\t\t\t\t\tthis.visible_nodes\n\t\t\t\t\t\t);\n\t\t\t\n            if (this.dragging_rectangle) {\n                if (this.graph) {\n                    var nodes = this.graph._nodes;\n                    var node_bounding = new Float32Array(4);\n                    \n                    //compute bounding and flip if left to right\n                    var w = Math.abs(this.dragging_rectangle[2]);\n                    var h = Math.abs(this.dragging_rectangle[3]);\n                    var startx =\n                        this.dragging_rectangle[2] < 0\n                            ? this.dragging_rectangle[0] - w\n                            : this.dragging_rectangle[0];\n                    var starty =\n                        this.dragging_rectangle[3] < 0\n                            ? this.dragging_rectangle[1] - h\n                            : this.dragging_rectangle[1];\n                    this.dragging_rectangle[0] = startx;\n                    this.dragging_rectangle[1] = starty;\n                    this.dragging_rectangle[2] = w;\n                    this.dragging_rectangle[3] = h;\n\n\t\t\t\t\t// test dragging rect size, if minimun simulate a click\n\t\t\t\t\tif (!node || (w > 10 && h > 10 )){\n\t\t\t\t\t\t//test against all nodes (not visible because the rectangle maybe start outside\n\t\t\t\t\t\tvar to_select = [];\n\t\t\t\t\t\tfor (var i = 0; i < nodes.length; ++i) {\n\t\t\t\t\t\t\tvar nodeX = nodes[i];\n\t\t\t\t\t\t\tnodeX.getBounding(node_bounding);\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!overlapBounding(\n\t\t\t\t\t\t\t\t\tthis.dragging_rectangle,\n\t\t\t\t\t\t\t\t\tnode_bounding\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t} //out of the visible area\n\t\t\t\t\t\t\tto_select.push(nodeX);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (to_select.length) {\n\t\t\t\t\t\t\tthis.selectNodes(to_select,e.shiftKey); // add to selection with shift\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n\t\t\t\t\t\t// will select of update selection\n\t\t\t\t\t\tthis.selectNodes([node],e.shiftKey||e.ctrlKey); // add to selection add to selection with ctrlKey or shiftKey\n\t\t\t\t\t}\n\t\t\t\t\t\n                }\n                this.dragging_rectangle = null;\n            } else if (this.connecting_node) {\n                //dragging a connection\n                this.dirty_canvas = true;\n                this.dirty_bgcanvas = true;\n\n                var connInOrOut = this.connecting_output || this.connecting_input;\n                var connType = connInOrOut.type;\n                \n                //node below mouse\n                if (node) {\n                    \n                    /* no need to condition on event type.. just another type\n                    if (\n                        connType == LiteGraph.EVENT &&\n                        this.isOverNodeBox(node, e.canvasX, e.canvasY)\n                    ) {\n                        \n                        this.connecting_node.connect(\n                            this.connecting_slot,\n                            node,\n                            LiteGraph.EVENT\n                        );\n                        \n                    } else {*/\n                        \n                        //slot below mouse? connect\n                        \n                        if (this.connecting_output){\n                            \n                            var slot = this.isOverNodeInput(\n                                node,\n                                e.canvasX,\n                                e.canvasY\n                            );\n                            if (slot != -1) {\n                                this.connecting_node.connect(this.connecting_slot, node, slot);\n                            } else {\n                                //not on top of an input\n                                // look for a good slot\n                                this.connecting_node.connectByType(this.connecting_slot,node,connType);\n                            }\n                            \n                        }else if (this.connecting_input){\n                            \n                            var slot = this.isOverNodeOutput(\n                                node,\n                                e.canvasX,\n                                e.canvasY\n                            );\n\n                            if (slot != -1) {\n                                node.connect(slot, this.connecting_node, this.connecting_slot); // this is inverted has output-input nature like\n                            } else {\n                                //not on top of an input\n                                // look for a good slot\n                                this.connecting_node.connectByTypeOutput(this.connecting_slot,node,connType);\n                            }\n                            \n                        }\n                        \n                        \n                    //}\n                    \n                }else{\n                    \n                    // add menu when releasing link in empty space\n                \tif (LiteGraph.release_link_on_empty_shows_menu){\n\t                    if (e.shiftKey && this.allow_searchbox){\n\t                        if(this.connecting_output){\n\t                            this.showSearchBox(e,{node_from: this.connecting_node, slot_from: this.connecting_output, type_filter_in: this.connecting_output.type});\n\t                        }else if(this.connecting_input){\n\t                            this.showSearchBox(e,{node_to: this.connecting_node, slot_from: this.connecting_input, type_filter_out: this.connecting_input.type});\n\t                        }\n\t                    }else{\n\t                        if(this.connecting_output){\n\t                            this.showConnectionMenu({nodeFrom: this.connecting_node, slotFrom: this.connecting_output, e: e});\n\t                        }else if(this.connecting_input){\n\t                            this.showConnectionMenu({nodeTo: this.connecting_node, slotTo: this.connecting_input, e: e});\n\t                        }\n\t                    }\n                \t}\n                }\n\n                this.connecting_output = null;\n                this.connecting_input = null;\n                this.connecting_pos = null;\n                this.connecting_node = null;\n                this.connecting_slot = -1;\n            } //not dragging connection\n            else if (this.resizing_node) {\n                this.dirty_canvas = true;\n                this.dirty_bgcanvas = true;\n\t\t\t\tthis.graph.afterChange(this.resizing_node);\n                this.resizing_node = null;\n            } else if (this.node_dragged) {\n                //node being dragged?\n                var node = this.node_dragged;\n                if (\n                    node &&\n                    e.click_time < 300 &&\n                    isInsideRectangle( e.canvasX, e.canvasY, node.pos[0], node.pos[1] - LiteGraph.NODE_TITLE_HEIGHT, LiteGraph.NODE_TITLE_HEIGHT, LiteGraph.NODE_TITLE_HEIGHT )\n                ) {\n                    node.collapse();\n                }\n\n                this.dirty_canvas = true;\n                this.dirty_bgcanvas = true;\n                this.node_dragged.pos[0] = Math.round(this.node_dragged.pos[0]);\n                this.node_dragged.pos[1] = Math.round(this.node_dragged.pos[1]);\n                if (this.graph.config.align_to_grid || this.align_to_grid ) {\n                    this.node_dragged.alignToGrid();\n                }\n\t\t\t\tif( this.onNodeMoved )\n\t\t\t\t\tthis.onNodeMoved( this.node_dragged );\n\t\t\t\tthis.graph.afterChange(this.node_dragged);\n                this.node_dragged = null;\n            } //no node being dragged\n            else {\n                //get node over\n                var node = this.graph.getNodeOnPos(\n                    e.canvasX,\n                    e.canvasY,\n                    this.visible_nodes\n                );\n\n                if (!node && e.click_time < 300) {\n                    this.deselectAllNodes();\n                }\n\n                this.dirty_canvas = true;\n                this.dragging_canvas = false;\n\n                if (this.node_over && this.node_over.onMouseUp) {\n                    this.node_over.onMouseUp( e, [ e.canvasX - this.node_over.pos[0], e.canvasY - this.node_over.pos[1] ], this );\n                }\n                if (\n                    this.node_capturing_input &&\n                    this.node_capturing_input.onMouseUp\n                ) {\n                    this.node_capturing_input.onMouseUp(e, [\n                        e.canvasX - this.node_capturing_input.pos[0],\n                        e.canvasY - this.node_capturing_input.pos[1]\n                    ]);\n                }\n            }\n        } else if (e.which == 2) {\n            //middle button\n            //trace(\"middle\");\n            this.dirty_canvas = true;\n            this.dragging_canvas = false;\n        } else if (e.which == 3) {\n            //right button\n            //trace(\"right\");\n            this.dirty_canvas = true;\n            this.dragging_canvas = false;\n        }\n\n        /*\n\t\tif((this.dirty_canvas || this.dirty_bgcanvas) && this.rendering_timer_id == null)\n\t\t\tthis.draw();\n\t\t*/\n\n\t  \tif (is_primary)\n\t\t{\n\t\t\tthis.pointer_is_down = false;\n\t\t\tthis.pointer_is_double = false;\n\t\t}\n\t  \n        this.graph.change();\n\n        //console.log(\"pointerevents: processMouseUp stopPropagation\");\n        e.stopPropagation();\n        e.preventDefault();\n        return false;\n    };\n\n    /**\n     * Called when a mouse wheel event has to be processed\n     * @method processMouseWheel\n     **/\n    LGraphCanvas.prototype.processMouseWheel = function(e) {\n        if (!this.graph || !this.allow_dragcanvas) {\n            return;\n        }\n\n        var delta = e.wheelDeltaY != null ? e.wheelDeltaY : e.detail * -60;\n\n        this.adjustMouseEvent(e);\n\n\t\tvar x = e.clientX;\n\t\tvar y = e.clientY;\n\t\tvar is_inside = !this.viewport || ( this.viewport && x >= this.viewport[0] && x < (this.viewport[0] + this.viewport[2]) && y >= this.viewport[1] && y < (this.viewport[1] + this.viewport[3]) );\n\t\tif(!is_inside)\n\t\t\treturn;\n\n        var scale = this.ds.scale;\n\n        if (delta > 0) {\n            scale *= 1.1;\n        } else if (delta < 0) {\n            scale *= 1 / 1.1;\n        }\n\n        //this.setZoom( scale, [ e.clientX, e.clientY ] );\n        this.ds.changeScale(scale, [e.clientX, e.clientY]);\n\n        this.graph.change();\n\n        e.preventDefault();\n        return false; // prevent default\n    };\n\n    /**\n     * returns true if a position (in graph space) is on top of a node little corner box\n     * @method isOverNodeBox\n     **/\n    LGraphCanvas.prototype.isOverNodeBox = function(node, canvasx, canvasy) {\n        var title_height = LiteGraph.NODE_TITLE_HEIGHT;\n        if (\n            isInsideRectangle(\n                canvasx,\n                canvasy,\n                node.pos[0] + 2,\n                node.pos[1] + 2 - title_height,\n                title_height - 4,\n                title_height - 4\n            )\n        ) {\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * returns the INDEX if a position (in graph space) is on top of a node input slot\n     * @method isOverNodeInput\n     **/\n    LGraphCanvas.prototype.isOverNodeInput = function(\n        node,\n        canvasx,\n        canvasy,\n        slot_pos\n    ) {\n        if (node.inputs) {\n            for (var i = 0, l = node.inputs.length; i < l; ++i) {\n                var input = node.inputs[i];\n                var link_pos = node.getConnectionPos(true, i);\n                var is_inside = false;\n                if (node.horizontal) {\n                    is_inside = isInsideRectangle(\n                        canvasx,\n                        canvasy,\n                        link_pos[0] - 5,\n                        link_pos[1] - 10,\n                        10,\n                        20\n                    );\n                } else {\n                    is_inside = isInsideRectangle(\n                        canvasx,\n                        canvasy,\n                        link_pos[0] - 10,\n                        link_pos[1] - 5,\n                        40,\n                        10\n                    );\n                }\n                if (is_inside) {\n                    if (slot_pos) {\n                        slot_pos[0] = link_pos[0];\n                        slot_pos[1] = link_pos[1];\n                    }\n                    return i;\n                }\n            }\n        }\n        return -1;\n    };\n    \n    /**\n     * returns the INDEX if a position (in graph space) is on top of a node output slot\n     * @method isOverNodeOuput\n     **/\n    LGraphCanvas.prototype.isOverNodeOutput = function(\n        node,\n        canvasx,\n        canvasy,\n        slot_pos\n    ) {\n        if (node.outputs) {\n            for (var i = 0, l = node.outputs.length; i < l; ++i) {\n                var output = node.outputs[i];\n                var link_pos = node.getConnectionPos(false, i);\n                var is_inside = false;\n                if (node.horizontal) {\n                    is_inside = isInsideRectangle(\n                        canvasx,\n                        canvasy,\n                        link_pos[0] - 5,\n                        link_pos[1] - 10,\n                        10,\n                        20\n                    );\n                } else {\n                    is_inside = isInsideRectangle(\n                        canvasx,\n                        canvasy,\n                        link_pos[0] - 10,\n                        link_pos[1] - 5,\n                        40,\n                        10\n                    );\n                }\n                if (is_inside) {\n                    if (slot_pos) {\n                        slot_pos[0] = link_pos[0];\n                        slot_pos[1] = link_pos[1];\n                    }\n                    return i;\n                }\n            }\n        }\n        return -1;\n    };\n\n    /**\n     * process a key event\n     * @method processKey\n     **/\n    LGraphCanvas.prototype.processKey = function(e) {\n        if (!this.graph) {\n            return;\n        }\n\n        var block_default = false;\n        //console.log(e); //debug\n\n        if (e.target.localName == \"input\") {\n            return;\n        }\n\n        if (e.type == \"keydown\") {\n            if (e.keyCode == 32) {\n                //space\n                this.dragging_canvas = true;\n                block_default = true;\n            }\n            \n            if (e.keyCode == 27) {\n                //esc\n                if(this.node_panel) this.node_panel.close();\n                if(this.options_panel) this.options_panel.close();\n                block_default = true;\n            }\n\n            //select all Control A\n            if (e.keyCode == 65 && e.ctrlKey) {\n                this.selectNodes();\n                block_default = true;\n            }\n\n            if ((e.keyCode === 67) && (e.metaKey || e.ctrlKey) && !e.shiftKey) {\n                //copy\n                if (this.selected_nodes) {\n                    this.copyToClipboard();\n                    block_default = true;\n                }\n            }\n\n            if ((e.keyCode === 86) && (e.metaKey || e.ctrlKey)) {\n                //paste\n                this.pasteFromClipboard(e.shiftKey);\n            }\n\n            //delete or backspace\n            if (e.keyCode == 46 || e.keyCode == 8) {\n                if (\n                    e.target.localName != \"input\" &&\n                    e.target.localName != \"textarea\"\n                ) {\n                    this.deleteSelectedNodes();\n                    block_default = true;\n                }\n            }\n\n            //collapse\n            //...\n\n            //TODO\n            if (this.selected_nodes) {\n                for (var i in this.selected_nodes) {\n                    if (this.selected_nodes[i].onKeyDown) {\n                        this.selected_nodes[i].onKeyDown(e);\n                    }\n                }\n            }\n        } else if (e.type == \"keyup\") {\n            if (e.keyCode == 32) {\n                // space\n                this.dragging_canvas = false;\n            }\n\n            if (this.selected_nodes) {\n                for (var i in this.selected_nodes) {\n                    if (this.selected_nodes[i].onKeyUp) {\n                        this.selected_nodes[i].onKeyUp(e);\n                    }\n                }\n            }\n        }\n\n        this.graph.change();\n\n        if (block_default) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            return false;\n        }\n    };\n\n    LGraphCanvas.prototype.copyToClipboard = function() {\n        var clipboard_info = {\n            nodes: [],\n            links: []\n        };\n        var index = 0;\n        var selected_nodes_array = [];\n        for (var i in this.selected_nodes) {\n            var node = this.selected_nodes[i];\n            if (node.clonable === false)\n                continue;\n            node._relative_id = index;\n            selected_nodes_array.push(node);\n            index += 1;\n        }\n\n        for (var i = 0; i < selected_nodes_array.length; ++i) {\n            var node = selected_nodes_array[i];\n            if(node.clonable === false)\n                continue;\n            var cloned = node.clone();\n            if(!cloned)\n            {\n                console.warn(\"node type not found: \" + node.type );\n                continue;\n            }\n            clipboard_info.nodes.push(cloned.serialize());\n            if (node.inputs && node.inputs.length) {\n                for (var j = 0; j < node.inputs.length; ++j) {\n                    var input = node.inputs[j];\n                    if (!input || input.link == null) {\n                        continue;\n                    }\n                    var link_info = this.graph.links[input.link];\n                    if (!link_info) {\n                        continue;\n                    }\n                    var target_node = this.graph.getNodeById(\n                        link_info.origin_id\n                    );\n                    if (!target_node) {\n                        continue;\n                    }\n                    clipboard_info.links.push([\n                        target_node._relative_id,\n                        link_info.origin_slot, //j,\n                        node._relative_id,\n                        link_info.target_slot,\n                        target_node.id\n                    ]);\n                }\n            }\n        }\n        localStorage.setItem(\n            \"litegrapheditor_clipboard\",\n            JSON.stringify(clipboard_info)\n        );\n    };\n\n    LGraphCanvas.prototype.pasteFromClipboard = function(isConnectUnselected = false) {\n        // if ctrl + shift + v is off, return when isConnectUnselected is true (shift is pressed) to maintain old behavior\n        if (!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs && isConnectUnselected) {\n            return;\n        }\n        var data = localStorage.getItem(\"litegrapheditor_clipboard\");\n        if (!data) {\n            return;\n        }\n\n\t\tthis.graph.beforeChange();\n\n        //create nodes\n        var clipboard_info = JSON.parse(data);\n        // calculate top-left node, could work without this processing but using diff with last node pos :: clipboard_info.nodes[clipboard_info.nodes.length-1].pos\n        var posMin = false;\n        var posMinIndexes = false;\n        for (var i = 0; i < clipboard_info.nodes.length; ++i) {\n            if (posMin){\n                if(posMin[0]>clipboard_info.nodes[i].pos[0]){\n                    posMin[0] = clipboard_info.nodes[i].pos[0];\n                    posMinIndexes[0] = i;\n                }\n                if(posMin[1]>clipboard_info.nodes[i].pos[1]){\n                    posMin[1] = clipboard_info.nodes[i].pos[1];\n                    posMinIndexes[1] = i;\n                }\n            }\n            else{\n                posMin = [clipboard_info.nodes[i].pos[0], clipboard_info.nodes[i].pos[1]];\n                posMinIndexes = [i, i];\n            }\n        }\n        var nodes = [];\n        for (var i = 0; i < clipboard_info.nodes.length; ++i) {\n            var node_data = clipboard_info.nodes[i];\n            var node = LiteGraph.createNode(node_data.type);\n            if (node) {\n                node.configure(node_data);\n        \n\t\t\t\t//paste in last known mouse position\n                node.pos[0] += this.graph_mouse[0] - posMin[0]; //+= 5;\n                node.pos[1] += this.graph_mouse[1] - posMin[1]; //+= 5;\n\n                this.graph.add(node,{doProcessChange:false});\n                \n                nodes.push(node);\n            }\n        }\n\n        //create links\n        for (var i = 0; i < clipboard_info.links.length; ++i) {\n            var link_info = clipboard_info.links[i];\n            var origin_node;\n            var origin_node_relative_id = link_info[0];\n            if (origin_node_relative_id != null) {\n                origin_node = nodes[origin_node_relative_id];\n            } else if (LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs && isConnectUnselected) {\n                var origin_node_id = link_info[4];\n                if (origin_node_id) {\n                    origin_node = this.graph.getNodeById(origin_node_id);\n                }\n            }\n            var target_node = nodes[link_info[2]];\n\t\t\tif( origin_node && target_node )\n\t            origin_node.connect(link_info[1], target_node, link_info[3]);\n\t\t\telse\n\t\t\t\tconsole.warn(\"Warning, nodes missing on pasting\");\n        }\n\n        this.selectNodes(nodes);\n\n\t\tthis.graph.afterChange();\n    };\n\n    /**\n     * process a item drop event on top the canvas\n     * @method processDrop\n     **/\n    LGraphCanvas.prototype.processDrop = function(e) {\n        e.preventDefault();\n        this.adjustMouseEvent(e);\n\t\tvar x = e.clientX;\n\t\tvar y = e.clientY;\n\t\tvar is_inside = !this.viewport || ( this.viewport && x >= this.viewport[0] && x < (this.viewport[0] + this.viewport[2]) && y >= this.viewport[1] && y < (this.viewport[1] + this.viewport[3]) );\n\t\tif(!is_inside){\n\t\t\treturn;\n\t\t\t// --- BREAK ---\n\t\t}\n\n        var pos = [e.canvasX, e.canvasY];\n\n\n        var node = this.graph ? this.graph.getNodeOnPos(pos[0], pos[1]) : null;\n\n        if (!node) {\n            var r = null;\n            if (this.onDropItem) {\n                r = this.onDropItem(event);\n            }\n            if (!r) {\n                this.checkDropItem(e);\n            }\n            return;\n        }\n\n        if (node.onDropFile || node.onDropData) {\n            var files = e.dataTransfer.files;\n            if (files && files.length) {\n                for (var i = 0; i < files.length; i++) {\n                    var file = e.dataTransfer.files[0];\n                    var filename = file.name;\n                    var ext = LGraphCanvas.getFileExtension(filename);\n                    //console.log(file);\n\n                    if (node.onDropFile) {\n                        node.onDropFile(file);\n                    }\n\n                    if (node.onDropData) {\n                        //prepare reader\n                        var reader = new FileReader();\n                        reader.onload = function(event) {\n                            //console.log(event.target);\n                            var data = event.target.result;\n                            node.onDropData(data, filename, file);\n                        };\n\n                        //read data\n                        var type = file.type.split(\"/\")[0];\n                        if (type == \"text\" || type == \"\") {\n                            reader.readAsText(file);\n                        } else if (type == \"image\") {\n                            reader.readAsDataURL(file);\n                        } else {\n                            reader.readAsArrayBuffer(file);\n                        }\n                    }\n                }\n            }\n        }\n\n        if (node.onDropItem) {\n            if (node.onDropItem(event)) {\n                return true;\n            }\n        }\n\n        if (this.onDropItem) {\n            return this.onDropItem(event);\n        }\n\n        return false;\n    };\n\n    //called if the graph doesn't have a default drop item behaviour\n    LGraphCanvas.prototype.checkDropItem = function(e) {\n        if (e.dataTransfer.files.length) {\n            var file = e.dataTransfer.files[0];\n            var ext = LGraphCanvas.getFileExtension(file.name).toLowerCase();\n            var nodetype = LiteGraph.node_types_by_file_extension[ext];\n            if (nodetype) {\n\t\t\t\tthis.graph.beforeChange();\n                var node = LiteGraph.createNode(nodetype.type);\n                node.pos = [e.canvasX, e.canvasY];\n                this.graph.add(node);\n                if (node.onDropFile) {\n                    node.onDropFile(file);\n                }\n\t\t\t\tthis.graph.afterChange();\n            }\n        }\n    };\n\n    LGraphCanvas.prototype.processNodeDblClicked = function(n) {\n        if (this.onShowNodePanel) {\n            this.onShowNodePanel(n);\n        }\n\t\telse\n\t\t{\n\t\t\tthis.showShowNodePanel(n);\n\t\t}\n\n        if (this.onNodeDblClicked) {\n            this.onNodeDblClicked(n);\n        }\n\n        this.setDirty(true);\n    };\n\n    LGraphCanvas.prototype.processNodeSelected = function(node, e) {\n        this.selectNode(node, e && (e.shiftKey || e.ctrlKey || this.multi_select));\n        if (this.onNodeSelected) {\n            this.onNodeSelected(node);\n        }\n    };\n\n    /**\n     * selects a given node (or adds it to the current selection)\n     * @method selectNode\n     **/\n    LGraphCanvas.prototype.selectNode = function(\n        node,\n        add_to_current_selection\n    ) {\n        if (node == null) {\n            this.deselectAllNodes();\n        } else {\n            this.selectNodes([node], add_to_current_selection);\n        }\n    };\n\n    /**\n     * selects several nodes (or adds them to the current selection)\n     * @method selectNodes\n     **/\n    LGraphCanvas.prototype.selectNodes = function( nodes, add_to_current_selection )\n\t{\n\t\tif (!add_to_current_selection) {\n            this.deselectAllNodes();\n        }\n\n        nodes = nodes || this.graph._nodes;\n\t\tif (typeof nodes == \"string\") nodes = [nodes];\n        for (var i in nodes) {\n            var node = nodes[i];\n            if (node.is_selected) {\n                this.deselectNode(node);\n                continue;\n            }\n\n            if (!node.is_selected && node.onSelected) {\n                node.onSelected();\n            }\n            node.is_selected = true;\n            this.selected_nodes[node.id] = node;\n\n            if (node.inputs) {\n                for (var j = 0; j < node.inputs.length; ++j) {\n                    this.highlighted_links[node.inputs[j].link] = true;\n                }\n            }\n            if (node.outputs) {\n                for (var j = 0; j < node.outputs.length; ++j) {\n                    var out = node.outputs[j];\n                    if (out.links) {\n                        for (var k = 0; k < out.links.length; ++k) {\n                            this.highlighted_links[out.links[k]] = true;\n                        }\n                    }\n                }\n            }\n        }\n\n\t\tif(\tthis.onSelectionChange )\n\t\t\tthis.onSelectionChange( this.selected_nodes );\n\n        this.setDirty(true);\n    };\n\n    /**\n     * removes a node from the current selection\n     * @method deselectNode\n     **/\n    LGraphCanvas.prototype.deselectNode = function(node) {\n        if (!node.is_selected) {\n            return;\n        }\n        if (node.onDeselected) {\n            node.onDeselected();\n        }\n        node.is_selected = false;\n\n        if (this.onNodeDeselected) {\n            this.onNodeDeselected(node);\n        }\n\n        //remove highlighted\n        if (node.inputs) {\n            for (var i = 0; i < node.inputs.length; ++i) {\n                delete this.highlighted_links[node.inputs[i].link];\n            }\n        }\n        if (node.outputs) {\n            for (var i = 0; i < node.outputs.length; ++i) {\n                var out = node.outputs[i];\n                if (out.links) {\n                    for (var j = 0; j < out.links.length; ++j) {\n                        delete this.highlighted_links[out.links[j]];\n                    }\n                }\n            }\n        }\n    };\n\n    /**\n     * removes all nodes from the current selection\n     * @method deselectAllNodes\n     **/\n    LGraphCanvas.prototype.deselectAllNodes = function() {\n        if (!this.graph) {\n            return;\n        }\n        var nodes = this.graph._nodes;\n        for (var i = 0, l = nodes.length; i < l; ++i) {\n            var node = nodes[i];\n            if (!node.is_selected) {\n                continue;\n            }\n            if (node.onDeselected) {\n                node.onDeselected();\n            }\n            node.is_selected = false;\n\t\t\tif (this.onNodeDeselected) {\n\t\t\t\tthis.onNodeDeselected(node);\n\t\t\t}\n        }\n        this.selected_nodes = {};\n        this.current_node = null;\n        this.highlighted_links = {};\n\t\tif(\tthis.onSelectionChange )\n\t\t\tthis.onSelectionChange( this.selected_nodes );\n        this.setDirty(true);\n    };\n\n    /**\n     * deletes all nodes in the current selection from the graph\n     * @method deleteSelectedNodes\n     **/\n    LGraphCanvas.prototype.deleteSelectedNodes = function() {\n\n\t\tthis.graph.beforeChange();\n\n        for (var i in this.selected_nodes) {\n            var node = this.selected_nodes[i];\n\n\t\t\tif(node.block_delete)\n\t\t\t\tcontinue;\n\n\t\t\t//autoconnect when possible (very basic, only takes into account first input-output)\n\t\t\tif(node.inputs && node.inputs.length && node.outputs && node.outputs.length && LiteGraph.isValidConnection( node.inputs[0].type, node.outputs[0].type ) && node.inputs[0].link && node.outputs[0].links && node.outputs[0].links.length ) \n\t\t\t{\n\t\t\t\tvar input_link = node.graph.links[ node.inputs[0].link ];\n\t\t\t\tvar output_link = node.graph.links[ node.outputs[0].links[0] ];\n\t\t\t\tvar input_node = node.getInputNode(0);\n\t\t\t\tvar output_node = node.getOutputNodes(0)[0];\n\t\t\t\tif(input_node && output_node)\n\t\t\t\t\tinput_node.connect( input_link.origin_slot, output_node, output_link.target_slot );\n\t\t\t}\n            this.graph.remove(node);\n\t\t\tif (this.onNodeDeselected) {\n\t\t\t\tthis.onNodeDeselected(node);\n\t\t\t}\n        }\n        this.selected_nodes = {};\n        this.current_node = null;\n        this.highlighted_links = {};\n        this.setDirty(true);\n\t\tthis.graph.afterChange();\n    };\n    \n    /**\n     * centers the camera on a given node\n     * @method centerOnNode\n     **/\n    LGraphCanvas.prototype.centerOnNode = function(node) {\n        this.ds.offset[0] =\n            -node.pos[0] -\n            node.size[0] * 0.5 +\n            (this.canvas.width * 0.5) / this.ds.scale;\n        this.ds.offset[1] =\n            -node.pos[1] -\n            node.size[1] * 0.5 +\n            (this.canvas.height * 0.5) / this.ds.scale;\n        this.setDirty(true, true);\n    };\n\n    /**\n     * adds some useful properties to a mouse event, like the position in graph coordinates\n     * @method adjustMouseEvent\n     **/\n    LGraphCanvas.prototype.adjustMouseEvent = function(e) {\n\tvar clientX_rel = 0;\n        var clientY_rel = 0;\n\t    \n    \tif (this.canvas) {\n            var b = this.canvas.getBoundingClientRect();\n            clientX_rel = e.clientX - b.left;\n            clientY_rel = e.clientY - b.top;\n        } else {\n        \tclientX_rel = e.clientX;\n        \tclientY_rel = e.clientY;\n        }\n    \t\n        // e.deltaX = clientX_rel - this.last_mouse_position[0];\n        // e.deltaY = clientY_rel- this.last_mouse_position[1];\n\n        this.last_mouse_position[0] = clientX_rel;\n        this.last_mouse_position[1] = clientY_rel;\n\n        e.canvasX = clientX_rel / this.ds.scale - this.ds.offset[0];\n        e.canvasY = clientY_rel / this.ds.scale - this.ds.offset[1];\n        \n        //console.log(\"pointerevents: adjustMouseEvent \"+e.clientX+\":\"+e.clientY+\" \"+clientX_rel+\":\"+clientY_rel+\" \"+e.canvasX+\":\"+e.canvasY);\n    };\n\n    /**\n     * changes the zoom level of the graph (default is 1), you can pass also a place used to pivot the zoom\n     * @method setZoom\n     **/\n    LGraphCanvas.prototype.setZoom = function(value, zooming_center) {\n        this.ds.changeScale(value, zooming_center);\n        /*\n\tif(!zooming_center && this.canvas)\n\t\tzooming_center = [this.canvas.width * 0.5,this.canvas.height * 0.5];\n\n\tvar center = this.convertOffsetToCanvas( zooming_center );\n\n\tthis.ds.scale = value;\n\n\tif(this.scale > this.max_zoom)\n\t\tthis.scale = this.max_zoom;\n\telse if(this.scale < this.min_zoom)\n\t\tthis.scale = this.min_zoom;\n\n\tvar new_center = this.convertOffsetToCanvas( zooming_center );\n\tvar delta_offset = [new_center[0] - center[0], new_center[1] - center[1]];\n\n\tthis.offset[0] += delta_offset[0];\n\tthis.offset[1] += delta_offset[1];\n\t*/\n\n        this.dirty_canvas = true;\n        this.dirty_bgcanvas = true;\n    };\n\n    /**\n     * converts a coordinate from graph coordinates to canvas2D coordinates\n     * @method convertOffsetToCanvas\n     **/\n    LGraphCanvas.prototype.convertOffsetToCanvas = function(pos, out) {\n        return this.ds.convertOffsetToCanvas(pos, out);\n    };\n\n    /**\n     * converts a coordinate from Canvas2D coordinates to graph space\n     * @method convertCanvasToOffset\n     **/\n    LGraphCanvas.prototype.convertCanvasToOffset = function(pos, out) {\n        return this.ds.convertCanvasToOffset(pos, out);\n    };\n\n    //converts event coordinates from canvas2D to graph coordinates\n    LGraphCanvas.prototype.convertEventToCanvasOffset = function(e) {\n        var rect = this.canvas.getBoundingClientRect();\n        return this.convertCanvasToOffset([\n            e.clientX - rect.left,\n            e.clientY - rect.top\n        ]);\n    };\n\n    /**\n     * brings a node to front (above all other nodes)\n     * @method bringToFront\n     **/\n    LGraphCanvas.prototype.bringToFront = function(node) {\n        var i = this.graph._nodes.indexOf(node);\n        if (i == -1) {\n            return;\n        }\n\n        this.graph._nodes.splice(i, 1);\n        this.graph._nodes.push(node);\n    };\n\n    /**\n     * sends a node to the back (below all other nodes)\n     * @method sendToBack\n     **/\n    LGraphCanvas.prototype.sendToBack = function(node) {\n        var i = this.graph._nodes.indexOf(node);\n        if (i == -1) {\n            return;\n        }\n\n        this.graph._nodes.splice(i, 1);\n        this.graph._nodes.unshift(node);\n    };\n\n    /* Interaction */\n\n    /* LGraphCanvas render */\n    var temp = new Float32Array(4);\n\n    /**\n     * checks which nodes are visible (inside the camera area)\n     * @method computeVisibleNodes\n     **/\n    LGraphCanvas.prototype.computeVisibleNodes = function(nodes, out) {\n        var visible_nodes = out || [];\n        visible_nodes.length = 0;\n        nodes = nodes || this.graph._nodes;\n        for (var i = 0, l = nodes.length; i < l; ++i) {\n            var n = nodes[i];\n\n            //skip rendering nodes in live mode\n            if (this.live_mode && !n.onDrawBackground && !n.onDrawForeground) {\n                continue;\n            }\n\n            if (!overlapBounding(this.visible_area, n.getBounding(temp, true))) {\n                continue;\n            } //out of the visible area\n\n            visible_nodes.push(n);\n        }\n        return visible_nodes;\n    };\n\n    /**\n     * renders the whole canvas content, by rendering in two separated canvas, one containing the background grid and the connections, and one containing the nodes)\n     * @method draw\n     **/\n    LGraphCanvas.prototype.draw = function(force_canvas, force_bgcanvas) {\n        if (!this.canvas || this.canvas.width == 0 || this.canvas.height == 0) {\n            return;\n        }\n\n        //fps counting\n        var now = LiteGraph.getTime();\n        this.render_time = (now - this.last_draw_time) * 0.001;\n        this.last_draw_time = now;\n\n        if (this.graph) {\n            this.ds.computeVisibleArea(this.viewport);\n        }\n\n        if (\n            this.dirty_bgcanvas ||\n            force_bgcanvas ||\n            this.always_render_background ||\n            (this.graph &&\n                this.graph._last_trigger_time &&\n                now - this.graph._last_trigger_time < 1000)\n        ) {\n            this.drawBackCanvas();\n        }\n\n        if (this.dirty_canvas || force_canvas) {\n            this.drawFrontCanvas();\n        }\n\n        this.fps = this.render_time ? 1.0 / this.render_time : 0;\n        this.frame += 1;\n    };\n\n    /**\n     * draws the front canvas (the one containing all the nodes)\n     * @method drawFrontCanvas\n     **/\n    LGraphCanvas.prototype.drawFrontCanvas = function() {\n        this.dirty_canvas = false;\n\n        if (!this.ctx) {\n            this.ctx = this.bgcanvas.getContext(\"2d\");\n        }\n        var ctx = this.ctx;\n        if (!ctx) {\n            //maybe is using webgl...\n            return;\n        }\n\n        var canvas = this.canvas;\n        if ( ctx.start2D && !this.viewport ) {\n            ctx.start2D();\n\t\t\tctx.restore();\n\t\t\tctx.setTransform(1, 0, 0, 1, 0, 0);\n        }\n\n        //clip dirty area if there is one, otherwise work in full canvas\n\t\tvar area = this.viewport || this.dirty_area;\n        if (area) {\n            ctx.save();\n            ctx.beginPath();\n            ctx.rect( area[0],area[1],area[2],area[3] );\n            ctx.clip();\n        }\n\n        //clear\n        //canvas.width = canvas.width;\n        if (this.clear_background) {\n\t\t\tif(area)\n\t            ctx.clearRect( area[0],area[1],area[2],area[3] );\n\t\t\telse\n\t            ctx.clearRect(0, 0, canvas.width, canvas.height);\n        }\n\n        //draw bg canvas\n        if (this.bgcanvas == this.canvas) {\n            this.drawBackCanvas();\n        } else {\n            ctx.drawImage( this.bgcanvas, 0, 0 );\n        }\n\n        //rendering\n        if (this.onRender) {\n            this.onRender(canvas, ctx);\n        }\n\n        //info widget\n        if (this.show_info) {\n            this.renderInfo(ctx, area ? area[0] : 0, area ? area[1] : 0 );\n        }\n\n        if (this.graph) {\n            //apply transformations\n            ctx.save();\n            this.ds.toCanvasContext(ctx);\n\n            //draw nodes\n            var drawn_nodes = 0;\n            var visible_nodes = this.computeVisibleNodes(\n                null,\n                this.visible_nodes\n            );\n\n            for (var i = 0; i < visible_nodes.length; ++i) {\n                var node = visible_nodes[i];\n\n                //transform coords system\n                ctx.save();\n                ctx.translate(node.pos[0], node.pos[1]);\n\n                //Draw\n                this.drawNode(node, ctx);\n                drawn_nodes += 1;\n\n                //Restore\n                ctx.restore();\n            }\n\n            //on top (debug)\n            if (this.render_execution_order) {\n                this.drawExecutionOrder(ctx);\n            }\n\n            //connections ontop?\n            if (this.graph.config.links_ontop) {\n                if (!this.live_mode) {\n                    this.drawConnections(ctx);\n                }\n            }\n\n            //current connection (the one being dragged by the mouse)\n            if (this.connecting_pos != null) {\n                ctx.lineWidth = this.connections_width;\n                var link_color = null;\n                \n                var connInOrOut = this.connecting_output || this.connecting_input;\n\n                var connType = connInOrOut.type;\n                var connDir = connInOrOut.dir;\n\t\t\t\tif(connDir == null)\n\t\t\t\t{\n\t\t\t\t\tif (this.connecting_output)\n\t\t\t\t\t\tconnDir = this.connecting_node.horizontal ? LiteGraph.DOWN : LiteGraph.RIGHT;\n\t\t\t\t\telse\n\t\t\t\t\t\tconnDir = this.connecting_node.horizontal ? LiteGraph.UP : LiteGraph.LEFT;\n\t\t\t\t}\n                var connShape = connInOrOut.shape;\n                \n                switch (connType) {\n                    case LiteGraph.EVENT:\n                        link_color = LiteGraph.EVENT_LINK_COLOR;\n                        break;\n                    default:\n                        link_color = LiteGraph.CONNECTING_LINK_COLOR;\n                }\n\n                //the connection being dragged by the mouse\n                this.renderLink(\n                    ctx,\n                    this.connecting_pos,\n                    [this.graph_mouse[0], this.graph_mouse[1]],\n                    null,\n                    false,\n                    null,\n                    link_color,\n                    connDir,\n                    LiteGraph.CENTER\n                );\n\n                ctx.beginPath();\n                if (\n                    connType === LiteGraph.EVENT ||\n                    connShape === LiteGraph.BOX_SHAPE\n                ) {\n                    ctx.rect(\n                        this.connecting_pos[0] - 6 + 0.5,\n                        this.connecting_pos[1] - 5 + 0.5,\n                        14,\n                        10\n                    );\n\t                ctx.fill();\n\t\t\t\t\tctx.beginPath();\n                    ctx.rect(\n                        this.graph_mouse[0] - 6 + 0.5,\n                        this.graph_mouse[1] - 5 + 0.5,\n                        14,\n                        10\n                    );\n                } else if (connShape === LiteGraph.ARROW_SHAPE) {\n                    ctx.moveTo(this.connecting_pos[0] + 8, this.connecting_pos[1] + 0.5);\n                    ctx.lineTo(this.connecting_pos[0] - 4, this.connecting_pos[1] + 6 + 0.5);\n                    ctx.lineTo(this.connecting_pos[0] - 4, this.connecting_pos[1] - 6 + 0.5);\n                    ctx.closePath();\n                } \n                else {\n                    ctx.arc(\n                        this.connecting_pos[0],\n                        this.connecting_pos[1],\n                        4,\n                        0,\n                        Math.PI * 2\n                    );\n\t                ctx.fill();\n\t\t\t\t\tctx.beginPath();\n                    ctx.arc(\n                        this.graph_mouse[0],\n                        this.graph_mouse[1],\n                        4,\n                        0,\n                        Math.PI * 2\n                    );\n                }\n                ctx.fill();\n\n                ctx.fillStyle = \"#ffcc00\";\n                if (this._highlight_input) {\n                    ctx.beginPath();\n                    var shape = this._highlight_input_slot.shape;\n                    if (shape === LiteGraph.ARROW_SHAPE) {\n                        ctx.moveTo(this._highlight_input[0] + 8, this._highlight_input[1] + 0.5);\n                        ctx.lineTo(this._highlight_input[0] - 4, this._highlight_input[1] + 6 + 0.5);\n                        ctx.lineTo(this._highlight_input[0] - 4, this._highlight_input[1] - 6 + 0.5);\n                        ctx.closePath();\n                    } else {\n                        ctx.arc(\n                            this._highlight_input[0],\n                            this._highlight_input[1],\n                            6,\n                            0,\n                            Math.PI * 2\n                        );\n                    }\n                    ctx.fill();\n                }\n                if (this._highlight_output) {\n                    ctx.beginPath();\n                    if (shape === LiteGraph.ARROW_SHAPE) {\n                        ctx.moveTo(this._highlight_output[0] + 8, this._highlight_output[1] + 0.5);\n                        ctx.lineTo(this._highlight_output[0] - 4, this._highlight_output[1] + 6 + 0.5);\n                        ctx.lineTo(this._highlight_output[0] - 4, this._highlight_output[1] - 6 + 0.5);\n                        ctx.closePath();\n                    } else {\n                        ctx.arc(\n                            this._highlight_output[0],\n                            this._highlight_output[1],\n                            6,\n                            0,\n                            Math.PI * 2\n                        );\n                    }\n                    ctx.fill();\n                }\n            }\n\n\t\t\t//the selection rectangle\n            if (this.dragging_rectangle) {\n                ctx.strokeStyle = \"#FFF\";\n                ctx.strokeRect(\n                    this.dragging_rectangle[0],\n                    this.dragging_rectangle[1],\n                    this.dragging_rectangle[2],\n                    this.dragging_rectangle[3]\n                );\n            }\n\n\t\t\t//on top of link center\n\t\t\tif(this.over_link_center && this.render_link_tooltip)\n\t\t\t\tthis.drawLinkTooltip( ctx, this.over_link_center );\n\t\t\telse\n\t\t\t\tif(this.onDrawLinkTooltip) //to remove\n\t\t\t\t\tthis.onDrawLinkTooltip(ctx,null);\n\n\t\t\t//custom info\n            if (this.onDrawForeground) {\n                this.onDrawForeground(ctx, this.visible_rect);\n            }\n\n            ctx.restore();\n        }\n\n\t\t//draws panel in the corner \n\t\tif (this._graph_stack && this._graph_stack.length) {\n\t\t\tthis.drawSubgraphPanel( ctx );\n\t\t}\n\n\n        if (this.onDrawOverlay) {\n            this.onDrawOverlay(ctx);\n        }\n\n        if (area){\n            ctx.restore();\n        }\n\n        if (ctx.finish2D) {\n            //this is a function I use in webgl renderer\n            ctx.finish2D();\n        }\n    };\n\n    /**\n     * draws the panel in the corner that shows subgraph properties\n     * @method drawSubgraphPanel\n     **/\n    LGraphCanvas.prototype.drawSubgraphPanel = function (ctx) {\n        var subgraph = this.graph;\n        var subnode = subgraph._subgraph_node;\n        if (!subnode) {\n            console.warn(\"subgraph without subnode\");\n            return;\n        }\n        this.drawSubgraphPanelLeft(subgraph, subnode, ctx)\n        this.drawSubgraphPanelRight(subgraph, subnode, ctx)\n    }\n\n    LGraphCanvas.prototype.drawSubgraphPanelLeft = function (subgraph, subnode, ctx) {\n        var num = subnode.inputs ? subnode.inputs.length : 0;\n        var w = 200;\n        var h = Math.floor(LiteGraph.NODE_SLOT_HEIGHT * 1.6);\n\n        ctx.fillStyle = \"#111\";\n        ctx.globalAlpha = 0.8;\n        ctx.beginPath();\n        ctx.roundRect(10, 10, w, (num + 1) * h + 50, [8]);\n        ctx.fill();\n        ctx.globalAlpha = 1;\n\n        ctx.fillStyle = \"#888\";\n        ctx.font = \"14px Arial\";\n        ctx.textAlign = \"left\";\n        ctx.fillText(\"Graph Inputs\", 20, 34);\n        // var pos = this.mouse;\n\n        if (this.drawButton(w - 20, 20, 20, 20, \"X\", \"#151515\")) {\n            this.closeSubgraph();\n            return;\n        }\n\n        var y = 50;\n        ctx.font = \"14px Arial\";\n        if (subnode.inputs)\n            for (var i = 0; i < subnode.inputs.length; ++i) {\n                var input = subnode.inputs[i];\n                if (input.not_subgraph_input)\n                    continue;\n\n                //input button clicked\n                if (this.drawButton(20, y + 2, w - 20, h - 2)) {\n                    var type = subnode.constructor.input_node_type || \"graph/input\";\n                    this.graph.beforeChange();\n                    var newnode = LiteGraph.createNode(type);\n                    if (newnode) {\n                        subgraph.add(newnode);\n                        this.block_click = false;\n                        this.last_click_position = null;\n                        this.selectNodes([newnode]);\n                        this.node_dragged = newnode;\n                        this.dragging_canvas = false;\n                        newnode.setProperty(\"name\", input.name);\n                        newnode.setProperty(\"type\", input.type);\n                        this.node_dragged.pos[0] = this.graph_mouse[0] - 5;\n                        this.node_dragged.pos[1] = this.graph_mouse[1] - 5;\n                        this.graph.afterChange();\n                    }\n                    else\n                        console.error(\"graph input node not found:\", type);\n                }\n                ctx.fillStyle = \"#9C9\";\n                ctx.beginPath();\n                ctx.arc(w - 16, y + h * 0.5, 5, 0, 2 * Math.PI);\n                ctx.fill();\n                ctx.fillStyle = \"#AAA\";\n                ctx.fillText(input.name, 30, y + h * 0.75);\n                // var tw = ctx.measureText(input.name);\n                ctx.fillStyle = \"#777\";\n                ctx.fillText(input.type, 130, y + h * 0.75);\n                y += h;\n            }\n        //add + button\n        if (this.drawButton(20, y + 2, w - 20, h - 2, \"+\", \"#151515\", \"#222\")) {\n            this.showSubgraphPropertiesDialog(subnode);\n        }\n    }\n    LGraphCanvas.prototype.drawSubgraphPanelRight = function (subgraph, subnode, ctx) {\n        var num = subnode.outputs ? subnode.outputs.length : 0;\n        var canvas_w = this.bgcanvas.width\n        var w = 200;\n        var h = Math.floor(LiteGraph.NODE_SLOT_HEIGHT * 1.6);\n\n        ctx.fillStyle = \"#111\";\n        ctx.globalAlpha = 0.8;\n        ctx.beginPath();\n        ctx.roundRect(canvas_w - w - 10, 10, w, (num + 1) * h + 50, [8]);\n        ctx.fill();\n        ctx.globalAlpha = 1;\n\n        ctx.fillStyle = \"#888\";\n        ctx.font = \"14px Arial\";\n        ctx.textAlign = \"left\";\n        var title_text = \"Graph Outputs\"\n        var tw = ctx.measureText(title_text).width\n        ctx.fillText(title_text, (canvas_w - tw) - 20, 34);\n        // var pos = this.mouse;\n        if (this.drawButton(canvas_w - w, 20, 20, 20, \"X\", \"#151515\")) {\n            this.closeSubgraph();\n            return;\n        }\n\n        var y = 50;\n        ctx.font = \"14px Arial\";\n        if (subnode.outputs)\n            for (var i = 0; i < subnode.outputs.length; ++i) {\n                var output = subnode.outputs[i];\n                if (output.not_subgraph_input)\n                    continue;\n\n                //output button clicked\n                if (this.drawButton(canvas_w - w, y + 2, w - 20, h - 2)) {\n                    var type = subnode.constructor.output_node_type || \"graph/output\";\n                    this.graph.beforeChange();\n                    var newnode = LiteGraph.createNode(type);\n                    if (newnode) {\n                        subgraph.add(newnode);\n                        this.block_click = false;\n                        this.last_click_position = null;\n                        this.selectNodes([newnode]);\n                        this.node_dragged = newnode;\n                        this.dragging_canvas = false;\n                        newnode.setProperty(\"name\", output.name);\n                        newnode.setProperty(\"type\", output.type);\n                        this.node_dragged.pos[0] = this.graph_mouse[0] - 5;\n                        this.node_dragged.pos[1] = this.graph_mouse[1] - 5;\n                        this.graph.afterChange();\n                    }\n                    else\n                        console.error(\"graph input node not found:\", type);\n                }\n                ctx.fillStyle = \"#9C9\";\n                ctx.beginPath();\n                ctx.arc(canvas_w - w + 16, y + h * 0.5, 5, 0, 2 * Math.PI);\n                ctx.fill();\n                ctx.fillStyle = \"#AAA\";\n                ctx.fillText(output.name, canvas_w - w + 30, y + h * 0.75);\n                // var tw = ctx.measureText(input.name);\n                ctx.fillStyle = \"#777\";\n                ctx.fillText(output.type, canvas_w - w + 130, y + h * 0.75);\n                y += h;\n            }\n        //add + button\n        if (this.drawButton(canvas_w - w, y + 2, w - 20, h - 2, \"+\", \"#151515\", \"#222\")) {\n            this.showSubgraphPropertiesDialogRight(subnode);\n        }\n    }\n\t//Draws a button into the canvas overlay and computes if it was clicked using the immediate gui paradigm\n\tLGraphCanvas.prototype.drawButton = function( x,y,w,h, text, bgcolor, hovercolor, textcolor )\n\t{\n\t\tvar ctx = this.ctx;\n\t\tbgcolor = bgcolor || LiteGraph.NODE_DEFAULT_COLOR;\n\t\thovercolor = hovercolor || \"#555\";\n\t\ttextcolor = textcolor || LiteGraph.NODE_TEXT_COLOR;\n\t\tvar pos = this.ds.convertOffsetToCanvas(this.graph_mouse);\n\t\tvar hover = LiteGraph.isInsideRectangle( pos[0], pos[1], x,y,w,h );\n\t\tpos = this.last_click_position ? [this.last_click_position[0], this.last_click_position[1]] : null;\n        if(pos) {\n            var rect = this.canvas.getBoundingClientRect();\n            pos[0] -= rect.left;\n            pos[1] -= rect.top;\n        }\n\t\tvar clicked = pos && LiteGraph.isInsideRectangle( pos[0], pos[1], x,y,w,h );\n\n\t\tctx.fillStyle = hover ? hovercolor : bgcolor;\n\t\tif(clicked)\n\t\t\tctx.fillStyle = \"#AAA\";\n\t\tctx.beginPath();\n\t\tctx.roundRect(x,y,w,h,[4] );\n\t\tctx.fill();\n\n\t\tif(text != null)\n\t\t{\n\t\t\tif(text.constructor == String)\n\t\t\t{\n\t\t\t\tctx.fillStyle = textcolor;\n\t\t\t\tctx.textAlign = \"center\";\n\t\t\t\tctx.font = ((h * 0.65)|0) + \"px Arial\";\n\t\t\t\tctx.fillText( text, x + w * 0.5,y + h * 0.75 );\n\t\t\t\tctx.textAlign = \"left\";\n\t\t\t}\n\t\t}\n\n\t\tvar was_clicked = clicked && !this.block_click;\n\t\tif(clicked)\n\t\t\tthis.blockClick();\n\t\treturn was_clicked;\n\t}\n\n\tLGraphCanvas.prototype.isAreaClicked = function( x,y,w,h, hold_click )\n\t{\n\t\tvar pos = this.mouse;\n\t\tvar hover = LiteGraph.isInsideRectangle( pos[0], pos[1], x,y,w,h );\n\t\tpos = this.last_click_position;\n\t\tvar clicked = pos && LiteGraph.isInsideRectangle( pos[0], pos[1], x,y,w,h );\n\t\tvar was_clicked = clicked && !this.block_click;\n\t\tif(clicked && hold_click)\n\t\t\tthis.blockClick();\n\t\treturn was_clicked;\n\t}\n\n    /**\n     * draws some useful stats in the corner of the canvas\n     * @method renderInfo\n     **/\n    LGraphCanvas.prototype.renderInfo = function(ctx, x, y) {\n        x = x || 10;\n        y = y || this.canvas.height - 80;\n\n        ctx.save();\n        ctx.translate(x, y);\n\n        ctx.font = \"10px Arial\";\n        ctx.fillStyle = \"#888\";\n\t\tctx.textAlign = \"left\";\n        if (this.graph) {\n            ctx.fillText( \"T: \" + this.graph.globaltime.toFixed(2) + \"s\", 5, 13 * 1 );\n            ctx.fillText(\"I: \" + this.graph.iteration, 5, 13 * 2 );\n            ctx.fillText(\"N: \" + this.graph._nodes.length + \" [\" + this.visible_nodes.length + \"]\", 5, 13 * 3 );\n            ctx.fillText(\"V: \" + this.graph._version, 5, 13 * 4);\n            ctx.fillText(\"FPS:\" + this.fps.toFixed(2), 5, 13 * 5);\n        } else {\n            ctx.fillText(\"No graph selected\", 5, 13 * 1);\n        }\n        ctx.restore();\n    };\n\n    /**\n     * draws the back canvas (the one containing the background and the connections)\n     * @method drawBackCanvas\n     **/\n    LGraphCanvas.prototype.drawBackCanvas = function() {\n        var canvas = this.bgcanvas;\n        if (\n            canvas.width != this.canvas.width ||\n            canvas.height != this.canvas.height\n        ) {\n            canvas.width = this.canvas.width;\n            canvas.height = this.canvas.height;\n        }\n\n        if (!this.bgctx) {\n            this.bgctx = this.bgcanvas.getContext(\"2d\");\n        }\n        var ctx = this.bgctx;\n        if (ctx.start) {\n            ctx.start();\n        }\n\n\t\tvar viewport = this.viewport || [0,0,ctx.canvas.width,ctx.canvas.height];\n\n        //clear\n        if (this.clear_background) {\n            ctx.clearRect( viewport[0], viewport[1], viewport[2], viewport[3] );\n        }\n\n\t\t//show subgraph stack header\n        if (this._graph_stack && this._graph_stack.length) {\n            ctx.save();\n            var parent_graph = this._graph_stack[this._graph_stack.length - 1];\n            var subgraph_node = this.graph._subgraph_node;\n            ctx.strokeStyle = subgraph_node.bgcolor;\n            ctx.lineWidth = 10;\n            ctx.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);\n            ctx.lineWidth = 1;\n            ctx.font = \"40px Arial\";\n            ctx.textAlign = \"center\";\n            ctx.fillStyle = subgraph_node.bgcolor || \"#AAA\";\n            var title = \"\";\n            for (var i = 1; i < this._graph_stack.length; ++i) {\n                title +=\n                    this._graph_stack[i]._subgraph_node.getTitle() + \" >> \";\n            }\n            ctx.fillText(\n                title + subgraph_node.getTitle(),\n                canvas.width * 0.5,\n                40\n            );\n            ctx.restore();\n        }\n\n        var bg_already_painted = false;\n        if (this.onRenderBackground) {\n            bg_already_painted = this.onRenderBackground(canvas, ctx);\n        }\n\n        //reset in case of error\n        if ( !this.viewport )\n\t\t{\n\t        ctx.restore();\n\t\t    ctx.setTransform(1, 0, 0, 1, 0, 0);\n\t\t}\n        this.visible_links.length = 0;\n\n        if (this.graph) {\n            //apply transformations\n            ctx.save();\n            this.ds.toCanvasContext(ctx);\n\n            //render BG\n            if ( this.ds.scale < 1.5 && !bg_already_painted && this.clear_background_color )\n            {\n                ctx.fillStyle = this.clear_background_color;\n                ctx.fillRect(\n                    this.visible_area[0],\n                    this.visible_area[1],\n                    this.visible_area[2],\n                    this.visible_area[3]\n                );\n            }\n\n            if (\n                this.background_image &&\n                this.ds.scale > 0.5 &&\n                !bg_already_painted\n            ) {\n                if (this.zoom_modify_alpha) {\n                    ctx.globalAlpha =\n                        (1.0 - 0.5 / this.ds.scale) * this.editor_alpha;\n                } else {\n                    ctx.globalAlpha = this.editor_alpha;\n                }\n                ctx.imageSmoothingEnabled = ctx.imageSmoothingEnabled = false; // ctx.mozImageSmoothingEnabled = \n                if (\n                    !this._bg_img ||\n                    this._bg_img.name != this.background_image\n                ) {\n                    this._bg_img = new Image();\n                    this._bg_img.name = this.background_image;\n                    this._bg_img.src = this.background_image;\n                    var that = this;\n                    this._bg_img.onload = function() {\n                        that.draw(true, true);\n                    };\n                }\n\n                var pattern = null;\n                if (this._pattern == null && this._bg_img.width > 0) {\n                    pattern = ctx.createPattern(this._bg_img, \"repeat\");\n                    this._pattern_img = this._bg_img;\n                    this._pattern = pattern;\n                } else {\n                    pattern = this._pattern;\n                }\n                if (pattern) {\n                    ctx.fillStyle = pattern;\n                    ctx.fillRect(\n                        this.visible_area[0],\n                        this.visible_area[1],\n                        this.visible_area[2],\n                        this.visible_area[3]\n                    );\n                    ctx.fillStyle = \"transparent\";\n                }\n\n                ctx.globalAlpha = 1.0;\n                ctx.imageSmoothingEnabled = ctx.imageSmoothingEnabled = true; //= ctx.mozImageSmoothingEnabled\n            }\n\n            //groups\n            if (this.graph._groups.length && !this.live_mode) {\n                this.drawGroups(canvas, ctx);\n            }\n\n            if (this.onDrawBackground) {\n                this.onDrawBackground(ctx, this.visible_area);\n            }\n            if (this.onBackgroundRender) {\n                //LEGACY\n                console.error(\n                    \"WARNING! onBackgroundRender deprecated, now is named onDrawBackground \"\n                );\n                this.onBackgroundRender = null;\n            }\n\n            //DEBUG: show clipping area\n            //ctx.fillStyle = \"red\";\n            //ctx.fillRect( this.visible_area[0] + 10, this.visible_area[1] + 10, this.visible_area[2] - 20, this.visible_area[3] - 20);\n\n            //bg\n            if (this.render_canvas_border) {\n                ctx.strokeStyle = \"#235\";\n                ctx.strokeRect(0, 0, canvas.width, canvas.height);\n            }\n\n            if (this.render_connections_shadows) {\n                ctx.shadowColor = \"#000\";\n                ctx.shadowOffsetX = 0;\n                ctx.shadowOffsetY = 0;\n                ctx.shadowBlur = 6;\n            } else {\n                ctx.shadowColor = \"rgba(0,0,0,0)\";\n            }\n\n            //draw connections\n            if (!this.live_mode) {\n                this.drawConnections(ctx);\n            }\n\n            ctx.shadowColor = \"rgba(0,0,0,0)\";\n\n            //restore state\n            ctx.restore();\n        }\n\n        if (ctx.finish) {\n            ctx.finish();\n        }\n\n        this.dirty_bgcanvas = false;\n        this.dirty_canvas = true; //to force to repaint the front canvas with the bgcanvas\n    };\n\n    var temp_vec2 = new Float32Array(2);\n\n    /**\n     * draws the given node inside the canvas\n     * @method drawNode\n     **/\n    LGraphCanvas.prototype.drawNode = function(node, ctx) {\n        var glow = false;\n        this.current_node = node;\n\n        var color = node.color || node.constructor.color || LiteGraph.NODE_DEFAULT_COLOR;\n        var bgcolor = node.bgcolor || node.constructor.bgcolor || LiteGraph.NODE_DEFAULT_BGCOLOR;\n\n        //shadow and glow\n        if (node.mouseOver) {\n            glow = true;\n        }\n\n        var low_quality = this.ds.scale < 0.6; //zoomed out\n\n        //only render if it forces it to do it\n        if (this.live_mode) {\n            if (!node.flags.collapsed) {\n                ctx.shadowColor = \"transparent\";\n                if (node.onDrawForeground) {\n                    node.onDrawForeground(ctx, this, this.canvas);\n                }\n            }\n            return;\n        }\n\n        var editor_alpha = this.editor_alpha;\n        ctx.globalAlpha = editor_alpha;\n\n        if (this.render_shadows && !low_quality) {\n            ctx.shadowColor = LiteGraph.DEFAULT_SHADOW_COLOR;\n            ctx.shadowOffsetX = 2 * this.ds.scale;\n            ctx.shadowOffsetY = 2 * this.ds.scale;\n            ctx.shadowBlur = 3 * this.ds.scale;\n        } else {\n            ctx.shadowColor = \"transparent\";\n        }\n\n        //custom draw collapsed method (draw after shadows because they are affected)\n        if (\n            node.flags.collapsed &&\n            node.onDrawCollapsed &&\n            node.onDrawCollapsed(ctx, this) == true\n        ) {\n            return;\n        }\n\n        //clip if required (mask)\n        var shape = node._shape || LiteGraph.BOX_SHAPE;\n        var size = temp_vec2;\n        temp_vec2.set(node.size);\n        var horizontal = node.horizontal; // || node.flags.horizontal;\n\n        if (node.flags.collapsed) {\n            ctx.font = this.inner_text_font;\n            var title = node.getTitle ? node.getTitle() : node.title;\n            if (title != null) {\n                node._collapsed_width = Math.min(\n                    node.size[0],\n                    ctx.measureText(title).width +\n                        LiteGraph.NODE_TITLE_HEIGHT * 2\n                ); //LiteGraph.NODE_COLLAPSED_WIDTH;\n                size[0] = node._collapsed_width;\n                size[1] = 0;\n            }\n        }\n\n        if (node.clip_area) {\n            //Start clipping\n            ctx.save();\n            ctx.beginPath();\n            if (shape == LiteGraph.BOX_SHAPE) {\n                ctx.rect(0, 0, size[0], size[1]);\n            } else if (shape == LiteGraph.ROUND_SHAPE) {\n                ctx.roundRect(0, 0, size[0], size[1], [10]);\n            } else if (shape == LiteGraph.CIRCLE_SHAPE) {\n                ctx.arc(\n                    size[0] * 0.5,\n                    size[1] * 0.5,\n                    size[0] * 0.5,\n                    0,\n                    Math.PI * 2\n                );\n            }\n            ctx.clip();\n        }\n\n        //draw shape\n        if (node.has_errors) {\n            bgcolor = \"red\";\n        }\n        this.drawNodeShape(\n            node,\n            ctx,\n            size,\n            color,\n            bgcolor,\n            node.is_selected,\n            node.mouseOver\n        );\n        ctx.shadowColor = \"transparent\";\n\n        //draw foreground\n        if (node.onDrawForeground) {\n            node.onDrawForeground(ctx, this, this.canvas);\n        }\n\n        //connection slots\n        ctx.textAlign = horizontal ? \"center\" : \"left\";\n        ctx.font = this.inner_text_font;\n\n        var render_text = !low_quality;\n\n        var out_slot = this.connecting_output;\n        var in_slot = this.connecting_input;\n        ctx.lineWidth = 1;\n\n        var max_y = 0;\n        var slot_pos = new Float32Array(2); //to reuse\n\n        //render inputs and outputs\n        if (!node.flags.collapsed) {\n            //input connection slots\n            if (node.inputs) {\n                for (var i = 0; i < node.inputs.length; i++) {\n                    var slot = node.inputs[i];\n                    \n                    var slot_type = slot.type;\n                    var slot_shape = slot.shape;\n                    \n                    ctx.globalAlpha = editor_alpha;\n                    //change opacity of incompatible slots when dragging a connection\n                    if ( this.connecting_output && !LiteGraph.isValidConnection( slot.type , out_slot.type) ) {\n                        ctx.globalAlpha = 0.4 * editor_alpha;\n                    }\n\n                    ctx.fillStyle =\n                        slot.link != null\n                            ? slot.color_on ||\n                              this.default_connection_color_byType[slot_type] ||\n                              this.default_connection_color.input_on\n                            : slot.color_off ||\n                              this.default_connection_color_byTypeOff[slot_type] ||\n                              this.default_connection_color_byType[slot_type] ||\n                              this.default_connection_color.input_off;\n\n                    var pos = node.getConnectionPos(true, i, slot_pos);\n                    pos[0] -= node.pos[0];\n                    pos[1] -= node.pos[1];\n                    if (max_y < pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5) {\n                        max_y = pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5;\n                    }\n\n                    ctx.beginPath();\n\n\t\t\t\t\tif (slot_type == \"array\"){\n                        slot_shape = LiteGraph.GRID_SHAPE; // place in addInput? addOutput instead?\n                    }\n                    \n                    var doStroke = true;\n                    \n                    if (\n                        slot.type === LiteGraph.EVENT ||\n                        slot.shape === LiteGraph.BOX_SHAPE\n                    ) {\n                        if (horizontal) {\n                            ctx.rect(\n                                pos[0] - 5 + 0.5,\n                                pos[1] - 8 + 0.5,\n                                10,\n                                14\n                            );\n                        } else {\n                            ctx.rect(\n                                pos[0] - 6 + 0.5,\n                                pos[1] - 5 + 0.5,\n                                14,\n                                10\n                            );\n                        }\n                    } else if (slot_shape === LiteGraph.ARROW_SHAPE) {\n                        ctx.moveTo(pos[0] + 8, pos[1] + 0.5);\n                        ctx.lineTo(pos[0] - 4, pos[1] + 6 + 0.5);\n                        ctx.lineTo(pos[0] - 4, pos[1] - 6 + 0.5);\n                        ctx.closePath();\n                    } else if (slot_shape === LiteGraph.GRID_SHAPE) {\n                        ctx.rect(pos[0] - 4, pos[1] - 4, 2, 2);\n                        ctx.rect(pos[0] - 1, pos[1] - 4, 2, 2);\n                        ctx.rect(pos[0] + 2, pos[1] - 4, 2, 2);\n                        ctx.rect(pos[0] - 4, pos[1] - 1, 2, 2);\n                        ctx.rect(pos[0] - 1, pos[1] - 1, 2, 2);\n                        ctx.rect(pos[0] + 2, pos[1] - 1, 2, 2);\n                        ctx.rect(pos[0] - 4, pos[1] + 2, 2, 2);\n                        ctx.rect(pos[0] - 1, pos[1] + 2, 2, 2);\n                        ctx.rect(pos[0] + 2, pos[1] + 2, 2, 2);\n                        doStroke = false;\n                    } else {\n\t\t\t\t\t\tif(low_quality)\n\t                        ctx.rect(pos[0] - 4, pos[1] - 4, 8, 8 ); //faster\n\t\t\t\t\t\telse\n\t                        ctx.arc(pos[0], pos[1], 4, 0, Math.PI * 2);\n                    }\n                    ctx.fill();\n\n                    //render name\n                    if (render_text) {\n                        var text = slot.label != null ? slot.label : slot.name;\n                        if (text) {\n                            ctx.fillStyle = LiteGraph.NODE_TEXT_COLOR;\n                            if (horizontal || slot.dir == LiteGraph.UP) {\n                                ctx.fillText(text, pos[0], pos[1] - 10);\n                            } else {\n                                ctx.fillText(text, pos[0] + 10, pos[1] + 5);\n                            }\n                        }\n                    }\n                }\n            }\n\n            //output connection slots\n\n            ctx.textAlign = horizontal ? \"center\" : \"right\";\n            ctx.strokeStyle = \"black\";\n            if (node.outputs) {\n                for (var i = 0; i < node.outputs.length; i++) {\n                    var slot = node.outputs[i];\n                    \n                    var slot_type = slot.type;\n                    var slot_shape = slot.shape;\n                    \n                    //change opacity of incompatible slots when dragging a connection\n                    if (this.connecting_input && !LiteGraph.isValidConnection( slot_type , in_slot.type) ) {\n                        ctx.globalAlpha = 0.4 * editor_alpha;\n                    }\n                    \n                    var pos = node.getConnectionPos(false, i, slot_pos);\n                    pos[0] -= node.pos[0];\n                    pos[1] -= node.pos[1];\n                    if (max_y < pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5) {\n                        max_y = pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5;\n                    }\n\n                    ctx.fillStyle =\n                        slot.links && slot.links.length\n                            ? slot.color_on ||\n                              this.default_connection_color_byType[slot_type] ||\n                              this.default_connection_color.output_on\n                            : slot.color_off ||\n                              this.default_connection_color_byTypeOff[slot_type] ||\n                              this.default_connection_color_byType[slot_type] ||\n                              this.default_connection_color.output_off;\n                    ctx.beginPath();\n                    //ctx.rect( node.size[0] - 14,i*14,10,10);\n\n\t\t\t\t\tif (slot_type == \"array\"){\n                        slot_shape = LiteGraph.GRID_SHAPE;\n                    }\n                    \n                    var doStroke = true;\n                    \n                    if (\n                        slot_type === LiteGraph.EVENT ||\n                        slot_shape === LiteGraph.BOX_SHAPE\n                    ) {\n                        if (horizontal) {\n                            ctx.rect(\n                                pos[0] - 5 + 0.5,\n                                pos[1] - 8 + 0.5,\n                                10,\n                                14\n                            );\n                        } else {\n                            ctx.rect(\n                                pos[0] - 6 + 0.5,\n                                pos[1] - 5 + 0.5,\n                                14,\n                                10\n                            );\n                        }\n                    } else if (slot_shape === LiteGraph.ARROW_SHAPE) {\n                        ctx.moveTo(pos[0] + 8, pos[1] + 0.5);\n                        ctx.lineTo(pos[0] - 4, pos[1] + 6 + 0.5);\n                        ctx.lineTo(pos[0] - 4, pos[1] - 6 + 0.5);\n                        ctx.closePath();\n                    }  else if (slot_shape === LiteGraph.GRID_SHAPE) {\n                        ctx.rect(pos[0] - 4, pos[1] - 4, 2, 2);\n                        ctx.rect(pos[0] - 1, pos[1] - 4, 2, 2);\n                        ctx.rect(pos[0] + 2, pos[1] - 4, 2, 2);\n                        ctx.rect(pos[0] - 4, pos[1] - 1, 2, 2);\n                        ctx.rect(pos[0] - 1, pos[1] - 1, 2, 2);\n                        ctx.rect(pos[0] + 2, pos[1] - 1, 2, 2);\n                        ctx.rect(pos[0] - 4, pos[1] + 2, 2, 2);\n                        ctx.rect(pos[0] - 1, pos[1] + 2, 2, 2);\n                        ctx.rect(pos[0] + 2, pos[1] + 2, 2, 2);\n                        doStroke = false;\n                    } else {\n\t\t\t\t\t\tif(low_quality)\n\t                        ctx.rect(pos[0] - 4, pos[1] - 4, 8, 8 );\n\t\t\t\t\t\telse\n\t                        ctx.arc(pos[0], pos[1], 4, 0, Math.PI * 2);\n                    }\n\n                    //trigger\n                    //if(slot.node_id != null && slot.slot == -1)\n                    //\tctx.fillStyle = \"#F85\";\n\n                    //if(slot.links != null && slot.links.length)\n                    ctx.fill();\n\t\t\t\t\tif(!low_quality && doStroke)\n\t                    ctx.stroke();\n\n                    //render output name\n                    if (render_text) {\n                        var text = slot.label != null ? slot.label : slot.name;\n                        if (text) {\n                            ctx.fillStyle = LiteGraph.NODE_TEXT_COLOR;\n                            if (horizontal || slot.dir == LiteGraph.DOWN) {\n                                ctx.fillText(text, pos[0], pos[1] - 8);\n                            } else {\n                                ctx.fillText(text, pos[0] - 10, pos[1] + 5);\n                            }\n                        }\n                    }\n                }\n            }\n\n            ctx.textAlign = \"left\";\n            ctx.globalAlpha = 1;\n\n            if (node.widgets) {\n\t\t\t\tvar widgets_y = max_y;\n                if (horizontal || node.widgets_up) {\n                    widgets_y = 2;\n                }\n\t\t\t\tif( node.widgets_start_y != null )\n                    widgets_y = node.widgets_start_y;\n                this.drawNodeWidgets(\n                    node,\n                    widgets_y,\n                    ctx,\n                    this.node_widget && this.node_widget[0] == node\n                        ? this.node_widget[1]\n                        : null\n                );\n            }\n        } else if (this.render_collapsed_slots) {\n            //if collapsed\n            var input_slot = null;\n            var output_slot = null;\n\n            //get first connected slot to render\n            if (node.inputs) {\n                for (var i = 0; i < node.inputs.length; i++) {\n                    var slot = node.inputs[i];\n                    if (slot.link == null) {\n                        continue;\n                    }\n                    input_slot = slot;\n                    break;\n                }\n            }\n            if (node.outputs) {\n                for (var i = 0; i < node.outputs.length; i++) {\n                    var slot = node.outputs[i];\n                    if (!slot.links || !slot.links.length) {\n                        continue;\n                    }\n                    output_slot = slot;\n                }\n            }\n\n            if (input_slot) {\n                var x = 0;\n                var y = LiteGraph.NODE_TITLE_HEIGHT * -0.5; //center\n                if (horizontal) {\n                    x = node._collapsed_width * 0.5;\n                    y = -LiteGraph.NODE_TITLE_HEIGHT;\n                }\n                ctx.fillStyle = \"#686\";\n                ctx.beginPath();\n                if (\n                    slot.type === LiteGraph.EVENT ||\n                    slot.shape === LiteGraph.BOX_SHAPE\n                ) {\n                    ctx.rect(x - 7 + 0.5, y - 4, 14, 8);\n                } else if (slot.shape === LiteGraph.ARROW_SHAPE) {\n                    ctx.moveTo(x + 8, y);\n                    ctx.lineTo(x + -4, y - 4);\n                    ctx.lineTo(x + -4, y + 4);\n                    ctx.closePath();\n                } else {\n                    ctx.arc(x, y, 4, 0, Math.PI * 2);\n                }\n                ctx.fill();\n            }\n\n            if (output_slot) {\n                var x = node._collapsed_width;\n                var y = LiteGraph.NODE_TITLE_HEIGHT * -0.5; //center\n                if (horizontal) {\n                    x = node._collapsed_width * 0.5;\n                    y = 0;\n                }\n                ctx.fillStyle = \"#686\";\n                ctx.strokeStyle = \"black\";\n                ctx.beginPath();\n                if (\n                    slot.type === LiteGraph.EVENT ||\n                    slot.shape === LiteGraph.BOX_SHAPE\n                ) {\n                    ctx.rect(x - 7 + 0.5, y - 4, 14, 8);\n                } else if (slot.shape === LiteGraph.ARROW_SHAPE) {\n                    ctx.moveTo(x + 6, y);\n                    ctx.lineTo(x - 6, y - 4);\n                    ctx.lineTo(x - 6, y + 4);\n                    ctx.closePath();\n                } else {\n                    ctx.arc(x, y, 4, 0, Math.PI * 2);\n                }\n                ctx.fill();\n                //ctx.stroke();\n            }\n        }\n\n        if (node.clip_area) {\n            ctx.restore();\n        }\n\n        ctx.globalAlpha = 1.0;\n    };\n\n\t//used by this.over_link_center\n\tLGraphCanvas.prototype.drawLinkTooltip = function( ctx, link )\n\t{\n\t\tvar pos = link._pos;\n\t\tctx.fillStyle = \"black\";\n\t\tctx.beginPath();\n\t\tctx.arc( pos[0], pos[1], 3, 0, Math.PI * 2 );\n\t\tctx.fill();\n\n\t\tif(link.data == null)\n\t\t\treturn;\n\n\t\tif(this.onDrawLinkTooltip)\n\t\t\tif( this.onDrawLinkTooltip(ctx,link,this) == true )\n\t\t\t\treturn;\n\n\t\tvar data = link.data;\n\t\tvar text = null;\n\n\t\tif( data.constructor === Number )\n\t\t\ttext = data.toFixed(2);\n\t\telse if( data.constructor === String )\n\t\t\ttext = \"\\\"\" + data + \"\\\"\";\n\t\telse if( data.constructor === Boolean )\n\t\t\ttext = String(data);\n\t\telse if (data.toToolTip)\n\t\t\ttext = data.toToolTip();\n\t\telse\n\t\t\ttext = \"[\" + data.constructor.name + \"]\";\n\n\t\tif(text == null)\n\t\t\treturn;\n\t\ttext = text.substr(0,30); //avoid weird\n\n\t\tctx.font = \"14px Courier New\";\n\t\tvar info = ctx.measureText(text);\n\t\tvar w = info.width + 20;\n\t\tvar h = 24;\n\t\tctx.shadowColor = \"black\";\n\t\tctx.shadowOffsetX = 2;\n\t\tctx.shadowOffsetY = 2;\n\t\tctx.shadowBlur = 3;\n\t\tctx.fillStyle = \"#454\";\n\t\tctx.beginPath();\n\t\tctx.roundRect( pos[0] - w*0.5, pos[1] - 15 - h, w, h, [3]);\n\t\tctx.moveTo( pos[0] - 10, pos[1] - 15 );\n\t\tctx.lineTo( pos[0] + 10, pos[1] - 15 );\n\t\tctx.lineTo( pos[0], pos[1] - 5 );\n\t\tctx.fill();\n        ctx.shadowColor = \"transparent\";\n\t\tctx.textAlign = \"center\";\n\t\tctx.fillStyle = \"#CEC\";\n\t\tctx.fillText(text, pos[0], pos[1] - 15 - h * 0.3);\n\t}\n\n    /**\n     * draws the shape of the given node in the canvas\n     * @method drawNodeShape\n     **/\n    var tmp_area = new Float32Array(4);\n\n    LGraphCanvas.prototype.drawNodeShape = function(\n        node,\n        ctx,\n        size,\n        fgcolor,\n        bgcolor,\n        selected,\n        mouse_over\n    ) {\n        //bg rect\n        ctx.strokeStyle = fgcolor;\n        ctx.fillStyle = bgcolor;\n\n        var title_height = LiteGraph.NODE_TITLE_HEIGHT;\n        var low_quality = this.ds.scale < 0.5;\n\n        //render node area depending on shape\n        var shape =\n            node._shape || node.constructor.shape || LiteGraph.ROUND_SHAPE;\n\n        var title_mode = node.constructor.title_mode;\n\n        var render_title = true;\n        if (title_mode == LiteGraph.TRANSPARENT_TITLE || title_mode == LiteGraph.NO_TITLE) {\n            render_title = false;\n        } else if (title_mode == LiteGraph.AUTOHIDE_TITLE && mouse_over) {\n            render_title = true;\n        }\n\n        var area = tmp_area;\n        area[0] = 0; //x\n        area[1] = render_title ? -title_height : 0; //y\n        area[2] = size[0] + 1; //w\n        area[3] = render_title ? size[1] + title_height : size[1]; //h\n\n        var old_alpha = ctx.globalAlpha;\n\n        //full node shape\n        //if(node.flags.collapsed)\n        {\n            ctx.beginPath();\n            if (shape == LiteGraph.BOX_SHAPE || low_quality) {\n                ctx.fillRect(area[0], area[1], area[2], area[3]);\n            } else if (\n                shape == LiteGraph.ROUND_SHAPE ||\n                shape == LiteGraph.CARD_SHAPE\n            ) {\n                ctx.roundRect(\n                    area[0],\n                    area[1],\n                    area[2],\n                    area[3],\n                    shape == LiteGraph.CARD_SHAPE ? [this.round_radius,this.round_radius,0,0] : [this.round_radius] \n                );\n            } else if (shape == LiteGraph.CIRCLE_SHAPE) {\n                ctx.arc(\n                    size[0] * 0.5,\n                    size[1] * 0.5,\n                    size[0] * 0.5,\n                    0,\n                    Math.PI * 2\n                );\n            }\n            ctx.fill();\n\n\t\t\t//separator\n\t\t\tif(!node.flags.collapsed && render_title)\n\t\t\t{\n\t\t\t\tctx.shadowColor = \"transparent\";\n\t\t\t\tctx.fillStyle = \"rgba(0,0,0,0.2)\";\n\t\t\t\tctx.fillRect(0, -1, area[2], 2);\n\t\t\t}\n        }\n        ctx.shadowColor = \"transparent\";\n\n        if (node.onDrawBackground) {\n            node.onDrawBackground(ctx, this, this.canvas, this.graph_mouse );\n        }\n\n        //title bg (remember, it is rendered ABOVE the node)\n        if (render_title || title_mode == LiteGraph.TRANSPARENT_TITLE) {\n            //title bar\n            if (node.onDrawTitleBar) {\n                node.onDrawTitleBar( ctx, title_height, size, this.ds.scale, fgcolor );\n            } else if (\n                title_mode != LiteGraph.TRANSPARENT_TITLE &&\n                (node.constructor.title_color || this.render_title_colored)\n            ) {\n                var title_color = node.constructor.title_color || fgcolor;\n\n                if (node.flags.collapsed) {\n                    ctx.shadowColor = LiteGraph.DEFAULT_SHADOW_COLOR;\n                }\n\n                //* gradient test\n                if (this.use_gradients) {\n                    var grad = LGraphCanvas.gradients[title_color];\n                    if (!grad) {\n                        grad = LGraphCanvas.gradients[ title_color ] = ctx.createLinearGradient(0, 0, 400, 0);\n                        grad.addColorStop(0, title_color); // TODO refactor: validate color !! prevent DOMException\n                        grad.addColorStop(1, \"#000\");\n                    }\n                    ctx.fillStyle = grad;\n                } else {\n                    ctx.fillStyle = title_color;\n                }\n\n                //ctx.globalAlpha = 0.5 * old_alpha;\n                ctx.beginPath();\n                if (shape == LiteGraph.BOX_SHAPE || low_quality) {\n                    ctx.rect(0, -title_height, size[0] + 1, title_height);\n                } else if (  shape == LiteGraph.ROUND_SHAPE || shape == LiteGraph.CARD_SHAPE ) {\n                    ctx.roundRect(\n                        0,\n                        -title_height,\n                        size[0] + 1,\n                        title_height,\n                        node.flags.collapsed ? [this.round_radius] : [this.round_radius,this.round_radius,0,0]\n                    );\n                }\n                ctx.fill();\n                ctx.shadowColor = \"transparent\";\n            }\n\n            var colState = false;\n            if (LiteGraph.node_box_coloured_by_mode){\n                if(LiteGraph.NODE_MODES_COLORS[node.mode]){\n                    colState = LiteGraph.NODE_MODES_COLORS[node.mode];\n                }\n            }\n            if (LiteGraph.node_box_coloured_when_on){\n                colState = node.action_triggered ? \"#FFF\" : (node.execute_triggered ? \"#AAA\" : colState);\n            }\n            \n            //title box\n            var box_size = 10;\n            if (node.onDrawTitleBox) {\n                node.onDrawTitleBox(ctx, title_height, size, this.ds.scale);\n            } else if (\n                shape == LiteGraph.ROUND_SHAPE ||\n                shape == LiteGraph.CIRCLE_SHAPE ||\n                shape == LiteGraph.CARD_SHAPE\n            ) {\n                if (low_quality) {\n                    ctx.fillStyle = \"black\";\n                    ctx.beginPath();\n                    ctx.arc(\n                        title_height * 0.5,\n                        title_height * -0.5,\n                        box_size * 0.5 + 1,\n                        0,\n                        Math.PI * 2\n                    );\n                    ctx.fill();\n                }\n                \n                ctx.fillStyle = node.boxcolor || colState || LiteGraph.NODE_DEFAULT_BOXCOLOR;\n\t\t\t\tif(low_quality)\n\t\t\t\t\tctx.fillRect( title_height * 0.5 - box_size *0.5, title_height * -0.5 - box_size *0.5, box_size , box_size  );\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.arc(\n\t\t\t\t\t\ttitle_height * 0.5,\n\t\t\t\t\t\ttitle_height * -0.5,\n\t\t\t\t\t\tbox_size * 0.5,\n\t\t\t\t\t\t0,\n\t\t\t\t\t\tMath.PI * 2\n\t\t\t\t\t);\n\t\t\t\t\tctx.fill();\n\t\t\t\t}\n            } else {\n                if (low_quality) {\n                    ctx.fillStyle = \"black\";\n                    ctx.fillRect(\n                        (title_height - box_size) * 0.5 - 1,\n                        (title_height + box_size) * -0.5 - 1,\n                        box_size + 2,\n                        box_size + 2\n                    );\n                }\n                ctx.fillStyle = node.boxcolor || colState || LiteGraph.NODE_DEFAULT_BOXCOLOR;\n                ctx.fillRect(\n                    (title_height - box_size) * 0.5,\n                    (title_height + box_size) * -0.5,\n                    box_size,\n                    box_size\n                );\n            }\n            ctx.globalAlpha = old_alpha;\n\n            //title text\n            if (node.onDrawTitleText) {\n                node.onDrawTitleText(\n                    ctx,\n                    title_height,\n                    size,\n                    this.ds.scale,\n                    this.title_text_font,\n                    selected\n                );\n            }\n            if (!low_quality) {\n                ctx.font = this.title_text_font;\n                var title = String(node.getTitle());\n                if (title) {\n                    if (selected) {\n                        ctx.fillStyle = LiteGraph.NODE_SELECTED_TITLE_COLOR;\n                    } else {\n                        ctx.fillStyle =\n                            node.constructor.title_text_color ||\n                            this.node_title_color;\n                    }\n                    if (node.flags.collapsed) {\n                        ctx.textAlign = \"left\";\n                        var measure = ctx.measureText(title);\n                        ctx.fillText(\n                            title.substr(0,20), //avoid urls too long\n                            title_height,// + measure.width * 0.5,\n                            LiteGraph.NODE_TITLE_TEXT_Y - title_height\n                        );\n                        ctx.textAlign = \"left\";\n                    } else {\n                        ctx.textAlign = \"left\";\n                        ctx.fillText(\n                            title,\n                            title_height,\n                            LiteGraph.NODE_TITLE_TEXT_Y - title_height\n                        );\n                    }\n                }\n            }\n\n\t\t\t//subgraph box\n\t\t\tif (!node.flags.collapsed && node.subgraph && !node.skip_subgraph_button) {\n\t\t\t\tvar w = LiteGraph.NODE_TITLE_HEIGHT;\n\t\t\t\tvar x = node.size[0] - w;\n\t\t\t\tvar over = LiteGraph.isInsideRectangle( this.graph_mouse[0] - node.pos[0], this.graph_mouse[1] - node.pos[1], x+2, -w+2, w-4, w-4 );\n\t\t\t\tctx.fillStyle = over ? \"#888\" : \"#555\";\n\t\t\t\tif( shape == LiteGraph.BOX_SHAPE || low_quality)\n\t\t\t\t\tctx.fillRect(x+2, -w+2, w-4, w-4);\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.roundRect(x+2, -w+2, w-4, w-4,[4]);\n\t\t\t\t\tctx.fill();\n\t\t\t\t}\n\t\t\t\tctx.fillStyle = \"#333\";\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.moveTo(x + w * 0.2, -w * 0.6);\n\t\t\t\tctx.lineTo(x + w * 0.8, -w * 0.6);\n\t\t\t\tctx.lineTo(x + w * 0.5, -w * 0.3);\n\t\t\t\tctx.fill();\n\t\t\t}\n\n\t\t\t//custom title render\n            if (node.onDrawTitle) {\n                node.onDrawTitle(ctx);\n            }\n        }\n\n        //render selection marker\n        if (selected) {\n            if (node.onBounding) {\n                node.onBounding(area);\n            }\n\n            if (title_mode == LiteGraph.TRANSPARENT_TITLE) {\n                area[1] -= title_height;\n                area[3] += title_height;\n            }\n            ctx.lineWidth = 1;\n            ctx.globalAlpha = 0.8;\n            ctx.beginPath();\n            if (shape == LiteGraph.BOX_SHAPE) {\n                ctx.rect(\n                    -6 + area[0],\n                    -6 + area[1],\n                    12 + area[2],\n                    12 + area[3]\n                );\n            } else if (\n                shape == LiteGraph.ROUND_SHAPE ||\n                (shape == LiteGraph.CARD_SHAPE && node.flags.collapsed)\n            ) {\n                ctx.roundRect(\n                    -6 + area[0],\n                    -6 + area[1],\n                    12 + area[2],\n                    12 + area[3],\n                    [this.round_radius * 2]\n                );\n            } else if (shape == LiteGraph.CARD_SHAPE) {\n                ctx.roundRect(\n                    -6 + area[0],\n                    -6 + area[1],\n                    12 + area[2],\n                    12 + area[3],\n                    [this.round_radius * 2,2,this.round_radius * 2,2]\n                );\n            } else if (shape == LiteGraph.CIRCLE_SHAPE) {\n                ctx.arc(\n                    size[0] * 0.5,\n                    size[1] * 0.5,\n                    size[0] * 0.5 + 6,\n                    0,\n                    Math.PI * 2\n                );\n            }\n            ctx.strokeStyle = LiteGraph.NODE_BOX_OUTLINE_COLOR;\n            ctx.stroke();\n            ctx.strokeStyle = fgcolor;\n            ctx.globalAlpha = 1;\n        }\n        \n        // these counter helps in conditioning drawing based on if the node has been executed or an action occurred\n        if (node.execute_triggered>0) node.execute_triggered--;\n        if (node.action_triggered>0) node.action_triggered--;\n    };\n\n    var margin_area = new Float32Array(4);\n    var link_bounding = new Float32Array(4);\n    var tempA = new Float32Array(2);\n    var tempB = new Float32Array(2);\n\n    /**\n     * draws every connection visible in the canvas\n     * OPTIMIZE THIS: pre-catch connections position instead of recomputing them every time\n     * @method drawConnections\n     **/\n    LGraphCanvas.prototype.drawConnections = function(ctx) {\n        var now = LiteGraph.getTime();\n        var visible_area = this.visible_area;\n        margin_area[0] = visible_area[0] - 20;\n        margin_area[1] = visible_area[1] - 20;\n        margin_area[2] = visible_area[2] + 40;\n        margin_area[3] = visible_area[3] + 40;\n\n        //draw connections\n        ctx.lineWidth = this.connections_width;\n\n        ctx.fillStyle = \"#AAA\";\n        ctx.strokeStyle = \"#AAA\";\n        ctx.globalAlpha = this.editor_alpha;\n        //for every node\n        var nodes = this.graph._nodes;\n        for (var n = 0, l = nodes.length; n < l; ++n) {\n            var node = nodes[n];\n            //for every input (we render just inputs because it is easier as every slot can only have one input)\n            if (!node.inputs || !node.inputs.length) {\n                continue;\n            }\n\n            for (var i = 0; i < node.inputs.length; ++i) {\n                var input = node.inputs[i];\n                if (!input || input.link == null) {\n                    continue;\n                }\n                var link_id = input.link;\n                var link = this.graph.links[link_id];\n                if (!link) {\n                    continue;\n                }\n\n                //find link info\n                var start_node = this.graph.getNodeById(link.origin_id);\n                if (start_node == null) {\n                    continue;\n                }\n                var start_node_slot = link.origin_slot;\n                var start_node_slotpos = null;\n                if (start_node_slot == -1) {\n                    start_node_slotpos = [\n                        start_node.pos[0] + 10,\n                        start_node.pos[1] + 10\n                    ];\n                } else {\n                    start_node_slotpos = start_node.getConnectionPos(\n                        false,\n                        start_node_slot,\n                        tempA\n                    );\n                }\n                var end_node_slotpos = node.getConnectionPos(true, i, tempB);\n\n                //compute link bounding\n                link_bounding[0] = start_node_slotpos[0];\n                link_bounding[1] = start_node_slotpos[1];\n                link_bounding[2] = end_node_slotpos[0] - start_node_slotpos[0];\n                link_bounding[3] = end_node_slotpos[1] - start_node_slotpos[1];\n                if (link_bounding[2] < 0) {\n                    link_bounding[0] += link_bounding[2];\n                    link_bounding[2] = Math.abs(link_bounding[2]);\n                }\n                if (link_bounding[3] < 0) {\n                    link_bounding[1] += link_bounding[3];\n                    link_bounding[3] = Math.abs(link_bounding[3]);\n                }\n\n                //skip links outside of the visible area of the canvas\n                if (!overlapBounding(link_bounding, margin_area)) {\n                    continue;\n                }\n\n                var start_slot = start_node.outputs[start_node_slot];\n                var end_slot = node.inputs[i];\n                if (!start_slot || !end_slot) {\n                    continue;\n                }\n                var start_dir =\n                    start_slot.dir ||\n                    (start_node.horizontal ? LiteGraph.DOWN : LiteGraph.RIGHT);\n                var end_dir =\n                    end_slot.dir ||\n                    (node.horizontal ? LiteGraph.UP : LiteGraph.LEFT);\n\n                this.renderLink(\n                    ctx,\n                    start_node_slotpos,\n                    end_node_slotpos,\n                    link,\n                    false,\n                    0,\n                    null,\n                    start_dir,\n                    end_dir\n                );\n\n                //event triggered rendered on top\n                if (link && link._last_time && now - link._last_time < 1000) {\n                    var f = 2.0 - (now - link._last_time) * 0.002;\n                    var tmp = ctx.globalAlpha;\n                    ctx.globalAlpha = tmp * f;\n                    this.renderLink(\n                        ctx,\n                        start_node_slotpos,\n                        end_node_slotpos,\n                        link,\n                        true,\n                        f,\n                        \"white\",\n                        start_dir,\n                        end_dir\n                    );\n                    ctx.globalAlpha = tmp;\n                }\n            }\n        }\n        ctx.globalAlpha = 1;\n    };\n\n    /**\n     * draws a link between two points\n     * @method renderLink\n     * @param {vec2} a start pos\n     * @param {vec2} b end pos\n     * @param {Object} link the link object with all the link info\n     * @param {boolean} skip_border ignore the shadow of the link\n     * @param {boolean} flow show flow animation (for events)\n     * @param {string} color the color for the link\n     * @param {number} start_dir the direction enum\n     * @param {number} end_dir the direction enum\n     * @param {number} num_sublines number of sublines (useful to represent vec3 or rgb)\n     **/\n    LGraphCanvas.prototype.renderLink = function(\n        ctx,\n        a,\n        b,\n        link,\n        skip_border,\n        flow,\n        color,\n        start_dir,\n        end_dir,\n        num_sublines\n    ) {\n        if (link) {\n            this.visible_links.push(link);\n        }\n\n        //choose color\n        if (!color && link) {\n            color = link.color || LGraphCanvas.link_type_colors[link.type];\n        }\n        if (!color) {\n            color = this.default_link_color;\n        }\n        if (link != null && this.highlighted_links[link.id]) {\n            color = \"#FFF\";\n        }\n\n        start_dir = start_dir || LiteGraph.RIGHT;\n        end_dir = end_dir || LiteGraph.LEFT;\n\n        var dist = distance(a, b);\n\n        if (this.render_connections_border && this.ds.scale > 0.6) {\n            ctx.lineWidth = this.connections_width + 4;\n        }\n        ctx.lineJoin = \"round\";\n        num_sublines = num_sublines || 1;\n        if (num_sublines > 1) {\n            ctx.lineWidth = 0.5;\n        }\n\n        //begin line shape\n        ctx.beginPath();\n        for (var i = 0; i < num_sublines; i += 1) {\n            var offsety = (i - (num_sublines - 1) * 0.5) * 5;\n\n            if (this.links_render_mode == LiteGraph.SPLINE_LINK) {\n                ctx.moveTo(a[0], a[1] + offsety);\n                var start_offset_x = 0;\n                var start_offset_y = 0;\n                var end_offset_x = 0;\n                var end_offset_y = 0;\n                switch (start_dir) {\n                    case LiteGraph.LEFT:\n                        start_offset_x = dist * -0.25;\n                        break;\n                    case LiteGraph.RIGHT:\n                        start_offset_x = dist * 0.25;\n                        break;\n                    case LiteGraph.UP:\n                        start_offset_y = dist * -0.25;\n                        break;\n                    case LiteGraph.DOWN:\n                        start_offset_y = dist * 0.25;\n                        break;\n                }\n                switch (end_dir) {\n                    case LiteGraph.LEFT:\n                        end_offset_x = dist * -0.25;\n                        break;\n                    case LiteGraph.RIGHT:\n                        end_offset_x = dist * 0.25;\n                        break;\n                    case LiteGraph.UP:\n                        end_offset_y = dist * -0.25;\n                        break;\n                    case LiteGraph.DOWN:\n                        end_offset_y = dist * 0.25;\n                        break;\n                }\n                ctx.bezierCurveTo(\n                    a[0] + start_offset_x,\n                    a[1] + start_offset_y + offsety,\n                    b[0] + end_offset_x,\n                    b[1] + end_offset_y + offsety,\n                    b[0],\n                    b[1] + offsety\n                );\n            } else if (this.links_render_mode == LiteGraph.LINEAR_LINK) {\n                ctx.moveTo(a[0], a[1] + offsety);\n                var start_offset_x = 0;\n                var start_offset_y = 0;\n                var end_offset_x = 0;\n                var end_offset_y = 0;\n                switch (start_dir) {\n                    case LiteGraph.LEFT:\n                        start_offset_x = -1;\n                        break;\n                    case LiteGraph.RIGHT:\n                        start_offset_x = 1;\n                        break;\n                    case LiteGraph.UP:\n                        start_offset_y = -1;\n                        break;\n                    case LiteGraph.DOWN:\n                        start_offset_y = 1;\n                        break;\n                }\n                switch (end_dir) {\n                    case LiteGraph.LEFT:\n                        end_offset_x = -1;\n                        break;\n                    case LiteGraph.RIGHT:\n                        end_offset_x = 1;\n                        break;\n                    case LiteGraph.UP:\n                        end_offset_y = -1;\n                        break;\n                    case LiteGraph.DOWN:\n                        end_offset_y = 1;\n                        break;\n                }\n                var l = 15;\n                ctx.lineTo(\n                    a[0] + start_offset_x * l,\n                    a[1] + start_offset_y * l + offsety\n                );\n                ctx.lineTo(\n                    b[0] + end_offset_x * l,\n                    b[1] + end_offset_y * l + offsety\n                );\n                ctx.lineTo(b[0], b[1] + offsety);\n            } else if (this.links_render_mode == LiteGraph.STRAIGHT_LINK) {\n                ctx.moveTo(a[0], a[1]);\n                var start_x = a[0];\n                var start_y = a[1];\n                var end_x = b[0];\n                var end_y = b[1];\n                if (start_dir == LiteGraph.RIGHT) {\n                    start_x += 10;\n                } else {\n                    start_y += 10;\n                }\n                if (end_dir == LiteGraph.LEFT) {\n                    end_x -= 10;\n                } else {\n                    end_y -= 10;\n                }\n                ctx.lineTo(start_x, start_y);\n                ctx.lineTo((start_x + end_x) * 0.5, start_y);\n                ctx.lineTo((start_x + end_x) * 0.5, end_y);\n                ctx.lineTo(end_x, end_y);\n                ctx.lineTo(b[0], b[1]);\n            } else {\n                return;\n            } //unknown\n        }\n\n        //rendering the outline of the connection can be a little bit slow\n        if (\n            this.render_connections_border &&\n            this.ds.scale > 0.6 &&\n            !skip_border\n        ) {\n            ctx.strokeStyle = \"rgba(0,0,0,0.5)\";\n            ctx.stroke();\n        }\n\n        ctx.lineWidth = this.connections_width;\n        ctx.fillStyle = ctx.strokeStyle = color;\n        ctx.stroke();\n        //end line shape\n\n        var pos = this.computeConnectionPoint(a, b, 0.5, start_dir, end_dir);\n        if (link && link._pos) {\n            link._pos[0] = pos[0];\n            link._pos[1] = pos[1];\n        }\n\n        //render arrow in the middle\n        if (\n            this.ds.scale >= 0.6 &&\n            this.highquality_render &&\n            end_dir != LiteGraph.CENTER\n        ) {\n            //render arrow\n            if (this.render_connection_arrows) {\n                //compute two points in the connection\n                var posA = this.computeConnectionPoint(\n                    a,\n                    b,\n                    0.25,\n                    start_dir,\n                    end_dir\n                );\n                var posB = this.computeConnectionPoint(\n                    a,\n                    b,\n                    0.26,\n                    start_dir,\n                    end_dir\n                );\n                var posC = this.computeConnectionPoint(\n                    a,\n                    b,\n                    0.75,\n                    start_dir,\n                    end_dir\n                );\n                var posD = this.computeConnectionPoint(\n                    a,\n                    b,\n                    0.76,\n                    start_dir,\n                    end_dir\n                );\n\n                //compute the angle between them so the arrow points in the right direction\n                var angleA = 0;\n                var angleB = 0;\n                if (this.render_curved_connections) {\n                    angleA = -Math.atan2(posB[0] - posA[0], posB[1] - posA[1]);\n                    angleB = -Math.atan2(posD[0] - posC[0], posD[1] - posC[1]);\n                } else {\n                    angleB = angleA = b[1] > a[1] ? 0 : Math.PI;\n                }\n\n                //render arrow\n                ctx.save();\n                ctx.translate(posA[0], posA[1]);\n                ctx.rotate(angleA);\n                ctx.beginPath();\n                ctx.moveTo(-5, -3);\n                ctx.lineTo(0, +7);\n                ctx.lineTo(+5, -3);\n                ctx.fill();\n                ctx.restore();\n                ctx.save();\n                ctx.translate(posC[0], posC[1]);\n                ctx.rotate(angleB);\n                ctx.beginPath();\n                ctx.moveTo(-5, -3);\n                ctx.lineTo(0, +7);\n                ctx.lineTo(+5, -3);\n                ctx.fill();\n                ctx.restore();\n            }\n\n            //circle\n            ctx.beginPath();\n            ctx.arc(pos[0], pos[1], 5, 0, Math.PI * 2);\n            ctx.fill();\n        }\n\n        //render flowing points\n        if (flow) {\n            ctx.fillStyle = color;\n            for (var i = 0; i < 5; ++i) {\n                var f = (LiteGraph.getTime() * 0.001 + i * 0.2) % 1;\n                var pos = this.computeConnectionPoint(\n                    a,\n                    b,\n                    f,\n                    start_dir,\n                    end_dir\n                );\n                ctx.beginPath();\n                ctx.arc(pos[0], pos[1], 5, 0, 2 * Math.PI);\n                ctx.fill();\n            }\n        }\n    };\n\n    //returns the link center point based on curvature\n    LGraphCanvas.prototype.computeConnectionPoint = function(\n        a,\n        b,\n        t,\n        start_dir,\n        end_dir\n    ) {\n        start_dir = start_dir || LiteGraph.RIGHT;\n        end_dir = end_dir || LiteGraph.LEFT;\n\n        var dist = distance(a, b);\n        var p0 = a;\n        var p1 = [a[0], a[1]];\n        var p2 = [b[0], b[1]];\n        var p3 = b;\n\n        switch (start_dir) {\n            case LiteGraph.LEFT:\n                p1[0] += dist * -0.25;\n                break;\n            case LiteGraph.RIGHT:\n                p1[0] += dist * 0.25;\n                break;\n            case LiteGraph.UP:\n                p1[1] += dist * -0.25;\n                break;\n            case LiteGraph.DOWN:\n                p1[1] += dist * 0.25;\n                break;\n        }\n        switch (end_dir) {\n            case LiteGraph.LEFT:\n                p2[0] += dist * -0.25;\n                break;\n            case LiteGraph.RIGHT:\n                p2[0] += dist * 0.25;\n                break;\n            case LiteGraph.UP:\n                p2[1] += dist * -0.25;\n                break;\n            case LiteGraph.DOWN:\n                p2[1] += dist * 0.25;\n                break;\n        }\n\n        var c1 = (1 - t) * (1 - t) * (1 - t);\n        var c2 = 3 * ((1 - t) * (1 - t)) * t;\n        var c3 = 3 * (1 - t) * (t * t);\n        var c4 = t * t * t;\n\n        var x = c1 * p0[0] + c2 * p1[0] + c3 * p2[0] + c4 * p3[0];\n        var y = c1 * p0[1] + c2 * p1[1] + c3 * p2[1] + c4 * p3[1];\n        return [x, y];\n    };\n\n    LGraphCanvas.prototype.drawExecutionOrder = function(ctx) {\n        ctx.shadowColor = \"transparent\";\n        ctx.globalAlpha = 0.25;\n\n        ctx.textAlign = \"center\";\n        ctx.strokeStyle = \"white\";\n        ctx.globalAlpha = 0.75;\n\n        var visible_nodes = this.visible_nodes;\n        for (var i = 0; i < visible_nodes.length; ++i) {\n            var node = visible_nodes[i];\n            ctx.fillStyle = \"black\";\n            ctx.fillRect(\n                node.pos[0] - LiteGraph.NODE_TITLE_HEIGHT,\n                node.pos[1] - LiteGraph.NODE_TITLE_HEIGHT,\n                LiteGraph.NODE_TITLE_HEIGHT,\n                LiteGraph.NODE_TITLE_HEIGHT\n            );\n            if (node.order == 0) {\n                ctx.strokeRect(\n                    node.pos[0] - LiteGraph.NODE_TITLE_HEIGHT + 0.5,\n                    node.pos[1] - LiteGraph.NODE_TITLE_HEIGHT + 0.5,\n                    LiteGraph.NODE_TITLE_HEIGHT,\n                    LiteGraph.NODE_TITLE_HEIGHT\n                );\n            }\n            ctx.fillStyle = \"#FFF\";\n            ctx.fillText(\n                node.order,\n                node.pos[0] + LiteGraph.NODE_TITLE_HEIGHT * -0.5,\n                node.pos[1] - 6\n            );\n        }\n        ctx.globalAlpha = 1;\n    };\n\n    /**\n     * draws the widgets stored inside a node\n     * @method drawNodeWidgets\n     **/\n    LGraphCanvas.prototype.drawNodeWidgets = function(\n        node,\n        posY,\n        ctx,\n        active_widget\n    ) {\n        if (!node.widgets || !node.widgets.length) {\n            return 0;\n        }\n        var width = node.size[0];\n        var widgets = node.widgets;\n        posY += 2;\n        var H = LiteGraph.NODE_WIDGET_HEIGHT;\n        var show_text = this.ds.scale > 0.5;\n        ctx.save();\n        ctx.globalAlpha = this.editor_alpha;\n        var outline_color = LiteGraph.WIDGET_OUTLINE_COLOR;\n        var background_color = LiteGraph.WIDGET_BGCOLOR;\n        var text_color = LiteGraph.WIDGET_TEXT_COLOR;\n\t\tvar secondary_text_color = LiteGraph.WIDGET_SECONDARY_TEXT_COLOR;\n        var margin = 15;\n\n        for (var i = 0; i < widgets.length; ++i) {\n            var w = widgets[i];\n            var y = posY;\n            if (w.y) {\n                y = w.y;\n            }\n            w.last_y = y;\n            ctx.strokeStyle = outline_color;\n            ctx.fillStyle = \"#222\";\n            ctx.textAlign = \"left\";\n\t\t\t//ctx.lineWidth = 2;\n\t\t\tif(w.disabled)\n\t\t\t\tctx.globalAlpha *= 0.5;\n\t\t\tvar widget_width = w.width || width;\n\n            switch (w.type) {\n                case \"button\":\n                    if (w.clicked) {\n                        ctx.fillStyle = \"#AAA\";\n                        w.clicked = false;\n                        this.dirty_canvas = true;\n                    }\n                    ctx.fillRect(margin, y, widget_width - margin * 2, H);\n\t\t\t\t\tif(show_text && !w.disabled)\n\t                    ctx.strokeRect( margin, y, widget_width - margin * 2, H );\n                    if (show_text) {\n                        ctx.textAlign = \"center\";\n                        ctx.fillStyle = text_color;\n                        ctx.fillText(w.label || w.name, widget_width * 0.5, y + H * 0.7);\n                    }\n                    break;\n                case \"toggle\":\n                    ctx.textAlign = \"left\";\n                    ctx.strokeStyle = outline_color;\n                    ctx.fillStyle = background_color;\n                    ctx.beginPath();\n                    if (show_text)\n\t                    ctx.roundRect(margin, y, widget_width - margin * 2, H, [H * 0.5]);\n\t\t\t\t\telse\n\t                    ctx.rect(margin, y, widget_width - margin * 2, H );\n                    ctx.fill();\n\t\t\t\t\tif(show_text && !w.disabled)\n\t                    ctx.stroke();\n                    ctx.fillStyle = w.value ? \"#89A\" : \"#333\";\n                    ctx.beginPath();\n                    ctx.arc( widget_width - margin * 2, y + H * 0.5, H * 0.36, 0, Math.PI * 2 );\n                    ctx.fill();\n                    if (show_text) {\n                        ctx.fillStyle = secondary_text_color;\n                        const label = w.label || w.name;    \n                        if (label != null) {\n                            ctx.fillText(label, margin * 2, y + H * 0.7);\n                        }\n                        ctx.fillStyle = w.value ? text_color : secondary_text_color;\n                        ctx.textAlign = \"right\";\n                        ctx.fillText(\n                            w.value\n                                ? w.options.on || \"true\"\n                                : w.options.off || \"false\",\n                            widget_width - 40,\n                            y + H * 0.7\n                        );\n                    }\n                    break;\n                case \"slider\":\n                    ctx.fillStyle = background_color;\n                    ctx.fillRect(margin, y, widget_width - margin * 2, H);\n                    var range = w.options.max - w.options.min;\n                    var nvalue = (w.value - w.options.min) / range;\n\t\t\t\t\tif(nvalue < 0.0) nvalue = 0.0;\n\t\t\t\t\tif(nvalue > 1.0) nvalue = 1.0;\n                    ctx.fillStyle = w.options.hasOwnProperty(\"slider_color\") ? w.options.slider_color : (active_widget == w ? \"#89A\" : \"#678\");\n                    ctx.fillRect(margin, y, nvalue * (widget_width - margin * 2), H);\n\t\t\t\t\tif(show_text && !w.disabled)\n\t                    ctx.strokeRect(margin, y, widget_width - margin * 2, H);\n                    if (w.marker) {\n                        var marker_nvalue = (w.marker - w.options.min) / range;\n\t\t\t\t\t\tif(marker_nvalue < 0.0) marker_nvalue = 0.0;\n\t\t\t\t\t\tif(marker_nvalue > 1.0) marker_nvalue = 1.0;\n                        ctx.fillStyle = w.options.hasOwnProperty(\"marker_color\") ? w.options.marker_color : \"#AA9\";\n                        ctx.fillRect( margin + marker_nvalue * (widget_width - margin * 2), y, 2, H );\n                    }\n                    if (show_text) {\n                        ctx.textAlign = \"center\";\n                        ctx.fillStyle = text_color;\n                        ctx.fillText(\n                            w.label || w.name + \"  \" + Number(w.value).toFixed(\n                                                            w.options.precision != null\n                                                                ? w.options.precision\n                                                                : 3\n                                                        ),\n                            widget_width * 0.5,\n                            y + H * 0.7\n                        );\n                    }\n                    break;\n                case \"number\":\n                case \"combo\":\n                    ctx.textAlign = \"left\";\n                    ctx.strokeStyle = outline_color;\n                    ctx.fillStyle = background_color;\n                    ctx.beginPath();\n\t\t\t\t\tif(show_text)\n\t                    ctx.roundRect(margin, y, widget_width - margin * 2, H, [H * 0.5] );\n\t\t\t\t\telse\n\t                    ctx.rect(margin, y, widget_width - margin * 2, H );\n                    ctx.fill();\n                    if (show_text) {\n\t\t\t\t\t\tif(!w.disabled)\n\t\t                    ctx.stroke();\n                        ctx.fillStyle = text_color;\n\t\t\t\t\t\tif(!w.disabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tctx.beginPath();\n\t\t\t\t\t\t\tctx.moveTo(margin + 16, y + 5);\n\t\t\t\t\t\t\tctx.lineTo(margin + 6, y + H * 0.5);\n\t\t\t\t\t\t\tctx.lineTo(margin + 16, y + H - 5);\n\t\t\t\t\t\t\tctx.fill();\n\t\t\t\t\t\t\tctx.beginPath();\n\t\t\t\t\t\t\tctx.moveTo(widget_width - margin - 16, y + 5);\n\t\t\t\t\t\t\tctx.lineTo(widget_width - margin - 6, y + H * 0.5);\n\t\t\t\t\t\t\tctx.lineTo(widget_width - margin - 16, y + H - 5);\n\t\t\t\t\t\t\tctx.fill();\n\t\t\t\t\t\t}\n                        ctx.fillStyle = secondary_text_color;\n                        ctx.fillText(w.label || w.name, margin * 2 + 5, y + H * 0.7);\n                        ctx.fillStyle = text_color;\n                        ctx.textAlign = \"right\";\n                        if (w.type == \"number\") {\n                            ctx.fillText(\n                                Number(w.value).toFixed(\n                                    w.options.precision !== undefined\n                                        ? w.options.precision\n                                        : 3\n                                ),\n                                widget_width - margin * 2 - 20,\n                                y + H * 0.7\n                            );\n                        } else {\n\t\t\t\t\t\t\tvar v = w.value;\n\t\t\t\t\t\t\tif( w.options.values )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar values = w.options.values;\n\t\t\t\t\t\t\t\tif( values.constructor === Function )\n\t\t\t\t\t\t\t\t\tvalues = values();\n\t\t\t\t\t\t\t\tif(values && values.constructor !== Array)\n\t\t\t\t\t\t\t\t\tv = values[ w.value ];\n\t\t\t\t\t\t\t}\n                            ctx.fillText(\n                                v,\n                                widget_width - margin * 2 - 20,\n                                y + H * 0.7\n                            );\n                        }\n                    }\n                    break;\n                case \"string\":\n                case \"text\":\n                    ctx.textAlign = \"left\";\n                    ctx.strokeStyle = outline_color;\n                    ctx.fillStyle = background_color;\n                    ctx.beginPath();\n                    if (show_text)\n\t                    ctx.roundRect(margin, y, widget_width - margin * 2, H, [H * 0.5]);\n\t\t\t\t\telse\n\t                    ctx.rect( margin, y, widget_width - margin * 2, H );\n                    ctx.fill();\n\t                if (show_text) {\n\t\t\t\t\t\tif(!w.disabled)\n\t\t\t\t\t\t\tctx.stroke();\n    \t\t\t\t\tctx.save();\n\t\t\t\t\t\tctx.beginPath();\n\t\t\t\t\t\tctx.rect(margin, y, widget_width - margin * 2, H);\n\t\t\t\t\t\tctx.clip();\n\n\t                    //ctx.stroke();\n                        ctx.fillStyle = secondary_text_color;\n                        const label = w.label || w.name;\t\n                        if (label != null) {\n                            ctx.fillText(label, margin * 2, y + H * 0.7);\n                        }\n                        ctx.fillStyle = text_color;\n                        ctx.textAlign = \"right\";\n                        ctx.fillText(String(w.value).substr(0,30), widget_width - margin * 2, y + H * 0.7); //30 chars max\n\t\t\t\t\t\tctx.restore();\n                    }\n                    break;\n                default:\n                    if (w.draw) {\n                        w.draw(ctx, node, widget_width, y, H);\n                    }\n                    break;\n            }\n            posY += (w.computeSize ? w.computeSize(widget_width)[1] : H) + 4;\n\t\t\tctx.globalAlpha = this.editor_alpha;\n\n        }\n        ctx.restore();\n\t\tctx.textAlign = \"left\";\n    };\n\n    /**\n     * process an event on widgets\n     * @method processNodeWidgets\n     **/\n    LGraphCanvas.prototype.processNodeWidgets = function(\n        node,\n        pos,\n        event,\n        active_widget\n    ) {\n        if (!node.widgets || !node.widgets.length || (!this.allow_interaction && !node.flags.allow_interaction)) {\n            return null;\n        }\n\n        var x = pos[0] - node.pos[0];\n        var y = pos[1] - node.pos[1];\n        var width = node.size[0];\n        var deltaX = event.deltaX || event.deltax || 0;\n        var that = this;\n        var ref_window = this.getCanvasWindow();\n\n        for (var i = 0; i < node.widgets.length; ++i) {\n            var w = node.widgets[i];\n\t\t\tif(!w || w.disabled)\n\t\t\t\tcontinue;\n\t\t\tvar widget_height = w.computeSize ? w.computeSize(width)[1] : LiteGraph.NODE_WIDGET_HEIGHT;\n\t\t\tvar widget_width = w.width || width;\n\t\t\t//outside\n\t\t\tif ( w != active_widget && \n\t\t\t\t(x < 6 || x > widget_width - 12 || y < w.last_y || y > w.last_y + widget_height || w.last_y === undefined) ) \n\t\t\t\tcontinue;\n\n\t\t\tvar old_value = w.value;\n\n            //if ( w == active_widget || (x > 6 && x < widget_width - 12 && y > w.last_y && y < w.last_y + widget_height) ) {\n\t\t\t//inside widget\n\t\t\tswitch (w.type) {\n\t\t\t\tcase \"button\":\n\t\t\t\t\tif (event.type === LiteGraph.pointerevents_method+\"down\") {\n                        if (w.callback) {\n                            setTimeout(function() {\n                                w.callback(w, that, node, pos, event);\n                            }, 20);\n                        }\n                        w.clicked = true;\n                        this.dirty_canvas = true;\n                    }\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"slider\":\n\t\t\t\t\tvar old_value = w.value;\n\t\t\t\t\tvar nvalue = clamp((x - 15) / (widget_width - 30), 0, 1);\n\t\t\t\t\tif(w.options.read_only) break;\n\t\t\t\t\tw.value = w.options.min + (w.options.max - w.options.min) * nvalue;\n\t\t\t\t\tif (old_value != w.value) {\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tinner_value_change(w, w.value);\n\t\t\t\t\t\t}, 20);\n\t\t\t\t\t}\n\t\t\t\t\tthis.dirty_canvas = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"number\":\n\t\t\t\tcase \"combo\":\n\t\t\t\t\tvar old_value = w.value;\n\t\t\t\t\tif (event.type == LiteGraph.pointerevents_method+\"move\" && w.type == \"number\") {\n                        if(deltaX)\n\t\t\t\t\t\t    w.value += deltaX * 0.1 * (w.options.step || 1);\n\t\t\t\t\t\tif ( w.options.min != null && w.value < w.options.min ) {\n\t\t\t\t\t\t\tw.value = w.options.min;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( w.options.max != null && w.value > w.options.max ) {\n\t\t\t\t\t\t\tw.value = w.options.max;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (event.type == LiteGraph.pointerevents_method+\"down\") {\n\t\t\t\t\t\tvar values = w.options.values;\n\t\t\t\t\t\tif (values && values.constructor === Function) {\n\t\t\t\t\t\t\tvalues = w.options.values(w, node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar values_list = null;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif( w.type != \"number\")\n\t\t\t\t\t\t\tvalues_list = values.constructor === Array ? values : Object.keys(values);\n\n\t\t\t\t\t\tvar delta = x < 40 ? -1 : x > widget_width - 40 ? 1 : 0;\n\t\t\t\t\t\tif (w.type == \"number\") {\n\t\t\t\t\t\t\tw.value += delta * 0.1 * (w.options.step || 1);\n\t\t\t\t\t\t\tif ( w.options.min != null && w.value < w.options.min ) {\n\t\t\t\t\t\t\t\tw.value = w.options.min;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ( w.options.max != null && w.value > w.options.max ) {\n\t\t\t\t\t\t\t\tw.value = w.options.max;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (delta) { //clicked in arrow, used for combos \n\t\t\t\t\t\t\tvar index = -1;\n\t\t\t\t\t\t\tthis.last_mouseclick = 0; //avoids dobl click event\n\t\t\t\t\t\t\tif(values.constructor === Object)\n\t\t\t\t\t\t\t\tindex = values_list.indexOf( String( w.value ) ) + delta;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tindex = values_list.indexOf( w.value ) + delta;\n\t\t\t\t\t\t\tif (index >= values_list.length) {\n\t\t\t\t\t\t\t\tindex = values_list.length - 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (index < 0) {\n\t\t\t\t\t\t\t\tindex = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif( values.constructor === Array )\n\t\t\t\t\t\t\t\tw.value = values[index];\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tw.value = index;\n\t\t\t\t\t\t} else { //combo clicked \n\t\t\t\t\t\t\tvar text_values = values != values_list ? Object.values(values) : values;\n\t\t\t\t\t\t\tvar menu = new LiteGraph.ContextMenu(text_values, {\n\t\t\t\t\t\t\t\t\tscale: Math.max(1, this.ds.scale),\n\t\t\t\t\t\t\t\t\tevent: event,\n\t\t\t\t\t\t\t\t\tclassName: \"dark\",\n\t\t\t\t\t\t\t\t\tcallback: inner_clicked.bind(w)\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tref_window);\n\t\t\t\t\t\t\tfunction inner_clicked(v, option, event) {\n\t\t\t\t\t\t\t\tif(values != values_list)\n\t\t\t\t\t\t\t\t\tv = text_values.indexOf(v);\n\t\t\t\t\t\t\t\tthis.value = v;\n\t\t\t\t\t\t\t\tinner_value_change(this, v);\n\t\t\t\t\t\t\t\tthat.dirty_canvas = true;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} //end mousedown\n\t\t\t\t\telse if(event.type == LiteGraph.pointerevents_method+\"up\" && w.type == \"number\")\n\t\t\t\t\t{\n\t\t\t\t\t\tvar delta = x < 40 ? -1 : x > widget_width - 40 ? 1 : 0;\n\t\t\t\t\t\tif (event.click_time < 200 && delta == 0) {\n\t\t\t\t\t\t\tthis.prompt(\"Value\",w.value,function(v) {\n\t\t\t\t\t\t\t\t\t// check if v is a valid equation or a number\n\t\t\t\t\t\t\t\t\t  if (/^[0-9+\\-*/()\\s]+|\\d+\\.\\d+$/.test(v)) {\n\t\t\t\t\t\t\t\t\t\ttry {//solve the equation if possible\n\t\t\t\t\t\t\t\t\t    \t\tv = eval(v);\n\t\t\t\t\t\t\t\t\t\t} catch (e) { }\n\t\t\t\t\t\t\t\t\t}\t\n\t\t\t\t\t\t\t\t\tthis.value = Number(v);\n\t\t\t\t\t\t\t\t\tinner_value_change(this, this.value);\n\t\t\t\t\t\t\t\t}.bind(w),\n\t\t\t\t\t\t\t\tevent);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif( old_value != w.value )\n\t\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tinner_value_change(this, this.value);\n\t\t\t\t\t\t\t}.bind(w),\n\t\t\t\t\t\t\t20\n\t\t\t\t\t\t);\n\t\t\t\t\tthis.dirty_canvas = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"toggle\":\n\t\t\t\t\tif (event.type == LiteGraph.pointerevents_method+\"down\") {\n\t\t\t\t\t\tw.value = !w.value;\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tinner_value_change(w, w.value);\n\t\t\t\t\t\t}, 20);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"string\":\n\t\t\t\tcase \"text\":\n\t\t\t\t\tif (event.type == LiteGraph.pointerevents_method+\"down\") {\n\t\t\t\t\t\tthis.prompt(\"Value\",w.value,function(v) {\n\t\t\t\t\t\t\t\tinner_value_change(this, v);\n\t\t\t\t\t\t\t}.bind(w),\n\t\t\t\t\t\t\tevent,w.options ? w.options.multiline : false );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tif (w.mouse) {\n\t\t\t\t\t\tthis.dirty_canvas = w.mouse(event, [x, y], node);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t} //end switch\n\n\t\t\t//value changed\n\t\t\tif( old_value != w.value )\n\t\t\t{\n\t\t\t\tif(node.onWidgetChanged)\n\t\t\t\t\tnode.onWidgetChanged( w.name,w.value,old_value,w );\n                node.graph._version++;\n\t\t\t}\n\n\t\t\treturn w;\n        }//end for\n\n        function inner_value_change(widget, value) {\n            if(widget.type == \"number\"){\n                value = Number(value);\n            }\n            widget.value = value;\n            if ( widget.options && widget.options.property && node.properties[widget.options.property] !== undefined ) {\n                node.setProperty( widget.options.property, value );\n            }\n            if (widget.callback) {\n                widget.callback(widget.value, that, node, pos, event);\n            }\n        }\n\n        return null;\n    };\n\n    /**\n     * draws every group area in the background\n     * @method drawGroups\n     **/\n    LGraphCanvas.prototype.drawGroups = function(canvas, ctx) {\n        if (!this.graph) {\n            return;\n        }\n\n        var groups = this.graph._groups;\n\n        ctx.save();\n        ctx.globalAlpha = 0.5 * this.editor_alpha;\n\n        for (var i = 0; i < groups.length; ++i) {\n            var group = groups[i];\n\n            if (!overlapBounding(this.visible_area, group._bounding)) {\n                continue;\n            } //out of the visible area\n\n            ctx.fillStyle = group.color || \"#335\";\n            ctx.strokeStyle = group.color || \"#335\";\n            var pos = group._pos;\n            var size = group._size;\n            ctx.globalAlpha = 0.25 * this.editor_alpha;\n            ctx.beginPath();\n            ctx.rect(pos[0] + 0.5, pos[1] + 0.5, size[0], size[1]);\n            ctx.fill();\n            ctx.globalAlpha = this.editor_alpha;\n            ctx.stroke();\n\n            ctx.beginPath();\n            ctx.moveTo(pos[0] + size[0], pos[1] + size[1]);\n            ctx.lineTo(pos[0] + size[0] - 10, pos[1] + size[1]);\n            ctx.lineTo(pos[0] + size[0], pos[1] + size[1] - 10);\n            ctx.fill();\n\n            var font_size =\n                group.font_size || LiteGraph.DEFAULT_GROUP_FONT_SIZE;\n            ctx.font = font_size + \"px Arial\";\n\t\t\tctx.textAlign = \"left\";\n            ctx.fillText(group.title, pos[0] + 4, pos[1] + font_size);\n        }\n\n        ctx.restore();\n    };\n\n    LGraphCanvas.prototype.adjustNodesSize = function() {\n        var nodes = this.graph._nodes;\n        for (var i = 0; i < nodes.length; ++i) {\n            nodes[i].size = nodes[i].computeSize();\n        }\n        this.setDirty(true, true);\n    };\n\n    /**\n     * resizes the canvas to a given size, if no size is passed, then it tries to fill the parentNode\n     * @method resize\n     **/\n    LGraphCanvas.prototype.resize = function(width, height) {\n        if (!width && !height) {\n            var parent = this.canvas.parentNode;\n            width = parent.offsetWidth;\n            height = parent.offsetHeight;\n        }\n\n        if (this.canvas.width == width && this.canvas.height == height) {\n            return;\n        }\n\n        this.canvas.width = width;\n        this.canvas.height = height;\n        this.bgcanvas.width = this.canvas.width;\n        this.bgcanvas.height = this.canvas.height;\n        this.setDirty(true, true);\n    };\n\n    /**\n     * switches to live mode (node shapes are not rendered, only the content)\n     * this feature was designed when graphs where meant to create user interfaces\n     * @method switchLiveMode\n     **/\n    LGraphCanvas.prototype.switchLiveMode = function(transition) {\n        if (!transition) {\n            this.live_mode = !this.live_mode;\n            this.dirty_canvas = true;\n            this.dirty_bgcanvas = true;\n            return;\n        }\n\n        var self = this;\n        var delta = this.live_mode ? 1.1 : 0.9;\n        if (this.live_mode) {\n            this.live_mode = false;\n            this.editor_alpha = 0.1;\n        }\n\n        var t = setInterval(function() {\n            self.editor_alpha *= delta;\n            self.dirty_canvas = true;\n            self.dirty_bgcanvas = true;\n\n            if (delta < 1 && self.editor_alpha < 0.01) {\n                clearInterval(t);\n                if (delta < 1) {\n                    self.live_mode = true;\n                }\n            }\n            if (delta > 1 && self.editor_alpha > 0.99) {\n                clearInterval(t);\n                self.editor_alpha = 1;\n            }\n        }, 1);\n    };\n\n    LGraphCanvas.prototype.onNodeSelectionChange = function(node) {\n        return; //disabled\n    };\n\n    /* this is an implementation for touch not in production and not ready\n     */\n    /*LGraphCanvas.prototype.touchHandler = function(event) {\n        //alert(\"foo\");\n        var touches = event.changedTouches,\n            first = touches[0],\n            type = \"\";\n\n        switch (event.type) {\n            case \"touchstart\":\n                type = \"mousedown\";\n                break;\n            case \"touchmove\":\n                type = \"mousemove\";\n                break;\n            case \"touchend\":\n                type = \"mouseup\";\n                break;\n            default:\n                return;\n        }\n\n        //initMouseEvent(type, canBubble, cancelable, view, clickCount,\n        //           screenX, screenY, clientX, clientY, ctrlKey,\n        //           altKey, shiftKey, metaKey, button, relatedTarget);\n\n        // this is eventually a Dom object, get the LGraphCanvas back\n        if(typeof this.getCanvasWindow == \"undefined\"){\n            var window = this.lgraphcanvas.getCanvasWindow();\n        }else{\n            var window = this.getCanvasWindow();\n        }\n        \n        var document = window.document;\n\n        var simulatedEvent = document.createEvent(\"MouseEvent\");\n        simulatedEvent.initMouseEvent(\n            type,\n            true,\n            true,\n            window,\n            1,\n            first.screenX,\n            first.screenY,\n            first.clientX,\n            first.clientY,\n            false,\n            false,\n            false,\n            false,\n            0, //left\n            null\n        );\n        first.target.dispatchEvent(simulatedEvent);\n        event.preventDefault();\n    };*/\n\n    /* CONTEXT MENU ********************/\n\n    LGraphCanvas.onGroupAdd = function(info, entry, mouse_event) {\n        var canvas = LGraphCanvas.active_canvas;\n        var ref_window = canvas.getCanvasWindow();\n\n        var group = new LiteGraph.LGraphGroup();\n        group.pos = canvas.convertEventToCanvasOffset(mouse_event);\n        canvas.graph.add(group);\n    };\n\n    /**\n     * Determines the furthest nodes in each direction\n     * @param nodes {LGraphNode[]} the nodes to from which boundary nodes will be extracted\n     * @return {{left: LGraphNode, top: LGraphNode, right: LGraphNode, bottom: LGraphNode}}\n     */\n    LGraphCanvas.getBoundaryNodes = function(nodes) {\n        let top = null;\n        let right = null;\n        let bottom = null;\n        let left = null;\n        for (const nID in nodes) {\n            const node = nodes[nID];\n            const [x, y] = node.pos;\n            const [width, height] = node.size;\n\n            if (top === null || y < top.pos[1]) {\n                top = node;\n            }\n            if (right === null || x + width > right.pos[0] + right.size[0]) {\n                right = node;\n            }\n            if (bottom === null || y + height > bottom.pos[1] + bottom.size[1]) {\n                bottom = node;\n            }\n            if (left === null || x < left.pos[0]) {\n                left = node;\n            }\n        }\n\n        return {\n            \"top\": top,\n            \"right\": right,\n            \"bottom\": bottom,\n            \"left\": left\n        };\n    }\n    /**\n     * Determines the furthest nodes in each direction for the currently selected nodes\n     * @return {{left: LGraphNode, top: LGraphNode, right: LGraphNode, bottom: LGraphNode}}\n     */\n    LGraphCanvas.prototype.boundaryNodesForSelection = function() {\n        return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes));\n    }\n\n    /**\n     *\n     * @param {LGraphNode[]} nodes a list of nodes\n     * @param {\"top\"|\"bottom\"|\"left\"|\"right\"} direction Direction to align the nodes\n     * @param {LGraphNode?} align_to Node to align to (if null, align to the furthest node in the given direction)\n     */\n    LGraphCanvas.alignNodes = function (nodes, direction, align_to) {\n        if (!nodes) {\n            return;\n        }\n\n        const canvas = LGraphCanvas.active_canvas;\n        let boundaryNodes = []\n        if (align_to === undefined) {\n            boundaryNodes = LGraphCanvas.getBoundaryNodes(nodes)\n        } else {\n            boundaryNodes = {\n                \"top\": align_to,\n                \"right\": align_to,\n                \"bottom\": align_to,\n                \"left\": align_to\n            }\n        }\n\n        for (const [_, node] of Object.entries(canvas.selected_nodes)) {\n            switch (direction) {\n                case \"right\":\n                    node.pos[0] = boundaryNodes[\"right\"].pos[0] + boundaryNodes[\"right\"].size[0] - node.size[0];\n                    break;\n                case \"left\":\n                    node.pos[0] = boundaryNodes[\"left\"].pos[0];\n                    break;\n                case \"top\":\n                    node.pos[1] = boundaryNodes[\"top\"].pos[1];\n                    break;\n                case \"bottom\":\n                    node.pos[1] = boundaryNodes[\"bottom\"].pos[1] + boundaryNodes[\"bottom\"].size[1] - node.size[1];\n                    break;\n            }\n        }\n\n        canvas.dirty_canvas = true;\n        canvas.dirty_bgcanvas = true;\n    };\n\n    LGraphCanvas.onNodeAlign = function(value, options, event, prev_menu, node) {\n        new LiteGraph.ContextMenu([\"Top\", \"Bottom\", \"Left\", \"Right\"], {\n            event: event,\n            callback: inner_clicked,\n            parentMenu: prev_menu,\n        });\n\n        function inner_clicked(value) {\n            LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes, value.toLowerCase(), node);\n        }\n    }\n\n    LGraphCanvas.onGroupAlign = function(value, options, event, prev_menu) {\n        new LiteGraph.ContextMenu([\"Top\", \"Bottom\", \"Left\", \"Right\"], {\n            event: event,\n            callback: inner_clicked,\n            parentMenu: prev_menu,\n        });\n\n        function inner_clicked(value) {\n            LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes, value.toLowerCase());\n        }\n    }\n\n    LGraphCanvas.onMenuAdd = function (node, options, e, prev_menu, callback) {\n\n        var canvas = LGraphCanvas.active_canvas;\n        var ref_window = canvas.getCanvasWindow();\n        var graph = canvas.graph;\n        if (!graph)\n            return;\n\n        function inner_onMenuAdded(base_category ,prev_menu){\n    \n            var categories  = LiteGraph.getNodeTypesCategories(canvas.filter || graph.filter).filter(function(category){return category.startsWith(base_category)});\n            var entries = [];\n    \n            categories.map(function(category){\n    \n                if (!category) \n                    return;\n    \n                var base_category_regex = new RegExp('^(' + base_category + ')');\n                var category_name = category.replace(base_category_regex,\"\").split('/')[0];\n                var category_path = base_category  === '' ? category_name + '/' : base_category + category_name + '/';\n    \n                var name = category_name;\n                if(name.indexOf(\"::\") != -1) //in case it has a namespace like \"shader::math/rand\" it hides the namespace\n                    name = name.split(\"::\")[1];\n                        \n                var index = entries.findIndex(function(entry){return entry.value === category_path});\n                if (index === -1) {\n                    entries.push({ value: category_path, content: name, has_submenu: true, callback : function(value, event, mouseEvent, contextMenu){\n                        inner_onMenuAdded(value.value, contextMenu)\n                    }});\n                }\n                \n            });\n    \n            var nodes = LiteGraph.getNodeTypesInCategory(base_category.slice(0, -1), canvas.filter || graph.filter );\n            nodes.map(function(node){\n    \n                if (node.skip_list)\n                    return;\n    \n                var entry = { value: node.type, content: node.title, has_submenu: false , callback : function(value, event, mouseEvent, contextMenu){\n                    \n                        var first_event = contextMenu.getFirstEvent();\n                        canvas.graph.beforeChange();\n                        var node = LiteGraph.createNode(value.value);\n                        if (node) {\n                            node.pos = canvas.convertEventToCanvasOffset(first_event);\n                            canvas.graph.add(node);\n                        }\n                        if(callback)\n                            callback(node);\n                        canvas.graph.afterChange();\n                    \n                    }\n                }\n    \n                entries.push(entry);\n    \n            });\n    \n            new LiteGraph.ContextMenu( entries, { event: e, parentMenu: prev_menu }, ref_window );\n    \n        }\n    \n        inner_onMenuAdded('',prev_menu);\n        return false;\n    \n    };\n\n    LGraphCanvas.onMenuCollapseAll = function() {};\n\n    LGraphCanvas.onMenuNodeEdit = function() {};\n\n    LGraphCanvas.showMenuNodeOptionalInputs = function(\n        v,\n        options,\n        e,\n        prev_menu,\n        node\n    ) {\n        if (!node) {\n            return;\n        }\n\n        var that = this;\n        var canvas = LGraphCanvas.active_canvas;\n        var ref_window = canvas.getCanvasWindow();\n\n        var options = node.optional_inputs;\n        if (node.onGetInputs) {\n            options = node.onGetInputs();\n        }\n\n        var entries = [];\n        if (options) {\n            for (var i=0; i < options.length; i++) {\n                var entry = options[i];\n                if (!entry) {\n                    entries.push(null);\n                    continue;\n                }\n                var label = entry[0];\n\t\t\t\tif(!entry[2])\n\t\t\t\t\tentry[2] = {};\n\n                if (entry[2].label) {\n                    label = entry[2].label;\n                }\n\n\t\t\t\tentry[2].removable = true;\n                var data = { content: label, value: entry };\n                if (entry[1] == LiteGraph.ACTION) {\n                    data.className = \"event\";\n                }\n                entries.push(data);\n            }\n        }\n\n        if (node.onMenuNodeInputs) {\n            var retEntries = node.onMenuNodeInputs(entries);\n            if(retEntries) entries = retEntries;\n        }\n\n        if (!entries.length) {\n\t\t\tconsole.log(\"no input entries\");\n            return;\n        }\n\n        var menu = new LiteGraph.ContextMenu(\n            entries,\n            {\n                event: e,\n                callback: inner_clicked,\n                parentMenu: prev_menu,\n                node: node\n            },\n            ref_window\n        );\n\n        function inner_clicked(v, e, prev) {\n            if (!node) {\n                return;\n            }\n\n            if (v.callback) {\n                v.callback.call(that, node, v, e, prev);\n            }\n\n            if (v.value) {\n\t\t\t\tnode.graph.beforeChange();\n                node.addInput(v.value[0], v.value[1], v.value[2]);\n\n                if (node.onNodeInputAdd) { // callback to the node when adding a slot\n                    node.onNodeInputAdd(v.value);\n                }\n                node.setDirtyCanvas(true, true);\n\t\t\t\tnode.graph.afterChange();\n            }\n        }\n\n        return false;\n    };\n\n    LGraphCanvas.showMenuNodeOptionalOutputs = function(\n        v,\n        options,\n        e,\n        prev_menu,\n        node\n    ) {\n        if (!node) {\n            return;\n        }\n\n        var that = this;\n        var canvas = LGraphCanvas.active_canvas;\n        var ref_window = canvas.getCanvasWindow();\n\n        var options = node.optional_outputs;\n        if (node.onGetOutputs) {\n            options = node.onGetOutputs();\n        }\n\n        var entries = [];\n        if (options) {\n            for (var i=0; i < options.length; i++) {\n                var entry = options[i];\n                if (!entry) {\n                    //separator?\n                    entries.push(null);\n                    continue;\n                }\n\n                if (\n                    node.flags &&\n                    node.flags.skip_repeated_outputs &&\n                    node.findOutputSlot(entry[0]) != -1\n                ) {\n                    continue;\n                } //skip the ones already on\n                var label = entry[0];\n\t\t\t\tif(!entry[2])\n\t\t\t\t\tentry[2] = {};\n                if (entry[2].label) {\n                    label = entry[2].label;\n                }\n\t\t\t\tentry[2].removable = true;\n                var data = { content: label, value: entry };\n                if (entry[1] == LiteGraph.EVENT) {\n                    data.className = \"event\";\n                }\n                entries.push(data);\n            }\n        }\n\n        if (this.onMenuNodeOutputs) {\n            entries = this.onMenuNodeOutputs(entries);\n        }\n        if (LiteGraph.do_add_triggers_slots){ //canvas.allow_addOutSlot_onExecuted\n            if (node.findOutputSlot(\"onExecuted\") == -1){\n                entries.push({content: \"On Executed\", value: [\"onExecuted\", LiteGraph.EVENT, {nameLocked: true}], className: \"event\"}); //, opts: {}\n            }\n        }\n        // add callback for modifing the menu elements onMenuNodeOutputs\n        if (node.onMenuNodeOutputs) {\n            var retEntries = node.onMenuNodeOutputs(entries);\n            if(retEntries) entries = retEntries;\n        }\n\n        if (!entries.length) {\n            return;\n        }\n\n        var menu = new LiteGraph.ContextMenu(\n            entries,\n            {\n                event: e,\n                callback: inner_clicked,\n                parentMenu: prev_menu,\n                node: node\n            },\n            ref_window\n        );\n\n        function inner_clicked(v, e, prev) {\n            if (!node) {\n                return;\n            }\n\n            if (v.callback) {\n                v.callback.call(that, node, v, e, prev);\n            }\n\n            if (!v.value) {\n                return;\n            }\n\n            var value = v.value[1];\n\n            if (\n                value &&\n                (value.constructor === Object || value.constructor === Array)\n            ) {\n                //submenu why?\n                var entries = [];\n                for (var i in value) {\n                    entries.push({ content: i, value: value[i] });\n                }\n                new LiteGraph.ContextMenu(entries, {\n                    event: e,\n                    callback: inner_clicked,\n                    parentMenu: prev_menu,\n                    node: node\n                });\n                return false;\n            } else {\n\t\t\t\tnode.graph.beforeChange();\n                node.addOutput(v.value[0], v.value[1], v.value[2]);\n\n                if (node.onNodeOutputAdd) { // a callback to the node when adding a slot\n                    node.onNodeOutputAdd(v.value);\n                }\n                node.setDirtyCanvas(true, true);\n\t\t\t\tnode.graph.afterChange();\n            }\n        }\n\n        return false;\n    };\n\n    LGraphCanvas.onShowMenuNodeProperties = function(\n        value,\n        options,\n        e,\n        prev_menu,\n        node\n    ) {\n        if (!node || !node.properties) {\n            return;\n        }\n\n        var that = this;\n        var canvas = LGraphCanvas.active_canvas;\n        var ref_window = canvas.getCanvasWindow();\n\n        var entries = [];\n        for (var i in node.properties) {\n            var value = node.properties[i] !== undefined ? node.properties[i] : \" \";\n\t\t\tif( typeof value == \"object\" )\n\t\t\t\tvalue = JSON.stringify(value);\n\t\t\tvar info = node.getPropertyInfo(i);\n\t\t\tif(info.type == \"enum\" || info.type == \"combo\")\n\t\t\t\tvalue = LGraphCanvas.getPropertyPrintableValue( value, info.values );\n\n            //value could contain invalid html characters, clean that\n            value = LGraphCanvas.decodeHTML(value);\n            entries.push({\n                content:\n                    \"<span class='property_name'>\" +\n                    (info.label ? info.label : i) +\n                    \"</span>\" +\n                    \"<span class='property_value'>\" +\n                    value +\n                    \"</span>\",\n                value: i\n            });\n        }\n        if (!entries.length) {\n            return;\n        }\n\n        var menu = new LiteGraph.ContextMenu(\n            entries,\n            {\n                event: e,\n                callback: inner_clicked,\n                parentMenu: prev_menu,\n                allow_html: true,\n                node: node\n            },\n            ref_window\n        );\n\n        function inner_clicked(v, options, e, prev) {\n            if (!node) {\n                return;\n            }\n            var rect = this.getBoundingClientRect();\n            canvas.showEditPropertyValue(node, v.value, {\n                position: [rect.left, rect.top]\n            });\n        }\n\n        return false;\n    };\n\n    LGraphCanvas.decodeHTML = function(str) {\n        var e = document.createElement(\"div\");\n        e.innerText = str;\n        return e.innerHTML;\n    };\n\n    LGraphCanvas.onMenuResizeNode = function(value, options, e, menu, node) {\n        if (!node) {\n            return;\n        }\n        \n\t\tvar fApplyMultiNode = function(node){\n\t\t\tnode.size = node.computeSize();\n\t\t\tif (node.onResize)\n\t\t\t\tnode.onResize(node.size);\n\t\t}\n\t\t\n\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\tif (!graphcanvas.selected_nodes || Object.keys(graphcanvas.selected_nodes).length <= 1){\n\t\t\tfApplyMultiNode(node);\n\t\t}else{\n\t\t\tfor (var i in graphcanvas.selected_nodes) {\n\t\t\t\tfApplyMultiNode(graphcanvas.selected_nodes[i]);\n\t\t\t}\n\t\t}\n\t\t\n        node.setDirtyCanvas(true, true);\n    };\n\n    LGraphCanvas.prototype.showLinkMenu = function(link, e) {\n        var that = this;\n\t\t// console.log(link);\n\t\tvar node_left = that.graph.getNodeById( link.origin_id );\n\t\tvar node_right = that.graph.getNodeById( link.target_id );\n\t\tvar fromType = false;\n\t\tif (node_left && node_left.outputs && node_left.outputs[link.origin_slot]) fromType = node_left.outputs[link.origin_slot].type;\n        var destType = false;\n\t\tif (node_right && node_right.outputs && node_right.outputs[link.target_slot]) destType = node_right.inputs[link.target_slot].type;\n\t\t\n\t\tvar options = [\"Add Node\",null,\"Delete\",null];\n\t\t\n\t\t\n        var menu = new LiteGraph.ContextMenu(options, {\n            event: e,\n\t\t\ttitle: link.data != null ? link.data.constructor.name : null,\n            callback: inner_clicked\n        });\n\n        function inner_clicked(v,options,e) {\n            switch (v) {\n                case \"Add Node\":\n\t\t\t\t\tLGraphCanvas.onMenuAdd(null, null, e, menu, function(node){\n\t\t\t\t\t\t// console.debug(\"node autoconnect\");\n\t\t\t\t\t\tif(!node.inputs || !node.inputs.length || !node.outputs || !node.outputs.length){\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// leave the connection type checking inside connectByType\n\t\t\t\t\t\tif (node_left.connectByType( link.origin_slot, node, fromType )){\n                        \tnode.connectByType( link.target_slot, node_right, destType );\n                            node.pos[0] -= node.size[0] * 0.5;\n                        }\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n                case \"Delete\":\n                    that.graph.removeLink(link.id);\n                    break;\n                default:\n\t\t\t\t\t/*var nodeCreated = createDefaultNodeForSlot({   nodeFrom: node_left\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,slotFrom: link.origin_slot\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,nodeTo: node\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,slotTo: link.target_slot\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,e: e\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,nodeType: \"AUTO\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\tif(nodeCreated) console.log(\"new node in beetween \"+v+\" created\");*/\n            }\n        }\n\n        return false;\n    };\n    \n \tLGraphCanvas.prototype.createDefaultNodeForSlot = function(optPass) { // addNodeMenu for connection\n        var optPass = optPass || {};\n        var opts = Object.assign({   nodeFrom: null // input\n                                    ,slotFrom: null // input\n                                    ,nodeTo: null   // output\n                                    ,slotTo: null   // output\n                                    ,position: []\t// pass the event coords\n\t\t\t\t\t\t\t\t  \t,nodeType: null\t// choose a nodetype to add, AUTO to set at first good\n\t\t\t\t\t\t\t\t  \t,posAdd:[0,0]\t// adjust x,y\n\t\t\t\t\t\t\t\t  \t,posSizeFix:[0,0] // alpha, adjust the position x,y based on the new node size w,h\n                                }\n                                ,optPass\n                            );\n        var that = this;\n        \n        var isFrom = opts.nodeFrom && opts.slotFrom!==null;\n        var isTo = !isFrom && opts.nodeTo && opts.slotTo!==null;\n\t\n        if (!isFrom && !isTo){\n            console.warn(\"No data passed to createDefaultNodeForSlot \"+opts.nodeFrom+\" \"+opts.slotFrom+\" \"+opts.nodeTo+\" \"+opts.slotTo);\n            return false;\n        }\n\t\tif (!opts.nodeType){\n            console.warn(\"No type to createDefaultNodeForSlot\");\n            return false;\n        }\n        \n        var nodeX = isFrom ? opts.nodeFrom : opts.nodeTo;\n        var slotX = isFrom ? opts.slotFrom : opts.slotTo;\n        \n        var iSlotConn = false;\n        switch (typeof slotX){\n            case \"string\":\n                iSlotConn = isFrom ? nodeX.findOutputSlot(slotX,false) : nodeX.findInputSlot(slotX,false);\n                slotX = isFrom ? nodeX.outputs[slotX] : nodeX.inputs[slotX];\n            break;\n            case \"object\":\n                // ok slotX\n                iSlotConn = isFrom ? nodeX.findOutputSlot(slotX.name) : nodeX.findInputSlot(slotX.name);\n            break;\n            case \"number\":\n                iSlotConn = slotX;\n                slotX = isFrom ? nodeX.outputs[slotX] : nodeX.inputs[slotX];\n            break;\n\t\t\tcase \"undefined\":\n            default:\n                // bad ?\n                //iSlotConn = 0;\n                console.warn(\"Cant get slot information \"+slotX);\n                return false;\n        }\n\t\n\t\tif (slotX===false || iSlotConn===false){\n\t\t\tconsole.warn(\"createDefaultNodeForSlot bad slotX \"+slotX+\" \"+iSlotConn);\n\t\t}\n\t\t\n\t\t// check for defaults nodes for this slottype\n\t\tvar fromSlotType = slotX.type==LiteGraph.EVENT?\"_event_\":slotX.type;\n\t\tvar slotTypesDefault = isFrom ? LiteGraph.slot_types_default_out : LiteGraph.slot_types_default_in;\n\t\tif(slotTypesDefault && slotTypesDefault[fromSlotType]){\n\t\t\tif (slotX.link !== null) {\n\t\t\t\t// is connected\n\t\t\t}else{\n\t\t\t\t// is not not connected\n\t\t\t}\n\t\t\tnodeNewType = false;\n\t\t\tif(typeof slotTypesDefault[fromSlotType] == \"object\" || typeof slotTypesDefault[fromSlotType] == \"array\"){\n\t\t\t\tfor(var typeX in slotTypesDefault[fromSlotType]){\n\t\t\t\t\tif (opts.nodeType == slotTypesDefault[fromSlotType][typeX] || opts.nodeType == \"AUTO\"){\n\t\t\t\t\t\tnodeNewType = slotTypesDefault[fromSlotType][typeX];\n\t\t\t\t\t\t// console.log(\"opts.nodeType == slotTypesDefault[fromSlotType][typeX] :: \"+opts.nodeType);\n\t\t\t\t\t\tbreak; // --------\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tif (opts.nodeType == slotTypesDefault[fromSlotType] || opts.nodeType == \"AUTO\") nodeNewType = slotTypesDefault[fromSlotType];\n\t\t\t}\n\t\t\tif (nodeNewType) {\n\t\t\t\tvar nodeNewOpts = false;\n\t\t\t\tif (typeof nodeNewType == \"object\" && nodeNewType.node){\n\t\t\t\t\tnodeNewOpts = nodeNewType;\n\t\t\t\t\tnodeNewType = nodeNewType.node;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//that.graph.beforeChange();\n\t\t\t\t\n\t\t\t\tvar newNode = LiteGraph.createNode(nodeNewType);\n\t\t\t\tif(newNode){\n\t\t\t\t\t// if is object pass options\n\t\t\t\t\tif (nodeNewOpts){\n\t\t\t\t\t\tif (nodeNewOpts.properties) {\n\t\t\t\t\t\t\tfor (var i in nodeNewOpts.properties) {\n\t\t\t\t\t\t\t\tnewNode.addProperty( i, nodeNewOpts.properties[i] );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (nodeNewOpts.inputs) {\n\t\t\t\t\t\t\tnewNode.inputs = [];\n\t\t\t\t\t\t\tfor (var i in nodeNewOpts.inputs) {\n\t\t\t\t\t\t\t\tnewNode.addOutput(\n\t\t\t\t\t\t\t\t\tnodeNewOpts.inputs[i][0],\n\t\t\t\t\t\t\t\t\tnodeNewOpts.inputs[i][1]\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (nodeNewOpts.outputs) {\n\t\t\t\t\t\t\tnewNode.outputs = [];\n\t\t\t\t\t\t\tfor (var i in nodeNewOpts.outputs) {\n\t\t\t\t\t\t\t\tnewNode.addOutput(\n\t\t\t\t\t\t\t\t\tnodeNewOpts.outputs[i][0],\n\t\t\t\t\t\t\t\t\tnodeNewOpts.outputs[i][1]\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (nodeNewOpts.title) {\n\t\t\t\t\t\t\tnewNode.title = nodeNewOpts.title;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (nodeNewOpts.json) {\n\t\t\t\t\t\t\tnewNode.configure(nodeNewOpts.json);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// add the node\n\t\t\t\t\tthat.graph.add(newNode);\n\t\t\t\t\tnewNode.pos = [\topts.position[0]+opts.posAdd[0]+(opts.posSizeFix[0]?opts.posSizeFix[0]*newNode.size[0]:0)\n\t\t\t\t\t\t\t\t   \t,opts.position[1]+opts.posAdd[1]+(opts.posSizeFix[1]?opts.posSizeFix[1]*newNode.size[1]:0)]; //that.last_click_position; //[e.canvasX+30, e.canvasX+5];*/\n\t\t\t\t\t\n\t\t\t\t\t//that.graph.afterChange();\n\t\t\t\t\t\n\t\t\t\t\t// connect the two!\n\t\t\t\t\tif (isFrom){\n\t\t\t\t\t\topts.nodeFrom.connectByType( iSlotConn, newNode, fromSlotType );\n\t\t\t\t\t}else{\n\t\t\t\t\t\topts.nodeTo.connectByTypeOutput( iSlotConn, newNode, fromSlotType );\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// if connecting in between\n\t\t\t\t\tif (isFrom && isTo){\n\t\t\t\t\t\t// TODO\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn true;\n\t\t\t\t\t\n\t\t\t\t}else{\n\t\t\t\t\tconsole.log(\"failed creating \"+nodeNewType);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n \n    LGraphCanvas.prototype.showConnectionMenu = function(optPass) { // addNodeMenu for connection\n        var optPass = optPass || {};\n        var opts = Object.assign({   nodeFrom: null  // input\n                                    ,slotFrom: null // input\n                                    ,nodeTo: null   // output\n                                    ,slotTo: null   // output\n                                    ,e: null\n                                }\n                                ,optPass\n                            );\n        var that = this;\n        \n        var isFrom = opts.nodeFrom && opts.slotFrom;\n        var isTo = !isFrom && opts.nodeTo && opts.slotTo;\n        \n        if (!isFrom && !isTo){\n            console.warn(\"No data passed to showConnectionMenu\");\n            return false;\n        }\n        \n        var nodeX = isFrom ? opts.nodeFrom : opts.nodeTo;\n        var slotX = isFrom ? opts.slotFrom : opts.slotTo;\n        \n        var iSlotConn = false;\n        switch (typeof slotX){\n            case \"string\":\n                iSlotConn = isFrom ? nodeX.findOutputSlot(slotX,false) : nodeX.findInputSlot(slotX,false);\n                slotX = isFrom ? nodeX.outputs[slotX] : nodeX.inputs[slotX];\n            break;\n            case \"object\":\n                // ok slotX\n                iSlotConn = isFrom ? nodeX.findOutputSlot(slotX.name) : nodeX.findInputSlot(slotX.name);\n            break;\n            case \"number\":\n                iSlotConn = slotX;\n                slotX = isFrom ? nodeX.outputs[slotX] : nodeX.inputs[slotX];\n            break;\n            default:\n                // bad ?\n                //iSlotConn = 0;\n                console.warn(\"Cant get slot information \"+slotX);\n                return false;\n        }\n            \n\t\tvar options = [\"Add Node\",null];\n\t\t\n\t\tif (that.allow_searchbox){\n\t\t\toptions.push(\"Search\");\n\t\t\toptions.push(null);\n\t\t}\n\t\t\n\t\t// get defaults nodes for this slottype\n\t\tvar fromSlotType = slotX.type==LiteGraph.EVENT?\"_event_\":slotX.type;\n\t\tvar slotTypesDefault = isFrom ? LiteGraph.slot_types_default_out : LiteGraph.slot_types_default_in;\n\t\tif(slotTypesDefault && slotTypesDefault[fromSlotType]){\n\t\t\tif(typeof slotTypesDefault[fromSlotType] == \"object\" || typeof slotTypesDefault[fromSlotType] == \"array\"){\n\t\t\t\tfor(var typeX in slotTypesDefault[fromSlotType]){\n\t\t\t\t\toptions.push(slotTypesDefault[fromSlotType][typeX]);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\toptions.push(slotTypesDefault[fromSlotType]);\n\t\t\t}\n\t\t}\n\t\t\n\t\t// build menu\n        var menu = new LiteGraph.ContextMenu(options, {\n            event: opts.e,\n\t\t\ttitle: (slotX && slotX.name!=\"\" ? (slotX.name + (fromSlotType?\" | \":\"\")) : \"\")+(slotX && fromSlotType ? fromSlotType : \"\"),\n            callback: inner_clicked\n        });\n        \n\t\t// callback\n        function inner_clicked(v,options,e) {\n            //console.log(\"Process showConnectionMenu selection\");\n            switch (v) {\n                case \"Add Node\":\n                    LGraphCanvas.onMenuAdd(null, null, e, menu, function(node){\n                        if (isFrom){\n                            opts.nodeFrom.connectByType( iSlotConn, node, fromSlotType );\n                        }else{\n                            opts.nodeTo.connectByTypeOutput( iSlotConn, node, fromSlotType );\n                        }\n                    });\n                    break;\n\t\t\t\tcase \"Search\":\n\t\t\t\t\tif(isFrom){\n\t\t\t\t\t\tthat.showSearchBox(e,{node_from: opts.nodeFrom, slot_from: slotX, type_filter_in: fromSlotType});\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthat.showSearchBox(e,{node_to: opts.nodeTo, slot_from: slotX, type_filter_out: fromSlotType});\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n                default:\n\t\t\t\t\t// check for defaults nodes for this slottype\n\t\t\t\t\tvar nodeCreated = that.createDefaultNodeForSlot(Object.assign(opts,{ position: [opts.e.canvasX, opts.e.canvasY]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,nodeType: v\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}));\n\t\t\t\t\tif (nodeCreated){\n\t\t\t\t\t\t// new node created\n\t\t\t\t\t\t//console.log(\"node \"+v+\" created\")\n\t\t\t\t\t}else{\n\t\t\t\t\t\t// failed or v is not in defaults\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n            }\n        }   \n        \n        return false;\n    };\n\n    // TODO refactor :: this is used fot title but not for properties!\n    LGraphCanvas.onShowPropertyEditor = function(item, options, e, menu, node) {\n        var input_html = \"\";\n        var property = item.property || \"title\";\n        var value = node[property];\n\n        // TODO refactor :: use createDialog ?\n        \n        var dialog = document.createElement(\"div\");\n        dialog.is_modified = false;\n        dialog.className = \"graphdialog\";\n        dialog.innerHTML =\n            \"<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>\";\n        dialog.close = function() {\n            if (dialog.parentNode) {\n                dialog.parentNode.removeChild(dialog);\n            }\n        };\n        var title = dialog.querySelector(\".name\");\n        title.innerText = property;\n        var input = dialog.querySelector(\".value\");\n        if (input) {\n            input.value = value;\n            input.addEventListener(\"blur\", function(e) {\n                this.focus();\n            });\n            input.addEventListener(\"keydown\", function(e) {\n                dialog.is_modified = true;\n                if (e.keyCode == 27) {\n                    //ESC\n                    dialog.close();\n                } else if (e.keyCode == 13) {\n                    inner(); // save\n                } else if (e.keyCode != 13 && e.target.localName != \"textarea\") {\n                    return;\n                }\n                e.preventDefault();\n                e.stopPropagation();\n            });\n        }\n\n        var graphcanvas = LGraphCanvas.active_canvas;\n        var canvas = graphcanvas.canvas;\n\n        var rect = canvas.getBoundingClientRect();\n        var offsetx = -20;\n        var offsety = -20;\n        if (rect) {\n            offsetx -= rect.left;\n            offsety -= rect.top;\n        }\n\n        if (event) {\n            dialog.style.left = event.clientX + offsetx + \"px\";\n            dialog.style.top = event.clientY + offsety + \"px\";\n        } else {\n            dialog.style.left = canvas.width * 0.5 + offsetx + \"px\";\n            dialog.style.top = canvas.height * 0.5 + offsety + \"px\";\n        }\n\n        var button = dialog.querySelector(\"button\");\n        button.addEventListener(\"click\", inner);\n        canvas.parentNode.appendChild(dialog);\n\n        if(input) input.focus();\n        \n        var dialogCloseTimer = null;\n        dialog.addEventListener(\"mouseleave\", function(e) {\n            if(LiteGraph.dialog_close_on_mouse_leave)\n                if (!dialog.is_modified && LiteGraph.dialog_close_on_mouse_leave)\n                    dialogCloseTimer = setTimeout(dialog.close, LiteGraph.dialog_close_on_mouse_leave_delay); //dialog.close();\n        });\n        dialog.addEventListener(\"mouseenter\", function(e) {\n            if(LiteGraph.dialog_close_on_mouse_leave)\n                if(dialogCloseTimer) clearTimeout(dialogCloseTimer);\n        });\n        \n        function inner() {\n            if(input) setValue(input.value);\n        }\n\n        function setValue(value) {\n            if (item.type == \"Number\") {\n                value = Number(value);\n            } else if (item.type == \"Boolean\") {\n                value = Boolean(value);\n            }\n            node[property] = value;\n            if (dialog.parentNode) {\n                dialog.parentNode.removeChild(dialog);\n            }\n            node.setDirtyCanvas(true, true);\n        }\n    };\n\n    // refactor: there are different dialogs, some uses createDialog some dont\n    LGraphCanvas.prototype.prompt = function(title, value, callback, event, multiline) {\n        var that = this;\n        var input_html = \"\";\n        title = title || \"\";\n\n        var dialog = document.createElement(\"div\");\n        dialog.is_modified = false;\n        dialog.className = \"graphdialog rounded\";\n        if(multiline)\n\t        dialog.innerHTML = \"<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>\";\n\t\telse\n        \tdialog.innerHTML = \"<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>\";\n        dialog.close = function() {\n            that.prompt_box = null;\n            if (dialog.parentNode) {\n                dialog.parentNode.removeChild(dialog);\n            }\n        };\n\n        var graphcanvas = LGraphCanvas.active_canvas;\n        var canvas = graphcanvas.canvas;\n        canvas.parentNode.appendChild(dialog);\n        \n        if (this.ds.scale > 1) {\n            dialog.style.transform = \"scale(\" + this.ds.scale + \")\";\n        }\n\n        var dialogCloseTimer = null;\n        var prevent_timeout = false;\n        LiteGraph.pointerListenerAdd(dialog,\"leave\", function(e) {\n            if (prevent_timeout)\n                return;\n            if(LiteGraph.dialog_close_on_mouse_leave)\n                if (!dialog.is_modified && LiteGraph.dialog_close_on_mouse_leave)\n                    dialogCloseTimer = setTimeout(dialog.close, LiteGraph.dialog_close_on_mouse_leave_delay); //dialog.close();\n        });\n        LiteGraph.pointerListenerAdd(dialog,\"enter\", function(e) {\n            if(LiteGraph.dialog_close_on_mouse_leave)\n                if(dialogCloseTimer) clearTimeout(dialogCloseTimer);\n        });\n        var selInDia = dialog.querySelectorAll(\"select\");\n        if (selInDia){\n            // if filtering, check focus changed to comboboxes and prevent closing\n            selInDia.forEach(function(selIn) {\n                selIn.addEventListener(\"click\", function(e) {\n                    prevent_timeout++;\n                });\n                selIn.addEventListener(\"blur\", function(e) {\n                   prevent_timeout = 0;\n                });\n                selIn.addEventListener(\"change\", function(e) {\n                    prevent_timeout = -1;\n                });\n            });\n        }\n\n        if (that.prompt_box) {\n            that.prompt_box.close();\n        }\n        that.prompt_box = dialog;\n\n        var first = null;\n        var timeout = null;\n        var selected = null;\n\n        var name_element = dialog.querySelector(\".name\");\n        name_element.innerText = title;\n        var value_element = dialog.querySelector(\".value\");\n        value_element.value = value;\n\n        var input = value_element;\n        input.addEventListener(\"keydown\", function(e) {\n            dialog.is_modified = true;\n            if (e.keyCode == 27) {\n                //ESC\n                dialog.close();\n            } else if (e.keyCode == 13 && e.target.localName != \"textarea\") {\n                if (callback) {\n                    callback(this.value);\n                }\n                dialog.close();\n            } else {\n                return;\n            }\n            e.preventDefault();\n            e.stopPropagation();\n        });\n\n        var button = dialog.querySelector(\"button\");\n        button.addEventListener(\"click\", function(e) {\n            if (callback) {\n                callback(input.value);\n            }\n            that.setDirty(true);\n            dialog.close();\n        });\n\n        var rect = canvas.getBoundingClientRect();\n        var offsetx = -20;\n        var offsety = -20;\n        if (rect) {\n            offsetx -= rect.left;\n            offsety -= rect.top;\n        }\n\n        if (event) {\n            dialog.style.left = event.clientX + offsetx + \"px\";\n            dialog.style.top = event.clientY + offsety + \"px\";\n        } else {\n            dialog.style.left = canvas.width * 0.5 + offsetx + \"px\";\n            dialog.style.top = canvas.height * 0.5 + offsety + \"px\";\n        }\n\n        setTimeout(function() {\n            input.focus();\n        }, 10);\n\n        return dialog;\n    };\n\n    LGraphCanvas.search_limit = -1;\n    LGraphCanvas.prototype.showSearchBox = function(event, options) {\n        // proposed defaults\n        var def_options = { slot_from: null\n                        ,node_from: null\n                        ,node_to: null\n                        ,do_type_filter: LiteGraph.search_filter_enabled // TODO check for registered_slot_[in/out]_types not empty // this will be checked for functionality enabled : filter on slot type, in and out\n                        ,type_filter_in: false                          // these are default: pass to set initially set values\n                        ,type_filter_out: false\n                        ,show_general_if_none_on_typefilter: true\n                        ,show_general_after_typefiltered: true\n                        ,hide_on_mouse_leave: LiteGraph.search_hide_on_mouse_leave\n                        ,show_all_if_empty: true\n                        ,show_all_on_open: LiteGraph.search_show_all_on_open\n                    };\n        options = Object.assign(def_options, options || {});\n        \n\t\t//console.log(options);\n\t\t\n        var that = this;\n        var input_html = \"\";\n        var graphcanvas = LGraphCanvas.active_canvas;\n        var canvas = graphcanvas.canvas;\n        var root_document = canvas.ownerDocument || document;\n\n        var dialog = document.createElement(\"div\");\n        dialog.className = \"litegraph litesearchbox graphdialog rounded\";\n        dialog.innerHTML = \"<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>\";\n        if (options.do_type_filter){\n            dialog.innerHTML += \"<select class='slot_in_type_filter'><option value=''></option></select>\";\n            dialog.innerHTML += \"<select class='slot_out_type_filter'><option value=''></option></select>\";\n        }\n        dialog.innerHTML += \"<div class='helper'></div>\";\n        \n        if( root_document.fullscreenElement )\n\t        root_document.fullscreenElement.appendChild(dialog);\n\t\telse\n\t\t{\n\t\t    root_document.body.appendChild(dialog);\n\t\t\troot_document.body.style.overflow = \"hidden\";\n\t\t}\n        // dialog element has been appended\n        \n        if (options.do_type_filter){\n            var selIn = dialog.querySelector(\".slot_in_type_filter\");\n            var selOut = dialog.querySelector(\".slot_out_type_filter\");\n        }\n        \n        dialog.close = function() {\n            that.search_box = null;\n\t\t\tthis.blur();\n            canvas.focus();\n\t\t\troot_document.body.style.overflow = \"\";\n\n            setTimeout(function() {\n                that.canvas.focus();\n            }, 20); //important, if canvas loses focus keys wont be captured\n            if (dialog.parentNode) {\n                dialog.parentNode.removeChild(dialog);\n            }\n        };\n\n        if (this.ds.scale > 1) {\n            dialog.style.transform = \"scale(\" + this.ds.scale + \")\";\n        }\n\n        // hide on mouse leave\n        if(options.hide_on_mouse_leave){\n            var prevent_timeout = false;\n            var timeout_close = null;\n            LiteGraph.pointerListenerAdd(dialog,\"enter\", function(e) {\n                if (timeout_close) {\n                    clearTimeout(timeout_close);\n                    timeout_close = null;\n                }\n            });\n            LiteGraph.pointerListenerAdd(dialog,\"leave\", function(e) {\n                if (prevent_timeout){\n                    return;\n                }\n                timeout_close = setTimeout(function() {\n                    dialog.close();\n                }, 500);\n            });\n            // if filtering, check focus changed to comboboxes and prevent closing\n            if (options.do_type_filter){\n                selIn.addEventListener(\"click\", function(e) {\n                    prevent_timeout++;\n                });\n                selIn.addEventListener(\"blur\", function(e) {\n                   prevent_timeout = 0;\n                });\n                selIn.addEventListener(\"change\", function(e) {\n                    prevent_timeout = -1;\n                });\n                selOut.addEventListener(\"click\", function(e) {\n                    prevent_timeout++;\n                });\n                selOut.addEventListener(\"blur\", function(e) {\n                   prevent_timeout = 0;\n                });\n                selOut.addEventListener(\"change\", function(e) {\n                    prevent_timeout = -1;\n                });\n            }\n        }\n\n        if (that.search_box) {\n            that.search_box.close();\n        }\n        that.search_box = dialog;\n\n        var helper = dialog.querySelector(\".helper\");\n\n        var first = null;\n        var timeout = null;\n        var selected = null;\n\n        var input = dialog.querySelector(\"input\");\n        if (input) {\n            input.addEventListener(\"blur\", function(e) {\n                if(that.search_box)\n                    this.focus();\n            });\n            input.addEventListener(\"keydown\", function(e) {\n                if (e.keyCode == 38) {\n                    //UP\n                    changeSelection(false);\n                } else if (e.keyCode == 40) {\n                    //DOWN\n                    changeSelection(true);\n                } else if (e.keyCode == 27) {\n                    //ESC\n                    dialog.close();\n                } else if (e.keyCode == 13) {\n                    refreshHelper();\n                    if (selected) {\n                        select(selected.innerHTML);\n                    } else if (first) {\n                        select(first);\n                    } else {\n                        dialog.close();\n                    }\n                } else {\n                    if (timeout) {\n                        clearInterval(timeout);\n                    }\n                    timeout = setTimeout(refreshHelper, 250);\n                    return;\n                }\n                e.preventDefault();\n                e.stopPropagation();\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\treturn true;\n            });\n        }\n        \n        // if should filter on type, load and fill selected and choose elements if passed\n        if (options.do_type_filter){\n            if (selIn){\n                var aSlots = LiteGraph.slot_types_in;\n                var nSlots = aSlots.length; // this for object :: Object.keys(aSlots).length;\n                \n                if (options.type_filter_in == LiteGraph.EVENT || options.type_filter_in == LiteGraph.ACTION)\n                    options.type_filter_in = \"_event_\";\n                /* this will filter on * .. but better do it manually in case\n                else if(options.type_filter_in === \"\" || options.type_filter_in === 0)\n                    options.type_filter_in = \"*\";*/\n                \n                for (var iK=0; iK<nSlots; iK++){\n                    var opt = document.createElement('option');\n                    opt.value = aSlots[iK];\n                    opt.innerHTML = aSlots[iK];\n                    selIn.appendChild(opt);\n                    if(options.type_filter_in !==false && (options.type_filter_in+\"\").toLowerCase() == (aSlots[iK]+\"\").toLowerCase()){\n                        //selIn.selectedIndex ..\n                        opt.selected = true;\n\t\t\t\t\t\t//console.log(\"comparing IN \"+options.type_filter_in+\" :: \"+aSlots[iK]);\n\t                }else{\n\t\t\t\t\t\t//console.log(\"comparing OUT \"+options.type_filter_in+\" :: \"+aSlots[iK]);\n\t\t\t\t\t}\n\t\t\t\t}\n                selIn.addEventListener(\"change\",function(){\n                    refreshHelper();\n                });\n            }\n            if (selOut){\n                var aSlots = LiteGraph.slot_types_out;\n                var nSlots = aSlots.length; // this for object :: Object.keys(aSlots).length; \n                \n                if (options.type_filter_out == LiteGraph.EVENT || options.type_filter_out == LiteGraph.ACTION)\n                    options.type_filter_out = \"_event_\";\n                /* this will filter on * .. but better do it manually in case\n                else if(options.type_filter_out === \"\" || options.type_filter_out === 0)\n                    options.type_filter_out = \"*\";*/\n                \n                for (var iK=0; iK<nSlots; iK++){\n                    var opt = document.createElement('option');\n                    opt.value = aSlots[iK];\n                    opt.innerHTML = aSlots[iK];\n                    selOut.appendChild(opt);\n                    if(options.type_filter_out !==false && (options.type_filter_out+\"\").toLowerCase() == (aSlots[iK]+\"\").toLowerCase()){\n                        //selOut.selectedIndex ..\n                        opt.selected = true;\n                    }\n                }\n                selOut.addEventListener(\"change\",function(){\n                    refreshHelper();\n                });\n            }\n        }\n        \n        //compute best position\n        var rect = canvas.getBoundingClientRect();\n\n        var left = ( event ? event.clientX : (rect.left + rect.width * 0.5) ) - 80;\n        var top = ( event ? event.clientY : (rect.top + rect.height * 0.5) ) - 20;\n        dialog.style.left = left + \"px\";\n        dialog.style.top = top + \"px\";\n\n\t\t//To avoid out of screen problems\n\t\tif(event.layerY > (rect.height - 200)) \n            helper.style.maxHeight = (rect.height - event.layerY - 20) + \"px\";\n\n\t\t/*\n        var offsetx = -20;\n        var offsety = -20;\n        if (rect) {\n            offsetx -= rect.left;\n            offsety -= rect.top;\n        }\n\n        if (event) {\n            dialog.style.left = event.clientX + offsetx + \"px\";\n            dialog.style.top = event.clientY + offsety + \"px\";\n        } else {\n            dialog.style.left = canvas.width * 0.5 + offsetx + \"px\";\n            dialog.style.top = canvas.height * 0.5 + offsety + \"px\";\n        }\n        canvas.parentNode.appendChild(dialog);\n\t\t*/\n\n        input.focus();\n        if (options.show_all_on_open) refreshHelper();\n\n        function select(name) {\n            if (name) {\n                if (that.onSearchBoxSelection) {\n                    that.onSearchBoxSelection(name, event, graphcanvas);\n                } else {\n                    var extra = LiteGraph.searchbox_extras[name.toLowerCase()];\n                    if (extra) {\n                        name = extra.type;\n                    }\n\n\t\t\t\t\tgraphcanvas.graph.beforeChange();\n                    var node = LiteGraph.createNode(name);\n                    if (node) {\n                        node.pos = graphcanvas.convertEventToCanvasOffset(\n                            event\n                        );\n                        graphcanvas.graph.add(node, false);\n                    }\n\n                    if (extra && extra.data) {\n                        if (extra.data.properties) {\n                            for (var i in extra.data.properties) {\n                                node.addProperty( i, extra.data.properties[i] );\n                            }\n                        }\n                        if (extra.data.inputs) {\n                            node.inputs = [];\n                            for (var i in extra.data.inputs) {\n                                node.addOutput(\n                                    extra.data.inputs[i][0],\n                                    extra.data.inputs[i][1]\n                                );\n                            }\n                        }\n                        if (extra.data.outputs) {\n                            node.outputs = [];\n                            for (var i in extra.data.outputs) {\n                                node.addOutput(\n                                    extra.data.outputs[i][0],\n                                    extra.data.outputs[i][1]\n                                );\n                            }\n                        }\n                        if (extra.data.title) {\n                            node.title = extra.data.title;\n                        }\n                        if (extra.data.json) {\n                            node.configure(extra.data.json);\n                        }\n\n                    }\n\n                    // join node after inserting\n                    if (options.node_from){\n                        var iS = false;\n                        switch (typeof options.slot_from){\n                            case \"string\":\n                                iS = options.node_from.findOutputSlot(options.slot_from);    \n                            break;\n                            case \"object\":\n                                if (options.slot_from.name){\n                                    iS = options.node_from.findOutputSlot(options.slot_from.name);\n                                }else{\n                                    iS = -1;\n                                }\n                                if (iS==-1 && typeof options.slot_from.slot_index !== \"undefined\") iS = options.slot_from.slot_index;\n                            break;\n                            case \"number\":\n                                iS = options.slot_from;\n                            break;\n                            default:\n                                iS = 0; // try with first if no name set\n                        }\n                        if (typeof options.node_from.outputs[iS] !== \"undefined\"){\n                            if (iS!==false && iS>-1){\n                                options.node_from.connectByType( iS, node, options.node_from.outputs[iS].type );\n                            }\n                        }else{\n                            // console.warn(\"cant find slot \" + options.slot_from);\n                        }\n                    }\n                    if (options.node_to){\n                        var iS = false;\n                        switch (typeof options.slot_from){\n                            case \"string\":\n                                iS = options.node_to.findInputSlot(options.slot_from);    \n                            break;\n                            case \"object\":\n                                if (options.slot_from.name){\n                                    iS = options.node_to.findInputSlot(options.slot_from.name);\n                                }else{\n                                    iS = -1;\n                                }\n                                if (iS==-1 && typeof options.slot_from.slot_index !== \"undefined\") iS = options.slot_from.slot_index;\n                            break;\n                            case \"number\":\n                                iS = options.slot_from;\n                            break;\n                            default:\n                                iS = 0; // try with first if no name set\n                        }\n                        if (typeof options.node_to.inputs[iS] !== \"undefined\"){\n                            if (iS!==false && iS>-1){\n                                // try connection\n                                options.node_to.connectByTypeOutput(iS,node,options.node_to.inputs[iS].type);\n                            }\n                        }else{\n                            // console.warn(\"cant find slot_nodeTO \" + options.slot_from);\n                        }\n                    }\n                    \n                    graphcanvas.graph.afterChange();\n                }\n            }\n\n            dialog.close();\n        }\n\n        function changeSelection(forward) {\n            var prev = selected;\n            if (selected) {\n                selected.classList.remove(\"selected\");\n            }\n            if (!selected) {\n                selected = forward\n                    ? helper.childNodes[0]\n                    : helper.childNodes[helper.childNodes.length];\n            } else {\n                selected = forward\n                    ? selected.nextSibling\n                    : selected.previousSibling;\n                if (!selected) {\n                    selected = prev;\n                }\n            }\n            if (!selected) {\n                return;\n            }\n            selected.classList.add(\"selected\");\n            selected.scrollIntoView({block: \"end\", behavior: \"smooth\"});\n        }\n\n        function refreshHelper() {\n            timeout = null;\n            var str = input.value;\n            first = null;\n            helper.innerHTML = \"\";\n            if (!str && !options.show_all_if_empty) {\n                return;\n            }\n\n            if (that.onSearchBox) {\n                var list = that.onSearchBox(helper, str, graphcanvas);\n                if (list) {\n                    for (var i = 0; i < list.length; ++i) {\n                        addResult(list[i]);\n                    }\n                }\n            } else {\n                var c = 0;\n                str = str.toLowerCase();\n\t\t\t\tvar filter = graphcanvas.filter || graphcanvas.graph.filter;\n\n                // filter by type preprocess\n                if(options.do_type_filter && that.search_box){\n                    var sIn = that.search_box.querySelector(\".slot_in_type_filter\");\n                    var sOut = that.search_box.querySelector(\".slot_out_type_filter\");\n                }else{\n                    var sIn = false;\n                    var sOut = false;\n                }\n                \n                //extras\n                for (var i in LiteGraph.searchbox_extras) {\n                    var extra = LiteGraph.searchbox_extras[i];\n                    if ((!options.show_all_if_empty || str) && extra.desc.toLowerCase().indexOf(str) === -1) {\n                        continue;\n                    }\n\t\t\t\t\tvar ctor = LiteGraph.registered_node_types[ extra.type ];\n\t\t\t\t\tif( ctor && ctor.filter != filter )\n\t\t\t\t\t\tcontinue;\n                    if( ! inner_test_filter(extra.type) )\n                        continue;\n                    addResult( extra.desc, \"searchbox_extra\" );\n                    if ( LGraphCanvas.search_limit !== -1 && c++ > LGraphCanvas.search_limit ) {\n                        break;\n                    }\n                }\n\n\t\t\t\tvar filtered = null;\n                if (Array.prototype.filter) { //filter supported\n                    var keys = Object.keys( LiteGraph.registered_node_types ); //types\n                    var filtered = keys.filter( inner_test_filter );\n                } else {\n\t\t\t\t\tfiltered = [];\n                    for (var i in LiteGraph.registered_node_types) {\n\t\t\t\t\t\tif( inner_test_filter(i) )\n\t\t\t\t\t\t\tfiltered.push(i);\n                    }\n                }\n\n\t\t\t\tfor (var i = 0; i < filtered.length; i++) {\n\t\t\t\t\taddResult(filtered[i]);\n\t\t\t\t\tif ( LGraphCanvas.search_limit !== -1 && c++ > LGraphCanvas.search_limit ) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n                \n                // add general type if filtering\n                if (options.show_general_after_typefiltered\n                    && (sIn.value || sOut.value) \n                ){\n                    filtered_extra = [];\n                    for (var i in LiteGraph.registered_node_types) {\n\t\t\t\t\t\tif( inner_test_filter(i, {inTypeOverride: sIn&&sIn.value?\"*\":false, outTypeOverride: sOut&&sOut.value?\"*\":false}) )\n\t\t\t\t\t\t\tfiltered_extra.push(i);\n                    }\n                    for (var i = 0; i < filtered_extra.length; i++) {\n                        addResult(filtered_extra[i], \"generic_type\");\n                        if ( LGraphCanvas.search_limit !== -1 && c++ > LGraphCanvas.search_limit ) {\n                            break;\n                        }\n                    }\n                }\n                \n                // check il filtering gave no results\n                if ((sIn.value || sOut.value) && \n                    ( (helper.childNodes.length == 0 && options.show_general_if_none_on_typefilter) )\n                ){\n                    filtered_extra = [];\n                    for (var i in LiteGraph.registered_node_types) {\n\t\t\t\t\t\tif( inner_test_filter(i, {skipFilter: true}) )\n\t\t\t\t\t\t\tfiltered_extra.push(i);\n                    }\n                    for (var i = 0; i < filtered_extra.length; i++) {\n                        addResult(filtered_extra[i], \"not_in_filter\");\n                        if ( LGraphCanvas.search_limit !== -1 && c++ > LGraphCanvas.search_limit ) {\n                            break;\n                        }\n                    }\n                }\n                \n\t\t\t\tfunction inner_test_filter( type, optsIn )\n\t\t\t\t{\n                    var optsIn = optsIn || {};\n                    var optsDef = { skipFilter: false\n                                    ,inTypeOverride: false\n                                    ,outTypeOverride: false\n                                  };\n                    var opts = Object.assign(optsDef,optsIn);\n\t\t\t\t\tvar ctor = LiteGraph.registered_node_types[ type ];\n\t\t\t\t\tif(filter && ctor.filter != filter )\n\t\t\t\t\t\treturn false;\n                    if ((!options.show_all_if_empty || str) && type.toLowerCase().indexOf(str) === -1)\n                        return false;\n                    \n                    // filter by slot IN, OUT types\n                    if(options.do_type_filter && !opts.skipFilter){\n                        var sType = type;\n                        \n                        var sV = sIn.value;\n                        if (opts.inTypeOverride!==false) sV = opts.inTypeOverride;\n\t\t\t\t\t\t//if (sV.toLowerCase() == \"_event_\") sV = LiteGraph.EVENT; // -1\n                        \n                        if(sIn && sV){\n                            //console.log(\"will check filter against \"+sV);\n                            if (LiteGraph.registered_slot_in_types[sV] && LiteGraph.registered_slot_in_types[sV].nodes){ // type is stored\n                                //console.debug(\"check \"+sType+\" in \"+LiteGraph.registered_slot_in_types[sV].nodes);\n                                var doesInc = LiteGraph.registered_slot_in_types[sV].nodes.includes(sType);\n                                if (doesInc!==false){\n                                    //console.log(sType+\" HAS \"+sV);\n                                }else{\n                                    /*console.debug(LiteGraph.registered_slot_in_types[sV]);\n                                    console.log(+\" DONT includes \"+type);*/\n                                    return false;\n                                }\n                            }\n                        }\n                        \n                        var sV = sOut.value;\n                        if (opts.outTypeOverride!==false) sV = opts.outTypeOverride;\n                        //if (sV.toLowerCase() == \"_event_\") sV = LiteGraph.EVENT; // -1\n                        \n                        if(sOut && sV){\n                            //console.log(\"search will check filter against \"+sV);\n                            if (LiteGraph.registered_slot_out_types[sV] && LiteGraph.registered_slot_out_types[sV].nodes){ // type is stored\n                                //console.debug(\"check \"+sType+\" in \"+LiteGraph.registered_slot_out_types[sV].nodes);\n                                var doesInc = LiteGraph.registered_slot_out_types[sV].nodes.includes(sType);\n                                if (doesInc!==false){\n                                    //console.log(sType+\" HAS \"+sV);\n                                }else{\n                                    /*console.debug(LiteGraph.registered_slot_out_types[sV]);\n                                    console.log(+\" DONT includes \"+type);*/\n                                    return false;\n                                }\n                            }\n                        }\n                    }\n                    return true;\n\t\t\t\t}\n            }\n\n            function addResult(type, className) {\n                var help = document.createElement(\"div\");\n                if (!first) {\n                    first = type;\n                }\n                help.innerText = type;\n                help.dataset[\"type\"] = escape(type);\n                help.className = \"litegraph lite-search-item\";\n                if (className) {\n                    help.className += \" \" + className;\n                }\n                help.addEventListener(\"click\", function(e) {\n                    select(unescape(this.dataset[\"type\"]));\n                });\n                helper.appendChild(help);\n            }\n        }\n\n        return dialog;\n    };\n\n    LGraphCanvas.prototype.showEditPropertyValue = function( node, property, options ) {\n        if (!node || node.properties[property] === undefined) {\n            return;\n        }\n\n        options = options || {};\n        var that = this;\n\n        var info = node.getPropertyInfo(property);\n\t\tvar type = info.type;\n\n        var input_html = \"\";\n\n        if (type == \"string\" || type == \"number\" || type == \"array\" || type == \"object\") {\n            input_html = \"<input autofocus type='text' class='value'/>\";\n        } else if ( (type == \"enum\" || type == \"combo\") && info.values) {\n            input_html = \"<select autofocus type='text' class='value'>\";\n            for (var i in info.values) {\n                var v = i;\n\t\t\t\tif( info.values.constructor === Array )\n\t\t\t\t\tv = info.values[i];\n\n                input_html +=\n                    \"<option value='\" +\n                    v +\n                    \"' \" +\n                    (v == node.properties[property] ? \"selected\" : \"\") +\n                    \">\" +\n                    info.values[i] +\n                    \"</option>\";\n            }\n            input_html += \"</select>\";\n        } else if (type == \"boolean\" || type == \"toggle\") {\n            input_html =\n                \"<input autofocus type='checkbox' class='value' \" +\n                (node.properties[property] ? \"checked\" : \"\") +\n                \"/>\";\n        } else {\n            console.warn(\"unknown type: \" + type);\n            return;\n        }\n\n        var dialog = this.createDialog(\n            \"<span class='name'>\" +\n                (info.label ? info.label : property) +\n                \"</span>\" +\n                input_html +\n                \"<button>OK</button>\",\n            options\n        );\n\n        var input = false;\n        if ((type == \"enum\" || type == \"combo\") && info.values) {\n            input = dialog.querySelector(\"select\");\n            input.addEventListener(\"change\", function(e) {\n                dialog.modified();\n                setValue(e.target.value);\n                //var index = e.target.value;\n                //setValue( e.options[e.selectedIndex].value );\n            });\n        } else if (type == \"boolean\" || type == \"toggle\") {\n            input = dialog.querySelector(\"input\");\n            if (input) {\n                input.addEventListener(\"click\", function(e) {\n                    dialog.modified();\n                    setValue(!!input.checked);\n                });\n            }\n        } else {\n            input = dialog.querySelector(\"input\");\n            if (input) {\n                input.addEventListener(\"blur\", function(e) {\n                    this.focus();\n                });\n\n\t\t\t\tvar v = node.properties[property] !== undefined ? node.properties[property] : \"\";\n\t\t\t\tif (type !== 'string') {\n                    v = JSON.stringify(v);\n                }\n\n                input.value = v;\n                input.addEventListener(\"keydown\", function(e) {\n                    if (e.keyCode == 27) {\n                        //ESC\n                        dialog.close();\n                    } else if (e.keyCode == 13) {\n                        // ENTER\n                        inner(); // save\n                    } else if (e.keyCode != 13) {\n                        dialog.modified();\n                        return;\n                    }\n                    e.preventDefault();\n                    e.stopPropagation();\n                });\n            }\n        }\n        if (input) input.focus();\n\n        var button = dialog.querySelector(\"button\");\n        button.addEventListener(\"click\", inner);\n\n        function inner() {\n            setValue(input.value);\n        }\n\n        function setValue(value) {\n\n\t\t\tif(info && info.values && info.values.constructor === Object && info.values[value] != undefined )\n\t\t\t\tvalue = info.values[value];\n\n            if (typeof node.properties[property] == \"number\") {\n                value = Number(value);\n            }\n            if (type == \"array\" || type == \"object\") {\n                value = JSON.parse(value);\n            }\n            node.properties[property] = value;\n            if (node.graph) {\n                node.graph._version++;\n            }\n            if (node.onPropertyChanged) {\n                node.onPropertyChanged(property, value);\n            }\n\t\t\tif(options.onclose)\n\t\t\t\toptions.onclose();\n            dialog.close();\n            node.setDirtyCanvas(true, true);\n        }\n\n\t\treturn dialog;\n    };\n\n    // TODO refactor, theer are different dialog, some uses createDialog, some dont\n    LGraphCanvas.prototype.createDialog = function(html, options) {\n        var def_options = { checkForInput: false, closeOnLeave: true, closeOnLeave_checkModified: true };\n        options = Object.assign(def_options, options || {});\n\n        var dialog = document.createElement(\"div\");\n        dialog.className = \"graphdialog\";\n        dialog.innerHTML = html;\n        dialog.is_modified = false;\n\n        var rect = this.canvas.getBoundingClientRect();\n        var offsetx = -20;\n        var offsety = -20;\n        if (rect) {\n            offsetx -= rect.left;\n            offsety -= rect.top;\n        }\n\n        if (options.position) {\n            offsetx += options.position[0];\n            offsety += options.position[1];\n        } else if (options.event) {\n            offsetx += options.event.clientX;\n            offsety += options.event.clientY;\n        } //centered\n        else {\n            offsetx += this.canvas.width * 0.5;\n            offsety += this.canvas.height * 0.5;\n        }\n\n        dialog.style.left = offsetx + \"px\";\n        dialog.style.top = offsety + \"px\";\n\n        this.canvas.parentNode.appendChild(dialog);\n        \n        // acheck for input and use default behaviour: save on enter, close on esc\n        if (options.checkForInput){\n            var aI = [];\n            var focused = false;\n            if (aI = dialog.querySelectorAll(\"input\")){\n                aI.forEach(function(iX) {\n                    iX.addEventListener(\"keydown\",function(e){\n                        dialog.modified();\n                        if (e.keyCode == 27) {\n                            dialog.close();\n                        } else if (e.keyCode != 13) {\n                            return;\n                        }\n                        // set value ?\n                        e.preventDefault();\n                        e.stopPropagation();\n                    });\n                    if (!focused) iX.focus();\n                });\n            }\n        }\n        \n        dialog.modified = function(){\n            dialog.is_modified = true;\n        }\n        dialog.close = function() {\n            if (dialog.parentNode) {\n                dialog.parentNode.removeChild(dialog);\n            }\n        };\n        \n        var dialogCloseTimer = null;\n        var prevent_timeout = false;\n        dialog.addEventListener(\"mouseleave\", function(e) {\n            if (prevent_timeout)\n                return;\n            if(options.closeOnLeave || LiteGraph.dialog_close_on_mouse_leave)\n                if (!dialog.is_modified && LiteGraph.dialog_close_on_mouse_leave)\n                    dialogCloseTimer = setTimeout(dialog.close, LiteGraph.dialog_close_on_mouse_leave_delay); //dialog.close();\n        });\n        dialog.addEventListener(\"mouseenter\", function(e) {\n            if(options.closeOnLeave || LiteGraph.dialog_close_on_mouse_leave)\n                if(dialogCloseTimer) clearTimeout(dialogCloseTimer);\n        });\n        var selInDia = dialog.querySelectorAll(\"select\");\n        if (selInDia){\n            // if filtering, check focus changed to comboboxes and prevent closing\n            selInDia.forEach(function(selIn) {\n                selIn.addEventListener(\"click\", function(e) {\n                    prevent_timeout++;\n                });\n                selIn.addEventListener(\"blur\", function(e) {\n                   prevent_timeout = 0;\n                });\n                selIn.addEventListener(\"change\", function(e) {\n                    prevent_timeout = -1;\n                });\n            });\n        }\n\n        return dialog;\n    };\n\n\tLGraphCanvas.prototype.createPanel = function(title, options) {\n\t\toptions = options || {};\n\n\t\tvar ref_window = options.window || window;\n\t\tvar root = document.createElement(\"div\");\n\t\troot.className = \"litegraph dialog\";\n\t\troot.innerHTML = \"<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>\";\n\t\troot.header = root.querySelector(\".dialog-header\");\n\n\t\tif(options.width)\n\t\t\troot.style.width = options.width + (options.width.constructor === Number ? \"px\" : \"\");\n\t\tif(options.height)\n\t\t\troot.style.height = options.height + (options.height.constructor === Number ? \"px\" : \"\");\n\t\tif(options.closable)\n\t\t{\n\t\t\tvar close = document.createElement(\"span\");\n\t\t\tclose.innerHTML = \"&#10005;\";\n\t\t\tclose.classList.add(\"close\");\n\t\t\tclose.addEventListener(\"click\",function(){\n\t\t\t\troot.close();\n\t\t\t});\n\t\t\troot.header.appendChild(close);\n\t\t}\n\t\troot.title_element = root.querySelector(\".dialog-title\");\n\t\troot.title_element.innerText = title;\n\t\troot.content = root.querySelector(\".dialog-content\");\n        root.alt_content = root.querySelector(\".dialog-alt-content\");\n\t\troot.footer = root.querySelector(\".dialog-footer\");\n\n\t\troot.close = function()\n\t\t{\n\t\t    if (root.onClose && typeof root.onClose == \"function\"){\n\t\t        root.onClose();\n\t\t    }\n            if(root.parentNode)\n\t\t        root.parentNode.removeChild(root);\n\t\t    /* XXX CHECK THIS */\n\t\t    if(this.parentNode){\n\t\t    \tthis.parentNode.removeChild(this);\n\t\t    }\n\t\t    /* XXX this was not working, was fixed with an IF, check this */\n\t\t}\n\n        // function to swap panel content\n        root.toggleAltContent = function(force){\n            if (typeof force != \"undefined\"){\n                var vTo = force ? \"block\" : \"none\";\n                var vAlt = force ? \"none\" : \"block\";\n            }else{\n                var vTo = root.alt_content.style.display != \"block\" ? \"block\" : \"none\";\n                var vAlt = root.alt_content.style.display != \"block\" ? \"none\" : \"block\";\n            }\n            root.alt_content.style.display = vTo;\n            root.content.style.display = vAlt;\n        }\n        \n        root.toggleFooterVisibility = function(force){\n            if (typeof force != \"undefined\"){\n                var vTo = force ? \"block\" : \"none\";\n            }else{\n                var vTo = root.footer.style.display != \"block\" ? \"block\" : \"none\";\n            }\n            root.footer.style.display = vTo;\n        }\n        \n\t\troot.clear = function()\n\t\t{\n\t\t\tthis.content.innerHTML = \"\";\n\t\t}\n\n\t\troot.addHTML = function(code, classname, on_footer)\n\t\t{\n\t\t\tvar elem = document.createElement(\"div\");\n\t\t\tif(classname)\n\t\t\t\telem.className = classname;\n\t\t\telem.innerHTML = code;\n\t\t\tif(on_footer)\n\t\t\t\troot.footer.appendChild(elem);\n\t\t\telse\n\t\t\t\troot.content.appendChild(elem);\n\t\t\treturn elem;\n\t\t}\n\n\t\troot.addButton = function( name, callback, options )\n\t\t{\n\t\t\tvar elem = document.createElement(\"button\");\n\t\t\telem.innerText = name;\n\t\t\telem.options = options;\n\t\t\telem.classList.add(\"btn\");\n\t\t\telem.addEventListener(\"click\",callback);\n\t\t\troot.footer.appendChild(elem);\n\t\t\treturn elem;\n\t\t}\n\n\t\troot.addSeparator = function()\n\t\t{\n\t\t\tvar elem = document.createElement(\"div\");\n\t\t\telem.className = \"separator\";\n\t\t\troot.content.appendChild(elem);\n\t\t}\n\n\t\troot.addWidget = function( type, name, value, options, callback )\n\t\t{\n\t\t\toptions = options || {};\n\t\t\tvar str_value = String(value);\n\t\t\ttype = type.toLowerCase();\n\t\t\tif(type == \"number\")\n\t\t\t\tstr_value = value.toFixed(3);\n\n\t\t\tvar elem = document.createElement(\"div\");\n\t\t\telem.className = \"property\";\n\t\t\telem.innerHTML = \"<span class='property_name'></span><span class='property_value'></span>\";\n\t\t\telem.querySelector(\".property_name\").innerText = options.label || name;\n\t\t\tvar value_element = elem.querySelector(\".property_value\");\n\t\t\tvalue_element.innerText = str_value;\n\t\t\telem.dataset[\"property\"] = name;\n\t\t\telem.dataset[\"type\"] = options.type || type;\n\t\t\telem.options = options;\n\t\t\telem.value = value;\n\n\t\t\tif( type == \"code\" )\n\t\t\t\telem.addEventListener(\"click\", function(e){ root.inner_showCodePad( this.dataset[\"property\"] ); });\n\t\t\telse if (type == \"boolean\")\n\t\t\t{\n\t\t\t\telem.classList.add(\"boolean\");\n\t\t\t\tif(value)\n\t\t\t\t\telem.classList.add(\"bool-on\");\n\t\t\t\telem.addEventListener(\"click\", function(){ \n\t\t\t\t\t//var v = node.properties[this.dataset[\"property\"]]; \n\t\t\t\t\t//node.setProperty(this.dataset[\"property\"],!v); this.innerText = v ? \"true\" : \"false\"; \n\t\t\t\t\tvar propname = this.dataset[\"property\"];\n\t\t\t\t\tthis.value = !this.value;\n\t\t\t\t\tthis.classList.toggle(\"bool-on\");\n\t\t\t\t\tthis.querySelector(\".property_value\").innerText = this.value ? \"true\" : \"false\";\n\t\t\t\t\tinnerChange(propname, this.value );\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (type == \"string\" || type == \"number\")\n\t\t\t{\n\t\t\t\tvalue_element.setAttribute(\"contenteditable\",true);\n\t\t\t\tvalue_element.addEventListener(\"keydown\", function(e){ \n\t\t\t\t\tif(e.code == \"Enter\" && (type != \"string\" || !e.shiftKey)) // allow for multiline\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tthis.blur();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tvalue_element.addEventListener(\"blur\", function(){ \n\t\t\t\t\tvar v = this.innerText;\n\t\t\t\t\tvar propname = this.parentNode.dataset[\"property\"];\n\t\t\t\t\tvar proptype = this.parentNode.dataset[\"type\"];\n\t\t\t\t\tif( proptype == \"number\")\n\t\t\t\t\t\tv = Number(v);\n\t\t\t\t\tinnerChange(propname, v);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (type == \"enum\" || type == \"combo\") {\n\t\t\t\tvar str_value = LGraphCanvas.getPropertyPrintableValue( value, options.values );\n\t\t\t\tvalue_element.innerText = str_value;\n\n\t\t\t\tvalue_element.addEventListener(\"click\", function(event){ \n\t\t\t\t\tvar values = options.values || [];\n\t\t\t\t\tvar propname = this.parentNode.dataset[\"property\"];\n\t\t\t\t\tvar elem_that = this;\n\t\t\t\t\tvar menu = new LiteGraph.ContextMenu(values,{\n\t\t\t\t\t\t\tevent: event,\n\t\t\t\t\t\t\tclassName: \"dark\",\n\t\t\t\t\t\t\tcallback: inner_clicked\n\t\t\t\t\t\t},\n\t\t\t\t\t\tref_window);\n\t\t\t\t\tfunction inner_clicked(v, option, event) {\n\t\t\t\t\t\t//node.setProperty(propname,v); \n\t\t\t\t\t\t//graphcanvas.dirty_canvas = true;\n\t\t\t\t\t\telem_that.innerText = v;\n\t\t\t\t\t\tinnerChange(propname,v);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n            }\n\n\t\t\troot.content.appendChild(elem);\n\n\t\t\tfunction innerChange(name, value)\n\t\t\t{\n\t\t\t\t//console.log(\"change\",name,value);\n\t\t\t\t//that.dirty_canvas = true;\n\t\t\t\tif(options.callback)\n\t\t\t\t\toptions.callback(name,value,options);\n\t\t\t\tif(callback)\n\t\t\t\t\tcallback(name,value,options);\n\t\t\t}\n\n\t\t\treturn elem;\n\t\t}\n\n        if (root.onOpen && typeof root.onOpen == \"function\") root.onOpen();\n        \n\t\treturn root;\n\t};\n\n\tLGraphCanvas.getPropertyPrintableValue = function(value, values)\n\t{\n\t\tif(!values)\n\t\t\treturn String(value);\n\n\t\tif(values.constructor === Array)\n\t\t{\n\t\t\treturn String(value);\t\t\t\n\t\t}\n\n\t\tif(values.constructor === Object)\n\t\t{\n\t\t\tvar desc_value = \"\";\n\t\t\tfor(var k in values)\n\t\t\t{\n\t\t\t\tif(values[k] != value)\n\t\t\t\t\tcontinue;\n\t\t\t\tdesc_value = k;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn String(value) + \" (\"+desc_value+\")\";\n\t\t}\n\t}\n\n    LGraphCanvas.prototype.closePanels = function(){\n        var panel = document.querySelector(\"#node-panel\");\n\t\tif(panel)\n\t\t\tpanel.close();\n        var panel = document.querySelector(\"#option-panel\");\n\t\tif(panel)\n\t\t\tpanel.close();\n    }\n    \n    LGraphCanvas.prototype.showShowGraphOptionsPanel = function(refOpts, obEv, refMenu, refMenu2){\n        if(this.constructor && this.constructor.name == \"HTMLDivElement\"){\n            // assume coming from the menu event click\n            if (!obEv || !obEv.event || !obEv.event.target || !obEv.event.target.lgraphcanvas){\n                console.warn(\"Canvas not found\"); // need a ref to canvas obj\n                /*console.debug(event);\n                console.debug(event.target);*/\n                return;\n            }\n            var graphcanvas = obEv.event.target.lgraphcanvas;\n        }else{\n            // assume called internally\n            var graphcanvas = this;\n        }\n        graphcanvas.closePanels();\n        var ref_window = graphcanvas.getCanvasWindow();\n        panel = graphcanvas.createPanel(\"Options\",{\n                                            closable: true\n                                            ,window: ref_window\n                                            ,onOpen: function(){\n                                                graphcanvas.OPTIONPANEL_IS_OPEN = true;\n                                            }\n                                            ,onClose: function(){\n                                                graphcanvas.OPTIONPANEL_IS_OPEN = false;\n                                                graphcanvas.options_panel = null;\n                                            }\n                                        });\n        graphcanvas.options_panel = panel;\n        panel.id = \"option-panel\";\n\t\tpanel.classList.add(\"settings\");\n        \n        function inner_refresh(){\n            \n            panel.content.innerHTML = \"\"; //clear\n\n            var fUpdate = function(name, value, options){\n                switch(name){\n                    /*case \"Render mode\":\n                        // Case \"\".. \n                        if (options.values && options.key){\n                            var kV = Object.values(options.values).indexOf(value);\n                            if (kV>=0 && options.values[kV]){\n                                console.debug(\"update graph options: \"+options.key+\": \"+kV);\n                                graphcanvas[options.key] = kV;\n                                //console.debug(graphcanvas);\n                                break;\n                            }\n                        }\n                        console.warn(\"unexpected options\");\n                        console.debug(options);\n                        break;*/\n                    default:\n                        //console.debug(\"want to update graph options: \"+name+\": \"+value);\n                        if (options && options.key){\n                            name = options.key;\n                        }\n                        if (options.values){\n                            value = Object.values(options.values).indexOf(value);\n                        }\n                        //console.debug(\"update graph option: \"+name+\": \"+value);\n                        graphcanvas[name] = value;\n                        break;\n                }\n            };\n            \n            // panel.addWidget( \"string\", \"Graph name\", \"\", {}, fUpdate); // implement\n            \n            var aProps = LiteGraph.availableCanvasOptions;\n            aProps.sort();\n            for(var pI in aProps){\n                var pX = aProps[pI];\n                panel.addWidget( \"boolean\", pX, graphcanvas[pX], {key: pX, on: \"True\", off: \"False\"}, fUpdate);\n            }\n            \n            var aLinks = [ graphcanvas.links_render_mode ];\n            panel.addWidget( \"combo\", \"Render mode\", LiteGraph.LINK_RENDER_MODES[graphcanvas.links_render_mode], {key: \"links_render_mode\", values: LiteGraph.LINK_RENDER_MODES}, fUpdate);\n            \n            panel.addSeparator();\n            \n            panel.footer.innerHTML = \"\"; // clear\n\n\t\t}\n        inner_refresh();\n\n\t\tgraphcanvas.canvas.parentNode.appendChild( panel );\n    }\n    \n    LGraphCanvas.prototype.showShowNodePanel = function( node )\n\t{\n\t\tthis.SELECTED_NODE = node;\n\t\tthis.closePanels();\n\t\tvar ref_window = this.getCanvasWindow();\n        var that = this;\n\t\tvar graphcanvas = this;\n\t\tvar panel = this.createPanel(node.title || \"\",{\n                                                    closable: true\n                                                    ,window: ref_window\n                                                    ,onOpen: function(){\n                                                        graphcanvas.NODEPANEL_IS_OPEN = true;\n                                                    }\n                                                    ,onClose: function(){\n                                                        graphcanvas.NODEPANEL_IS_OPEN = false;\n                                                        graphcanvas.node_panel = null;\n                                                    }\n                                                });\n        graphcanvas.node_panel = panel;\n\t\tpanel.id = \"node-panel\";\n\t\tpanel.node = node;\n\t\tpanel.classList.add(\"settings\");\n\n\t\tfunction inner_refresh()\n\t\t{\n\t\t\tpanel.content.innerHTML = \"\"; //clear\n\t\t\tpanel.addHTML(\"<span class='node_type'>\"+node.type+\"</span><span class='node_desc'>\"+(node.constructor.desc || \"\")+\"</span><span class='separator'></span>\");\n\n\t\t\tpanel.addHTML(\"<h3>Properties</h3>\");\n\n            var fUpdate = function(name,value){\n                            graphcanvas.graph.beforeChange(node);\n                            switch(name){\n                                case \"Title\":\n                                    node.title = value;\n                                    break;\n                                case \"Mode\":\n                                    var kV = Object.values(LiteGraph.NODE_MODES).indexOf(value);\n                                    if (kV>=0 && LiteGraph.NODE_MODES[kV]){\n                                        node.changeMode(kV);\n                                    }else{\n                                        console.warn(\"unexpected mode: \"+value);\n                                    }\n                                    break;\n                                case \"Color\":\n                                    if (LGraphCanvas.node_colors[value]){\n                                        node.color = LGraphCanvas.node_colors[value].color;\n                                        node.bgcolor = LGraphCanvas.node_colors[value].bgcolor;\n                                    }else{\n                                        console.warn(\"unexpected color: \"+value);\n                                    }\n                                    break;\n                                default:\n                                    node.setProperty(name,value);\n                                    break;\n                            }\n                            graphcanvas.graph.afterChange();\n                            graphcanvas.dirty_canvas = true;\n                        };\n            \n            panel.addWidget( \"string\", \"Title\", node.title, {}, fUpdate);\n            \n            panel.addWidget( \"combo\", \"Mode\", LiteGraph.NODE_MODES[node.mode], {values: LiteGraph.NODE_MODES}, fUpdate);\n            \n            var nodeCol = \"\";\n            if (node.color !== undefined){\n                nodeCol = Object.keys(LGraphCanvas.node_colors).filter(function(nK){ return LGraphCanvas.node_colors[nK].color == node.color; });\n            }\n            \n            panel.addWidget( \"combo\", \"Color\", nodeCol, {values: Object.keys(LGraphCanvas.node_colors)}, fUpdate);\n            \n            for(var pName in node.properties)\n\t\t\t{\n\t\t\t\tvar value = node.properties[pName];\n\t\t\t\tvar info = node.getPropertyInfo(pName);\n\t\t\t\tvar type = info.type || \"string\";\n\n\t\t\t\t//in case the user wants control over the side panel widget\n\t\t\t\tif( node.onAddPropertyToPanel && node.onAddPropertyToPanel(pName,panel) )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tpanel.addWidget( info.widget || info.type, pName, value, info, fUpdate);\n\t\t\t}\n\n\t\t\tpanel.addSeparator();\n\n\t\t\tif(node.onShowCustomPanelInfo)\n\t\t\t\tnode.onShowCustomPanelInfo(panel);\n\n            panel.footer.innerHTML = \"\"; // clear\n\t\t\tpanel.addButton(\"Delete\",function(){\n\t\t\t\tif(node.block_delete)\n\t\t\t\t\treturn;\n\t\t\t\tnode.graph.remove(node);\n\t\t\t\tpanel.close();\n\t\t\t}).classList.add(\"delete\");\n\t\t}\n\n\t\tpanel.inner_showCodePad = function( propname )\n\t\t{\n            panel.classList.remove(\"settings\");\n            panel.classList.add(\"centered\");\n\n            \n\t\t\t/*if(window.CodeFlask) //disabled for now\n\t\t\t{\n\t\t\t\tpanel.content.innerHTML = \"<div class='code'></div>\";\n\t\t\t\tvar flask = new CodeFlask( \"div.code\", { language: 'js' });\n\t\t\t\tflask.updateCode(node.properties[propname]);\n\t\t\t\tflask.onUpdate( function(code) {\n\t\t\t\t\tnode.setProperty(propname, code);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{*/\n\t\t\t\tpanel.alt_content.innerHTML = \"<textarea class='code'></textarea>\";\n\t\t\t\tvar textarea = panel.alt_content.querySelector(\"textarea\");\n                var fDoneWith = function(){\n                    panel.toggleAltContent(false); //if(node_prop_div) node_prop_div.style.display = \"block\"; // panel.close();\n                    panel.toggleFooterVisibility(true);\n                    textarea.parentNode.removeChild(textarea);\n                    panel.classList.add(\"settings\");\n                    panel.classList.remove(\"centered\");\n                    inner_refresh();\n                }\n\t\t\t\ttextarea.value = node.properties[propname];\n\t\t\t\ttextarea.addEventListener(\"keydown\", function(e){\n\t\t\t\t\tif(e.code == \"Enter\" && e.ctrlKey )\n\t\t\t\t\t{\n\t\t\t\t\t\tnode.setProperty(propname, textarea.value);\n                        fDoneWith();\n\t\t\t\t\t}\n\t\t\t\t});\n                panel.toggleAltContent(true);\n                panel.toggleFooterVisibility(false);\n\t\t\t\ttextarea.style.height = \"calc(100% - 40px)\";\n\t\t\t/*}*/\n\t\t\tvar assign = panel.addButton( \"Assign\", function(){\n\t\t\t\tnode.setProperty(propname, textarea.value);\n                fDoneWith();\n\t\t\t});\n\t\t\tpanel.alt_content.appendChild(assign); //panel.content.appendChild(assign);\n\t\t\tvar button = panel.addButton( \"Close\", fDoneWith);\n\t\t\tbutton.style.float = \"right\";\n\t\t\tpanel.alt_content.appendChild(button); // panel.content.appendChild(button);\n\t\t}\n\n\t\tinner_refresh();\n\n\t\tthis.canvas.parentNode.appendChild( panel );\n\t}\n\t\n\tLGraphCanvas.prototype.showSubgraphPropertiesDialog = function(node)\n\t{\n\t\tconsole.log(\"showing subgraph properties dialog\");\n\n\t\tvar old_panel = this.canvas.parentNode.querySelector(\".subgraph_dialog\");\n\t\tif(old_panel)\n\t\t\told_panel.close();\n\n\t\tvar panel = this.createPanel(\"Subgraph Inputs\",{closable:true, width: 500});\n\t\tpanel.node = node;\n\t\tpanel.classList.add(\"subgraph_dialog\");\n\n\t\tfunction inner_refresh()\n\t\t{\n\t\t\tpanel.clear();\n\n\t\t\t//show currents\n\t\t\tif(node.inputs)\n\t\t\t\tfor(var i = 0; i < node.inputs.length; ++i)\n\t\t\t\t{\n\t\t\t\t\tvar input = node.inputs[i];\n\t\t\t\t\tif(input.not_subgraph_input)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tvar html = \"<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>\";\n\t\t\t\t\tvar elem = panel.addHTML(html,\"subgraph_property\");\n\t\t\t\t\telem.dataset[\"name\"] = input.name;\n\t\t\t\t\telem.dataset[\"slot\"] = i;\n\t\t\t\t\telem.querySelector(\".name\").innerText = input.name;\n\t\t\t\t\telem.querySelector(\".type\").innerText = input.type;\n\t\t\t\t\telem.querySelector(\"button\").addEventListener(\"click\",function(e){\n\t\t\t\t\t\tnode.removeInput( Number( this.parentNode.dataset[\"slot\"] ) );\n\t\t\t\t\t\tinner_refresh();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t}\n\n\t\t//add extra\n\t\tvar html = \" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>\";\n\t\tvar elem = panel.addHTML(html,\"subgraph_property extra\", true);\n\t\telem.querySelector(\"button\").addEventListener(\"click\", function(e){\n\t\t\tvar elem = this.parentNode;\n\t\t\tvar name = elem.querySelector(\".name\").value;\n\t\t\tvar type = elem.querySelector(\".type\").value;\n\t\t\tif(!name || node.findInputSlot(name) != -1)\n\t\t\t\treturn;\n\t\t\tnode.addInput(name,type);\n\t\t\telem.querySelector(\".name\").value = \"\";\n\t\t\telem.querySelector(\".type\").value = \"\";\n\t\t\tinner_refresh();\n\t\t});\n\n\t\tinner_refresh();\n\t    this.canvas.parentNode.appendChild(panel);\n\t\treturn panel;\n\t}\n    LGraphCanvas.prototype.showSubgraphPropertiesDialogRight = function (node) {\n\n        // console.log(\"showing subgraph properties dialog\");\n        var that = this;\n        // old_panel if old_panel is exist close it\n        var old_panel = this.canvas.parentNode.querySelector(\".subgraph_dialog\");\n        if (old_panel)\n            old_panel.close();\n        // new panel\n        var panel = this.createPanel(\"Subgraph Outputs\", { closable: true, width: 500 });\n        panel.node = node;\n        panel.classList.add(\"subgraph_dialog\");\n\n        function inner_refresh() {\n            panel.clear();\n            //show currents\n            if (node.outputs)\n                for (var i = 0; i < node.outputs.length; ++i) {\n                    var input = node.outputs[i];\n                    if (input.not_subgraph_output)\n                        continue;\n                    var html = \"<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>\";\n                    var elem = panel.addHTML(html, \"subgraph_property\");\n                    elem.dataset[\"name\"] = input.name;\n                    elem.dataset[\"slot\"] = i;\n                    elem.querySelector(\".name\").innerText = input.name;\n                    elem.querySelector(\".type\").innerText = input.type;\n                    elem.querySelector(\"button\").addEventListener(\"click\", function (e) {\n                        node.removeOutput(Number(this.parentNode.dataset[\"slot\"]));\n                        inner_refresh();\n                    });\n                }\n        }\n\n        //add extra\n        var html = \" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>\";\n        var elem = panel.addHTML(html, \"subgraph_property extra\", true);\n        elem.querySelector(\".name\").addEventListener(\"keydown\", function (e) {\n            if (e.keyCode == 13) {\n                addOutput.apply(this)\n            }\n        })\n        elem.querySelector(\"button\").addEventListener(\"click\", function (e) {\n            addOutput.apply(this)\n        });\n        function addOutput() {\n            var elem = this.parentNode;\n            var name = elem.querySelector(\".name\").value;\n            var type = elem.querySelector(\".type\").value;\n            if (!name || node.findOutputSlot(name) != -1)\n                return;\n            node.addOutput(name, type);\n            elem.querySelector(\".name\").value = \"\";\n            elem.querySelector(\".type\").value = \"\";\n            inner_refresh();\n        }\n\n        inner_refresh();\n        this.canvas.parentNode.appendChild(panel);\n        return panel;\n    }\n\tLGraphCanvas.prototype.checkPanels = function()\n\t{\n\t\tif(!this.canvas)\n\t\t\treturn;\n\t\tvar panels = this.canvas.parentNode.querySelectorAll(\".litegraph.dialog\");\n\t\tfor(var i = 0; i < panels.length; ++i)\n\t\t{\n\t\t\tvar panel = panels[i];\n\t\t\tif( !panel.node )\n\t\t\t\tcontinue;\n\t\t\tif( !panel.node.graph || panel.graph != this.graph )\n\t\t\t\tpanel.close();\n\t\t}\n\t}\n\n    LGraphCanvas.onMenuNodeCollapse = function(value, options, e, menu, node) {\n\t\tnode.graph.beforeChange(/*?*/);\n\t\t\n\t\tvar fApplyMultiNode = function(node){\n\t\t\tnode.collapse();\n\t\t}\n\t\t\n\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\tif (!graphcanvas.selected_nodes || Object.keys(graphcanvas.selected_nodes).length <= 1){\n\t\t\tfApplyMultiNode(node);\n\t\t}else{\n\t\t\tfor (var i in graphcanvas.selected_nodes) {\n\t\t\t\tfApplyMultiNode(graphcanvas.selected_nodes[i]);\n\t\t\t}\n\t\t}\n\t\t\n\t\tnode.graph.afterChange(/*?*/);\n    };\n\n    LGraphCanvas.onMenuNodePin = function(value, options, e, menu, node) {\n        node.pin();\n    };\n\n    LGraphCanvas.onMenuNodeMode = function(value, options, e, menu, node) {\n        new LiteGraph.ContextMenu(\n            LiteGraph.NODE_MODES,\n            { event: e, callback: inner_clicked, parentMenu: menu, node: node }\n        );\n\n        function inner_clicked(v) {\n            if (!node) {\n                return;\n            }\n            var kV = Object.values(LiteGraph.NODE_MODES).indexOf(v);\n            var fApplyMultiNode = function(node){\n\t\t\t\tif (kV>=0 && LiteGraph.NODE_MODES[kV])\n\t\t\t\t\tnode.changeMode(kV);\n\t\t\t\telse{\n\t\t\t\t\tconsole.warn(\"unexpected mode: \"+v);\n\t\t\t\t\tnode.changeMode(LiteGraph.ALWAYS);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\t\tif (!graphcanvas.selected_nodes || Object.keys(graphcanvas.selected_nodes).length <= 1){\n\t\t\t\tfApplyMultiNode(node);\n\t\t\t}else{\n\t\t\t\tfor (var i in graphcanvas.selected_nodes) {\n\t\t\t\t\tfApplyMultiNode(graphcanvas.selected_nodes[i]);\n\t\t\t\t}\n\t\t\t}\n        }\n\n        return false;\n    };\n\n    LGraphCanvas.onMenuNodeColors = function(value, options, e, menu, node) {\n        if (!node) {\n            throw \"no node for color\";\n        }\n\n        var values = [];\n        values.push({\n            value: null,\n            content:\n                \"<span style='display: block; padding-left: 4px;'>No color</span>\"\n        });\n\n        for (var i in LGraphCanvas.node_colors) {\n            var color = LGraphCanvas.node_colors[i];\n            var value = {\n                value: i,\n                content:\n                    \"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid \" +\n                    color.color +\n                    \"; background-color:\" +\n                    color.bgcolor +\n                    \"'>\" +\n                    i +\n                    \"</span>\"\n            };\n            values.push(value);\n        }\n        new LiteGraph.ContextMenu(values, {\n            event: e,\n            callback: inner_clicked,\n            parentMenu: menu,\n            node: node\n        });\n\n        function inner_clicked(v) {\n            if (!node) {\n                return;\n            }\n\n            var color = v.value ? LGraphCanvas.node_colors[v.value] : null;\n\t\t\t\n\t\t\tvar fApplyColor = function(node){\n\t\t\t\tif (color) {\n\t\t\t\t\tif (node.constructor === LiteGraph.LGraphGroup) {\n\t\t\t\t\t\tnode.color = color.groupcolor;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnode.color = color.color;\n\t\t\t\t\t\tnode.bgcolor = color.bgcolor;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdelete node.color;\n\t\t\t\t\tdelete node.bgcolor;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\t\tif (!graphcanvas.selected_nodes || Object.keys(graphcanvas.selected_nodes).length <= 1){\n\t\t\t\tfApplyColor(node);\n\t\t\t}else{\n\t\t\t\tfor (var i in graphcanvas.selected_nodes) {\n\t\t\t\t\tfApplyColor(graphcanvas.selected_nodes[i]);\n\t\t\t\t}\n\t\t\t}\n            node.setDirtyCanvas(true, true);\n        }\n\n        return false;\n    };\n\n    LGraphCanvas.onMenuNodeShapes = function(value, options, e, menu, node) {\n        if (!node) {\n            throw \"no node passed\";\n        }\n\n        new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES, {\n            event: e,\n            callback: inner_clicked,\n            parentMenu: menu,\n            node: node\n        });\n\n        function inner_clicked(v) {\n            if (!node) {\n                return;\n            }\n\t\t\tnode.graph.beforeChange(/*?*/); //node\n            \n\t\t\tvar fApplyMultiNode = function(node){\n\t\t\t\tnode.shape = v;\n\t\t\t}\n\n\t\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\t\tif (!graphcanvas.selected_nodes || Object.keys(graphcanvas.selected_nodes).length <= 1){\n\t\t\t\tfApplyMultiNode(node);\n\t\t\t}else{\n\t\t\t\tfor (var i in graphcanvas.selected_nodes) {\n\t\t\t\t\tfApplyMultiNode(graphcanvas.selected_nodes[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tnode.graph.afterChange(/*?*/); //node\n            node.setDirtyCanvas(true);\n        }\n\n        return false;\n    };\n\n    LGraphCanvas.onMenuNodeRemove = function(value, options, e, menu, node) {\n        if (!node) {\n            throw \"no node passed\";\n        }\n\n\t\tvar graph = node.graph;\n\t\tgraph.beforeChange();\n        \n\t\t\n\t\tvar fApplyMultiNode = function(node){\n\t\t\tif (node.removable === false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tgraph.remove(node);\n\t\t}\n\n\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\tif (!graphcanvas.selected_nodes || Object.keys(graphcanvas.selected_nodes).length <= 1){\n\t\t\tfApplyMultiNode(node);\n\t\t}else{\n\t\t\tfor (var i in graphcanvas.selected_nodes) {\n\t\t\t\tfApplyMultiNode(graphcanvas.selected_nodes[i]);\n\t\t\t}\n\t\t}\n\t\t\n\t\tgraph.afterChange();\n        node.setDirtyCanvas(true, true);\n    };\n\n    LGraphCanvas.onMenuNodeToSubgraph = function(value, options, e, menu, node) {\n\t\tvar graph = node.graph;\n\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\tif(!graphcanvas) //??\n\t\t\treturn;\n\n\t\tvar nodes_list = Object.values( graphcanvas.selected_nodes || {} );\n\t\tif( !nodes_list.length )\n\t\t\tnodes_list = [ node ];\n\n\t\tvar subgraph_node = LiteGraph.createNode(\"graph/subgraph\");\n\t\tsubgraph_node.pos = node.pos.concat();\n\t\tgraph.add(subgraph_node);\n\n\t\tsubgraph_node.buildFromNodes( nodes_list );\n\n\t\tgraphcanvas.deselectAllNodes();\n        node.setDirtyCanvas(true, true);\n    };\n\n    LGraphCanvas.onMenuNodeClone = function(value, options, e, menu, node) {\n        \n\t\tnode.graph.beforeChange();\n        \n\t\tvar newSelected = {};\n\t\t\n\t\tvar fApplyMultiNode = function(node){\n\t\t\tif (node.clonable === false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar newnode = node.clone();\n\t\t\tif (!newnode) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tnewnode.pos = [node.pos[0] + 5, node.pos[1] + 5];\n\t\t\tnode.graph.add(newnode);\n\t\t\tnewSelected[newnode.id] = newnode;\n\t\t}\n\n\t\tvar graphcanvas = LGraphCanvas.active_canvas;\n\t\tif (!graphcanvas.selected_nodes || Object.keys(graphcanvas.selected_nodes).length <= 1){\n\t\t\tfApplyMultiNode(node);\n\t\t}else{\n\t\t\tfor (var i in graphcanvas.selected_nodes) {\n\t\t\t\tfApplyMultiNode(graphcanvas.selected_nodes[i]);\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(Object.keys(newSelected).length){\n\t\t\tgraphcanvas.selectNodes(newSelected);\n\t\t}\n\t\t\n\t\tnode.graph.afterChange();\n\n        node.setDirtyCanvas(true, true);\n    };\n\n    LGraphCanvas.node_colors = {\n        red: { color: \"#322\", bgcolor: \"#533\", groupcolor: \"#A88\" },\n        brown: { color: \"#332922\", bgcolor: \"#593930\", groupcolor: \"#b06634\" },\n        green: { color: \"#232\", bgcolor: \"#353\", groupcolor: \"#8A8\" },\n        blue: { color: \"#223\", bgcolor: \"#335\", groupcolor: \"#88A\" },\n        pale_blue: {\n            color: \"#2a363b\",\n            bgcolor: \"#3f5159\",\n            groupcolor: \"#3f789e\"\n        },\n        cyan: { color: \"#233\", bgcolor: \"#355\", groupcolor: \"#8AA\" },\n        purple: { color: \"#323\", bgcolor: \"#535\", groupcolor: \"#a1309b\" },\n        yellow: { color: \"#432\", bgcolor: \"#653\", groupcolor: \"#b58b2a\" },\n        black: { color: \"#222\", bgcolor: \"#000\", groupcolor: \"#444\" }\n    };\n\n    LGraphCanvas.prototype.getCanvasMenuOptions = function() {\n        var options = null;\n\t\tvar that = this;\n        if (this.getMenuOptions) {\n            options = this.getMenuOptions();\n        } else {\n            options = [\n                {\n                    content: \"Add Node\",\n                    has_submenu: true,\n                    callback: LGraphCanvas.onMenuAdd\n                },\n                { content: \"Add Group\", callback: LGraphCanvas.onGroupAdd },\n\t\t\t\t//{ content: \"Arrange\", callback: that.graph.arrange },\n                //{content:\"Collapse All\", callback: LGraphCanvas.onMenuCollapseAll }\n            ];\n            /*if (LiteGraph.showCanvasOptions){\n                options.push({ content: \"Options\", callback: that.showShowGraphOptionsPanel });\n            }*/\n\n            if (Object.keys(this.selected_nodes).length > 1) {\n                options.push({\n                    content: \"Align\",\n                    has_submenu: true,\n                    callback: LGraphCanvas.onGroupAlign,\n                })\n            }\n\n            if (this._graph_stack && this._graph_stack.length > 0) {\n                options.push(null, {\n                    content: \"Close subgraph\",\n                    callback: this.closeSubgraph.bind(this)\n                });\n            }\n        }\n\n        if (this.getExtraMenuOptions) {\n            var extra = this.getExtraMenuOptions(this, options);\n            if (extra) {\n                options = options.concat(extra);\n            }\n        }\n\n        return options;\n    };\n\n    //called by processContextMenu to extract the menu list\n    LGraphCanvas.prototype.getNodeMenuOptions = function(node) {\n        var options = null;\n\n        if (node.getMenuOptions) {\n            options = node.getMenuOptions(this);\n        } else {\n            options = [\n                {\n                    content: \"Inputs\",\n                    has_submenu: true,\n                    disabled: true,\n                    callback: LGraphCanvas.showMenuNodeOptionalInputs\n                },\n                {\n                    content: \"Outputs\",\n                    has_submenu: true,\n                    disabled: true,\n                    callback: LGraphCanvas.showMenuNodeOptionalOutputs\n                },\n                null,\n                {\n                    content: \"Properties\",\n                    has_submenu: true,\n                    callback: LGraphCanvas.onShowMenuNodeProperties\n                },\n                null,\n                {\n                    content: \"Title\",\n                    callback: LGraphCanvas.onShowPropertyEditor\n                },\n                {\n                    content: \"Mode\",\n                    has_submenu: true,\n                    callback: LGraphCanvas.onMenuNodeMode\n                }];\n            if(node.resizable !== false){\n                options.push({\n                    content: \"Resize\", callback: LGraphCanvas.onMenuResizeNode\n                });\n            }\n            options.push(\n                {\n                    content: \"Collapse\",\n                    callback: LGraphCanvas.onMenuNodeCollapse\n                },\n                { content: \"Pin\", callback: LGraphCanvas.onMenuNodePin },\n                {\n                    content: \"Colors\",\n                    has_submenu: true,\n                    callback: LGraphCanvas.onMenuNodeColors\n                },\n                {\n                    content: \"Shapes\",\n                    has_submenu: true,\n                    callback: LGraphCanvas.onMenuNodeShapes\n                },\n                null\n            );\n        }\n\n        if (node.onGetInputs) {\n            var inputs = node.onGetInputs();\n            if (inputs && inputs.length) {\n                options[0].disabled = false;\n            }\n        }\n\n        if (node.onGetOutputs) {\n            var outputs = node.onGetOutputs();\n            if (outputs && outputs.length) {\n                options[1].disabled = false;\n            }\n        }\n\n        if (node.getExtraMenuOptions) {\n            var extra = node.getExtraMenuOptions(this, options);\n            if (extra) {\n                extra.push(null);\n                options = extra.concat(options);\n            }\n        }\n\n        if (node.clonable !== false) {\n            options.push({\n                content: \"Clone\",\n                callback: LGraphCanvas.onMenuNodeClone\n            });\n        }\n\n\t\tif(0) //TODO\n\t\toptions.push({\n\t\t\tcontent: \"To Subgraph\",\n\t\t\tcallback: LGraphCanvas.onMenuNodeToSubgraph\n\t\t});\n\n        if (Object.keys(this.selected_nodes).length > 1) {\n            options.push({\n                content: \"Align Selected To\",\n                has_submenu: true,\n                callback: LGraphCanvas.onNodeAlign,\n            })\n        }\n\n\t\toptions.push(null, {\n\t\t\tcontent: \"Remove\",\n\t\t\tdisabled: !(node.removable !== false && !node.block_delete ),\n\t\t\tcallback: LGraphCanvas.onMenuNodeRemove\n\t\t});\n\n        if (node.graph && node.graph.onGetNodeMenuOptions) {\n            node.graph.onGetNodeMenuOptions(options, node);\n        }\n\n        return options;\n    };\n\n    LGraphCanvas.prototype.getGroupMenuOptions = function(node) {\n        var o = [\n            { content: \"Title\", callback: LGraphCanvas.onShowPropertyEditor },\n            {\n                content: \"Color\",\n                has_submenu: true,\n                callback: LGraphCanvas.onMenuNodeColors\n            },\n            {\n                content: \"Font size\",\n                property: \"font_size\",\n                type: \"Number\",\n                callback: LGraphCanvas.onShowPropertyEditor\n            },\n            null,\n            { content: \"Remove\", callback: LGraphCanvas.onMenuNodeRemove }\n        ];\n\n        return o;\n    };\n\n    LGraphCanvas.prototype.processContextMenu = function(node, event) {\n        var that = this;\n        var canvas = LGraphCanvas.active_canvas;\n        var ref_window = canvas.getCanvasWindow();\n\n        var menu_info = null;\n        var options = {\n            event: event,\n            callback: inner_option_clicked,\n            extra: node\n        };\n\n\t\tif(node)\n\t\t\toptions.title = node.type;\n\n        //check if mouse is in input\n        var slot = null;\n        if (node) {\n            slot = node.getSlotInPosition(event.canvasX, event.canvasY);\n            LGraphCanvas.active_node = node;\n        }\n\n        if (slot) {\n            //on slot\n            menu_info = [];\n            if (node.getSlotMenuOptions) {\n                menu_info = node.getSlotMenuOptions(slot);\n            } else {\n                if (\n                    slot &&\n                    slot.output &&\n                    slot.output.links &&\n                    slot.output.links.length\n                ) {\n                    menu_info.push({ content: \"Disconnect Links\", slot: slot });\n                }\n                var _slot = slot.input || slot.output;\n                if (_slot.removable){\n                \tmenu_info.push(\n\t                    _slot.locked\n\t                        ? \"Cannot remove\"\n\t                        : { content: \"Remove Slot\", slot: slot }\n\t                );\n            \t}\n                if (!_slot.nameLocked){\n\t                menu_info.push({ content: \"Rename Slot\", slot: slot });\n                }\n    \n            }\n            options.title =\n                (slot.input ? slot.input.type : slot.output.type) || \"*\";\n            if (slot.input && slot.input.type == LiteGraph.ACTION) {\n                options.title = \"Action\";\n            }\n            if (slot.output && slot.output.type == LiteGraph.EVENT) {\n                options.title = \"Event\";\n            }\n        } else {\n            if (node) {\n                //on node\n                menu_info = this.getNodeMenuOptions(node);\n            } else {\n                menu_info = this.getCanvasMenuOptions();\n                var group = this.graph.getGroupOnPos(\n                    event.canvasX,\n                    event.canvasY\n                );\n                if (group) {\n                    //on group\n                    menu_info.push(null, {\n                        content: \"Edit Group\",\n                        has_submenu: true,\n                        submenu: {\n                            title: \"Group\",\n                            extra: group,\n                            options: this.getGroupMenuOptions(group)\n                        }\n                    });\n                }\n            }\n        }\n\n        //show menu\n        if (!menu_info) {\n            return;\n        }\n\n        var menu = new LiteGraph.ContextMenu(menu_info, options, ref_window);\n\n        function inner_option_clicked(v, options, e) {\n            if (!v) {\n                return;\n            }\n\n            if (v.content == \"Remove Slot\") {\n                var info = v.slot;\n                node.graph.beforeChange();\n                if (info.input) {\n                    node.removeInput(info.slot);\n                } else if (info.output) {\n                    node.removeOutput(info.slot);\n                }\n                node.graph.afterChange();\n                return;\n            } else if (v.content == \"Disconnect Links\") {\n                var info = v.slot;\n                node.graph.beforeChange();\n                if (info.output) {\n                    node.disconnectOutput(info.slot);\n                } else if (info.input) {\n                    node.disconnectInput(info.slot);\n                }\n                node.graph.afterChange();\n                return;\n            } else if (v.content == \"Rename Slot\") {\n                var info = v.slot;\n                var slot_info = info.input\n                    ? node.getInputInfo(info.slot)\n                    : node.getOutputInfo(info.slot);\n                var dialog = that.createDialog(\n                    \"<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>\",\n                    options\n                );\n                var input = dialog.querySelector(\"input\");\n                if (input && slot_info) {\n                    input.value = slot_info.label || \"\";\n                }\n                var inner = function(){\n                \tnode.graph.beforeChange();\n                    if (input.value) {\n                        if (slot_info) {\n                            slot_info.label = input.value;\n                        }\n                        that.setDirty(true);\n                    }\n                    dialog.close();\n                    node.graph.afterChange();\n                }\n                dialog.querySelector(\"button\").addEventListener(\"click\", inner);\n                input.addEventListener(\"keydown\", function(e) {\n                    dialog.is_modified = true;\n                    if (e.keyCode == 27) {\n                        //ESC\n                        dialog.close();\n                    } else if (e.keyCode == 13) {\n                        inner(); // save\n                    } else if (e.keyCode != 13 && e.target.localName != \"textarea\") {\n                        return;\n                    }\n                    e.preventDefault();\n                    e.stopPropagation();\n                });\n                input.focus();\n            }\n\n            //if(v.callback)\n            //\treturn v.callback.call(that, node, options, e, menu, that, event );\n        }\n    };\n\n    //API *************************************************\n    function compareObjects(a, b) {\n        for (var i in a) {\n            if (a[i] != b[i]) {\n                return false;\n            }\n        }\n        return true;\n    }\n    LiteGraph.compareObjects = compareObjects;\n\n    function distance(a, b) {\n        return Math.sqrt(\n            (b[0] - a[0]) * (b[0] - a[0]) + (b[1] - a[1]) * (b[1] - a[1])\n        );\n    }\n    LiteGraph.distance = distance;\n\n    function colorToString(c) {\n        return (\n            \"rgba(\" +\n            Math.round(c[0] * 255).toFixed() +\n            \",\" +\n            Math.round(c[1] * 255).toFixed() +\n            \",\" +\n            Math.round(c[2] * 255).toFixed() +\n            \",\" +\n            (c.length == 4 ? c[3].toFixed(2) : \"1.0\") +\n            \")\"\n        );\n    }\n    LiteGraph.colorToString = colorToString;\n\n    function isInsideRectangle(x, y, left, top, width, height) {\n        if (left < x && left + width > x && top < y && top + height > y) {\n            return true;\n        }\n        return false;\n    }\n    LiteGraph.isInsideRectangle = isInsideRectangle;\n\n    //[minx,miny,maxx,maxy]\n    function growBounding(bounding, x, y) {\n        if (x < bounding[0]) {\n            bounding[0] = x;\n        } else if (x > bounding[2]) {\n            bounding[2] = x;\n        }\n\n        if (y < bounding[1]) {\n            bounding[1] = y;\n        } else if (y > bounding[3]) {\n            bounding[3] = y;\n        }\n    }\n    LiteGraph.growBounding = growBounding;\n\n    //point inside bounding box\n    function isInsideBounding(p, bb) {\n        if (\n            p[0] < bb[0][0] ||\n            p[1] < bb[0][1] ||\n            p[0] > bb[1][0] ||\n            p[1] > bb[1][1]\n        ) {\n            return false;\n        }\n        return true;\n    }\n    LiteGraph.isInsideBounding = isInsideBounding;\n\n    //bounding overlap, format: [ startx, starty, width, height ]\n    function overlapBounding(a, b) {\n        var A_end_x = a[0] + a[2];\n        var A_end_y = a[1] + a[3];\n        var B_end_x = b[0] + b[2];\n        var B_end_y = b[1] + b[3];\n\n        if (\n            a[0] > B_end_x ||\n            a[1] > B_end_y ||\n            A_end_x < b[0] ||\n            A_end_y < b[1]\n        ) {\n            return false;\n        }\n        return true;\n    }\n    LiteGraph.overlapBounding = overlapBounding;\n\n    //Convert a hex value to its decimal value - the inputted hex must be in the\n    //\tformat of a hex triplet - the kind we use for HTML colours. The function\n    //\twill return an array with three values.\n    function hex2num(hex) {\n        if (hex.charAt(0) == \"#\") {\n            hex = hex.slice(1);\n        } //Remove the '#' char - if there is one.\n        hex = hex.toUpperCase();\n        var hex_alphabets = \"0123456789ABCDEF\";\n        var value = new Array(3);\n        var k = 0;\n        var int1, int2;\n        for (var i = 0; i < 6; i += 2) {\n            int1 = hex_alphabets.indexOf(hex.charAt(i));\n            int2 = hex_alphabets.indexOf(hex.charAt(i + 1));\n            value[k] = int1 * 16 + int2;\n            k++;\n        }\n        return value;\n    }\n\n    LiteGraph.hex2num = hex2num;\n\n    //Give a array with three values as the argument and the function will return\n    //\tthe corresponding hex triplet.\n    function num2hex(triplet) {\n        var hex_alphabets = \"0123456789ABCDEF\";\n        var hex = \"#\";\n        var int1, int2;\n        for (var i = 0; i < 3; i++) {\n            int1 = triplet[i] / 16;\n            int2 = triplet[i] % 16;\n\n            hex += hex_alphabets.charAt(int1) + hex_alphabets.charAt(int2);\n        }\n        return hex;\n    }\n\n    LiteGraph.num2hex = num2hex;\n\n    /* LiteGraph GUI elements used for canvas editing *************************************/\n\n    /**\n     * ContextMenu from LiteGUI\n     *\n     * @class ContextMenu\n     * @constructor\n     * @param {Array} values (allows object { title: \"Nice text\", callback: function ... })\n     * @param {Object} options [optional] Some options:\\\n     * - title: title to show on top of the menu\n     * - callback: function to call when an option is clicked, it receives the item information\n     * - ignore_item_callbacks: ignores the callback inside the item, it just calls the options.callback\n     * - event: you can pass a MouseEvent, this way the ContextMenu appears in that position\n     */\n    function ContextMenu(values, options) {\n        options = options || {};\n        this.options = options;\n        var that = this;\n\n        //to link a menu with its parent\n        if (options.parentMenu) {\n            if (options.parentMenu.constructor !== this.constructor) {\n                console.error(\n                    \"parentMenu must be of class ContextMenu, ignoring it\"\n                );\n                options.parentMenu = null;\n            } else {\n                this.parentMenu = options.parentMenu;\n                this.parentMenu.lock = true;\n                this.parentMenu.current_submenu = this;\n            }\n        }\n\n\t\tvar eventClass = null;\n\t\tif(options.event) //use strings because comparing classes between windows doesnt work\n\t\t\teventClass = options.event.constructor.name;\n        if ( eventClass !== \"MouseEvent\" &&\n            eventClass !== \"CustomEvent\" &&\n\t\t\teventClass !== \"PointerEvent\"\n        ) {\n            console.error(\n                \"Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. (\"+eventClass+\")\"\n            );\n            options.event = null;\n        }\n\n        var root = document.createElement(\"div\");\n        root.className = \"litegraph litecontextmenu litemenubar-panel\";\n        if (options.className) {\n            root.className += \" \" + options.className;\n        }\n        root.style.minWidth = 100;\n        root.style.minHeight = 100;\n        root.style.pointerEvents = \"none\";\n        setTimeout(function() {\n            root.style.pointerEvents = \"auto\";\n        }, 100); //delay so the mouse up event is not caught by this element\n\n        //this prevents the default context browser menu to open in case this menu was created when pressing right button\n\t\tLiteGraph.pointerListenerAdd(root,\"up\",\n            function(e) {\n\t\t\t  \t//console.log(\"pointerevents: ContextMenu up root prevent\");\n                e.preventDefault();\n                return true;\n            },\n            true\n        );\n        root.addEventListener(\n            \"contextmenu\",\n            function(e) {\n                if (e.button != 2) {\n                    //right button\n                    return false;\n                }\n                e.preventDefault();\n                return false;\n            },\n            true\n        );\n\n        LiteGraph.pointerListenerAdd(root,\"down\",\n            function(e) {\n\t\t\t  \t//console.log(\"pointerevents: ContextMenu down\");\n                if (e.button == 2) {\n                    that.close();\n                    e.preventDefault();\n                    return true;\n                }\n            },\n            true\n        );\n\n        function on_mouse_wheel(e) {\n            var pos = parseInt(root.style.top);\n            root.style.top =\n                (pos + e.deltaY * options.scroll_speed).toFixed() + \"px\";\n            e.preventDefault();\n            return true;\n        }\n\n        if (!options.scroll_speed) {\n            options.scroll_speed = 0.1;\n        }\n\n        root.addEventListener(\"wheel\", on_mouse_wheel, true);\n        root.addEventListener(\"mousewheel\", on_mouse_wheel, true);\n\n        this.root = root;\n\n        //title\n        if (options.title) {\n            var element = document.createElement(\"div\");\n            element.className = \"litemenu-title\";\n            element.innerHTML = options.title;\n            root.appendChild(element);\n        }\n\n        //entries\n        var num = 0;\n        for (var i=0; i < values.length; i++) {\n            var name = values.constructor == Array ? values[i] : i;\n            if (name != null && name.constructor !== String) {\n                name = name.content === undefined ? String(name) : name.content;\n            }\n            var value = values[i];\n            this.addItem(name, value, options);\n            num++;\n        }\n\n        //close on leave? touch enabled devices won't work TODO use a global device detector and condition on that\n        /*LiteGraph.pointerListenerAdd(root,\"leave\", function(e) {\n\t\t  \tconsole.log(\"pointerevents: ContextMenu leave\");\n            if (that.lock) {\n                return;\n            }\n            if (root.closing_timer) {\n                clearTimeout(root.closing_timer);\n            }\n            root.closing_timer = setTimeout(that.close.bind(that, e), 500);\n            //that.close(e);\n        });*/\n\n\t\tLiteGraph.pointerListenerAdd(root,\"enter\", function(e) {\n\t\t  \t//console.log(\"pointerevents: ContextMenu enter\");\n            if (root.closing_timer) {\n                clearTimeout(root.closing_timer);\n            }\n        });\n\n        //insert before checking position\n        var root_document = document;\n        if (options.event) {\n            root_document = options.event.target.ownerDocument;\n        }\n\n        if (!root_document) {\n            root_document = document;\n        }\n\n\t\tif( root_document.fullscreenElement )\n\t        root_document.fullscreenElement.appendChild(root);\n\t\telse\n\t\t    root_document.body.appendChild(root);\n\n        //compute best position\n        var left = options.left || 0;\n        var top = options.top || 0;\n        if (options.event) {\n            left = options.event.clientX - 10;\n            top = options.event.clientY - 10;\n            if (options.title) {\n                top -= 20;\n            }\n\n            if (options.parentMenu) {\n                var rect = options.parentMenu.root.getBoundingClientRect();\n                left = rect.left + rect.width;\n            }\n\n            var body_rect = document.body.getBoundingClientRect();\n            var root_rect = root.getBoundingClientRect();\n\t\t\tif(body_rect.height == 0)\n\t\t\t\tconsole.error(\"document.body height is 0. That is dangerous, set html,body { height: 100%; }\");\n\n            if (body_rect.width && left > body_rect.width - root_rect.width - 10) {\n                left = body_rect.width - root_rect.width - 10;\n            }\n            if (body_rect.height && top > body_rect.height - root_rect.height - 10) {\n                top = body_rect.height - root_rect.height - 10;\n            }\n        }\n\n        root.style.left = left + \"px\";\n        root.style.top = top + \"px\";\n\n        if (options.scale) {\n            root.style.transform = \"scale(\" + options.scale + \")\";\n        }\n    }\n\n    ContextMenu.prototype.addItem = function(name, value, options) {\n        var that = this;\n        options = options || {};\n\n        var element = document.createElement(\"div\");\n        element.className = \"litemenu-entry submenu\";\n\n        var disabled = false;\n\n        if (value === null) {\n            element.classList.add(\"separator\");\n            //element.innerHTML = \"<hr/>\"\n            //continue;\n        } else {\n            element.innerHTML = value && value.title ? value.title : name;\n            element.value = value;\n\n            if (value) {\n                if (value.disabled) {\n                    disabled = true;\n                    element.classList.add(\"disabled\");\n                }\n                if (value.submenu || value.has_submenu) {\n                    element.classList.add(\"has_submenu\");\n                }\n            }\n\n            if (typeof value == \"function\") {\n                element.dataset[\"value\"] = name;\n                element.onclick_callback = value;\n            } else {\n                element.dataset[\"value\"] = value;\n            }\n\n            if (value.className) {\n                element.className += \" \" + value.className;\n            }\n        }\n\n        this.root.appendChild(element);\n        if (!disabled) {\n            element.addEventListener(\"click\", inner_onclick);\n        }\n        if (!disabled && options.autoopen) {\n\t\t\tLiteGraph.pointerListenerAdd(element,\"enter\",inner_over);\n        }\n\n        function inner_over(e) {\n            var value = this.value;\n            if (!value || !value.has_submenu) {\n                return;\n            }\n            //if it is a submenu, autoopen like the item was clicked\n            inner_onclick.call(this, e);\n        }\n\n        //menu option clicked\n        function inner_onclick(e) {\n            var value = this.value;\n            var close_parent = true;\n\n            if (that.current_submenu) {\n                that.current_submenu.close(e);\n            }\n\n            //global callback\n            if (options.callback) {\n                var r = options.callback.call(\n                    this,\n                    value,\n                    options,\n                    e,\n                    that,\n                    options.node\n                );\n                if (r === true) {\n                    close_parent = false;\n                }\n            }\n\n            //special cases\n            if (value) {\n                if (\n                    value.callback &&\n                    !options.ignore_item_callbacks &&\n                    value.disabled !== true\n                ) {\n                    //item callback\n                    var r = value.callback.call(\n                        this,\n                        value,\n                        options,\n                        e,\n                        that,\n                        options.extra\n                    );\n                    if (r === true) {\n                        close_parent = false;\n                    }\n                }\n                if (value.submenu) {\n                    if (!value.submenu.options) {\n                        throw \"ContextMenu submenu needs options\";\n                    }\n                    var submenu = new that.constructor(value.submenu.options, {\n                        callback: value.submenu.callback,\n                        event: e,\n                        parentMenu: that,\n                        ignore_item_callbacks:\n                            value.submenu.ignore_item_callbacks,\n                        title: value.submenu.title,\n                        extra: value.submenu.extra,\n                        autoopen: options.autoopen\n                    });\n                    close_parent = false;\n                }\n            }\n\n            if (close_parent && !that.lock) {\n                that.close();\n            }\n        }\n\n        return element;\n    };\n\n    ContextMenu.prototype.close = function(e, ignore_parent_menu) {\n        if (this.root.parentNode) {\n            this.root.parentNode.removeChild(this.root);\n        }\n        if (this.parentMenu && !ignore_parent_menu) {\n            this.parentMenu.lock = false;\n            this.parentMenu.current_submenu = null;\n            if (e === undefined) {\n                this.parentMenu.close();\n            } else if (\n                e &&\n                !ContextMenu.isCursorOverElement(e, this.parentMenu.root)\n            ) {\n                ContextMenu.trigger(this.parentMenu.root, LiteGraph.pointerevents_method+\"leave\", e);\n            }\n        }\n        if (this.current_submenu) {\n            this.current_submenu.close(e, true);\n        }\n\n        if (this.root.closing_timer) {\n            clearTimeout(this.root.closing_timer);\n        }\n        \n        // TODO implement : LiteGraph.contextMenuClosed(); :: keep track of opened / closed / current ContextMenu\n        // on key press, allow filtering/selecting the context menu elements\n    };\n\n    //this code is used to trigger events easily (used in the context menu mouseleave\n    ContextMenu.trigger = function(element, event_name, params, origin) {\n        var evt = document.createEvent(\"CustomEvent\");\n        evt.initCustomEvent(event_name, true, true, params); //canBubble, cancelable, detail\n        evt.srcElement = origin;\n        if (element.dispatchEvent) {\n            element.dispatchEvent(evt);\n        } else if (element.__events) {\n            element.__events.dispatchEvent(evt);\n        }\n        //else nothing seems binded here so nothing to do\n        return evt;\n    };\n\n    //returns the top most menu\n    ContextMenu.prototype.getTopMenu = function() {\n        if (this.options.parentMenu) {\n            return this.options.parentMenu.getTopMenu();\n        }\n        return this;\n    };\n\n    ContextMenu.prototype.getFirstEvent = function() {\n        if (this.options.parentMenu) {\n            return this.options.parentMenu.getFirstEvent();\n        }\n        return this.options.event;\n    };\n\n    ContextMenu.isCursorOverElement = function(event, element) {\n        var left = event.clientX;\n        var top = event.clientY;\n        var rect = element.getBoundingClientRect();\n        if (!rect) {\n            return false;\n        }\n        if (\n            top > rect.top &&\n            top < rect.top + rect.height &&\n            left > rect.left &&\n            left < rect.left + rect.width\n        ) {\n            return true;\n        }\n        return false;\n    };\n\n    LiteGraph.ContextMenu = ContextMenu;\n\n    LiteGraph.closeAllContextMenus = function(ref_window) {\n        ref_window = ref_window || window;\n\n        var elements = ref_window.document.querySelectorAll(\".litecontextmenu\");\n        if (!elements.length) {\n            return;\n        }\n\n        var result = [];\n        for (var i = 0; i < elements.length; i++) {\n            result.push(elements[i]);\n        }\n\n        for (var i=0; i < result.length; i++) {\n            if (result[i].close) {\n                result[i].close();\n            } else if (result[i].parentNode) {\n                result[i].parentNode.removeChild(result[i]);\n            }\n        }\n    };\n\n    LiteGraph.extendClass = function(target, origin) {\n        for (var i in origin) {\n            //copy class properties\n            if (target.hasOwnProperty(i)) {\n                continue;\n            }\n            target[i] = origin[i];\n        }\n\n        if (origin.prototype) {\n            //copy prototype properties\n            for (var i in origin.prototype) {\n                //only enumerable\n                if (!origin.prototype.hasOwnProperty(i)) {\n                    continue;\n                }\n\n                if (target.prototype.hasOwnProperty(i)) {\n                    //avoid overwriting existing ones\n                    continue;\n                }\n\n                //copy getters\n                if (origin.prototype.__lookupGetter__(i)) {\n                    target.prototype.__defineGetter__(\n                        i,\n                        origin.prototype.__lookupGetter__(i)\n                    );\n                } else {\n                    target.prototype[i] = origin.prototype[i];\n                }\n\n                //and setters\n                if (origin.prototype.__lookupSetter__(i)) {\n                    target.prototype.__defineSetter__(\n                        i,\n                        origin.prototype.__lookupSetter__(i)\n                    );\n                }\n            }\n        }\n    };\n\n\t//used by some widgets to render a curve editor\n\tfunction CurveEditor( points )\n\t{\n\t\tthis.points = points;\n\t\tthis.selected = -1;\n\t\tthis.nearest = -1;\n\t\tthis.size = null; //stores last size used\n\t\tthis.must_update = true;\n\t\tthis.margin = 5;\n\t}\n\n\tCurveEditor.sampleCurve = function(f,points)\n\t{\n\t\tif(!points)\n\t\t\treturn;\n\t\tfor(var i = 0; i < points.length - 1; ++i)\n\t\t{\n\t\t\tvar p = points[i];\n\t\t\tvar pn = points[i+1];\n\t\t\tif(pn[0] < f)\n\t\t\t\tcontinue;\n\t\t\tvar r = (pn[0] - p[0]);\n\t\t\tif( Math.abs(r) < 0.00001 )\n\t\t\t\treturn p[1];\n\t\t\tvar local_f = (f - p[0]) / r;\n\t\t\treturn p[1] * (1.0 - local_f) + pn[1] * local_f;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tCurveEditor.prototype.draw = function( ctx, size, graphcanvas, background_color, line_color, inactive )\n\t{\n\t\tvar points = this.points;\n\t\tif(!points)\n\t\t\treturn;\n\t\tthis.size = size;\n\t\tvar w = size[0] - this.margin * 2;\n\t\tvar h = size[1] - this.margin * 2;\n\n\t\tline_color = line_color || \"#666\";\n\n\t\tctx.save();\n\t\tctx.translate(this.margin,this.margin);\n\n\t\tif(background_color)\n\t\t{\n\t\t\tctx.fillStyle = \"#111\";\n\t\t\tctx.fillRect(0,0,w,h);\n\t\t\tctx.fillStyle = \"#222\";\n\t\t\tctx.fillRect(w*0.5,0,1,h);\n\t\t\tctx.strokeStyle = \"#333\";\n\t\t\tctx.strokeRect(0,0,w,h);\n\t\t}\n\t\tctx.strokeStyle = line_color;\n\t\tif(inactive)\n\t\t\tctx.globalAlpha = 0.5;\n\t\tctx.beginPath();\n\t\tfor(var i = 0; i < points.length; ++i)\n\t\t{\n\t\t\tvar p = points[i];\n\t\t\tctx.lineTo( p[0] * w, (1.0 - p[1]) * h );\n\t\t}\n\t\tctx.stroke();\n\t\tctx.globalAlpha = 1;\n\t\tif(!inactive)\n\t\t\tfor(var i = 0; i < points.length; ++i)\n\t\t\t{\n\t\t\t\tvar p = points[i];\n\t\t\t\tctx.fillStyle = this.selected == i ? \"#FFF\" : (this.nearest == i ? \"#DDD\" : \"#AAA\");\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.arc( p[0] * w, (1.0 - p[1]) * h, 2, 0, Math.PI * 2 );\n\t\t\t\tctx.fill();\n\t\t\t}\n\t\tctx.restore();\n\t}\n\n\t//localpos is mouse in curve editor space\n\tCurveEditor.prototype.onMouseDown = function( localpos, graphcanvas )\n\t{\n\t\tvar points = this.points;\n\t\tif(!points)\n\t\t\treturn;\n\t\tif( localpos[1] < 0 )\n\t\t\treturn;\n\n\t\t//this.captureInput(true);\n\t\tvar w = this.size[0] - this.margin * 2;\n\t\tvar h = this.size[1] - this.margin * 2;\n\t\tvar x = localpos[0] - this.margin;\n\t\tvar y = localpos[1] - this.margin;\n\t\tvar pos = [x,y];\n\t\tvar max_dist = 30 / graphcanvas.ds.scale;\n\t\t//search closer one\n\t\tthis.selected = this.getCloserPoint(pos, max_dist);\n\t\t//create one\n\t\tif(this.selected == -1)\n\t\t{\n\t\t\tvar point = [x / w, 1 - y / h];\n\t\t\tpoints.push(point);\n\t\t\tpoints.sort(function(a,b){ return a[0] - b[0]; });\n\t\t\tthis.selected = points.indexOf(point);\n\t\t\tthis.must_update = true;\n\t\t}\n\t\tif(this.selected != -1)\n\t\t\treturn true;\n\t}\n\n\tCurveEditor.prototype.onMouseMove = function( localpos, graphcanvas )\n\t{\n\t\tvar points = this.points;\n\t\tif(!points)\n\t\t\treturn;\n\t\tvar s = this.selected;\n\t\tif(s < 0)\n\t\t\treturn;\n\t\tvar x = (localpos[0] - this.margin) / (this.size[0] - this.margin * 2 );\n\t\tvar y = (localpos[1] - this.margin) / (this.size[1] - this.margin * 2 );\n\t\tvar curvepos = [(localpos[0] - this.margin),(localpos[1] - this.margin)];\n\t\tvar max_dist = 30 / graphcanvas.ds.scale;\n\t\tthis._nearest = this.getCloserPoint(curvepos, max_dist);\n\t\tvar point = points[s];\n\t\tif(point)\n\t\t{\n\t\t\tvar is_edge_point = s == 0 || s == points.length - 1;\n\t\t\tif( !is_edge_point && (localpos[0] < -10 || localpos[0] > this.size[0] + 10 || localpos[1] < -10 || localpos[1] > this.size[1] + 10) )\n\t\t\t{\n\t\t\t\tpoints.splice(s,1);\n\t\t\t\tthis.selected = -1;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif( !is_edge_point ) //not edges\n\t\t\t\tpoint[0] = clamp(x, 0, 1);\n\t\t\telse\n\t\t\t\tpoint[0] = s == 0 ? 0 : 1;\n\t\t\tpoint[1] = 1.0 - clamp(y, 0, 1);\n\t\t\tpoints.sort(function(a,b){ return a[0] - b[0]; });\n\t\t\tthis.selected = points.indexOf(point);\n\t\t\tthis.must_update = true;\n\t\t}\n\t}\n\n\tCurveEditor.prototype.onMouseUp = function( localpos, graphcanvas )\n\t{\n\t\tthis.selected = -1;\n\t\treturn false;\n\t}\n\n\tCurveEditor.prototype.getCloserPoint = function(pos, max_dist)\n\t{\n\t\tvar points = this.points;\n\t\tif(!points)\n\t\t\treturn -1;\n\t\tmax_dist = max_dist || 30;\n\t\tvar w = (this.size[0] - this.margin * 2);\n\t\tvar h = (this.size[1] - this.margin * 2);\n\t\tvar num = points.length;\n\t\tvar p2 = [0,0];\n\t\tvar min_dist = 1000000;\n\t\tvar closest = -1;\n\t\tvar last_valid = -1;\n\t\tfor(var i = 0; i < num; ++i)\n\t\t{\n\t\t\tvar p = points[i];\n\t\t\tp2[0] = p[0] * w;\n\t\t\tp2[1] = (1.0 - p[1]) * h;\n\t\t\tif(p2[0] < pos[0])\n\t\t\t\tlast_valid = i;\n\t\t\tvar dist = vec2.distance(pos,p2);\n\t\t\tif(dist > min_dist || dist > max_dist)\n\t\t\t\tcontinue;\n\t\t\tclosest = i;\n\t\t\tmin_dist = dist;\n\t\t}\n\t\treturn closest;\n\t}\n\n\tLiteGraph.CurveEditor = CurveEditor;\n\n    //used to create nodes from wrapping functions\n    LiteGraph.getParameterNames = function(func) {\n        return (func + \"\")\n            .replace(/[/][/].*$/gm, \"\") // strip single-line comments\n            .replace(/\\s+/g, \"\") // strip white space\n            .replace(/[/][*][^/*]*[*][/]/g, \"\") // strip multi-line comments  /**/\n            .split(\"){\", 1)[0]\n            .replace(/^[^(]*[(]/, \"\") // extract the parameters\n            .replace(/=[^,]+/g, \"\") // strip any ES6 defaults\n            .split(\",\")\n            .filter(Boolean); // split & filter [\"\"]\n    };\n\n\t/* helper for interaction: pointer, touch, mouse Listeners\n\tused by LGraphCanvas DragAndScale ContextMenu*/\n\tLiteGraph.pointerListenerAdd = function(oDOM, sEvIn, fCall, capture=false) {\n\t\tif (!oDOM || !oDOM.addEventListener || !sEvIn || typeof fCall!==\"function\"){\n\t\t\t//console.log(\"cant pointerListenerAdd \"+oDOM+\", \"+sEvent+\", \"+fCall);\n\t\t\treturn; // -- break --\n\t\t}\n\t\t\n\t\tvar sMethod = LiteGraph.pointerevents_method;\n\t\tvar sEvent = sEvIn;\n\t\t\n\t\t// UNDER CONSTRUCTION\n\t\t// convert pointerevents to touch event when not available\n\t\tif (sMethod==\"pointer\" && !window.PointerEvent){ \n\t\t\tconsole.warn(\"sMethod=='pointer' && !window.PointerEvent\");\n\t\t\tconsole.log(\"Converting pointer[\"+sEvent+\"] : down move up cancel enter TO touchstart touchmove touchend, etc ..\");\n\t\t\tswitch(sEvent){\n\t\t\t\tcase \"down\":{\n\t\t\t\t\tsMethod = \"touch\";\n\t\t\t\t\tsEvent = \"start\";\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"move\":{\n\t\t\t\t\tsMethod = \"touch\";\n\t\t\t\t\t//sEvent = \"move\";\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"up\":{\n\t\t\t\t\tsMethod = \"touch\";\n\t\t\t\t\tsEvent = \"end\";\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"cancel\":{\n\t\t\t\t\tsMethod = \"touch\";\n\t\t\t\t\t//sEvent = \"cancel\";\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"enter\":{\n\t\t\t\t\tconsole.log(\"debug: Should I send a move event?\"); // ???\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// case \"over\": case \"out\": not used at now\n\t\t\t\tdefault:{\n\t\t\t\t\tconsole.warn(\"PointerEvent not available in this browser ? The event \"+sEvent+\" would not be called\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tswitch(sEvent){\n\t\t\t//both pointer and move events\n\t\t\tcase \"down\": case \"up\": case \"move\": case \"over\": case \"out\": case \"enter\":\n\t\t\t{\n\t\t\t\toDOM.addEventListener(sMethod+sEvent, fCall, capture);\n\t\t\t}\n\t\t\t// only pointerevents\n\t\t\tcase \"leave\": case \"cancel\": case \"gotpointercapture\": case \"lostpointercapture\":\n\t\t\t{\n\t\t\t\tif (sMethod!=\"mouse\"){\n\t\t\t\t\treturn oDOM.addEventListener(sMethod+sEvent, fCall, capture);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// not \"pointer\" || \"mouse\"\n\t\t\tdefault:\n\t\t\t\treturn oDOM.addEventListener(sEvent, fCall, capture);\n\t\t}\n\t}\n\tLiteGraph.pointerListenerRemove = function(oDOM, sEvent, fCall, capture=false) {\n\t\tif (!oDOM || !oDOM.removeEventListener || !sEvent || typeof fCall!==\"function\"){\n\t\t\t//console.log(\"cant pointerListenerRemove \"+oDOM+\", \"+sEvent+\", \"+fCall);\n\t\t\treturn; // -- break --\n\t\t}\n\t\tswitch(sEvent){\n\t\t\t//both pointer and move events\n\t\t\tcase \"down\": case \"up\": case \"move\": case \"over\": case \"out\": case \"enter\":\n\t\t\t{\n\t\t\t\tif (LiteGraph.pointerevents_method==\"pointer\" || LiteGraph.pointerevents_method==\"mouse\"){\n\t\t\t\t\toDOM.removeEventListener(LiteGraph.pointerevents_method+sEvent, fCall, capture);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// only pointerevents\n\t\t\tcase \"leave\": case \"cancel\": case \"gotpointercapture\": case \"lostpointercapture\":\n\t\t\t{\n\t\t\t\tif (LiteGraph.pointerevents_method==\"pointer\"){\n\t\t\t\t\treturn oDOM.removeEventListener(LiteGraph.pointerevents_method+sEvent, fCall, capture);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// not \"pointer\" || \"mouse\"\n\t\t\tdefault:\n\t\t\t\treturn oDOM.removeEventListener(sEvent, fCall, capture);\n\t\t}\n\t}\n\n    function clamp(v, a, b) {\n        return a > v ? a : b < v ? b : v;\n    };\n    global.clamp = clamp;\n\n    if (typeof window != \"undefined\" && !window[\"requestAnimationFrame\"]) {\n        window.requestAnimationFrame =\n            window.webkitRequestAnimationFrame ||\n            window.mozRequestAnimationFrame ||\n            function(callback) {\n                window.setTimeout(callback, 1000 / 60);\n            };\n    }\n})(this);\n\nif (typeof exports != \"undefined\") {\n    exports.LiteGraph = this.LiteGraph;\n    exports.LGraph = this.LGraph;\n    exports.LLink = this.LLink;\n    exports.LGraphNode = this.LGraphNode;\n    exports.LGraphGroup = this.LGraphGroup;\n    exports.DragAndScale = this.DragAndScale;\n    exports.LGraphCanvas = this.LGraphCanvas;\n    exports.ContextMenu = this.ContextMenu;\n}\n\n\n//basic nodes\r\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n    //Constant\r\n    function Time() {\r\n        this.addOutput(\"in ms\", \"number\");\r\n        this.addOutput(\"in sec\", \"number\");\r\n    }\r\n\r\n    Time.title = \"Time\";\r\n    Time.desc = \"Time\";\r\n\r\n    Time.prototype.onExecute = function() {\r\n        this.setOutputData(0, this.graph.globaltime * 1000);\r\n        this.setOutputData(1, this.graph.globaltime);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/time\", Time);\r\n\r\n    //Subgraph: a node that contains a graph\r\n    function Subgraph() {\r\n        var that = this;\r\n        this.size = [140, 80];\r\n        this.properties = { enabled: true };\r\n        this.enabled = true;\r\n\r\n        //create inner graph\r\n        this.subgraph = new LiteGraph.LGraph();\r\n        this.subgraph._subgraph_node = this;\r\n        this.subgraph._is_subgraph = true;\r\n\r\n        this.subgraph.onTrigger = this.onSubgraphTrigger.bind(this);\r\n\r\n\t\t//nodes input node added inside\r\n        this.subgraph.onInputAdded = this.onSubgraphNewInput.bind(this);\r\n        this.subgraph.onInputRenamed = this.onSubgraphRenamedInput.bind(this);\r\n        this.subgraph.onInputTypeChanged = this.onSubgraphTypeChangeInput.bind(this);\r\n        this.subgraph.onInputRemoved = this.onSubgraphRemovedInput.bind(this);\r\n\r\n        this.subgraph.onOutputAdded = this.onSubgraphNewOutput.bind(this);\r\n        this.subgraph.onOutputRenamed = this.onSubgraphRenamedOutput.bind(this);\r\n        this.subgraph.onOutputTypeChanged = this.onSubgraphTypeChangeOutput.bind(this);\r\n        this.subgraph.onOutputRemoved = this.onSubgraphRemovedOutput.bind(this);\r\n    }\r\n\r\n    Subgraph.title = \"Subgraph\";\r\n    Subgraph.desc = \"Graph inside a node\";\r\n    Subgraph.title_color = \"#334\";\r\n\r\n    Subgraph.prototype.onGetInputs = function() {\r\n        return [[\"enabled\", \"boolean\"]];\r\n    };\r\n\r\n\t/*\r\n    Subgraph.prototype.onDrawTitle = function(ctx) {\r\n        if (this.flags.collapsed) {\r\n            return;\r\n        }\r\n\r\n        ctx.fillStyle = \"#555\";\r\n        var w = LiteGraph.NODE_TITLE_HEIGHT;\r\n        var x = this.size[0] - w;\r\n        ctx.fillRect(x, -w, w, w);\r\n        ctx.fillStyle = \"#333\";\r\n        ctx.beginPath();\r\n        ctx.moveTo(x + w * 0.2, -w * 0.6);\r\n        ctx.lineTo(x + w * 0.8, -w * 0.6);\r\n        ctx.lineTo(x + w * 0.5, -w * 0.3);\r\n        ctx.fill();\r\n    };\r\n\t*/\r\n\r\n    Subgraph.prototype.onDblClick = function(e, pos, graphcanvas) {\r\n        var that = this;\r\n        setTimeout(function() {\r\n            graphcanvas.openSubgraph(that.subgraph);\r\n        }, 10);\r\n    };\r\n\r\n\t/*\r\n    Subgraph.prototype.onMouseDown = function(e, pos, graphcanvas) {\r\n        if (\r\n            !this.flags.collapsed &&\r\n            pos[0] > this.size[0] - LiteGraph.NODE_TITLE_HEIGHT &&\r\n            pos[1] < 0\r\n        ) {\r\n            var that = this;\r\n            setTimeout(function() {\r\n                graphcanvas.openSubgraph(that.subgraph);\r\n            }, 10);\r\n        }\r\n    };\r\n\t*/\r\n\r\n    Subgraph.prototype.onAction = function(action, param) {\r\n        this.subgraph.onAction(action, param);\r\n    };\r\n\r\n    Subgraph.prototype.onExecute = function() {\r\n        this.enabled = this.getInputOrProperty(\"enabled\");\r\n        if (!this.enabled) {\r\n            return;\r\n        }\r\n\r\n        //send inputs to subgraph global inputs\r\n        if (this.inputs) {\r\n            for (var i = 0; i < this.inputs.length; i++) {\r\n                var input = this.inputs[i];\r\n                var value = this.getInputData(i);\r\n                this.subgraph.setInputData(input.name, value);\r\n            }\r\n        }\r\n\r\n        //execute\r\n        this.subgraph.runStep();\r\n\r\n        //send subgraph global outputs to outputs\r\n        if (this.outputs) {\r\n            for (var i = 0; i < this.outputs.length; i++) {\r\n                var output = this.outputs[i];\r\n                var value = this.subgraph.getOutputData(output.name);\r\n                this.setOutputData(i, value);\r\n            }\r\n        }\r\n    };\r\n\r\n    Subgraph.prototype.sendEventToAllNodes = function(eventname, param, mode) {\r\n        if (this.enabled) {\r\n            this.subgraph.sendEventToAllNodes(eventname, param, mode);\r\n        }\r\n    };\r\n\r\n    Subgraph.prototype.onDrawBackground = function (ctx, graphcanvas, canvas, pos) {\r\n        if (this.flags.collapsed)\r\n            return;\r\n        var y = this.size[1] - LiteGraph.NODE_TITLE_HEIGHT + 0.5;\r\n        // button\r\n        var over = LiteGraph.isInsideRectangle(pos[0], pos[1], this.pos[0], this.pos[1] + y, this.size[0], LiteGraph.NODE_TITLE_HEIGHT);\r\n        let overleft = LiteGraph.isInsideRectangle(pos[0], pos[1], this.pos[0], this.pos[1] + y, this.size[0] / 2, LiteGraph.NODE_TITLE_HEIGHT)\r\n        ctx.fillStyle = over ? \"#555\" : \"#222\";\r\n        ctx.beginPath();\r\n        if (this._shape == LiteGraph.BOX_SHAPE) {\r\n            if (overleft) {\r\n                ctx.rect(0, y, this.size[0] / 2 + 1, LiteGraph.NODE_TITLE_HEIGHT);\r\n            } else {\r\n                ctx.rect(this.size[0] / 2, y, this.size[0] / 2 + 1, LiteGraph.NODE_TITLE_HEIGHT);\r\n            }\r\n        }\r\n        else {\r\n            if (overleft) {\r\n                ctx.roundRect(0, y, this.size[0] / 2 + 1, LiteGraph.NODE_TITLE_HEIGHT, [0,0, 8,8]);\r\n            } else {\r\n                ctx.roundRect(this.size[0] / 2, y, this.size[0] / 2 + 1, LiteGraph.NODE_TITLE_HEIGHT, [0,0, 8,8]);\r\n            }\r\n        }\r\n        if (over) {\r\n            ctx.fill();\r\n        } else {\r\n            ctx.fillRect(0, y, this.size[0] + 1, LiteGraph.NODE_TITLE_HEIGHT);\r\n        }\r\n        // button\r\n        ctx.textAlign = \"center\";\r\n        ctx.font = \"24px Arial\";\r\n        ctx.fillStyle = over ? \"#DDD\" : \"#999\";\r\n        ctx.fillText(\"+\", this.size[0] * 0.25, y + 24);\r\n        ctx.fillText(\"+\", this.size[0] * 0.75, y + 24);\r\n    }\r\n\r\n    // Subgraph.prototype.onMouseDown = function(e, localpos, graphcanvas)\r\n    // {\r\n    // \tvar y = this.size[1] - LiteGraph.NODE_TITLE_HEIGHT + 0.5;\r\n    // \tif(localpos[1] > y)\r\n    // \t{\r\n    // \t\tgraphcanvas.showSubgraphPropertiesDialog(this);\r\n    // \t}\r\n    // }\r\n    Subgraph.prototype.onMouseDown = function (e, localpos, graphcanvas) {\r\n        var y = this.size[1] - LiteGraph.NODE_TITLE_HEIGHT + 0.5;\r\n        console.log(0)\r\n        if (localpos[1] > y) {\r\n            if (localpos[0] < this.size[0] / 2) {\r\n                console.log(1)\r\n                graphcanvas.showSubgraphPropertiesDialog(this);\r\n            } else {\r\n                console.log(2)\r\n                graphcanvas.showSubgraphPropertiesDialogRight(this);\r\n            }\r\n        }\r\n    }\r\n\tSubgraph.prototype.computeSize = function()\r\n\t{\r\n\t\tvar num_inputs = this.inputs ? this.inputs.length : 0;\r\n\t\tvar num_outputs = this.outputs ? this.outputs.length : 0;\r\n\t\treturn [ 200, Math.max(num_inputs,num_outputs) * LiteGraph.NODE_SLOT_HEIGHT + LiteGraph.NODE_TITLE_HEIGHT ];\r\n\t}\r\n\r\n    //**** INPUTS ***********************************\r\n    Subgraph.prototype.onSubgraphTrigger = function(event, param) {\r\n        var slot = this.findOutputSlot(event);\r\n        if (slot != -1) {\r\n            this.triggerSlot(slot);\r\n        }\r\n    };\r\n\r\n    Subgraph.prototype.onSubgraphNewInput = function(name, type) {\r\n        var slot = this.findInputSlot(name);\r\n        if (slot == -1) {\r\n            //add input to the node\r\n            this.addInput(name, type);\r\n        }\r\n    };\r\n\r\n    Subgraph.prototype.onSubgraphRenamedInput = function(oldname, name) {\r\n        var slot = this.findInputSlot(oldname);\r\n        if (slot == -1) {\r\n            return;\r\n        }\r\n        var info = this.getInputInfo(slot);\r\n        info.name = name;\r\n    };\r\n\r\n    Subgraph.prototype.onSubgraphTypeChangeInput = function(name, type) {\r\n        var slot = this.findInputSlot(name);\r\n        if (slot == -1) {\r\n            return;\r\n        }\r\n        var info = this.getInputInfo(slot);\r\n        info.type = type;\r\n    };\r\n\r\n    Subgraph.prototype.onSubgraphRemovedInput = function(name) {\r\n        var slot = this.findInputSlot(name);\r\n        if (slot == -1) {\r\n            return;\r\n        }\r\n        this.removeInput(slot);\r\n    };\r\n\r\n    //**** OUTPUTS ***********************************\r\n    Subgraph.prototype.onSubgraphNewOutput = function(name, type) {\r\n        var slot = this.findOutputSlot(name);\r\n        if (slot == -1) {\r\n            this.addOutput(name, type);\r\n        }\r\n    };\r\n\r\n    Subgraph.prototype.onSubgraphRenamedOutput = function(oldname, name) {\r\n        var slot = this.findOutputSlot(oldname);\r\n        if (slot == -1) {\r\n            return;\r\n        }\r\n        var info = this.getOutputInfo(slot);\r\n        info.name = name;\r\n    };\r\n\r\n    Subgraph.prototype.onSubgraphTypeChangeOutput = function(name, type) {\r\n        var slot = this.findOutputSlot(name);\r\n        if (slot == -1) {\r\n            return;\r\n        }\r\n        var info = this.getOutputInfo(slot);\r\n        info.type = type;\r\n    };\r\n\r\n    Subgraph.prototype.onSubgraphRemovedOutput = function(name) {\r\n        var slot = this.findOutputSlot(name);\r\n        if (slot == -1) {\r\n            return;\r\n        }\r\n        this.removeOutput(slot);\r\n    };\r\n    // *****************************************************\r\n\r\n    Subgraph.prototype.getExtraMenuOptions = function(graphcanvas) {\r\n        var that = this;\r\n        return [\r\n            {\r\n                content: \"Open\",\r\n                callback: function() {\r\n                    graphcanvas.openSubgraph(that.subgraph);\r\n                }\r\n            }\r\n        ];\r\n    };\r\n\r\n    Subgraph.prototype.onResize = function(size) {\r\n        size[1] += 20;\r\n    };\r\n\r\n    Subgraph.prototype.serialize = function() {\r\n        var data = LiteGraph.LGraphNode.prototype.serialize.call(this);\r\n        data.subgraph = this.subgraph.serialize();\r\n        return data;\r\n    };\r\n    //no need to define node.configure, the default method detects node.subgraph and passes the object to node.subgraph.configure()\r\n\r\n    Subgraph.prototype.reassignSubgraphUUIDs = function(graph) {\r\n        const idMap = { nodeIDs: {}, linkIDs: {} }\r\n\r\n        for (const node of graph.nodes) {\r\n            const oldID = node.id\r\n            const newID = LiteGraph.uuidv4()\r\n            node.id = newID\r\n\r\n            if (idMap.nodeIDs[oldID] || idMap.nodeIDs[newID]) {\r\n                throw new Error(`New/old node UUID wasn't unique in changed map! ${oldID} ${newID}`)\r\n            }\r\n\r\n            idMap.nodeIDs[oldID] = newID\r\n            idMap.nodeIDs[newID] = oldID\r\n        }\r\n\r\n        for (const link of graph.links) {\r\n            const oldID = link[0]\r\n            const newID = LiteGraph.uuidv4();\r\n            link[0] = newID\r\n\r\n            if (idMap.linkIDs[oldID] || idMap.linkIDs[newID]) {\r\n                throw new Error(`New/old link UUID wasn't unique in changed map! ${oldID} ${newID}`)\r\n            }\r\n\r\n            idMap.linkIDs[oldID] = newID\r\n            idMap.linkIDs[newID] = oldID\r\n\r\n            const nodeFrom = link[1]\r\n            const nodeTo = link[3]\r\n\r\n            if (!idMap.nodeIDs[nodeFrom]) {\r\n                throw new Error(`Old node UUID not found in mapping! ${nodeFrom}`)\r\n            }\r\n\r\n            link[1] = idMap.nodeIDs[nodeFrom]\r\n\r\n            if (!idMap.nodeIDs[nodeTo]) {\r\n                throw new Error(`Old node UUID not found in mapping! ${nodeTo}`)\r\n            }\r\n\r\n            link[3] = idMap.nodeIDs[nodeTo]\r\n        }\r\n\r\n        // Reconnect links\r\n        for (const node of graph.nodes) {\r\n            if (node.inputs) {\r\n                for (const input of node.inputs) {\r\n                    if (input.link) {\r\n                        input.link = idMap.linkIDs[input.link]\r\n                    }\r\n                }\r\n            }\r\n            if (node.outputs) {\r\n                for (const output of node.outputs) {\r\n                    if (output.links) {\r\n                        output.links = output.links.map(l => idMap.linkIDs[l]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Recurse!\r\n        for (const node of graph.nodes) {\r\n            if (node.type === \"graph/subgraph\") {\r\n                const merge = reassignGraphUUIDs(node.subgraph);\r\n                idMap.nodeIDs.assign(merge.nodeIDs)\r\n                idMap.linkIDs.assign(merge.linkIDs)\r\n            }\r\n        }\r\n    };\r\n\r\n    Subgraph.prototype.clone = function() {\r\n        var node = LiteGraph.createNode(this.type);\r\n        var data = this.serialize();\r\n\r\n        if (LiteGraph.use_uuids) {\r\n            // LGraph.serialize() seems to reuse objects in the original graph. But we\r\n            // need to change node IDs here, so clone it first.\r\n            const subgraph = LiteGraph.cloneObject(data.subgraph)\r\n\r\n            this.reassignSubgraphUUIDs(subgraph);\r\n\r\n            data.subgraph = subgraph;\r\n        }\r\n\r\n        delete data[\"id\"];\r\n        delete data[\"inputs\"];\r\n        delete data[\"outputs\"];\r\n        node.configure(data);\r\n        return node;\r\n    };\r\n\r\n\tSubgraph.prototype.buildFromNodes = function(nodes)\r\n\t{\r\n\t\t//clear all?\r\n\t\t//TODO\r\n\r\n\t\t//nodes that connect data between parent graph and subgraph\r\n\t\tvar subgraph_inputs = [];\r\n\t\tvar subgraph_outputs = [];\r\n\r\n\t\t//mark inner nodes\r\n\t\tvar ids = {};\r\n\t\tvar min_x = 0;\r\n\t\tvar max_x = 0;\r\n\t\tfor(var i = 0; i < nodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar node = nodes[i];\r\n\t\t\tids[ node.id ] = node;\r\n\t\t\tmin_x = Math.min( node.pos[0], min_x );\r\n\t\t\tmax_x = Math.max( node.pos[0], min_x );\r\n\t\t}\r\n\t\t\r\n\t\tvar last_input_y = 0;\r\n\t\tvar last_output_y = 0;\r\n\r\n\t\tfor(var i = 0; i < nodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar node = nodes[i];\r\n\t\t\t//check inputs\r\n\t\t\tif( node.inputs )\r\n\t\t\t\tfor(var j = 0; j < node.inputs.length; ++j)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar input = node.inputs[j];\r\n\t\t\t\t\tif( !input || !input.link )\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tvar link = node.graph.links[ input.link ];\r\n\t\t\t\t\tif(!link)\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tif( ids[ link.origin_id ] )\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t//this.addInput(input.name,link.type);\r\n\t\t\t\t\tthis.subgraph.addInput(input.name,link.type);\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tvar input_node = LiteGraph.createNode(\"graph/input\");\r\n\t\t\t\t\tthis.subgraph.add( input_node );\r\n\t\t\t\t\tinput_node.pos = [min_x - 200, last_input_y ];\r\n\t\t\t\t\tlast_input_y += 100;\r\n\t\t\t\t\t*/\r\n\t\t\t\t}\r\n\r\n\t\t\t//check outputs\r\n\t\t\tif( node.outputs )\r\n\t\t\t\tfor(var j = 0; j < node.outputs.length; ++j)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar output = node.outputs[j];\r\n\t\t\t\t\tif( !output || !output.links || !output.links.length )\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tvar is_external = false;\r\n\t\t\t\t\tfor(var k = 0; k < output.links.length; ++k)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar link = node.graph.links[ output.links[k] ];\r\n\t\t\t\t\t\tif(!link)\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\tif( ids[ link.target_id ] )\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\tis_external = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!is_external)\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t//this.addOutput(output.name,output.type);\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tvar output_node = LiteGraph.createNode(\"graph/output\");\r\n\t\t\t\t\tthis.subgraph.add( output_node );\r\n\t\t\t\t\toutput_node.pos = [max_x + 50, last_output_y ];\r\n\t\t\t\t\tlast_output_y += 100;\r\n\t\t\t\t\t*/\r\n\t\t\t\t}\r\n\t\t}\r\n\r\n\t\t//detect inputs and outputs\r\n\t\t\t//split every connection in two data_connection nodes\r\n\t\t\t//keep track of internal connections\r\n\t\t\t//connect external connections\r\n\r\n\t\t//clone nodes inside subgraph and try to reconnect them\r\n\r\n\t\t//connect edge subgraph nodes to extarnal connections nodes\r\n\t}\r\n\r\n    LiteGraph.Subgraph = Subgraph;\r\n    LiteGraph.registerNodeType(\"graph/subgraph\", Subgraph);\r\n\r\n    //Input for a subgraph\r\n    function GraphInput() {\r\n        this.addOutput(\"\", \"number\");\r\n\r\n        this.name_in_graph = \"\";\r\n        this.properties = {\r\n\t\t\tname: \"\",\r\n\t\t\ttype: \"number\",\r\n\t\t\tvalue: 0\r\n\t\t}; \r\n\r\n        var that = this;\r\n\r\n        this.name_widget = this.addWidget(\r\n            \"text\",\r\n            \"Name\",\r\n            this.properties.name,\r\n            function(v) {\r\n                if (!v) {\r\n                    return;\r\n                }\r\n                that.setProperty(\"name\",v);\r\n            }\r\n        );\r\n        this.type_widget = this.addWidget(\r\n            \"text\",\r\n            \"Type\",\r\n            this.properties.type,\r\n            function(v) {\r\n\t\t\t\tthat.setProperty(\"type\",v);\r\n            }\r\n        );\r\n\r\n        this.value_widget = this.addWidget(\r\n            \"number\",\r\n            \"Value\",\r\n            this.properties.value,\r\n            function(v) {\r\n                that.setProperty(\"value\",v);\r\n            }\r\n        );\r\n\r\n        this.widgets_up = true;\r\n        this.size = [180, 90];\r\n    }\r\n\r\n    GraphInput.title = \"Input\";\r\n    GraphInput.desc = \"Input of the graph\";\r\n\r\n\tGraphInput.prototype.onConfigure = function()\r\n\r\n\t{\r\n\t\tthis.updateType();\r\n\t}\r\n\r\n\t//ensures the type in the node output and the type in the associated graph input are the same\r\n\tGraphInput.prototype.updateType = function()\r\n\t{\r\n\t\tvar type = this.properties.type;\r\n\t\tthis.type_widget.value = type;\r\n\r\n\t\t//update output\r\n\t\tif(this.outputs[0].type != type)\r\n\t\t{\r\n\t        if (!LiteGraph.isValidConnection(this.outputs[0].type,type))\r\n\t\t\t\tthis.disconnectOutput(0);\r\n\t\t\tthis.outputs[0].type = type;\r\n\t\t}\r\n\r\n\t\t//update widget\r\n\t\tif(type == \"number\")\r\n\t\t{\r\n\t\t\tthis.value_widget.type = \"number\";\r\n\t\t\tthis.value_widget.value = 0;\r\n\t\t}\r\n\t\telse if(type == \"boolean\")\r\n\t\t{\r\n\t\t\tthis.value_widget.type = \"toggle\";\r\n\t\t\tthis.value_widget.value = true;\r\n\t\t}\r\n\t\telse if(type == \"string\")\r\n\t\t{\r\n\t\t\tthis.value_widget.type = \"text\";\r\n\t\t\tthis.value_widget.value = \"\";\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.value_widget.type = null;\r\n\t\t\tthis.value_widget.value = null;\r\n\t\t}\r\n\t\tthis.properties.value = this.value_widget.value;\r\n\r\n\t\t//update graph\r\n\t\tif (this.graph && this.name_in_graph) {\r\n\t\t\tthis.graph.changeInputType(this.name_in_graph, type);\r\n\t\t}\r\n\t}\r\n\r\n\t//this is executed AFTER the property has changed\r\n\tGraphInput.prototype.onPropertyChanged = function(name,v)\r\n\t{\r\n\t\tif( name == \"name\" )\r\n\t\t{\r\n\t\t\tif (v == \"\" || v == this.name_in_graph || v == \"enabled\") {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif(this.graph)\r\n\t\t\t{\r\n\t\t\t\tif (this.name_in_graph) {\r\n\t\t\t\t\t//already added\r\n\t\t\t\t\tthis.graph.renameInput( this.name_in_graph, v );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.graph.addInput( v, this.properties.type );\r\n\t\t\t\t}\r\n\t\t\t} //what if not?!\r\n\t\t\tthis.name_widget.value = v;\r\n\t\t\tthis.name_in_graph = v;\r\n\t\t}\r\n\t\telse if( name == \"type\" )\r\n\t\t{\r\n\t\t\tthis.updateType();\r\n\t\t}\r\n\t\telse if( name == \"value\" )\r\n\t\t{\r\n\t\t}\r\n\t}\r\n\r\n    GraphInput.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return this.properties.name;\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n    GraphInput.prototype.onAction = function(action, param) {\r\n        if (this.properties.type == LiteGraph.EVENT) {\r\n            this.triggerSlot(0, param);\r\n        }\r\n    };\r\n\r\n    GraphInput.prototype.onExecute = function() {\r\n        var name = this.properties.name;\r\n        //read from global input\r\n        var data = this.graph.inputs[name];\r\n        if (!data) {\r\n            this.setOutputData(0, this.properties.value );\r\n\t\t\treturn;\r\n        }\r\n\r\n        this.setOutputData(0, data.value !== undefined ? data.value : this.properties.value );\r\n    };\r\n\r\n    GraphInput.prototype.onRemoved = function() {\r\n        if (this.name_in_graph) {\r\n            this.graph.removeInput(this.name_in_graph);\r\n        }\r\n    };\r\n\r\n    LiteGraph.GraphInput = GraphInput;\r\n    LiteGraph.registerNodeType(\"graph/input\", GraphInput);\r\n\r\n    //Output for a subgraph\r\n    function GraphOutput() {\r\n        this.addInput(\"\", \"\");\r\n\r\n        this.name_in_graph = \"\";\r\n        this.properties = { name: \"\", type: \"\" };\r\n        var that = this;\r\n\r\n        // Object.defineProperty(this.properties, \"name\", {\r\n        //     get: function() {\r\n        //         return that.name_in_graph;\r\n        //     },\r\n        //     set: function(v) {\r\n        //         if (v == \"\" || v == that.name_in_graph) {\r\n        //             return;\r\n        //         }\r\n        //         if (that.name_in_graph) {\r\n        //             //already added\r\n        //             that.graph.renameOutput(that.name_in_graph, v);\r\n        //         } else {\r\n        //             that.graph.addOutput(v, that.properties.type);\r\n        //         }\r\n        //         that.name_widget.value = v;\r\n        //         that.name_in_graph = v;\r\n        //     },\r\n        //     enumerable: true\r\n        // });\r\n\r\n        // Object.defineProperty(this.properties, \"type\", {\r\n        //     get: function() {\r\n        //         return that.inputs[0].type;\r\n        //     },\r\n        //     set: function(v) {\r\n        //         if (v == \"action\" || v == \"event\") {\r\n        //             v = LiteGraph.ACTION;\r\n        //         }\r\n\t\t//         if (!LiteGraph.isValidConnection(that.inputs[0].type,v))\r\n\t\t// \t\t\tthat.disconnectInput(0);\r\n        //         that.inputs[0].type = v;\r\n        //         if (that.name_in_graph) {\r\n        //             //already added\r\n        //             that.graph.changeOutputType(\r\n        //                 that.name_in_graph,\r\n        //                 that.inputs[0].type\r\n        //             );\r\n        //         }\r\n        //         that.type_widget.value = v || \"\";\r\n        //     },\r\n        //     enumerable: true\r\n        // });\r\n\r\n        this.name_widget = this.addWidget(\"text\",\"Name\",this.properties.name,\"name\");\r\n        this.type_widget = this.addWidget(\"text\",\"Type\",this.properties.type,\"type\");\r\n        this.widgets_up = true;\r\n        this.size = [180, 60];\r\n    }\r\n\r\n    GraphOutput.title = \"Output\";\r\n    GraphOutput.desc = \"Output of the graph\";\r\n\r\n    GraphOutput.prototype.onPropertyChanged = function (name, v) {\r\n        if (name == \"name\") {\r\n            if (v == \"\" || v == this.name_in_graph || v == \"enabled\") {\r\n                return false;\r\n            }\r\n            if (this.graph) {\r\n                if (this.name_in_graph) {\r\n                    //already added\r\n                    this.graph.renameOutput(this.name_in_graph, v);\r\n                } else {\r\n                    this.graph.addOutput(v, this.properties.type);\r\n                }\r\n            } //what if not?!\r\n            this.name_widget.value = v;\r\n            this.name_in_graph = v;\r\n        }\r\n        else if (name == \"type\") {\r\n            this.updateType();\r\n        }\r\n        else if (name == \"value\") {\r\n        }\r\n    }\r\n     \r\n    GraphOutput.prototype.updateType = function () {\r\n        var type = this.properties.type;\r\n        if (this.type_widget)\r\n            this.type_widget.value = type;\r\n\r\n        //update output\r\n        if (this.inputs[0].type != type) {\r\n\r\n\t\t\tif ( type == \"action\" || type == \"event\")\r\n\t            type = LiteGraph.EVENT;\r\n\t\t\tif (!LiteGraph.isValidConnection(this.inputs[0].type, type))\r\n\t\t\t\tthis.disconnectInput(0);\r\n\t\t\tthis.inputs[0].type = type;\r\n        }\r\n\r\n        //update graph\r\n        if (this.graph && this.name_in_graph) {\r\n            this.graph.changeOutputType(this.name_in_graph, type);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    GraphOutput.prototype.onExecute = function() {\r\n        this._value = this.getInputData(0);\r\n        this.graph.setOutputData(this.properties.name, this._value);\r\n    };\r\n\r\n    GraphOutput.prototype.onAction = function(action, param) {\r\n        if (this.properties.type == LiteGraph.ACTION) {\r\n            this.graph.trigger( this.properties.name, param );\r\n        }\r\n    };\r\n\r\n    GraphOutput.prototype.onRemoved = function() {\r\n        if (this.name_in_graph) {\r\n            this.graph.removeOutput(this.name_in_graph);\r\n        }\r\n    };\r\n\r\n    GraphOutput.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return this.properties.name;\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n    LiteGraph.GraphOutput = GraphOutput;\r\n    LiteGraph.registerNodeType(\"graph/output\", GraphOutput);\r\n\r\n    //Constant\r\n    function ConstantNumber() {\r\n        this.addOutput(\"value\", \"number\");\r\n        this.addProperty(\"value\", 1.0);\r\n        this.widget = this.addWidget(\"number\",\"value\",1,\"value\");\r\n        this.widgets_up = true;\r\n        this.size = [180, 30];\r\n    }\r\n\r\n    ConstantNumber.title = \"Const Number\";\r\n    ConstantNumber.desc = \"Constant number\";\r\n\r\n    ConstantNumber.prototype.onExecute = function() {\r\n        this.setOutputData(0, parseFloat(this.properties[\"value\"]));\r\n    };\r\n\r\n    ConstantNumber.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return this.properties.value;\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n\tConstantNumber.prototype.setValue = function(v)\r\n\t{\r\n\t\tthis.setProperty(\"value\",v);\r\n\t}\r\n\r\n    ConstantNumber.prototype.onDrawBackground = function(ctx) {\r\n        //show the current value\r\n        this.outputs[0].label = this.properties[\"value\"].toFixed(3);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/const\", ConstantNumber);\r\n\r\n    function ConstantBoolean() {\r\n        this.addOutput(\"bool\", \"boolean\");\r\n        this.addProperty(\"value\", true);\r\n        this.widget = this.addWidget(\"toggle\",\"value\",true,\"value\");\r\n        this.serialize_widgets = true;\r\n        this.widgets_up = true;\r\n        this.size = [140, 30];\r\n    }\r\n\r\n    ConstantBoolean.title = \"Const Boolean\";\r\n    ConstantBoolean.desc = \"Constant boolean\";\r\n    ConstantBoolean.prototype.getTitle = ConstantNumber.prototype.getTitle;\r\n\r\n    ConstantBoolean.prototype.onExecute = function() {\r\n        this.setOutputData(0, this.properties[\"value\"]);\r\n    };\r\n\r\n\tConstantBoolean.prototype.setValue = ConstantNumber.prototype.setValue;\r\n\r\n\tConstantBoolean.prototype.onGetInputs = function() {\r\n\t\treturn [[\"toggle\", LiteGraph.ACTION]];\r\n\t};\r\n\r\n\tConstantBoolean.prototype.onAction = function(action)\r\n\t{\r\n\t\tthis.setValue( !this.properties.value );\r\n\t}\r\n\r\n    LiteGraph.registerNodeType(\"basic/boolean\", ConstantBoolean);\r\n\r\n    function ConstantString() {\r\n        this.addOutput(\"string\", \"string\");\r\n        this.addProperty(\"value\", \"\");\r\n        this.widget = this.addWidget(\"text\",\"value\",\"\",\"value\");  //link to property value\r\n        this.widgets_up = true;\r\n        this.size = [180, 30];\r\n    }\r\n\r\n    ConstantString.title = \"Const String\";\r\n    ConstantString.desc = \"Constant string\";\r\n\r\n    ConstantString.prototype.getTitle = ConstantNumber.prototype.getTitle;\r\n\r\n    ConstantString.prototype.onExecute = function() {\r\n        this.setOutputData(0, this.properties[\"value\"]);\r\n    };\r\n\r\n\tConstantString.prototype.setValue = ConstantNumber.prototype.setValue;\r\n\r\n\tConstantString.prototype.onDropFile = function(file)\r\n\t{\r\n\t\tvar that = this;\r\n\t\tvar reader = new FileReader();\r\n\t\treader.onload = function(e)\r\n\t\t{\r\n\t\t\tthat.setProperty(\"value\",e.target.result);\r\n\t\t}\r\n\t\treader.readAsText(file);\r\n\t}\r\n\r\n    LiteGraph.registerNodeType(\"basic/string\", ConstantString);\r\n\r\n    function ConstantObject() {\r\n        this.addOutput(\"obj\", \"object\");\r\n        this.size = [120, 30];\r\n\t\tthis._object = {};\r\n    }\r\n\r\n    ConstantObject.title = \"Const Object\";\r\n    ConstantObject.desc = \"Constant Object\";\r\n\r\n    ConstantObject.prototype.onExecute = function() {\r\n        this.setOutputData(0, this._object);\r\n    };\r\n\r\n    LiteGraph.registerNodeType( \"basic/object\", ConstantObject );\r\n\r\n    function ConstantFile() {\r\n        this.addInput(\"url\", \"string\");\r\n        this.addOutput(\"file\", \"string\");\r\n        this.addProperty(\"url\", \"\");\r\n        this.addProperty(\"type\", \"text\");\r\n        this.widget = this.addWidget(\"text\",\"url\",\"\",\"url\");\r\n        this._data = null;\r\n    }\r\n\r\n    ConstantFile.title = \"Const File\";\r\n    ConstantFile.desc = \"Fetches a file from an url\";\r\n    ConstantFile[\"@type\"] = { type: \"enum\", values: [\"text\",\"arraybuffer\",\"blob\",\"json\"] };\r\n\r\n    ConstantFile.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"url\")\r\n\t\t{\r\n\t\t\tif( value == null || value == \"\")\r\n\t\t\t\tthis._data = null;\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.fetchFile(value);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n    ConstantFile.prototype.onExecute = function() {\r\n\t\tvar url = this.getInputData(0) || this.properties.url;\r\n\t\tif(url && (url != this._url || this._type != this.properties.type))\r\n\t\t\tthis.fetchFile(url);\r\n        this.setOutputData(0, this._data );\r\n    };\r\n\r\n\tConstantFile.prototype.setValue = ConstantNumber.prototype.setValue;\r\n\r\n    ConstantFile.prototype.fetchFile = function(url) {\r\n\t\tvar that = this;\r\n\t\tif(!url || url.constructor !== String)\r\n\t\t{\r\n\t\t\tthat._data = null;\r\n            that.boxcolor = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._url = url;\r\n\t\tthis._type = this.properties.type;\r\n        if (url.substr(0, 4) == \"http\" && LiteGraph.proxy) {\r\n            url = LiteGraph.proxy + url.substr(url.indexOf(\":\") + 3);\r\n        }\r\n\t\tfetch(url)\r\n\t\t.then(function(response) {\r\n\t\t\tif(!response.ok)\r\n\t\t\t\t throw new Error(\"File not found\");\r\n\r\n\t\t\tif(that.properties.type == \"arraybuffer\")\r\n\t\t\t\treturn response.arrayBuffer();\r\n\t\t\telse if(that.properties.type == \"text\")\r\n\t\t\t\treturn response.text();\r\n\t\t\telse if(that.properties.type == \"json\")\r\n\t\t\t\treturn response.json();\r\n\t\t\telse if(that.properties.type == \"blob\")\r\n\t\t\t\treturn response.blob();\r\n\t\t})\r\n\t\t.then(function(data) {\r\n\t\t\tthat._data = data;\r\n            that.boxcolor = \"#AEA\";\r\n\t\t})\r\n\t\t.catch(function(error) {\r\n\t\t\tthat._data = null;\r\n            that.boxcolor = \"red\";\r\n\t\t\tconsole.error(\"error fetching file:\",url);\r\n\t\t});\r\n    };\r\n\r\n\tConstantFile.prototype.onDropFile = function(file)\r\n\t{\r\n\t\tvar that = this;\r\n\t\tthis._url = file.name;\r\n\t\tthis._type = this.properties.type;\r\n\t\tthis.properties.url = file.name;\r\n\t\tvar reader = new FileReader();\r\n\t\treader.onload = function(e)\r\n\t\t{\r\n            that.boxcolor = \"#AEA\";\r\n\t\t\tvar v = e.target.result;\r\n\t\t\tif( that.properties.type == \"json\" )\r\n\t\t\t\tv = JSON.parse(v);\r\n\t\t\tthat._data = v;\r\n\t\t}\r\n\t\tif(that.properties.type == \"arraybuffer\")\r\n\t\t\treader.readAsArrayBuffer(file);\r\n\t\telse if(that.properties.type == \"text\" || that.properties.type == \"json\")\r\n\t\t\treader.readAsText(file);\r\n\t\telse if(that.properties.type == \"blob\")\r\n\t\t\treturn reader.readAsBinaryString(file);\r\n\t}\r\n\r\n    LiteGraph.registerNodeType(\"basic/file\", ConstantFile);\r\n\r\n\r\n//to store json objects\r\nfunction JSONParse() {\r\n\tthis.addInput(\"parse\", LiteGraph.ACTION);\r\n\tthis.addInput(\"json\", \"string\");\r\n\tthis.addOutput(\"done\", LiteGraph.EVENT);\r\n\tthis.addOutput(\"object\", \"object\");\r\n\tthis.widget = this.addWidget(\"button\",\"parse\",\"\",this.parse.bind(this));\r\n\tthis._str = null;\r\n\tthis._obj = null;\r\n}\r\n\r\nJSONParse.title = \"JSON Parse\";\r\nJSONParse.desc = \"Parses JSON String into object\";\r\n\r\nJSONParse.prototype.parse = function()\r\n{\r\n\tif(!this._str)\r\n\t\treturn;\r\n\r\n\ttry {\r\n\t\tthis._str = this.getInputData(1);\r\n\t\tthis._obj = JSON.parse(this._str);\r\n\t\tthis.boxcolor = \"#AEA\";\r\n\t\tthis.triggerSlot(0);\r\n\t} catch (err) {\r\n\t\tthis.boxcolor = \"red\";\r\n\t}\r\n}\r\n\r\nJSONParse.prototype.onExecute = function() {\r\n\tthis._str = this.getInputData(1);\r\n\tthis.setOutputData(1, this._obj);\r\n};\r\n\r\nJSONParse.prototype.onAction = function(name) {\r\n\tif(name == \"parse\")\r\n\t\tthis.parse();\r\n}\r\n\r\nLiteGraph.registerNodeType(\"basic/jsonparse\", JSONParse);\t\r\n\r\n\t//to store json objects\r\n    function ConstantData() {\r\n        this.addOutput(\"data\", \"object\");\r\n        this.addProperty(\"value\", \"\");\r\n        this.widget = this.addWidget(\"text\",\"json\",\"\",\"value\");\r\n        this.widgets_up = true;\r\n        this.size = [140, 30];\r\n        this._value = null;\r\n    }\r\n\r\n    ConstantData.title = \"Const Data\";\r\n    ConstantData.desc = \"Constant Data\";\r\n\r\n    ConstantData.prototype.onPropertyChanged = function(name, value) {\r\n        this.widget.value = value;\r\n        if (value == null || value == \"\") {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            this._value = JSON.parse(value);\r\n            this.boxcolor = \"#AEA\";\r\n        } catch (err) {\r\n            this.boxcolor = \"red\";\r\n        }\r\n    };\r\n\r\n    ConstantData.prototype.onExecute = function() {\r\n        this.setOutputData(0, this._value);\r\n    };\r\n\r\n\tConstantData.prototype.setValue = ConstantNumber.prototype.setValue;\r\n\r\n    LiteGraph.registerNodeType(\"basic/data\", ConstantData);\r\n\r\n\t//to store json objects\r\n    function ConstantArray() {\r\n\t\tthis._value = [];\r\n        this.addInput(\"json\", \"\");\r\n        this.addOutput(\"arrayOut\", \"array\");\r\n\t\tthis.addOutput(\"length\", \"number\");\r\n        this.addProperty(\"value\", \"[]\");\r\n        this.widget = this.addWidget(\"text\",\"array\",this.properties.value,\"value\");\r\n        this.widgets_up = true;\r\n        this.size = [140, 50];\r\n    }\r\n\r\n    ConstantArray.title = \"Const Array\";\r\n    ConstantArray.desc = \"Constant Array\";\r\n\r\n    ConstantArray.prototype.onPropertyChanged = function(name, value) {\r\n        this.widget.value = value;\r\n        if (value == null || value == \"\") {\r\n            return;\r\n        }\r\n\r\n        try {\r\n\t\t\tif(value[0] != \"[\")\r\n\t            this._value = JSON.parse(\"[\" + value + \"]\");\r\n\t\t\telse\r\n\t            this._value = JSON.parse(value);\r\n            this.boxcolor = \"#AEA\";\r\n        } catch (err) {\r\n            this.boxcolor = \"red\";\r\n        }\r\n    };\r\n\r\n    ConstantArray.prototype.onExecute = function() {\r\n        var v = this.getInputData(0);\r\n\t\tif(v && v.length) //clone\r\n\t\t{\r\n\t\t\tif(!this._value)\r\n\t\t\t\tthis._value = new Array();\r\n\t\t\tthis._value.length = v.length;\r\n\t\t\tfor(var i = 0; i < v.length; ++i)\r\n\t\t\t\tthis._value[i] = v[i];\r\n\t\t}\r\n\t\tthis.setOutputData(0, this._value);\r\n\t\tthis.setOutputData(1, this._value ? ( this._value.length || 0) : 0 );\r\n    };\r\n\r\n\tConstantArray.prototype.setValue = ConstantNumber.prototype.setValue;\r\n\r\n    LiteGraph.registerNodeType(\"basic/array\", ConstantArray);\r\n\r\n\tfunction SetArray()\r\n\t{\r\n        this.addInput(\"arr\", \"array\");\r\n        this.addInput(\"value\", \"\");\r\n        this.addOutput(\"arr\", \"array\");\r\n\t\tthis.properties = { index: 0 };\r\n        this.widget = this.addWidget(\"number\",\"i\",this.properties.index,\"index\",{precision: 0, step: 10, min: 0});\r\n\t}\r\n\r\n    SetArray.title = \"Set Array\";\r\n    SetArray.desc = \"Sets index of array\";\r\n\r\n    SetArray.prototype.onExecute = function() {\r\n        var arr = this.getInputData(0);\r\n\t\tif(!arr)\r\n\t\t\treturn;\r\n        var v = this.getInputData(1);\r\n\t\tif(v === undefined )\r\n\t\t\treturn;\r\n\t\tif(this.properties.index)\r\n\t\t\tarr[ Math.floor(this.properties.index) ] = v;\r\n\t\tthis.setOutputData(0,arr);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/set_array\", SetArray );\r\n\r\n    function ArrayElement() {\r\n        this.addInput(\"array\", \"array,table,string\");\r\n        this.addInput(\"index\", \"number\");\r\n        this.addOutput(\"value\", \"\");\r\n\t\tthis.addProperty(\"index\",0);\r\n    }\r\n\r\n    ArrayElement.title = \"Array[i]\";\r\n    ArrayElement.desc = \"Returns an element from an array\";\r\n\r\n    ArrayElement.prototype.onExecute = function() {\r\n        var array = this.getInputData(0);\r\n        var index = this.getInputData(1);\r\n\t\tif(index == null)\r\n\t\t\tindex = this.properties.index;\r\n\t\tif(array == null || index == null )\r\n\t\t\treturn;\r\n        this.setOutputData(0, array[Math.floor(Number(index))] );\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/array[]\", ArrayElement);\r\n\r\n    function TableElement() {\r\n        this.addInput(\"table\", \"table\");\r\n        this.addInput(\"row\", \"number\");\r\n        this.addInput(\"col\", \"number\");\r\n        this.addOutput(\"value\", \"\");\r\n\t\tthis.addProperty(\"row\",0);\r\n\t\tthis.addProperty(\"column\",0);\r\n    }\r\n\r\n    TableElement.title = \"Table[row][col]\";\r\n    TableElement.desc = \"Returns an element from a table\";\r\n\r\n    TableElement.prototype.onExecute = function() {\r\n        var table = this.getInputData(0);\r\n        var row = this.getInputData(1);\r\n        var col = this.getInputData(2);\r\n\t\tif(row == null)\r\n\t\t\trow = this.properties.row;\r\n\t\tif(col == null)\r\n\t\t\tcol = this.properties.column;\r\n\t\tif(table == null || row == null || col == null)\r\n\t\t\treturn;\r\n\t\tvar row = table[Math.floor(Number(row))];\r\n\t\tif(row)\r\n\t        this.setOutputData(0, row[Math.floor(Number(col))] );\r\n\t\telse\r\n\t        this.setOutputData(0, null );\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/table[][]\", TableElement);\r\n\r\n    function ObjectProperty() {\r\n        this.addInput(\"obj\", \"object\");\r\n        this.addOutput(\"property\", 0);\r\n        this.addProperty(\"value\", 0);\r\n        this.widget = this.addWidget(\"text\",\"prop.\",\"\",this.setValue.bind(this) );\r\n        this.widgets_up = true;\r\n        this.size = [140, 30];\r\n        this._value = null;\r\n    }\r\n\r\n    ObjectProperty.title = \"Object property\";\r\n    ObjectProperty.desc = \"Outputs the property of an object\";\r\n\r\n    ObjectProperty.prototype.setValue = function(v) {\r\n        this.properties.value = v;\r\n        this.widget.value = v;\r\n    };\r\n\r\n    ObjectProperty.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return \"in.\" + this.properties.value;\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n    ObjectProperty.prototype.onPropertyChanged = function(name, value) {\r\n        this.widget.value = value;\r\n    };\r\n\r\n    ObjectProperty.prototype.onExecute = function() {\r\n        var data = this.getInputData(0);\r\n        if (data != null) {\r\n            this.setOutputData(0, data[this.properties.value]);\r\n        }\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/object_property\", ObjectProperty);\r\n\r\n    function ObjectKeys() {\r\n        this.addInput(\"obj\", \"\");\r\n        this.addOutput(\"keys\", \"array\");\r\n        this.size = [140, 30];\r\n    }\r\n\r\n    ObjectKeys.title = \"Object keys\";\r\n    ObjectKeys.desc = \"Outputs an array with the keys of an object\";\r\n\r\n    ObjectKeys.prototype.onExecute = function() {\r\n        var data = this.getInputData(0);\r\n        if (data != null) {\r\n            this.setOutputData(0, Object.keys(data) );\r\n        }\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/object_keys\", ObjectKeys);\r\n\r\n\r\n\tfunction SetObject()\r\n\t{\r\n        this.addInput(\"obj\", \"\");\r\n        this.addInput(\"value\", \"\");\r\n        this.addOutput(\"obj\", \"\");\r\n\t\tthis.properties = { property: \"\" };\r\n        this.name_widget = this.addWidget(\"text\",\"prop.\",this.properties.property,\"property\");\r\n\t}\r\n\r\n    SetObject.title = \"Set Object\";\r\n    SetObject.desc = \"Adds propertiesrty to object\";\r\n\r\n    SetObject.prototype.onExecute = function() {\r\n        var obj = this.getInputData(0);\r\n\t\tif(!obj)\r\n\t\t\treturn;\r\n        var v = this.getInputData(1);\r\n\t\tif(v === undefined )\r\n\t\t\treturn;\r\n\t\tif(this.properties.property)\r\n\t\t\tobj[ this.properties.property ] = v;\r\n\t\tthis.setOutputData(0,obj);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/set_object\", SetObject );\r\n\r\n\r\n    function MergeObjects() {\r\n        this.addInput(\"A\", \"object\");\r\n        this.addInput(\"B\", \"object\");\r\n        this.addOutput(\"out\", \"object\");\r\n\t\tthis._result = {};\r\n\t\tvar that = this;\r\n\t\tthis.addWidget(\"button\",\"clear\",\"\",function(){\r\n\t\t\tthat._result = {};\r\n\t\t});\r\n\t\tthis.size = this.computeSize();\r\n    }\r\n\r\n    MergeObjects.title = \"Merge Objects\";\r\n    MergeObjects.desc = \"Creates an object copying properties from others\";\r\n\r\n    MergeObjects.prototype.onExecute = function() {\r\n        var A = this.getInputData(0);\r\n        var B = this.getInputData(1);\r\n\t\tvar C = this._result;\r\n\t\tif(A)\r\n\t\t\tfor(var i in A)\r\n\t\t\t\tC[i] = A[i];\r\n\t\tif(B)\r\n\t\t\tfor(var i in B)\r\n\t\t\t\tC[i] = B[i];\r\n\t\tthis.setOutputData(0,C);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/merge_objects\", MergeObjects );\r\n\r\n    //Store as variable\r\n    function Variable() {\r\n        this.size = [60, 30];\r\n        this.addInput(\"in\");\r\n        this.addOutput(\"out\");\r\n\t\tthis.properties = { varname: \"myname\", container: Variable.LITEGRAPH };\r\n        this.value = null;\r\n    }\r\n\r\n    Variable.title = \"Variable\";\r\n    Variable.desc = \"store/read variable value\";\r\n\r\n\tVariable.LITEGRAPH = 0; //between all graphs\r\n\tVariable.GRAPH = 1;\t//only inside this graph\r\n\tVariable.GLOBALSCOPE = 2;\t//attached to Window\r\n\r\n    Variable[\"@container\"] = { type: \"enum\", values: {\"litegraph\":Variable.LITEGRAPH, \"graph\":Variable.GRAPH,\"global\": Variable.GLOBALSCOPE} };\r\n\r\n    Variable.prototype.onExecute = function() {\r\n\t\tvar container = this.getContainer();\r\n\r\n\t\tif(this.isInputConnected(0))\r\n\t\t{\r\n\t\t\tthis.value = this.getInputData(0);\r\n\t\t\tcontainer[ this.properties.varname ] = this.value;\r\n\t\t\tthis.setOutputData(0, this.value );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.setOutputData( 0, container[ this.properties.varname ] );\r\n    };\r\n\r\n\tVariable.prototype.getContainer = function()\r\n\t{\r\n\t\tswitch(this.properties.container)\r\n\t\t{\r\n\t\t\tcase Variable.GRAPH:\r\n\t\t\t\tif(this.graph)\r\n\t\t\t\t\treturn this.graph.vars;\r\n\t\t\t\treturn {};\r\n\t\t\t\tbreak;\r\n\t\t\tcase Variable.GLOBALSCOPE:\r\n\t\t\t\treturn global;\r\n\t\t\t\tbreak;\r\n\t\t\tcase Variable.LITEGRAPH:\r\n\t\t\tdefault:\r\n\t\t\t\treturn LiteGraph.Globals;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n    Variable.prototype.getTitle = function() {\r\n        return this.properties.varname;\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/variable\", Variable);\r\n\r\n    function length(v) {\r\n        if(v && v.length != null)\r\n\t\t\treturn Number(v.length);\r\n\t\treturn 0;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"basic/length\",\r\n        length,\r\n        [\"\"],\r\n        \"number\"\r\n    );\r\n\r\n    function length(v) {\r\n        if(v && v.length != null)\r\n\t\t\treturn Number(v.length);\r\n\t\treturn 0;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"basic/not\",\r\n        function(a){ return !a; },\r\n        [\"\"],\r\n        \"boolean\"\r\n    );\r\n\r\n\tfunction DownloadData() {\r\n        this.size = [60, 30];\r\n        this.addInput(\"data\", 0 );\r\n        this.addInput(\"download\", LiteGraph.ACTION );\r\n\t\tthis.properties = { filename: \"data.json\" };\r\n        this.value = null;\r\n\t\tvar that = this;\r\n\t\tthis.addWidget(\"button\",\"Download\",\"\", function(v){\r\n\t\t\tif(!that.value)\r\n\t\t\t\treturn;\r\n\t\t\tthat.downloadAsFile();\r\n\t\t});\r\n    }\r\n\r\n    DownloadData.title = \"Download\";\r\n    DownloadData.desc = \"Download some data\";\r\n\r\n\tDownloadData.prototype.downloadAsFile = function()\r\n\t{\r\n\t\tif(this.value == null)\r\n\t\t\treturn;\r\n\r\n\t\tvar str = null;\r\n\t\tif(this.value.constructor === String)\r\n\t\t\tstr = this.value;\r\n\t\telse\r\n\t\t\tstr = JSON.stringify(this.value);\r\n\r\n\t\tvar file = new Blob([str]);\r\n\t\tvar url = URL.createObjectURL( file );\r\n\t\tvar element = document.createElement(\"a\");\r\n\t\telement.setAttribute('href', url);\r\n\t\telement.setAttribute('download', this.properties.filename );\r\n\t\telement.style.display = 'none';\r\n\t\tdocument.body.appendChild(element);\r\n\t\telement.click();\r\n\t\tdocument.body.removeChild(element);\r\n\t\tsetTimeout( function(){ URL.revokeObjectURL( url ); }, 1000*60 ); //wait one minute to revoke url\r\n\t}\r\n\r\n    DownloadData.prototype.onAction = function(action, param) {\r\n\t\tvar that = this;\r\n\t\tsetTimeout( function(){ that.downloadAsFile(); }, 100); //deferred to avoid blocking the renderer with the popup\r\n\t}\r\n\r\n    DownloadData.prototype.onExecute = function() {\r\n        if (this.inputs[0]) {\r\n            this.value = this.getInputData(0);\r\n        }\r\n    };\r\n\r\n    DownloadData.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return this.properties.filename;\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/download\", DownloadData);\r\n\r\n\r\n\r\n    //Watch a value in the editor\r\n    function Watch() {\r\n        this.size = [60, 30];\r\n        this.addInput(\"value\", 0, { label: \"\" });\r\n        this.value = 0;\r\n    }\r\n\r\n    Watch.title = \"Watch\";\r\n    Watch.desc = \"Show value of input\";\r\n\r\n    Watch.prototype.onExecute = function() {\r\n        if (this.inputs[0]) {\r\n            this.value = this.getInputData(0);\r\n        }\r\n    };\r\n\r\n    Watch.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return this.inputs[0].label;\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n    Watch.toString = function(o) {\r\n        if (o == null) {\r\n            return \"null\";\r\n        } else if (o.constructor === Number) {\r\n            return o.toFixed(3);\r\n        } else if (o.constructor === Array) {\r\n            var str = \"[\";\r\n            for (var i = 0; i < o.length; ++i) {\r\n                str += Watch.toString(o[i]) + (i + 1 != o.length ? \",\" : \"\");\r\n            }\r\n            str += \"]\";\r\n            return str;\r\n        } else {\r\n            return String(o);\r\n        }\r\n    };\r\n\r\n    Watch.prototype.onDrawBackground = function(ctx) {\r\n        //show the current value\r\n        this.inputs[0].label = Watch.toString(this.value);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/watch\", Watch);\r\n\r\n    //in case one type doesnt match other type but you want to connect them anyway\r\n    function Cast() {\r\n        this.addInput(\"in\", 0);\r\n        this.addOutput(\"out\", 0);\r\n        this.size = [40, 30];\r\n    }\r\n\r\n    Cast.title = \"Cast\";\r\n    Cast.desc = \"Allows to connect different types\";\r\n\r\n    Cast.prototype.onExecute = function() {\r\n        this.setOutputData(0, this.getInputData(0));\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/cast\", Cast);\r\n\r\n    //Show value inside the debug console\r\n    function Console() {\r\n        this.mode = LiteGraph.ON_EVENT;\r\n        this.size = [80, 30];\r\n        this.addProperty(\"msg\", \"\");\r\n        this.addInput(\"log\", LiteGraph.EVENT);\r\n        this.addInput(\"msg\", 0);\r\n    }\r\n\r\n    Console.title = \"Console\";\r\n    Console.desc = \"Show value inside the console\";\r\n\r\n    Console.prototype.onAction = function(action, param) {\r\n        // param is the action\r\n        var msg = this.getInputData(1); //getInputDataByName(\"msg\");\r\n        //if (msg == null || typeof msg == \"undefined\") return;\r\n        if (!msg) msg = this.properties.msg;\r\n        if (!msg) msg = \"Event: \"+param; // msg is undefined if the slot is lost?\r\n        if (action == \"log\") {\r\n            console.log(msg);\r\n        } else if (action == \"warn\") {\r\n            console.warn(msg);\r\n        } else if (action == \"error\") {\r\n            console.error(msg);\r\n        }\r\n    };\r\n\r\n    Console.prototype.onExecute = function() {\r\n        var msg = this.getInputData(1); //getInputDataByName(\"msg\");\r\n        if (!msg) msg = this.properties.msg;\r\n        if (msg != null && typeof msg != \"undefined\") {\r\n            this.properties.msg = msg;\r\n            console.log(msg);\r\n        }\r\n    };\r\n\r\n    Console.prototype.onGetInputs = function() {\r\n        return [\r\n            [\"log\", LiteGraph.ACTION],\r\n            [\"warn\", LiteGraph.ACTION],\r\n            [\"error\", LiteGraph.ACTION]\r\n        ];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/console\", Console);\r\n\r\n    //Show value inside the debug console\r\n    function Alert() {\r\n        this.mode = LiteGraph.ON_EVENT;\r\n        this.addProperty(\"msg\", \"\");\r\n        this.addInput(\"\", LiteGraph.EVENT);\r\n        var that = this;\r\n        this.widget = this.addWidget(\"text\", \"Text\", \"\", \"msg\");\r\n        this.widgets_up = true;\r\n        this.size = [200, 30];\r\n    }\r\n\r\n    Alert.title = \"Alert\";\r\n    Alert.desc = \"Show an alert window\";\r\n    Alert.color = \"#510\";\r\n\r\n    Alert.prototype.onConfigure = function(o) {\r\n        this.widget.value = o.properties.msg;\r\n    };\r\n\r\n    Alert.prototype.onAction = function(action, param) {\r\n        var msg = this.properties.msg;\r\n        setTimeout(function() {\r\n            alert(msg);\r\n        }, 10);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/alert\", Alert);\r\n\r\n    //Execites simple code\r\n    function NodeScript() {\r\n        this.size = [60, 30];\r\n        this.addProperty(\"onExecute\", \"return A;\");\r\n        this.addInput(\"A\", 0);\r\n        this.addInput(\"B\", 0);\r\n        this.addOutput(\"out\", 0);\r\n\r\n        this._func = null;\r\n        this.data = {};\r\n    }\r\n\r\n    NodeScript.prototype.onConfigure = function(o) {\r\n        if (o.properties.onExecute && LiteGraph.allow_scripts)\r\n            this.compileCode(o.properties.onExecute);\r\n\t\telse\r\n\t\t\tconsole.warn(\"Script not compiled, LiteGraph.allow_scripts is false\");\r\n    };\r\n\r\n    NodeScript.title = \"Script\";\r\n    NodeScript.desc = \"executes a code (max 256 characters)\";\r\n\r\n    NodeScript.widgets_info = {\r\n        onExecute: { type: \"code\" }\r\n    };\r\n\r\n    NodeScript.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"onExecute\" && LiteGraph.allow_scripts)\r\n            this.compileCode(value);\r\n\t\telse\r\n\t\t\tconsole.warn(\"Script not compiled, LiteGraph.allow_scripts is false\");\r\n    };\r\n\r\n    NodeScript.prototype.compileCode = function(code) {\r\n        this._func = null;\r\n        if (code.length > 256) {\r\n            console.warn(\"Script too long, max 256 chars\");\r\n        } else {\r\n            var code_low = code.toLowerCase();\r\n            var forbidden_words = [\r\n                \"script\",\r\n                \"body\",\r\n                \"document\",\r\n                \"eval\",\r\n                \"nodescript\",\r\n                \"function\"\r\n            ]; //bad security solution\r\n            for (var i = 0; i < forbidden_words.length; ++i) {\r\n                if (code_low.indexOf(forbidden_words[i]) != -1) {\r\n                    console.warn(\"invalid script\");\r\n                    return;\r\n                }\r\n            }\r\n            try {\r\n                this._func = new Function(\"A\", \"B\", \"C\", \"DATA\", \"node\", code);\r\n            } catch (err) {\r\n                console.error(\"Error parsing script\");\r\n                console.error(err);\r\n            }\r\n        }\r\n    };\r\n\r\n    NodeScript.prototype.onExecute = function() {\r\n        if (!this._func) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            var A = this.getInputData(0);\r\n            var B = this.getInputData(1);\r\n            var C = this.getInputData(2);\r\n            this.setOutputData(0, this._func(A, B, C, this.data, this));\r\n        } catch (err) {\r\n            console.error(\"Error in script\");\r\n            console.error(err);\r\n        }\r\n    };\r\n\r\n    NodeScript.prototype.onGetOutputs = function() {\r\n        return [[\"C\", \"\"]];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/script\", NodeScript);\r\n    \r\n    \r\n    function GenericCompare() {\r\n        this.addInput(\"A\", 0);\r\n        this.addInput(\"B\", 0);\r\n        this.addOutput(\"true\", \"boolean\");\r\n        this.addOutput(\"false\", \"boolean\");\r\n        this.addProperty(\"A\", 1);\r\n        this.addProperty(\"B\", 1);\r\n        this.addProperty(\"OP\", \"==\", \"enum\", { values: GenericCompare.values });\r\n\t\tthis.addWidget(\"combo\",\"Op.\",this.properties.OP,{ property: \"OP\", values: GenericCompare.values } );\r\n\r\n        this.size = [80, 60];\r\n    }\r\n\r\n    GenericCompare.values = [\"==\", \"!=\"]; //[\">\", \"<\", \"==\", \"!=\", \"<=\", \">=\", \"||\", \"&&\" ];\r\n    GenericCompare[\"@OP\"] = {\r\n        type: \"enum\",\r\n        title: \"operation\",\r\n        values: GenericCompare.values\r\n    };\r\n\r\n    GenericCompare.title = \"Compare *\";\r\n    GenericCompare.desc = \"evaluates condition between A and B\";\r\n\r\n    GenericCompare.prototype.getTitle = function() {\r\n        return \"*A \" + this.properties.OP + \" *B\";\r\n    };\r\n\r\n    GenericCompare.prototype.onExecute = function() {\r\n        var A = this.getInputData(0);\r\n        if (A === undefined) {\r\n            A = this.properties.A;\r\n        } else {\r\n            this.properties.A = A;\r\n        }\r\n\r\n        var B = this.getInputData(1);\r\n        if (B === undefined) {\r\n            B = this.properties.B;\r\n        } else {\r\n            this.properties.B = B;\r\n        }\r\n\r\n        var result = false;\r\n        if (typeof A == typeof B){\r\n            switch (this.properties.OP) {\r\n                case \"==\":\r\n                case \"!=\":\r\n                    // traverse both objects.. consider that this is not a true deep check! consider underscore or other library for thath :: _isEqual()\r\n                    result = true;\r\n                    switch(typeof A){\r\n                        case \"object\":\r\n                            var aProps = Object.getOwnPropertyNames(A);\r\n                            var bProps = Object.getOwnPropertyNames(B);\r\n                            if (aProps.length != bProps.length){\r\n                                result = false;\r\n                                break;\r\n                            }\r\n                            for (var i = 0; i < aProps.length; i++) {\r\n                                var propName = aProps[i];\r\n                                if (A[propName] !== B[propName]) {\r\n                                    result = false;\r\n                                    break;\r\n                                }\r\n                            }\r\n                        break;\r\n                        default:\r\n                            result = A == B;\r\n                    }\r\n                    if (this.properties.OP == \"!=\") result = !result;\r\n                    break;\r\n                /*case \">\":\r\n                    result = A > B;\r\n                    break;\r\n                case \"<\":\r\n                    result = A < B;\r\n                    break;\r\n                case \"<=\":\r\n                    result = A <= B;\r\n                    break;\r\n                case \">=\":\r\n                    result = A >= B;\r\n                    break;\r\n                case \"||\":\r\n                    result = A || B;\r\n                    break;\r\n                case \"&&\":\r\n                    result = A && B;\r\n                    break;*/\r\n            }\r\n        }\r\n        this.setOutputData(0, result);\r\n        this.setOutputData(1, !result);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"basic/CompareValues\", GenericCompare);\r\n    \r\n})(this);\r\n\n//event related nodes\r\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n    //Show value inside the debug console\r\n    function LogEvent() {\r\n        this.size = [60, 30];\r\n        this.addInput(\"event\", LiteGraph.ACTION);\r\n    }\r\n\r\n    LogEvent.title = \"Log Event\";\r\n    LogEvent.desc = \"Log event in console\";\r\n\r\n    LogEvent.prototype.onAction = function(action, param, options) {\r\n        console.log(action, param);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/log\", LogEvent);\r\n\r\n    //convert to Event if the value is true\r\n    function TriggerEvent() {\r\n        this.size = [60, 30];\r\n        this.addInput(\"if\", \"\");\r\n        this.addOutput(\"true\", LiteGraph.EVENT);\r\n        this.addOutput(\"change\", LiteGraph.EVENT);\r\n        this.addOutput(\"false\", LiteGraph.EVENT);\r\n\t\tthis.properties = { only_on_change: true };\r\n\t\tthis.prev = 0;\r\n    }\r\n\r\n    TriggerEvent.title = \"TriggerEvent\";\r\n    TriggerEvent.desc = \"Triggers event if input evaluates to true\";\r\n\r\n    TriggerEvent.prototype.onExecute = function( param, options) {\r\n\t\tvar v = this.getInputData(0);\r\n\t\tvar changed = (v != this.prev);\r\n\t\tif(this.prev === 0)\r\n\t\t\tchanged = false;\r\n\t\tvar must_resend = (changed && this.properties.only_on_change) || (!changed && !this.properties.only_on_change);\r\n\t\tif(v && must_resend )\r\n\t        this.triggerSlot(0, param, null, options);\r\n\t\tif(!v && must_resend)\r\n\t        this.triggerSlot(2, param, null, options);\r\n\t\tif(changed)\r\n\t        this.triggerSlot(1, param, null, options);\r\n\t\tthis.prev = v;\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/trigger\", TriggerEvent);\r\n\r\n    //Sequence of events\r\n    function Sequence() {\r\n\t\tvar that = this;\r\n        this.addInput(\"\", LiteGraph.ACTION);\r\n        this.addInput(\"\", LiteGraph.ACTION);\r\n        this.addInput(\"\", LiteGraph.ACTION);\r\n        this.addOutput(\"\", LiteGraph.EVENT);\r\n        this.addOutput(\"\", LiteGraph.EVENT);\r\n        this.addOutput(\"\", LiteGraph.EVENT);\r\n        this.addWidget(\"button\",\"+\",null,function(){\r\n\t        that.addInput(\"\", LiteGraph.ACTION);\r\n\t        that.addOutput(\"\", LiteGraph.EVENT);\r\n        });\r\n        this.size = [90, 70];\r\n        this.flags = { horizontal: true, render_box: false };\r\n    }\r\n\r\n    Sequence.title = \"Sequence\";\r\n    Sequence.desc = \"Triggers a sequence of events when an event arrives\";\r\n\r\n    Sequence.prototype.getTitle = function() {\r\n        return \"\";\r\n    };\r\n\r\n    Sequence.prototype.onAction = function(action, param, options) {\r\n        if (this.outputs) {\r\n            options = options || {};\r\n            for (var i = 0; i < this.outputs.length; ++i) {\r\n\t\t\t\tvar output = this.outputs[i];\r\n\t\t\t\t//needs more info about this...\r\n\t\t\t\tif( options.action_call ) // CREATE A NEW ID FOR THE ACTION\r\n\t                options.action_call = options.action_call + \"_seq_\" + i;\r\n\t\t\t\telse\r\n\t\t\t\t\toptions.action_call = this.id + \"_\" + (action ? action : \"action\")+\"_seq_\"+i+\"_\"+Math.floor(Math.random()*9999);\r\n                this.triggerSlot(i, param, null, options);\r\n            }\r\n        }\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/sequence\", Sequence);\r\n\r\n\r\n   //Sequence of events\r\n   function WaitAll() {\r\n    var that = this;\r\n    this.addInput(\"\", LiteGraph.ACTION);\r\n    this.addInput(\"\", LiteGraph.ACTION);\r\n    this.addOutput(\"\", LiteGraph.EVENT);\r\n    this.addWidget(\"button\",\"+\",null,function(){\r\n        that.addInput(\"\", LiteGraph.ACTION);\r\n        that.size[0] = 90;\r\n    });\r\n    this.size = [90, 70];\r\n    this.ready = [];\r\n}\r\n\r\nWaitAll.title = \"WaitAll\";\r\nWaitAll.desc = \"Wait until all input events arrive then triggers output\";\r\n\r\nWaitAll.prototype.getTitle = function() {\r\n    return \"\";\r\n};\r\n\r\nWaitAll.prototype.onDrawBackground = function(ctx)\r\n{\r\n    if (this.flags.collapsed) {\r\n        return;\r\n    }\r\n    for(var i = 0; i < this.inputs.length; ++i)\r\n    {\r\n        var y = i * LiteGraph.NODE_SLOT_HEIGHT + 10;\r\n        ctx.fillStyle = this.ready[i] ? \"#AFB\" : \"#000\";\r\n        ctx.fillRect(20, y, 10, 10);\r\n    }\r\n}\r\n\r\nWaitAll.prototype.onAction = function(action, param, options, slot_index) {\r\n    if(slot_index == null)\r\n        return;\r\n\r\n    //check all\r\n    this.ready.length = this.outputs.length;\r\n    this.ready[slot_index] = true;\r\n    for(var i = 0; i < this.ready.length;++i)\r\n        if(!this.ready[i])\r\n            return;\r\n    //pass\r\n    this.reset();\r\n    this.triggerSlot(0);\r\n};\r\n\r\nWaitAll.prototype.reset = function()\r\n{\r\n    this.ready.length = 0;\r\n}\r\n\r\nLiteGraph.registerNodeType(\"events/waitAll\", WaitAll);    \r\n\r\n\r\n    //Sequencer for events\r\n    function Stepper() {\r\n\t\tvar that = this;\r\n\t\tthis.properties = { index: 0 };\r\n        this.addInput(\"index\", \"number\");\r\n        this.addInput(\"step\", LiteGraph.ACTION);\r\n        this.addInput(\"reset\", LiteGraph.ACTION);\r\n        this.addOutput(\"index\", \"number\");\r\n        this.addOutput(\"\", LiteGraph.EVENT);\r\n        this.addOutput(\"\", LiteGraph.EVENT);\r\n        this.addOutput(\"\", LiteGraph.EVENT,{removable:true});\r\n        this.addWidget(\"button\",\"+\",null,function(){\r\n\t        that.addOutput(\"\", LiteGraph.EVENT, {removable:true});\r\n        });\r\n        this.size = [120, 120];\r\n        this.flags = { render_box: false };\r\n    }\r\n\r\n    Stepper.title = \"Stepper\";\r\n    Stepper.desc = \"Trigger events sequentially when an tick arrives\";\r\n\r\n\tStepper.prototype.onDrawBackground = function(ctx)\r\n\t{\r\n        if (this.flags.collapsed) {\r\n            return;\r\n        }\r\n\t\tvar index = this.properties.index || 0;\r\n        ctx.fillStyle = \"#AFB\";\r\n\t\tvar w = this.size[0];\r\n        var y = (index + 1)* LiteGraph.NODE_SLOT_HEIGHT + 4;\r\n        ctx.beginPath();\r\n        ctx.moveTo(w - 30, y);\r\n        ctx.lineTo(w - 30, y + LiteGraph.NODE_SLOT_HEIGHT);\r\n        ctx.lineTo(w - 15, y + LiteGraph.NODE_SLOT_HEIGHT * 0.5);\r\n        ctx.fill();\r\n\t}\r\n\r\n\tStepper.prototype.onExecute = function()\r\n\t{\r\n\t\tvar index = this.getInputData(0);\r\n\t\tif(index != null)\r\n\t\t{\r\n\t\t\tindex = Math.floor(index);\r\n\t\t\tindex = clamp( index, 0, this.outputs ? (this.outputs.length - 2) : 0 );\r\n\t\t\tif( index != this.properties.index )\r\n\t\t\t{\r\n\t\t\t\tthis.properties.index = index;\r\n\t\t\t    this.triggerSlot( index+1 );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.setOutputData(0, this.properties.index );\r\n\t}\r\n\r\n    Stepper.prototype.onAction = function(action, param) {\r\n\t\tif(action == \"reset\")\r\n\t\t\tthis.properties.index = 0;\r\n\t\telse if(action == \"step\")\r\n\t\t{\r\n            this.triggerSlot(this.properties.index+1, param);\r\n\t\t\tvar n = this.outputs ? this.outputs.length - 1 : 0;\r\n\t\t\tthis.properties.index = (this.properties.index + 1) % n;\r\n        }\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/stepper\", Stepper);\r\n\r\n    //Filter events\r\n    function FilterEvent() {\r\n        this.size = [60, 30];\r\n        this.addInput(\"event\", LiteGraph.ACTION);\r\n        this.addOutput(\"event\", LiteGraph.EVENT);\r\n        this.properties = {\r\n            equal_to: \"\",\r\n            has_property: \"\",\r\n            property_equal_to: \"\"\r\n        };\r\n    }\r\n\r\n    FilterEvent.title = \"Filter Event\";\r\n    FilterEvent.desc = \"Blocks events that do not match the filter\";\r\n\r\n    FilterEvent.prototype.onAction = function(action, param, options) {\r\n        if (param == null) {\r\n            return;\r\n        }\r\n\r\n        if (this.properties.equal_to && this.properties.equal_to != param) {\r\n            return;\r\n        }\r\n\r\n        if (this.properties.has_property) {\r\n            var prop = param[this.properties.has_property];\r\n            if (prop == null) {\r\n                return;\r\n            }\r\n\r\n            if (\r\n                this.properties.property_equal_to &&\r\n                this.properties.property_equal_to != prop\r\n            ) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.triggerSlot(0, param, null, options);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/filter\", FilterEvent);\r\n\r\n\r\n    function EventBranch() {\r\n        this.addInput(\"in\", LiteGraph.ACTION);\r\n        this.addInput(\"cond\", \"boolean\");\r\n        this.addOutput(\"true\", LiteGraph.EVENT);\r\n        this.addOutput(\"false\", LiteGraph.EVENT);\r\n        this.size = [120, 60];\r\n\t\tthis._value = false;\r\n    }\r\n\r\n    EventBranch.title = \"Branch\";\r\n    EventBranch.desc = \"If condition is true, outputs triggers true, otherwise false\";\r\n\r\n    EventBranch.prototype.onExecute = function() {\r\n\t\tthis._value = this.getInputData(1);\r\n\t}\r\n\r\n    EventBranch.prototype.onAction = function(action, param, options) {\r\n        this._value = this.getInputData(1);\r\n\t\tthis.triggerSlot(this._value ? 0 : 1, param, null, options);\r\n\t}\r\n\r\n    LiteGraph.registerNodeType(\"events/branch\", EventBranch);\r\n\r\n    //Show value inside the debug console\r\n    function EventCounter() {\r\n        this.addInput(\"inc\", LiteGraph.ACTION);\r\n        this.addInput(\"dec\", LiteGraph.ACTION);\r\n        this.addInput(\"reset\", LiteGraph.ACTION);\r\n        this.addOutput(\"change\", LiteGraph.EVENT);\r\n        this.addOutput(\"num\", \"number\");\r\n        this.addProperty(\"doCountExecution\", false, \"boolean\", {name: \"Count Executions\"});\r\n        this.addWidget(\"toggle\",\"Count Exec.\",this.properties.doCountExecution,\"doCountExecution\");\r\n        this.num = 0;\r\n    }\r\n\r\n    EventCounter.title = \"Counter\";\r\n    EventCounter.desc = \"Counts events\";\r\n\r\n    EventCounter.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return String(this.num);\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n    EventCounter.prototype.onAction = function(action, param, options) {\r\n        var v = this.num;\r\n        if (action == \"inc\") {\r\n            this.num += 1;\r\n        } else if (action == \"dec\") {\r\n            this.num -= 1;\r\n        } else if (action == \"reset\") {\r\n            this.num = 0;\r\n        }\r\n        if (this.num != v) {\r\n            this.trigger(\"change\", this.num);\r\n        }\r\n    };\r\n\r\n    EventCounter.prototype.onDrawBackground = function(ctx) {\r\n        if (this.flags.collapsed) {\r\n            return;\r\n        }\r\n        ctx.fillStyle = \"#AAA\";\r\n        ctx.font = \"20px Arial\";\r\n        ctx.textAlign = \"center\";\r\n        ctx.fillText(this.num, this.size[0] * 0.5, this.size[1] * 0.5);\r\n    };\r\n\r\n    EventCounter.prototype.onExecute = function() {\r\n        if(this.properties.doCountExecution){\r\n            this.num += 1;\r\n        }\r\n        this.setOutputData(1, this.num);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/counter\", EventCounter);\r\n\r\n    //Show value inside the debug console\r\n    function DelayEvent() {\r\n        this.size = [60, 30];\r\n        this.addProperty(\"time_in_ms\", 1000);\r\n        this.addInput(\"event\", LiteGraph.ACTION);\r\n        this.addOutput(\"on_time\", LiteGraph.EVENT);\r\n\r\n        this._pending = [];\r\n    }\r\n\r\n    DelayEvent.title = \"Delay\";\r\n    DelayEvent.desc = \"Delays one event\";\r\n\r\n    DelayEvent.prototype.onAction = function(action, param, options) {\r\n        var time = this.properties.time_in_ms;\r\n        if (time <= 0) {\r\n            this.trigger(null, param, options);\r\n        } else {\r\n            this._pending.push([time, param]);\r\n        }\r\n    };\r\n\r\n    DelayEvent.prototype.onExecute = function(param, options) {\r\n        var dt = this.graph.elapsed_time * 1000; //in ms\r\n\r\n        if (this.isInputConnected(1)) {\r\n            this.properties.time_in_ms = this.getInputData(1);\r\n        }\r\n\r\n        for (var i = 0; i < this._pending.length; ++i) {\r\n            var actionPass = this._pending[i];\r\n            actionPass[0] -= dt;\r\n            if (actionPass[0] > 0) {\r\n                continue;\r\n            }\r\n\r\n            //remove\r\n            this._pending.splice(i, 1);\r\n            --i;\r\n\r\n            //trigger\r\n            this.trigger(null, actionPass[1], options);\r\n        }\r\n    };\r\n\r\n    DelayEvent.prototype.onGetInputs = function() {\r\n        return [[\"event\", LiteGraph.ACTION], [\"time_in_ms\", \"number\"]];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/delay\", DelayEvent);\r\n\r\n    //Show value inside the debug console\r\n    function TimerEvent() {\r\n        this.addProperty(\"interval\", 1000);\r\n        this.addProperty(\"event\", \"tick\");\r\n        this.addOutput(\"on_tick\", LiteGraph.EVENT);\r\n        this.time = 0;\r\n        this.last_interval = 1000;\r\n        this.triggered = false;\r\n    }\r\n\r\n    TimerEvent.title = \"Timer\";\r\n    TimerEvent.desc = \"Sends an event every N milliseconds\";\r\n\r\n    TimerEvent.prototype.onStart = function() {\r\n        this.time = 0;\r\n    };\r\n\r\n    TimerEvent.prototype.getTitle = function() {\r\n        return \"Timer: \" + this.last_interval.toString() + \"ms\";\r\n    };\r\n\r\n    TimerEvent.on_color = \"#AAA\";\r\n    TimerEvent.off_color = \"#222\";\r\n\r\n    TimerEvent.prototype.onDrawBackground = function() {\r\n        this.boxcolor = this.triggered\r\n            ? TimerEvent.on_color\r\n            : TimerEvent.off_color;\r\n        this.triggered = false;\r\n    };\r\n\r\n    TimerEvent.prototype.onExecute = function() {\r\n        var dt = this.graph.elapsed_time * 1000; //in ms\r\n\r\n        var trigger = this.time == 0;\r\n\r\n        this.time += dt;\r\n        this.last_interval = Math.max(\r\n            1,\r\n            this.getInputOrProperty(\"interval\") | 0\r\n        );\r\n\r\n        if (\r\n            !trigger &&\r\n            (this.time < this.last_interval || isNaN(this.last_interval))\r\n        ) {\r\n            if (this.inputs && this.inputs.length > 1 && this.inputs[1]) {\r\n                this.setOutputData(1, false);\r\n            }\r\n            return;\r\n        }\r\n\r\n        this.triggered = true;\r\n        this.time = this.time % this.last_interval;\r\n        this.trigger(\"on_tick\", this.properties.event);\r\n        if (this.inputs && this.inputs.length > 1 && this.inputs[1]) {\r\n            this.setOutputData(1, true);\r\n        }\r\n    };\r\n\r\n    TimerEvent.prototype.onGetInputs = function() {\r\n        return [[\"interval\", \"number\"]];\r\n    };\r\n\r\n    TimerEvent.prototype.onGetOutputs = function() {\r\n        return [[\"tick\", \"boolean\"]];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/timer\", TimerEvent);\r\n\r\n\r\n\r\n    function SemaphoreEvent() {\r\n        this.addInput(\"go\", LiteGraph.ACTION );\r\n        this.addInput(\"green\", LiteGraph.ACTION );\r\n        this.addInput(\"red\", LiteGraph.ACTION );\r\n        this.addOutput(\"continue\", LiteGraph.EVENT );\r\n        this.addOutput(\"blocked\", LiteGraph.EVENT );\r\n        this.addOutput(\"is_green\", \"boolean\" );\r\n\t\tthis._ready = false;\r\n\t\tthis.properties = {};\r\n\t\tvar that = this;\r\n\t\tthis.addWidget(\"button\",\"reset\",\"\",function(){\r\n\t\t\tthat._ready = false;\r\n\t\t});\r\n    }\r\n\r\n    SemaphoreEvent.title = \"Semaphore Event\";\r\n    SemaphoreEvent.desc = \"Until both events are not triggered, it doesnt continue.\";\r\n\r\n\tSemaphoreEvent.prototype.onExecute = function()\r\n\t{\r\n\t\tthis.setOutputData(1,this._ready);\r\n\t\tthis.boxcolor = this._ready ? \"#9F9\" : \"#FA5\";\r\n\t}\r\n\r\n    SemaphoreEvent.prototype.onAction = function(action, param) {\r\n\t\tif( action == \"go\" )\r\n\t\t\tthis.triggerSlot( this._ready ? 0 : 1 );\r\n\t\telse if( action == \"green\" )\r\n\t\t\tthis._ready = true;\r\n\t\telse if( action == \"red\" )\r\n\t\t\tthis._ready = false;\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/semaphore\", SemaphoreEvent);\r\n\r\n    function OnceEvent() {\r\n        this.addInput(\"in\", LiteGraph.ACTION );\r\n        this.addInput(\"reset\", LiteGraph.ACTION );\r\n        this.addOutput(\"out\", LiteGraph.EVENT );\r\n\t\tthis._once = false;\r\n\t\tthis.properties = {};\r\n\t\tvar that = this;\r\n\t\tthis.addWidget(\"button\",\"reset\",\"\",function(){\r\n\t\t\tthat._once = false;\r\n\t\t});\r\n    }\r\n\r\n    OnceEvent.title = \"Once\";\r\n    OnceEvent.desc = \"Only passes an event once, then gets locked\";\r\n\r\n    OnceEvent.prototype.onAction = function(action, param) {\r\n\t\tif( action == \"in\" && !this._once )\r\n\t\t{\r\n\t\t\tthis._once = true;\r\n\t\t\tthis.triggerSlot( 0, param );\r\n\t\t}\r\n\t\telse if( action == \"reset\" )\r\n\t\t\tthis._once = false;\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"events/once\", OnceEvent);\r\n\r\n    function DataStore() {\r\n        this.addInput(\"data\", 0);\r\n        this.addInput(\"assign\", LiteGraph.ACTION);\r\n        this.addOutput(\"data\", 0);\r\n\t\tthis._last_value = null;\r\n\t\tthis.properties = { data: null, serialize: true };\r\n\t\tvar that = this;\r\n\t\tthis.addWidget(\"button\",\"store\",\"\",function(){\r\n\t\t\tthat.properties.data = that._last_value;\r\n\t\t});\r\n    }\r\n\r\n    DataStore.title = \"Data Store\";\r\n    DataStore.desc = \"Stores data and only changes when event is received\";\r\n\r\n\tDataStore.prototype.onExecute = function()\r\n\t{\r\n\t\tthis._last_value = this.getInputData(0);\r\n\t\tthis.setOutputData(0, this.properties.data );\r\n\t}\r\n\r\n    DataStore.prototype.onAction = function(action, param, options) {\r\n\t\tthis.properties.data = this._last_value;\r\n    };\r\n\r\n\tDataStore.prototype.onSerialize = function(o)\r\n\t{\r\n\t\tif(o.data == null)\r\n\t\t\treturn;\r\n\t\tif(this.properties.serialize == false || (o.data.constructor !== String && o.data.constructor !== Number && o.data.constructor !== Boolean && o.data.constructor !== Array && o.data.constructor !== Object ))\r\n\t\t\to.data = null;\r\n\t}\r\n\r\n    LiteGraph.registerNodeType(\"basic/data_store\", DataStore);\r\n\r\n\r\n\r\n})(this);\r\n\n//widgets\n(function(global) {\n    var LiteGraph = global.LiteGraph;\n\n    /* Button ****************/\n\n    function WidgetButton() {\n        this.addOutput(\"\", LiteGraph.EVENT);\n        this.addOutput(\"\", \"boolean\");\n        this.addProperty(\"text\", \"click me\");\n        this.addProperty(\"font_size\", 30);\n        this.addProperty(\"message\", \"\");\n        this.size = [164, 84];\n        this.clicked = false;\n    }\n\n    WidgetButton.title = \"Button\";\n    WidgetButton.desc = \"Triggers an event\";\n\n    WidgetButton.font = \"Arial\";\n    WidgetButton.prototype.onDrawForeground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n        var margin = 10;\n        ctx.fillStyle = \"black\";\n        ctx.fillRect(\n            margin + 1,\n            margin + 1,\n            this.size[0] - margin * 2,\n            this.size[1] - margin * 2\n        );\n        ctx.fillStyle = \"#AAF\";\n        ctx.fillRect(\n            margin - 1,\n            margin - 1,\n            this.size[0] - margin * 2,\n            this.size[1] - margin * 2\n        );\n        ctx.fillStyle = this.clicked\n            ? \"white\"\n            : this.mouseOver\n            ? \"#668\"\n            : \"#334\";\n        ctx.fillRect(\n            margin,\n            margin,\n            this.size[0] - margin * 2,\n            this.size[1] - margin * 2\n        );\n\n        if (this.properties.text || this.properties.text === 0) {\n            var font_size = this.properties.font_size || 30;\n            ctx.textAlign = \"center\";\n            ctx.fillStyle = this.clicked ? \"black\" : \"white\";\n            ctx.font = font_size + \"px \" + WidgetButton.font;\n            ctx.fillText(\n                this.properties.text,\n                this.size[0] * 0.5,\n                this.size[1] * 0.5 + font_size * 0.3\n            );\n            ctx.textAlign = \"left\";\n        }\n    };\n\n    WidgetButton.prototype.onMouseDown = function(e, local_pos) {\n        if (\n            local_pos[0] > 1 &&\n            local_pos[1] > 1 &&\n            local_pos[0] < this.size[0] - 2 &&\n            local_pos[1] < this.size[1] - 2\n        ) {\n            this.clicked = true;\n            this.setOutputData(1, this.clicked);\n            this.triggerSlot(0, this.properties.message);\n            return true;\n        }\n    };\n\n    WidgetButton.prototype.onExecute = function() {\n        this.setOutputData(1, this.clicked);\n    };\n\n    WidgetButton.prototype.onMouseUp = function(e) {\n        this.clicked = false;\n    };\n\n    LiteGraph.registerNodeType(\"widget/button\", WidgetButton);\n\n    function WidgetToggle() {\n        this.addInput(\"\", \"boolean\");\n        this.addInput(\"e\", LiteGraph.ACTION);\n        this.addOutput(\"v\", \"boolean\");\n        this.addOutput(\"e\", LiteGraph.EVENT);\n        this.properties = { font: \"\", value: false };\n        this.size = [160, 44];\n    }\n\n    WidgetToggle.title = \"Toggle\";\n    WidgetToggle.desc = \"Toggles between true or false\";\n\n    WidgetToggle.prototype.onDrawForeground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n\n        var size = this.size[1] * 0.5;\n        var margin = 0.25;\n        var h = this.size[1] * 0.8;\n        ctx.font = this.properties.font || (size * 0.8).toFixed(0) + \"px Arial\";\n        var w = ctx.measureText(this.title).width;\n        var x = (this.size[0] - (w + size)) * 0.5;\n\n        ctx.fillStyle = \"#AAA\";\n        ctx.fillRect(x, h - size, size, size);\n\n        ctx.fillStyle = this.properties.value ? \"#AEF\" : \"#000\";\n        ctx.fillRect(\n            x + size * margin,\n            h - size + size * margin,\n            size * (1 - margin * 2),\n            size * (1 - margin * 2)\n        );\n\n        ctx.textAlign = \"left\";\n        ctx.fillStyle = \"#AAA\";\n        ctx.fillText(this.title, size * 1.2 + x, h * 0.85);\n        ctx.textAlign = \"left\";\n    };\n\n    WidgetToggle.prototype.onAction = function(action) {\n        this.properties.value = !this.properties.value;\n        this.trigger(\"e\", this.properties.value);\n    };\n\n    WidgetToggle.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v != null) {\n            this.properties.value = v;\n        }\n        this.setOutputData(0, this.properties.value);\n    };\n\n    WidgetToggle.prototype.onMouseDown = function(e, local_pos) {\n        if (\n            local_pos[0] > 1 &&\n            local_pos[1] > 1 &&\n            local_pos[0] < this.size[0] - 2 &&\n            local_pos[1] < this.size[1] - 2\n        ) {\n            this.properties.value = !this.properties.value;\n            this.graph._version++;\n            this.trigger(\"e\", this.properties.value);\n            return true;\n        }\n    };\n\n    LiteGraph.registerNodeType(\"widget/toggle\", WidgetToggle);\n\n    /* Number ****************/\n\n    function WidgetNumber() {\n        this.addOutput(\"\", \"number\");\n        this.size = [80, 60];\n        this.properties = { min: -1000, max: 1000, value: 1, step: 1 };\n        this.old_y = -1;\n        this._remainder = 0;\n        this._precision = 0;\n        this.mouse_captured = false;\n    }\n\n    WidgetNumber.title = \"Number\";\n    WidgetNumber.desc = \"Widget to select number value\";\n\n    WidgetNumber.pixels_threshold = 10;\n    WidgetNumber.markers_color = \"#666\";\n\n    WidgetNumber.prototype.onDrawForeground = function(ctx) {\n        var x = this.size[0] * 0.5;\n        var h = this.size[1];\n        if (h > 30) {\n            ctx.fillStyle = WidgetNumber.markers_color;\n            ctx.beginPath();\n            ctx.moveTo(x, h * 0.1);\n            ctx.lineTo(x + h * 0.1, h * 0.2);\n            ctx.lineTo(x + h * -0.1, h * 0.2);\n            ctx.fill();\n            ctx.beginPath();\n            ctx.moveTo(x, h * 0.9);\n            ctx.lineTo(x + h * 0.1, h * 0.8);\n            ctx.lineTo(x + h * -0.1, h * 0.8);\n            ctx.fill();\n            ctx.font = (h * 0.7).toFixed(1) + \"px Arial\";\n        } else {\n            ctx.font = (h * 0.8).toFixed(1) + \"px Arial\";\n        }\n\n        ctx.textAlign = \"center\";\n        ctx.font = (h * 0.7).toFixed(1) + \"px Arial\";\n        ctx.fillStyle = \"#EEE\";\n        ctx.fillText(\n            this.properties.value.toFixed(this._precision),\n            x,\n            h * 0.75\n        );\n    };\n\n    WidgetNumber.prototype.onExecute = function() {\n        this.setOutputData(0, this.properties.value);\n    };\n\n    WidgetNumber.prototype.onPropertyChanged = function(name, value) {\n        var t = (this.properties.step + \"\").split(\".\");\n        this._precision = t.length > 1 ? t[1].length : 0;\n    };\n\n    WidgetNumber.prototype.onMouseDown = function(e, pos) {\n        if (pos[1] < 0) {\n            return;\n        }\n\n        this.old_y = e.canvasY;\n        this.captureInput(true);\n        this.mouse_captured = true;\n\n        return true;\n    };\n\n    WidgetNumber.prototype.onMouseMove = function(e) {\n        if (!this.mouse_captured) {\n            return;\n        }\n\n        var delta = this.old_y - e.canvasY;\n        if (e.shiftKey) {\n            delta *= 10;\n        }\n        if (e.metaKey || e.altKey) {\n            delta *= 0.1;\n        }\n        this.old_y = e.canvasY;\n\n        var steps = this._remainder + delta / WidgetNumber.pixels_threshold;\n        this._remainder = steps % 1;\n        steps = steps | 0;\n\n        var v = clamp(\n            this.properties.value + steps * this.properties.step,\n            this.properties.min,\n            this.properties.max\n        );\n        this.properties.value = v;\n        this.graph._version++;\n        this.setDirtyCanvas(true);\n    };\n\n    WidgetNumber.prototype.onMouseUp = function(e, pos) {\n        if (e.click_time < 200) {\n            var steps = pos[1] > this.size[1] * 0.5 ? -1 : 1;\n            this.properties.value = clamp(\n                this.properties.value + steps * this.properties.step,\n                this.properties.min,\n                this.properties.max\n            );\n            this.graph._version++;\n            this.setDirtyCanvas(true);\n        }\n\n        if (this.mouse_captured) {\n            this.mouse_captured = false;\n            this.captureInput(false);\n        }\n    };\n\n    LiteGraph.registerNodeType(\"widget/number\", WidgetNumber);\n\n\n    /* Combo ****************/\n\n    function WidgetCombo() {\n        this.addOutput(\"\", \"string\");\n        this.addOutput(\"change\", LiteGraph.EVENT);\n        this.size = [80, 60];\n        this.properties = { value: \"A\", values:\"A;B;C\" };\n        this.old_y = -1;\n        this.mouse_captured = false;\n\t\tthis._values = this.properties.values.split(\";\");\n\t\tvar that = this;\n        this.widgets_up = true;\n\t\tthis.widget = this.addWidget(\"combo\",\"\", this.properties.value, function(v){\n\t\t\tthat.properties.value = v;\n            that.triggerSlot(1, v);\n\t\t}, { property: \"value\", values: this._values } );\n    }\n\n    WidgetCombo.title = \"Combo\";\n    WidgetCombo.desc = \"Widget to select from a list\";\n\n    WidgetCombo.prototype.onExecute = function() {\n        this.setOutputData( 0, this.properties.value );\n    };\n\n    WidgetCombo.prototype.onPropertyChanged = function(name, value) {\n\t\tif(name == \"values\")\n\t\t{\n\t\t\tthis._values = value.split(\";\");\n\t\t\tthis.widget.options.values = this._values;\n\t\t}\n\t\telse if(name == \"value\")\n\t\t{\n\t\t\tthis.widget.value = value;\n\t\t}\n\t};\n\n    LiteGraph.registerNodeType(\"widget/combo\", WidgetCombo);\n\n\n    /* Knob ****************/\n\n    function WidgetKnob() {\n        this.addOutput(\"\", \"number\");\n        this.size = [64, 84];\n        this.properties = {\n            min: 0,\n            max: 1,\n            value: 0.5,\n            color: \"#7AF\",\n            precision: 2\n        };\n        this.value = -1;\n    }\n\n    WidgetKnob.title = \"Knob\";\n    WidgetKnob.desc = \"Circular controller\";\n    WidgetKnob.size = [80, 100];\n\n    WidgetKnob.prototype.onDrawForeground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n\n        if (this.value == -1) {\n            this.value =\n                (this.properties.value - this.properties.min) /\n                (this.properties.max - this.properties.min);\n        }\n\n        var center_x = this.size[0] * 0.5;\n        var center_y = this.size[1] * 0.5;\n        var radius = Math.min(this.size[0], this.size[1]) * 0.5 - 5;\n        var w = Math.floor(radius * 0.05);\n\n        ctx.globalAlpha = 1;\n        ctx.save();\n        ctx.translate(center_x, center_y);\n        ctx.rotate(Math.PI * 0.75);\n\n        //bg\n        ctx.fillStyle = \"rgba(0,0,0,0.5)\";\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.arc(0, 0, radius, 0, Math.PI * 1.5);\n        ctx.fill();\n\n        //value\n        ctx.strokeStyle = \"black\";\n        ctx.fillStyle = this.properties.color;\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.arc(\n            0,\n            0,\n            radius - 4,\n            0,\n            Math.PI * 1.5 * Math.max(0.01, this.value)\n        );\n        ctx.closePath();\n        ctx.fill();\n        //ctx.stroke();\n        ctx.lineWidth = 1;\n        ctx.globalAlpha = 1;\n        ctx.restore();\n\n        //inner\n        ctx.fillStyle = \"black\";\n        ctx.beginPath();\n        ctx.arc(center_x, center_y, radius * 0.75, 0, Math.PI * 2, true);\n        ctx.fill();\n\n        //miniball\n        ctx.fillStyle = this.mouseOver ? \"white\" : this.properties.color;\n        ctx.beginPath();\n        var angle = this.value * Math.PI * 1.5 + Math.PI * 0.75;\n        ctx.arc(\n            center_x + Math.cos(angle) * radius * 0.65,\n            center_y + Math.sin(angle) * radius * 0.65,\n            radius * 0.05,\n            0,\n            Math.PI * 2,\n            true\n        );\n        ctx.fill();\n\n        //text\n        ctx.fillStyle = this.mouseOver ? \"white\" : \"#AAA\";\n        ctx.font = Math.floor(radius * 0.5) + \"px Arial\";\n        ctx.textAlign = \"center\";\n        ctx.fillText(\n            this.properties.value.toFixed(this.properties.precision),\n            center_x,\n            center_y + radius * 0.15\n        );\n    };\n\n    WidgetKnob.prototype.onExecute = function() {\n        this.setOutputData(0, this.properties.value);\n        this.boxcolor = LiteGraph.colorToString([\n            this.value,\n            this.value,\n            this.value\n        ]);\n    };\n\n    WidgetKnob.prototype.onMouseDown = function(e) {\n        this.center = [this.size[0] * 0.5, this.size[1] * 0.5 + 20];\n        this.radius = this.size[0] * 0.5;\n        if (\n            e.canvasY - this.pos[1] < 20 ||\n            LiteGraph.distance(\n                [e.canvasX, e.canvasY],\n                [this.pos[0] + this.center[0], this.pos[1] + this.center[1]]\n            ) > this.radius\n        ) {\n            return false;\n        }\n        this.oldmouse = [e.canvasX - this.pos[0], e.canvasY - this.pos[1]];\n        this.captureInput(true);\n        return true;\n    };\n\n    WidgetKnob.prototype.onMouseMove = function(e) {\n        if (!this.oldmouse) {\n            return;\n        }\n\n        var m = [e.canvasX - this.pos[0], e.canvasY - this.pos[1]];\n\n        var v = this.value;\n        v -= (m[1] - this.oldmouse[1]) * 0.01;\n        if (v > 1.0) {\n            v = 1.0;\n        } else if (v < 0.0) {\n            v = 0.0;\n        }\n        this.value = v;\n        this.properties.value =\n            this.properties.min +\n            (this.properties.max - this.properties.min) * this.value;\n        this.oldmouse = m;\n        this.setDirtyCanvas(true);\n    };\n\n    WidgetKnob.prototype.onMouseUp = function(e) {\n        if (this.oldmouse) {\n            this.oldmouse = null;\n            this.captureInput(false);\n        }\n    };\n\n    WidgetKnob.prototype.onPropertyChanged = function(name, value) {\n        if (name == \"min\" || name == \"max\" || name == \"value\") {\n            this.properties[name] = parseFloat(value);\n            return true; //block\n        }\n    };\n\n    LiteGraph.registerNodeType(\"widget/knob\", WidgetKnob);\n\n    //Show value inside the debug console\n    function WidgetSliderGUI() {\n        this.addOutput(\"\", \"number\");\n        this.properties = {\n            value: 0.5,\n            min: 0,\n            max: 1,\n            text: \"V\"\n        };\n        var that = this;\n        this.size = [140, 40];\n        this.slider = this.addWidget(\n            \"slider\",\n            \"V\",\n            this.properties.value,\n            function(v) {\n                that.properties.value = v;\n            },\n            this.properties\n        );\n        this.widgets_up = true;\n    }\n\n    WidgetSliderGUI.title = \"Inner Slider\";\n\n    WidgetSliderGUI.prototype.onPropertyChanged = function(name, value) {\n        if (name == \"value\") {\n            this.slider.value = value;\n        }\n    };\n\n    WidgetSliderGUI.prototype.onExecute = function() {\n        this.setOutputData(0, this.properties.value);\n    };\n\n    LiteGraph.registerNodeType(\"widget/internal_slider\", WidgetSliderGUI);\n\n    //Widget H SLIDER\n    function WidgetHSlider() {\n        this.size = [160, 26];\n        this.addOutput(\"\", \"number\");\n        this.properties = { color: \"#7AF\", min: 0, max: 1, value: 0.5 };\n        this.value = -1;\n    }\n\n    WidgetHSlider.title = \"H.Slider\";\n    WidgetHSlider.desc = \"Linear slider controller\";\n\n    WidgetHSlider.prototype.onDrawForeground = function(ctx) {\n        if (this.value == -1) {\n            this.value =\n                (this.properties.value - this.properties.min) /\n                (this.properties.max - this.properties.min);\n        }\n\n        //border\n        ctx.globalAlpha = 1;\n        ctx.lineWidth = 1;\n        ctx.fillStyle = \"#000\";\n        ctx.fillRect(2, 2, this.size[0] - 4, this.size[1] - 4);\n\n        ctx.fillStyle = this.properties.color;\n        ctx.beginPath();\n        ctx.rect(4, 4, (this.size[0] - 8) * this.value, this.size[1] - 8);\n        ctx.fill();\n    };\n\n    WidgetHSlider.prototype.onExecute = function() {\n        this.properties.value =\n            this.properties.min +\n            (this.properties.max - this.properties.min) * this.value;\n        this.setOutputData(0, this.properties.value);\n        this.boxcolor = LiteGraph.colorToString([\n            this.value,\n            this.value,\n            this.value\n        ]);\n    };\n\n    WidgetHSlider.prototype.onMouseDown = function(e) {\n        if (e.canvasY - this.pos[1] < 0) {\n            return false;\n        }\n\n        this.oldmouse = [e.canvasX - this.pos[0], e.canvasY - this.pos[1]];\n        this.captureInput(true);\n        return true;\n    };\n\n    WidgetHSlider.prototype.onMouseMove = function(e) {\n        if (!this.oldmouse) {\n            return;\n        }\n\n        var m = [e.canvasX - this.pos[0], e.canvasY - this.pos[1]];\n\n        var v = this.value;\n        var delta = m[0] - this.oldmouse[0];\n        v += delta / this.size[0];\n        if (v > 1.0) {\n            v = 1.0;\n        } else if (v < 0.0) {\n            v = 0.0;\n        }\n\n        this.value = v;\n\n        this.oldmouse = m;\n        this.setDirtyCanvas(true);\n    };\n\n    WidgetHSlider.prototype.onMouseUp = function(e) {\n        this.oldmouse = null;\n        this.captureInput(false);\n    };\n\n    WidgetHSlider.prototype.onMouseLeave = function(e) {\n        //this.oldmouse = null;\n    };\n\n    LiteGraph.registerNodeType(\"widget/hslider\", WidgetHSlider);\n\n    function WidgetProgress() {\n        this.size = [160, 26];\n        this.addInput(\"\", \"number\");\n        this.properties = { min: 0, max: 1, value: 0, color: \"#AAF\" };\n    }\n\n    WidgetProgress.title = \"Progress\";\n    WidgetProgress.desc = \"Shows data in linear progress\";\n\n    WidgetProgress.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v != undefined) {\n            this.properties[\"value\"] = v;\n        }\n    };\n\n    WidgetProgress.prototype.onDrawForeground = function(ctx) {\n        //border\n        ctx.lineWidth = 1;\n        ctx.fillStyle = this.properties.color;\n        var v =\n            (this.properties.value - this.properties.min) /\n            (this.properties.max - this.properties.min);\n        v = Math.min(1, v);\n        v = Math.max(0, v);\n        ctx.fillRect(2, 2, (this.size[0] - 4) * v, this.size[1] - 4);\n    };\n\n    LiteGraph.registerNodeType(\"widget/progress\", WidgetProgress);\n\n    function WidgetText() {\n        this.addInputs(\"\", 0);\n        this.properties = {\n            value: \"...\",\n            font: \"Arial\",\n            fontsize: 18,\n            color: \"#AAA\",\n            align: \"left\",\n            glowSize: 0,\n            decimals: 1\n        };\n    }\n\n    WidgetText.title = \"Text\";\n    WidgetText.desc = \"Shows the input value\";\n    WidgetText.widgets = [\n        { name: \"resize\", text: \"Resize box\", type: \"button\" },\n        { name: \"led_text\", text: \"LED\", type: \"minibutton\" },\n        { name: \"normal_text\", text: \"Normal\", type: \"minibutton\" }\n    ];\n\n    WidgetText.prototype.onDrawForeground = function(ctx) {\n        //ctx.fillStyle=\"#000\";\n        //ctx.fillRect(0,0,100,60);\n        ctx.fillStyle = this.properties[\"color\"];\n        var v = this.properties[\"value\"];\n\n        if (this.properties[\"glowSize\"]) {\n            ctx.shadowColor = this.properties.color;\n            ctx.shadowOffsetX = 0;\n            ctx.shadowOffsetY = 0;\n            ctx.shadowBlur = this.properties[\"glowSize\"];\n        } else {\n            ctx.shadowColor = \"transparent\";\n        }\n\n        var fontsize = this.properties[\"fontsize\"];\n\n        ctx.textAlign = this.properties[\"align\"];\n        ctx.font = fontsize.toString() + \"px \" + this.properties[\"font\"];\n        this.str =\n            typeof v == \"number\" ? v.toFixed(this.properties[\"decimals\"]) : v;\n\n        if (typeof this.str == \"string\") {\n            var lines = this.str.replace(/[\\r\\n]/g, \"\\\\n\").split(\"\\\\n\");\n            for (var i=0; i < lines.length; i++) {\n                ctx.fillText(\n                    lines[i],\n                    this.properties[\"align\"] == \"left\" ? 15 : this.size[0] - 15,\n                    fontsize * -0.15 + fontsize * (parseInt(i) + 1)\n                );\n            }\n        }\n\n        ctx.shadowColor = \"transparent\";\n        this.last_ctx = ctx;\n        ctx.textAlign = \"left\";\n    };\n\n    WidgetText.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v != null) {\n            this.properties[\"value\"] = v;\n        }\n        //this.setDirtyCanvas(true);\n    };\n\n    WidgetText.prototype.resize = function() {\n        if (!this.last_ctx) {\n            return;\n        }\n\n        var lines = this.str.split(\"\\\\n\");\n        this.last_ctx.font =\n            this.properties[\"fontsize\"] + \"px \" + this.properties[\"font\"];\n        var max = 0;\n        for (var i=0; i < lines.length; i++) {\n            var w = this.last_ctx.measureText(lines[i]).width;\n            if (max < w) {\n                max = w;\n            }\n        }\n        this.size[0] = max + 20;\n        this.size[1] = 4 + lines.length * this.properties[\"fontsize\"];\n\n        this.setDirtyCanvas(true);\n    };\n\n    WidgetText.prototype.onPropertyChanged = function(name, value) {\n        this.properties[name] = value;\n        this.str = typeof value == \"number\" ? value.toFixed(3) : value;\n        //this.resize();\n        return true;\n    };\n\n    LiteGraph.registerNodeType(\"widget/text\", WidgetText);\n\n    function WidgetPanel() {\n        this.size = [200, 100];\n        this.properties = {\n            borderColor: \"#ffffff\",\n            bgcolorTop: \"#f0f0f0\",\n            bgcolorBottom: \"#e0e0e0\",\n            shadowSize: 2,\n            borderRadius: 3\n        };\n    }\n\n    WidgetPanel.title = \"Panel\";\n    WidgetPanel.desc = \"Non interactive panel\";\n    WidgetPanel.widgets = [{ name: \"update\", text: \"Update\", type: \"button\" }];\n\n    WidgetPanel.prototype.createGradient = function(ctx) {\n        if (\n            this.properties[\"bgcolorTop\"] == \"\" ||\n            this.properties[\"bgcolorBottom\"] == \"\"\n        ) {\n            this.lineargradient = 0;\n            return;\n        }\n\n        this.lineargradient = ctx.createLinearGradient(0, 0, 0, this.size[1]);\n        this.lineargradient.addColorStop(0, this.properties[\"bgcolorTop\"]);\n        this.lineargradient.addColorStop(1, this.properties[\"bgcolorBottom\"]);\n    };\n\n    WidgetPanel.prototype.onDrawForeground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n\n        if (this.lineargradient == null) {\n            this.createGradient(ctx);\n        }\n\n        if (!this.lineargradient) {\n            return;\n        }\n\n        ctx.lineWidth = 1;\n        ctx.strokeStyle = this.properties[\"borderColor\"];\n        //ctx.fillStyle = \"#ebebeb\";\n        ctx.fillStyle = this.lineargradient;\n\n        if (this.properties[\"shadowSize\"]) {\n            ctx.shadowColor = \"#000\";\n            ctx.shadowOffsetX = 0;\n            ctx.shadowOffsetY = 0;\n            ctx.shadowBlur = this.properties[\"shadowSize\"];\n        } else {\n            ctx.shadowColor = \"transparent\";\n        }\n\n        ctx.roundRect(\n            0,\n            0,\n            this.size[0] - 1,\n            this.size[1] - 1,\n            this.properties[\"shadowSize\"]\n        );\n        ctx.fill();\n        ctx.shadowColor = \"transparent\";\n        ctx.stroke();\n    };\n\n    LiteGraph.registerNodeType(\"widget/panel\", WidgetPanel);\n})(this);\n\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n    function GamepadInput() {\r\n        this.addOutput(\"left_x_axis\", \"number\");\r\n        this.addOutput(\"left_y_axis\", \"number\");\r\n        this.addOutput(\"button_pressed\", LiteGraph.EVENT);\r\n        this.properties = { gamepad_index: 0, threshold: 0.1 };\r\n\r\n        this._left_axis = new Float32Array(2);\r\n        this._right_axis = new Float32Array(2);\r\n        this._triggers = new Float32Array(2);\r\n        this._previous_buttons = new Uint8Array(17);\r\n        this._current_buttons = new Uint8Array(17);\r\n    }\r\n\r\n    GamepadInput.title = \"Gamepad\";\r\n    GamepadInput.desc = \"gets the input of the gamepad\";\r\n\r\n    GamepadInput.CENTER = 0;\r\n    GamepadInput.LEFT = 1;\r\n    GamepadInput.RIGHT = 2;\r\n    GamepadInput.UP = 4;\r\n    GamepadInput.DOWN = 8;\r\n\r\n    GamepadInput.zero = new Float32Array(2);\r\n    GamepadInput.buttons = [\r\n        \"a\",\r\n        \"b\",\r\n        \"x\",\r\n        \"y\",\r\n        \"lb\",\r\n        \"rb\",\r\n        \"lt\",\r\n        \"rt\",\r\n        \"back\",\r\n        \"start\",\r\n        \"ls\",\r\n        \"rs\",\r\n        \"home\"\r\n    ];\r\n\r\n    GamepadInput.prototype.onExecute = function() {\r\n        //get gamepad\r\n        var gamepad = this.getGamepad();\r\n        var threshold = this.properties.threshold || 0.0;\r\n\r\n        if (gamepad) {\r\n            this._left_axis[0] =\r\n                Math.abs(gamepad.xbox.axes[\"lx\"]) > threshold\r\n                    ? gamepad.xbox.axes[\"lx\"]\r\n                    : 0;\r\n            this._left_axis[1] =\r\n                Math.abs(gamepad.xbox.axes[\"ly\"]) > threshold\r\n                    ? gamepad.xbox.axes[\"ly\"]\r\n                    : 0;\r\n            this._right_axis[0] =\r\n                Math.abs(gamepad.xbox.axes[\"rx\"]) > threshold\r\n                    ? gamepad.xbox.axes[\"rx\"]\r\n                    : 0;\r\n            this._right_axis[1] =\r\n                Math.abs(gamepad.xbox.axes[\"ry\"]) > threshold\r\n                    ? gamepad.xbox.axes[\"ry\"]\r\n                    : 0;\r\n            this._triggers[0] =\r\n                Math.abs(gamepad.xbox.axes[\"ltrigger\"]) > threshold\r\n                    ? gamepad.xbox.axes[\"ltrigger\"]\r\n                    : 0;\r\n            this._triggers[1] =\r\n                Math.abs(gamepad.xbox.axes[\"rtrigger\"]) > threshold\r\n                    ? gamepad.xbox.axes[\"rtrigger\"]\r\n                    : 0;\r\n        }\r\n\r\n        if (this.outputs) {\r\n            for (var i = 0; i < this.outputs.length; i++) {\r\n                var output = this.outputs[i];\r\n                if (!output.links || !output.links.length) {\r\n                    continue;\r\n                }\r\n                var v = null;\r\n\r\n                if (gamepad) {\r\n                    switch (output.name) {\r\n                        case \"left_axis\":\r\n                            v = this._left_axis;\r\n                            break;\r\n                        case \"right_axis\":\r\n                            v = this._right_axis;\r\n                            break;\r\n                        case \"left_x_axis\":\r\n                            v = this._left_axis[0];\r\n                            break;\r\n                        case \"left_y_axis\":\r\n                            v = this._left_axis[1];\r\n                            break;\r\n                        case \"right_x_axis\":\r\n                            v = this._right_axis[0];\r\n                            break;\r\n                        case \"right_y_axis\":\r\n                            v = this._right_axis[1];\r\n                            break;\r\n                        case \"trigger_left\":\r\n                            v = this._triggers[0];\r\n                            break;\r\n                        case \"trigger_right\":\r\n                            v = this._triggers[1];\r\n                            break;\r\n                        case \"a_button\":\r\n                            v = gamepad.xbox.buttons[\"a\"] ? 1 : 0;\r\n                            break;\r\n                        case \"b_button\":\r\n                            v = gamepad.xbox.buttons[\"b\"] ? 1 : 0;\r\n                            break;\r\n                        case \"x_button\":\r\n                            v = gamepad.xbox.buttons[\"x\"] ? 1 : 0;\r\n                            break;\r\n                        case \"y_button\":\r\n                            v = gamepad.xbox.buttons[\"y\"] ? 1 : 0;\r\n                            break;\r\n                        case \"lb_button\":\r\n                            v = gamepad.xbox.buttons[\"lb\"] ? 1 : 0;\r\n                            break;\r\n                        case \"rb_button\":\r\n                            v = gamepad.xbox.buttons[\"rb\"] ? 1 : 0;\r\n                            break;\r\n                        case \"ls_button\":\r\n                            v = gamepad.xbox.buttons[\"ls\"] ? 1 : 0;\r\n                            break;\r\n                        case \"rs_button\":\r\n                            v = gamepad.xbox.buttons[\"rs\"] ? 1 : 0;\r\n                            break;\r\n                        case \"hat_left\":\r\n                            v = gamepad.xbox.hatmap & GamepadInput.LEFT;\r\n                            break;\r\n                        case \"hat_right\":\r\n                            v = gamepad.xbox.hatmap & GamepadInput.RIGHT;\r\n                            break;\r\n                        case \"hat_up\":\r\n                            v = gamepad.xbox.hatmap & GamepadInput.UP;\r\n                            break;\r\n                        case \"hat_down\":\r\n                            v = gamepad.xbox.hatmap & GamepadInput.DOWN;\r\n                            break;\r\n                        case \"hat\":\r\n                            v = gamepad.xbox.hatmap;\r\n                            break;\r\n                        case \"start_button\":\r\n                            v = gamepad.xbox.buttons[\"start\"] ? 1 : 0;\r\n                            break;\r\n                        case \"back_button\":\r\n                            v = gamepad.xbox.buttons[\"back\"] ? 1 : 0;\r\n                            break;\r\n                        case \"button_pressed\":\r\n                            for (\r\n                                var j = 0;\r\n                                j < this._current_buttons.length;\r\n                                ++j\r\n                            ) {\r\n                                if (\r\n                                    this._current_buttons[j] &&\r\n                                    !this._previous_buttons[j]\r\n                                ) {\r\n                                    this.triggerSlot(\r\n                                        i,\r\n                                        GamepadInput.buttons[j]\r\n                                    );\r\n                                }\r\n                            }\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                } else {\r\n                    //if no gamepad is connected, output 0\r\n                    switch (output.name) {\r\n                        case \"button_pressed\":\r\n                            break;\r\n                        case \"left_axis\":\r\n                        case \"right_axis\":\r\n                            v = GamepadInput.zero;\r\n                            break;\r\n                        default:\r\n                            v = 0;\r\n                    }\r\n                }\r\n                this.setOutputData(i, v);\r\n            }\r\n        }\r\n    };\r\n\r\n\tGamepadInput.mapping = {a:0,b:1,x:2,y:3,lb:4,rb:5,lt:6,rt:7,back:8,start:9,ls:10,rs:11 };\r\n\tGamepadInput.mapping_array = [\"a\",\"b\",\"x\",\"y\",\"lb\",\"rb\",\"lt\",\"rt\",\"back\",\"start\",\"ls\",\"rs\"];\r\n\r\n    GamepadInput.prototype.getGamepad = function() {\r\n        var getGamepads =\r\n            navigator.getGamepads ||\r\n            navigator.webkitGetGamepads ||\r\n            navigator.mozGetGamepads;\r\n        if (!getGamepads) {\r\n            return null;\r\n        }\r\n        var gamepads = getGamepads.call(navigator);\r\n        var gamepad = null;\r\n\r\n        this._previous_buttons.set(this._current_buttons);\r\n\r\n        //pick the first connected\r\n        for (var i = this.properties.gamepad_index; i < 4; i++) {\r\n            if (!gamepads[i]) {\r\n                continue;\r\n            }\r\n            gamepad = gamepads[i];\r\n\r\n            //xbox controller mapping\r\n            var xbox = this.xbox_mapping;\r\n            if (!xbox) {\r\n                xbox = this.xbox_mapping = {\r\n                    axes: [],\r\n                    buttons: {},\r\n                    hat: \"\",\r\n                    hatmap: GamepadInput.CENTER\r\n                };\r\n            }\r\n\r\n            xbox.axes[\"lx\"] = gamepad.axes[0];\r\n            xbox.axes[\"ly\"] = gamepad.axes[1];\r\n            xbox.axes[\"rx\"] = gamepad.axes[2];\r\n            xbox.axes[\"ry\"] = gamepad.axes[3];\r\n            xbox.axes[\"ltrigger\"] = gamepad.buttons[6].value;\r\n            xbox.axes[\"rtrigger\"] = gamepad.buttons[7].value;\r\n            xbox.hat = \"\";\r\n            xbox.hatmap = GamepadInput.CENTER;\r\n\r\n            for (var j = 0; j < gamepad.buttons.length; j++) {\r\n                this._current_buttons[j] = gamepad.buttons[j].pressed;\r\n\r\n\t\t\t\tif(j < 12)\r\n\t\t\t\t{\r\n\t\t\t\t\txbox.buttons[ GamepadInput.mapping_array[j] ] = gamepad.buttons[j].pressed;\r\n\t\t\t\t\tif(gamepad.buttons[j].was_pressed)\r\n\t\t\t\t\t\tthis.trigger( GamepadInput.mapping_array[j] + \"_button_event\" );\r\n\t\t\t\t}\r\n\t\t\t\telse //mapping of XBOX\r\n\t\t\t\t\tswitch ( j ) //I use a switch to ensure that a player with another gamepad could play\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcase 12:\r\n\t\t\t\t\t\t\tif (gamepad.buttons[j].pressed) {\r\n\t\t\t\t\t\t\t\txbox.hat += \"up\";\r\n\t\t\t\t\t\t\t\txbox.hatmap |= GamepadInput.UP;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 13:\r\n\t\t\t\t\t\t\tif (gamepad.buttons[j].pressed) {\r\n\t\t\t\t\t\t\t\txbox.hat += \"down\";\r\n\t\t\t\t\t\t\t\txbox.hatmap |= GamepadInput.DOWN;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 14:\r\n\t\t\t\t\t\t\tif (gamepad.buttons[j].pressed) {\r\n\t\t\t\t\t\t\t\txbox.hat += \"left\";\r\n\t\t\t\t\t\t\t\txbox.hatmap |= GamepadInput.LEFT;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 15:\r\n\t\t\t\t\t\t\tif (gamepad.buttons[j].pressed) {\r\n\t\t\t\t\t\t\t\txbox.hat += \"right\";\r\n\t\t\t\t\t\t\t\txbox.hatmap |= GamepadInput.RIGHT;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 16:\r\n\t\t\t\t\t\t\txbox.buttons[\"home\"] = gamepad.buttons[j].pressed;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t}\r\n            }\r\n            gamepad.xbox = xbox;\r\n            return gamepad;\r\n        }\r\n    };\r\n\r\n    GamepadInput.prototype.onDrawBackground = function(ctx) {\r\n        if (this.flags.collapsed) {\r\n            return;\r\n        }\r\n\r\n        //render gamepad state?\r\n        var la = this._left_axis;\r\n        var ra = this._right_axis;\r\n        ctx.strokeStyle = \"#88A\";\r\n        ctx.strokeRect(\r\n            (la[0] + 1) * 0.5 * this.size[0] - 4,\r\n            (la[1] + 1) * 0.5 * this.size[1] - 4,\r\n            8,\r\n            8\r\n        );\r\n        ctx.strokeStyle = \"#8A8\";\r\n        ctx.strokeRect(\r\n            (ra[0] + 1) * 0.5 * this.size[0] - 4,\r\n            (ra[1] + 1) * 0.5 * this.size[1] - 4,\r\n            8,\r\n            8\r\n        );\r\n        var h = this.size[1] / this._current_buttons.length;\r\n        ctx.fillStyle = \"#AEB\";\r\n        for (var i = 0; i < this._current_buttons.length; ++i) {\r\n            if (this._current_buttons[i]) {\r\n                ctx.fillRect(0, h * i, 6, h);\r\n            }\r\n        }\r\n    };\r\n\r\n    GamepadInput.prototype.onGetOutputs = function() {\r\n        return [\r\n            [\"left_axis\", \"vec2\"],\r\n            [\"right_axis\", \"vec2\"],\r\n            [\"left_x_axis\", \"number\"],\r\n            [\"left_y_axis\", \"number\"],\r\n            [\"right_x_axis\", \"number\"],\r\n            [\"right_y_axis\", \"number\"],\r\n            [\"trigger_left\", \"number\"],\r\n            [\"trigger_right\", \"number\"],\r\n            [\"a_button\", \"number\"],\r\n            [\"b_button\", \"number\"],\r\n            [\"x_button\", \"number\"],\r\n            [\"y_button\", \"number\"],\r\n            [\"lb_button\", \"number\"],\r\n            [\"rb_button\", \"number\"],\r\n            [\"ls_button\", \"number\"],\r\n            [\"rs_button\", \"number\"],\r\n            [\"start_button\", \"number\"],\r\n            [\"back_button\", \"number\"],\r\n            [\"a_button_event\", LiteGraph.EVENT ],\r\n            [\"b_button_event\", LiteGraph.EVENT ],\r\n            [\"x_button_event\", LiteGraph.EVENT ],\r\n            [\"y_button_event\", LiteGraph.EVENT ],\r\n            [\"lb_button_event\", LiteGraph.EVENT ],\r\n            [\"rb_button_event\", LiteGraph.EVENT ],\r\n            [\"ls_button_event\", LiteGraph.EVENT ],\r\n            [\"rs_button_event\", LiteGraph.EVENT ],\r\n            [\"start_button_event\", LiteGraph.EVENT ],\r\n            [\"back_button_event\", LiteGraph.EVENT ],\r\n            [\"hat_left\", \"number\"],\r\n            [\"hat_right\", \"number\"],\r\n            [\"hat_up\", \"number\"],\r\n            [\"hat_down\", \"number\"],\r\n            [\"hat\", \"number\"],\r\n            [\"button_pressed\", LiteGraph.EVENT]\r\n        ];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"input/gamepad\", GamepadInput);\r\n\r\n})(this);\r\n\n(function(global) {\n    var LiteGraph = global.LiteGraph;\n\n    //Converter\n    function Converter() {\n        this.addInput(\"in\", 0);\n\t\tthis.addOutput(\"out\", 0);\n        this.size = [80, 30];\n    }\n\n    Converter.title = \"Converter\";\n    Converter.desc = \"type A to type B\";\n\n    Converter.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n\n        if (this.outputs) {\n            for (var i = 0; i < this.outputs.length; i++) {\n                var output = this.outputs[i];\n                if (!output.links || !output.links.length) {\n                    continue;\n                }\n\n                var result = null;\n                switch (output.name) {\n                    case \"number\":\n                        result = v.length ? v[0] : parseFloat(v);\n                        break;\n                    case \"vec2\":\n                    case \"vec3\":\n                    case \"vec4\":\n                        var result = null;\n                        var count = 1;\n                        switch (output.name) {\n                            case \"vec2\":\n                                count = 2;\n                                break;\n                            case \"vec3\":\n                                count = 3;\n                                break;\n                            case \"vec4\":\n                                count = 4;\n                                break;\n                        }\n\n                        var result = new Float32Array(count);\n                        if (v.length) {\n                            for (\n                                var j = 0;\n                                j < v.length && j < result.length;\n                                j++\n                            ) {\n                                result[j] = v[j];\n                            }\n                        } else {\n                            result[0] = parseFloat(v);\n                        }\n                        break;\n                }\n                this.setOutputData(i, result);\n            }\n        }\n    };\n\n    Converter.prototype.onGetOutputs = function() {\n        return [\n            [\"number\", \"number\"],\n            [\"vec2\", \"vec2\"],\n            [\"vec3\", \"vec3\"],\n            [\"vec4\", \"vec4\"]\n        ];\n    };\n\n    LiteGraph.registerNodeType(\"math/converter\", Converter);\n\n    //Bypass\n    function Bypass() {\n        this.addInput(\"in\");\n        this.addOutput(\"out\");\n        this.size = [80, 30];\n    }\n\n    Bypass.title = \"Bypass\";\n    Bypass.desc = \"removes the type\";\n\n    Bypass.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        this.setOutputData(0, v);\n    };\n\n    LiteGraph.registerNodeType(\"math/bypass\", Bypass);\n\n    function ToNumber() {\n        this.addInput(\"in\");\n        this.addOutput(\"out\");\n    }\n\n    ToNumber.title = \"to Number\";\n    ToNumber.desc = \"Cast to number\";\n\n    ToNumber.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        this.setOutputData(0, Number(v));\n    };\n\n    LiteGraph.registerNodeType(\"math/to_number\", ToNumber);\n\n    function MathRange() {\n        this.addInput(\"in\", \"number\", { locked: true });\n        this.addOutput(\"out\", \"number\", { locked: true });\n        this.addOutput(\"clamped\", \"number\", { locked: true });\n\n        this.addProperty(\"in\", 0);\n        this.addProperty(\"in_min\", 0);\n        this.addProperty(\"in_max\", 1);\n        this.addProperty(\"out_min\", 0);\n        this.addProperty(\"out_max\", 1);\n\n        this.size = [120, 50];\n    }\n\n    MathRange.title = \"Range\";\n    MathRange.desc = \"Convert a number from one range to another\";\n\n    MathRange.prototype.getTitle = function() {\n        if (this.flags.collapsed) {\n            return (this._last_v || 0).toFixed(2);\n        }\n        return this.title;\n    };\n\n    MathRange.prototype.onExecute = function() {\n        if (this.inputs) {\n            for (var i = 0; i < this.inputs.length; i++) {\n                var input = this.inputs[i];\n                var v = this.getInputData(i);\n                if (v === undefined) {\n                    continue;\n                }\n                this.properties[input.name] = v;\n            }\n        }\n\n        var v = this.properties[\"in\"];\n        if (v === undefined || v === null || v.constructor !== Number) {\n            v = 0;\n        }\n\n        var in_min = this.properties.in_min;\n        var in_max = this.properties.in_max;\n        var out_min = this.properties.out_min;\n        var out_max = this.properties.out_max;\n\t\t/*\n\t\tif( in_min > in_max )\n\t\t{\n\t\t\tin_min = in_max;\n\t\t\tin_max = this.properties.in_min;\n\t\t}\n\t\tif( out_min > out_max )\n\t\t{\n\t\t\tout_min = out_max;\n\t\t\tout_max = this.properties.out_min;\n\t\t}\n\t\t*/\n\n        this._last_v = ((v - in_min) / (in_max - in_min)) * (out_max - out_min) + out_min;\n        this.setOutputData(0, this._last_v);\n        this.setOutputData(1, clamp( this._last_v, out_min, out_max ));\n    };\n\n    MathRange.prototype.onDrawBackground = function(ctx) {\n        //show the current value\n        if (this._last_v) {\n            this.outputs[0].label = this._last_v.toFixed(3);\n        } else {\n            this.outputs[0].label = \"?\";\n        }\n    };\n\n    MathRange.prototype.onGetInputs = function() {\n        return [\n            [\"in_min\", \"number\"],\n            [\"in_max\", \"number\"],\n            [\"out_min\", \"number\"],\n            [\"out_max\", \"number\"]\n        ];\n    };\n\n    LiteGraph.registerNodeType(\"math/range\", MathRange);\n\n    function MathRand() {\n        this.addOutput(\"value\", \"number\");\n        this.addProperty(\"min\", 0);\n        this.addProperty(\"max\", 1);\n        this.size = [80, 30];\n    }\n\n    MathRand.title = \"Rand\";\n    MathRand.desc = \"Random number\";\n\n    MathRand.prototype.onExecute = function() {\n        if (this.inputs) {\n            for (var i = 0; i < this.inputs.length; i++) {\n                var input = this.inputs[i];\n                var v = this.getInputData(i);\n                if (v === undefined) {\n                    continue;\n                }\n                this.properties[input.name] = v;\n            }\n        }\n\n        var min = this.properties.min;\n        var max = this.properties.max;\n        this._last_v = Math.random() * (max - min) + min;\n        this.setOutputData(0, this._last_v);\n    };\n\n    MathRand.prototype.onDrawBackground = function(ctx) {\n        //show the current value\n        this.outputs[0].label = (this._last_v || 0).toFixed(3);\n    };\n\n    MathRand.prototype.onGetInputs = function() {\n        return [[\"min\", \"number\"], [\"max\", \"number\"]];\n    };\n\n    LiteGraph.registerNodeType(\"math/rand\", MathRand);\n\n    //basic continuous noise\n    function MathNoise() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.addProperty(\"min\", 0);\n        this.addProperty(\"max\", 1);\n        this.addProperty(\"smooth\", true);\n        this.addProperty(\"seed\", 0);\n        this.addProperty(\"octaves\", 1);\n        this.addProperty(\"persistence\", 0.8);\n        this.addProperty(\"speed\", 1);\n        this.size = [90, 30];\n    }\n\n    MathNoise.title = \"Noise\";\n    MathNoise.desc = \"Random number with temporal continuity\";\n    MathNoise.data = null;\n\n    MathNoise.getValue = function(f, smooth) {\n        if (!MathNoise.data) {\n            MathNoise.data = new Float32Array(1024);\n            for (var i = 0; i < MathNoise.data.length; ++i) {\n                MathNoise.data[i] = Math.random();\n            }\n        }\n        f = f % 1024;\n        if (f < 0) {\n            f += 1024;\n        }\n        var f_min = Math.floor(f);\n        var f = f - f_min;\n        var r1 = MathNoise.data[f_min];\n        var r2 = MathNoise.data[f_min == 1023 ? 0 : f_min + 1];\n        if (smooth) {\n            f = f * f * f * (f * (f * 6.0 - 15.0) + 10.0);\n        }\n        return r1 * (1 - f) + r2 * f;\n    };\n\n    MathNoise.prototype.onExecute = function() {\n        var f = this.getInputData(0) || 0;\n\t\tvar iterations = this.properties.octaves || 1;\n\t\tvar r = 0;\n\t\tvar amp = 1;\n\t\tvar seed = this.properties.seed || 0;\n\t\tf += seed;\n\t\tvar speed = this.properties.speed || 1;\n\t\tvar total_amp = 0;\n\t\tfor(var i = 0; i < iterations; ++i)\n\t\t{\n\t\t\tr += MathNoise.getValue(f * (1+i) * speed, this.properties.smooth) * amp;\n\t\t\ttotal_amp += amp;\n\t\t\tamp *= this.properties.persistence;\n\t\t\tif(amp < 0.001)\n\t\t\t\tbreak;\n\t\t}\n\t\tr /= total_amp;\n        var min = this.properties.min;\n        var max = this.properties.max;\n        this._last_v = r * (max - min) + min;\n        this.setOutputData(0, this._last_v);\n    };\n\n    MathNoise.prototype.onDrawBackground = function(ctx) {\n        //show the current value\n        this.outputs[0].label = (this._last_v || 0).toFixed(3);\n    };\n\n    LiteGraph.registerNodeType(\"math/noise\", MathNoise);\n\n    //generates spikes every random time\n    function MathSpikes() {\n        this.addOutput(\"out\", \"number\");\n        this.addProperty(\"min_time\", 1);\n        this.addProperty(\"max_time\", 2);\n        this.addProperty(\"duration\", 0.2);\n        this.size = [90, 30];\n        this._remaining_time = 0;\n        this._blink_time = 0;\n    }\n\n    MathSpikes.title = \"Spikes\";\n    MathSpikes.desc = \"spike every random time\";\n\n    MathSpikes.prototype.onExecute = function() {\n        var dt = this.graph.elapsed_time; //in secs\n\n        this._remaining_time -= dt;\n        this._blink_time -= dt;\n\n        var v = 0;\n        if (this._blink_time > 0) {\n            var f = this._blink_time / this.properties.duration;\n            v = 1 / (Math.pow(f * 8 - 4, 4) + 1);\n        }\n\n        if (this._remaining_time < 0) {\n            this._remaining_time =\n                Math.random() *\n                    (this.properties.max_time - this.properties.min_time) +\n                this.properties.min_time;\n            this._blink_time = this.properties.duration;\n            this.boxcolor = \"#FFF\";\n        } else {\n            this.boxcolor = \"#000\";\n        }\n        this.setOutputData(0, v);\n    };\n\n    LiteGraph.registerNodeType(\"math/spikes\", MathSpikes);\n\n    //Math clamp\n    function MathClamp() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.size = [80, 30];\n        this.addProperty(\"min\", 0);\n        this.addProperty(\"max\", 1);\n    }\n\n    MathClamp.title = \"Clamp\";\n    MathClamp.desc = \"Clamp number between min and max\";\n    //MathClamp.filter = \"shader\";\n\n    MathClamp.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n        v = Math.max(this.properties.min, v);\n        v = Math.min(this.properties.max, v);\n        this.setOutputData(0, v);\n    };\n\n    MathClamp.prototype.getCode = function(lang) {\n        var code = \"\";\n        if (this.isInputConnected(0)) {\n            code +=\n                \"clamp({{0}},\" +\n                this.properties.min +\n                \",\" +\n                this.properties.max +\n                \")\";\n        }\n        return code;\n    };\n\n    LiteGraph.registerNodeType(\"math/clamp\", MathClamp);\n\n    //Math ABS\n    function MathLerp() {\n        this.properties = { f: 0.5 };\n        this.addInput(\"A\", \"number\");\n        this.addInput(\"B\", \"number\");\n\n        this.addOutput(\"out\", \"number\");\n    }\n\n    MathLerp.title = \"Lerp\";\n    MathLerp.desc = \"Linear Interpolation\";\n\n    MathLerp.prototype.onExecute = function() {\n        var v1 = this.getInputData(0);\n        if (v1 == null) {\n            v1 = 0;\n        }\n        var v2 = this.getInputData(1);\n        if (v2 == null) {\n            v2 = 0;\n        }\n\n        var f = this.properties.f;\n\n        var _f = this.getInputData(2);\n        if (_f !== undefined) {\n            f = _f;\n        }\n\n        this.setOutputData(0, v1 * (1 - f) + v2 * f);\n    };\n\n    MathLerp.prototype.onGetInputs = function() {\n        return [[\"f\", \"number\"]];\n    };\n\n    LiteGraph.registerNodeType(\"math/lerp\", MathLerp);\n\n    //Math ABS\n    function MathAbs() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.size = [80, 30];\n    }\n\n    MathAbs.title = \"Abs\";\n    MathAbs.desc = \"Absolute\";\n\n    MathAbs.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n        this.setOutputData(0, Math.abs(v));\n    };\n\n    LiteGraph.registerNodeType(\"math/abs\", MathAbs);\n\n    //Math Floor\n    function MathFloor() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.size = [80, 30];\n    }\n\n    MathFloor.title = \"Floor\";\n    MathFloor.desc = \"Floor number to remove fractional part\";\n\n    MathFloor.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n        this.setOutputData(0, Math.floor(v));\n    };\n\n    LiteGraph.registerNodeType(\"math/floor\", MathFloor);\n\n    //Math frac\n    function MathFrac() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.size = [80, 30];\n    }\n\n    MathFrac.title = \"Frac\";\n    MathFrac.desc = \"Returns fractional part\";\n\n    MathFrac.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n        this.setOutputData(0, v % 1);\n    };\n\n    LiteGraph.registerNodeType(\"math/frac\", MathFrac);\n\n    //Math Floor\n    function MathSmoothStep() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.size = [80, 30];\n        this.properties = { A: 0, B: 1 };\n    }\n\n    MathSmoothStep.title = \"Smoothstep\";\n    MathSmoothStep.desc = \"Smoothstep\";\n\n    MathSmoothStep.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v === undefined) {\n            return;\n        }\n\n        var edge0 = this.properties.A;\n        var edge1 = this.properties.B;\n\n        // Scale, bias and saturate x to 0..1 range\n        v = clamp((v - edge0) / (edge1 - edge0), 0.0, 1.0);\n        // Evaluate polynomial\n        v = v * v * (3 - 2 * v);\n\n        this.setOutputData(0, v);\n    };\n\n    LiteGraph.registerNodeType(\"math/smoothstep\", MathSmoothStep);\n\n    //Math scale\n    function MathScale() {\n        this.addInput(\"in\", \"number\", { label: \"\" });\n        this.addOutput(\"out\", \"number\", { label: \"\" });\n        this.size = [80, 30];\n        this.addProperty(\"factor\", 1);\n    }\n\n    MathScale.title = \"Scale\";\n    MathScale.desc = \"v * factor\";\n\n    MathScale.prototype.onExecute = function() {\n        var value = this.getInputData(0);\n        if (value != null) {\n            this.setOutputData(0, value * this.properties.factor);\n        }\n    };\n\n    LiteGraph.registerNodeType(\"math/scale\", MathScale);\n\n\t//Gate\n\tfunction Gate() {\n\t\tthis.addInput(\"v\",\"boolean\");\n\t\tthis.addInput(\"A\");\n\t\tthis.addInput(\"B\");\n\t\tthis.addOutput(\"out\");\n\t}\n\n\tGate.title = \"Gate\";\n\tGate.desc = \"if v is true, then outputs A, otherwise B\";\n\n\tGate.prototype.onExecute = function() {\n\t\tvar v = this.getInputData(0);\n\t\tthis.setOutputData(0, this.getInputData( v ? 1 : 2 ));\n\t};\n\n\tLiteGraph.registerNodeType(\"math/gate\", Gate);\n\n\n    //Math Average\n    function MathAverageFilter() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.size = [80, 30];\n        this.addProperty(\"samples\", 10);\n        this._values = new Float32Array(10);\n        this._current = 0;\n    }\n\n    MathAverageFilter.title = \"Average\";\n    MathAverageFilter.desc = \"Average Filter\";\n\n    MathAverageFilter.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            v = 0;\n        }\n\n        var num_samples = this._values.length;\n\n        this._values[this._current % num_samples] = v;\n        this._current += 1;\n        if (this._current > num_samples) {\n            this._current = 0;\n        }\n\n        var avr = 0;\n        for (var i = 0; i < num_samples; ++i) {\n            avr += this._values[i];\n        }\n\n        this.setOutputData(0, avr / num_samples);\n    };\n\n    MathAverageFilter.prototype.onPropertyChanged = function(name, value) {\n        if (value < 1) {\n            value = 1;\n        }\n        this.properties.samples = Math.round(value);\n        var old = this._values;\n\n        this._values = new Float32Array(this.properties.samples);\n        if (old.length <= this._values.length) {\n            this._values.set(old);\n        } else {\n            this._values.set(old.subarray(0, this._values.length));\n        }\n    };\n\n    LiteGraph.registerNodeType(\"math/average\", MathAverageFilter);\n\n    //Math\n    function MathTendTo() {\n        this.addInput(\"in\", \"number\");\n        this.addOutput(\"out\", \"number\");\n        this.addProperty(\"factor\", 0.1);\n        this.size = [80, 30];\n        this._value = null;\n    }\n\n    MathTendTo.title = \"TendTo\";\n    MathTendTo.desc = \"moves the output value always closer to the input\";\n\n    MathTendTo.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            v = 0;\n        }\n        var f = this.properties.factor;\n        if (this._value == null) {\n            this._value = v;\n        } else {\n            this._value = this._value * (1 - f) + v * f;\n        }\n        this.setOutputData(0, this._value);\n    };\n\n    LiteGraph.registerNodeType(\"math/tendTo\", MathTendTo);\n\n    //Math operation\n    function MathOperation() {\n        this.addInput(\"A\", \"number,array,object\");\n        this.addInput(\"B\", \"number\");\n        this.addOutput(\"=\", \"number\");\n        this.addProperty(\"A\", 1);\n        this.addProperty(\"B\", 1);\n        this.addProperty(\"OP\", \"+\", \"enum\", { values: MathOperation.values });\n\t\tthis._func = MathOperation.funcs[this.properties.OP];\n\t\tthis._result = []; //only used for arrays\n    }\n\n    MathOperation.values = [\"+\", \"-\", \"*\", \"/\", \"%\", \"^\", \"max\", \"min\"];\n    MathOperation.funcs = {\n        \"+\": function(A,B) { return A + B; },\n        \"-\": function(A,B) { return A - B; },\n        \"x\": function(A,B) { return A * B; },\n        \"X\": function(A,B) { return A * B; },\n        \"*\": function(A,B) { return A * B; },\n        \"/\": function(A,B) { return A / B; },\n        \"%\": function(A,B) { return A % B; },\n        \"^\": function(A,B) { return Math.pow(A, B); },\n        \"max\": function(A,B) { return Math.max(A, B); },\n        \"min\": function(A,B) { return Math.min(A, B); }\n    };\n\n\tMathOperation.title = \"Operation\";\n    MathOperation.desc = \"Easy math operators\";\n    MathOperation[\"@OP\"] = {\n        type: \"enum\",\n        title: \"operation\",\n        values: MathOperation.values\n    };\n    MathOperation.size = [100, 60];\n\n    MathOperation.prototype.getTitle = function() {\n\t\tif(this.properties.OP == \"max\" || this.properties.OP == \"min\")\n\t\t\treturn this.properties.OP + \"(A,B)\";\n        return \"A \" + this.properties.OP + \" B\";\n    };\n\n    MathOperation.prototype.setValue = function(v) {\n        if (typeof v == \"string\") {\n            v = parseFloat(v);\n        }\n        this.properties[\"value\"] = v;\n    };\n\n    MathOperation.prototype.onPropertyChanged = function(name, value)\n\t{\n\t\tif (name != \"OP\")\n\t\t\treturn;\n        this._func = MathOperation.funcs[this.properties.OP];\n        if(!this._func)\n        {\n            console.warn(\"Unknown operation: \" + this.properties.OP);\n            this._func = function(A) { return A; };\n        }\n\t}\n\n    MathOperation.prototype.onExecute = function() {\n        var A = this.getInputData(0);\n        var B = this.getInputData(1);\n        if ( A != null ) {\n\t\t\tif( A.constructor === Number )\n\t            this.properties[\"A\"] = A;\n        } else {\n            A = this.properties[\"A\"];\n        }\n\n        if (B != null) {\n            this.properties[\"B\"] = B;\n        } else {\n            B = this.properties[\"B\"];\n        }\n\n        var func = MathOperation.funcs[this.properties.OP];\n\n\t\tvar result;\n\t\tif(A.constructor === Number)\n\t\t{\n\t        result = 0;\n\t\t\tresult = func(A,B);\n\t\t}\n\t\telse if(A.constructor === Array)\n\t\t{\n\t\t\tresult = this._result;\n\t\t\tresult.length = A.length;\n\t\t\tfor(var i = 0; i < A.length; ++i)\n\t\t\t\tresult[i] = func(A[i],B);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\t\t\tfor(var i in A)\n\t\t\t\tresult[i] = func(A[i],B);\n\t\t}\n\t    this.setOutputData(0, result);\n    };\n\n    MathOperation.prototype.onDrawBackground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n\n        ctx.font = \"40px Arial\";\n        ctx.fillStyle = \"#666\";\n        ctx.textAlign = \"center\";\n        ctx.fillText(\n            this.properties.OP,\n            this.size[0] * 0.5,\n            (this.size[1] + LiteGraph.NODE_TITLE_HEIGHT) * 0.5\n        );\n        ctx.textAlign = \"left\";\n    };\n\n    LiteGraph.registerNodeType(\"math/operation\", MathOperation);\n\n    LiteGraph.registerSearchboxExtra(\"math/operation\", \"MAX\", {\n        properties: {OP:\"max\"},\n        title: \"MAX()\"\n    });\n\n    LiteGraph.registerSearchboxExtra(\"math/operation\", \"MIN\", {\n        properties: {OP:\"min\"},\n        title: \"MIN()\"\n    });\n\n\n    //Math compare\n    function MathCompare() {\n        this.addInput(\"A\", \"number\");\n        this.addInput(\"B\", \"number\");\n        this.addOutput(\"A==B\", \"boolean\");\n        this.addOutput(\"A!=B\", \"boolean\");\n        this.addProperty(\"A\", 0);\n        this.addProperty(\"B\", 0);\n    }\n\n    MathCompare.title = \"Compare\";\n    MathCompare.desc = \"compares between two values\";\n\n    MathCompare.prototype.onExecute = function() {\n        var A = this.getInputData(0);\n        var B = this.getInputData(1);\n        if (A !== undefined) {\n            this.properties[\"A\"] = A;\n        } else {\n            A = this.properties[\"A\"];\n        }\n\n        if (B !== undefined) {\n            this.properties[\"B\"] = B;\n        } else {\n            B = this.properties[\"B\"];\n        }\n\n        for (var i = 0, l = this.outputs.length; i < l; ++i) {\n            var output = this.outputs[i];\n            if (!output.links || !output.links.length) {\n                continue;\n            }\n            var value;\n            switch (output.name) {\n                case \"A==B\":\n                    value = A == B;\n                    break;\n                case \"A!=B\":\n                    value = A != B;\n                    break;\n                case \"A>B\":\n                    value = A > B;\n                    break;\n                case \"A<B\":\n                    value = A < B;\n                    break;\n                case \"A<=B\":\n                    value = A <= B;\n                    break;\n                case \"A>=B\":\n                    value = A >= B;\n                    break;\n            }\n            this.setOutputData(i, value);\n        }\n    };\n\n    MathCompare.prototype.onGetOutputs = function() {\n        return [\n            [\"A==B\", \"boolean\"],\n            [\"A!=B\", \"boolean\"],\n            [\"A>B\", \"boolean\"],\n            [\"A<B\", \"boolean\"],\n            [\"A>=B\", \"boolean\"],\n            [\"A<=B\", \"boolean\"]\n        ];\n    };\n\n    LiteGraph.registerNodeType(\"math/compare\", MathCompare);\n\n    LiteGraph.registerSearchboxExtra(\"math/compare\", \"==\", {\n        outputs: [[\"A==B\", \"boolean\"]],\n        title: \"A==B\"\n    });\n    LiteGraph.registerSearchboxExtra(\"math/compare\", \"!=\", {\n        outputs: [[\"A!=B\", \"boolean\"]],\n        title: \"A!=B\"\n    });\n    LiteGraph.registerSearchboxExtra(\"math/compare\", \">\", {\n        outputs: [[\"A>B\", \"boolean\"]],\n        title: \"A>B\"\n    });\n    LiteGraph.registerSearchboxExtra(\"math/compare\", \"<\", {\n        outputs: [[\"A<B\", \"boolean\"]],\n        title: \"A<B\"\n    });\n    LiteGraph.registerSearchboxExtra(\"math/compare\", \">=\", {\n        outputs: [[\"A>=B\", \"boolean\"]],\n        title: \"A>=B\"\n    });\n    LiteGraph.registerSearchboxExtra(\"math/compare\", \"<=\", {\n        outputs: [[\"A<=B\", \"boolean\"]],\n        title: \"A<=B\"\n    });\n\n    function MathCondition() {\n        this.addInput(\"A\", \"number\");\n        this.addInput(\"B\", \"number\");\n        this.addOutput(\"true\", \"boolean\");\n        this.addOutput(\"false\", \"boolean\");\n        this.addProperty(\"A\", 1);\n        this.addProperty(\"B\", 1);\n        this.addProperty(\"OP\", \">\", \"enum\", { values: MathCondition.values });\n\t\tthis.addWidget(\"combo\",\"Cond.\",this.properties.OP,{ property: \"OP\", values: MathCondition.values } );\n\n        this.size = [80, 60];\n    }\n\n    MathCondition.values = [\">\", \"<\", \"==\", \"!=\", \"<=\", \">=\", \"||\", \"&&\" ];\n    MathCondition[\"@OP\"] = {\n        type: \"enum\",\n        title: \"operation\",\n        values: MathCondition.values\n    };\n\n    MathCondition.title = \"Condition\";\n    MathCondition.desc = \"evaluates condition between A and B\";\n\n    MathCondition.prototype.getTitle = function() {\n        return \"A \" + this.properties.OP + \" B\";\n    };\n\n    MathCondition.prototype.onExecute = function() {\n        var A = this.getInputData(0);\n        if (A === undefined) {\n            A = this.properties.A;\n        } else {\n            this.properties.A = A;\n        }\n\n        var B = this.getInputData(1);\n        if (B === undefined) {\n            B = this.properties.B;\n        } else {\n            this.properties.B = B;\n        }\n\n        var result = true;\n        switch (this.properties.OP) {\n            case \">\":\n                result = A > B;\n                break;\n            case \"<\":\n                result = A < B;\n                break;\n            case \"==\":\n                result = A == B;\n                break;\n            case \"!=\":\n                result = A != B;\n                break;\n            case \"<=\":\n                result = A <= B;\n                break;\n            case \">=\":\n                result = A >= B;\n                break;\n            case \"||\":\n                result = A || B;\n                break;\n            case \"&&\":\n                result = A && B;\n                break;\n        }\n\n        this.setOutputData(0, result);\n        this.setOutputData(1, !result);\n    };\n\n    LiteGraph.registerNodeType(\"math/condition\", MathCondition);\n\n\n    function MathBranch() {\n        this.addInput(\"in\", 0);\n        this.addInput(\"cond\", \"boolean\");\n        this.addOutput(\"true\", 0);\n        this.addOutput(\"false\", 0);\n        this.size = [80, 60];\n    }\n\n    MathBranch.title = \"Branch\";\n    MathBranch.desc = \"If condition is true, outputs IN in true, otherwise in false\";\n\n    MathBranch.prototype.onExecute = function() {\n        var V = this.getInputData(0);\n        var cond = this.getInputData(1);\n\n\t\tif(cond)\n\t\t{\n\t\t\tthis.setOutputData(0, V);\n\t\t\tthis.setOutputData(1, null);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setOutputData(0, null);\n\t\t\tthis.setOutputData(1, V);\n\t\t}\n\t}\n\n    LiteGraph.registerNodeType(\"math/branch\", MathBranch);\n\n\n    function MathAccumulate() {\n        this.addInput(\"inc\", \"number\");\n        this.addOutput(\"total\", \"number\");\n        this.addProperty(\"increment\", 1);\n        this.addProperty(\"value\", 0);\n    }\n\n    MathAccumulate.title = \"Accumulate\";\n    MathAccumulate.desc = \"Increments a value every time\";\n\n    MathAccumulate.prototype.onExecute = function() {\n        if (this.properties.value === null) {\n            this.properties.value = 0;\n        }\n\n        var inc = this.getInputData(0);\n        if (inc !== null) {\n            this.properties.value += inc;\n        } else {\n            this.properties.value += this.properties.increment;\n        }\n        this.setOutputData(0, this.properties.value);\n    };\n\n    LiteGraph.registerNodeType(\"math/accumulate\", MathAccumulate);\n\n    //Math Trigonometry\n    function MathTrigonometry() {\n        this.addInput(\"v\", \"number\");\n        this.addOutput(\"sin\", \"number\");\n\n        this.addProperty(\"amplitude\", 1);\n        this.addProperty(\"offset\", 0);\n        this.bgImageUrl = \"nodes/imgs/icon-sin.png\";\n    }\n\n    MathTrigonometry.title = \"Trigonometry\";\n    MathTrigonometry.desc = \"Sin Cos Tan\";\n    //MathTrigonometry.filter = \"shader\";\n\n    MathTrigonometry.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            v = 0;\n        }\n        var amplitude = this.properties[\"amplitude\"];\n        var slot = this.findInputSlot(\"amplitude\");\n        if (slot != -1) {\n            amplitude = this.getInputData(slot);\n        }\n        var offset = this.properties[\"offset\"];\n        slot = this.findInputSlot(\"offset\");\n        if (slot != -1) {\n            offset = this.getInputData(slot);\n        }\n\n        for (var i = 0, l = this.outputs.length; i < l; ++i) {\n            var output = this.outputs[i];\n            var value;\n            switch (output.name) {\n                case \"sin\":\n                    value = Math.sin(v);\n                    break;\n                case \"cos\":\n                    value = Math.cos(v);\n                    break;\n                case \"tan\":\n                    value = Math.tan(v);\n                    break;\n                case \"asin\":\n                    value = Math.asin(v);\n                    break;\n                case \"acos\":\n                    value = Math.acos(v);\n                    break;\n                case \"atan\":\n                    value = Math.atan(v);\n                    break;\n            }\n            this.setOutputData(i, amplitude * value + offset);\n        }\n    };\n\n    MathTrigonometry.prototype.onGetInputs = function() {\n        return [[\"v\", \"number\"], [\"amplitude\", \"number\"], [\"offset\", \"number\"]];\n    };\n\n    MathTrigonometry.prototype.onGetOutputs = function() {\n        return [\n            [\"sin\", \"number\"],\n            [\"cos\", \"number\"],\n            [\"tan\", \"number\"],\n            [\"asin\", \"number\"],\n            [\"acos\", \"number\"],\n            [\"atan\", \"number\"]\n        ];\n    };\n\n    LiteGraph.registerNodeType(\"math/trigonometry\", MathTrigonometry);\n\n    LiteGraph.registerSearchboxExtra(\"math/trigonometry\", \"SIN()\", {\n        outputs: [[\"sin\", \"number\"]],\n        title: \"SIN()\"\n    });\n    LiteGraph.registerSearchboxExtra(\"math/trigonometry\", \"COS()\", {\n        outputs: [[\"cos\", \"number\"]],\n        title: \"COS()\"\n    });\n    LiteGraph.registerSearchboxExtra(\"math/trigonometry\", \"TAN()\", {\n        outputs: [[\"tan\", \"number\"]],\n        title: \"TAN()\"\n    });\n\n    //math library for safe math operations without eval\n    function MathFormula() {\n        this.addInput(\"x\", \"number\");\n        this.addInput(\"y\", \"number\");\n        this.addOutput(\"\", \"number\");\n        this.properties = { x: 1.0, y: 1.0, formula: \"x+y\" };\n        this.code_widget = this.addWidget(\n            \"text\",\n            \"F(x,y)\",\n            this.properties.formula,\n            function(v, canvas, node) {\n                node.properties.formula = v;\n            }\n        );\n        this.addWidget(\"toggle\", \"allow\", LiteGraph.allow_scripts, function(v) {\n            LiteGraph.allow_scripts = v;\n        });\n        this._func = null;\n    }\n\n    MathFormula.title = \"Formula\";\n    MathFormula.desc = \"Compute formula\";\n    MathFormula.size = [160, 100];\n\n    MathAverageFilter.prototype.onPropertyChanged = function(name, value) {\n        if (name == \"formula\") {\n            this.code_widget.value = value;\n        }\n    };\n\n    MathFormula.prototype.onExecute = function() {\n        if (!LiteGraph.allow_scripts) {\n            return;\n        }\n\n        var x = this.getInputData(0);\n        var y = this.getInputData(1);\n        if (x != null) {\n            this.properties[\"x\"] = x;\n        } else {\n            x = this.properties[\"x\"];\n        }\n\n        if (y != null) {\n            this.properties[\"y\"] = y;\n        } else {\n            y = this.properties[\"y\"];\n        }\n\n        var f = this.properties[\"formula\"];\n\n        var value;\n        try {\n            if (!this._func || this._func_code != this.properties.formula) {\n                this._func = new Function(\n                    \"x\",\n                    \"y\",\n                    \"TIME\",\n                    \"return \" + this.properties.formula\n                );\n                this._func_code = this.properties.formula;\n            }\n            value = this._func(x, y, this.graph.globaltime);\n            this.boxcolor = null;\n        } catch (err) {\n            this.boxcolor = \"red\";\n        }\n        this.setOutputData(0, value);\n    };\n\n    MathFormula.prototype.getTitle = function() {\n        return this._func_code || \"Formula\";\n    };\n\n    MathFormula.prototype.onDrawBackground = function() {\n        var f = this.properties[\"formula\"];\n        if (this.outputs && this.outputs.length) {\n            this.outputs[0].label = f;\n        }\n    };\n\n    LiteGraph.registerNodeType(\"math/formula\", MathFormula);\n\n    function Math3DVec2ToXY() {\n        this.addInput(\"vec2\", \"vec2\");\n        this.addOutput(\"x\", \"number\");\n        this.addOutput(\"y\", \"number\");\n    }\n\n    Math3DVec2ToXY.title = \"Vec2->XY\";\n    Math3DVec2ToXY.desc = \"vector 2 to components\";\n\n    Math3DVec2ToXY.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n\n        this.setOutputData(0, v[0]);\n        this.setOutputData(1, v[1]);\n    };\n\n    LiteGraph.registerNodeType(\"math3d/vec2-to-xy\", Math3DVec2ToXY);\n\n    function Math3DXYToVec2() {\n        this.addInputs([[\"x\", \"number\"], [\"y\", \"number\"]]);\n        this.addOutput(\"vec2\", \"vec2\");\n        this.properties = { x: 0, y: 0 };\n        this._data = new Float32Array(2);\n    }\n\n    Math3DXYToVec2.title = \"XY->Vec2\";\n    Math3DXYToVec2.desc = \"components to vector2\";\n\n    Math3DXYToVec2.prototype.onExecute = function() {\n        var x = this.getInputData(0);\n        if (x == null) {\n            x = this.properties.x;\n        }\n        var y = this.getInputData(1);\n        if (y == null) {\n            y = this.properties.y;\n        }\n\n        var data = this._data;\n        data[0] = x;\n        data[1] = y;\n\n        this.setOutputData(0, data);\n    };\n\n    LiteGraph.registerNodeType(\"math3d/xy-to-vec2\", Math3DXYToVec2);\n\n    function Math3DVec3ToXYZ() {\n        this.addInput(\"vec3\", \"vec3\");\n        this.addOutput(\"x\", \"number\");\n        this.addOutput(\"y\", \"number\");\n        this.addOutput(\"z\", \"number\");\n    }\n\n    Math3DVec3ToXYZ.title = \"Vec3->XYZ\";\n    Math3DVec3ToXYZ.desc = \"vector 3 to components\";\n\n    Math3DVec3ToXYZ.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n\n        this.setOutputData(0, v[0]);\n        this.setOutputData(1, v[1]);\n        this.setOutputData(2, v[2]);\n    };\n\n    LiteGraph.registerNodeType(\"math3d/vec3-to-xyz\", Math3DVec3ToXYZ);\n\n    function Math3DXYZToVec3() {\n        this.addInputs([[\"x\", \"number\"], [\"y\", \"number\"], [\"z\", \"number\"]]);\n        this.addOutput(\"vec3\", \"vec3\");\n        this.properties = { x: 0, y: 0, z: 0 };\n        this._data = new Float32Array(3);\n    }\n\n    Math3DXYZToVec3.title = \"XYZ->Vec3\";\n    Math3DXYZToVec3.desc = \"components to vector3\";\n\n    Math3DXYZToVec3.prototype.onExecute = function() {\n        var x = this.getInputData(0);\n        if (x == null) {\n            x = this.properties.x;\n        }\n        var y = this.getInputData(1);\n        if (y == null) {\n            y = this.properties.y;\n        }\n        var z = this.getInputData(2);\n        if (z == null) {\n            z = this.properties.z;\n        }\n\n        var data = this._data;\n        data[0] = x;\n        data[1] = y;\n        data[2] = z;\n\n        this.setOutputData(0, data);\n    };\n\n    LiteGraph.registerNodeType(\"math3d/xyz-to-vec3\", Math3DXYZToVec3);\n\n    function Math3DVec4ToXYZW() {\n        this.addInput(\"vec4\", \"vec4\");\n        this.addOutput(\"x\", \"number\");\n        this.addOutput(\"y\", \"number\");\n        this.addOutput(\"z\", \"number\");\n        this.addOutput(\"w\", \"number\");\n    }\n\n    Math3DVec4ToXYZW.title = \"Vec4->XYZW\";\n    Math3DVec4ToXYZW.desc = \"vector 4 to components\";\n\n    Math3DVec4ToXYZW.prototype.onExecute = function() {\n        var v = this.getInputData(0);\n        if (v == null) {\n            return;\n        }\n\n        this.setOutputData(0, v[0]);\n        this.setOutputData(1, v[1]);\n        this.setOutputData(2, v[2]);\n        this.setOutputData(3, v[3]);\n    };\n\n    LiteGraph.registerNodeType(\"math3d/vec4-to-xyzw\", Math3DVec4ToXYZW);\n\n    function Math3DXYZWToVec4() {\n        this.addInputs([\n            [\"x\", \"number\"],\n            [\"y\", \"number\"],\n            [\"z\", \"number\"],\n            [\"w\", \"number\"]\n        ]);\n        this.addOutput(\"vec4\", \"vec4\");\n        this.properties = { x: 0, y: 0, z: 0, w: 0 };\n        this._data = new Float32Array(4);\n    }\n\n    Math3DXYZWToVec4.title = \"XYZW->Vec4\";\n    Math3DXYZWToVec4.desc = \"components to vector4\";\n\n    Math3DXYZWToVec4.prototype.onExecute = function() {\n        var x = this.getInputData(0);\n        if (x == null) {\n            x = this.properties.x;\n        }\n        var y = this.getInputData(1);\n        if (y == null) {\n            y = this.properties.y;\n        }\n        var z = this.getInputData(2);\n        if (z == null) {\n            z = this.properties.z;\n        }\n        var w = this.getInputData(3);\n        if (w == null) {\n            w = this.properties.w;\n        }\n\n        var data = this._data;\n        data[0] = x;\n        data[1] = y;\n        data[2] = z;\n        data[3] = w;\n\n        this.setOutputData(0, data);\n    };\n\n    LiteGraph.registerNodeType(\"math3d/xyzw-to-vec4\", Math3DXYZWToVec4);\n\n})(this);\n\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n\r\n\tfunction Math3DMat4()\r\n\t{\r\n        this.addInput(\"T\", \"vec3\");\r\n        this.addInput(\"R\", \"vec3\");\r\n        this.addInput(\"S\", \"vec3\");\r\n        this.addOutput(\"mat4\", \"mat4\");\r\n\t\tthis.properties = {\r\n\t\t\t\"T\":[0,0,0],\r\n\t\t\t\"R\":[0,0,0],\r\n\t\t\t\"S\":[1,1,1],\r\n\t\t\tR_in_degrees: true\r\n\t\t};\r\n\t\tthis._result = mat4.create();\r\n\t\tthis._must_update = true;\r\n\t}\r\n\r\n\tMath3DMat4.title = \"mat4\";\r\n\tMath3DMat4.temp_quat = new Float32Array([0,0,0,1]);\r\n\tMath3DMat4.temp_mat4 = new Float32Array(16);\r\n\tMath3DMat4.temp_vec3 = new Float32Array(3);\r\n\r\n\tMath3DMat4.prototype.onPropertyChanged = function(name, value)\r\n\t{\r\n\t\tthis._must_update = true;\r\n\t}\r\n\r\n\tMath3DMat4.prototype.onExecute = function()\r\n\t{\r\n\t\tvar M = this._result;\r\n\t\tvar Q = Math3DMat4.temp_quat;\r\n\t\tvar temp_mat4 = Math3DMat4.temp_mat4;\r\n\t\tvar temp_vec3 = Math3DMat4.temp_vec3;\r\n\r\n\t\tvar T = this.getInputData(0);\r\n\t\tvar R = this.getInputData(1);\r\n\t\tvar S = this.getInputData(2);\r\n\r\n\t\tif( this._must_update || T || R || S )\r\n\t\t{\r\n\t\t\tT = T || this.properties.T;\r\n\t\t\tR = R || this.properties.R;\r\n\t\t\tS = S || this.properties.S;\r\n\t\t\tmat4.identity( M );\r\n\t\t\tmat4.translate( M, M, T );\r\n\t\t\tif(this.properties.R_in_degrees)\r\n\t\t\t{\r\n\t\t\t\ttemp_vec3.set( R );\r\n\t\t\t\tvec3.scale(temp_vec3,temp_vec3,DEG2RAD);\r\n\t\t\t\tquat.fromEuler( Q, temp_vec3 );\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tquat.fromEuler( Q, R );\r\n\t\t\tmat4.fromQuat( temp_mat4, Q );\r\n\t\t\tmat4.multiply( M, M, temp_mat4 );\r\n\t\t\tmat4.scale( M, M, S );\r\n\t\t}\r\n\r\n\t\tthis.setOutputData(0, M);\t\t\r\n\t}\r\n\r\n    LiteGraph.registerNodeType(\"math3d/mat4\", Math3DMat4);\r\n\r\n    //Math 3D operation\r\n    function Math3DOperation() {\r\n        this.addInput(\"A\", \"number,vec3\");\r\n        this.addInput(\"B\", \"number,vec3\");\r\n        this.addOutput(\"=\", \"number,vec3\");\r\n        this.addProperty(\"OP\", \"+\", \"enum\", { values: Math3DOperation.values });\r\n\t\tthis._result = vec3.create();\r\n    }\r\n\r\n    Math3DOperation.values = [\"+\", \"-\", \"*\", \"/\", \"%\", \"^\", \"max\", \"min\",\"dot\",\"cross\"];\r\n\r\n    LiteGraph.registerSearchboxExtra(\"math3d/operation\", \"CROSS()\", {\r\n        properties: {\"OP\":\"cross\"},\r\n        title: \"CROSS()\"\r\n    });\r\n\r\n    LiteGraph.registerSearchboxExtra(\"math3d/operation\", \"DOT()\", {\r\n        properties: {\"OP\":\"dot\"},\r\n        title: \"DOT()\"\r\n    });\r\n\r\n\tMath3DOperation.title = \"Operation\";\r\n    Math3DOperation.desc = \"Easy math 3D operators\";\r\n    Math3DOperation[\"@OP\"] = {\r\n        type: \"enum\",\r\n        title: \"operation\",\r\n        values: Math3DOperation.values\r\n    };\r\n    Math3DOperation.size = [100, 60];\r\n\r\n    Math3DOperation.prototype.getTitle = function() {\r\n\t\tif(this.properties.OP == \"max\" || this.properties.OP == \"min\" )\r\n\t\t\treturn this.properties.OP + \"(A,B)\";\r\n        return \"A \" + this.properties.OP + \" B\";\r\n    };\r\n\r\n    Math3DOperation.prototype.onExecute = function() {\r\n        var A = this.getInputData(0);\r\n        var B = this.getInputData(1);\r\n\t\tif(A == null || B == null)\r\n\t\t\treturn;\r\n\t\tif(A.constructor === Number)\r\n\t\t\tA = [A,A,A];\r\n\t\tif(B.constructor === Number)\r\n\t\t\tB = [B,B,B];\r\n\r\n        var result = this._result;\r\n        switch (this.properties.OP) {\r\n            case \"+\":\r\n                result = vec3.add(result,A,B);\r\n                break;\r\n            case \"-\":\r\n                result = vec3.sub(result,A,B);\r\n                break;\r\n            case \"x\":\r\n            case \"X\":\r\n            case \"*\":\r\n                result = vec3.mul(result,A,B);\r\n                break;\r\n            case \"/\":\r\n                result = vec3.div(result,A,B);\r\n                break;\r\n            case \"%\":\r\n                result[0] = A[0]%B[0];\r\n                result[1] = A[1]%B[1];\r\n                result[2] = A[2]%B[2];\r\n                break;\r\n            case \"^\":\r\n                result[0] = Math.pow(A[0],B[0]);\r\n                result[1] = Math.pow(A[1],B[1]);\r\n                result[2] = Math.pow(A[2],B[2]);\r\n                break;\r\n            case \"max\":\r\n                result[0] = Math.max(A[0],B[0]);\r\n                result[1] = Math.max(A[1],B[1]);\r\n                result[2] = Math.max(A[2],B[2]);\r\n                break;\r\n            case \"min\":\r\n                result[0] = Math.min(A[0],B[0]);\r\n                result[1] = Math.min(A[1],B[1]);\r\n                result[2] = Math.min(A[2],B[2]);\r\n            case \"dot\":\r\n                result = vec3.dot(A,B);\r\n                break;\r\n            case \"cross\":\r\n                vec3.cross(result,A,B);\r\n                break;\r\n            default:\r\n                console.warn(\"Unknown operation: \" + this.properties.OP);\r\n        }\r\n        this.setOutputData(0, result);\r\n    };\r\n\r\n    Math3DOperation.prototype.onDrawBackground = function(ctx) {\r\n        if (this.flags.collapsed) {\r\n            return;\r\n        }\r\n\r\n        ctx.font = \"40px Arial\";\r\n        ctx.fillStyle = \"#666\";\r\n        ctx.textAlign = \"center\";\r\n        ctx.fillText(\r\n            this.properties.OP,\r\n            this.size[0] * 0.5,\r\n            (this.size[1] + LiteGraph.NODE_TITLE_HEIGHT) * 0.5\r\n        );\r\n        ctx.textAlign = \"left\";\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"math3d/operation\", Math3DOperation);\r\n\r\n    function Math3DVec3Scale() {\r\n        this.addInput(\"in\", \"vec3\");\r\n        this.addInput(\"f\", \"number\");\r\n        this.addOutput(\"out\", \"vec3\");\r\n        this.properties = { f: 1 };\r\n        this._data = new Float32Array(3);\r\n    }\r\n\r\n    Math3DVec3Scale.title = \"vec3_scale\";\r\n    Math3DVec3Scale.desc = \"scales the components of a vec3\";\r\n\r\n    Math3DVec3Scale.prototype.onExecute = function() {\r\n        var v = this.getInputData(0);\r\n        if (v == null) {\r\n            return;\r\n        }\r\n        var f = this.getInputData(1);\r\n        if (f == null) {\r\n            f = this.properties.f;\r\n        }\r\n\r\n        var data = this._data;\r\n        data[0] = v[0] * f;\r\n        data[1] = v[1] * f;\r\n        data[2] = v[2] * f;\r\n        this.setOutputData(0, data);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"math3d/vec3-scale\", Math3DVec3Scale);\r\n\r\n    function Math3DVec3Length() {\r\n        this.addInput(\"in\", \"vec3\");\r\n        this.addOutput(\"out\", \"number\");\r\n    }\r\n\r\n    Math3DVec3Length.title = \"vec3_length\";\r\n    Math3DVec3Length.desc = \"returns the module of a vector\";\r\n\r\n    Math3DVec3Length.prototype.onExecute = function() {\r\n        var v = this.getInputData(0);\r\n        if (v == null) {\r\n            return;\r\n        }\r\n        var dist = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\r\n        this.setOutputData(0, dist);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"math3d/vec3-length\", Math3DVec3Length);\r\n\r\n    function Math3DVec3Normalize() {\r\n        this.addInput(\"in\", \"vec3\");\r\n        this.addOutput(\"out\", \"vec3\");\r\n        this._data = new Float32Array(3);\r\n    }\r\n\r\n    Math3DVec3Normalize.title = \"vec3_normalize\";\r\n    Math3DVec3Normalize.desc = \"returns the vector normalized\";\r\n\r\n    Math3DVec3Normalize.prototype.onExecute = function() {\r\n        var v = this.getInputData(0);\r\n        if (v == null) {\r\n            return;\r\n        }\r\n        var dist = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\r\n        var data = this._data;\r\n        data[0] = v[0] / dist;\r\n        data[1] = v[1] / dist;\r\n        data[2] = v[2] / dist;\r\n\r\n        this.setOutputData(0, data);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"math3d/vec3-normalize\", Math3DVec3Normalize);\r\n\r\n    function Math3DVec3Lerp() {\r\n        this.addInput(\"A\", \"vec3\");\r\n        this.addInput(\"B\", \"vec3\");\r\n        this.addInput(\"f\", \"vec3\");\r\n        this.addOutput(\"out\", \"vec3\");\r\n        this.properties = { f: 0.5 };\r\n        this._data = new Float32Array(3);\r\n    }\r\n\r\n    Math3DVec3Lerp.title = \"vec3_lerp\";\r\n    Math3DVec3Lerp.desc = \"returns the interpolated vector\";\r\n\r\n    Math3DVec3Lerp.prototype.onExecute = function() {\r\n        var A = this.getInputData(0);\r\n        if (A == null) {\r\n            return;\r\n        }\r\n        var B = this.getInputData(1);\r\n        if (B == null) {\r\n            return;\r\n        }\r\n        var f = this.getInputOrProperty(\"f\");\r\n\r\n        var data = this._data;\r\n        data[0] = A[0] * (1 - f) + B[0] * f;\r\n        data[1] = A[1] * (1 - f) + B[1] * f;\r\n        data[2] = A[2] * (1 - f) + B[2] * f;\r\n\r\n        this.setOutputData(0, data);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"math3d/vec3-lerp\", Math3DVec3Lerp);\r\n\r\n    function Math3DVec3Dot() {\r\n        this.addInput(\"A\", \"vec3\");\r\n        this.addInput(\"B\", \"vec3\");\r\n        this.addOutput(\"out\", \"number\");\r\n    }\r\n\r\n    Math3DVec3Dot.title = \"vec3_dot\";\r\n    Math3DVec3Dot.desc = \"returns the dot product\";\r\n\r\n    Math3DVec3Dot.prototype.onExecute = function() {\r\n        var A = this.getInputData(0);\r\n        if (A == null) {\r\n            return;\r\n        }\r\n        var B = this.getInputData(1);\r\n        if (B == null) {\r\n            return;\r\n        }\r\n\r\n        var dot = A[0] * B[0] + A[1] * B[1] + A[2] * B[2];\r\n        this.setOutputData(0, dot);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"math3d/vec3-dot\", Math3DVec3Dot);\r\n\r\n    //if glMatrix is installed...\r\n    if (global.glMatrix) {\r\n        function Math3DQuaternion() {\r\n            this.addOutput(\"quat\", \"quat\");\r\n            this.properties = { x: 0, y: 0, z: 0, w: 1, normalize: false };\r\n            this._value = quat.create();\r\n        }\r\n\r\n        Math3DQuaternion.title = \"Quaternion\";\r\n        Math3DQuaternion.desc = \"quaternion\";\r\n\r\n        Math3DQuaternion.prototype.onExecute = function() {\r\n            this._value[0] = this.getInputOrProperty(\"x\");\r\n            this._value[1] = this.getInputOrProperty(\"y\");\r\n            this._value[2] = this.getInputOrProperty(\"z\");\r\n            this._value[3] = this.getInputOrProperty(\"w\");\r\n            if (this.properties.normalize) {\r\n                quat.normalize(this._value, this._value);\r\n            }\r\n            this.setOutputData(0, this._value);\r\n        };\r\n\r\n        Math3DQuaternion.prototype.onGetInputs = function() {\r\n            return [\r\n                [\"x\", \"number\"],\r\n                [\"y\", \"number\"],\r\n                [\"z\", \"number\"],\r\n                [\"w\", \"number\"]\r\n            ];\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/quaternion\", Math3DQuaternion);\r\n\r\n        function Math3DRotation() {\r\n            this.addInputs([[\"degrees\", \"number\"], [\"axis\", \"vec3\"]]);\r\n            this.addOutput(\"quat\", \"quat\");\r\n            this.properties = { angle: 90.0, axis: vec3.fromValues(0, 1, 0) };\r\n\r\n            this._value = quat.create();\r\n        }\r\n\r\n        Math3DRotation.title = \"Rotation\";\r\n        Math3DRotation.desc = \"quaternion rotation\";\r\n\r\n        Math3DRotation.prototype.onExecute = function() {\r\n            var angle = this.getInputData(0);\r\n            if (angle == null) {\r\n                angle = this.properties.angle;\r\n            }\r\n            var axis = this.getInputData(1);\r\n            if (axis == null) {\r\n                axis = this.properties.axis;\r\n            }\r\n\r\n            var R = quat.setAxisAngle(this._value, axis, angle * 0.0174532925);\r\n            this.setOutputData(0, R);\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/rotation\", Math3DRotation);\r\n\r\n\r\n        function MathEulerToQuat() {\r\n            this.addInput(\"euler\", \"vec3\");\r\n            this.addOutput(\"quat\", \"quat\");\r\n            this.properties = { euler:[0,0,0], use_yaw_pitch_roll: false };\r\n\t\t\tthis._degs = vec3.create();\r\n            this._value = quat.create();\r\n        }\r\n\r\n        MathEulerToQuat.title = \"Euler->Quat\";\r\n        MathEulerToQuat.desc = \"Converts euler angles (in degrees) to quaternion\";\r\n\r\n        MathEulerToQuat.prototype.onExecute = function() {\r\n            var euler = this.getInputData(0);\r\n            if (euler == null) {\r\n                euler = this.properties.euler;\r\n            }\r\n\t\t\tvec3.scale( this._degs, euler, DEG2RAD );\r\n\t\t\tif(this.properties.use_yaw_pitch_roll)\r\n\t\t\t\tthis._degs = [this._degs[2],this._degs[0],this._degs[1]];\r\n            var R = quat.fromEuler(this._value, this._degs);\r\n            this.setOutputData(0, R);\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/euler_to_quat\", MathEulerToQuat);\r\n\r\n        function MathQuatToEuler() {\r\n            this.addInput([\"quat\", \"quat\"]);\r\n            this.addOutput(\"euler\", \"vec3\");\r\n\t\t\tthis._value = vec3.create();\r\n        }\r\n\r\n        MathQuatToEuler.title = \"Euler->Quat\";\r\n        MathQuatToEuler.desc = \"Converts rotX,rotY,rotZ in degrees to quat\";\r\n\r\n        MathQuatToEuler.prototype.onExecute = function() {\r\n            var q = this.getInputData(0);\r\n\t\t\tif(!q)\r\n\t\t\t\treturn;\r\n            var R = quat.toEuler(this._value, q);\r\n\t\t\tvec3.scale( this._value, this._value, DEG2RAD );\r\n            this.setOutputData(0, this._value);\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/quat_to_euler\", MathQuatToEuler);\r\n\r\n\r\n        //Math3D rotate vec3\r\n        function Math3DRotateVec3() {\r\n            this.addInputs([[\"vec3\", \"vec3\"], [\"quat\", \"quat\"]]);\r\n            this.addOutput(\"result\", \"vec3\");\r\n            this.properties = { vec: [0, 0, 1] };\r\n        }\r\n\r\n        Math3DRotateVec3.title = \"Rot. Vec3\";\r\n        Math3DRotateVec3.desc = \"rotate a point\";\r\n\r\n        Math3DRotateVec3.prototype.onExecute = function() {\r\n            var vec = this.getInputData(0);\r\n            if (vec == null) {\r\n                vec = this.properties.vec;\r\n            }\r\n            var quat = this.getInputData(1);\r\n            if (quat == null) {\r\n                this.setOutputData(vec);\r\n            } else {\r\n                this.setOutputData(\r\n                    0,\r\n                    vec3.transformQuat(vec3.create(), vec, quat)\r\n                );\r\n            }\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/rotate_vec3\", Math3DRotateVec3);\r\n\r\n        function Math3DMultQuat() {\r\n            this.addInputs([[\"A\", \"quat\"], [\"B\", \"quat\"]]);\r\n            this.addOutput(\"A*B\", \"quat\");\r\n\r\n            this._value = quat.create();\r\n        }\r\n\r\n        Math3DMultQuat.title = \"Mult. Quat\";\r\n        Math3DMultQuat.desc = \"rotate quaternion\";\r\n\r\n        Math3DMultQuat.prototype.onExecute = function() {\r\n            var A = this.getInputData(0);\r\n            if (A == null) {\r\n                return;\r\n            }\r\n            var B = this.getInputData(1);\r\n            if (B == null) {\r\n                return;\r\n            }\r\n\r\n            var R = quat.multiply(this._value, A, B);\r\n            this.setOutputData(0, R);\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/mult-quat\", Math3DMultQuat);\r\n\r\n        function Math3DQuatSlerp() {\r\n            this.addInputs([\r\n                [\"A\", \"quat\"],\r\n                [\"B\", \"quat\"],\r\n                [\"factor\", \"number\"]\r\n            ]);\r\n            this.addOutput(\"slerp\", \"quat\");\r\n            this.addProperty(\"factor\", 0.5);\r\n\r\n            this._value = quat.create();\r\n        }\r\n\r\n        Math3DQuatSlerp.title = \"Quat Slerp\";\r\n        Math3DQuatSlerp.desc = \"quaternion spherical interpolation\";\r\n\r\n        Math3DQuatSlerp.prototype.onExecute = function() {\r\n            var A = this.getInputData(0);\r\n            if (A == null) {\r\n                return;\r\n            }\r\n            var B = this.getInputData(1);\r\n            if (B == null) {\r\n                return;\r\n            }\r\n            var factor = this.properties.factor;\r\n            if (this.getInputData(2) != null) {\r\n                factor = this.getInputData(2);\r\n            }\r\n\r\n            var R = quat.slerp(this._value, A, B, factor);\r\n            this.setOutputData(0, R);\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/quat-slerp\", Math3DQuatSlerp);\r\n\r\n\r\n        //Math3D rotate vec3\r\n        function Math3DRemapRange() {\r\n            this.addInput(\"vec3\", \"vec3\");\r\n            this.addOutput(\"remap\", \"vec3\");\r\n\t\t\tthis.addOutput(\"clamped\", \"vec3\");\r\n            this.properties = { clamp: true, range_min: [-1, -1, 0], range_max: [1, 1, 0], target_min: [-1,-1,0], target_max:[1,1,0] };\r\n\t\t\tthis._value = vec3.create();\r\n\t\t\tthis._clamped = vec3.create();\r\n        }\r\n\r\n        Math3DRemapRange.title = \"Remap Range\";\r\n        Math3DRemapRange.desc = \"remap a 3D range\";\r\n\r\n        Math3DRemapRange.prototype.onExecute = function() {\r\n            var vec = this.getInputData(0);\r\n\t\t\tif(vec)\r\n\t\t\t\tthis._value.set(vec);\r\n\t\t\tvar range_min = this.properties.range_min;\r\n\t\t\tvar range_max = this.properties.range_max;\r\n\t\t\tvar target_min = this.properties.target_min;\r\n\t\t\tvar target_max = this.properties.target_max;\r\n\r\n\t\t\t//swap to avoid errors\r\n\t\t\t/*\r\n\t\t\tif(range_min > range_max)\r\n\t\t\t{\r\n\t\t\t\trange_min = range_max;\r\n\t\t\t\trange_max = this.properties.range_min;\r\n\t\t\t}\r\n\r\n\t\t\tif(target_min > target_max)\r\n\t\t\t{\r\n\t\t\t\ttarget_min = target_max;\r\n\t\t\t\ttarget_max = this.properties.target_min;\r\n\t\t\t}\r\n\t\t\t*/\r\n\r\n\t\t\tfor(var i = 0; i < 3; ++i)\r\n\t\t\t{\r\n\t\t\t\tvar r = range_max[i] - range_min[i];\r\n\t\t\t\tthis._clamped[i] = clamp( this._value[i], range_min[i], range_max[i] );\r\n\t\t\t\tif(r == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._value[i] = (target_min[i] + target_max[i]) * 0.5;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar n = (this._value[i] - range_min[i]) / r;\r\n\t\t\t\tif(this.properties.clamp)\r\n\t\t\t\t\tn = clamp(n,0,1);\r\n\t\t\t\tvar t = target_max[i] - target_min[i];\r\n\t\t\t\tthis._value[i] = target_min[i] + n * t;\r\n\t\t\t}\r\n\r\n\t\t\tthis.setOutputData(0,this._value);\r\n\t\t\tthis.setOutputData(1,this._clamped);\r\n        };\r\n\r\n        LiteGraph.registerNodeType(\"math3d/remap_range\", Math3DRemapRange);\r\n\r\n\r\n\r\n    } //glMatrix\r\n\telse if (LiteGraph.debug)\r\n\t\tconsole.warn(\"No glmatrix found, some Math3D nodes may not work\");\r\n\r\n})(this);\r\n\n//basic nodes\r\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n    function toString(a) {\r\n\t\tif(a && a.constructor === Object)\r\n\t\t{\r\n\t\t\ttry\r\n\t\t\t{\r\n\t\t\t\treturn JSON.stringify(a);\r\n\t\t\t}\r\n\t\t\tcatch (err)\r\n\t\t\t{\r\n\t\t\t\treturn String(a);\r\n\t\t\t}\r\n\t\t}\r\n        return String(a);\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\"string/toString\", toString, [\"\"], \"string\");\r\n\r\n    function compare(a, b) {\r\n        return a == b;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"string/compare\",\r\n        compare,\r\n        [\"string\", \"string\"],\r\n        \"boolean\"\r\n    );\r\n\r\n    function concatenate(a, b) {\r\n        if (a === undefined) {\r\n            return b;\r\n        }\r\n        if (b === undefined) {\r\n            return a;\r\n        }\r\n        return a + b;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"string/concatenate\",\r\n        concatenate,\r\n        [\"string\", \"string\"],\r\n        \"string\"\r\n    );\r\n\r\n    function contains(a, b) {\r\n        if (a === undefined || b === undefined) {\r\n            return false;\r\n        }\r\n        return a.indexOf(b) != -1;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"string/contains\",\r\n        contains,\r\n        [\"string\", \"string\"],\r\n        \"boolean\"\r\n    );\r\n\r\n    function toUpperCase(a) {\r\n        if (a != null && a.constructor === String) {\r\n            return a.toUpperCase();\r\n        }\r\n        return a;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"string/toUpperCase\",\r\n        toUpperCase,\r\n        [\"string\"],\r\n        \"string\"\r\n    );\r\n\r\n    function split(str, separator) {\r\n\t\tif(separator == null)\r\n\t\t\tseparator = this.properties.separator;\r\n        if (str == null )\r\n\t        return [];\r\n\t\tif( str.constructor === String )\r\n\t\t\treturn str.split(separator || \" \");\r\n\t\telse if( str.constructor === Array )\r\n\t\t{\r\n\t\t\tvar r = [];\r\n\t\t\tfor(var i = 0; i < str.length; ++i){\r\n                if (typeof str[i] == \"string\")\r\n\t\t\t\t    r[i] = str[i].split(separator || \" \");\r\n            }\r\n\t\t\treturn r;\r\n\t\t}\r\n        return null;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"string/split\",\r\n        split,\r\n        [\"string,array\", \"string\"],\r\n        \"array\",\r\n\t\t{ separator: \",\" }\r\n    );\r\n\r\n    function toFixed(a) {\r\n        if (a != null && a.constructor === Number) {\r\n            return a.toFixed(this.properties.precision);\r\n        }\r\n        return a;\r\n    }\r\n\r\n    LiteGraph.wrapFunctionAsNode(\r\n        \"string/toFixed\",\r\n        toFixed,\r\n        [\"number\"],\r\n        \"string\",\r\n        { precision: 0 }\r\n    );\r\n\r\n\r\n    function StringToTable() {\r\n        this.addInput(\"\", \"string\");\r\n        this.addOutput(\"table\", \"table\");\r\n        this.addOutput(\"rows\", \"number\");\r\n        this.addProperty(\"value\", \"\");\r\n        this.addProperty(\"separator\", \",\");\r\n\t\tthis._table = null;\r\n    }\r\n\r\n    StringToTable.title = \"toTable\";\r\n    StringToTable.desc = \"Splits a string to table\";\r\n\r\n    StringToTable.prototype.onExecute = function() {\r\n        var input = this.getInputData(0);\r\n\t\tif(!input)\r\n\t\t\treturn;\r\n\t\tvar separator = this.properties.separator || \",\";\r\n\t\tif(input != this._str || separator != this._last_separator )\r\n\t\t{\r\n\t\t\tthis._last_separator = separator;\r\n\t\t\tthis._str = input;\r\n\t\t\tthis._table = input.split(\"\\n\").map(function(a){ return a.trim().split(separator)});\r\n\t\t}\r\n        this.setOutputData(0, this._table );\r\n        this.setOutputData(1, this._table ? this._table.length : 0 );\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"string/toTable\", StringToTable);\r\n\r\n})(this);\r\n\n(function(global) {\n    var LiteGraph = global.LiteGraph;\n\n    function Selector() {\n        this.addInput(\"sel\", \"number\");\n        this.addInput(\"A\");\n        this.addInput(\"B\");\n        this.addInput(\"C\");\n        this.addInput(\"D\");\n        this.addOutput(\"out\");\n\n        this.selected = 0;\n    }\n\n    Selector.title = \"Selector\";\n    Selector.desc = \"selects an output\";\n\n    Selector.prototype.onDrawBackground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n        ctx.fillStyle = \"#AFB\";\n        var y = (this.selected + 1) * LiteGraph.NODE_SLOT_HEIGHT + 6;\n        ctx.beginPath();\n        ctx.moveTo(50, y);\n        ctx.lineTo(50, y + LiteGraph.NODE_SLOT_HEIGHT);\n        ctx.lineTo(34, y + LiteGraph.NODE_SLOT_HEIGHT * 0.5);\n        ctx.fill();\n    };\n\n    Selector.prototype.onExecute = function() {\n        var sel = this.getInputData(0);\n        if (sel == null || sel.constructor !== Number)\n            sel = 0;\n        this.selected = sel = Math.round(sel) % (this.inputs.length - 1);\n        var v = this.getInputData(sel + 1);\n        if (v !== undefined) {\n            this.setOutputData(0, v);\n        }\n    };\n\n    Selector.prototype.onGetInputs = function() {\n        return [[\"E\", 0], [\"F\", 0], [\"G\", 0], [\"H\", 0]];\n    };\n\n    LiteGraph.registerNodeType(\"logic/selector\", Selector);\n\n    function Sequence() {\n        this.properties = {\n            sequence: \"A,B,C\"\n        };\n        this.addInput(\"index\", \"number\");\n        this.addInput(\"seq\");\n        this.addOutput(\"out\");\n\n        this.index = 0;\n        this.values = this.properties.sequence.split(\",\");\n    }\n\n    Sequence.title = \"Sequence\";\n    Sequence.desc = \"select one element from a sequence from a string\";\n\n    Sequence.prototype.onPropertyChanged = function(name, value) {\n        if (name == \"sequence\") {\n            this.values = value.split(\",\");\n        }\n    };\n\n    Sequence.prototype.onExecute = function() {\n        var seq = this.getInputData(1);\n        if (seq && seq != this.current_sequence) {\n            this.values = seq.split(\",\");\n            this.current_sequence = seq;\n        }\n        var index = this.getInputData(0);\n        if (index == null) {\n            index = 0;\n        }\n        this.index = index = Math.round(index) % this.values.length;\n\n        this.setOutputData(0, this.values[index]);\n    };\n\n    LiteGraph.registerNodeType(\"logic/sequence\", Sequence);\n\t\n    \n    function logicAnd(){\n        this.properties = { };\n        this.addInput(\"a\", \"boolean\");\n        this.addInput(\"b\", \"boolean\");\n        this.addOutput(\"out\", \"boolean\");\n    }\n    logicAnd.title = \"AND\";\n    logicAnd.desc = \"Return true if all inputs are true\";\n    logicAnd.prototype.onExecute = function() {\n        var ret = true;\n        for (var inX in this.inputs){\n            if (!this.getInputData(inX)){\n                var ret = false;\n                break;\n            }\n        }\n        this.setOutputData(0, ret);\n    };\n    logicAnd.prototype.onGetInputs = function() {\n        return [\n            [\"and\", \"boolean\"]\n        ];\n    };\n    LiteGraph.registerNodeType(\"logic/AND\", logicAnd);\n    \n    \n    function logicOr(){\n        this.properties = { };\n        this.addInput(\"a\", \"boolean\");\n        this.addInput(\"b\", \"boolean\");\n        this.addOutput(\"out\", \"boolean\");\n    }\n    logicOr.title = \"OR\";\n    logicOr.desc = \"Return true if at least one input is true\";\n    logicOr.prototype.onExecute = function() {\n        var ret = false;\n        for (var inX in this.inputs){\n            if (this.getInputData(inX)){\n                ret = true;\n                break;\n            }\n        }\n        this.setOutputData(0, ret);\n    };\n    logicOr.prototype.onGetInputs = function() {\n        return [\n            [\"or\", \"boolean\"]\n        ];\n    };\n    LiteGraph.registerNodeType(\"logic/OR\", logicOr);\n    \n    \n    function logicNot(){\n        this.properties = { };\n        this.addInput(\"in\", \"boolean\");\n        this.addOutput(\"out\", \"boolean\");\n    }\n    logicNot.title = \"NOT\";\n    logicNot.desc = \"Return the logical negation\";\n    logicNot.prototype.onExecute = function() {\n        var ret = !this.getInputData(0);\n        this.setOutputData(0, ret);\n    };\n    LiteGraph.registerNodeType(\"logic/NOT\", logicNot);\n    \n    \n    function logicCompare(){\n        this.properties = { };\n        this.addInput(\"a\", \"boolean\");\n        this.addInput(\"b\", \"boolean\");\n        this.addOutput(\"out\", \"boolean\");\n    }\n    logicCompare.title = \"bool == bool\";\n    logicCompare.desc = \"Compare for logical equality\";\n    logicCompare.prototype.onExecute = function() {\n        var last = null;\n        var ret = true;\n        for (var inX in this.inputs){\n            if (last === null) last = this.getInputData(inX);\n            else\n                if (last != this.getInputData(inX)){\n                    ret = false;\n                    break;\n                }\n        }\n        this.setOutputData(0, ret);\n    };\n    logicCompare.prototype.onGetInputs = function() {\n        return [\n            [\"bool\", \"boolean\"]\n        ];\n    };\n    LiteGraph.registerNodeType(\"logic/CompareBool\", logicCompare);\n    \n    \n    function logicBranch(){\n        this.properties = { };\n        this.addInput(\"onTrigger\", LiteGraph.ACTION);\n        this.addInput(\"condition\", \"boolean\");\n        this.addOutput(\"true\", LiteGraph.EVENT);\n        this.addOutput(\"false\", LiteGraph.EVENT);\n        this.mode = LiteGraph.ON_TRIGGER;\n    }\n    logicBranch.title = \"Branch\";\n    logicBranch.desc = \"Branch execution on condition\";\n    logicBranch.prototype.onExecute = function(param, options) {\n        var condtition = this.getInputData(1);\n        if (condtition){\n            this.triggerSlot(0);\n        }else{\n            this.triggerSlot(1);\n        }\n    };\n    LiteGraph.registerNodeType(\"logic/IF\", logicBranch);\n})(this);\n\n(function(global) {\n    var LiteGraph = global.LiteGraph;\n\n    function GraphicsPlot() {\n        this.addInput(\"A\", \"Number\");\n        this.addInput(\"B\", \"Number\");\n        this.addInput(\"C\", \"Number\");\n        this.addInput(\"D\", \"Number\");\n\n        this.values = [[], [], [], []];\n        this.properties = { scale: 2 };\n    }\n\n    GraphicsPlot.title = \"Plot\";\n    GraphicsPlot.desc = \"Plots data over time\";\n    GraphicsPlot.colors = [\"#FFF\", \"#F99\", \"#9F9\", \"#99F\"];\n\n    GraphicsPlot.prototype.onExecute = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n\n        var size = this.size;\n\n        for (var i = 0; i < 4; ++i) {\n            var v = this.getInputData(i);\n            if (v == null) {\n                continue;\n            }\n            var values = this.values[i];\n            values.push(v);\n            if (values.length > size[0]) {\n                values.shift();\n            }\n        }\n    };\n\n    GraphicsPlot.prototype.onDrawBackground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n\n        var size = this.size;\n\n        var scale = (0.5 * size[1]) / this.properties.scale;\n        var colors = GraphicsPlot.colors;\n        var offset = size[1] * 0.5;\n\n        ctx.fillStyle = \"#000\";\n        ctx.fillRect(0, 0, size[0], size[1]);\n        ctx.strokeStyle = \"#555\";\n        ctx.beginPath();\n        ctx.moveTo(0, offset);\n        ctx.lineTo(size[0], offset);\n        ctx.stroke();\n\n        if (this.inputs) {\n            for (var i = 0; i < 4; ++i) {\n                var values = this.values[i];\n                if (!this.inputs[i] || !this.inputs[i].link) {\n                    continue;\n                }\n                ctx.strokeStyle = colors[i];\n                ctx.beginPath();\n                var v = values[0] * scale * -1 + offset;\n                ctx.moveTo(0, clamp(v, 0, size[1]));\n                for (var j = 1; j < values.length && j < size[0]; ++j) {\n                    var v = values[j] * scale * -1 + offset;\n                    ctx.lineTo(j, clamp(v, 0, size[1]));\n                }\n                ctx.stroke();\n            }\n        }\n    };\n\n    LiteGraph.registerNodeType(\"graphics/plot\", GraphicsPlot);\n\n    function GraphicsImage() {\n        this.addOutput(\"frame\", \"image\");\n        this.properties = { url: \"\" };\n    }\n\n    GraphicsImage.title = \"Image\";\n    GraphicsImage.desc = \"Image loader\";\n    GraphicsImage.widgets = [{ name: \"load\", text: \"Load\", type: \"button\" }];\n\n    GraphicsImage.supported_extensions = [\"jpg\", \"jpeg\", \"png\", \"gif\"];\n\n    GraphicsImage.prototype.onAdded = function() {\n        if (this.properties[\"url\"] != \"\" && this.img == null) {\n            this.loadImage(this.properties[\"url\"]);\n        }\n    };\n\n    GraphicsImage.prototype.onDrawBackground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n        if (this.img && this.size[0] > 5 && this.size[1] > 5 && this.img.width) {\n            ctx.drawImage(this.img, 0, 0, this.size[0], this.size[1]);\n        }\n    };\n\n    GraphicsImage.prototype.onExecute = function() {\n        if (!this.img) {\n            this.boxcolor = \"#000\";\n        }\n        if (this.img && this.img.width) {\n            this.setOutputData(0, this.img);\n        } else {\n            this.setOutputData(0, null);\n        }\n        if (this.img && this.img.dirty) {\n            this.img.dirty = false;\n        }\n    };\n\n    GraphicsImage.prototype.onPropertyChanged = function(name, value) {\n        this.properties[name] = value;\n        if (name == \"url\" && value != \"\") {\n            this.loadImage(value);\n        }\n\n        return true;\n    };\n\n    GraphicsImage.prototype.loadImage = function(url, callback) {\n        if (url == \"\") {\n            this.img = null;\n            return;\n        }\n\n        this.img = document.createElement(\"img\");\n\n        if (url.substr(0, 4) == \"http\" && LiteGraph.proxy) {\n            url = LiteGraph.proxy + url.substr(url.indexOf(\":\") + 3);\n        }\n\n        this.img.src = url;\n        this.boxcolor = \"#F95\";\n        var that = this;\n        this.img.onload = function() {\n            if (callback) {\n                callback(this);\n            }\n            console.log( \"Image loaded, size: \" + that.img.width + \"x\" + that.img.height );\n            this.dirty = true;\n            that.boxcolor = \"#9F9\";\n            that.setDirtyCanvas(true);\n        };\n        this.img.onerror = function() {\n\t\t\tconsole.log(\"error loading the image:\" + url);\n\t\t}\n    };\n\n    GraphicsImage.prototype.onWidget = function(e, widget) {\n        if (widget.name == \"load\") {\n            this.loadImage(this.properties[\"url\"]);\n        }\n    };\n\n    GraphicsImage.prototype.onDropFile = function(file) {\n        var that = this;\n        if (this._url) {\n            URL.revokeObjectURL(this._url);\n        }\n        this._url = URL.createObjectURL(file);\n        this.properties.url = this._url;\n        this.loadImage(this._url, function(img) {\n            that.size[1] = (img.height / img.width) * that.size[0];\n        });\n    };\n\n    LiteGraph.registerNodeType(\"graphics/image\", GraphicsImage);\n\n    function ColorPalette() {\n        this.addInput(\"f\", \"number\");\n        this.addOutput(\"Color\", \"color\");\n        this.properties = {\n            colorA: \"#444444\",\n            colorB: \"#44AAFF\",\n            colorC: \"#44FFAA\",\n            colorD: \"#FFFFFF\"\n        };\n    }\n\n    ColorPalette.title = \"Palette\";\n    ColorPalette.desc = \"Generates a color\";\n\n    ColorPalette.prototype.onExecute = function() {\n        var c = [];\n\n        if (this.properties.colorA != null) {\n            c.push(hex2num(this.properties.colorA));\n        }\n        if (this.properties.colorB != null) {\n            c.push(hex2num(this.properties.colorB));\n        }\n        if (this.properties.colorC != null) {\n            c.push(hex2num(this.properties.colorC));\n        }\n        if (this.properties.colorD != null) {\n            c.push(hex2num(this.properties.colorD));\n        }\n\n        var f = this.getInputData(0);\n        if (f == null) {\n            f = 0.5;\n        }\n        if (f > 1.0) {\n            f = 1.0;\n        } else if (f < 0.0) {\n            f = 0.0;\n        }\n\n        if (c.length == 0) {\n            return;\n        }\n\n        var result = [0, 0, 0];\n        if (f == 0) {\n            result = c[0];\n        } else if (f == 1) {\n            result = c[c.length - 1];\n        } else {\n            var pos = (c.length - 1) * f;\n            var c1 = c[Math.floor(pos)];\n            var c2 = c[Math.floor(pos) + 1];\n            var t = pos - Math.floor(pos);\n            result[0] = c1[0] * (1 - t) + c2[0] * t;\n            result[1] = c1[1] * (1 - t) + c2[1] * t;\n            result[2] = c1[2] * (1 - t) + c2[2] * t;\n        }\n\n        /*\n\tc[0] = 1.0 - Math.abs( Math.sin( 0.1 * reModular.getTime() * Math.PI) );\n\tc[1] = Math.abs( Math.sin( 0.07 * reModular.getTime() * Math.PI) );\n\tc[2] = Math.abs( Math.sin( 0.01 * reModular.getTime() * Math.PI) );\n\t*/\n\n        for (var i=0; i < result.length; i++) {\n            result[i] /= 255;\n        }\n\n        this.boxcolor = colorToString(result);\n        this.setOutputData(0, result);\n    };\n\n    LiteGraph.registerNodeType(\"color/palette\", ColorPalette);\n\n    function ImageFrame() {\n        this.addInput(\"\", \"image,canvas\");\n        this.size = [200, 200];\n    }\n\n    ImageFrame.title = \"Frame\";\n    ImageFrame.desc = \"Frame viewerew\";\n    ImageFrame.widgets = [\n        { name: \"resize\", text: \"Resize box\", type: \"button\" },\n        { name: \"view\", text: \"View Image\", type: \"button\" }\n    ];\n\n    ImageFrame.prototype.onDrawBackground = function(ctx) {\n        if (this.frame && !this.flags.collapsed) {\n            ctx.drawImage(this.frame, 0, 0, this.size[0], this.size[1]);\n        }\n    };\n\n    ImageFrame.prototype.onExecute = function() {\n        this.frame = this.getInputData(0);\n        this.setDirtyCanvas(true);\n    };\n\n    ImageFrame.prototype.onWidget = function(e, widget) {\n        if (widget.name == \"resize\" && this.frame) {\n            var width = this.frame.width;\n            var height = this.frame.height;\n\n            if (!width && this.frame.videoWidth != null) {\n                width = this.frame.videoWidth;\n                height = this.frame.videoHeight;\n            }\n\n            if (width && height) {\n                this.size = [width, height];\n            }\n            this.setDirtyCanvas(true, true);\n        } else if (widget.name == \"view\") {\n            this.show();\n        }\n    };\n\n    ImageFrame.prototype.show = function() {\n        //var str = this.canvas.toDataURL(\"image/png\");\n        if (showElement && this.frame) {\n            showElement(this.frame);\n        }\n    };\n\n    LiteGraph.registerNodeType(\"graphics/frame\", ImageFrame);\n\n    function ImageFade() {\n        this.addInputs([\n            [\"img1\", \"image\"],\n            [\"img2\", \"image\"],\n            [\"fade\", \"number\"]\n        ]);\n        this.addOutput(\"\", \"image\");\n        this.properties = { fade: 0.5, width: 512, height: 512 };\n    }\n\n    ImageFade.title = \"Image fade\";\n    ImageFade.desc = \"Fades between images\";\n    ImageFade.widgets = [\n        { name: \"resizeA\", text: \"Resize to A\", type: \"button\" },\n        { name: \"resizeB\", text: \"Resize to B\", type: \"button\" }\n    ];\n\n    ImageFade.prototype.onAdded = function() {\n        this.createCanvas();\n        var ctx = this.canvas.getContext(\"2d\");\n        ctx.fillStyle = \"#000\";\n        ctx.fillRect(0, 0, this.properties[\"width\"], this.properties[\"height\"]);\n    };\n\n    ImageFade.prototype.createCanvas = function() {\n        this.canvas = document.createElement(\"canvas\");\n        this.canvas.width = this.properties[\"width\"];\n        this.canvas.height = this.properties[\"height\"];\n    };\n\n    ImageFade.prototype.onExecute = function() {\n        var ctx = this.canvas.getContext(\"2d\");\n        this.canvas.width = this.canvas.width;\n\n        var A = this.getInputData(0);\n        if (A != null) {\n            ctx.drawImage(A, 0, 0, this.canvas.width, this.canvas.height);\n        }\n\n        var fade = this.getInputData(2);\n        if (fade == null) {\n            fade = this.properties[\"fade\"];\n        } else {\n            this.properties[\"fade\"] = fade;\n        }\n\n        ctx.globalAlpha = fade;\n        var B = this.getInputData(1);\n        if (B != null) {\n            ctx.drawImage(B, 0, 0, this.canvas.width, this.canvas.height);\n        }\n        ctx.globalAlpha = 1.0;\n\n        this.setOutputData(0, this.canvas);\n        this.setDirtyCanvas(true);\n    };\n\n    LiteGraph.registerNodeType(\"graphics/imagefade\", ImageFade);\n\n    function ImageCrop() {\n        this.addInput(\"\", \"image\");\n        this.addOutput(\"\", \"image\");\n        this.properties = { width: 256, height: 256, x: 0, y: 0, scale: 1.0 };\n        this.size = [50, 20];\n    }\n\n    ImageCrop.title = \"Crop\";\n    ImageCrop.desc = \"Crop Image\";\n\n    ImageCrop.prototype.onAdded = function() {\n        this.createCanvas();\n    };\n\n    ImageCrop.prototype.createCanvas = function() {\n        this.canvas = document.createElement(\"canvas\");\n        this.canvas.width = this.properties[\"width\"];\n        this.canvas.height = this.properties[\"height\"];\n    };\n\n    ImageCrop.prototype.onExecute = function() {\n        var input = this.getInputData(0);\n        if (!input) {\n            return;\n        }\n\n        if (input.width) {\n            var ctx = this.canvas.getContext(\"2d\");\n\n            ctx.drawImage(\n                input,\n                -this.properties[\"x\"],\n                -this.properties[\"y\"],\n                input.width * this.properties[\"scale\"],\n                input.height * this.properties[\"scale\"]\n            );\n            this.setOutputData(0, this.canvas);\n        } else {\n            this.setOutputData(0, null);\n        }\n    };\n\n    ImageCrop.prototype.onDrawBackground = function(ctx) {\n        if (this.flags.collapsed) {\n            return;\n        }\n        if (this.canvas) {\n            ctx.drawImage(\n                this.canvas,\n                0,\n                0,\n                this.canvas.width,\n                this.canvas.height,\n                0,\n                0,\n                this.size[0],\n                this.size[1]\n            );\n        }\n    };\n\n    ImageCrop.prototype.onPropertyChanged = function(name, value) {\n        this.properties[name] = value;\n\n        if (name == \"scale\") {\n            this.properties[name] = parseFloat(value);\n            if (this.properties[name] == 0) {\n                console.error(\"Error in scale\");\n                this.properties[name] = 1.0;\n            }\n        } else {\n            this.properties[name] = parseInt(value);\n        }\n\n        this.createCanvas();\n\n        return true;\n    };\n\n    LiteGraph.registerNodeType(\"graphics/cropImage\", ImageCrop);\n\n    //CANVAS stuff\n\n    function CanvasNode() {\n        this.addInput(\"clear\", LiteGraph.ACTION);\n        this.addOutput(\"\", \"canvas\");\n        this.properties = { width: 512, height: 512, autoclear: true };\n\n        this.canvas = document.createElement(\"canvas\");\n        this.ctx = this.canvas.getContext(\"2d\");\n    }\n\n    CanvasNode.title = \"Canvas\";\n    CanvasNode.desc = \"Canvas to render stuff\";\n\n    CanvasNode.prototype.onExecute = function() {\n        var canvas = this.canvas;\n        var w = this.properties.width | 0;\n        var h = this.properties.height | 0;\n        if (canvas.width != w) {\n            canvas.width = w;\n        }\n        if (canvas.height != h) {\n            canvas.height = h;\n        }\n\n        if (this.properties.autoclear) {\n            this.ctx.clearRect(0, 0, canvas.width, canvas.height);\n        }\n        this.setOutputData(0, canvas);\n    };\n\n    CanvasNode.prototype.onAction = function(action, param) {\n        if (action == \"clear\") {\n            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        }\n    };\n\n    LiteGraph.registerNodeType(\"graphics/canvas\", CanvasNode);\n\n    function DrawImageNode() {\n        this.addInput(\"canvas\", \"canvas\");\n        this.addInput(\"img\", \"image,canvas\");\n        this.addInput(\"x\", \"number\");\n        this.addInput(\"y\", \"number\");\n        this.properties = { x: 0, y: 0, opacity: 1 };\n    }\n\n    DrawImageNode.title = \"DrawImage\";\n    DrawImageNode.desc = \"Draws image into a canvas\";\n\n    DrawImageNode.prototype.onExecute = function() {\n        var canvas = this.getInputData(0);\n        if (!canvas) {\n            return;\n        }\n\n        var img = this.getInputOrProperty(\"img\");\n        if (!img) {\n            return;\n        }\n\n        var x = this.getInputOrProperty(\"x\");\n        var y = this.getInputOrProperty(\"y\");\n        var ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(img, x, y);\n    };\n\n    LiteGraph.registerNodeType(\"graphics/drawImage\", DrawImageNode);\n\n    function DrawRectangleNode() {\n        this.addInput(\"canvas\", \"canvas\");\n        this.addInput(\"x\", \"number\");\n        this.addInput(\"y\", \"number\");\n        this.addInput(\"w\", \"number\");\n        this.addInput(\"h\", \"number\");\n        this.properties = {\n            x: 0,\n            y: 0,\n            w: 10,\n            h: 10,\n            color: \"white\",\n            opacity: 1\n        };\n    }\n\n    DrawRectangleNode.title = \"DrawRectangle\";\n    DrawRectangleNode.desc = \"Draws rectangle in canvas\";\n\n    DrawRectangleNode.prototype.onExecute = function() {\n        var canvas = this.getInputData(0);\n        if (!canvas) {\n            return;\n        }\n\n        var x = this.getInputOrProperty(\"x\");\n        var y = this.getInputOrProperty(\"y\");\n        var w = this.getInputOrProperty(\"w\");\n        var h = this.getInputOrProperty(\"h\");\n        var ctx = canvas.getContext(\"2d\");\n        ctx.fillRect(x, y, w, h);\n    };\n\n    LiteGraph.registerNodeType(\"graphics/drawRectangle\", DrawRectangleNode);\n\n    function ImageVideo() {\n        this.addInput(\"t\", \"number\");\n        this.addOutputs([[\"frame\", \"image\"], [\"t\", \"number\"], [\"d\", \"number\"]]);\n        this.properties = { url: \"\", use_proxy: true };\n    }\n\n    ImageVideo.title = \"Video\";\n    ImageVideo.desc = \"Video playback\";\n    ImageVideo.widgets = [\n        { name: \"play\", text: \"PLAY\", type: \"minibutton\" },\n        { name: \"stop\", text: \"STOP\", type: \"minibutton\" },\n        { name: \"demo\", text: \"Demo video\", type: \"button\" },\n        { name: \"mute\", text: \"Mute video\", type: \"button\" }\n    ];\n\n    ImageVideo.prototype.onExecute = function() {\n        if (!this.properties.url) {\n            return;\n        }\n\n        if (this.properties.url != this._video_url) {\n            this.loadVideo(this.properties.url);\n        }\n\n        if (!this._video || this._video.width == 0) {\n            return;\n        }\n\n        var t = this.getInputData(0);\n        if (t && t >= 0 && t <= 1.0) {\n            this._video.currentTime = t * this._video.duration;\n            this._video.pause();\n        }\n\n        this._video.dirty = true;\n        this.setOutputData(0, this._video);\n        this.setOutputData(1, this._video.currentTime);\n        this.setOutputData(2, this._video.duration);\n        this.setDirtyCanvas(true);\n    };\n\n    ImageVideo.prototype.onStart = function() {\n        this.play();\n    };\n\n    ImageVideo.prototype.onStop = function() {\n        this.stop();\n    };\n\n    ImageVideo.prototype.loadVideo = function(url) {\n        this._video_url = url;\n\n\t\tvar pos = url.substr(0,10).indexOf(\":\");\n\t\tvar protocol = \"\";\n\t\tif(pos != -1)\n\t\t\tprotocol = url.substr(0,pos);\n\n\t\tvar host = \"\";\n\t\tif(protocol)\n\t\t{\n\t\t\thost = url.substr(0,url.indexOf(\"/\",protocol.length + 3));\n\t\t\thost = host.substr(protocol.length+3);\n\t\t}\n\n        if (\n            this.properties.use_proxy &&\n            protocol &&\n            LiteGraph.proxy &&\n\t\t\thost != location.host\n        ) {\n            url = LiteGraph.proxy + url.substr(url.indexOf(\":\") + 3);\n        }\n\n        this._video = document.createElement(\"video\");\n        this._video.src = url;\n        this._video.type = \"type=video/mp4\";\n\n        this._video.muted = true;\n        this._video.autoplay = true;\n\n        var that = this;\n        this._video.addEventListener(\"loadedmetadata\", function(e) {\n            //onload\n            console.log(\"Duration: \" + this.duration + \" seconds\");\n            console.log(\"Size: \" + this.videoWidth + \",\" + this.videoHeight);\n            that.setDirtyCanvas(true);\n            this.width = this.videoWidth;\n            this.height = this.videoHeight;\n        });\n        this._video.addEventListener(\"progress\", function(e) {\n            //onload\n            console.log(\"video loading...\");\n        });\n        this._video.addEventListener(\"error\", function(e) {\n            console.error(\"Error loading video: \" + this.src);\n            if (this.error) {\n                switch (this.error.code) {\n                    case this.error.MEDIA_ERR_ABORTED:\n                        console.error(\"You stopped the video.\");\n                        break;\n                    case this.error.MEDIA_ERR_NETWORK:\n                        console.error(\"Network error - please try again later.\");\n                        break;\n                    case this.error.MEDIA_ERR_DECODE:\n                        console.error(\"Video is broken..\");\n                        break;\n                    case this.error.MEDIA_ERR_SRC_NOT_SUPPORTED:\n                        console.error(\"Sorry, your browser can't play this video.\");\n                        break;\n                }\n            }\n        });\n\n        this._video.addEventListener(\"ended\", function(e) {\n            console.log(\"Video Ended.\");\n            this.play(); //loop\n        });\n\n        //document.body.appendChild(this.video);\n    };\n\n    ImageVideo.prototype.onPropertyChanged = function(name, value) {\n        this.properties[name] = value;\n        if (name == \"url\" && value != \"\") {\n            this.loadVideo(value);\n        }\n\n        return true;\n    };\n\n    ImageVideo.prototype.play = function() {\n        if (this._video && this._video.videoWidth ) { //is loaded\n            this._video.play();\n        }\n    };\n\n    ImageVideo.prototype.playPause = function() {\n        if (!this._video) {\n            return;\n        }\n        if (this._video.paused) {\n            this.play();\n        } else {\n            this.pause();\n        }\n    };\n\n    ImageVideo.prototype.stop = function() {\n        if (!this._video) {\n            return;\n        }\n        this._video.pause();\n        this._video.currentTime = 0;\n    };\n\n    ImageVideo.prototype.pause = function() {\n        if (!this._video) {\n            return;\n        }\n        console.log(\"Video paused\");\n        this._video.pause();\n    };\n\n    ImageVideo.prototype.onWidget = function(e, widget) {\n        /*\n\tif(widget.name == \"demo\")\n\t{\n\t\tthis.loadVideo();\n\t}\n\telse if(widget.name == \"play\")\n\t{\n\t\tif(this._video)\n\t\t\tthis.playPause();\n\t}\n\tif(widget.name == \"stop\")\n\t{\n\t\tthis.stop();\n\t}\n\telse if(widget.name == \"mute\")\n\t{\n\t\tif(this._video)\n\t\t\tthis._video.muted = !this._video.muted;\n\t}\n\t*/\n    };\n\n    LiteGraph.registerNodeType(\"graphics/video\", ImageVideo);\n\n    // Texture Webcam *****************************************\n    function ImageWebcam() {\n        this.addOutput(\"Webcam\", \"image\");\n        this.properties = { filterFacingMode: false, facingMode: \"user\" };\n        this.boxcolor = \"black\";\n        this.frame = 0;\n    }\n\n    ImageWebcam.title = \"Webcam\";\n    ImageWebcam.desc = \"Webcam image\";\n    ImageWebcam.is_webcam_open = false;\n\n    ImageWebcam.prototype.openStream = function() {\n        if (!navigator.mediaDevices.getUserMedia) {\n            console.log('getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags');\n            return;\n        }\n\n        this._waiting_confirmation = true;\n\n        // Not showing vendor prefixes.\n        var constraints = {\n            audio: false,\n            video: !this.properties.filterFacingMode ? true : { facingMode: this.properties.facingMode }\n        };\n        navigator.mediaDevices\n            .getUserMedia(constraints)\n            .then(this.streamReady.bind(this))\n            .catch(onFailSoHard);\n\n        var that = this;\n        function onFailSoHard(e) {\n            console.log(\"Webcam rejected\", e);\n            that._webcam_stream = false;\n            ImageWebcam.is_webcam_open = false;\n            that.boxcolor = \"red\";\n            that.trigger(\"stream_error\");\n        }\n    };\n\n    ImageWebcam.prototype.closeStream = function() {\n        if (this._webcam_stream) {\n            var tracks = this._webcam_stream.getTracks();\n            if (tracks.length) {\n                for (var i = 0; i < tracks.length; ++i) {\n                    tracks[i].stop();\n                }\n            }\n            ImageWebcam.is_webcam_open = false;\n            this._webcam_stream = null;\n            this._video = null;\n            this.boxcolor = \"black\";\n            this.trigger(\"stream_closed\");\n        }\n    };\n\n    ImageWebcam.prototype.onPropertyChanged = function(name, value) {\n        if (name == \"facingMode\") {\n            this.properties.facingMode = value;\n            this.closeStream();\n            this.openStream();\n        }\n    };\n\n    ImageWebcam.prototype.onRemoved = function() {\n        this.closeStream();\n    };\n\n    ImageWebcam.prototype.streamReady = function(localMediaStream) {\n        this._webcam_stream = localMediaStream;\n        //this._waiting_confirmation = false;\n        this.boxcolor = \"green\";\n\n        var video = this._video;\n        if (!video) {\n            video = document.createElement(\"video\");\n            video.autoplay = true;\n            video.srcObject = localMediaStream;\n            this._video = video;\n            //document.body.appendChild( video ); //debug\n            //when video info is loaded (size and so)\n            video.onloadedmetadata = function(e) {\n                // Ready to go. Do some stuff.\n                console.log(e);\n                ImageWebcam.is_webcam_open = true;\n            };\n        }\n\n        this.trigger(\"stream_ready\", video);\n    };\n\n    ImageWebcam.prototype.onExecute = function() {\n        if (this._webcam_stream == null && !this._waiting_confirmation) {\n            this.openStream();\n        }\n\n        if (!this._video || !this._video.videoWidth) {\n            return;\n        }\n\n        this._video.frame = ++this.frame;\n        this._video.width = this._video.videoWidth;\n        this._video.height = this._video.videoHeight;\n        this.setOutputData(0, this._video);\n        for (var i = 1; i < this.outputs.length; ++i) {\n            if (!this.outputs[i]) {\n                continue;\n            }\n            switch (this.outputs[i].name) {\n                case \"width\":\n                    this.setOutputData(i, this._video.videoWidth);\n                    break;\n                case \"height\":\n                    this.setOutputData(i, this._video.videoHeight);\n                    break;\n            }\n        }\n    };\n\n    ImageWebcam.prototype.getExtraMenuOptions = function(graphcanvas) {\n        var that = this;\n        var txt = !that.properties.show ? \"Show Frame\" : \"Hide Frame\";\n        return [\n            {\n                content: txt,\n                callback: function() {\n                    that.properties.show = !that.properties.show;\n                }\n            }\n        ];\n    };\n\n    ImageWebcam.prototype.onDrawBackground = function(ctx) {\n        if (\n            this.flags.collapsed ||\n            this.size[1] <= 20 ||\n            !this.properties.show\n        ) {\n            return;\n        }\n\n        if (!this._video) {\n            return;\n        }\n\n        //render to graph canvas\n        ctx.save();\n        ctx.drawImage(this._video, 0, 0, this.size[0], this.size[1]);\n        ctx.restore();\n    };\n\n    ImageWebcam.prototype.onGetOutputs = function() {\n        return [\n            [\"width\", \"number\"],\n            [\"height\", \"number\"],\n            [\"stream_ready\", LiteGraph.EVENT],\n            [\"stream_closed\", LiteGraph.EVENT],\n            [\"stream_error\", LiteGraph.EVENT]\n        ];\n    };\n\n    LiteGraph.registerNodeType(\"graphics/webcam\", ImageWebcam);\n})(this);\n\n(function(global) {\n    var LiteGraph = global.LiteGraph;\n\tvar LGraphCanvas = global.LGraphCanvas;\n\n    //Works with Litegl.js to create WebGL nodes\n    global.LGraphTexture = null;\n\n    if (typeof GL == \"undefined\")\n\t\treturn;\n\n\tLGraphCanvas.link_type_colors[\"Texture\"] = \"#987\";\n\n\tfunction LGraphTexture() {\n\t\tthis.addOutput(\"tex\", \"Texture\");\n\t\tthis.addOutput(\"name\", \"string\");\n\t\tthis.properties = { name: \"\", filter: true };\n\t\tthis.size = [\n\t\t\tLGraphTexture.image_preview_size,\n\t\t\tLGraphTexture.image_preview_size\n\t\t];\n\t}\n\n\tglobal.LGraphTexture = LGraphTexture;\n\n\tLGraphTexture.title = \"Texture\";\n\tLGraphTexture.desc = \"Texture\";\n\tLGraphTexture.widgets_info = {\n\t\tname: { widget: \"texture\" },\n\t\tfilter: { widget: \"checkbox\" }\n\t};\n\n\t//REPLACE THIS TO INTEGRATE WITH YOUR FRAMEWORK\n\tLGraphTexture.loadTextureCallback = null; //function in charge of loading textures when not present in the container\n\tLGraphTexture.image_preview_size = 256;\n\n\t//flags to choose output texture type\n\tLGraphTexture.UNDEFINED = 0; //not specified\n\tLGraphTexture.PASS_THROUGH = 1; //do not apply FX (like disable but passing the in to the out)\n\tLGraphTexture.COPY = 2; //create new texture with the same properties as the origin texture\n\tLGraphTexture.LOW = 3; //create new texture with low precision (byte)\n\tLGraphTexture.HIGH = 4; //create new texture with high precision (half-float)\n\tLGraphTexture.REUSE = 5; //reuse input texture\n\tLGraphTexture.DEFAULT = 2; //use the default\n\n\tLGraphTexture.MODE_VALUES = {\n\t\t\"undefined\": LGraphTexture.UNDEFINED,\n\t\t\"pass through\": LGraphTexture.PASS_THROUGH,\n\t\tcopy: LGraphTexture.COPY,\n\t\tlow: LGraphTexture.LOW,\n\t\thigh: LGraphTexture.HIGH,\n\t\treuse: LGraphTexture.REUSE,\n\t\tdefault: LGraphTexture.DEFAULT\n\t};\n\n\t//returns the container where all the loaded textures are stored (overwrite if you have a Resources Manager)\n\tLGraphTexture.getTexturesContainer = function() {\n\t\treturn gl.textures;\n\t};\n\n\t//process the loading of a texture (overwrite it if you have a Resources Manager)\n\tLGraphTexture.loadTexture = function(name, options) {\n\t\toptions = options || {};\n\t\tvar url = name;\n\t\tif (url.substr(0, 7) == \"http://\") {\n\t\t\tif (LiteGraph.proxy) {\n\t\t\t\t//proxy external files\n\t\t\t\turl = LiteGraph.proxy + url.substr(7);\n\t\t\t}\n\t\t}\n\n\t\tvar container = LGraphTexture.getTexturesContainer();\n\t\tvar tex = (container[name] = GL.Texture.fromURL(url, options));\n\t\treturn tex;\n\t};\n\n\tLGraphTexture.getTexture = function(name) {\n\t\tvar container = this.getTexturesContainer();\n\n\t\tif (!container) {\n\t\t\tthrow \"Cannot load texture, container of textures not found\";\n\t\t}\n\n\t\tvar tex = container[name];\n\t\tif (!tex && name && name[0] != \":\") {\n\t\t\treturn this.loadTexture(name);\n\t\t}\n\n\t\treturn tex;\n\t};\n\n\t//used to compute the appropiate output texture\n\tLGraphTexture.getTargetTexture = function(origin, target, mode) {\n\t\tif (!origin) {\n\t\t\tthrow \"LGraphTexture.getTargetTexture expects a reference texture\";\n\t\t}\n\n\t\tvar tex_type = null;\n\n\t\tswitch (mode) {\n\t\t\tcase LGraphTexture.LOW:\n\t\t\t\ttex_type = gl.UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t\tcase LGraphTexture.HIGH:\n\t\t\t\ttex_type = gl.HIGH_PRECISION_FORMAT;\n\t\t\t\tbreak;\n\t\t\tcase LGraphTexture.REUSE:\n\t\t\t\treturn origin;\n\t\t\t\tbreak;\n\t\t\tcase LGraphTexture.COPY:\n\t\t\tdefault:\n\t\t\t\ttex_type = origin ? origin.type : gl.UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (\n\t\t\t!target ||\n\t\t\ttarget.width != origin.width ||\n\t\t\ttarget.height != origin.height ||\n\t\t\ttarget.type != tex_type ||\n\t\t\ttarget.format != origin.format \n\t\t) {\n\t\t\ttarget = new GL.Texture(origin.width, origin.height, {\n\t\t\t\ttype: tex_type,\n\t\t\t\tformat: origin.format,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\treturn target;\n\t};\n\n\tLGraphTexture.getTextureType = function(precision, ref_texture) {\n\t\tvar type = ref_texture ? ref_texture.type : gl.UNSIGNED_BYTE;\n\t\tswitch (precision) {\n\t\t\tcase LGraphTexture.HIGH:\n\t\t\t\ttype = gl.HIGH_PRECISION_FORMAT;\n\t\t\t\tbreak;\n\t\t\tcase LGraphTexture.LOW:\n\t\t\t\ttype = gl.UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t\t//no default\n\t\t}\n\t\treturn type;\n\t};\n\n\tLGraphTexture.getWhiteTexture = function() {\n\t\tif (this._white_texture) {\n\t\t\treturn this._white_texture;\n\t\t}\n\t\tvar texture = (this._white_texture = GL.Texture.fromMemory(\n\t\t\t1,\n\t\t\t1,\n\t\t\t[255, 255, 255, 255],\n\t\t\t{ format: gl.RGBA, wrap: gl.REPEAT, filter: gl.NEAREST }\n\t\t));\n\t\treturn texture;\n\t};\n\n\tLGraphTexture.getNoiseTexture = function() {\n\t\tif (this._noise_texture) {\n\t\t\treturn this._noise_texture;\n\t\t}\n\n\t\tvar noise = new Uint8Array(512 * 512 * 4);\n\t\tfor (var i = 0; i < 512 * 512 * 4; ++i) {\n\t\t\tnoise[i] = Math.random() * 255;\n\t\t}\n\n\t\tvar texture = GL.Texture.fromMemory(512, 512, noise, {\n\t\t\tformat: gl.RGBA,\n\t\t\twrap: gl.REPEAT,\n\t\t\tfilter: gl.NEAREST\n\t\t});\n\t\tthis._noise_texture = texture;\n\t\treturn texture;\n\t};\n\n\tLGraphTexture.prototype.onDropFile = function(data, filename, file) {\n\t\tif (!data) {\n\t\t\tthis._drop_texture = null;\n\t\t\tthis.properties.name = \"\";\n\t\t} else {\n\t\t\tvar texture = null;\n\t\t\tif (typeof data == \"string\") {\n\t\t\t\ttexture = GL.Texture.fromURL(data);\n\t\t\t} else if (filename.toLowerCase().indexOf(\".dds\") != -1) {\n\t\t\t\ttexture = GL.Texture.fromDDSInMemory(data);\n\t\t\t} else {\n\t\t\t\tvar blob = new Blob([file]);\n\t\t\t\tvar url = URL.createObjectURL(blob);\n\t\t\t\ttexture = GL.Texture.fromURL(url);\n\t\t\t}\n\n\t\t\tthis._drop_texture = texture;\n\t\t\tthis.properties.name = filename;\n\t\t}\n\t};\n\n\tLGraphTexture.prototype.getExtraMenuOptions = function(graphcanvas) {\n\t\tvar that = this;\n\t\tif (!this._drop_texture) {\n\t\t\treturn;\n\t\t}\n\t\treturn [\n\t\t\t{\n\t\t\t\tcontent: \"Clear\",\n\t\t\t\tcallback: function() {\n\t\t\t\t\tthat._drop_texture = null;\n\t\t\t\t\tthat.properties.name = \"\";\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t};\n\n\tLGraphTexture.prototype.onExecute = function() {\n\t\tvar tex = null;\n\t\tif (this.isOutputConnected(1)) {\n\t\t\ttex = this.getInputData(0);\n\t\t}\n\n\t\tif (!tex && this._drop_texture) {\n\t\t\ttex = this._drop_texture;\n\t\t}\n\n\t\tif (!tex && this.properties.name) {\n\t\t\ttex = LGraphTexture.getTexture(this.properties.name);\n\t\t}\n\n\t\tif (!tex) {\n\t\t\tthis.setOutputData( 0, null );\n\t\t\tthis.setOutputData( 1, \"\" );\n\t\t\treturn;\n\t\t}\n\n\t\tthis._last_tex = tex;\n\n\t\tif (this.properties.filter === false) {\n\t\t\ttex.setParameter(gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\t} else {\n\t\t\ttex.setParameter(gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\t\t}\n\n\t\tthis.setOutputData( 0, tex );\n\t\tthis.setOutputData( 1, tex.fullpath || tex.filename );\n\n\t\tfor (var i = 2; i < this.outputs.length; i++) {\n\t\t\tvar output = this.outputs[i];\n\t\t\tif (!output) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar v = null;\n\t\t\tif (output.name == \"width\") {\n\t\t\t\tv = tex.width;\n\t\t\t} else if (output.name == \"height\") {\n\t\t\t\tv = tex.height;\n\t\t\t} else if (output.name == \"aspect\") {\n\t\t\t\tv = tex.width / tex.height;\n\t\t\t}\n\t\t\tthis.setOutputData(i, v);\n\t\t}\n\t};\n\n\tLGraphTexture.prototype.onResourceRenamed = function(\n\t\told_name,\n\t\tnew_name\n\t) {\n\t\tif (this.properties.name == old_name) {\n\t\t\tthis.properties.name = new_name;\n\t\t}\n\t};\n\n\tLGraphTexture.prototype.onDrawBackground = function(ctx) {\n\t\tif (this.flags.collapsed || this.size[1] <= 20) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._drop_texture && ctx.webgl) {\n\t\t\tctx.drawImage(\n\t\t\t\tthis._drop_texture,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tthis.size[0],\n\t\t\t\tthis.size[1]\n\t\t\t);\n\t\t\t//this._drop_texture.renderQuad(this.pos[0],this.pos[1],this.size[0],this.size[1]);\n\t\t\treturn;\n\t\t}\n\n\t\t//Different texture? then get it from the GPU\n\t\tif (this._last_preview_tex != this._last_tex) {\n\t\t\tif (ctx.webgl) {\n\t\t\t\tthis._canvas = this._last_tex;\n\t\t\t} else {\n\t\t\t\tvar tex_canvas = LGraphTexture.generateLowResTexturePreview(\n\t\t\t\t\tthis._last_tex\n\t\t\t\t);\n\t\t\t\tif (!tex_canvas) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis._last_preview_tex = this._last_tex;\n\t\t\t\tthis._canvas = cloneCanvas(tex_canvas);\n\t\t\t}\n\t\t}\n\n\t\tif (!this._canvas) {\n\t\t\treturn;\n\t\t}\n\n\t\t//render to graph canvas\n\t\tctx.save();\n\t\tif (!ctx.webgl) {\n\t\t\t//reverse image\n\t\t\tctx.translate(0, this.size[1]);\n\t\t\tctx.scale(1, -1);\n\t\t}\n\t\tctx.drawImage(this._canvas, 0, 0, this.size[0], this.size[1]);\n\t\tctx.restore();\n\t};\n\n\t//very slow, used at your own risk\n\tLGraphTexture.generateLowResTexturePreview = function(tex) {\n\t\tif (!tex) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar size = LGraphTexture.image_preview_size;\n\t\tvar temp_tex = tex;\n\n\t\tif (tex.format == gl.DEPTH_COMPONENT) {\n\t\t\treturn null;\n\t\t} //cannot generate from depth\n\n\t\t//Generate low-level version in the GPU to speed up\n\t\tif (tex.width > size || tex.height > size) {\n\t\t\ttemp_tex = this._preview_temp_tex;\n\t\t\tif (!this._preview_temp_tex) {\n\t\t\t\ttemp_tex = new GL.Texture(size, size, {\n\t\t\t\t\tminFilter: gl.NEAREST\n\t\t\t\t});\n\t\t\t\tthis._preview_temp_tex = temp_tex;\n\t\t\t}\n\n\t\t\t//copy\n\t\t\ttex.copyTo(temp_tex);\n\t\t\ttex = temp_tex;\n\t\t}\n\n\t\t//create intermediate canvas with lowquality version\n\t\tvar tex_canvas = this._preview_canvas;\n\t\tif (!tex_canvas) {\n\t\t\ttex_canvas = createCanvas(size, size);\n\t\t\tthis._preview_canvas = tex_canvas;\n\t\t}\n\n\t\tif (temp_tex) {\n\t\t\ttemp_tex.toCanvas(tex_canvas);\n\t\t}\n\t\treturn tex_canvas;\n\t};\n\n\tLGraphTexture.prototype.getResources = function(res) {\n\t\tif(this.properties.name)\n\t\t\tres[this.properties.name] = GL.Texture;\n\t\treturn res;\n\t};\n\n\tLGraphTexture.prototype.onGetInputs = function() {\n\t\treturn [[\"in\", \"Texture\"]];\n\t};\n\n\tLGraphTexture.prototype.onGetOutputs = function() {\n\t\treturn [\n\t\t\t[\"width\", \"number\"],\n\t\t\t[\"height\", \"number\"],\n\t\t\t[\"aspect\", \"number\"]\n\t\t];\n\t};\n\n\t//used to replace shader code\n\tLGraphTexture.replaceCode = function( code, context )\n\t{\n\t\treturn code.replace(/\\{\\{[a-zA-Z0-9_]*\\}\\}/g, function(v){\n\t\t\tv = v.replace( /[\\{\\}]/g, \"\" );\n\t\t\treturn context[v] || \"\";\n\t\t});\n\t}\n\n\tLiteGraph.registerNodeType(\"texture/texture\", LGraphTexture);\n\n\t//**************************\n\tfunction LGraphTexturePreview() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.properties = { flipY: false };\n\t\tthis.size = [\n\t\t\tLGraphTexture.image_preview_size,\n\t\t\tLGraphTexture.image_preview_size\n\t\t];\n\t}\n\n\tLGraphTexturePreview.title = \"Preview\";\n\tLGraphTexturePreview.desc = \"Show a texture in the graph canvas\";\n\tLGraphTexturePreview.allow_preview = false;\n\n\tLGraphTexturePreview.prototype.onDrawBackground = function(ctx) {\n\t\tif (this.flags.collapsed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!ctx.webgl && !LGraphTexturePreview.allow_preview) {\n\t\t\treturn;\n\t\t} //not working well\n\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar tex_canvas = null;\n\n\t\tif (!tex.handle && ctx.webgl) {\n\t\t\ttex_canvas = tex;\n\t\t} else {\n\t\t\ttex_canvas = LGraphTexture.generateLowResTexturePreview(tex);\n\t\t}\n\n\t\t//render to graph canvas\n\t\tctx.save();\n\t\tif (this.properties.flipY) {\n\t\t\tctx.translate(0, this.size[1]);\n\t\t\tctx.scale(1, -1);\n\t\t}\n\t\tctx.drawImage(tex_canvas, 0, 0, this.size[0], this.size[1]);\n\t\tctx.restore();\n\t};\n\n\tLiteGraph.registerNodeType(\"texture/preview\", LGraphTexturePreview);\n\n\t//**************************************\n\n\tfunction LGraphTextureSave() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"tex\", \"Texture\");\n\t\tthis.addOutput(\"name\", \"string\");\n\t\tthis.properties = { name: \"\", generate_mipmaps: false };\n\t}\n\n\tLGraphTextureSave.title = \"Save\";\n\tLGraphTextureSave.desc = \"Save a texture in the repository\";\n\n\tLGraphTextureSave.prototype.getPreviewTexture = function()\n\t{\n\t\treturn this._texture;\n\t}\n\n\tLGraphTextureSave.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.properties.generate_mipmaps) {\n\t\t\ttex.bind(0);\n\t\t\ttex.setParameter( gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR );\n\t\t\tgl.generateMipmap(tex.texture_type);\n\t\t\ttex.unbind(0);\n\t\t}\n\n\t\tif (this.properties.name) {\n\t\t\t//for cases where we want to perform something when storing it\n\t\t\tif (LGraphTexture.storeTexture) {\n\t\t\t\tLGraphTexture.storeTexture(this.properties.name, tex);\n\t\t\t} else {\n\t\t\t\tvar container = LGraphTexture.getTexturesContainer();\n\t\t\t\tcontainer[this.properties.name] = tex;\n\t\t\t}\n\t\t}\n\n\t\tthis._texture = tex;\n\t\tthis.setOutputData(0, tex);\n\t\tthis.setOutputData(1, this.properties.name);\n\t};\n\n\tLiteGraph.registerNodeType(\"texture/save\", LGraphTextureSave);\n\n\t//****************************************************\n\n\tfunction LGraphTextureOperation() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addInput(\"TextureB\", \"Texture\");\n\t\tthis.addInput(\"value\", \"number\");\n\t\tthis.addOutput(\"Texture\", \"Texture\");\n\t\tthis.help = \"<p>pixelcode must be vec3, uvcode must be vec2, is optional</p>\\\n\t\t<p><strong>uv:</strong> tex. coords</p><p><strong>color:</strong> texture <strong>colorB:</strong> textureB</p><p><strong>time:</strong> scene time <strong>value:</strong> input value</p><p>For multiline you must type: result = ...</p>\";\n\n\t\tthis.properties = {\n\t\t\tvalue: 1,\n\t\t\tpixelcode: \"color + colorB * value\",\n\t\t\tuvcode: \"\",\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\n\t\tthis.has_error = false;\n\t}\n\n\tLGraphTextureOperation.widgets_info = {\n\t\tuvcode: { widget: \"code\" },\n\t\tpixelcode: { widget: \"code\" },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureOperation.title = \"Operation\";\n\tLGraphTextureOperation.desc = \"Texture shader operation\";\n\n\tLGraphTextureOperation.presets = {};\n\n\tLGraphTextureOperation.prototype.getExtraMenuOptions = function(\n\t\tgraphcanvas\n\t) {\n\t\tvar that = this;\n\t\tvar txt = !that.properties.show ? \"Show Texture\" : \"Hide Texture\";\n\t\treturn [\n\t\t\t{\n\t\t\t\tcontent: txt,\n\t\t\t\tcallback: function() {\n\t\t\t\t\tthat.properties.show = !that.properties.show;\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t};\n\n\tLGraphTextureOperation.prototype.onPropertyChanged = function()\n\t{\n\t\tthis.has_error = false;\n\t}\n\n\tLGraphTextureOperation.prototype.onDrawBackground = function(ctx) {\n\t\tif (\n\t\t\tthis.flags.collapsed ||\n\t\t\tthis.size[1] <= 20 ||\n\t\t\t!this.properties.show\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._tex) {\n\t\t\treturn;\n\t\t}\n\n\t\t//only works if using a webgl renderer\n\t\tif (this._tex.gl != ctx) {\n\t\t\treturn;\n\t\t}\n\n\t\t//render to graph canvas\n\t\tctx.save();\n\t\tctx.drawImage(this._tex, 0, 0, this.size[0], this.size[1]);\n\t\tctx.restore();\n\t};\n\n\tLGraphTextureOperation.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar texB = this.getInputData(1);\n\n\t\tif (!this.properties.uvcode && !this.properties.pixelcode) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar width = 512;\n\t\tvar height = 512;\n\t\tif (tex) {\n\t\t\twidth = tex.width;\n\t\t\theight = tex.height;\n\t\t} else if (texB) {\n\t\t\twidth = texB.width;\n\t\t\theight = texB.height;\n\t\t}\n\n\t\tif(!texB)\n\t\t\ttexB = GL.Texture.getWhiteTexture();\n\n\t\tvar type = LGraphTexture.getTextureType( this.properties.precision, tex );\n\n\t\tif (!tex && !this._tex) {\n\t\t\tthis._tex = new GL.Texture(width, height, { type: type, format: gl.RGBA, filter: gl.LINEAR });\n\t\t} else {\n\t\t\tthis._tex = LGraphTexture.getTargetTexture( tex || this._tex, this._tex, this.properties.precision );\n\t\t}\n\n\t\tvar uvcode = \"\";\n\t\tif (this.properties.uvcode) {\n\t\t\tuvcode = \"uv = \" + this.properties.uvcode;\n\t\t\tif (this.properties.uvcode.indexOf(\";\") != -1) {\n\t\t\t\t//there are line breaks, means multiline code\n\t\t\t\tuvcode = this.properties.uvcode;\n\t\t\t}\n\t\t}\n\n\t\tvar pixelcode = \"\";\n\t\tif (this.properties.pixelcode) {\n\t\t\tpixelcode = \"result = \" + this.properties.pixelcode;\n\t\t\tif (this.properties.pixelcode.indexOf(\";\") != -1) {\n\t\t\t\t//there are line breaks, means multiline code\n\t\t\t\tpixelcode = this.properties.pixelcode;\n\t\t\t}\n\t\t}\n\n\t\tvar shader = this._shader;\n\n\t\tif ( !this.has_error && (!shader || this._shader_code != uvcode + \"|\" + pixelcode) ) {\n\n\t\t\tvar final_pixel_code = LGraphTexture.replaceCode( LGraphTextureOperation.pixel_shader, { UV_CODE:uvcode, PIXEL_CODE:pixelcode });\n\n\t\t\ttry {\n\t\t\t\tshader = new GL.Shader( Shader.SCREEN_VERTEX_SHADER, final_pixel_code );\n\t\t\t\tthis.boxcolor = \"#00FF00\";\n\t\t\t} catch (err) {\n\t\t\t\t//console.log(\"Error compiling shader: \", err, final_pixel_code );\n\t\t\t\tGL.Shader.dumpErrorToConsole(err,Shader.SCREEN_VERTEX_SHADER, final_pixel_code);\n\t\t\t\tthis.boxcolor = \"#FF0000\";\n\t\t\t\tthis.has_error = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._shader = shader;\n\t\t\tthis._shader_code = uvcode + \"|\" + pixelcode;\n\t\t}\n\n\t\tif(!this._shader)\n\t\t\treturn;\n\n\t\tvar value = this.getInputData(2);\n\t\tif (value != null) {\n\t\t\tthis.properties.value = value;\n\t\t} else {\n\t\t\tvalue = parseFloat(this.properties.value);\n\t\t}\n\n\t\tvar time = this.graph.getTime();\n\n\t\tthis._tex.drawTo(function() {\n\t\t\tgl.disable(gl.DEPTH_TEST);\n\t\t\tgl.disable(gl.CULL_FACE);\n\t\t\tgl.disable(gl.BLEND);\n\t\t\tif (tex) {\n\t\t\t\ttex.bind(0);\n\t\t\t}\n\t\t\tif (texB) {\n\t\t\t\ttexB.bind(1);\n\t\t\t}\n\t\t\tvar mesh = Mesh.getScreenQuad();\n\t\t\tshader\n\t\t\t\t.uniforms({\n\t\t\t\t\tu_texture: 0,\n\t\t\t\t\tu_textureB: 1,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\ttexSize: [width, height,1/width,1/height],\n\t\t\t\t\ttime: time\n\t\t\t\t})\n\t\t\t\t.draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureOperation.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\t\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform vec4 texSize;\\n\\\n\t\tuniform float time;\\n\\\n\t\tuniform float value;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec2 uv = v_coord;\\n\\\n\t\t\t{{UV_CODE}};\\n\\\n\t\t\tvec4 color4 = texture2D(u_texture, uv);\\n\\\n\t\t\tvec3 color = color4.rgb;\\n\\\n\t\t\tvec4 color4B = texture2D(u_textureB, uv);\\n\\\n\t\t\tvec3 colorB = color4B.rgb;\\n\\\n\t\t\tvec3 result = color;\\n\\\n\t\t\tfloat alpha = 1.0;\\n\\\n\t\t\t{{PIXEL_CODE}};\\n\\\n\t\t\tgl_FragColor = vec4(result, alpha);\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLGraphTextureOperation.registerPreset = function ( name, code )\n\t{\n\t\tLGraphTextureOperation.presets[name] = code;\n\t}\n\n\tLGraphTextureOperation.registerPreset(\"\",\"\");\n\tLGraphTextureOperation.registerPreset(\"bypass\",\"color\");\n\tLGraphTextureOperation.registerPreset(\"add\",\"color + colorB * value\");\n\tLGraphTextureOperation.registerPreset(\"substract\",\"(color - colorB) * value\");\n\tLGraphTextureOperation.registerPreset(\"mate\",\"mix( color, colorB, color4B.a * value)\");\n\tLGraphTextureOperation.registerPreset(\"invert\",\"vec3(1.0) - color\");\n\tLGraphTextureOperation.registerPreset(\"multiply\",\"color * colorB * value\");\n\tLGraphTextureOperation.registerPreset(\"divide\",\"(color / colorB) / value\");\n\tLGraphTextureOperation.registerPreset(\"difference\",\"abs(color - colorB) * value\");\n\tLGraphTextureOperation.registerPreset(\"max\",\"max(color, colorB) * value\");\n\tLGraphTextureOperation.registerPreset(\"min\",\"min(color, colorB) * value\");\n\tLGraphTextureOperation.registerPreset(\"displace\",\"texture2D(u_texture, uv + (colorB.xy - vec2(0.5)) * value).xyz\");\n\tLGraphTextureOperation.registerPreset(\"grayscale\",\"vec3(color.x + color.y + color.z) * value / 3.0\");\n\tLGraphTextureOperation.registerPreset(\"saturation\",\"mix( vec3(color.x + color.y + color.z) / 3.0, color, value )\");\n\tLGraphTextureOperation.registerPreset(\"normalmap\",\"\\n\\\n\t\tfloat z0 = texture2D(u_texture, uv + vec2(-texSize.z, -texSize.w) ).x;\\n\\\n\t\tfloat z1 = texture2D(u_texture, uv + vec2(0.0, -texSize.w) ).x;\\n\\\n\t\tfloat z2 = texture2D(u_texture, uv + vec2(texSize.z, -texSize.w) ).x;\\n\\\n\t\tfloat z3 = texture2D(u_texture, uv + vec2(-texSize.z, 0.0) ).x;\\n\\\n\t\tfloat z4 = color.x;\\n\\\n\t\tfloat z5 = texture2D(u_texture, uv + vec2(texSize.z, 0.0) ).x;\\n\\\n\t\tfloat z6 = texture2D(u_texture, uv + vec2(-texSize.z, texSize.w) ).x;\\n\\\n\t\tfloat z7 = texture2D(u_texture, uv + vec2(0.0, texSize.w) ).x;\\n\\\n\t\tfloat z8 = texture2D(u_texture, uv + vec2(texSize.z, texSize.w) ).x;\\n\\\n\t\tvec3 normal = vec3( z2 + 2.0*z4 + z7 - z0 - 2.0*z3 - z5, z5 + 2.0*z6 + z7 -z0 - 2.0*z1 - z2, 1.0 );\\n\\\n\t\tnormal.xy *= value;\\n\\\n\t\tresult.xyz = normalize(normal) * 0.5 + vec3(0.5);\\n\\\n\t\");\n\tLGraphTextureOperation.registerPreset(\"threshold\",\"vec3(color.x > colorB.x * value ? 1.0 : 0.0,color.y > colorB.y * value ? 1.0 : 0.0,color.z > colorB.z * value ? 1.0 : 0.0)\");\n\n\t//webglstudio stuff...\n\tLGraphTextureOperation.prototype.onInspect = function(widgets)\n\t{\n\t\tvar that = this;\n\t\twidgets.addCombo(\"Presets\",\"\",{ values: Object.keys(LGraphTextureOperation.presets), callback: function(v){\n\t\t\tvar code = LGraphTextureOperation.presets[v];\n\t\t\tif(!code)\n\t\t\t\treturn;\n\t\t\tthat.setProperty(\"pixelcode\",code);\n\t\t\tthat.title = v;\n\t\t\twidgets.refresh();\n\t\t}});\n\t}\n\n\tLiteGraph.registerNodeType(\"texture/operation\", LGraphTextureOperation);\n\n\t//****************************************************\n\n\tfunction LGraphTextureShader() {\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tcode: \"\",\n\t\t\tu_value: 1,\n\t\t\tu_color: [1,1,1,1],\n\t\t\twidth: 512,\n\t\t\theight: 512,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\n\t\tthis.properties.code = LGraphTextureShader.pixel_shader;\n\t\tthis._uniforms = { u_value: 1, u_color: vec4.create(), in_texture: 0, texSize: vec4.create(), time: 0 };\n\t}\n\n\tLGraphTextureShader.title = \"Shader\";\n\tLGraphTextureShader.desc = \"Texture shader\";\n\tLGraphTextureShader.widgets_info = {\n\t\tcode: { type: \"code\", lang: \"glsl\" },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureShader.prototype.onPropertyChanged = function(\n\t\tname,\n\t\tvalue\n\t) {\n\t\tif (name != \"code\") {\n\t\t\treturn;\n\t\t}\n\n\t\tvar shader = this.getShader();\n\t\tif (!shader) {\n\t\t\treturn;\n\t\t}\n\n\t\t//update connections\n\t\tvar uniforms = shader.uniformInfo;\n\n\t\t//remove deprecated slots\n\t\tif (this.inputs) {\n\t\t\tvar already = {};\n\t\t\tfor (var i = 0; i < this.inputs.length; ++i) {\n\t\t\t\tvar info = this.getInputInfo(i);\n\t\t\t\tif (!info) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (uniforms[info.name] && !already[info.name]) {\n\t\t\t\t\talready[info.name] = true;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis.removeInput(i);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\n\t\t//update existing ones\n\t\tfor (var i in uniforms) {\n\t\t\tvar info = shader.uniformInfo[i];\n\t\t\tif (info.loc === null) {\n\t\t\t\tcontinue;\n\t\t\t} //is an attribute, not a uniform\n\t\t\tif (i == \"time\") {\n\t\t\t\t//default one\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar type = \"number\";\n\t\t\tif (this._shader.samplers[i]) {\n\t\t\t\ttype = \"texture\";\n\t\t\t} else {\n\t\t\t\tswitch (info.size) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\ttype = \"number\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\ttype = \"vec2\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\ttype = \"vec3\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\ttype = \"vec4\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 9:\n\t\t\t\t\t\ttype = \"mat3\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 16:\n\t\t\t\t\t\ttype = \"mat4\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar slot = this.findInputSlot(i);\n\t\t\tif (slot == -1) {\n\t\t\t\tthis.addInput(i, type);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar input_info = this.getInputInfo(slot);\n\t\t\tif (!input_info) {\n\t\t\t\tthis.addInput(i, type);\n\t\t\t} else {\n\t\t\t\tif (input_info.type == type) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis.removeInput(slot, type);\n\t\t\t\tthis.addInput(i, type);\n\t\t\t}\n\t\t}\n\t};\n\n\tLGraphTextureShader.prototype.getShader = function() {\n\t\t//replug\n\t\tif (this._shader && this._shader_code == this.properties.code) {\n\t\t\treturn this._shader;\n\t\t}\n\n\t\tthis._shader_code = this.properties.code;\n\t\tthis._shader = new GL.Shader( Shader.SCREEN_VERTEX_SHADER, this.properties.code );\n\t\tif (!this._shader) {\n\t\t\tthis.boxcolor = \"red\";\n\t\t\treturn null;\n\t\t} else {\n\t\t\tthis.boxcolor = \"green\";\n\t\t}\n\t\treturn this._shader;\n\t};\n\n\tLGraphTextureShader.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar shader = this.getShader();\n\t\tif (!shader) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar tex_slot = 0;\n\t\tvar in_tex = null;\n\n\t\t//set uniforms\n\t\tif(this.inputs)\n\t\tfor (var i = 0; i < this.inputs.length; ++i) {\n\t\t\tvar info = this.getInputInfo(i);\n\t\t\tvar data = this.getInputData(i);\n\t\t\tif (data == null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (data.constructor === GL.Texture) {\n\t\t\t\tdata.bind(tex_slot);\n\t\t\t\tif (!in_tex) {\n\t\t\t\t\tin_tex = data;\n\t\t\t\t}\n\t\t\t\tdata = tex_slot;\n\t\t\t\ttex_slot++;\n\t\t\t}\n\t\t\tshader.setUniform(info.name, data); //data is tex_slot\n\t\t}\n\n\t\tvar uniforms = this._uniforms;\n\t\tvar type = LGraphTexture.getTextureType( this.properties.precision, in_tex );\n\n\t\t//render to texture\n\t\tvar w = this.properties.width | 0;\n\t\tvar h = this.properties.height | 0;\n\t\tif (w == 0) {\n\t\t\tw = in_tex ? in_tex.width : gl.canvas.width;\n\t\t}\n\t\tif (h == 0) {\n\t\t\th = in_tex ? in_tex.height : gl.canvas.height;\n\t\t}\n\t\tuniforms.texSize[0] = w;\n\t\tuniforms.texSize[1] = h;\n\t\tuniforms.texSize[2] = 1/w;\n\t\tuniforms.texSize[3] = 1/h;\n\t\tuniforms.time = this.graph.getTime();\n\t\tuniforms.u_value = this.properties.u_value;\n\t\tuniforms.u_color.set( this.properties.u_color );\n\n\t\tif ( !this._tex || this._tex.type != type ||  this._tex.width != w || this._tex.height != h ) {\n\t\t\tthis._tex = new GL.Texture(w, h, {  type: type, format: gl.RGBA, filter: gl.LINEAR });\n\t\t}\n\t\tvar tex = this._tex;\n\t\ttex.drawTo(function() {\n\t\t\tshader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad());\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureShader.pixel_shader =\n\"precision highp float;\\n\\\n\\n\\\nvarying vec2 v_coord;\\n\\\nuniform float time; //time in seconds\\n\\\nuniform vec4 texSize; //tex resolution\\n\\\nuniform float u_value;\\n\\\nuniform vec4 u_color;\\n\\n\\\nvoid main() {\\n\\\n\tvec2 uv = v_coord;\\n\\\n\tvec3 color = vec3(0.0);\\n\\\n\t//your code here\\n\\\n\tcolor.xy=uv;\\n\\n\\\n\tgl_FragColor = vec4(color, 1.0);\\n\\\n}\\n\\\n\";\n\n\tLiteGraph.registerNodeType(\"texture/shader\", LGraphTextureShader);\n\n\t// Texture Scale Offset\n\n\tfunction LGraphTextureScaleOffset() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addInput(\"scale\", \"vec2\");\n\t\tthis.addInput(\"offset\", \"vec2\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\toffset: vec2.fromValues(0, 0),\n\t\t\tscale: vec2.fromValues(1, 1),\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t}\n\n\tLGraphTextureScaleOffset.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureScaleOffset.title = \"Scale/Offset\";\n\tLGraphTextureScaleOffset.desc = \"Applies an scaling and offseting\";\n\n\tLGraphTextureScaleOffset.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\n\t\tif (!this.isOutputConnected(0) || !tex) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar width = tex.width;\n\t\tvar height = tex.height;\n\t\tvar type =  this.precision === LGraphTexture.LOW ? gl.UNSIGNED_BYTE : gl.HIGH_PRECISION_FORMAT;\n\t\tif (this.precision === LGraphTexture.DEFAULT) {\n\t\t\ttype = tex.type;\n\t\t}\n\n\t\tif (\n\t\t\t!this._tex ||\n\t\t\tthis._tex.width != width ||\n\t\t\tthis._tex.height != height ||\n\t\t\tthis._tex.type != type\n\t\t) {\n\t\t\tthis._tex = new GL.Texture(width, height, {\n\t\t\t\ttype: type,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tvar shader = this._shader;\n\n\t\tif (!shader) {\n\t\t\tshader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureScaleOffset.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tvar scale = this.getInputData(1);\n\t\tif (scale) {\n\t\t\tthis.properties.scale[0] = scale[0];\n\t\t\tthis.properties.scale[1] = scale[1];\n\t\t} else {\n\t\t\tscale = this.properties.scale;\n\t\t}\n\n\t\tvar offset = this.getInputData(2);\n\t\tif (offset) {\n\t\t\tthis.properties.offset[0] = offset[0];\n\t\t\tthis.properties.offset[1] = offset[1];\n\t\t} else {\n\t\t\toffset = this.properties.offset;\n\t\t}\n\n\t\tthis._tex.drawTo(function() {\n\t\t\tgl.disable(gl.DEPTH_TEST);\n\t\t\tgl.disable(gl.CULL_FACE);\n\t\t\tgl.disable(gl.BLEND);\n\t\t\ttex.bind(0);\n\t\t\tvar mesh = Mesh.getScreenQuad();\n\t\t\tshader\n\t\t\t\t.uniforms({\n\t\t\t\t\tu_texture: 0,\n\t\t\t\t\tu_scale: scale,\n\t\t\t\t\tu_offset: offset\n\t\t\t\t})\n\t\t\t\t.draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureScaleOffset.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\t\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform vec2 u_scale;\\n\\\n\t\tuniform vec2 u_offset;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec2 uv = v_coord;\\n\\\n\t\t\tuv = uv / u_scale - u_offset;\\n\\\n\t\t\tgl_FragColor = texture2D(u_texture, uv);\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\n\t\t\"texture/scaleOffset\",\n\t\tLGraphTextureScaleOffset\n\t);\n\n\t// Warp (distort a texture) *************************\n\n\tfunction LGraphTextureWarp() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addInput(\"warp\", \"Texture\");\n\t\tthis.addInput(\"factor\", \"number\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tfactor: 0.01,\n\t\t\tscale: [1,1],\n\t\t\toffset: [0,0],\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\n\t\tthis._uniforms = { \n\t\t\tu_texture: 0, \n\t\t\tu_textureB: 1, \n\t\t\tu_factor: 1, \n\t\t\tu_scale: vec2.create(),\n\t\t\tu_offset: vec2.create()\n\t\t};\n\t}\n\n\tLGraphTextureWarp.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureWarp.title = \"Warp\";\n\tLGraphTextureWarp.desc = \"Texture warp operation\";\n\n\tLGraphTextureWarp.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar texB = this.getInputData(1);\n\n\t\tvar width = 512;\n\t\tvar height = 512;\n\t\tvar type = gl.UNSIGNED_BYTE;\n\t\tif (tex) {\n\t\t\twidth = tex.width;\n\t\t\theight = tex.height;\n\t\t\ttype = tex.type;\n\t\t} else if (texB) {\n\t\t\twidth = texB.width;\n\t\t\theight = texB.height;\n\t\t\ttype = texB.type;\n\t\t}\n\n\t\tif (!tex && !this._tex) {\n\t\t\tthis._tex = new GL.Texture(width, height, {\n\t\t\t\ttype:\n\t\t\t\t\tthis.precision === LGraphTexture.LOW\n\t\t\t\t\t\t? gl.UNSIGNED_BYTE\n\t\t\t\t\t\t: gl.HIGH_PRECISION_FORMAT,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t} else {\n\t\t\tthis._tex = LGraphTexture.getTargetTexture(\n\t\t\t\ttex || this._tex,\n\t\t\t\tthis._tex,\n\t\t\t\tthis.properties.precision\n\t\t\t);\n\t\t}\n\n\t\tvar shader = this._shader;\n\n\t\tif (!shader) {\n\t\t\tshader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureWarp.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tvar factor = this.getInputData(2);\n\t\tif (factor != null) {\n\t\t\tthis.properties.factor = factor;\n\t\t} else {\n\t\t\tfactor = parseFloat(this.properties.factor);\n\t\t}\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_factor = factor;\n\t\tuniforms.u_scale.set( this.properties.scale );\n\t\tuniforms.u_offset.set( this.properties.offset );\n\n\t\tthis._tex.drawTo(function() {\n\t\t\tgl.disable(gl.DEPTH_TEST);\n\t\t\tgl.disable(gl.CULL_FACE);\n\t\t\tgl.disable(gl.BLEND);\n\t\t\tif (tex) {\n\t\t\t\ttex.bind(0);\n\t\t\t}\n\t\t\tif (texB) {\n\t\t\t\ttexB.bind(1);\n\t\t\t}\n\t\t\tvar mesh = Mesh.getScreenQuad();\n\t\t\tshader\n\t\t\t\t.uniforms( uniforms )\n\t\t\t\t.draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureWarp.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\t\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform float u_factor;\\n\\\n\t\tuniform vec2 u_scale;\\n\\\n\t\tuniform vec2 u_offset;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec2 uv = v_coord;\\n\\\n\t\t\tuv += ( texture2D(u_textureB, uv).rg - vec2(0.5)) * u_factor * u_scale + u_offset;\\n\\\n\t\t\tgl_FragColor = texture2D(u_texture, uv);\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\"texture/warp\", LGraphTextureWarp);\n\n\t//****************************************************\n\n\t// Texture to Viewport *****************************************\n\tfunction LGraphTextureToViewport() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tadditive: false,\n\t\t\tantialiasing: false,\n\t\t\tfilter: true,\n\t\t\tdisable_alpha: false,\n\t\t\tgamma: 1.0,\n\t\t\tviewport: [0,0,1,1]\n\t\t};\n\t\tthis.size[0] = 130;\n\t}\n\n\tLGraphTextureToViewport.title = \"to Viewport\";\n\tLGraphTextureToViewport.desc = \"Texture to viewport\";\n\n\tLGraphTextureToViewport._prev_viewport = new Float32Array(4);\n\n\tLGraphTextureToViewport.prototype.onDrawBackground = function( ctx )\n\t{\n\t\tif ( this.flags.collapsed || this.size[1] <= 40 )\n\t\t\treturn;\n\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tctx.drawImage( ctx == gl ? tex : gl.canvas, 10,30, this.size[0] -20, this.size[1] -40);\n\t}\n\n\tLGraphTextureToViewport.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.properties.disable_alpha) {\n\t\t\tgl.disable(gl.BLEND);\n\t\t} else {\n\t\t\tgl.enable(gl.BLEND);\n\t\t\tif (this.properties.additive) {\n\t\t\t\tgl.blendFunc(gl.SRC_ALPHA, gl.ONE);\n\t\t\t} else {\n\t\t\t\tgl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\t\t\t}\n\t\t}\n\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\tvar gamma = this.properties.gamma || 1.0;\n\t\tif (this.isInputConnected(1)) {\n\t\t\tgamma = this.getInputData(1);\n\t\t}\n\n\t\ttex.setParameter(\n\t\t\tgl.TEXTURE_MAG_FILTER,\n\t\t\tthis.properties.filter ? gl.LINEAR : gl.NEAREST\n\t\t);\n\n\t\tvar old_viewport = LGraphTextureToViewport._prev_viewport;\n\t\told_viewport.set( gl.viewport_data );\n\t\tvar new_view = this.properties.viewport;\n\t\tgl.viewport( old_viewport[0] + old_viewport[2] * new_view[0], old_viewport[1] + old_viewport[3] * new_view[1], old_viewport[2] * new_view[2], old_viewport[3] * new_view[3] );\n\t\tvar viewport = gl.getViewport(); //gl.getParameter(gl.VIEWPORT);\n\n\t\tif (this.properties.antialiasing) {\n\t\t\tif (!LGraphTextureToViewport._shader) {\n\t\t\t\tLGraphTextureToViewport._shader = new GL.Shader(\n\t\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\tLGraphTextureToViewport.aa_pixel_shader\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tvar mesh = Mesh.getScreenQuad();\n\t\t\ttex.bind(0);\n\t\t\tLGraphTextureToViewport._shader\n\t\t\t\t.uniforms({\n\t\t\t\t\tu_texture: 0,\n\t\t\t\t\tuViewportSize: [tex.width, tex.height],\n\t\t\t\t\tu_igamma: 1 / gamma,\n\t\t\t\t\tinverseVP: [1 / tex.width, 1 / tex.height]\n\t\t\t\t})\n\t\t\t\t.draw(mesh);\n\t\t} else {\n\t\t\tif (gamma != 1.0) {\n\t\t\t\tif (!LGraphTextureToViewport._gamma_shader) {\n\t\t\t\t\tLGraphTextureToViewport._gamma_shader = new GL.Shader(\n\t\t\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\t\tLGraphTextureToViewport.gamma_pixel_shader\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\ttex.toViewport(LGraphTextureToViewport._gamma_shader, {\n\t\t\t\t\tu_texture: 0,\n\t\t\t\t\tu_igamma: 1 / gamma\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\ttex.toViewport();\n\t\t\t}\n\t\t}\n\n\t\tgl.viewport( old_viewport[0], old_viewport[1], old_viewport[2], old_viewport[3] );\n\t};\n\n\tLGraphTextureToViewport.prototype.onGetInputs = function() {\n\t\treturn [[\"gamma\", \"number\"]];\n\t};\n\n\tLGraphTextureToViewport.aa_pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec2 uViewportSize;\\n\\\n\t\tuniform vec2 inverseVP;\\n\\\n\t\tuniform float u_igamma;\\n\\\n\t\t#define FXAA_REDUCE_MIN   (1.0/ 128.0)\\n\\\n\t\t#define FXAA_REDUCE_MUL   (1.0 / 8.0)\\n\\\n\t\t#define FXAA_SPAN_MAX     8.0\\n\\\n\t\t\\n\\\n\t\t/* from mitsuhiko/webgl-meincraft based on the code on geeks3d.com */\\n\\\n\t\tvec4 applyFXAA(sampler2D tex, vec2 fragCoord)\\n\\\n\t\t{\\n\\\n\t\t\tvec4 color = vec4(0.0);\\n\\\n\t\t\t/*vec2 inverseVP = vec2(1.0 / uViewportSize.x, 1.0 / uViewportSize.y);*/\\n\\\n\t\t\tvec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;\\n\\\n\t\t\tvec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;\\n\\\n\t\t\tvec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;\\n\\\n\t\t\tvec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;\\n\\\n\t\t\tvec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;\\n\\\n\t\t\tvec3 luma = vec3(0.299, 0.587, 0.114);\\n\\\n\t\t\tfloat lumaNW = dot(rgbNW, luma);\\n\\\n\t\t\tfloat lumaNE = dot(rgbNE, luma);\\n\\\n\t\t\tfloat lumaSW = dot(rgbSW, luma);\\n\\\n\t\t\tfloat lumaSE = dot(rgbSE, luma);\\n\\\n\t\t\tfloat lumaM  = dot(rgbM,  luma);\\n\\\n\t\t\tfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\\n\\\n\t\t\tfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\\n\\\n\t\t\t\\n\\\n\t\t\tvec2 dir;\\n\\\n\t\t\tdir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\\n\\\n\t\t\tdir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\\n\\\n\t\t\t\\n\\\n\t\t\tfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\\n\\\n\t\t\t\\n\\\n\t\t\tfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\\n\\\n\t\t\tdir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * inverseVP;\\n\\\n\t\t\t\\n\\\n\t\t\tvec3 rgbA = 0.5 * (texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz + \\n\\\n\t\t\t\ttexture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\\n\\\n\t\t\tvec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz + \\n\\\n\t\t\t\ttexture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\\n\\\n\t\t\t\\n\\\n\t\t\t//return vec4(rgbA,1.0);\\n\\\n\t\t\tfloat lumaB = dot(rgbB, luma);\\n\\\n\t\t\tif ((lumaB < lumaMin) || (lumaB > lumaMax))\\n\\\n\t\t\t\tcolor = vec4(rgbA, 1.0);\\n\\\n\t\t\telse\\n\\\n\t\t\t\tcolor = vec4(rgbB, 1.0);\\n\\\n\t\t\tif(u_igamma != 1.0)\\n\\\n\t\t\t\tcolor.xyz = pow( color.xyz, vec3(u_igamma) );\\n\\\n\t\t\treturn color;\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t   gl_FragColor = applyFXAA( u_texture, v_coord * uViewportSize) ;\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLGraphTextureToViewport.gamma_pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform float u_igamma;\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = texture2D( u_texture, v_coord);\\n\\\n\t\t\tcolor.xyz = pow(color.xyz, vec3(u_igamma) );\\n\\\n\t\t   gl_FragColor = color;\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\n\t\t\"texture/toviewport\",\n\t\tLGraphTextureToViewport\n\t);\n\n\t// Texture Copy *****************************************\n\tfunction LGraphTextureCopy() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tsize: 0,\n\t\t\tgenerate_mipmaps: false,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t}\n\n\tLGraphTextureCopy.title = \"Copy\";\n\tLGraphTextureCopy.desc = \"Copy Texture\";\n\tLGraphTextureCopy.widgets_info = {\n\t\tsize: {\n\t\t\twidget: \"combo\",\n\t\t\tvalues: [0, 32, 64, 128, 256, 512, 1024, 2048]\n\t\t},\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureCopy.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex && !this._temp_texture) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\t//copy the texture\n\t\tif (tex) {\n\t\t\tvar width = tex.width;\n\t\t\tvar height = tex.height;\n\n\t\t\tif (this.properties.size != 0) {\n\t\t\t\twidth = this.properties.size;\n\t\t\t\theight = this.properties.size;\n\t\t\t}\n\n\t\t\tvar temp = this._temp_texture;\n\n\t\t\tvar type = tex.type;\n\t\t\tif (this.properties.precision === LGraphTexture.LOW) {\n\t\t\t\ttype = gl.UNSIGNED_BYTE;\n\t\t\t} else if (this.properties.precision === LGraphTexture.HIGH) {\n\t\t\t\ttype = gl.HIGH_PRECISION_FORMAT;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!temp ||\n\t\t\t\ttemp.width != width ||\n\t\t\t\ttemp.height != height ||\n\t\t\t\ttemp.type != type\n\t\t\t) {\n\t\t\t\tvar minFilter = gl.LINEAR;\n\t\t\t\tif (\n\t\t\t\t\tthis.properties.generate_mipmaps &&\n\t\t\t\t\tisPowerOfTwo(width) &&\n\t\t\t\t\tisPowerOfTwo(height)\n\t\t\t\t) {\n\t\t\t\t\tminFilter = gl.LINEAR_MIPMAP_LINEAR;\n\t\t\t\t}\n\t\t\t\tthis._temp_texture = new GL.Texture(width, height, {\n\t\t\t\t\ttype: type,\n\t\t\t\t\tformat: gl.RGBA,\n\t\t\t\t\tminFilter: minFilter,\n\t\t\t\t\tmagFilter: gl.LINEAR\n\t\t\t\t});\n\t\t\t}\n\t\t\ttex.copyTo(this._temp_texture);\n\n\t\t\tif (this.properties.generate_mipmaps) {\n\t\t\t\tthis._temp_texture.bind(0);\n\t\t\t\tgl.generateMipmap(this._temp_texture.texture_type);\n\t\t\t\tthis._temp_texture.unbind(0);\n\t\t\t}\n\t\t}\n\n\t\tthis.setOutputData(0, this._temp_texture);\n\t};\n\n\tLiteGraph.registerNodeType(\"texture/copy\", LGraphTextureCopy);\n\n\t// Texture Downsample *****************************************\n\tfunction LGraphTextureDownsample() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"\", \"Texture\");\n\t\tthis.properties = {\n\t\t\titerations: 1,\n\t\t\tgenerate_mipmaps: false,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t}\n\n\tLGraphTextureDownsample.title = \"Downsample\";\n\tLGraphTextureDownsample.desc = \"Downsample Texture\";\n\tLGraphTextureDownsample.widgets_info = {\n\t\titerations: { type: \"number\", step: 1, precision: 0, min: 0 },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureDownsample.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex && !this._temp_texture) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\t//we do not allow any texture different than texture 2D\n\t\tif (!tex || tex.texture_type !== GL.TEXTURE_2D) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.properties.iterations < 1) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar shader = LGraphTextureDownsample._shader;\n\t\tif (!shader) {\n\t\t\tLGraphTextureDownsample._shader = shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureDownsample.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tvar width = tex.width | 0;\n\t\tvar height = tex.height | 0;\n\t\tvar type = tex.type;\n\t\tif (this.properties.precision === LGraphTexture.LOW) {\n\t\t\ttype = gl.UNSIGNED_BYTE;\n\t\t} else if (this.properties.precision === LGraphTexture.HIGH) {\n\t\t\ttype = gl.HIGH_PRECISION_FORMAT;\n\t\t}\n\t\tvar iterations = this.properties.iterations || 1;\n\n\t\tvar origin = tex;\n\t\tvar target = null;\n\n\t\tvar temp = [];\n\t\tvar options = {\n\t\t\ttype: type,\n\t\t\tformat: tex.format\n\t\t};\n\n\t\tvar offset = vec2.create();\n\t\tvar uniforms = {\n\t\t\tu_offset: offset\n\t\t};\n\n\t\tif (this._texture) {\n\t\t\tGL.Texture.releaseTemporary(this._texture);\n\t\t}\n\n\t\tfor (var i = 0; i < iterations; ++i) {\n\t\t\toffset[0] = 1 / width;\n\t\t\toffset[1] = 1 / height;\n\t\t\twidth = width >> 1 || 0;\n\t\t\theight = height >> 1 || 0;\n\t\t\ttarget = GL.Texture.getTemporary(width, height, options);\n\t\t\ttemp.push(target);\n\t\t\torigin.setParameter(GL.TEXTURE_MAG_FILTER, GL.NEAREST);\n\t\t\torigin.copyTo(target, shader, uniforms);\n\t\t\tif (width == 1 && height == 1) {\n\t\t\t\tbreak;\n\t\t\t} //nothing else to do\n\t\t\torigin = target;\n\t\t}\n\n\t\t//keep the last texture used\n\t\tthis._texture = temp.pop();\n\n\t\t//free the rest\n\t\tfor (var i = 0; i < temp.length; ++i) {\n\t\t\tGL.Texture.releaseTemporary(temp[i]);\n\t\t}\n\n\t\tif (this.properties.generate_mipmaps) {\n\t\t\tthis._texture.bind(0);\n\t\t\tgl.generateMipmap(this._texture.texture_type);\n\t\t\tthis._texture.unbind(0);\n\t\t}\n\n\t\tthis.setOutputData(0, this._texture);\n\t};\n\n\tLGraphTextureDownsample.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec2 u_offset;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = texture2D(u_texture, v_coord );\\n\\\n\t\t\tcolor += texture2D(u_texture, v_coord + vec2( u_offset.x, 0.0 ) );\\n\\\n\t\t\tcolor += texture2D(u_texture, v_coord + vec2( 0.0, u_offset.y ) );\\n\\\n\t\t\tcolor += texture2D(u_texture, v_coord + vec2( u_offset.x, u_offset.y ) );\\n\\\n\t\t   gl_FragColor = color * 0.25;\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\n\t\t\"texture/downsample\",\n\t\tLGraphTextureDownsample\n\t);\n\n\n\n\tfunction LGraphTextureResize() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tsize: [512,512],\n\t\t\tgenerate_mipmaps: false,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t}\n\n\tLGraphTextureResize.title = \"Resize\";\n\tLGraphTextureResize.desc = \"Resize Texture\";\n\tLGraphTextureResize.widgets_info = {\n\t\titerations: { type: \"number\", step: 1, precision: 0, min: 0 },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureResize.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex && !this._temp_texture) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\t//we do not allow any texture different than texture 2D\n\t\tif (!tex || tex.texture_type !== GL.TEXTURE_2D) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar width = this.properties.size[0] | 0;\n\t\tvar height = this.properties.size[1] | 0;\n\t\tif(width == 0)\n\t\t\twidth = tex.width;\n\t\tif(height == 0)\n\t\t\theight = tex.height;\n\t\tvar type = tex.type;\n\t\tif (this.properties.precision === LGraphTexture.LOW) {\n\t\t\ttype = gl.UNSIGNED_BYTE;\n\t\t} else if (this.properties.precision === LGraphTexture.HIGH) {\n\t\t\ttype = gl.HIGH_PRECISION_FORMAT;\n\t\t}\n\n\t\tif( !this._texture || this._texture.width != width || this._texture.height != height || this._texture.type != type )\n\t\t\tthis._texture = new GL.Texture( width, height, { type: type } );\n\n\t\ttex.copyTo( this._texture );\n\n\t\tif (this.properties.generate_mipmaps) {\n\t\t\tthis._texture.bind(0);\n\t\t\tgl.generateMipmap(this._texture.texture_type);\n\t\t\tthis._texture.unbind(0);\n\t\t}\n\n\t\tthis.setOutputData(0, this._texture);\n\t};\n\n\tLiteGraph.registerNodeType( \"texture/resize\", LGraphTextureResize );\n\n\t// Texture Average  *****************************************\n\tfunction LGraphTextureAverage() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"tex\", \"Texture\");\n\t\tthis.addOutput(\"avg\", \"vec4\");\n\t\tthis.addOutput(\"lum\", \"number\");\n\t\tthis.properties = {\n\t\t\tuse_previous_frame: true, //to avoid stalls \n\t\t\thigh_quality: false //to use as much pixels as possible\n\t\t};\n\n\t\tthis._uniforms = {\n\t\t\tu_texture: 0,\n\t\t\tu_mipmap_offset: 0\n\t\t};\n\t\tthis._luminance = new Float32Array(4);\n\t}\n\n\tLGraphTextureAverage.title = \"Average\";\n\tLGraphTextureAverage.desc =\n\t\t\"Compute a partial average (32 random samples) of a texture and stores it as a 1x1 pixel texture.\\n If high_quality is true, then it generates the mipmaps first and reads from the lower one.\";\n\n\tLGraphTextureAverage.prototype.onExecute = function() {\n\t\tif (!this.properties.use_previous_frame) {\n\t\t\tthis.updateAverage();\n\t\t}\n\n\t\tvar v = this._luminance;\n\t\tthis.setOutputData(0, this._temp_texture);\n\t\tthis.setOutputData(1, v);\n\t\tthis.setOutputData(2, (v[0] + v[1] + v[2]) / 3);\n\t};\n\n\t//executed before rendering the frame\n\tLGraphTextureAverage.prototype.onPreRenderExecute = function() {\n\t\tthis.updateAverage();\n\t};\n\n\tLGraphTextureAverage.prototype.updateAverage = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!this.isOutputConnected(0) &&\n\t\t\t!this.isOutputConnected(1) &&\n\t\t\t!this.isOutputConnected(2)\n\t\t) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (!LGraphTextureAverage._shader) {\n\t\t\tLGraphTextureAverage._shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureAverage.pixel_shader\n\t\t\t);\n\t\t\t//creates 256 random numbers and stores them in two mat4\n\t\t\tvar samples = new Float32Array(16);\n\t\t\tfor (var i = 0; i < samples.length; ++i) {\n\t\t\t\tsamples[i] = Math.random(); //poorly distributed samples\n\t\t\t}\n\t\t\t//upload only once\n\t\t\tLGraphTextureAverage._shader.uniforms({\n\t\t\t\tu_samples_a: samples.subarray(0, 16),\n\t\t\t\tu_samples_b: samples.subarray(16, 32)\n\t\t\t});\n\t\t}\n\n\t\tvar temp = this._temp_texture;\n\t\tvar type = gl.UNSIGNED_BYTE;\n\t\tif (tex.type != type) {\n\t\t\t//force floats, half floats cannot be read with gl.readPixels\n\t\t\ttype = gl.FLOAT;\n\t\t}\n\n\t\tif (!temp || temp.type != type) {\n\t\t\tthis._temp_texture = new GL.Texture(1, 1, {\n\t\t\t\ttype: type,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.NEAREST\n\t\t\t});\n\t\t}\n\n\t\tthis._uniforms.u_mipmap_offset = 0;\n\n\t\tif(this.properties.high_quality)\n\t\t{\n\t\t\tif( !this._temp_pot2_texture || this._temp_pot2_texture.type != type )\n\t\t\t\tthis._temp_pot2_texture = new GL.Texture(512, 512, {\n\t\t\t\t\ttype: type,\n\t\t\t\t\tformat: gl.RGBA,\n\t\t\t\t\tminFilter: gl.LINEAR_MIPMAP_LINEAR,\n\t\t\t\t\tmagFilter: gl.LINEAR\n\t\t\t\t});\n\n\t\t\ttex.copyTo( this._temp_pot2_texture );\n\t\t\ttex = this._temp_pot2_texture;\n\t\t\ttex.bind(0);\n\t\t\tgl.generateMipmap(GL.TEXTURE_2D);\n\t\t\tthis._uniforms.u_mipmap_offset = 9;\n\t\t}\n\n\t\tvar shader = LGraphTextureAverage._shader;\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_mipmap_offset = this.properties.mipmap_offset;\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\tgl.disable(gl.BLEND);\n\t\tthis._temp_texture.drawTo(function() {\n\t\t\ttex.toViewport(shader, uniforms);\n\t\t});\n\n\t\tif (this.isOutputConnected(1) || this.isOutputConnected(2)) {\n\t\t\tvar pixel = this._temp_texture.getPixels();\n\t\t\tif (pixel) {\n\t\t\t\tvar v = this._luminance;\n\t\t\t\tvar type = this._temp_texture.type;\n\t\t\t\tv.set(pixel);\n\t\t\t\tif (type == gl.UNSIGNED_BYTE) {\n\t\t\t\t\tvec4.scale(v, v, 1 / 255);\n\t\t\t\t} else if (\n\t\t\t\t\ttype == GL.HALF_FLOAT ||\n\t\t\t\t\ttype == GL.HALF_FLOAT_OES\n\t\t\t\t) {\n\t\t\t\t\t//no half floats possible, hard to read back unless copyed to a FLOAT texture, so temp_texture is always forced to FLOAT\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tLGraphTextureAverage.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tuniform mat4 u_samples_a;\\n\\\n\t\tuniform mat4 u_samples_b;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform float u_mipmap_offset;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = vec4(0.0);\\n\\\n\t\t\t//random average\\n\\\n\t\t\tfor(int i = 0; i < 4; ++i)\\n\\\n\t\t\t\tfor(int j = 0; j < 4; ++j)\\n\\\n\t\t\t\t{\\n\\\n\t\t\t\t\tcolor += texture2D(u_texture, vec2( u_samples_a[i][j], u_samples_b[i][j] ), u_mipmap_offset );\\n\\\n\t\t\t\t\tcolor += texture2D(u_texture, vec2( 1.0 - u_samples_a[i][j], 1.0 - u_samples_b[i][j] ), u_mipmap_offset );\\n\\\n\t\t\t\t}\\n\\\n\t\t   gl_FragColor = color * 0.03125;\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\"texture/average\", LGraphTextureAverage);\n\n\n\n\t// Computes operation between pixels (max, min)  *****************************************\n\tfunction LGraphTextureMinMax() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"min_t\", \"Texture\");\n\t\tthis.addOutput(\"max_t\", \"Texture\");\n\t\tthis.addOutput(\"min\", \"vec4\");\n\t\tthis.addOutput(\"max\", \"vec4\");\n\t\tthis.properties = {\n\t\t\tmode: \"max\",\n\t\t\tuse_previous_frame: true //to avoid stalls \n\t\t};\n\n\t\tthis._uniforms = {\n\t\t\tu_texture: 0\n\t\t};\n\n\t\tthis._max = new Float32Array(4);\n\t\tthis._min = new Float32Array(4);\n\n\t\tthis._textures_chain = [];\n\t}\n\n\tLGraphTextureMinMax.widgets_info = {\n\t\tmode: { widget: \"combo\", values: [\"min\",\"max\",\"avg\"] }\n\t};\n\n\tLGraphTextureMinMax.title = \"MinMax\";\n\tLGraphTextureMinMax.desc = \"Compute the scene min max\";\n\n\tLGraphTextureMinMax.prototype.onExecute = function() {\n\t\tif (!this.properties.use_previous_frame) {\n\t\t\tthis.update();\n\t\t}\n\n\t\tthis.setOutputData(0, this._temp_texture);\n\t\tthis.setOutputData(1, this._luminance);\n\t};\n\n\t//executed before rendering the frame\n\tLGraphTextureMinMax.prototype.onPreRenderExecute = function() {\n\t\tthis.update();\n\t};\n\n\tLGraphTextureMinMax.prototype.update = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( !this.isOutputConnected(0) && !this.isOutputConnected(1) ) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (!LGraphTextureMinMax._shader) {\n\t\t\tLGraphTextureMinMax._shader = new GL.Shader( GL.Shader.SCREEN_VERTEX_SHADER, LGraphTextureMinMax.pixel_shader );\n\t\t}\n\n\t\tvar temp = this._temp_texture;\n\t\tvar type = gl.UNSIGNED_BYTE;\n\t\tif (tex.type != type) {\n\t\t\t//force floats, half floats cannot be read with gl.readPixels\n\t\t\ttype = gl.FLOAT;\n\t\t}\n\n\t\tvar size = 512;\n\n\t\tif( !this._textures_chain.length || this._textures_chain[0].type != type )\n\t\t{\n\t\t\tvar index = 0;\n\t\t\twhile(i)\n\t\t\t{\n\t\t\t\tthis._textures_chain[i] = new GL.Texture( size, size, {\n\t\t\t\t\ttype: type,\n\t\t\t\t\tformat: gl.RGBA,\n\t\t\t\t\tfilter: gl.NEAREST\n\t\t\t\t});\n\t\t\t\tsize = size >> 2;\n\t\t\t\ti++;\n\t\t\t\tif(size == 1)\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\ttex.copyTo( this._textures_chain[0] );\n\t\tvar prev = this._textures_chain[0];\n\t\tfor(var i = 1; i <= this._textures_chain.length; ++i)\n\t\t{\n\t\t\tvar tex = this._textures_chain[i];\n\n\t\t\tprev = tex;\t\t\t\t\n\t\t}\n\n\t\tvar shader = LGraphTextureMinMax._shader;\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_mipmap_offset = this.properties.mipmap_offset;\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\tgl.disable(gl.BLEND);\n\t\tthis._temp_texture.drawTo(function() {\n\t\t\ttex.toViewport(shader, uniforms);\n\t\t});\n\t};\n\n\tLGraphTextureMinMax.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tuniform mat4 u_samples_a;\\n\\\n\t\tuniform mat4 u_samples_b;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform float u_mipmap_offset;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = vec4(0.0);\\n\\\n\t\t\t//random average\\n\\\n\t\t\tfor(int i = 0; i < 4; ++i)\\n\\\n\t\t\t\tfor(int j = 0; j < 4; ++j)\\n\\\n\t\t\t\t{\\n\\\n\t\t\t\t\tcolor += texture2D(u_texture, vec2( u_samples_a[i][j], u_samples_b[i][j] ), u_mipmap_offset );\\n\\\n\t\t\t\t\tcolor += texture2D(u_texture, vec2( 1.0 - u_samples_a[i][j], 1.0 - u_samples_b[i][j] ), u_mipmap_offset );\\n\\\n\t\t\t\t}\\n\\\n\t\t   gl_FragColor = color * 0.03125;\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\t//LiteGraph.registerNodeType(\"texture/clustered_operation\", LGraphTextureClusteredOperation);\n\n\n\tfunction LGraphTextureTemporalSmooth() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addInput(\"factor\", \"Number\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = { factor: 0.5 };\n\t\tthis._uniforms = {\n\t\t\tu_texture: 0,\n\t\t\tu_textureB: 1,\n\t\t\tu_factor: this.properties.factor\n\t\t};\n\t}\n\n\tLGraphTextureTemporalSmooth.title = \"Smooth\";\n\tLGraphTextureTemporalSmooth.desc = \"Smooth texture over time\";\n\n\tLGraphTextureTemporalSmooth.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex || !this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!LGraphTextureTemporalSmooth._shader) {\n\t\t\tLGraphTextureTemporalSmooth._shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureTemporalSmooth.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tvar temp = this._temp_texture;\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.type != tex.type ||\n\t\t\ttemp.width != tex.width ||\n\t\t\ttemp.height != tex.height\n\t\t) {\n\t\t\tvar options = {\n\t\t\t\ttype: tex.type,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.NEAREST\n\t\t\t};\n\t\t\tthis._temp_texture = new GL.Texture(tex.width, tex.height, options );\n\t\t\tthis._temp_texture2 = new GL.Texture(tex.width, tex.height, options );\n\t\t\ttex.copyTo(this._temp_texture2);\n\t\t}\n\n\t\tvar tempA = this._temp_texture;\n\t\tvar tempB = this._temp_texture2;\n\n\t\tvar shader = LGraphTextureTemporalSmooth._shader;\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_factor = 1.0 - this.getInputOrProperty(\"factor\");\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\ttempA.drawTo(function() {\n\t\t\ttempB.bind(1);\n\t\t\ttex.toViewport(shader, uniforms);\n\t\t});\n\n\t\tthis.setOutputData(0, tempA);\n\n\t\t//swap\n\t\tthis._temp_texture = tempB;\n\t\tthis._temp_texture2 = tempA;\n\t};\n\n\tLGraphTextureTemporalSmooth.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tuniform float u_factor;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tgl_FragColor = mix( texture2D( u_texture, v_coord ), texture2D( u_textureB, v_coord ), u_factor );\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType( \"texture/temporal_smooth\", LGraphTextureTemporalSmooth );\n\n\n\tfunction LGraphTextureLinearAvgSmooth() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addOutput(\"avg\", \"Texture\");\n\t\tthis.addOutput(\"array\", \"Texture\");\n\t\tthis.properties = { samples: 64, frames_interval: 1 };\n\t\tthis._uniforms = {\n\t\t\tu_texture: 0,\n\t\t\tu_textureB: 1,\n\t\t\tu_samples: this.properties.samples,\n\t\t\tu_isamples: 1/this.properties.samples\n\t\t};\n\t\tthis.frame = 0;\n\t}\n\n\tLGraphTextureLinearAvgSmooth.title = \"Lineal Avg Smooth\";\n\tLGraphTextureLinearAvgSmooth.desc = \"Smooth texture linearly over time\";\n\n\tLGraphTextureLinearAvgSmooth[\"@samples\"] = { type: \"number\", min: 1, max: 64, step: 1, precision: 1 };\n\n\tLGraphTextureLinearAvgSmooth.prototype.getPreviewTexture = function()\n\t{\n\t\treturn this._temp_texture2;\n\t}\n\n\tLGraphTextureLinearAvgSmooth.prototype.onExecute = function() {\n\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex || !this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!LGraphTextureLinearAvgSmooth._shader) {\n\t\t\tLGraphTextureLinearAvgSmooth._shader_copy = new GL.Shader( GL.Shader.SCREEN_VERTEX_SHADER, LGraphTextureLinearAvgSmooth.pixel_shader_copy );\n\t\t\tLGraphTextureLinearAvgSmooth._shader_avg = new GL.Shader( GL.Shader.SCREEN_VERTEX_SHADER, LGraphTextureLinearAvgSmooth.pixel_shader_avg );\n\t\t}\n\n\t\tvar samples = clamp(this.properties.samples,0,64);\n\t\tvar frame = this.frame;\n\t\tvar interval = this.properties.frames_interval;\n\n\t\tif( interval == 0 || frame % interval == 0 )\n\t\t{\n\t\t\tvar temp = this._temp_texture;\n\t\t\tif ( !temp || temp.type != tex.type || temp.width != samples ) {\n\t\t\t\tvar options = {\n\t\t\t\t\ttype: tex.type,\n\t\t\t\t\tformat: gl.RGBA,\n\t\t\t\t\tfilter: gl.NEAREST\n\t\t\t\t};\n\t\t\t\tthis._temp_texture = new GL.Texture( samples, 1, options );\n\t\t\t\tthis._temp_texture2 = new GL.Texture( samples, 1, options );\n\t\t\t\tthis._temp_texture_out = new GL.Texture( 1, 1, options );\n\t\t\t}\n\n\t\t\tvar tempA = this._temp_texture;\n\t\t\tvar tempB = this._temp_texture2;\n\n\t\t\tvar shader_copy = LGraphTextureLinearAvgSmooth._shader_copy;\n\t\t\tvar shader_avg = LGraphTextureLinearAvgSmooth._shader_avg;\n\t\t\tvar uniforms = this._uniforms;\n\t\t\tuniforms.u_samples = samples;\n\t\t\tuniforms.u_isamples = 1.0 / samples;\n\n\t\t\tgl.disable(gl.BLEND);\n\t\t\tgl.disable(gl.DEPTH_TEST);\n\t\t\ttempA.drawTo(function() {\n\t\t\t\ttempB.bind(1);\n\t\t\t\ttex.toViewport( shader_copy, uniforms );\n\t\t\t});\n\n\t\t\tthis._temp_texture_out.drawTo(function() {\n\t\t\t\ttempA.toViewport( shader_avg, uniforms );\n\t\t\t});\n\n\t\t\tthis.setOutputData( 0, this._temp_texture_out );\n\n\t\t\t//swap\n\t\t\tthis._temp_texture = tempB;\n\t\t\tthis._temp_texture2 = tempA;\n\t\t}\n\t\telse\n\t\t\tthis.setOutputData(0, this._temp_texture_out);\n\t\tthis.setOutputData(1, this._temp_texture2);\n\t\tthis.frame++;\n\t};\n\n\tLGraphTextureLinearAvgSmooth.pixel_shader_copy =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tuniform float u_isamples;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tif( v_coord.x <= u_isamples )\\n\\\n\t\t\t\tgl_FragColor = texture2D( u_texture, vec2(0.5) );\\n\\\n\t\t\telse\\n\\\n\t\t\t\tgl_FragColor = texture2D( u_textureB, v_coord - vec2(u_isamples,0.0) );\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLGraphTextureLinearAvgSmooth.pixel_shader_avg =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform int u_samples;\\n\\\n\t\tuniform float u_isamples;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = vec4(0.0);\\n\\\n\t\t\tfor(int i = 0; i < 64; ++i)\\n\\\n\t\t\t{\\n\\\n\t\t\t\tcolor += texture2D( u_texture, vec2( float(i)*u_isamples,0.0) );\\n\\\n\t\t\t\tif(i == (u_samples - 1))\\n\\\n\t\t\t\t\tbreak;\\n\\\n\t\t\t}\\n\\\n\t\t\tgl_FragColor = color * u_isamples;\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\n\tLiteGraph.registerNodeType( \"texture/linear_avg_smooth\", LGraphTextureLinearAvgSmooth );\n\n\t// Image To Texture *****************************************\n\tfunction LGraphImageToTexture() {\n\t\tthis.addInput(\"Image\", \"image\");\n\t\tthis.addOutput(\"\", \"Texture\");\n\t\tthis.properties = {};\n\t}\n\n\tLGraphImageToTexture.title = \"Image to Texture\";\n\tLGraphImageToTexture.desc = \"Uploads an image to the GPU\";\n\t//LGraphImageToTexture.widgets_info = { size: { widget:\"combo\", values:[0,32,64,128,256,512,1024,2048]} };\n\n\tLGraphImageToTexture.prototype.onExecute = function() {\n\t\tvar img = this.getInputData(0);\n\t\tif (!img) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar width = img.videoWidth || img.width;\n\t\tvar height = img.videoHeight || img.height;\n\n\t\t//this is in case we are using a webgl canvas already, no need to reupload it\n\t\tif (img.gltexture) {\n\t\t\tthis.setOutputData(0, img.gltexture);\n\t\t\treturn;\n\t\t}\n\n\t\tvar temp = this._temp_texture;\n\t\tif (!temp || temp.width != width || temp.height != height) {\n\t\t\tthis._temp_texture = new GL.Texture(width, height, {\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\ttry {\n\t\t\tthis._temp_texture.uploadImage(img);\n\t\t} catch (err) {\n\t\t\tconsole.error(\n\t\t\t\t\"image comes from an unsafe location, cannot be uploaded to webgl: \" +\n\t\t\t\t\terr\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setOutputData(0, this._temp_texture);\n\t};\n\n\tLiteGraph.registerNodeType(\n\t\t\"texture/imageToTexture\",\n\t\tLGraphImageToTexture\n\t);\n\n\t// Texture LUT *****************************************\n\tfunction LGraphTextureLUT() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addInput(\"LUT\", \"Texture\");\n\t\tthis.addInput(\"Intensity\", \"number\");\n\t\tthis.addOutput(\"\", \"Texture\");\n\t\tthis.properties = { enabled: true, intensity: 1, precision: LGraphTexture.DEFAULT, texture: null };\n\n\t\tif (!LGraphTextureLUT._shader) {\n\t\t\tLGraphTextureLUT._shader = new GL.Shader( Shader.SCREEN_VERTEX_SHADER, LGraphTextureLUT.pixel_shader );\n\t\t}\n\t}\n\n\tLGraphTextureLUT.widgets_info = {\n\t\ttexture: { widget: \"texture\" },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureLUT.title = \"LUT\";\n\tLGraphTextureLUT.desc = \"Apply LUT to Texture\";\n\n\tLGraphTextureLUT.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar tex = this.getInputData(0);\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH || this.properties.enabled === false) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar lut_tex = this.getInputData(1);\n\n\t\tif (!lut_tex) {\n\t\t\tlut_tex = LGraphTexture.getTexture(this.properties.texture);\n\t\t}\n\n\t\tif (!lut_tex) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tlut_tex.bind(0);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\t\tgl.texParameteri(\n\t\t\tgl.TEXTURE_2D,\n\t\t\tgl.TEXTURE_WRAP_S,\n\t\t\tgl.CLAMP_TO_EDGE\n\t\t);\n\t\tgl.texParameteri(\n\t\t\tgl.TEXTURE_2D,\n\t\t\tgl.TEXTURE_WRAP_T,\n\t\t\tgl.CLAMP_TO_EDGE\n\t\t);\n\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\n\t\tvar intensity = this.properties.intensity;\n\t\tif (this.isInputConnected(2)) {\n\t\t\tthis.properties.intensity = intensity = this.getInputData(2);\n\t\t}\n\n\t\tthis._tex = LGraphTexture.getTargetTexture(\n\t\t\ttex,\n\t\t\tthis._tex,\n\t\t\tthis.properties.precision\n\t\t);\n\n\t\t//var mesh = Mesh.getScreenQuad();\n\n\t\tthis._tex.drawTo(function() {\n\t\t\tlut_tex.bind(1);\n\t\t\ttex.toViewport(LGraphTextureLUT._shader, {\n\t\t\t\tu_texture: 0,\n\t\t\t\tu_textureB: 1,\n\t\t\t\tu_amount: intensity\n\t\t\t});\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureLUT.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tuniform float u_amount;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\t lowp vec4 textureColor = clamp( texture2D(u_texture, v_coord), vec4(0.0), vec4(1.0) );\\n\\\n\t\t\t mediump float blueColor = textureColor.b * 63.0;\\n\\\n\t\t\t mediump vec2 quad1;\\n\\\n\t\t\t quad1.y = floor(floor(blueColor) / 8.0);\\n\\\n\t\t\t quad1.x = floor(blueColor) - (quad1.y * 8.0);\\n\\\n\t\t\t mediump vec2 quad2;\\n\\\n\t\t\t quad2.y = floor(ceil(blueColor) / 8.0);\\n\\\n\t\t\t quad2.x = ceil(blueColor) - (quad2.y * 8.0);\\n\\\n\t\t\t highp vec2 texPos1;\\n\\\n\t\t\t texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\\n\\\n\t\t\t texPos1.y = 1.0 - ((quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));\\n\\\n\t\t\t highp vec2 texPos2;\\n\\\n\t\t\t texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\\n\\\n\t\t\t texPos2.y = 1.0 - ((quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));\\n\\\n\t\t\t lowp vec4 newColor1 = texture2D(u_textureB, texPos1);\\n\\\n\t\t\t lowp vec4 newColor2 = texture2D(u_textureB, texPos2);\\n\\\n\t\t\t lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\\n\\\n\t\t\t gl_FragColor = vec4( mix( textureColor.rgb, newColor.rgb, u_amount), textureColor.w);\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\"texture/LUT\", LGraphTextureLUT);\n\n\n\t// Texture LUT *****************************************\n\tfunction LGraphTextureEncode() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addInput(\"Atlas\", \"Texture\");\n\t\tthis.addOutput(\"\", \"Texture\");\n\t\tthis.properties = { enabled: true, num_row_symbols: 4, symbol_size: 16, brightness: 1, colorize: false, filter: false, invert: false, precision: LGraphTexture.DEFAULT, generate_mipmaps: false, texture: null };\n\n\t\tif (!LGraphTextureEncode._shader) {\n\t\t\tLGraphTextureEncode._shader = new GL.Shader( Shader.SCREEN_VERTEX_SHADER, LGraphTextureEncode.pixel_shader );\n\t\t}\n\n\t\tthis._uniforms = {\n\t\t\t\tu_texture: 0,\n\t\t\t\tu_textureB: 1,\n\t\t\t\tu_row_simbols: 4,\n\t\t\t\tu_simbol_size: 16,\n\t\t\t\tu_res: vec2.create()\n\t\t};\n\t}\n\n\tLGraphTextureEncode.widgets_info = {\n\t\ttexture: { widget: \"texture\" },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureEncode.title = \"Encode\";\n\tLGraphTextureEncode.desc = \"Apply a texture atlas to encode a texture\";\n\n\tLGraphTextureEncode.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar tex = this.getInputData(0);\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH || this.properties.enabled === false) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar symbols_tex = this.getInputData(1);\n\n\t\tif (!symbols_tex) {\n\t\t\tsymbols_tex = LGraphTexture.getTexture(this.properties.texture);\n\t\t}\n\n\t\tif (!symbols_tex) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tsymbols_tex.bind(0);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, this.properties.filter ? gl.LINEAR : gl.NEAREST );\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, this.properties.filter ? gl.LINEAR : gl.NEAREST );\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE );\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE );\n\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_row_simbols = Math.floor(this.properties.num_row_symbols);\n\t\tuniforms.u_symbol_size = this.properties.symbol_size;\n\t\tuniforms.u_brightness = this.properties.brightness;\n\t\tuniforms.u_invert = this.properties.invert ? 1 : 0;\n\t\tuniforms.u_colorize = this.properties.colorize ? 1 : 0;\n\n\t\tthis._tex = LGraphTexture.getTargetTexture( tex, this._tex, this.properties.precision );\n\t\tuniforms.u_res[0] = this._tex.width;\n\t\tuniforms.u_res[1] = this._tex.height;\n\t\tthis._tex.bind(0);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST );\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST );\n\n\t\tthis._tex.drawTo(function() {\n\t\t\tsymbols_tex.bind(1);\n\t\t\ttex.toViewport(LGraphTextureEncode._shader, uniforms);\n\t\t});\n\n\t\tif (this.properties.generate_mipmaps) {\n\t\t\tthis._tex.bind(0);\n\t\t\tgl.generateMipmap(this._tex.texture_type);\n\t\t\tthis._tex.unbind(0);\n\t\t}\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureEncode.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tuniform float u_row_simbols;\\n\\\n\t\tuniform float u_symbol_size;\\n\\\n\t\tuniform float u_brightness;\\n\\\n\t\tuniform float u_invert;\\n\\\n\t\tuniform float u_colorize;\\n\\\n\t\tuniform vec2 u_res;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec2 total_symbols = u_res / u_symbol_size;\\n\\\n\t\t\tvec2 uv = floor(v_coord * total_symbols) / total_symbols; //pixelate \\n\\\n\t\t\tvec2 local_uv = mod(v_coord * u_res, u_symbol_size) / u_symbol_size;\\n\\\n\t\t\tlowp vec4 textureColor = texture2D(u_texture, uv );\\n\\\n\t\t\tfloat lum = clamp(u_brightness * (textureColor.x + textureColor.y + textureColor.z)/3.0,0.0,1.0);\\n\\\n\t\t\tif( u_invert == 1.0 ) lum = 1.0 - lum;\\n\\\n\t\t\tfloat index = floor( lum * (u_row_simbols * u_row_simbols - 1.0));\\n\\\n\t\t\tfloat col = mod( index, u_row_simbols );\\n\\\n\t\t\tfloat row = u_row_simbols - floor( index / u_row_simbols ) - 1.0;\\n\\\n\t\t\tvec2 simbol_uv = ( vec2( col, row ) + local_uv ) / u_row_simbols;\\n\\\n\t\t\tvec4 color = texture2D( u_textureB, simbol_uv );\\n\\\n\t\t\tif(u_colorize == 1.0)\\n\\\n\t\t\t\tcolor *= textureColor;\\n\\\n\t\t\tgl_FragColor = color;\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\"texture/encode\", LGraphTextureEncode);\n\n\t// Texture Channels *****************************************\n\tfunction LGraphTextureChannels() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\n\t\tthis.addOutput(\"R\", \"Texture\");\n\t\tthis.addOutput(\"G\", \"Texture\");\n\t\tthis.addOutput(\"B\", \"Texture\");\n\t\tthis.addOutput(\"A\", \"Texture\");\n\n\t\t//this.properties = { use_single_channel: true };\n\t\tif (!LGraphTextureChannels._shader) {\n\t\t\tLGraphTextureChannels._shader = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureChannels.pixel_shader\n\t\t\t);\n\t\t}\n\t}\n\n\tLGraphTextureChannels.title = \"Texture to Channels\";\n\tLGraphTextureChannels.desc = \"Split texture channels\";\n\n\tLGraphTextureChannels.prototype.onExecute = function() {\n\t\tvar texA = this.getInputData(0);\n\t\tif (!texA) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._channels) {\n\t\t\tthis._channels = Array(4);\n\t\t}\n\n\t\t//var format = this.properties.use_single_channel ? gl.LUMINANCE : gl.RGBA; //not supported by WebGL1\n\t\tvar format = gl.RGB;\n\t\tvar connections = 0;\n\t\tfor (var i = 0; i < 4; i++) {\n\t\t\tif (this.isOutputConnected(i)) {\n\t\t\t\tif (\n\t\t\t\t\t!this._channels[i] ||\n\t\t\t\t\tthis._channels[i].width != texA.width ||\n\t\t\t\t\tthis._channels[i].height != texA.height ||\n\t\t\t\t\tthis._channels[i].type != texA.type ||\n\t\t\t\t\tthis._channels[i].format != format\n\t\t\t\t) {\n\t\t\t\t\tthis._channels[i] = new GL.Texture(\n\t\t\t\t\t\ttexA.width,\n\t\t\t\t\t\ttexA.height,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: texA.type,\n\t\t\t\t\t\t\tformat: format,\n\t\t\t\t\t\t\tfilter: gl.LINEAR\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tconnections++;\n\t\t\t} else {\n\t\t\t\tthis._channels[i] = null;\n\t\t\t}\n\t\t}\n\n\t\tif (!connections) {\n\t\t\treturn;\n\t\t}\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\n\t\tvar mesh = Mesh.getScreenQuad();\n\t\tvar shader = LGraphTextureChannels._shader;\n\t\tvar masks = [\n\t\t\t[1, 0, 0, 0],\n\t\t\t[0, 1, 0, 0],\n\t\t\t[0, 0, 1, 0],\n\t\t\t[0, 0, 0, 1]\n\t\t];\n\n\t\tfor (var i = 0; i < 4; i++) {\n\t\t\tif (!this._channels[i]) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis._channels[i].drawTo(function() {\n\t\t\t\ttexA.bind(0);\n\t\t\t\tshader\n\t\t\t\t\t.uniforms({ u_texture: 0, u_mask: masks[i] })\n\t\t\t\t\t.draw(mesh);\n\t\t\t});\n\t\t\tthis.setOutputData(i, this._channels[i]);\n\t\t}\n\t};\n\n\tLGraphTextureChannels.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec4 u_mask;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t   gl_FragColor = vec4( vec3( length( texture2D(u_texture, v_coord) * u_mask )), 1.0 );\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\n\t\t\"texture/textureChannels\",\n\t\tLGraphTextureChannels\n\t);\n\n\t// Texture Channels to Texture *****************************************\n\tfunction LGraphChannelsTexture() {\n\t\tthis.addInput(\"R\", \"Texture\");\n\t\tthis.addInput(\"G\", \"Texture\");\n\t\tthis.addInput(\"B\", \"Texture\");\n\t\tthis.addInput(\"A\", \"Texture\");\n\n\t\tthis.addOutput(\"Texture\", \"Texture\");\n\n\t\tthis.properties = {\n\t\t\tprecision: LGraphTexture.DEFAULT,\n\t\t\tR: 1,\n\t\t\tG: 1,\n\t\t\tB: 1,\n\t\t\tA: 1\n\t\t};\n\t\tthis._color = vec4.create();\n\t\tthis._uniforms = {\n\t\t\tu_textureR: 0,\n\t\t\tu_textureG: 1,\n\t\t\tu_textureB: 2,\n\t\t\tu_textureA: 3,\n\t\t\tu_color: this._color\n\t\t};\n\t}\n\n\tLGraphChannelsTexture.title = \"Channels to Texture\";\n\tLGraphChannelsTexture.desc = \"Split texture channels\";\n\tLGraphChannelsTexture.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphChannelsTexture.prototype.onExecute = function() {\n\t\tvar white = LGraphTexture.getWhiteTexture();\n\t\tvar texR = this.getInputData(0) || white;\n\t\tvar texG = this.getInputData(1) || white;\n\t\tvar texB = this.getInputData(2) || white;\n\t\tvar texA = this.getInputData(3) || white;\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\n\t\tvar mesh = Mesh.getScreenQuad();\n\t\tif (!LGraphChannelsTexture._shader) {\n\t\t\tLGraphChannelsTexture._shader = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphChannelsTexture.pixel_shader\n\t\t\t);\n\t\t}\n\t\tvar shader = LGraphChannelsTexture._shader;\n\n\t\tvar w = Math.max(texR.width, texG.width, texB.width, texA.width);\n\t\tvar h = Math.max(\n\t\t\ttexR.height,\n\t\t\ttexG.height,\n\t\t\ttexB.height,\n\t\t\ttexA.height\n\t\t);\n\t\tvar type =\n\t\t\tthis.properties.precision == LGraphTexture.HIGH\n\t\t\t\t? LGraphTexture.HIGH_PRECISION_FORMAT\n\t\t\t\t: gl.UNSIGNED_BYTE;\n\n\t\tif (\n\t\t\t!this._texture ||\n\t\t\tthis._texture.width != w ||\n\t\t\tthis._texture.height != h ||\n\t\t\tthis._texture.type != type\n\t\t) {\n\t\t\tthis._texture = new GL.Texture(w, h, {\n\t\t\t\ttype: type,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tvar color = this._color;\n\t\tcolor[0] = this.properties.R;\n\t\tcolor[1] = this.properties.G;\n\t\tcolor[2] = this.properties.B;\n\t\tcolor[3] = this.properties.A;\n\t\tvar uniforms = this._uniforms;\n\n\t\tthis._texture.drawTo(function() {\n\t\t\ttexR.bind(0);\n\t\t\ttexG.bind(1);\n\t\t\ttexB.bind(2);\n\t\t\ttexA.bind(3);\n\t\t\tshader.uniforms(uniforms).draw(mesh);\n\t\t});\n\t\tthis.setOutputData(0, this._texture);\n\t};\n\n\tLGraphChannelsTexture.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_textureR;\\n\\\n\t\tuniform sampler2D u_textureG;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\tuniform sampler2D u_textureA;\\n\\\n\t\tuniform vec4 u_color;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t   gl_FragColor = u_color * vec4( \\\n\t\t\t\t\ttexture2D(u_textureR, v_coord).r,\\\n\t\t\t\t\ttexture2D(u_textureG, v_coord).r,\\\n\t\t\t\t\ttexture2D(u_textureB, v_coord).r,\\\n\t\t\t\t\ttexture2D(u_textureA, v_coord).r);\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\n\t\t\"texture/channelsTexture\",\n\t\tLGraphChannelsTexture\n\t);\n\n\t// Texture Color *****************************************\n\tfunction LGraphTextureColor() {\n\t\tthis.addOutput(\"Texture\", \"Texture\");\n\n\t\tthis._tex_color = vec4.create();\n\t\tthis.properties = {\n\t\t\tcolor: vec4.create(),\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t}\n\n\tLGraphTextureColor.title = \"Color\";\n\tLGraphTextureColor.desc =\n\t\t\"Generates a 1x1 texture with a constant color\";\n\n\tLGraphTextureColor.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureColor.prototype.onDrawBackground = function(ctx) {\n\t\tvar c = this.properties.color;\n\t\tctx.fillStyle =\n\t\t\t\"rgb(\" +\n\t\t\tMath.floor(clamp(c[0], 0, 1) * 255) +\n\t\t\t\",\" +\n\t\t\tMath.floor(clamp(c[1], 0, 1) * 255) +\n\t\t\t\",\" +\n\t\t\tMath.floor(clamp(c[2], 0, 1) * 255) +\n\t\t\t\")\";\n\t\tif (this.flags.collapsed) {\n\t\t\tthis.boxcolor = ctx.fillStyle;\n\t\t} else {\n\t\t\tctx.fillRect(0, 0, this.size[0], this.size[1]);\n\t\t}\n\t};\n\n\tLGraphTextureColor.prototype.onExecute = function() {\n\t\tvar type =\n\t\t\tthis.properties.precision == LGraphTexture.HIGH\n\t\t\t\t? LGraphTexture.HIGH_PRECISION_FORMAT\n\t\t\t\t: gl.UNSIGNED_BYTE;\n\n\t\tif (!this._tex || this._tex.type != type) {\n\t\t\tthis._tex = new GL.Texture(1, 1, {\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\ttype: type,\n\t\t\t\tminFilter: gl.NEAREST\n\t\t\t});\n\t\t}\n\t\tvar color = this.properties.color;\n\n\t\tif (this.inputs) {\n\t\t\tfor (var i = 0; i < this.inputs.length; i++) {\n\t\t\t\tvar input = this.inputs[i];\n\t\t\t\tvar v = this.getInputData(i);\n\t\t\t\tif (v === undefined) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tswitch (input.name) {\n\t\t\t\t\tcase \"RGB\":\n\t\t\t\t\tcase \"RGBA\":\n\t\t\t\t\t\tcolor.set(v);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"R\":\n\t\t\t\t\t\tcolor[0] = v;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"G\":\n\t\t\t\t\t\tcolor[1] = v;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"B\":\n\t\t\t\t\t\tcolor[2] = v;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"A\":\n\t\t\t\t\t\tcolor[3] = v;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (vec4.sqrDist(this._tex_color, color) > 0.001) {\n\t\t\tthis._tex_color.set(color);\n\t\t\tthis._tex.fill(color);\n\t\t}\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureColor.prototype.onGetInputs = function() {\n\t\treturn [\n\t\t\t[\"RGB\", \"vec3\"],\n\t\t\t[\"RGBA\", \"vec4\"],\n\t\t\t[\"R\", \"number\"],\n\t\t\t[\"G\", \"number\"],\n\t\t\t[\"B\", \"number\"],\n\t\t\t[\"A\", \"number\"]\n\t\t];\n\t};\n\n\tLiteGraph.registerNodeType(\"texture/color\", LGraphTextureColor);\n\n\t// Texture Channels to Texture *****************************************\n\tfunction LGraphTextureGradient() {\n\t\tthis.addInput(\"A\", \"color\");\n\t\tthis.addInput(\"B\", \"color\");\n\t\tthis.addOutput(\"Texture\", \"Texture\");\n\n\t\tthis.properties = {\n\t\t\tangle: 0,\n\t\t\tscale: 1,\n\t\t\tA: [0, 0, 0],\n\t\t\tB: [1, 1, 1],\n\t\t\ttexture_size: 32\n\t\t};\n\t\tif (!LGraphTextureGradient._shader) {\n\t\t\tLGraphTextureGradient._shader = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureGradient.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tthis._uniforms = {\n\t\t\tu_angle: 0,\n\t\t\tu_colorA: vec3.create(),\n\t\t\tu_colorB: vec3.create()\n\t\t};\n\t}\n\n\tLGraphTextureGradient.title = \"Gradient\";\n\tLGraphTextureGradient.desc = \"Generates a gradient\";\n\tLGraphTextureGradient[\"@A\"] = { type: \"color\" };\n\tLGraphTextureGradient[\"@B\"] = { type: \"color\" };\n\tLGraphTextureGradient[\"@texture_size\"] = {\n\t\ttype: \"enum\",\n\t\tvalues: [32, 64, 128, 256, 512]\n\t};\n\n\tLGraphTextureGradient.prototype.onExecute = function() {\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\n\t\tvar mesh = GL.Mesh.getScreenQuad();\n\t\tvar shader = LGraphTextureGradient._shader;\n\n\t\tvar A = this.getInputData(0);\n\t\tif (!A) {\n\t\t\tA = this.properties.A;\n\t\t}\n\t\tvar B = this.getInputData(1);\n\t\tif (!B) {\n\t\t\tB = this.properties.B;\n\t\t}\n\n\t\t//angle and scale\n\t\tfor (var i = 2; i < this.inputs.length; i++) {\n\t\t\tvar input = this.inputs[i];\n\t\t\tvar v = this.getInputData(i);\n\t\t\tif (v === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.properties[input.name] = v;\n\t\t}\n\n\t\tvar uniforms = this._uniforms;\n\t\tthis._uniforms.u_angle = this.properties.angle * DEG2RAD;\n\t\tthis._uniforms.u_scale = this.properties.scale;\n\t\tvec3.copy(uniforms.u_colorA, A);\n\t\tvec3.copy(uniforms.u_colorB, B);\n\n\t\tvar size = parseInt(this.properties.texture_size);\n\t\tif (!this._tex || this._tex.width != size) {\n\t\t\tthis._tex = new GL.Texture(size, size, {\n\t\t\t\tformat: gl.RGB,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tthis._tex.drawTo(function() {\n\t\t\tshader.uniforms(uniforms).draw(mesh);\n\t\t});\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureGradient.prototype.onGetInputs = function() {\n\t\treturn [[\"angle\", \"number\"], [\"scale\", \"number\"]];\n\t};\n\n\tLGraphTextureGradient.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform float u_angle;\\n\\\n\t\tuniform float u_scale;\\n\\\n\t\tuniform vec3 u_colorA;\\n\\\n\t\tuniform vec3 u_colorB;\\n\\\n\t\t\\n\\\n\t\tvec2 rotate(vec2 v, float angle)\\n\\\n\t\t{\\n\\\n\t\t\tvec2 result;\\n\\\n\t\t\tfloat _cos = cos(angle);\\n\\\n\t\t\tfloat _sin = sin(angle);\\n\\\n\t\t\tresult.x = v.x * _cos - v.y * _sin;\\n\\\n\t\t\tresult.y = v.x * _sin + v.y * _cos;\\n\\\n\t\t\treturn result;\\n\\\n\t\t}\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tfloat f = (rotate(u_scale * (v_coord - vec2(0.5)), u_angle) + vec2(0.5)).x;\\n\\\n\t\t\tvec3 color = mix(u_colorA,u_colorB,clamp(f,0.0,1.0));\\n\\\n\t\t   gl_FragColor = vec4(color,1.0);\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\"texture/gradient\", LGraphTextureGradient);\n\n\t// Texture Mix *****************************************\n\tfunction LGraphTextureMix() {\n\t\tthis.addInput(\"A\", \"Texture\");\n\t\tthis.addInput(\"B\", \"Texture\");\n\t\tthis.addInput(\"Mixer\", \"Texture\");\n\n\t\tthis.addOutput(\"Texture\", \"Texture\");\n\t\tthis.properties = { factor: 0.5, size_from_biggest: true, invert: false, precision: LGraphTexture.DEFAULT };\n\t\tthis._uniforms = {\n\t\t\tu_textureA: 0,\n\t\t\tu_textureB: 1,\n\t\t\tu_textureMix: 2,\n\t\t\tu_mix: vec4.create()\n\t\t};\n\t}\n\n\tLGraphTextureMix.title = \"Mix\";\n\tLGraphTextureMix.desc = \"Generates a texture mixing two textures\";\n\n\tLGraphTextureMix.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureMix.prototype.onExecute = function() {\n\t\tvar texA = this.getInputData(0);\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH) {\n\t\t\tthis.setOutputData(0, texA);\n\t\t\treturn;\n\t\t}\n\n\t\tvar texB = this.getInputData(1);\n\t\tif (!texA || !texB) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar texMix = this.getInputData(2);\n\n\t\tvar factor = this.getInputData(3);\n\n\t\tthis._tex = LGraphTexture.getTargetTexture(\n\t\t\tthis.properties.size_from_biggest && texB.width > texA.width ? texB : texA,\n\t\t\tthis._tex,\n\t\t\tthis.properties.precision\n\t\t);\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\n\t\tvar mesh = Mesh.getScreenQuad();\n\t\tvar shader = null;\n\t\tvar uniforms = this._uniforms;\n\t\tif (texMix) {\n\t\t\tshader = LGraphTextureMix._shader_tex;\n\t\t\tif (!shader) {\n\t\t\t\tshader = LGraphTextureMix._shader_tex = new GL.Shader(\n\t\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\tLGraphTextureMix.pixel_shader,\n\t\t\t\t\t{ MIX_TEX: \"\" }\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tshader = LGraphTextureMix._shader_factor;\n\t\t\tif (!shader) {\n\t\t\t\tshader = LGraphTextureMix._shader_factor = new GL.Shader(\n\t\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\tLGraphTextureMix.pixel_shader\n\t\t\t\t);\n\t\t\t}\n\t\t\tvar f = factor == null ? this.properties.factor : factor;\n\t\t\tuniforms.u_mix.set([f, f, f, f]);\n\t\t}\n\n\t\tvar invert = this.properties.invert;\n\n\t\tthis._tex.drawTo(function() {\n\t\t\ttexA.bind( invert ? 1 : 0 );\n\t\t\ttexB.bind( invert ? 0 : 1 );\n\t\t\tif (texMix) {\n\t\t\t\ttexMix.bind(2);\n\t\t\t}\n\t\t\tshader.uniforms(uniforms).draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureMix.prototype.onGetInputs = function() {\n\t\treturn [[\"factor\", \"number\"]];\n\t};\n\n\tLGraphTextureMix.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_textureA;\\n\\\n\t\tuniform sampler2D u_textureB;\\n\\\n\t\t#ifdef MIX_TEX\\n\\\n\t\t\tuniform sampler2D u_textureMix;\\n\\\n\t\t#else\\n\\\n\t\t\tuniform vec4 u_mix;\\n\\\n\t\t#endif\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\t#ifdef MIX_TEX\\n\\\n\t\t\t   vec4 f = texture2D(u_textureMix, v_coord);\\n\\\n\t\t\t#else\\n\\\n\t\t\t   vec4 f = u_mix;\\n\\\n\t\t\t#endif\\n\\\n\t\t   gl_FragColor = mix( texture2D(u_textureA, v_coord), texture2D(u_textureB, v_coord), f );\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\"texture/mix\", LGraphTextureMix);\n\n\t// Texture Edges detection *****************************************\n\tfunction LGraphTextureEdges() {\n\t\tthis.addInput(\"Tex.\", \"Texture\");\n\n\t\tthis.addOutput(\"Edges\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tinvert: true,\n\t\t\tthreshold: false,\n\t\t\tfactor: 1,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\n\t\tif (!LGraphTextureEdges._shader) {\n\t\t\tLGraphTextureEdges._shader = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureEdges.pixel_shader\n\t\t\t);\n\t\t}\n\t}\n\n\tLGraphTextureEdges.title = \"Edges\";\n\tLGraphTextureEdges.desc = \"Detects edges\";\n\n\tLGraphTextureEdges.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureEdges.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar tex = this.getInputData(0);\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._tex = LGraphTexture.getTargetTexture(\n\t\t\ttex,\n\t\t\tthis._tex,\n\t\t\tthis.properties.precision\n\t\t);\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\n\t\tvar mesh = Mesh.getScreenQuad();\n\t\tvar shader = LGraphTextureEdges._shader;\n\t\tvar invert = this.properties.invert;\n\t\tvar factor = this.properties.factor;\n\t\tvar threshold = this.properties.threshold ? 1 : 0;\n\n\t\tthis._tex.drawTo(function() {\n\t\t\ttex.bind(0);\n\t\t\tshader\n\t\t\t\t.uniforms({\n\t\t\t\t\tu_texture: 0,\n\t\t\t\t\tu_isize: [1 / tex.width, 1 / tex.height],\n\t\t\t\t\tu_factor: factor,\n\t\t\t\t\tu_threshold: threshold,\n\t\t\t\t\tu_invert: invert ? 1 : 0\n\t\t\t\t})\n\t\t\t\t.draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureEdges.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec2 u_isize;\\n\\\n\t\tuniform int u_invert;\\n\\\n\t\tuniform float u_factor;\\n\\\n\t\tuniform float u_threshold;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 center = texture2D(u_texture, v_coord);\\n\\\n\t\t\tvec4 up = texture2D(u_texture, v_coord + u_isize * vec2(0.0,1.0) );\\n\\\n\t\t\tvec4 down = texture2D(u_texture, v_coord + u_isize * vec2(0.0,-1.0) );\\n\\\n\t\t\tvec4 left = texture2D(u_texture, v_coord + u_isize * vec2(1.0,0.0) );\\n\\\n\t\t\tvec4 right = texture2D(u_texture, v_coord + u_isize * vec2(-1.0,0.0) );\\n\\\n\t\t\tvec4 diff = abs(center - up) + abs(center - down) + abs(center - left) + abs(center - right);\\n\\\n\t\t\tdiff *= u_factor;\\n\\\n\t\t\tif(u_invert == 1)\\n\\\n\t\t\t\tdiff.xyz = vec3(1.0) - diff.xyz;\\n\\\n\t\t\tif( u_threshold == 0.0 )\\n\\\n\t\t\t\tgl_FragColor = vec4( diff.xyz, center.a );\\n\\\n\t\t\telse\\n\\\n\t\t\t\tgl_FragColor = vec4( diff.x > 0.5 ? 1.0 : 0.0, diff.y > 0.5 ? 1.0 : 0.0, diff.z > 0.5 ? 1.0 : 0.0, center.a );\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType(\"texture/edges\", LGraphTextureEdges);\n\n\t// Texture Depth *****************************************\n\tfunction LGraphTextureDepthRange() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addInput(\"Distance\", \"number\");\n\t\tthis.addInput(\"Range\", \"number\");\n\t\tthis.addOutput(\"Texture\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tdistance: 100,\n\t\t\trange: 50,\n\t\t\tonly_depth: false,\n\t\t\thigh_precision: false\n\t\t};\n\t\tthis._uniforms = {\n\t\t\tu_texture: 0,\n\t\t\tu_distance: 100,\n\t\t\tu_range: 50,\n\t\t\tu_camera_planes: null\n\t\t};\n\t}\n\n\tLGraphTextureDepthRange.title = \"Depth Range\";\n\tLGraphTextureDepthRange.desc = \"Generates a texture with a depth range\";\n\n\tLGraphTextureDepthRange.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar precision = gl.UNSIGNED_BYTE;\n\t\tif (this.properties.high_precision) {\n\t\t\tprecision = gl.half_float_ext ? gl.HALF_FLOAT_OES : gl.FLOAT;\n\t\t}\n\n\t\tif (\n\t\t\t!this._temp_texture ||\n\t\t\tthis._temp_texture.type != precision ||\n\t\t\tthis._temp_texture.width != tex.width ||\n\t\t\tthis._temp_texture.height != tex.height\n\t\t) {\n\t\t\tthis._temp_texture = new GL.Texture(tex.width, tex.height, {\n\t\t\t\ttype: precision,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tvar uniforms = this._uniforms;\n\n\t\t//iterations\n\t\tvar distance = this.properties.distance;\n\t\tif (this.isInputConnected(1)) {\n\t\t\tdistance = this.getInputData(1);\n\t\t\tthis.properties.distance = distance;\n\t\t}\n\n\t\tvar range = this.properties.range;\n\t\tif (this.isInputConnected(2)) {\n\t\t\trange = this.getInputData(2);\n\t\t\tthis.properties.range = range;\n\t\t}\n\n\t\tuniforms.u_distance = distance;\n\t\tuniforms.u_range = range;\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\tvar mesh = Mesh.getScreenQuad();\n\t\tif (!LGraphTextureDepthRange._shader) {\n\t\t\tLGraphTextureDepthRange._shader = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureDepthRange.pixel_shader\n\t\t\t);\n\t\t\tLGraphTextureDepthRange._shader_onlydepth = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureDepthRange.pixel_shader,\n\t\t\t\t{ ONLY_DEPTH: \"\" }\n\t\t\t);\n\t\t}\n\t\tvar shader = this.properties.only_depth\n\t\t\t? LGraphTextureDepthRange._shader_onlydepth\n\t\t\t: LGraphTextureDepthRange._shader;\n\n\t\t//NEAR AND FAR PLANES\n\t\tvar planes = null;\n\t\tif (tex.near_far_planes) {\n\t\t\tplanes = tex.near_far_planes;\n\t\t} else if (window.LS && LS.Renderer._main_camera) {\n\t\t\tplanes = LS.Renderer._main_camera._uniforms.u_camera_planes;\n\t\t} else {\n\t\t\tplanes = [0.1, 1000];\n\t\t} //hardcoded\n\t\tuniforms.u_camera_planes = planes;\n\n\t\tthis._temp_texture.drawTo(function() {\n\t\t\ttex.bind(0);\n\t\t\tshader.uniforms(uniforms).draw(mesh);\n\t\t});\n\n\t\tthis._temp_texture.near_far_planes = planes;\n\t\tthis.setOutputData(0, this._temp_texture);\n\t};\n\n\tLGraphTextureDepthRange.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec2 u_camera_planes;\\n\\\n\t\tuniform float u_distance;\\n\\\n\t\tuniform float u_range;\\n\\\n\t\t\\n\\\n\t\tfloat LinearDepth()\\n\\\n\t\t{\\n\\\n\t\t\tfloat zNear = u_camera_planes.x;\\n\\\n\t\t\tfloat zFar = u_camera_planes.y;\\n\\\n\t\t\tfloat depth = texture2D(u_texture, v_coord).x;\\n\\\n\t\t\tdepth = depth * 2.0 - 1.0;\\n\\\n\t\t\treturn zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tfloat depth = LinearDepth();\\n\\\n\t\t\t#ifdef ONLY_DEPTH\\n\\\n\t\t\t   gl_FragColor = vec4(depth);\\n\\\n\t\t\t#else\\n\\\n\t\t\t\tfloat diff = abs(depth * u_camera_planes.y - u_distance);\\n\\\n\t\t\t\tfloat dof = 1.0;\\n\\\n\t\t\t\tif(diff <= u_range)\\n\\\n\t\t\t\t\tdof = diff / u_range;\\n\\\n\t\t\t   gl_FragColor = vec4(dof);\\n\\\n\t\t\t#endif\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType( \"texture/depth_range\", LGraphTextureDepthRange );\n\n\n\t// Texture Depth *****************************************\n\tfunction LGraphTextureLinearDepth() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"Texture\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tprecision: LGraphTexture.DEFAULT,\n\t\t\tinvert: false\n\t\t};\n\t\tthis._uniforms = {\n\t\t\tu_texture: 0,\n\t\t\tu_camera_planes: null, //filled later\n\t\t\tu_ires: vec2.create()\n\t\t};\n\t}\n\n\tLGraphTextureLinearDepth.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureLinearDepth.title = \"Linear Depth\";\n\tLGraphTextureLinearDepth.desc = \"Creates a color texture with linear depth\";\n\n\tLGraphTextureLinearDepth.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex || (tex.format != gl.DEPTH_COMPONENT && tex.format != gl.DEPTH_STENCIL) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar precision = this.properties.precision == LGraphTexture.HIGH ? gl.HIGH_PRECISION_FORMAT : gl.UNSIGNED_BYTE;\n\n\t\tif ( !this._temp_texture || this._temp_texture.type != precision || this._temp_texture.width != tex.width || this._temp_texture.height != tex.height ) {\n\t\t\tthis._temp_texture = new GL.Texture(tex.width, tex.height, {\n\t\t\t\ttype: precision,\n\t\t\t\tformat: gl.RGB,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_invert = this.properties.invert ? 1 : 0;\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\tvar mesh = Mesh.getScreenQuad();\n\t\tif(!LGraphTextureLinearDepth._shader)\n\t\t\tLGraphTextureLinearDepth._shader = new GL.Shader( GL.Shader.SCREEN_VERTEX_SHADER, LGraphTextureLinearDepth.pixel_shader);\n\t\tvar shader = LGraphTextureLinearDepth._shader;\n\n\t\t//NEAR AND FAR PLANES\n\t\tvar planes = null;\n\t\tif (tex.near_far_planes) {\n\t\t\tplanes = tex.near_far_planes;\n\t\t} else if (window.LS && LS.Renderer._main_camera) {\n\t\t\tplanes = LS.Renderer._main_camera._uniforms.u_camera_planes;\n\t\t} else {\n\t\t\tplanes = [0.1, 1000];\n\t\t} //hardcoded\n\t\tuniforms.u_camera_planes = planes;\n\t\t//uniforms.u_ires.set([1/tex.width, 1/tex.height]);\n\t\tuniforms.u_ires.set([0,0]);\n\n\t\tthis._temp_texture.drawTo(function() {\n\t\t\ttex.bind(0);\n\t\t\tshader.uniforms(uniforms).draw(mesh);\n\t\t});\n\n\t\tthis._temp_texture.near_far_planes = planes;\n\t\tthis.setOutputData(0, this._temp_texture);\n\t};\n\n\tLGraphTextureLinearDepth.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec2 u_camera_planes;\\n\\\n\t\tuniform int u_invert;\\n\\\n\t\tuniform vec2 u_ires;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tfloat zNear = u_camera_planes.x;\\n\\\n\t\t\tfloat zFar = u_camera_planes.y;\\n\\\n\t\t\tfloat depth = texture2D(u_texture, v_coord + u_ires*0.5).x * 2.0 - 1.0;\\n\\\n\t\t\tfloat f = zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));\\n\\\n\t\t\tif( u_invert == 1 )\\n\\\n\t\t\t\tf = 1.0 - f;\\n\\\n\t\t\tgl_FragColor = vec4(vec3(f),1.0);\\n\\\n\t\t}\\n\\\n\t\t\";\n\n\tLiteGraph.registerNodeType( \"texture/linear_depth\", LGraphTextureLinearDepth );\n\n\t// Texture Blur *****************************************\n\tfunction LGraphTextureBlur() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addInput(\"Iterations\", \"number\");\n\t\tthis.addInput(\"Intensity\", \"number\");\n\t\tthis.addOutput(\"Blurred\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tintensity: 1,\n\t\t\titerations: 1,\n\t\t\tpreserve_aspect: false,\n\t\t\tscale: [1, 1],\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t}\n\n\tLGraphTextureBlur.title = \"Blur\";\n\tLGraphTextureBlur.desc = \"Blur a texture\";\n\n\tLGraphTextureBlur.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureBlur.max_iterations = 20;\n\n\tLGraphTextureBlur.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar temp = this._final_texture;\n\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.width != tex.width ||\n\t\t\ttemp.height != tex.height ||\n\t\t\ttemp.type != tex.type\n\t\t) {\n\t\t\t//we need two textures to do the blurring\n\t\t\t//this._temp_texture = new GL.Texture( tex.width, tex.height, { type: tex.type, format: gl.RGBA, filter: gl.LINEAR });\n\t\t\ttemp = this._final_texture = new GL.Texture(\n\t\t\t\ttex.width,\n\t\t\t\ttex.height,\n\t\t\t\t{ type: tex.type, format: gl.RGBA, filter: gl.LINEAR }\n\t\t\t);\n\t\t}\n\n\t\t//iterations\n\t\tvar iterations = this.properties.iterations;\n\t\tif (this.isInputConnected(1)) {\n\t\t\titerations = this.getInputData(1);\n\t\t\tthis.properties.iterations = iterations;\n\t\t}\n\t\titerations = Math.min(\n\t\t\tMath.floor(iterations),\n\t\t\tLGraphTextureBlur.max_iterations\n\t\t);\n\t\tif (iterations == 0) {\n\t\t\t//skip blurring\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar intensity = this.properties.intensity;\n\t\tif (this.isInputConnected(2)) {\n\t\t\tintensity = this.getInputData(2);\n\t\t\tthis.properties.intensity = intensity;\n\t\t}\n\n\t\t//blur sometimes needs an aspect correction\n\t\tvar aspect = LiteGraph.camera_aspect;\n\t\tif (!aspect && window.gl !== undefined) {\n\t\t\taspect = gl.canvas.height / gl.canvas.width;\n\t\t}\n\t\tif (!aspect) {\n\t\t\taspect = 1;\n\t\t}\n\t\taspect = this.properties.preserve_aspect ? aspect : 1;\n\n\t\tvar scale = this.properties.scale || [1, 1];\n\t\ttex.applyBlur(aspect * scale[0], scale[1], intensity, temp);\n\t\tfor (var i = 1; i < iterations; ++i) {\n\t\t\ttemp.applyBlur(\n\t\t\t\taspect * scale[0] * (i + 1),\n\t\t\t\tscale[1] * (i + 1),\n\t\t\t\tintensity\n\t\t\t);\n\t\t}\n\n\t\tthis.setOutputData(0, temp);\n\t};\n\n\t/*\nLGraphTextureBlur.pixel_shader = \"precision highp float;\\n\\\n\t\tprecision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec2 u_offset;\\n\\\n\t\tuniform float u_intensity;\\n\\\n\t\tvoid main() {\\n\\\n\t\t   vec4 sum = vec4(0.0);\\n\\\n\t\t   vec4 center = texture2D(u_texture, v_coord);\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * -4.0) * 0.05/0.98;\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * -3.0) * 0.09/0.98;\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * -2.0) * 0.12/0.98;\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * -1.0) * 0.15/0.98;\\n\\\n\t\t   sum += center * 0.16/0.98;\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * 4.0) * 0.05/0.98;\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * 3.0) * 0.09/0.98;\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * 2.0) * 0.12/0.98;\\n\\\n\t\t   sum += texture2D(u_texture, v_coord + u_offset * 1.0) * 0.15/0.98;\\n\\\n\t\t   gl_FragColor = u_intensity * sum;\\n\\\n\t\t}\\n\\\n\t\t\";\n*/\n\n\tLiteGraph.registerNodeType(\"texture/blur\", LGraphTextureBlur);\n\n\t//Independent glow FX\n\t//based on https://catlikecoding.com/unity/tutorials/advanced-rendering/bloom/\n\tfunction FXGlow()\n\t{\n\t\tthis.intensity = 0.5;\n\t\tthis.persistence = 0.6;\n\t\tthis.iterations = 8;\n\t\tthis.threshold = 0.8;\n\t\tthis.scale = 1;\n\n\t\tthis.dirt_texture = null;\n\t\tthis.dirt_factor = 0.5;\n\n\t\tthis._textures = [];\n\t\tthis._uniforms = {\n\t\t\tu_intensity: 1,\n\t\t\tu_texture: 0,\n\t\t\tu_glow_texture: 1,\n\t\t\tu_threshold: 0,\n\t\t\tu_texel_size: vec2.create()\n\t\t};\n\t}\n\n\tFXGlow.prototype.applyFX = function( tex, output_texture, glow_texture, average_texture ) {\n\n\t\tvar width = tex.width;\n\t\tvar height = tex.height;\n\n\t\tvar texture_info = {\n\t\t\tformat: tex.format,\n\t\t\ttype: tex.type,\n\t\t\tminFilter: GL.LINEAR,\n\t\t\tmagFilter: GL.LINEAR,\n\t\t\twrap: gl.CLAMP_TO_EDGE\n\t\t};\n\n\t\tvar uniforms = this._uniforms;\n\t\tvar textures = this._textures;\n\n\t\t//cut\n\t\tvar shader = FXGlow._cut_shader;\n\t\tif (!shader) {\n\t\t\tshader = FXGlow._cut_shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tFXGlow.cut_pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\tgl.disable(gl.BLEND);\n\n\t\tuniforms.u_threshold = this.threshold;\n\t\tvar currentDestination = (textures[0] = GL.Texture.getTemporary(\n\t\t\twidth,\n\t\t\theight,\n\t\t\ttexture_info\n\t\t));\n\t\ttex.blit( currentDestination, shader.uniforms(uniforms) );\n\t\tvar currentSource = currentDestination;\n\n\t\tvar iterations = this.iterations;\n\t\titerations = clamp(iterations, 1, 16) | 0;\n\t\tvar texel_size = uniforms.u_texel_size;\n\t\tvar intensity = this.intensity;\n\n\t\tuniforms.u_intensity = 1;\n\t\tuniforms.u_delta = this.scale; //1\n\n\t\t//downscale/upscale shader\n\t\tvar shader = FXGlow._shader;\n\t\tif (!shader) {\n\t\t\tshader = FXGlow._shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tFXGlow.scale_pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tvar i = 1;\n\t\t//downscale\n\t\tfor (; i < iterations; i++) {\n\t\t\twidth = width >> 1;\n\t\t\tif ((height | 0) > 1) {\n\t\t\t\theight = height >> 1;\n\t\t\t}\n\t\t\tif (width < 2) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcurrentDestination = textures[i] = GL.Texture.getTemporary(\n\t\t\t\twidth,\n\t\t\t\theight,\n\t\t\t\ttexture_info\n\t\t\t);\n\t\t\ttexel_size[0] = 1 / currentSource.width;\n\t\t\ttexel_size[1] = 1 / currentSource.height;\n\t\t\tcurrentSource.blit(\n\t\t\t\tcurrentDestination,\n\t\t\t\tshader.uniforms(uniforms)\n\t\t\t);\n\t\t\tcurrentSource = currentDestination;\n\t\t}\n\n\t\t//average\n\t\tif (average_texture) {\n\t\t\ttexel_size[0] = 1 / currentSource.width;\n\t\t\ttexel_size[1] = 1 / currentSource.height;\n\t\t\tuniforms.u_intensity = intensity;\n\t\t\tuniforms.u_delta = 1;\n\t\t\tcurrentSource.blit(average_texture, shader.uniforms(uniforms));\n\t\t}\n\n\t\t//upscale and blend\n\t\tgl.enable(gl.BLEND);\n\t\tgl.blendFunc(gl.ONE, gl.ONE);\n\t\tuniforms.u_intensity = this.persistence;\n\t\tuniforms.u_delta = 0.5;\n\n\t\t// i-=2 => -1 to point to last element in array, -1 to go to texture above\n\t\tfor ( i -= 2; i >= 0; i-- ) \n\t\t{\n\t\t\tcurrentDestination = textures[i];\n\t\t\ttextures[i] = null;\n\t\t\ttexel_size[0] = 1 / currentSource.width;\n\t\t\ttexel_size[1] = 1 / currentSource.height;\n\t\t\tcurrentSource.blit(\n\t\t\t\tcurrentDestination,\n\t\t\t\tshader.uniforms(uniforms)\n\t\t\t);\n\t\t\tGL.Texture.releaseTemporary(currentSource);\n\t\t\tcurrentSource = currentDestination;\n\t\t}\n\t\tgl.disable(gl.BLEND);\n\n\t\t//glow\n\t\tif (glow_texture) {\n\t\t\tcurrentSource.blit(glow_texture);\n\t\t}\n\n\t\t//final composition\n\t\tif ( output_texture ) {\n\t\t\tvar final_texture = output_texture;\n\t\t\tvar dirt_texture = this.dirt_texture;\n\t\t\tvar dirt_factor = this.dirt_factor;\n\t\t\tuniforms.u_intensity = intensity;\n\n\t\t\tshader = dirt_texture\n\t\t\t\t? FXGlow._dirt_final_shader\n\t\t\t\t: FXGlow._final_shader;\n\t\t\tif (!shader) {\n\t\t\t\tif (dirt_texture) {\n\t\t\t\t\tshader = FXGlow._dirt_final_shader = new GL.Shader(\n\t\t\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\t\tFXGlow.final_pixel_shader,\n\t\t\t\t\t\t{ USE_DIRT: \"\" }\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tshader = FXGlow._final_shader = new GL.Shader(\n\t\t\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\t\tFXGlow.final_pixel_shader\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfinal_texture.drawTo(function() {\n\t\t\t\ttex.bind(0);\n\t\t\t\tcurrentSource.bind(1);\n\t\t\t\tif (dirt_texture) {\n\t\t\t\t\tshader.setUniform(\"u_dirt_factor\", dirt_factor);\n\t\t\t\t\tshader.setUniform(\n\t\t\t\t\t\t\"u_dirt_texture\",\n\t\t\t\t\t\tdirt_texture.bind(2)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tshader.toViewport(uniforms);\n\t\t\t});\n\t\t}\n\n\t\tGL.Texture.releaseTemporary(currentSource);\n\t};\n\n\tFXGlow.cut_pixel_shader =\n\t\t\"precision highp float;\\n\\\n\tvarying vec2 v_coord;\\n\\\n\tuniform sampler2D u_texture;\\n\\\n\tuniform float u_threshold;\\n\\\n\tvoid main() {\\n\\\n\t\tgl_FragColor = max( texture2D( u_texture, v_coord ) - vec4( u_threshold ), vec4(0.0) );\\n\\\n\t}\";\n\n\tFXGlow.scale_pixel_shader =\n\t\t\"precision highp float;\\n\\\n\tvarying vec2 v_coord;\\n\\\n\tuniform sampler2D u_texture;\\n\\\n\tuniform vec2 u_texel_size;\\n\\\n\tuniform float u_delta;\\n\\\n\tuniform float u_intensity;\\n\\\n\t\\n\\\n\tvec4 sampleBox(vec2 uv) {\\n\\\n\t\tvec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;\\n\\\n\t\tvec4 s = texture2D( u_texture, uv + o.xy ) + texture2D( u_texture, uv + o.zy) + texture2D( u_texture, uv + o.xw) + texture2D( u_texture, uv + o.zw);\\n\\\n\t\treturn s * 0.25;\\n\\\n\t}\\n\\\n\tvoid main() {\\n\\\n\t\tgl_FragColor = u_intensity * sampleBox( v_coord );\\n\\\n\t}\";\n\n\tFXGlow.final_pixel_shader =\n\t\t\"precision highp float;\\n\\\n\tvarying vec2 v_coord;\\n\\\n\tuniform sampler2D u_texture;\\n\\\n\tuniform sampler2D u_glow_texture;\\n\\\n\t#ifdef USE_DIRT\\n\\\n\t\tuniform sampler2D u_dirt_texture;\\n\\\n\t#endif\\n\\\n\tuniform vec2 u_texel_size;\\n\\\n\tuniform float u_delta;\\n\\\n\tuniform float u_intensity;\\n\\\n\tuniform float u_dirt_factor;\\n\\\n\t\\n\\\n\tvec4 sampleBox(vec2 uv) {\\n\\\n\t\tvec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;\\n\\\n\t\tvec4 s = texture2D( u_glow_texture, uv + o.xy ) + texture2D( u_glow_texture, uv + o.zy) + texture2D( u_glow_texture, uv + o.xw) + texture2D( u_glow_texture, uv + o.zw);\\n\\\n\t\treturn s * 0.25;\\n\\\n\t}\\n\\\n\tvoid main() {\\n\\\n\t\tvec4 glow = sampleBox( v_coord );\\n\\\n\t\t#ifdef USE_DIRT\\n\\\n\t\t\tglow = mix( glow, glow * texture2D( u_dirt_texture, v_coord ), u_dirt_factor );\\n\\\n\t\t#endif\\n\\\n\t\tgl_FragColor = texture2D( u_texture, v_coord ) + u_intensity * glow;\\n\\\n\t}\";\n\n\n\t// Texture Glow *****************************************\n\tfunction LGraphTextureGlow() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addInput(\"dirt\", \"Texture\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.addOutput(\"glow\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tenabled: true,\n\t\t\tintensity: 1,\n\t\t\tpersistence: 0.99,\n\t\t\titerations: 16,\n\t\t\tthreshold: 0,\n\t\t\tscale: 1,\n\t\t\tdirt_factor: 0.5,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\n\t\tthis.fx = new FXGlow();\n\t}\n\n\tLGraphTextureGlow.title = \"Glow\";\n\tLGraphTextureGlow.desc = \"Filters a texture giving it a glow effect\";\n\n\tLGraphTextureGlow.widgets_info = {\n\t\titerations: {\n\t\t\ttype: \"number\",\n\t\t\tmin: 0,\n\t\t\tmax: 16,\n\t\t\tstep: 1,\n\t\t\tprecision: 0\n\t\t},\n\t\tthreshold: {\n\t\t\ttype: \"number\",\n\t\t\tmin: 0,\n\t\t\tmax: 10,\n\t\t\tstep: 0.01,\n\t\t\tprecision: 2\n\t\t},\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureGlow.prototype.onGetInputs = function() {\n\t\treturn [\n\t\t\t[\"enabled\", \"boolean\"],\n\t\t\t[\"threshold\", \"number\"],\n\t\t\t[\"intensity\", \"number\"],\n\t\t\t[\"persistence\", \"number\"],\n\t\t\t[\"iterations\", \"number\"],\n\t\t\t[\"dirt_factor\", \"number\"]\n\t\t];\n\t};\n\n\tLGraphTextureGlow.prototype.onGetOutputs = function() {\n\t\treturn [[\"average\", \"Texture\"]];\n\t};\n\n\tLGraphTextureGlow.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isAnyOutputConnected()) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (\n\t\t\tthis.properties.precision === LGraphTexture.PASS_THROUGH ||\n\t\t\tthis.getInputOrProperty(\"enabled\") === false\n\t\t) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar width = tex.width;\n\t\tvar height = tex.height;\n\n\t\tvar fx = this.fx;\n\t\tfx.threshold = this.getInputOrProperty(\"threshold\");\n\t\tfx.iterations = this.getInputOrProperty(\"iterations\");\n\t\tfx.intensity = this.getInputOrProperty(\"intensity\");\n\t\tfx.persistence = this.getInputOrProperty(\"persistence\");\n\t\tfx.dirt_texture = this.getInputData(1);\n\t\tfx.dirt_factor = this.getInputOrProperty(\"dirt_factor\");\n\t\tfx.scale = this.properties.scale;\n\n\t\tvar type = LGraphTexture.getTextureType( this.properties.precision, tex );\n\n\t\tvar average_texture = null;\n\t\tif (this.isOutputConnected(2)) {\n\t\t\taverage_texture = this._average_texture;\n\t\t\tif (\n\t\t\t\t!average_texture ||\n\t\t\t\taverage_texture.type != tex.type ||\n\t\t\t\taverage_texture.format != tex.format\n\t\t\t) {\n\t\t\t\taverage_texture = this._average_texture = new GL.Texture(\n\t\t\t\t\t1,\n\t\t\t\t\t1,\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: tex.type,\n\t\t\t\t\t\tformat: tex.format,\n\t\t\t\t\t\tfilter: gl.LINEAR\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tvar glow_texture = null;\n\t\tif (this.isOutputConnected(1)) {\n\t\t\tglow_texture = this._glow_texture;\n\t\t\tif (\n\t\t\t\t!glow_texture ||\n\t\t\t\tglow_texture.width != tex.width ||\n\t\t\t\tglow_texture.height != tex.height ||\n\t\t\t\tglow_texture.type != type ||\n\t\t\t\tglow_texture.format != tex.format\n\t\t\t) {\n\t\t\t\tglow_texture = this._glow_texture = new GL.Texture(\n\t\t\t\t\ttex.width,\n\t\t\t\t\ttex.height,\n\t\t\t\t\t{ type: type, format: tex.format, filter: gl.LINEAR }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tvar final_texture = null;\n\t\tif (this.isOutputConnected(0)) {\n\t\t\tfinal_texture = this._final_texture;\n\t\t\tif (\n\t\t\t\t!final_texture ||\n\t\t\t\tfinal_texture.width != tex.width ||\n\t\t\t\tfinal_texture.height != tex.height ||\n\t\t\t\tfinal_texture.type != type ||\n\t\t\t\tfinal_texture.format != tex.format\n\t\t\t) {\n\t\t\t\tfinal_texture = this._final_texture = new GL.Texture(\n\t\t\t\t\ttex.width,\n\t\t\t\t\ttex.height,\n\t\t\t\t\t{ type: type, format: tex.format, filter: gl.LINEAR }\n\t\t\t\t);\n\t\t\t}\n\n\t\t}\n\n\t\t//apply FX\n\t\tfx.applyFX(tex, final_texture, glow_texture, average_texture );\n\n\t\tif (this.isOutputConnected(0))\n\t\t\tthis.setOutputData(0, final_texture);\n\n\t\tif (this.isOutputConnected(1))\n\t\t\tthis.setOutputData(1, average_texture);\n\n\t\tif (this.isOutputConnected(2))\n\t\t\tthis.setOutputData(2, glow_texture);\n\t};\n\n\tLiteGraph.registerNodeType(\"texture/glow\", LGraphTextureGlow);\n\n\t// Texture Filter *****************************************\n\tfunction LGraphTextureKuwaharaFilter() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"Filtered\", \"Texture\");\n\t\tthis.properties = { intensity: 1, radius: 5 };\n\t}\n\n\tLGraphTextureKuwaharaFilter.title = \"Kuwahara Filter\";\n\tLGraphTextureKuwaharaFilter.desc =\n\t\t\"Filters a texture giving an artistic oil canvas painting\";\n\n\tLGraphTextureKuwaharaFilter.max_radius = 10;\n\tLGraphTextureKuwaharaFilter._shaders = [];\n\n\tLGraphTextureKuwaharaFilter.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar temp = this._temp_texture;\n\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.width != tex.width ||\n\t\t\ttemp.height != tex.height ||\n\t\t\ttemp.type != tex.type\n\t\t) {\n\t\t\tthis._temp_texture = new GL.Texture(tex.width, tex.height, {\n\t\t\t\ttype: tex.type,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\t//iterations\n\t\tvar radius = this.properties.radius;\n\t\tradius = Math.min(\n\t\t\tMath.floor(radius),\n\t\t\tLGraphTextureKuwaharaFilter.max_radius\n\t\t);\n\t\tif (radius == 0) {\n\t\t\t//skip blurring\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar intensity = this.properties.intensity;\n\n\t\t//blur sometimes needs an aspect correction\n\t\tvar aspect = LiteGraph.camera_aspect;\n\t\tif (!aspect && window.gl !== undefined) {\n\t\t\taspect = gl.canvas.height / gl.canvas.width;\n\t\t}\n\t\tif (!aspect) {\n\t\t\taspect = 1;\n\t\t}\n\t\taspect = this.properties.preserve_aspect ? aspect : 1;\n\n\t\tif (!LGraphTextureKuwaharaFilter._shaders[radius]) {\n\t\t\tLGraphTextureKuwaharaFilter._shaders[radius] = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureKuwaharaFilter.pixel_shader,\n\t\t\t\t{ RADIUS: radius.toFixed(0) }\n\t\t\t);\n\t\t}\n\n\t\tvar shader = LGraphTextureKuwaharaFilter._shaders[radius];\n\t\tvar mesh = GL.Mesh.getScreenQuad();\n\t\ttex.bind(0);\n\n\t\tthis._temp_texture.drawTo(function() {\n\t\t\tshader\n\t\t\t\t.uniforms({\n\t\t\t\t\tu_texture: 0,\n\t\t\t\t\tu_intensity: intensity,\n\t\t\t\t\tu_resolution: [tex.width, tex.height],\n\t\t\t\t\tu_iResolution: [1 / tex.width, 1 / tex.height]\n\t\t\t\t})\n\t\t\t\t.draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._temp_texture);\n\t};\n\n\t//from https://www.shadertoy.com/view/MsXSz4\n\tLGraphTextureKuwaharaFilter.pixel_shader =\n\t\t\"\\n\\\nprecision highp float;\\n\\\nvarying vec2 v_coord;\\n\\\nuniform sampler2D u_texture;\\n\\\nuniform float u_intensity;\\n\\\nuniform vec2 u_resolution;\\n\\\nuniform vec2 u_iResolution;\\n\\\n#ifndef RADIUS\\n\\\n\t#define RADIUS 7\\n\\\n#endif\\n\\\nvoid main() {\\n\\\n\\n\\\n\tconst int radius = RADIUS;\\n\\\n\tvec2 fragCoord = v_coord;\\n\\\n\tvec2 src_size = u_iResolution;\\n\\\n\tvec2 uv = v_coord;\\n\\\n\tfloat n = float((radius + 1) * (radius + 1));\\n\\\n\tint i;\\n\\\n\tint j;\\n\\\n\tvec3 m0 = vec3(0.0); vec3 m1 = vec3(0.0); vec3 m2 = vec3(0.0); vec3 m3 = vec3(0.0);\\n\\\n\tvec3 s0 = vec3(0.0); vec3 s1 = vec3(0.0); vec3 s2 = vec3(0.0); vec3 s3 = vec3(0.0);\\n\\\n\tvec3 c;\\n\\\n\t\\n\\\n\tfor (int j = -radius; j <= 0; ++j)  {\\n\\\n\t\tfor (int i = -radius; i <= 0; ++i)  {\\n\\\n\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\\n\\\n\t\t\tm0 += c;\\n\\\n\t\t\ts0 += c * c;\\n\\\n\t\t}\\n\\\n\t}\\n\\\n\t\\n\\\n\tfor (int j = -radius; j <= 0; ++j)  {\\n\\\n\t\tfor (int i = 0; i <= radius; ++i)  {\\n\\\n\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\\n\\\n\t\t\tm1 += c;\\n\\\n\t\t\ts1 += c * c;\\n\\\n\t\t}\\n\\\n\t}\\n\\\n\t\\n\\\n\tfor (int j = 0; j <= radius; ++j)  {\\n\\\n\t\tfor (int i = 0; i <= radius; ++i)  {\\n\\\n\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\\n\\\n\t\t\tm2 += c;\\n\\\n\t\t\ts2 += c * c;\\n\\\n\t\t}\\n\\\n\t}\\n\\\n\t\\n\\\n\tfor (int j = 0; j <= radius; ++j)  {\\n\\\n\t\tfor (int i = -radius; i <= 0; ++i)  {\\n\\\n\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\\n\\\n\t\t\tm3 += c;\\n\\\n\t\t\ts3 += c * c;\\n\\\n\t\t}\\n\\\n\t}\\n\\\n\t\\n\\\n\tfloat min_sigma2 = 1e+2;\\n\\\n\tm0 /= n;\\n\\\n\ts0 = abs(s0 / n - m0 * m0);\\n\\\n\t\\n\\\n\tfloat sigma2 = s0.r + s0.g + s0.b;\\n\\\n\tif (sigma2 < min_sigma2) {\\n\\\n\t\tmin_sigma2 = sigma2;\\n\\\n\t\tgl_FragColor = vec4(m0, 1.0);\\n\\\n\t}\\n\\\n\t\\n\\\n\tm1 /= n;\\n\\\n\ts1 = abs(s1 / n - m1 * m1);\\n\\\n\t\\n\\\n\tsigma2 = s1.r + s1.g + s1.b;\\n\\\n\tif (sigma2 < min_sigma2) {\\n\\\n\t\tmin_sigma2 = sigma2;\\n\\\n\t\tgl_FragColor = vec4(m1, 1.0);\\n\\\n\t}\\n\\\n\t\\n\\\n\tm2 /= n;\\n\\\n\ts2 = abs(s2 / n - m2 * m2);\\n\\\n\t\\n\\\n\tsigma2 = s2.r + s2.g + s2.b;\\n\\\n\tif (sigma2 < min_sigma2) {\\n\\\n\t\tmin_sigma2 = sigma2;\\n\\\n\t\tgl_FragColor = vec4(m2, 1.0);\\n\\\n\t}\\n\\\n\t\\n\\\n\tm3 /= n;\\n\\\n\ts3 = abs(s3 / n - m3 * m3);\\n\\\n\t\\n\\\n\tsigma2 = s3.r + s3.g + s3.b;\\n\\\n\tif (sigma2 < min_sigma2) {\\n\\\n\t\tmin_sigma2 = sigma2;\\n\\\n\t\tgl_FragColor = vec4(m3, 1.0);\\n\\\n\t}\\n\\\n}\\n\\\n\";\n\n\tLiteGraph.registerNodeType(\n\t\t\"texture/kuwahara\",\n\t\tLGraphTextureKuwaharaFilter\n\t);\n\n\t// Texture  *****************************************\n\tfunction LGraphTextureXDoGFilter() {\n\t\tthis.addInput(\"Texture\", \"Texture\");\n\t\tthis.addOutput(\"Filtered\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tsigma: 1.4,\n\t\t\tk: 1.6,\n\t\t\tp: 21.7,\n\t\t\tepsilon: 79,\n\t\t\tphi: 0.017\n\t\t};\n\t}\n\n\tLGraphTextureXDoGFilter.title = \"XDoG Filter\";\n\tLGraphTextureXDoGFilter.desc =\n\t\t\"Filters a texture giving an artistic ink style\";\n\n\tLGraphTextureXDoGFilter.max_radius = 10;\n\tLGraphTextureXDoGFilter._shaders = [];\n\n\tLGraphTextureXDoGFilter.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar temp = this._temp_texture;\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.width != tex.width ||\n\t\t\ttemp.height != tex.height ||\n\t\t\ttemp.type != tex.type\n\t\t) {\n\t\t\tthis._temp_texture = new GL.Texture(tex.width, tex.height, {\n\t\t\t\ttype: tex.type,\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tif (!LGraphTextureXDoGFilter._xdog_shader) {\n\t\t\tLGraphTextureXDoGFilter._xdog_shader = new GL.Shader(\n\t\t\t\tShader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureXDoGFilter.xdog_pixel_shader\n\t\t\t);\n\t\t}\n\t\tvar shader = LGraphTextureXDoGFilter._xdog_shader;\n\t\tvar mesh = GL.Mesh.getScreenQuad();\n\n\t\tvar sigma = this.properties.sigma;\n\t\tvar k = this.properties.k;\n\t\tvar p = this.properties.p;\n\t\tvar epsilon = this.properties.epsilon;\n\t\tvar phi = this.properties.phi;\n\t\ttex.bind(0);\n\t\tthis._temp_texture.drawTo(function() {\n\t\t\tshader\n\t\t\t\t.uniforms({\n\t\t\t\t\tsrc: 0,\n\t\t\t\t\tsigma: sigma,\n\t\t\t\t\tk: k,\n\t\t\t\t\tp: p,\n\t\t\t\t\tepsilon: epsilon,\n\t\t\t\t\tphi: phi,\n\t\t\t\t\tcvsWidth: tex.width,\n\t\t\t\t\tcvsHeight: tex.height\n\t\t\t\t})\n\t\t\t\t.draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._temp_texture);\n\t};\n\n\t//from https://github.com/RaymondMcGuire/GPU-Based-Image-Processing-Tools/blob/master/lib_webgl/scripts/main.js\n\tLGraphTextureXDoGFilter.xdog_pixel_shader =\n\t\t\"\\n\\\nprecision highp float;\\n\\\nuniform sampler2D src;\\n\\n\\\nuniform float cvsHeight;\\n\\\nuniform float cvsWidth;\\n\\n\\\nuniform float sigma;\\n\\\nuniform float k;\\n\\\nuniform float p;\\n\\\nuniform float epsilon;\\n\\\nuniform float phi;\\n\\\nvarying vec2 v_coord;\\n\\n\\\nfloat cosh(float val)\\n\\\n{\\n\\\n\tfloat tmp = exp(val);\\n\\\n\tfloat cosH = (tmp + 1.0 / tmp) / 2.0;\\n\\\n\treturn cosH;\\n\\\n}\\n\\n\\\nfloat tanh(float val)\\n\\\n{\\n\\\n\tfloat tmp = exp(val);\\n\\\n\tfloat tanH = (tmp - 1.0 / tmp) / (tmp + 1.0 / tmp);\\n\\\n\treturn tanH;\\n\\\n}\\n\\n\\\nfloat sinh(float val)\\n\\\n{\\n\\\n\tfloat tmp = exp(val);\\n\\\n\tfloat sinH = (tmp - 1.0 / tmp) / 2.0;\\n\\\n\treturn sinH;\\n\\\n}\\n\\n\\\nvoid main(void){\\n\\\n\tvec3 destColor = vec3(0.0);\\n\\\n\tfloat tFrag = 1.0 / cvsHeight;\\n\\\n\tfloat sFrag = 1.0 / cvsWidth;\\n\\\n\tvec2 Frag = vec2(sFrag,tFrag);\\n\\\n\tvec2 uv = gl_FragCoord.st;\\n\\\n\tfloat twoSigmaESquared = 2.0 * sigma * sigma;\\n\\\n\tfloat twoSigmaRSquared = twoSigmaESquared * k * k;\\n\\\n\tint halfWidth = int(ceil( 1.0 * sigma * k ));\\n\\n\\\n\tconst int MAX_NUM_ITERATION = 99999;\\n\\\n\tvec2 sum = vec2(0.0);\\n\\\n\tvec2 norm = vec2(0.0);\\n\\n\\\n\tfor(int cnt=0;cnt<MAX_NUM_ITERATION;cnt++){\\n\\\n\t\tif(cnt > (2*halfWidth+1)*(2*halfWidth+1)){break;}\\n\\\n\t\tint i = int(cnt / (2*halfWidth+1)) - halfWidth;\\n\\\n\t\tint j = cnt - halfWidth - int(cnt / (2*halfWidth+1)) * (2*halfWidth+1);\\n\\n\\\n\t\tfloat d = length(vec2(i,j));\\n\\\n\t\tvec2 kernel = vec2( exp( -d * d / twoSigmaESquared ), \\n\\\n\t\t\t\t\t\t\texp( -d * d / twoSigmaRSquared ));\\n\\n\\\n\t\tvec2 L = texture2D(src, (uv + vec2(i,j)) * Frag).xx;\\n\\n\\\n\t\tnorm += kernel;\\n\\\n\t\tsum += kernel * L;\\n\\\n\t}\\n\\n\\\n\tsum /= norm;\\n\\n\\\n\tfloat H = 100.0 * ((1.0 + p) * sum.x - p * sum.y);\\n\\\n\tfloat edge = ( H > epsilon )? 1.0 : 1.0 + tanh( phi * (H - epsilon));\\n\\\n\tdestColor = vec3(edge);\\n\\\n\tgl_FragColor = vec4(destColor, 1.0);\\n\\\n}\";\n\n\tLiteGraph.registerNodeType(\"texture/xDoG\", LGraphTextureXDoGFilter);\n\n\t// Texture Webcam *****************************************\n\tfunction LGraphTextureWebcam() {\n\t\tthis.addOutput(\"Webcam\", \"Texture\");\n\t\tthis.properties = { texture_name: \"\", facingMode: \"user\" };\n\t\tthis.boxcolor = \"black\";\n\t\tthis.version = 0;\n\t}\n\n\tLGraphTextureWebcam.title = \"Webcam\";\n\tLGraphTextureWebcam.desc = \"Webcam texture\";\n\n\tLGraphTextureWebcam.is_webcam_open = false;\n\n\tLGraphTextureWebcam.prototype.openStream = function() {\n\t\tif (!navigator.getUserMedia) {\n\t\t\t//console.log('getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags');\n\t\t\treturn;\n\t\t}\n\n\t\tthis._waiting_confirmation = true;\n\n\t\t// Not showing vendor prefixes.\n\t\tvar constraints = {\n\t\t\taudio: false,\n\t\t\tvideo: { facingMode: this.properties.facingMode }\n\t\t};\n\t\tnavigator.mediaDevices\n\t\t\t.getUserMedia(constraints)\n\t\t\t.then(this.streamReady.bind(this))\n\t\t\t.catch(onFailSoHard);\n\n\t\tvar that = this;\n\t\tfunction onFailSoHard(e) {\n\t\t\tLGraphTextureWebcam.is_webcam_open = false;\n\t\t\tconsole.log(\"Webcam rejected\", e);\n\t\t\tthat._webcam_stream = false;\n\t\t\tthat.boxcolor = \"red\";\n\t\t\tthat.trigger(\"stream_error\");\n\t\t}\n\t};\n\n\tLGraphTextureWebcam.prototype.closeStream = function() {\n\t\tif (this._webcam_stream) {\n\t\t\tvar tracks = this._webcam_stream.getTracks();\n\t\t\tif (tracks.length) {\n\t\t\t\tfor (var i = 0; i < tracks.length; ++i) {\n\t\t\t\t\ttracks[i].stop();\n\t\t\t\t}\n\t\t\t}\n\t\t\tLGraphTextureWebcam.is_webcam_open = false;\n\t\t\tthis._webcam_stream = null;\n\t\t\tthis._video = null;\n\t\t\tthis.boxcolor = \"black\";\n\t\t\tthis.trigger(\"stream_closed\");\n\t\t}\n\t};\n\n\tLGraphTextureWebcam.prototype.streamReady = function(localMediaStream) {\n\t\tthis._webcam_stream = localMediaStream;\n\t\t//this._waiting_confirmation = false;\n\t\tthis.boxcolor = \"green\";\n\t\tvar video = this._video;\n\t\tif (!video) {\n\t\t\tvideo = document.createElement(\"video\");\n\t\t\tvideo.autoplay = true;\n\t\t\tvideo.srcObject = localMediaStream;\n\t\t\tthis._video = video;\n\t\t\t//document.body.appendChild( video ); //debug\n\t\t\t//when video info is loaded (size and so)\n\t\t\tvideo.onloadedmetadata = function(e) {\n\t\t\t\t// Ready to go. Do some stuff.\n\t\t\t\tLGraphTextureWebcam.is_webcam_open = true;\n\t\t\t\tconsole.log(e);\n\t\t\t};\n\t\t}\n\t\tthis.trigger(\"stream_ready\", video);\n\t};\n\n\tLGraphTextureWebcam.prototype.onPropertyChanged = function(\n\t\tname,\n\t\tvalue\n\t) {\n\t\tif (name == \"facingMode\") {\n\t\t\tthis.properties.facingMode = value;\n\t\t\tthis.closeStream();\n\t\t\tthis.openStream();\n\t\t}\n\t};\n\n\tLGraphTextureWebcam.prototype.onRemoved = function() {\n\t\tif (!this._webcam_stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar tracks = this._webcam_stream.getTracks();\n\t\tif (tracks.length) {\n\t\t\tfor (var i = 0; i < tracks.length; ++i) {\n\t\t\t\ttracks[i].stop();\n\t\t\t}\n\t\t}\n\n\t\tthis._webcam_stream = null;\n\t\tthis._video = null;\n\t};\n\n\tLGraphTextureWebcam.prototype.onDrawBackground = function(ctx) {\n\t\tif (this.flags.collapsed || this.size[1] <= 20) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._video) {\n\t\t\treturn;\n\t\t}\n\n\t\t//render to graph canvas\n\t\tctx.save();\n\t\tif (!ctx.webgl) {\n\t\t\t//reverse image\n\t\t\tctx.drawImage(this._video, 0, 0, this.size[0], this.size[1]);\n\t\t} else {\n\t\t\tif (this._video_texture) {\n\t\t\t\tctx.drawImage(\n\t\t\t\t\tthis._video_texture,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\tthis.size[0],\n\t\t\t\t\tthis.size[1]\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tctx.restore();\n\t};\n\n\tLGraphTextureWebcam.prototype.onExecute = function() {\n\t\tif (this._webcam_stream == null && !this._waiting_confirmation) {\n\t\t\tthis.openStream();\n\t\t}\n\n\t\tif (!this._video || !this._video.videoWidth) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar width = this._video.videoWidth;\n\t\tvar height = this._video.videoHeight;\n\n\t\tvar temp = this._video_texture;\n\t\tif (!temp || temp.width != width || temp.height != height) {\n\t\t\tthis._video_texture = new GL.Texture(width, height, {\n\t\t\t\tformat: gl.RGB,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tthis._video_texture.uploadImage(this._video);\n\t\tthis._video_texture.version = ++this.version;\n\n\t\tif (this.properties.texture_name) {\n\t\t\tvar container = LGraphTexture.getTexturesContainer();\n\t\t\tcontainer[this.properties.texture_name] = this._video_texture;\n\t\t}\n\n\t\tthis.setOutputData(0, this._video_texture);\n\t\tfor (var i = 1; i < this.outputs.length; ++i) {\n\t\t\tif (!this.outputs[i]) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tswitch (this.outputs[i].name) {\n\t\t\t\tcase \"width\":\n\t\t\t\t\tthis.setOutputData(i, this._video.videoWidth);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"height\":\n\t\t\t\t\tthis.setOutputData(i, this._video.videoHeight);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\n\tLGraphTextureWebcam.prototype.onGetOutputs = function() {\n\t\treturn [\n\t\t\t[\"width\", \"number\"],\n\t\t\t[\"height\", \"number\"],\n\t\t\t[\"stream_ready\", LiteGraph.EVENT],\n\t\t\t[\"stream_closed\", LiteGraph.EVENT],\n\t\t\t[\"stream_error\", LiteGraph.EVENT]\n\t\t];\n\t};\n\n\tLiteGraph.registerNodeType(\"texture/webcam\", LGraphTextureWebcam);\n\n\t//from https://github.com/spite/Wagner\n\tfunction LGraphLensFX() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addInput(\"f\", \"number\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tenabled: true,\n\t\t\tfactor: 1,\n\t\t\tprecision: LGraphTexture.LOW\n\t\t};\n\n\t\tthis._uniforms = { u_texture: 0, u_factor: 1 };\n\t}\n\n\tLGraphLensFX.title = \"Lens FX\";\n\tLGraphLensFX.desc = \"distortion and chromatic aberration\";\n\n\tLGraphLensFX.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphLensFX.prototype.onGetInputs = function() {\n\t\treturn [[\"enabled\", \"boolean\"]];\n\t};\n\n\tLGraphLensFX.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (\n\t\t\tthis.properties.precision === LGraphTexture.PASS_THROUGH ||\n\t\t\tthis.getInputOrProperty(\"enabled\") === false\n\t\t) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar temp = this._temp_texture;\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.width != tex.width ||\n\t\t\ttemp.height != tex.height ||\n\t\t\ttemp.type != tex.type\n\t\t) {\n\t\t\ttemp = this._temp_texture = new GL.Texture(\n\t\t\t\ttex.width,\n\t\t\t\ttex.height,\n\t\t\t\t{ type: tex.type, format: gl.RGBA, filter: gl.LINEAR }\n\t\t\t);\n\t\t}\n\n\t\tvar shader = LGraphLensFX._shader;\n\t\tif (!shader) {\n\t\t\tshader = LGraphLensFX._shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphLensFX.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tvar factor = this.getInputData(1);\n\t\tif (factor == null) {\n\t\t\tfactor = this.properties.factor;\n\t\t}\n\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_factor = factor;\n\n\t\t//apply shader\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\ttemp.drawTo(function() {\n\t\t\ttex.bind(0);\n\t\t\tshader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad());\n\t\t});\n\n\t\tthis.setOutputData(0, temp);\n\t};\n\n\tLGraphLensFX.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform float u_factor;\\n\\\n\t\tvec2 barrelDistortion(vec2 coord, float amt) {\\n\\\n\t\t\tvec2 cc = coord - 0.5;\\n\\\n\t\t\tfloat dist = dot(cc, cc);\\n\\\n\t\t\treturn coord + cc * dist * amt;\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tfloat sat( float t )\\n\\\n\t\t{\\n\\\n\t\t\treturn clamp( t, 0.0, 1.0 );\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tfloat linterp( float t ) {\\n\\\n\t\t\treturn sat( 1.0 - abs( 2.0*t - 1.0 ) );\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tfloat remap( float t, float a, float b ) {\\n\\\n\t\t\treturn sat( (t - a) / (b - a) );\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tvec4 spectrum_offset( float t ) {\\n\\\n\t\t\tvec4 ret;\\n\\\n\t\t\tfloat lo = step(t,0.5);\\n\\\n\t\t\tfloat hi = 1.0-lo;\\n\\\n\t\t\tfloat w = linterp( remap( t, 1.0/6.0, 5.0/6.0 ) );\\n\\\n\t\t\tret = vec4(lo,1.0,hi, 1.) * vec4(1.0-w, w, 1.0-w, 1.);\\n\\\n\t\t\\n\\\n\t\t\treturn pow( ret, vec4(1.0/2.2) );\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tconst float max_distort = 2.2;\\n\\\n\t\tconst int num_iter = 12;\\n\\\n\t\tconst float reci_num_iter_f = 1.0 / float(num_iter);\\n\\\n\t\t\\n\\\n\t\tvoid main()\\n\\\n\t\t{\t\\n\\\n\t\t\tvec2 uv=v_coord;\\n\\\n\t\t\tvec4 sumcol = vec4(0.0);\\n\\\n\t\t\tvec4 sumw = vec4(0.0);\t\\n\\\n\t\t\tfor ( int i=0; i<num_iter;++i )\\n\\\n\t\t\t{\\n\\\n\t\t\t\tfloat t = float(i) * reci_num_iter_f;\\n\\\n\t\t\t\tvec4 w = spectrum_offset( t );\\n\\\n\t\t\t\tsumw += w;\\n\\\n\t\t\t\tsumcol += w * texture2D( u_texture, barrelDistortion(uv, .6 * max_distort*t * u_factor ) );\\n\\\n\t\t\t}\\n\\\n\t\t\tgl_FragColor = sumcol / sumw;\\n\\\n\t\t}\";\n\n\tLiteGraph.registerNodeType(\"texture/lensfx\", LGraphLensFX);\n\n\n\tfunction LGraphTextureFromData() {\n\t\tthis.addInput(\"in\", \"\");\n\t\tthis.properties = { precision: LGraphTexture.LOW, width: 0, height: 0, channels: 1 };\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t}\n\n\tLGraphTextureFromData.title = \"Data->Tex\";\n\tLGraphTextureFromData.desc = \"Generates or applies a curve to a texture\";\n\tLGraphTextureFromData.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureFromData.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar data = this.getInputData(0);\n\t\tif(!data)\n\t\t\treturn;\n\n\t\tvar channels = this.properties.channels;\n\t\tvar w = this.properties.width;\n\t\tvar h = this.properties.height;\n\t\tif(!w || !h)\n\t\t{\n\t\t\tw = Math.floor(data.length / channels);\n\t\t\th = 1;\n\t\t}\n\t\tvar format = gl.RGBA;\n\t\tif( channels == 3 )\n\t\t\tformat = gl.RGB;\n\t\telse if( channels == 1 )\n\t\t\tformat = gl.LUMINANCE;\n\n\t\tvar temp = this._temp_texture;\n\t\tvar type = LGraphTexture.getTextureType( this.properties.precision );\n\t\tif ( !temp || temp.width != w || temp.height != h || temp.type != type ) {\n\t\t\ttemp = this._temp_texture = new GL.Texture( w, h, { type: type, format: format, filter: gl.LINEAR } );\n\t\t}\n\n\t\ttemp.uploadData( data );\n\t\tthis.setOutputData(0, temp);\n\t}\n\n\tLiteGraph.registerNodeType(\"texture/fromdata\", LGraphTextureFromData);\n\n\t//applies a curve (or generates one)\n\tfunction LGraphTextureCurve() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = { precision: LGraphTexture.LOW, split_channels: false };\n\t\tthis._values = new Uint8Array(256*4);\n\t\tthis._values.fill(255);\n\t\tthis._curve_texture = null;\n\t\tthis._uniforms = { u_texture: 0, u_curve: 1, u_range: 1.0 };\n\t\tthis._must_update = true;\n\t\tthis._points = {\n\t\t\tRGB: [[0,0],[1,1]],\n\t\t\tR: [[0,0],[1,1]],\n\t\t\tG: [[0,0],[1,1]],\n\t\t\tB: [[0,0],[1,1]]\n\t\t};\n\t\tthis.curve_editor = null;\n\t\tthis.addWidget(\"toggle\",\"Split Channels\",false,\"split_channels\");\n\t\tthis.addWidget(\"combo\",\"Channel\",\"RGB\",{ values:[\"RGB\",\"R\",\"G\",\"B\"]});\n\t\tthis.curve_offset = 68;\n\t\tthis.size = [ 240, 160 ];\n\t}\n\n\tLGraphTextureCurve.title = \"Curve\";\n\tLGraphTextureCurve.desc = \"Generates or applies a curve to a texture\";\n\tLGraphTextureCurve.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureCurve.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar tex = this.getInputData(0);\n\n\t\tvar temp = this._temp_texture;\n\t\tif(!tex) //generate one texture, nothing else\n\t\t{\n\t\t\tif(this._must_update || !this._curve_texture )\n\t\t\t\tthis.updateCurve();\n\t\t\tthis.setOutputData(0, this._curve_texture);\n\t\t\treturn;\n\t\t}\n\n\t\tvar type = LGraphTexture.getTextureType( this.properties.precision, tex );\n\t\t\n\t\t//apply curve to input texture\n\t\tif ( !temp || temp.type != type || temp.width != tex.width || temp.height != tex.height || temp.format != tex.format)\n\t\t\ttemp = this._temp_texture = new GL.Texture( tex.width, tex.height, { type: type, format: tex.format, filter: gl.LINEAR } );\n\n\t\tvar shader = LGraphTextureCurve._shader;\n\t\tif (!shader) {\n\t\t\tshader = LGraphTextureCurve._shader = new GL.Shader( GL.Shader.SCREEN_VERTEX_SHADER, LGraphTextureCurve.pixel_shader );\n\t\t}\n\n\t\tif(this._must_update || !this._curve_texture )\n\t\t\tthis.updateCurve();\n\n\t\tvar uniforms = this._uniforms;\n\t\tvar curve_texture = this._curve_texture;\n\n\t\t//apply shader\n\t\ttemp.drawTo(function() {\n\t\t\tgl.disable(gl.DEPTH_TEST);\n\t\t\ttex.bind(0);\n\t\t\tcurve_texture.bind(1);\n\t\t\tshader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad());\n\t\t});\n\n\t\tthis.setOutputData(0, temp);\n\t}\n\n\tLGraphTextureCurve.prototype.sampleCurve = function(f,points)\n\t{\n\t\tvar points = points || this._points.RGB;\n\t\tif(!points)\n\t\t\treturn;\n\t\tfor(var i = 0; i < points.length - 1; ++i)\n\t\t{\n\t\t\tvar p = points[i];\n\t\t\tvar pn = points[i+1];\n\t\t\tif(pn[0] < f)\n\t\t\t\tcontinue;\n\t\t\tvar r = (pn[0] - p[0]);\n\t\t\tif( Math.abs(r) < 0.00001 )\n\t\t\t\treturn p[1];\n\t\t\tvar local_f = (f - p[0]) / r;\n\t\t\treturn p[1] * (1.0 - local_f) + pn[1] * local_f;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tLGraphTextureCurve.prototype.updateCurve = function()\n\t{\n\t\tvar values = this._values;\n\t\tvar num = values.length / 4;\n\t\tvar split = this.properties.split_channels;\n\t\tfor(var i = 0; i < num; ++i)\n\t\t{\n\t\t\tif(split)\n\t\t\t{\n\t\t\t\tvalues[i*4] = clamp( this.sampleCurve(i/num,this._points.R)*255,0,255);\n\t\t\t\tvalues[i*4+1] = clamp( this.sampleCurve(i/num,this._points.G)*255,0,255);\n\t\t\t\tvalues[i*4+2] = clamp( this.sampleCurve(i/num,this._points.B)*255,0,255);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvar v = this.sampleCurve(i/num);//sample curve\n\t\t\t\tvalues[i*4] = values[i*4+1] = values[i*4+2] = clamp(v*255,0,255);\n\t\t\t}\n\t\t\tvalues[i*4+3] = 255; //alpha fixed\n\t\t}\n\t\tif(!this._curve_texture)\n\t\t\tthis._curve_texture = new GL.Texture(256,1,{ format: gl.RGBA, magFilter: gl.LINEAR, wrap: gl.CLAMP_TO_EDGE });\n\t\tthis._curve_texture.uploadData(values,null,true);\n\t}\n\n\tLGraphTextureCurve.prototype.onSerialize = function(o)\n\t{\n\t\tvar curves = {};\n\t\tfor(var i in this._points)\n\t\t\tcurves[i] = this._points[i].concat();\n\t\to.curves = curves;\n\t}\n\n\tLGraphTextureCurve.prototype.onConfigure = function(o)\n\t{\n\t\tthis._points = o.curves;\n\t\tif(this.curve_editor)\n\t\t\tcurve_editor.points = this._points;\n\t\tthis._must_update = true;\n\t}\n\n\tLGraphTextureCurve.prototype.onMouseDown = function(e, localpos, graphcanvas)\n\t{\n\t\tif(this.curve_editor)\n\t\t{\n\t\t\tvar r = this.curve_editor.onMouseDown([localpos[0],localpos[1]-this.curve_offset], graphcanvas);\n\t\t\tif(r)\n\t\t\t\tthis.captureInput(true);\n\t\t\treturn r;\n\t\t}\n\t}\n\n\tLGraphTextureCurve.prototype.onMouseMove = function(e, localpos, graphcanvas)\n\t{\n\t\tif(this.curve_editor)\n\t\t\treturn this.curve_editor.onMouseMove([localpos[0],localpos[1]-this.curve_offset], graphcanvas);\n\t}\n\n\tLGraphTextureCurve.prototype.onMouseUp = function(e, localpos, graphcanvas)\n\t{\n\t\tif(this.curve_editor)\n\t\t\treturn this.curve_editor.onMouseUp([localpos[0],localpos[1]-this.curve_offset], graphcanvas);\n\t\tthis.captureInput(false);\n\t}\n\n\tLGraphTextureCurve.channel_line_colors = { \"RGB\":\"#666\",\"R\":\"#F33\",\"G\":\"#3F3\",\"B\":\"#33F\" };\n\n\tLGraphTextureCurve.prototype.onDrawBackground = function(ctx, graphcanvas)\n\t{\n\t\tif(this.flags.collapsed)\n\t\t\treturn;\n\n\t\tif(!this.curve_editor)\n\t\t\tthis.curve_editor = new LiteGraph.CurveEditor(this._points.R);\n\t\tctx.save();\n\t\tctx.translate(0,this.curve_offset);\n\t\tvar channel = this.widgets[1].value;\n\n\t\tif(this.properties.split_channels)\n\t\t{\n\t\t\tif(channel == \"RGB\")\n\t\t\t{\n\t\t\t\tthis.widgets[1].value = channel = \"R\";\n\t\t\t\tthis.widgets[1].disabled = false;\n\t\t\t}\n\t\t\tthis.curve_editor.points = this._points.R;\n\t\t\tthis.curve_editor.draw( ctx, [this.size[0],this.size[1] - this.curve_offset], graphcanvas, \"#111\", LGraphTextureCurve.channel_line_colors.R, true );\n\t\t\tctx.globalCompositeOperation = \"lighten\";\n\t\t\tthis.curve_editor.points = this._points.G;\n\t\t\tthis.curve_editor.draw( ctx, [this.size[0],this.size[1] - this.curve_offset], graphcanvas, null, LGraphTextureCurve.channel_line_colors.G, true );\n\t\t\tthis.curve_editor.points = this._points.B;\n\t\t\tthis.curve_editor.draw( ctx, [this.size[0],this.size[1] - this.curve_offset], graphcanvas, null, LGraphTextureCurve.channel_line_colors.B, true );\n\t\t\tctx.globalCompositeOperation = \"source-over\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.widgets[1].value = channel = \"RGB\";\n\t\t\tthis.widgets[1].disabled = true;\n\t\t}\n\n\t\tthis.curve_editor.points = this._points[channel];\n\t\tthis.curve_editor.draw( ctx, [this.size[0],this.size[1] - this.curve_offset], graphcanvas, this.properties.split_channels ? null : \"#111\", LGraphTextureCurve.channel_line_colors[channel]  );\n\t\tctx.restore();\n\t}\n\n\tLGraphTextureCurve.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform sampler2D u_curve;\\n\\\n\t\tuniform float u_range;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = texture2D( u_texture, v_coord ) * u_range;\\n\\\n\t\t\tcolor.x = texture2D( u_curve, vec2( color.x, 0.5 ) ).x;\\n\\\n\t\t\tcolor.y = texture2D( u_curve, vec2( color.y, 0.5 ) ).y;\\n\\\n\t\t\tcolor.z = texture2D( u_curve, vec2( color.z, 0.5 ) ).z;\\n\\\n\t\t\t//color.w = texture2D( u_curve, vec2( color.w, 0.5 ) ).w;\\n\\\n\t\t\tgl_FragColor = color;\\n\\\n\t\t}\";\n\n\tLiteGraph.registerNodeType(\"texture/curve\", LGraphTextureCurve);\n\n\t//simple exposition, but plan to expand it to support different gamma curves\n\tfunction LGraphExposition() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addInput(\"exp\", \"number\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = { exposition: 1, precision: LGraphTexture.LOW };\n\t\tthis._uniforms = { u_texture: 0, u_exposition: 1 };\n\t}\n\n\tLGraphExposition.title = \"Exposition\";\n\tLGraphExposition.desc = \"Controls texture exposition\";\n\n\tLGraphExposition.widgets_info = {\n\t\texposition: { widget: \"slider\", min: 0, max: 3 },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphExposition.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar temp = this._temp_texture;\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.width != tex.width ||\n\t\t\ttemp.height != tex.height ||\n\t\t\ttemp.type != tex.type\n\t\t) {\n\t\t\ttemp = this._temp_texture = new GL.Texture(\n\t\t\t\ttex.width,\n\t\t\t\ttex.height,\n\t\t\t\t{ type: tex.type, format: gl.RGBA, filter: gl.LINEAR }\n\t\t\t);\n\t\t}\n\n\t\tvar shader = LGraphExposition._shader;\n\t\tif (!shader) {\n\t\t\tshader = LGraphExposition._shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphExposition.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tvar exp = this.properties.exposition;\n\t\tvar exp_input = this.getInputData(1);\n\t\tif (exp_input != null) {\n\t\t\texp = this.properties.exposition = exp_input;\n\t\t}\n\t\tvar uniforms = this._uniforms;\n\n\t\t//apply shader\n\t\ttemp.drawTo(function() {\n\t\t\tgl.disable(gl.DEPTH_TEST);\n\t\t\ttex.bind(0);\n\t\t\tshader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad());\n\t\t});\n\n\t\tthis.setOutputData(0, temp);\n\t};\n\n\tLGraphExposition.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform float u_exposition;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = texture2D( u_texture, v_coord );\\n\\\n\t\t\tgl_FragColor = vec4( color.xyz * u_exposition, color.a );\\n\\\n\t\t}\";\n\n\tLiteGraph.registerNodeType(\"texture/exposition\", LGraphExposition);\n\n\tfunction LGraphToneMapping() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\t\tthis.addInput(\"avg\", \"number,Texture\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tenabled: true,\n\t\t\tscale: 1,\n\t\t\tgamma: 1,\n\t\t\taverage_lum: 1,\n\t\t\tlum_white: 1,\n\t\t\tprecision: LGraphTexture.LOW\n\t\t};\n\n\t\tthis._uniforms = {\n\t\t\tu_texture: 0,\n\t\t\tu_lumwhite2: 1,\n\t\t\tu_igamma: 1,\n\t\t\tu_scale: 1,\n\t\t\tu_average_lum: 1\n\t\t};\n\t}\n\n\tLGraphToneMapping.title = \"Tone Mapping\";\n\tLGraphToneMapping.desc =\n\t\t\"Applies Tone Mapping to convert from high to low\";\n\n\tLGraphToneMapping.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphToneMapping.prototype.onGetInputs = function() {\n\t\treturn [[\"enabled\", \"boolean\"]];\n\t};\n\n\tLGraphToneMapping.prototype.onExecute = function() {\n\t\tvar tex = this.getInputData(0);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tif (\n\t\t\tthis.properties.precision === LGraphTexture.PASS_THROUGH ||\n\t\t\tthis.getInputOrProperty(\"enabled\") === false\n\t\t) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tvar temp = this._temp_texture;\n\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.width != tex.width ||\n\t\t\ttemp.height != tex.height ||\n\t\t\ttemp.type != tex.type\n\t\t) {\n\t\t\ttemp = this._temp_texture = new GL.Texture(\n\t\t\t\ttex.width,\n\t\t\t\ttex.height,\n\t\t\t\t{ type: tex.type, format: gl.RGBA, filter: gl.LINEAR }\n\t\t\t);\n\t\t}\n\n\t\tvar avg = this.getInputData(1);\n\t\tif (avg == null) {\n\t\t\tavg = this.properties.average_lum;\n\t\t}\n\n\t\tvar uniforms = this._uniforms;\n\t\tvar shader = null;\n\n\t\tif (avg.constructor === Number) {\n\t\t\tthis.properties.average_lum = avg;\n\t\t\tuniforms.u_average_lum = this.properties.average_lum;\n\t\t\tshader = LGraphToneMapping._shader;\n\t\t\tif (!shader) {\n\t\t\t\tshader = LGraphToneMapping._shader = new GL.Shader(\n\t\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\tLGraphToneMapping.pixel_shader\n\t\t\t\t);\n\t\t\t}\n\t\t} else if (avg.constructor === GL.Texture) {\n\t\t\tuniforms.u_average_texture = avg.bind(1);\n\t\t\tshader = LGraphToneMapping._shader_texture;\n\t\t\tif (!shader) {\n\t\t\t\tshader = LGraphToneMapping._shader_texture = new GL.Shader(\n\t\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\t\tLGraphToneMapping.pixel_shader,\n\t\t\t\t\t{ AVG_TEXTURE: \"\" }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tuniforms.u_lumwhite2 =\n\t\t\tthis.properties.lum_white * this.properties.lum_white;\n\t\tuniforms.u_scale = this.properties.scale;\n\t\tuniforms.u_igamma = 1 / this.properties.gamma;\n\n\t\t//apply shader\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\ttemp.drawTo(function() {\n\t\t\ttex.bind(0);\n\t\t\tshader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad());\n\t\t});\n\n\t\tthis.setOutputData(0, this._temp_texture);\n\t};\n\n\tLGraphToneMapping.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform float u_scale;\\n\\\n\t\t#ifdef AVG_TEXTURE\\n\\\n\t\t\tuniform sampler2D u_average_texture;\\n\\\n\t\t#else\\n\\\n\t\t\tuniform float u_average_lum;\\n\\\n\t\t#endif\\n\\\n\t\tuniform float u_lumwhite2;\\n\\\n\t\tuniform float u_igamma;\\n\\\n\t\tvec3 RGB2xyY (vec3 rgb)\\n\\\n\t\t{\\n\\\n\t\t\t const mat3 RGB2XYZ = mat3(0.4124, 0.3576, 0.1805,\\n\\\n\t\t\t\t\t\t\t\t\t   0.2126, 0.7152, 0.0722,\\n\\\n\t\t\t\t\t\t\t\t\t   0.0193, 0.1192, 0.9505);\\n\\\n\t\t\tvec3 XYZ = RGB2XYZ * rgb;\\n\\\n\t\t\t\\n\\\n\t\t\tfloat f = (XYZ.x + XYZ.y + XYZ.z);\\n\\\n\t\t\treturn vec3(XYZ.x / f,\\n\\\n\t\t\t\t\t\tXYZ.y / f,\\n\\\n\t\t\t\t\t\tXYZ.y);\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec4 color = texture2D( u_texture, v_coord );\\n\\\n\t\t\tvec3 rgb = color.xyz;\\n\\\n\t\t\tfloat average_lum = 0.0;\\n\\\n\t\t\t#ifdef AVG_TEXTURE\\n\\\n\t\t\t\tvec3 pixel = texture2D(u_average_texture,vec2(0.5)).xyz;\\n\\\n\t\t\t\taverage_lum = (pixel.x + pixel.y + pixel.z) / 3.0;\\n\\\n\t\t\t#else\\n\\\n\t\t\t\taverage_lum = u_average_lum;\\n\\\n\t\t\t#endif\\n\\\n\t\t\t//Ld - this part of the code is the same for both versions\\n\\\n\t\t\tfloat lum = dot(rgb, vec3(0.2126, 0.7152, 0.0722));\\n\\\n\t\t\tfloat L = (u_scale / average_lum) * lum;\\n\\\n\t\t\tfloat Ld = (L * (1.0 + L / u_lumwhite2)) / (1.0 + L);\\n\\\n\t\t\t//first\\n\\\n\t\t\t//vec3 xyY = RGB2xyY(rgb);\\n\\\n\t\t\t//xyY.z *= Ld;\\n\\\n\t\t\t//rgb = xyYtoRGB(xyY);\\n\\\n\t\t\t//second\\n\\\n\t\t\trgb = (rgb / lum) * Ld;\\n\\\n\t\t\trgb = max(rgb,vec3(0.001));\\n\\\n\t\t\trgb = pow( rgb, vec3( u_igamma ) );\\n\\\n\t\t\tgl_FragColor = vec4( rgb, color.a );\\n\\\n\t\t}\";\n\n\tLiteGraph.registerNodeType(\"texture/tonemapping\", LGraphToneMapping);\n\n\tfunction LGraphTexturePerlin() {\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\twidth: 512,\n\t\t\theight: 512,\n\t\t\tseed: 0,\n\t\t\tpersistence: 0.1,\n\t\t\toctaves: 8,\n\t\t\tscale: 1,\n\t\t\toffset: [0, 0],\n\t\t\tamplitude: 1,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t\tthis._key = 0;\n\t\tthis._texture = null;\n\t\tthis._uniforms = {\n\t\t\tu_persistence: 0.1,\n\t\t\tu_seed: 0,\n\t\t\tu_offset: vec2.create(),\n\t\t\tu_scale: 1,\n\t\t\tu_viewport: vec2.create()\n\t\t};\n\t}\n\n\tLGraphTexturePerlin.title = \"Perlin\";\n\tLGraphTexturePerlin.desc = \"Generates a perlin noise texture\";\n\n\tLGraphTexturePerlin.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES },\n\t\twidth: { type: \"number\", precision: 0, step: 1 },\n\t\theight: { type: \"number\", precision: 0, step: 1 },\n\t\toctaves: { type: \"number\", precision: 0, step: 1, min: 1, max: 50 }\n\t};\n\n\tLGraphTexturePerlin.prototype.onGetInputs = function() {\n\t\treturn [\n\t\t\t[\"seed\", \"number\"],\n\t\t\t[\"persistence\", \"number\"],\n\t\t\t[\"octaves\", \"number\"],\n\t\t\t[\"scale\", \"number\"],\n\t\t\t[\"amplitude\", \"number\"],\n\t\t\t[\"offset\", \"vec2\"]\n\t\t];\n\t};\n\n\tLGraphTexturePerlin.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar w = this.properties.width | 0;\n\t\tvar h = this.properties.height | 0;\n\t\tif (w == 0) {\n\t\t\tw = gl.viewport_data[2];\n\t\t} //0 means default\n\t\tif (h == 0) {\n\t\t\th = gl.viewport_data[3];\n\t\t} //0 means default\n\t\tvar type = LGraphTexture.getTextureType(this.properties.precision);\n\n\t\tvar temp = this._texture;\n\t\tif (\n\t\t\t!temp ||\n\t\t\ttemp.width != w ||\n\t\t\ttemp.height != h ||\n\t\t\ttemp.type != type\n\t\t) {\n\t\t\ttemp = this._texture = new GL.Texture(w, h, {\n\t\t\t\ttype: type,\n\t\t\t\tformat: gl.RGB,\n\t\t\t\tfilter: gl.LINEAR\n\t\t\t});\n\t\t}\n\n\t\tvar persistence = this.getInputOrProperty(\"persistence\");\n\t\tvar octaves = this.getInputOrProperty(\"octaves\");\n\t\tvar offset = this.getInputOrProperty(\"offset\");\n\t\tvar scale = this.getInputOrProperty(\"scale\");\n\t\tvar amplitude = this.getInputOrProperty(\"amplitude\");\n\t\tvar seed = this.getInputOrProperty(\"seed\");\n\n\t\t//reusing old texture\n\t\tvar key =\n\t\t\t\"\" +\n\t\t\tw +\n\t\t\th +\n\t\t\ttype +\n\t\t\tpersistence +\n\t\t\toctaves +\n\t\t\tscale +\n\t\t\tseed +\n\t\t\toffset[0] +\n\t\t\toffset[1] +\n\t\t\tamplitude;\n\t\tif (key == this._key) {\n\t\t\tthis.setOutputData(0, temp);\n\t\t\treturn;\n\t\t}\n\t\tthis._key = key;\n\n\t\t//gather uniforms\n\t\tvar uniforms = this._uniforms;\n\t\tuniforms.u_persistence = persistence;\n\t\tuniforms.u_octaves = octaves;\n\t\tuniforms.u_offset.set(offset);\n\t\tuniforms.u_scale = scale;\n\t\tuniforms.u_amplitude = amplitude;\n\t\tuniforms.u_seed = seed * 128;\n\t\tuniforms.u_viewport[0] = w;\n\t\tuniforms.u_viewport[1] = h;\n\n\t\t//render\n\t\tvar shader = LGraphTexturePerlin._shader;\n\t\tif (!shader) {\n\t\t\tshader = LGraphTexturePerlin._shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTexturePerlin.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\n\t\ttemp.drawTo(function() {\n\t\t\tshader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad());\n\t\t});\n\n\t\tthis.setOutputData(0, temp);\n\t};\n\n\tLGraphTexturePerlin.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform vec2 u_offset;\\n\\\n\t\tuniform float u_scale;\\n\\\n\t\tuniform float u_persistence;\\n\\\n\t\tuniform int u_octaves;\\n\\\n\t\tuniform float u_amplitude;\\n\\\n\t\tuniform vec2 u_viewport;\\n\\\n\t\tuniform float u_seed;\\n\\\n\t\t#define M_PI 3.14159265358979323846\\n\\\n\t\t\\n\\\n\t\tfloat rand(vec2 c){\treturn fract(sin(dot(c.xy ,vec2( 12.9898 + u_seed,78.233 + u_seed))) * 43758.5453); }\\n\\\n\t\t\\n\\\n\t\tfloat noise(vec2 p, float freq ){\\n\\\n\t\t\tfloat unit = u_viewport.x/freq;\\n\\\n\t\t\tvec2 ij = floor(p/unit);\\n\\\n\t\t\tvec2 xy = mod(p,unit)/unit;\\n\\\n\t\t\t//xy = 3.*xy*xy-2.*xy*xy*xy;\\n\\\n\t\t\txy = .5*(1.-cos(M_PI*xy));\\n\\\n\t\t\tfloat a = rand((ij+vec2(0.,0.)));\\n\\\n\t\t\tfloat b = rand((ij+vec2(1.,0.)));\\n\\\n\t\t\tfloat c = rand((ij+vec2(0.,1.)));\\n\\\n\t\t\tfloat d = rand((ij+vec2(1.,1.)));\\n\\\n\t\t\tfloat x1 = mix(a, b, xy.x);\\n\\\n\t\t\tfloat x2 = mix(c, d, xy.x);\\n\\\n\t\t\treturn mix(x1, x2, xy.y);\\n\\\n\t\t}\\n\\\n\t\t\\n\\\n\t\tfloat pNoise(vec2 p, int res){\\n\\\n\t\t\tfloat persistance = u_persistence;\\n\\\n\t\t\tfloat n = 0.;\\n\\\n\t\t\tfloat normK = 0.;\\n\\\n\t\t\tfloat f = 4.;\\n\\\n\t\t\tfloat amp = 1.0;\\n\\\n\t\t\tint iCount = 0;\\n\\\n\t\t\tfor (int i = 0; i<50; i++){\\n\\\n\t\t\t\tn+=amp*noise(p, f);\\n\\\n\t\t\t\tf*=2.;\\n\\\n\t\t\t\tnormK+=amp;\\n\\\n\t\t\t\tamp*=persistance;\\n\\\n\t\t\t\tif (iCount >= res)\\n\\\n\t\t\t\t\tbreak;\\n\\\n\t\t\t\tiCount++;\\n\\\n\t\t\t}\\n\\\n\t\t\tfloat nf = n/normK;\\n\\\n\t\t\treturn nf*nf*nf*nf;\\n\\\n\t\t}\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec2 uv = v_coord * u_scale * u_viewport + u_offset * u_scale;\\n\\\n\t\t\tvec4 color = vec4( pNoise( uv, u_octaves ) * u_amplitude );\\n\\\n\t\t\tgl_FragColor = color;\\n\\\n\t\t}\";\n\n\tLiteGraph.registerNodeType(\"texture/perlin\", LGraphTexturePerlin);\n\n\tfunction LGraphTextureCanvas2D() {\n\t\tthis.addInput(\"v\");\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tcode: LGraphTextureCanvas2D.default_code,\n\t\t\twidth: 512,\n\t\t\theight: 512,\n\t\t\tclear: true,\n\t\t\tprecision: LGraphTexture.DEFAULT,\n\t\t\tuse_html_canvas: false\n\t\t};\n\t\tthis._func = null;\n\t\tthis._temp_texture = null;\n\t\tthis.compileCode();\n\t}\n\n\tLGraphTextureCanvas2D.title = \"Canvas2D\";\n\tLGraphTextureCanvas2D.desc = \"Executes Canvas2D code inside a texture or the viewport.\";\n\tLGraphTextureCanvas2D.help = \"Set width and height to 0 to match viewport size.\";\n\n\tLGraphTextureCanvas2D.default_code = \"//vars: canvas,ctx,time\\nctx.fillStyle='red';\\nctx.fillRect(0,0,50,50);\\n\";\n\n\tLGraphTextureCanvas2D.widgets_info = {\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES },\n\t\tcode: { type: \"code\" },\n\t\twidth: { type: \"number\", precision: 0, step: 1 },\n\t\theight: { type: \"number\", precision: 0, step: 1 }\n\t};\n\n\tLGraphTextureCanvas2D.prototype.onPropertyChanged = function( name, value ) {\n\t\tif (name == \"code\" )\n\t\t\tthis.compileCode( value );\n\t}\n\t\n\tLGraphTextureCanvas2D.prototype.compileCode = function( code ) {\n\t\tthis._func = null;\n\t\tif( !LiteGraph.allow_scripts )\n\t\t\treturn;\n\n\t\ttry {\n\t\t\tthis._func = new Function( \"canvas\", \"ctx\", \"time\", \"script\",\"v\", code );\n\t\t\tthis.boxcolor = \"#00FF00\";\n\t\t} catch (err) {\n\t\t\tthis.boxcolor = \"#FF0000\";\n\t\t\tconsole.error(\"Error parsing script\");\n\t\t\tconsole.error(err);\n\t\t}\n\t};\n\n\tLGraphTextureCanvas2D.prototype.onExecute = function() {\n\t\tvar func = this._func;\n\t\tif (!func || !this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t}\n\t\tthis.executeDraw( func );\n\t}\n\n\tLGraphTextureCanvas2D.prototype.executeDraw = function( func_context ) {\n\n\t\tvar width = this.properties.width || gl.canvas.width;\n\t\tvar height = this.properties.height || gl.canvas.height;\n\t\tvar temp = this._temp_texture;\n\t\tvar type = LGraphTexture.getTextureType( this.properties.precision );\n\t\tif (!temp || temp.width != width || temp.height != height || temp.type != type ) {\n\t\t\ttemp = this._temp_texture = new GL.Texture(width, height, {\n\t\t\t\tformat: gl.RGBA,\n\t\t\t\tfilter: gl.LINEAR,\n\t\t\t\ttype: type\n\t\t\t});\n\t\t}\n\n\t\tvar v = this.getInputData(0);\n\n\t\tvar properties = this.properties;\n\t\tvar that = this;\n\t\tvar time = this.graph.getTime();\n\t\tvar ctx = gl;\n\t\tvar canvas = gl.canvas;\n\t\tif( this.properties.use_html_canvas || !global.enableWebGLCanvas )\n\t\t{\n\t\t\tif(!this._canvas)\n\t\t\t{\n\t\t\t\tcanvas = this._canvas = createCanvas(width.height);\n\t\t\t\tctx = this._ctx = canvas.getContext(\"2d\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcanvas = this._canvas;\n\t\t\t\tctx = this._ctx;\n\t\t\t}\n\t\t\tcanvas.width = width;\n\t\t\tcanvas.height = height;\n\t\t}\n\n\t\tif(ctx == gl) //using Canvas2DtoWebGL\n\t\t\ttemp.drawTo(function() {\n\t\t\t\tgl.start2D();\n\t\t\t\tif(properties.clear)\n\t\t\t\t{\n\t\t\t\t\tgl.clearColor(0,0,0,0);\n\t\t\t\t\tgl.clear( gl.COLOR_BUFFER_BIT );\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tif (func_context.draw) {\n\t\t\t\t\t\tfunc_context.draw.call(that, canvas, ctx, time, func_context, v);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfunc_context.call(that, canvas, ctx, time, func_context,v);\n\t\t\t\t\t}\n\t\t\t\t\tthat.boxcolor = \"#00FF00\";\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthat.boxcolor = \"#FF0000\";\n\t\t\t\t\tconsole.error(\"Error executing script\");\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t}\n\t\t\t\tgl.finish2D();\n\t\t\t});\n\t\telse //rendering to offscreen canvas and uploading to texture\n\t\t{\n\t\t\tif(properties.clear)\n\t\t\t\tctx.clearRect(0,0,canvas.width,canvas.height);\n\n\t\t\ttry {\n\t\t\t\tif (func_context.draw) {\n\t\t\t\t\tfunc_context.draw.call(this, canvas, ctx, time, func_context, v);\n\t\t\t\t} else {\n\t\t\t\t\tfunc_context.call(this, canvas, ctx, time, func_context,v);\n\t\t\t\t}\n\t\t\t\tthis.boxcolor = \"#00FF00\";\n\t\t\t} catch (err) {\n\t\t\t\tthis.boxcolor = \"#FF0000\";\n\t\t\t\tconsole.error(\"Error executing script\");\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\t\t\ttemp.uploadImage( canvas );\n\t\t}\n\n\t\tthis.setOutputData(0, temp);\n\t};\n\n\tLiteGraph.registerNodeType(\"texture/canvas2D\", LGraphTextureCanvas2D);\n\n\t// To do chroma keying *****************\n\n\tfunction LGraphTextureMatte() {\n\t\tthis.addInput(\"in\", \"Texture\");\n\n\t\tthis.addOutput(\"out\", \"Texture\");\n\t\tthis.properties = {\n\t\t\tkey_color: vec3.fromValues(0, 1, 0),\n\t\t\tthreshold: 0.8,\n\t\t\tslope: 0.2,\n\t\t\tprecision: LGraphTexture.DEFAULT\n\t\t};\n\t}\n\n\tLGraphTextureMatte.title = \"Matte\";\n\tLGraphTextureMatte.desc = \"Extracts background\";\n\n\tLGraphTextureMatte.widgets_info = {\n\t\tkey_color: { widget: \"color\" },\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\n\t};\n\n\tLGraphTextureMatte.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0)) {\n\t\t\treturn;\n\t\t} //saves work\n\n\t\tvar tex = this.getInputData(0);\n\n\t\tif (this.properties.precision === LGraphTexture.PASS_THROUGH) {\n\t\t\tthis.setOutputData(0, tex);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._tex = LGraphTexture.getTargetTexture(\n\t\t\ttex,\n\t\t\tthis._tex,\n\t\t\tthis.properties.precision\n\t\t);\n\n\t\tgl.disable(gl.BLEND);\n\t\tgl.disable(gl.DEPTH_TEST);\n\n\t\tif (!this._uniforms) {\n\t\t\tthis._uniforms = {\n\t\t\t\tu_texture: 0,\n\t\t\t\tu_key_color: this.properties.key_color,\n\t\t\t\tu_threshold: 1,\n\t\t\t\tu_slope: 1\n\t\t\t};\n\t\t}\n\t\tvar uniforms = this._uniforms;\n\n\t\tvar mesh = Mesh.getScreenQuad();\n\t\tvar shader = LGraphTextureMatte._shader;\n\t\tif (!shader) {\n\t\t\tshader = LGraphTextureMatte._shader = new GL.Shader(\n\t\t\t\tGL.Shader.SCREEN_VERTEX_SHADER,\n\t\t\t\tLGraphTextureMatte.pixel_shader\n\t\t\t);\n\t\t}\n\n\t\tuniforms.u_key_color = this.properties.key_color;\n\t\tuniforms.u_threshold = this.properties.threshold;\n\t\tuniforms.u_slope = this.properties.slope;\n\n\t\tthis._tex.drawTo(function() {\n\t\t\ttex.bind(0);\n\t\t\tshader.uniforms(uniforms).draw(mesh);\n\t\t});\n\n\t\tthis.setOutputData(0, this._tex);\n\t};\n\n\tLGraphTextureMatte.pixel_shader =\n\t\t\"precision highp float;\\n\\\n\t\tvarying vec2 v_coord;\\n\\\n\t\tuniform sampler2D u_texture;\\n\\\n\t\tuniform vec3 u_key_color;\\n\\\n\t\tuniform float u_threshold;\\n\\\n\t\tuniform float u_slope;\\n\\\n\t\t\\n\\\n\t\tvoid main() {\\n\\\n\t\t\tvec3 color = texture2D( u_texture, v_coord ).xyz;\\n\\\n\t\t\tfloat diff = length( normalize(color) - normalize(u_key_color) );\\n\\\n\t\t\tfloat edge = u_threshold * (1.0 - u_slope);\\n\\\n\t\t\tfloat alpha = smoothstep( edge, u_threshold, diff);\\n\\\n\t\t\tgl_FragColor = vec4( color, alpha );\\n\\\n\t\t}\";\n\n\tLiteGraph.registerNodeType(\"texture/matte\", LGraphTextureMatte);\n\n\t//***********************************\n\tfunction LGraphCubemapToTexture2D() {\n\t\tthis.addInput(\"in\", \"texture\");\n\t\tthis.addInput(\"yaw\", \"number\");\n\t\tthis.addOutput(\"out\", \"texture\");\n\t\tthis.properties = { yaw: 0 };\n\t}\n\n\tLGraphCubemapToTexture2D.title = \"CubemapToTexture2D\";\n\tLGraphCubemapToTexture2D.desc = \"Transforms a CUBEMAP texture into a TEXTURE2D in Polar Representation\";\n\n\tLGraphCubemapToTexture2D.prototype.onExecute = function() {\n\t\tif (!this.isOutputConnected(0))\n\t\t\treturn;\n\n\t\tvar tex = this.getInputData(0);\n\t\tif ( !tex || tex.texture_type != GL.TEXTURE_CUBE_MAP )\n\t\t\treturn;\n\t\tif( this._last_tex && ( this._last_tex.height != tex.height || this._last_tex.type != tex.type ))\n\t\t\tthis._last_tex = null;\n\t\tvar yaw = this.getInputOrProperty(\"yaw\");\n\t\tthis._last_tex = GL.Texture.cubemapToTexture2D( tex, tex.height, this._last_tex, true, yaw );\n\t\tthis.setOutputData( 0, this._last_tex );\n\t};\n\n\tLiteGraph.registerNodeType( \"texture/cubemapToTexture2D\", LGraphCubemapToTexture2D );\n})(this);\n\n(function(global) {\r\n\r\n    if (typeof GL == \"undefined\")\r\n\t\treturn;\r\n\r\n    var LiteGraph = global.LiteGraph;\r\n\tvar LGraphCanvas = global.LGraphCanvas;\r\n\r\n\tvar SHADERNODES_COLOR = \"#345\";\r\n\r\n\tvar LGShaders = LiteGraph.Shaders = {};\r\n\r\n\tvar GLSL_types = LGShaders.GLSL_types = [\"float\",\"vec2\",\"vec3\",\"vec4\",\"mat3\",\"mat4\",\"sampler2D\",\"samplerCube\"];\r\n\tvar GLSL_types_const = LGShaders.GLSL_types_const = [\"float\",\"vec2\",\"vec3\",\"vec4\"];\r\n\r\n\tvar GLSL_functions_desc = {\r\n\t\t\"radians\": \"T radians(T degrees)\",\r\n\t\t\"degrees\": \"T degrees(T radians)\",\r\n\t\t\"sin\": \"T sin(T angle)\",\r\n\t\t\"cos\": \"T cos(T angle)\",\r\n\t\t\"tan\": \"T tan(T angle)\",\r\n\t\t\"asin\": \"T asin(T x)\",\r\n\t\t\"acos\": \"T acos(T x)\",\r\n\t\t\"atan\": \"T atan(T x)\",\r\n\t\t\"atan2\": \"T atan(T x,T y)\",\r\n\t\t\"pow\": \"T pow(T x,T y)\",\r\n\t\t\"exp\": \"T exp(T x)\",\r\n\t\t\"log\": \"T log(T x)\",\r\n\t\t\"exp2\": \"T exp2(T x)\",\r\n\t\t\"log2\": \"T log2(T x)\",\r\n\t\t\"sqrt\": \"T sqrt(T x)\",\r\n\t\t\"inversesqrt\": \"T inversesqrt(T x)\",\r\n\t\t\"abs\": \"T abs(T x)\",\r\n\t\t\"sign\": \"T sign(T x)\",\r\n\t\t\"floor\": \"T floor(T x)\",\r\n\t\t\"round\": \"T round(T x)\",\r\n\t\t\"ceil\": \"T ceil(T x)\",\r\n\t\t\"fract\": \"T fract(T x)\",\r\n\t\t\"mod\": \"T mod(T x,T y)\", //\"T mod(T x,float y)\"\r\n\t\t\"min\": \"T min(T x,T y)\",\r\n\t\t\"max\": \"T max(T x,T y)\",\r\n\t\t\"clamp\": \"T clamp(T x,T minVal = 0.0,T maxVal = 1.0)\",\r\n\t\t\"mix\": \"T mix(T x,T y,T a)\", //\"T mix(T x,T y,float a)\"\r\n\t\t\"step\": \"T step(T edge, T edge2, T x)\", //\"T step(float edge, T x)\"\r\n\t\t\"smoothstep\": \"T smoothstep(T edge, T edge2, T x)\", //\"T smoothstep(float edge, T x)\"\r\n\t\t\"length\":\"float length(T x)\",\r\n\t\t\"distance\":\"float distance(T p0, T p1)\",\r\n\t\t\"normalize\":\"T normalize(T x)\",\r\n\t\t\"dot\": \"float dot(T x,T y)\",\r\n\t\t\"cross\": \"vec3 cross(vec3 x,vec3 y)\",\r\n\t\t\"reflect\": \"vec3 reflect(vec3 V,vec3 N)\",\r\n\t\t\"refract\": \"vec3 refract(vec3 V,vec3 N, float IOR)\"\r\n\t};\r\n\r\n\t//parse them\r\n\tvar GLSL_functions = {};\r\n\tvar GLSL_functions_name = [];\r\n\tparseGLSLDescriptions();\r\n\r\n\tLGShaders.ALL_TYPES = \"float,vec2,vec3,vec4\";\r\n\r\n\tfunction parseGLSLDescriptions()\r\n\t{\r\n\t\tGLSL_functions_name.length = 0;\r\n\r\n\t\tfor(var i in GLSL_functions_desc)\r\n\t\t{\r\n\t\t\tvar op = GLSL_functions_desc[i];\r\n\t\t\tvar index = op.indexOf(\" \");\r\n\t\t\tvar return_type = op.substr(0,index);\r\n\t\t\tvar index2 = op.indexOf(\"(\",index);\r\n\t\t\tvar func_name = op.substr(index,index2-index).trim();\r\n\t\t\tvar params = op.substr(index2 + 1, op.length - index2 - 2).split(\",\");\r\n\t\t\tfor(var j in params)\r\n\t\t\t{\r\n\t\t\t\tvar p = params[j].split(\" \").filter(function(a){ return a; });\r\n\t\t\t\tparams[j] = { type: p[0].trim(), name: p[1].trim() };\r\n\t\t\t\tif(p[2] == \"=\")\r\n\t\t\t\t\tparams[j].value = p[3].trim();\r\n\t\t\t}\r\n\t\t\tGLSL_functions[i] = { return_type: return_type, func: func_name, params: params };\r\n\t\t\tGLSL_functions_name.push( func_name );\r\n\t\t\t//console.log( GLSL_functions[i] );\r\n\t\t}\r\n\t}\r\n\r\n\t//common actions to all shader node classes\r\n\tfunction registerShaderNode( type, node_ctor )\r\n\t{\r\n\t\t//static attributes\r\n\t\tnode_ctor.color = SHADERNODES_COLOR;\r\n\t\tnode_ctor.filter = \"shader\";\r\n\r\n\t\t//common methods\r\n\t\tnode_ctor.prototype.clearDestination = function(){ this.shader_destination = {};  }\r\n\t\tnode_ctor.prototype.propagateDestination = function propagateDestination( dest_name )\r\n\t\t{\r\n\t\t\tthis.shader_destination[ dest_name ] = true;\r\n\t\t\tif(this.inputs)\r\n\t\t\tfor(var i = 0; i < this.inputs.length; ++i)\r\n\t\t\t{\r\n\t\t\t\tvar origin_node = this.getInputNode(i);\r\n\t\t\t\tif(origin_node)\r\n\t\t\t\t\torigin_node.propagateDestination( dest_name );\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!node_ctor.prototype.onPropertyChanged)\r\n\t\t\tnode_ctor.prototype.onPropertyChanged = function()\r\n\t\t\t{\r\n\t\t\t\tif(this.graph)\r\n\t\t\t\t\t this.graph._version++;\r\n\t\t\t}\r\n\r\n\t\t/*\r\n\t\tif(!node_ctor.prototype.onGetCode)\r\n\t\t\tnode_ctor.prototype.onGetCode = function()\r\n\t\t\t{\r\n\t\t\t\t//check destination to avoid lonely nodes\r\n\t\t\t\tif(!this.shader_destination)\r\n\t\t\t\t\treturn;\r\n\t\t\t\t//grab inputs with types\r\n\t\t\t\tvar inputs = [];\r\n\t\t\t\tif(this.inputs)\r\n\t\t\t\tfor(var i = 0; i < this.inputs.length; ++i)\r\n\t\t\t\t\tinputs.push({ type: this.getInputData(i), name: getInputLinkID(this,i) });\r\n\t\t\t\tvar outputs = [];\r\n\t\t\t\tif(this.outputs)\r\n\t\t\t\tfor(var i = 0; i < this.outputs.length; ++i)\r\n\t\t\t\t\toutputs.push({ name: getOutputLinkID(this,i) });\r\n\t\t\t\t//pass to code func\r\n\t\t\t\tvar results = this.extractCode(inputs);\r\n\t\t\t\t//grab output, pass to next\r\n\t\t\t\tif(results)\r\n\t\t\t\tfor(var i = 0; i < results.length; ++i)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar r = results[i];\r\n\t\t\t\t\tif(!r)\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tthis.setOutputData(i,r.value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t*/\r\n\r\n\t\tLiteGraph.registerNodeType( \"shader::\" + type, node_ctor );\r\n\t}\r\n\r\n\tfunction getShaderNodeVarName( node, name )\r\n\t{\r\n\t\treturn \"VAR_\" + (name || \"TEMP\") + \"_\" + node.id;\r\n\t}\r\n\r\n\tfunction getInputLinkID( node, slot )\r\n\t{\r\n\t\tif(!node.inputs)\r\n\t\t\treturn null;\r\n\t\tvar link = node.getInputLink( slot );\r\n\t\tif( !link )\r\n\t\t\treturn null;\r\n\t\tvar origin_node = node.graph.getNodeById( link.origin_id );\r\n\t\tif( !origin_node )\r\n\t\t\treturn null;\r\n\t\tif(origin_node.getOutputVarName)\r\n\t\t\treturn origin_node.getOutputVarName(link.origin_slot);\r\n\t\t//generate\r\n\t\treturn \"link_\" + origin_node.id + \"_\" + link.origin_slot;\r\n\t}\r\n\r\n\tfunction getOutputLinkID( node, slot )\r\n\t{\r\n\t\tif (!node.isOutputConnected(slot))\r\n\t\t\treturn null;\r\n\t\treturn \"link_\" + node.id + \"_\" + slot;\r\n\t}\r\n\r\n\tLGShaders.registerShaderNode = registerShaderNode;\r\n\tLGShaders.getInputLinkID = getInputLinkID;\r\n\tLGShaders.getOutputLinkID = getOutputLinkID;\r\n\tLGShaders.getShaderNodeVarName = getShaderNodeVarName;\r\n\tLGShaders.parseGLSLDescriptions = parseGLSLDescriptions;\r\n\r\n\t//given a const number, it transform it to a string that matches a type\r\n\tvar valueToGLSL = LiteGraph.valueToGLSL = function valueToGLSL( v, type, precision )\r\n\t{\r\n\t\tvar n = 5; //num decimals\r\n\t\tif(precision != null)\r\n\t\t\tn = precision;\r\n\t\tif(!type)\r\n\t\t{\r\n\t\t\tif(v.constructor === Number)\r\n\t\t\t\ttype = \"float\";\r\n\t\t\telse if(v.length)\r\n\t\t\t{\r\n\t\t\t\tswitch(v.length)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 2: type = \"vec2\"; break;\r\n\t\t\t\t\tcase 3: type = \"vec3\"; break;\r\n\t\t\t\t\tcase 4: type = \"vec4\"; break;\r\n\t\t\t\t\tcase 9: type = \"mat3\"; break;\r\n\t\t\t\t\tcase 16: type = \"mat4\"; break;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow(\"unknown type for glsl value size\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tthrow(\"unknown type for glsl value: \" + v.constructor);\r\n\t\t}\r\n\t\tswitch(type)\r\n\t\t{\r\n\t\t\tcase 'float': return v.toFixed(n); break;\r\n\t\t\tcase 'vec2': return \"vec2(\" + v[0].toFixed(n) + \",\" + v[1].toFixed(n) + \")\"; break;\r\n\t\t\tcase 'color3':\r\n\t\t\tcase 'vec3': return \"vec3(\" + v[0].toFixed(n) + \",\" + v[1].toFixed(n) + \",\" + v[2].toFixed(n) + \")\"; break;\r\n\t\t\tcase 'color4':\r\n\t\t\tcase 'vec4': return \"vec4(\" + v[0].toFixed(n) + \",\" + v[1].toFixed(n) + \",\" + v[2].toFixed(n) + \",\" + v[3].toFixed(n) + \")\"; break;\r\n\t\t\tcase 'mat3': return \"mat3(1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0)\"; break; //not fully supported yet\r\n\t\t\tcase 'mat4': return \"mat4(1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0)\"; break;//not fully supported yet\r\n\t\t\tdefault:\r\n\t\t\t\tthrow(\"unknown glsl type in valueToGLSL:\", type);\r\n\t\t}\r\n\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t//makes sure that a var is of a type, and if not, it converts it\r\n\tvar varToTypeGLSL = LiteGraph.varToTypeGLSL = function varToTypeGLSL( v, input_type, output_type )\r\n\t{\r\n\t\tif(input_type == output_type)\r\n\t\t\treturn v;\r\n\t\tif(v == null)\r\n\t\t\tswitch(output_type)\r\n\t\t\t{\r\n\t\t\t\tcase \"float\": return \"0.0\";\r\n\t\t\t\tcase \"vec2\":  return \"vec2(0.0)\";\r\n\t\t\t\tcase \"vec3\":  return \"vec3(0.0)\";\r\n\t\t\t\tcase \"vec4\":  return \"vec4(0.0,0.0,0.0,1.0)\";\r\n\t\t\t\tdefault: //null\r\n\t\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\tif(!output_type)\r\n\t\t\tthrow(\"error: no output type specified\");\r\n\t\tif(output_type == \"float\")\r\n\t\t{\r\n\t\t\tswitch(input_type)\r\n\t\t\t{\r\n\t\t\t\t//case \"float\":\r\n\t\t\t\tcase \"vec2\":\r\n\t\t\t\tcase \"vec3\":\r\n\t\t\t\tcase \"vec4\":\r\n\t\t\t\t\treturn v + \".x\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault: //null\r\n\t\t\t\t\treturn \"0.0\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(output_type == \"vec2\")\r\n\t\t{\r\n\t\t\tswitch(input_type)\r\n\t\t\t{\r\n\t\t\t\tcase \"float\":\r\n\t\t\t\t\treturn \"vec2(\"+v+\")\";\r\n\t\t\t\t//case \"vec2\":\r\n\t\t\t\tcase \"vec3\":\r\n\t\t\t\tcase \"vec4\":\r\n\t\t\t\t\treturn v + \".xy\";\r\n\t\t\t\tdefault: //null\r\n\t\t\t\t\treturn \"vec2(0.0)\";\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(output_type == \"vec3\")\r\n\t\t{\r\n\t\t\tswitch(input_type)\r\n\t\t\t{\r\n\t\t\t\tcase \"float\":\r\n\t\t\t\t\treturn \"vec3(\"+v+\")\";\r\n\t\t\t\tcase \"vec2\":\r\n\t\t\t\t\treturn \"vec3(\" + v + \",0.0)\";\r\n\t\t\t\t//case \"vec3\":\r\n\t\t\t\tcase \"vec4\":\r\n\t\t\t\t\treturn v + \".xyz\";\r\n\t\t\t\tdefault: //null\r\n\t\t\t\t\treturn \"vec3(0.0)\";\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(output_type == \"vec4\")\r\n\t\t{\r\n\t\t\tswitch(input_type)\r\n\t\t\t{\r\n\t\t\t\tcase \"float\":\r\n\t\t\t\t\treturn \"vec4(\"+v+\")\";\r\n\t\t\t\tcase \"vec2\":\r\n\t\t\t\t\treturn \"vec4(\" + v + \",0.0,1.0)\";\r\n\t\t\t\tcase \"vec3\":\r\n\t\t\t\t\treturn \"vec4(\" + v + \",1.0)\";\r\n\t\t\t\tdefault: //null\r\n\t\t\t\t\treturn \"vec4(0.0,0.0,0.0,1.0)\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tthrow(\"type cannot be converted\");\r\n\t}\r\n\r\n\r\n\t//used to plug incompatible stuff\r\n\tvar convertVarToGLSLType = LiteGraph.convertVarToGLSLType = function convertVarToGLSLType( varname, type, target_type )\r\n\t{\r\n\t\tif(type == target_type)\r\n\t\t\treturn varname;\r\n\t\tif(type == \"float\")\r\n\t\t\treturn target_type + \"(\" + varname + \")\";\r\n\t\tif(target_type == \"vec2\") //works for vec2,vec3 and vec4\r\n\t\t\treturn \"vec2(\" + varname + \".xy)\";\r\n\t\tif(target_type == \"vec3\") //works for vec2,vec3 and vec4\r\n\t\t{\r\n\t\t\tif(type == \"vec2\")\r\n\t\t\t\treturn \"vec3(\" + varname + \",0.0)\";\r\n\t\t\tif(type == \"vec4\")\r\n\t\t\t\treturn \"vec4(\" + varname + \".xyz)\";\r\n\t\t}\r\n\t\tif(target_type == \"vec4\")\r\n\t\t{\r\n\t\t\tif(type == \"vec2\")\r\n\t\t\t\treturn \"vec4(\" + varname + \",0.0,0.0)\";\r\n\t\t\tif(target_type == \"vec3\")\r\n\t\t\t\treturn \"vec4(\" + varname + \",1.0)\";\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t//used to host a shader body **************************************\r\n\tfunction LGShaderContext()\r\n\t{\r\n\t\t//to store the code template\r\n\t\tthis.vs_template = \"\";\r\n\t\tthis.fs_template = \"\";\r\n\r\n\t\t//required so nodes now where to fetch the input data\r\n\t\tthis.buffer_names = {\r\n\t\t\tuvs: \"v_coord\"\r\n\t\t};\r\n\r\n\t\tthis.extra = {}; //to store custom info from the nodes (like if this shader supports a feature, etc)\r\n\r\n\t\tthis._functions = {};\r\n\t\tthis._uniforms = {};\r\n\t\tthis._codeparts = {};\r\n\t\tthis._uniform_value = null;\r\n\t}\r\n\r\n\tLGShaderContext.prototype.clear = function()\r\n\t{\r\n\t\tthis._uniforms = {};\r\n\t\tthis._functions = {};\r\n\t\tthis._codeparts = {};\r\n\t\tthis._uniform_value = null;\r\n\r\n\t\tthis.extra = {};\r\n\t}\r\n\r\n\tLGShaderContext.prototype.addUniform = function( name, type, value )\r\n\t{\r\n\t\tthis._uniforms[ name ] = type;\r\n\t\tif(value != null)\r\n\t\t{\r\n\t\t\tif(!this._uniform_value)\r\n\t\t\t\tthis._uniform_value = {};\r\n\t\t\tthis._uniform_value[name] = value;\r\n\t\t}\r\n\t}\r\n\r\n\tLGShaderContext.prototype.addFunction = function( name, code )\r\n\t{\r\n\t\tthis._functions[name] = code;\r\n\t}\r\n\r\n\tLGShaderContext.prototype.addCode = function( hook, code, destinations )\r\n\t{\r\n\t\tdestinations = destinations || {\"\":\"\"};\r\n\t\tfor(var i in destinations)\r\n\t\t{\r\n\t\t\tvar h = i ? i + \"_\" + hook : hook;\r\n\t\t\tif(!this._codeparts[ h ])\r\n\t\t\t\tthis._codeparts[ h ] = code + \"\\n\";\r\n\t\t\telse\r\n\t\t\t\tthis._codeparts[ h ] += code + \"\\n\";\r\n\t\t}\r\n\t}\r\n\r\n\t//the system works by grabbing code fragments from every node and concatenating them in blocks depending on where must they be attached\r\n\tLGShaderContext.prototype.computeCodeBlocks = function( graph, extra_uniforms )\r\n\t{\r\n\t\t//prepare context\r\n\t\tthis.clear();\r\n\r\n\t\t//grab output nodes\r\n\t\tvar vertexout = graph.findNodesByType(\"shader::output/vertex\");\r\n\t\tvertexout = vertexout && vertexout.length ? vertexout[0] : null;\r\n\t\tvar fragmentout = graph.findNodesByType(\"shader::output/fragcolor\");\r\n\t\tfragmentout = fragmentout && fragmentout.length ? fragmentout[0] : null;\r\n\t\tif(!fragmentout) //??\r\n\t\t\treturn null; \r\n\r\n\t\t//propagate back destinations\r\n\t\tgraph.sendEventToAllNodes( \"clearDestination\" );\r\n\t\tif(vertexout)\r\n\t\t\tvertexout.propagateDestination(\"vs\");\r\n\t\tif(fragmentout)\r\n\t\t\tfragmentout.propagateDestination(\"fs\");\r\n\r\n\t\t//gets code from graph\r\n\t\tgraph.sendEventToAllNodes(\"onGetCode\", this );\r\n\r\n\t\tvar uniforms = \"\";\r\n\t\tfor(var i in this._uniforms)\r\n\t\t\tuniforms += \"uniform \" + this._uniforms[i] + \" \" + i + \";\\n\";\r\n\t\tif(extra_uniforms)\r\n\t\t\tfor(var i in extra_uniforms)\r\n\t\t\t\tuniforms += \"uniform \" + extra_uniforms[i] + \" \" + i + \";\\n\";\r\n\r\n\t\tvar functions = \"\";\r\n\t\tfor(var i in this._functions)\r\n\t\t\tfunctions += \"//\" + i + \"\\n\" + this._functions[i] + \"\\n\";\r\n\r\n\t\tvar blocks = this._codeparts;\r\n\t\tblocks.uniforms = uniforms;\r\n\t\tblocks.functions = functions;\r\n\t\treturn blocks;\r\n\t}\r\n\r\n\t//replaces blocks using the vs and fs template and returns the final codes\r\n\tLGShaderContext.prototype.computeShaderCode = function( graph )\r\n\t{\r\n\t\tvar blocks = this.computeCodeBlocks( graph );\r\n\t\tvar vs_code = GL.Shader.replaceCodeUsingContext( this.vs_template, blocks );\r\n\t\tvar fs_code = GL.Shader.replaceCodeUsingContext( this.fs_template, blocks );\r\n\t\treturn {\r\n\t\t\tvs_code: vs_code,\r\n\t\t\tfs_code: fs_code\r\n\t\t};\r\n\t}\r\n\r\n\t//generates the shader code from the template and the \r\n\tLGShaderContext.prototype.computeShader = function( graph, shader )\r\n\t{\r\n\t\tvar finalcode = this.computeShaderCode( graph );\r\n\t\tconsole.log( finalcode.vs_code, finalcode.fs_code );\r\n\r\n\t\tif(!LiteGraph.catch_exceptions)\r\n\t\t{\r\n\t\t\tthis._shader_error = true;\r\n\t\t\tif(shader)\r\n\t\t\t\tshader.updateShader( finalcode.vs_code, finalcode.fs_code );\r\n\t\t\telse\r\n\t\t\t\tshader = new GL.Shader( finalcode.vs_code, finalcode.fs_code );\r\n\t\t\tthis._shader_error = false;\r\n\t\t\treturn shader;\r\n\t\t}\r\n\r\n\t\ttry\r\n\t\t{\r\n\t\t\tif(shader)\r\n\t\t\t\tshader.updateShader( finalcode.vs_code, finalcode.fs_code );\r\n\t\t\telse\r\n\t\t\t\tshader = new GL.Shader( finalcode.vs_code, finalcode.fs_code );\r\n\t\t\tthis._shader_error = false;\r\n\t\t\treturn shader;\r\n\t\t}\r\n\t\tcatch (err)\r\n\t\t{\r\n\t\t\tif(!this._shader_error)\r\n\t\t\t{\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t\tif(err.indexOf(\"Fragment shader\") != -1)\r\n\t\t\t\t\tconsole.log( finalcode.fs_code.split(\"\\n\").map(function(v,i){ return i + \".- \" + v; }).join(\"\\n\") );\r\n\t\t\t\telse\r\n\t\t\t\t\tconsole.log( finalcode.vs_code );\r\n\t\t\t}\r\n\t\t\tthis._shader_error = true;\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn null;//never here\r\n\t}\r\n\r\n\tLGShaderContext.prototype.getShader = function( graph )\r\n\t{\r\n\t\t//if graph not changed?\r\n\t\tif(this._shader && this._shader._version == graph._version)\r\n\t\t\treturn this._shader;\r\n\r\n\t\t//compile shader\r\n\t\tvar shader = this.computeShader( graph, this._shader );\r\n\t\tif(!shader)\r\n\t\t\treturn null;\r\n\t\t\r\n\t\tthis._shader = shader;\r\n\t\tshader._version = graph._version;\r\n\t\treturn shader;\r\n\t}\r\n\r\n\t//some shader nodes could require to fill the box with some uniforms\r\n\tLGShaderContext.prototype.fillUniforms = function( uniforms, param )\r\n\t{\r\n\t\tif(!this._uniform_value)\r\n\t\t\treturn;\r\n\r\n\t\tfor(var i in this._uniform_value)\r\n\t\t{\r\n\t\t\tvar v = this._uniform_value[i];\r\n\t\t\tif(v == null)\r\n\t\t\t\tcontinue;\r\n\t\t\tif(v.constructor === Function)\r\n\t\t\t\tuniforms[i] = v.call( this, param );\r\n\t\t\telse if(v.constructor === GL.Texture)\r\n\t\t\t{\r\n\t\t\t\t//todo...\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tuniforms[i] = v;\r\n\t\t}\r\n\t}\r\n\r\n\tLiteGraph.ShaderContext = LiteGraph.Shaders.Context = LGShaderContext;\r\n\r\n\t// LGraphShaderGraph *****************************\r\n\t// applies a shader graph to texture, it can be uses as an example\r\n\r\n\tfunction LGraphShaderGraph() {\r\n\r\n\t\t//before inputs\r\n        this.subgraph = new LiteGraph.LGraph();\r\n        this.subgraph._subgraph_node = this;\r\n        this.subgraph._is_subgraph = true;\r\n\t\tthis.subgraph.filter = \"shader\";\r\n\r\n\t\tthis.addInput(\"in\", \"texture\");\r\n\t\tthis.addOutput(\"out\", \"texture\");\r\n\t\tthis.properties = { width: 0, height: 0, alpha: false, precision: typeof(LGraphTexture) != \"undefined\" ? LGraphTexture.DEFAULT : 2 };\r\n\r\n\t\tvar inputNode = this.subgraph.findNodesByType(\"shader::input/uniform\")[0];\r\n\t\tinputNode.pos = [200,300];\r\n\r\n\t\tvar sampler = LiteGraph.createNode(\"shader::texture/sampler2D\");\r\n\t\tsampler.pos = [400,300];\r\n\t\tthis.subgraph.add( sampler );\r\n\r\n\t\tvar outnode = LiteGraph.createNode(\"shader::output/fragcolor\");\r\n\t\toutnode.pos = [600,300];\r\n\t\tthis.subgraph.add( outnode );\r\n\r\n\t\tinputNode.connect( 0, sampler );\r\n\t\tsampler.connect( 0, outnode );\r\n\r\n\t\tthis.size = [180,60];\r\n\t\tthis.redraw_on_mouse = true; //force redraw\r\n\r\n\t\tthis._uniforms = {};\r\n\t\tthis._shader = null;\r\n\t\tthis._context = new LGShaderContext();\r\n\t\tthis._context.vs_template = \"#define VERTEX\\n\" + GL.Shader.SCREEN_VERTEX_SHADER;\r\n\t\tthis._context.fs_template = LGraphShaderGraph.template;\r\n\t}\r\n\r\n\tLGraphShaderGraph.template = \"\\n\\\r\n#define FRAGMENT\\n\\\r\nprecision highp float;\\n\\\r\nvarying vec2 v_coord;\\n\\\r\n{{varying}}\\n\\\r\n{{uniforms}}\\n\\\r\n{{functions}}\\n\\\r\n{{fs_functions}}\\n\\\r\nvoid main() {\\n\\n\\\r\nvec2 uv = v_coord;\\n\\\r\nvec4 fragcolor = vec4(0.0);\\n\\\r\nvec4 fragcolor1 = vec4(0.0);\\n\\\r\n{{fs_code}}\\n\\\r\ngl_FragColor = fragcolor;\\n\\\r\n}\\n\\\r\n\t\";\r\n\r\n\tLGraphShaderGraph.widgets_info = {\r\n\t\tprecision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\r\n\t};\r\n\r\n\tLGraphShaderGraph.title = \"ShaderGraph\";\r\n\tLGraphShaderGraph.desc = \"Builds a shader using a graph\";\r\n\tLGraphShaderGraph.input_node_type = \"input/uniform\";\r\n\tLGraphShaderGraph.output_node_type = \"output/fragcolor\";\r\n\tLGraphShaderGraph.title_color = SHADERNODES_COLOR;\r\n\r\n\tLGraphShaderGraph.prototype.onSerialize = function(o)\r\n\t{\r\n\t\to.subgraph = this.subgraph.serialize();\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.onConfigure = function(o)\r\n\t{\r\n\t\tthis.subgraph.configure(o.subgraph);\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.onExecute = function() {\r\n\t\tif (!this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\t//read input texture\r\n\t\tvar intex = this.getInputData(0);\r\n\t\tif(intex && intex.constructor != GL.Texture)\r\n\t\t\tintex = null;\r\n\r\n\t\tvar w = this.properties.width | 0;\r\n\t\tvar h = this.properties.height | 0;\r\n\t\tif (w == 0) {\r\n\t\t\tw = intex ? intex.width : gl.viewport_data[2];\r\n\t\t} //0 means default\r\n\t\tif (h == 0) {\r\n\t\t\th = intex ? intex.height : gl.viewport_data[3];\r\n\t\t} //0 means default\r\n\r\n\t\tvar type = LGraphTexture.getTextureType( this.properties.precision, intex );\r\n\r\n\t\tvar texture = this._texture;\r\n\t\tif ( !texture || texture.width != w || texture.height != h || texture.type != type ) {\r\n\t\t\ttexture = this._texture = new GL.Texture(w, h, {\r\n\t\t\t\ttype: type,\r\n\t\t\t\tformat: this.alpha ? gl.RGBA : gl.RGB,\r\n\t\t\t\tfilter: gl.LINEAR\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tvar shader = this.getShader( this.subgraph );\r\n\t\tif(!shader)\r\n\t\t\treturn;\r\n\r\n\t\tvar uniforms = this._uniforms;\r\n\t\tthis._context.fillUniforms( uniforms );\r\n\r\n\t\tvar tex_slot = 0;\r\n\t\tif(this.inputs)\r\n\t\tfor(var i = 0; i < this.inputs.length; ++i)\r\n\t\t{\r\n\t\t\tvar input = this.inputs[i];\r\n\t\t\tvar data = this.getInputData(i);\r\n\t\t\tif(input.type == \"texture\")\r\n\t\t\t{\r\n\t\t\t\tif(!data)\r\n\t\t\t\t\tdata = GL.Texture.getWhiteTexture();\r\n\t\t\t\tdata = data.bind(tex_slot++);\r\n\t\t\t}\r\n\r\n\t\t\tif(data != null)\r\n\t\t\t\tuniforms[ \"u_\" + input.name ] = data;\r\n\t\t}\r\n\r\n\t\tvar mesh = GL.Mesh.getScreenQuad();\r\n\r\n\t\tgl.disable( gl.DEPTH_TEST );\r\n\t\tgl.disable( gl.BLEND );\r\n\r\n\t\ttexture.drawTo(function(){\r\n\t\t\tshader.uniforms( uniforms );\r\n\t\t\tshader.draw( mesh );\r\n\t\t});\r\n\r\n\t\t//use subgraph output \r\n\t\tthis.setOutputData(0, texture );\r\n\t};\r\n\r\n\t//add input node inside subgraph\r\n\tLGraphShaderGraph.prototype.onInputAdded = function( slot_info )\r\n\t{\r\n\t\tvar subnode = LiteGraph.createNode(\"shader::input/uniform\");\r\n\t\tsubnode.setProperty(\"name\",slot_info.name);\r\n\t\tsubnode.setProperty(\"type\",slot_info.type);\r\n\t\tthis.subgraph.add( subnode );\r\n\t}\r\n\r\n\t//remove all\r\n\tLGraphShaderGraph.prototype.onInputRemoved = function( slot, slot_info )\r\n\t{\r\n\t\tvar nodes = this.subgraph.findNodesByType(\"shader::input/uniform\");\r\n\t\tfor(var i = 0; i < nodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar node = nodes[i];\r\n\t\t\tif(node.properties.name == slot_info.name )\r\n\t\t\t\tthis.subgraph.remove( node );\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.computeSize = function()\r\n\t{\r\n\t\tvar num_inputs = this.inputs ? this.inputs.length : 0;\r\n\t\tvar num_outputs = this.outputs ? this.outputs.length : 0;\r\n\t\treturn [ 200, Math.max(num_inputs,num_outputs) * LiteGraph.NODE_SLOT_HEIGHT + LiteGraph.NODE_TITLE_HEIGHT + 10];\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.getShader = function()\r\n\t{\r\n\t\tvar shader = this._context.getShader( this.subgraph );\r\n\t\tif(!shader)\r\n\t\t\tthis.boxcolor = \"red\";\r\n\t\telse\r\n\t\t\tthis.boxcolor = null;\r\n\t\treturn shader;\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.onDrawBackground = function(ctx, graphcanvas, canvas, pos)\r\n\t{\r\n\t\tif(this.flags.collapsed)\r\n\t\t\treturn;\r\n\r\n\t\t//allows to preview the node if the canvas is a webgl canvas\r\n\t\tvar tex = this.getOutputData(0);\r\n\t\tvar inputs_y = this.inputs ? this.inputs.length * LiteGraph.NODE_SLOT_HEIGHT : 0;\r\n\t\tif (tex && ctx == tex.gl && this.size[1] > inputs_y + LiteGraph.NODE_TITLE_HEIGHT ) {\r\n\t\t\tctx.drawImage( tex, 10,y, this.size[0] - 20, this.size[1] - inputs_y - LiteGraph.NODE_TITLE_HEIGHT );\r\n\t\t}\r\n\r\n\t\tvar y = this.size[1] - LiteGraph.NODE_TITLE_HEIGHT + 0.5;\r\n\r\n\t\t//button\r\n\t\tvar over = LiteGraph.isInsideRectangle(pos[0],pos[1],this.pos[0],this.pos[1] + y,this.size[0],LiteGraph.NODE_TITLE_HEIGHT);\r\n\t\tctx.fillStyle = over ? \"#555\" : \"#222\";\r\n\t\tctx.beginPath();\r\n\t\tif (this._shape == LiteGraph.BOX_SHAPE)\r\n\t\t\tctx.rect(0, y, this.size[0]+1, LiteGraph.NODE_TITLE_HEIGHT);\r\n\t\telse\r\n\t\t\tctx.roundRect( 0, y, this.size[0]+1, LiteGraph.NODE_TITLE_HEIGHT, 0, 8);\r\n\t\tctx.fill();\r\n\r\n\t\t//button\r\n\t\tctx.textAlign = \"center\";\r\n\t\tctx.font = \"24px Arial\";\r\n\t\tctx.fillStyle = over ? \"#DDD\" : \"#999\";\r\n\t\tctx.fillText( \"+\", this.size[0] * 0.5, y + 24 );\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.onMouseDown = function(e, localpos, graphcanvas)\r\n\t{\r\n\t\tvar y = this.size[1] - LiteGraph.NODE_TITLE_HEIGHT + 0.5;\r\n\t\tif(localpos[1] > y)\r\n\t\t{\r\n\t\t\tgraphcanvas.showSubgraphPropertiesDialog(this);\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.onDrawSubgraphBackground = function(graphcanvas)\r\n\t{\r\n\t\t//TODO\r\n\t}\r\n\r\n\tLGraphShaderGraph.prototype.getExtraMenuOptions = function(graphcanvas)\r\n\t{\r\n\t\tvar that = this;\r\n\t\tvar options = [{ content: \"Print Code\", callback: function(){\r\n\t\t\tvar code = that._context.computeShaderCode();\r\n\t\t\tconsole.log( code.vs_code, code.fs_code );\r\n\t\t}}];\r\n\r\n\t\treturn options;\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"texture/shaderGraph\", LGraphShaderGraph );\r\n\r\n\tfunction shaderNodeFromFunction( classname, params, return_type, code )\r\n\t{\r\n\t\t//TODO\r\n\t}\r\n\r\n\t//Shader Nodes ***********************************************************\r\n\r\n\t//applies a shader graph to a code\r\n\tfunction LGraphShaderUniform() {\r\n\t\tthis.addOutput(\"out\", \"\");\r\n\t\tthis.properties = { name: \"\", type: \"\" };\r\n\t}\r\n\r\n\tLGraphShaderUniform.title = \"Uniform\";\r\n\tLGraphShaderUniform.desc = \"Input data for the shader\";\r\n\r\n\tLGraphShaderUniform.prototype.getTitle = function()\r\n\t{\r\n\t\tif( this.properties.name && this.flags.collapsed)\r\n\t\t\treturn this.properties.type + \" \" + this.properties.name;\r\n\t\treturn \"Uniform\";\r\n\t}\r\n\r\n\tLGraphShaderUniform.prototype.onPropertyChanged = function(name,value)\r\n\t{\r\n\t\tthis.outputs[0].name = this.properties.type + \" \" + this.properties.name;\r\n\t}\r\n\r\n\tLGraphShaderUniform.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tvar type = this.properties.type;\r\n\t\tif( !type )\r\n\t\t{\r\n\t\t\tif( !context.onGetPropertyInfo )\r\n\t\t\t\treturn;\r\n\t\t\tvar info = context.onGetPropertyInfo( this.property.name );\r\n\t\t\tif(!info)\r\n\t\t\t\treturn;\r\n\t\t\ttype = info.type;\r\n\t\t}\r\n\t\tif(type == \"number\")\r\n\t\t\ttype = \"float\";\r\n\t\telse if(type == \"texture\")\r\n\t\t\ttype = \"sampler2D\";\r\n\t\tif ( LGShaders.GLSL_types.indexOf(type) == -1 )\r\n\t\t\treturn;\r\n\r\n\t\tcontext.addUniform( \"u_\" + this.properties.name, type );\r\n\t\tthis.setOutputData( 0, type );\r\n\t}\r\n\r\n\tLGraphShaderUniform.prototype.getOutputVarName = function(slot)\r\n\t{\r\n\t\treturn \"u_\" + this.properties.name;\r\n\t}\r\n\r\n\tregisterShaderNode( \"input/uniform\", LGraphShaderUniform );\r\n\r\n\r\n\tfunction LGraphShaderAttribute() {\r\n\t\tthis.addOutput(\"out\", \"vec2\");\r\n\t\tthis.properties = { name: \"coord\", type: \"vec2\" };\r\n\t}\r\n\r\n\tLGraphShaderAttribute.title = \"Attribute\";\r\n\tLGraphShaderAttribute.desc = \"Input data from mesh attribute\";\r\n\r\n\tLGraphShaderAttribute.prototype.getTitle = function()\r\n\t{\r\n\t\treturn \"att. \" + this.properties.name;\r\n\t}\r\n\r\n\tLGraphShaderAttribute.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tvar type = this.properties.type;\r\n\t\tif( !type || LGShaders.GLSL_types.indexOf(type) == -1 )\r\n\t\t\treturn;\r\n\t\tif(type == \"number\")\r\n\t\t\ttype = \"float\";\r\n\t\tif( this.properties.name != \"coord\")\r\n\t\t{\r\n\t\t\tcontext.addCode( \"varying\", \" varying \" + type +\" v_\" + this.properties.name + \";\" );\r\n\t\t\t//if( !context.varyings[ this.properties.name ] )\r\n\t\t\t//context.addCode( \"vs_code\", \"v_\" + this.properties.name + \" = \" + input_name + \";\" );\r\n\t\t}\r\n\t\tthis.setOutputData( 0, type );\r\n\t}\r\n\r\n\tLGraphShaderAttribute.prototype.getOutputVarName = function(slot)\r\n\t{\r\n\t\treturn \"v_\" + this.properties.name;\r\n\t}\r\n\r\n\tregisterShaderNode( \"input/attribute\", LGraphShaderAttribute );\r\n\r\n\tfunction LGraphShaderSampler2D() {\r\n\t\tthis.addInput(\"tex\", \"sampler2D\");\r\n\t\tthis.addInput(\"uv\", \"vec2\");\r\n\t\tthis.addOutput(\"rgba\", \"vec4\");\r\n\t\tthis.addOutput(\"rgb\", \"vec3\");\r\n\t}\r\n\r\n\tLGraphShaderSampler2D.title = \"Sampler2D\";\r\n\tLGraphShaderSampler2D.desc = \"Reads a pixel from a texture\";\r\n\r\n\tLGraphShaderSampler2D.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tvar texname = getInputLinkID( this, 0 );\r\n\t\tvar varname = getShaderNodeVarName(this);\r\n\t\tvar code = \"vec4 \" + varname + \" = vec4(0.0);\\n\";\r\n\t\tif(texname)\r\n\t\t{\r\n\t\t\tvar uvname = getInputLinkID( this, 1 ) || context.buffer_names.uvs;\r\n\t\t\tcode += varname + \" = texture2D(\"+texname+\",\"+uvname+\");\\n\";\r\n\t\t}\r\n\r\n\t\tvar link0 = getOutputLinkID( this, 0 );\r\n\t\tif(link0)\r\n\t\t\tcode += \"vec4 \" + getOutputLinkID( this, 0 ) + \" = \"+varname+\";\\n\";\r\n\r\n\t\tvar link1 = getOutputLinkID( this, 1 );\r\n\t\tif(link1)\r\n\t\t\tcode += \"vec3 \" + getOutputLinkID( this, 1 ) + \" = \"+varname+\".xyz;\\n\";\r\n\r\n\t\tcontext.addCode( \"code\", code, this.shader_destination );\r\n\t\tthis.setOutputData( 0, \"vec4\" );\r\n\t\tthis.setOutputData( 1, \"vec3\" );\r\n\t}\r\n\r\n\tregisterShaderNode( \"texture/sampler2D\", LGraphShaderSampler2D );\r\n\r\n\t//*********************************\r\n\r\n\tfunction LGraphShaderConstant()\r\n\t{\r\n\t\tthis.addOutput(\"\",\"float\");\r\n\r\n\t\tthis.properties = {\r\n\t\t\ttype: \"float\",\r\n\t\t\tvalue: 0\r\n\t\t};\r\n\r\n\t\tthis.addWidget(\"combo\",\"type\",\"float\",null, { values: GLSL_types_const, property: \"type\" } );\r\n\t\tthis.updateWidgets();\r\n\t}\r\n\r\n\tLGraphShaderConstant.title = \"const\";\r\n\r\n\tLGraphShaderConstant.prototype.getTitle = function()\r\n\t{\r\n\t\tif(this.flags.collapsed)\r\n\t\t\treturn valueToGLSL( this.properties.value, this.properties.type, 2 );\r\n\t\treturn \"Const\";\r\n\t}\r\n\r\n\tLGraphShaderConstant.prototype.onPropertyChanged = function(name,value)\r\n\t{\r\n\t\tvar that = this;\r\n\t\tif(name == \"type\")\r\n\t\t{\r\n\t\t\tif(this.outputs[0].type != value)\r\n\t\t\t{\r\n\t\t\t\tthis.disconnectOutput(0);\r\n\t\t\t\tthis.outputs[0].type = value;\r\n\t\t\t}\r\n\t\t\tthis.widgets.length = 1; //remove extra widgets\r\n\t\t\tthis.updateWidgets();\r\n\t\t}\r\n\t\tif(name == \"value\")\r\n\t\t{\r\n\t\t\tif(!value.length)\r\n\t\t\t\tthis.widgets[1].value = value;\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.widgets[1].value = value[1];\r\n\t\t\t\tif(value.length > 2)\r\n\t\t\t\t\tthis.widgets[2].value = value[2];\r\n\t\t\t\tif(value.length > 3)\r\n\t\t\t\t\tthis.widgets[3].value = value[3];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphShaderConstant.prototype.updateWidgets = function( old_value )\r\n\t{\r\n\t\tvar that = this;\r\n\t\tvar old_value = this.properties.value;\r\n\t\tvar options = { step: 0.01 };\r\n\t\tswitch(this.properties.type)\r\n\t\t{\r\n\t\t\tcase 'float': \r\n\t\t\t\tthis.properties.value = 0;\r\n\t\t\t\tthis.addWidget(\"number\",\"v\",0,{ step:0.01, property: \"value\" });\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'vec2': \r\n\t\t\t\tthis.properties.value = old_value && old_value.length == 2 ? [old_value[0],old_value[1]] : [0,0,0];\r\n\t\t\t\tthis.addWidget(\"number\",\"x\",this.properties.value[0], function(v){ that.properties.value[0] = v; },options); \r\n\t\t\t\tthis.addWidget(\"number\",\"y\",this.properties.value[1], function(v){ that.properties.value[1] = v; },options); \r\n\t\t\t\tbreak;\r\n\t\t\tcase 'vec3': \r\n\t\t\t\tthis.properties.value = old_value && old_value.length == 3 ? [old_value[0],old_value[1],old_value[2]] : [0,0,0];\r\n\t\t\t\tthis.addWidget(\"number\",\"x\",this.properties.value[0], function(v){ that.properties.value[0] = v; },options); \r\n\t\t\t\tthis.addWidget(\"number\",\"y\",this.properties.value[1], function(v){ that.properties.value[1] = v; },options); \r\n\t\t\t\tthis.addWidget(\"number\",\"z\",this.properties.value[2], function(v){ that.properties.value[2] = v; },options); \r\n\t\t\t\tbreak;\r\n\t\t\tcase 'vec4': \r\n\t\t\t\tthis.properties.value = old_value && old_value.length == 4 ? [old_value[0],old_value[1],old_value[2],old_value[3]] : [0,0,0,0];\r\n\t\t\t\tthis.addWidget(\"number\",\"x\",this.properties.value[0], function(v){ that.properties.value[0] = v; },options); \r\n\t\t\t\tthis.addWidget(\"number\",\"y\",this.properties.value[1], function(v){ that.properties.value[1] = v; },options); \r\n\t\t\t\tthis.addWidget(\"number\",\"z\",this.properties.value[2], function(v){ that.properties.value[2] = v; },options); \r\n\t\t\t\tthis.addWidget(\"number\",\"w\",this.properties.value[3], function(v){ that.properties.value[3] = v; },options); \r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.error(\"unknown type for constant\");\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphShaderConstant.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tvar value = valueToGLSL( this.properties.value, this.properties.type );\r\n\t\tvar link_name = getOutputLinkID(this,0);\r\n\t\tif(!link_name) //not connected\r\n\t\t\treturn;\r\n\r\n\t\tvar code = \"\t\" + this.properties.type + \" \" + link_name + \" = \" + value + \";\";\r\n\t\tcontext.addCode( \"code\", code, this.shader_destination );\r\n\r\n\t\tthis.setOutputData( 0, this.properties.type );\r\n\t}\r\n\r\n\tregisterShaderNode( \"const/const\", LGraphShaderConstant );\r\n\r\n\tfunction LGraphShaderVec2()\r\n\t{\r\n\t\tthis.addInput(\"xy\",\"vec2\");\r\n\t\tthis.addInput(\"x\",\"float\");\r\n\t\tthis.addInput(\"y\",\"float\");\r\n\t\tthis.addOutput(\"xy\",\"vec2\");\r\n\t\tthis.addOutput(\"x\",\"float\");\r\n\t\tthis.addOutput(\"y\",\"float\");\r\n\r\n\t\tthis.properties = { x: 0, y: 0 };\r\n\t}\r\n\r\n\tLGraphShaderVec2.title = \"vec2\";\r\n\tLGraphShaderVec2.varmodes = [\"xy\",\"x\",\"y\"];\r\n\r\n\tLGraphShaderVec2.prototype.onPropertyChanged = function()\r\n\t{\r\n\t\tif(this.graph)\r\n\t\t\t this.graph._version++;\r\n\t}\r\n\r\n\tLGraphShaderVec2.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tvar props = this.properties;\r\n\r\n\t\tvar varname = getShaderNodeVarName(this);\r\n\t\tvar code = \"\tvec2 \" + varname + \" = \" + valueToGLSL([props.x,props.y]) + \";\\n\";\r\n\r\n\t\tfor(var i = 0;i < LGraphShaderVec2.varmodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar varmode = LGraphShaderVec2.varmodes[i];\r\n\t\t\tvar inlink = getInputLinkID(this,i);\r\n\t\t\tif(!inlink)\r\n\t\t\t\tcontinue;\r\n\t\t\tcode += \"\t\" + varname + \".\"+varmode+\" = \" + inlink + \";\\n\";\r\n\t\t}\r\n\r\n\t\tfor(var i = 0;i < LGraphShaderVec2.varmodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar varmode = LGraphShaderVec2.varmodes[i];\r\n\t\t\tvar outlink = getOutputLinkID(this,i);\r\n\t\t\tif(!outlink)\r\n\t\t\t\tcontinue;\r\n\t\t\tvar type = GLSL_types_const[varmode.length - 1];\r\n\t\t\tcode += \"\t\"+type+\" \" + outlink + \" = \" + varname + \".\" + varmode + \";\\n\";\r\n\t\t\tthis.setOutputData( i, type );\r\n\t\t}\r\n\r\n\t\tcontext.addCode( \"code\", code, this.shader_destination );\r\n\t}\r\n\r\n\tregisterShaderNode( \"const/vec2\", LGraphShaderVec2 );\t\r\n\r\n\tfunction LGraphShaderVec3()\r\n\t{\r\n\t\tthis.addInput(\"xyz\",\"vec3\");\r\n\t\tthis.addInput(\"x\",\"float\");\r\n\t\tthis.addInput(\"y\",\"float\");\r\n\t\tthis.addInput(\"z\",\"float\");\r\n\t\tthis.addInput(\"xy\",\"vec2\");\r\n\t\tthis.addInput(\"xz\",\"vec2\");\r\n\t\tthis.addInput(\"yz\",\"vec2\");\r\n\t\tthis.addOutput(\"xyz\",\"vec3\");\r\n\t\tthis.addOutput(\"x\",\"float\");\r\n\t\tthis.addOutput(\"y\",\"float\");\r\n\t\tthis.addOutput(\"z\",\"float\");\r\n\t\tthis.addOutput(\"xy\",\"vec2\");\r\n\t\tthis.addOutput(\"xz\",\"vec2\");\r\n\t\tthis.addOutput(\"yz\",\"vec2\");\r\n\r\n\t\tthis.properties = { x:0, y: 0, z: 0 };\r\n\t}\r\n\r\n\tLGraphShaderVec3.title = \"vec3\";\r\n\tLGraphShaderVec3.varmodes = [\"xyz\",\"x\",\"y\",\"z\",\"xy\",\"xz\",\"yz\"];\r\n\r\n\tLGraphShaderVec3.prototype.onPropertyChanged = function()\r\n\t{\r\n\t\tif(this.graph)\r\n\t\t\tthis.graph._version++;\r\n\t}\r\n\r\n\tLGraphShaderVec3.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tvar props = this.properties;\r\n\r\n\t\tvar varname = getShaderNodeVarName(this);\r\n\t\tvar code = \"vec3 \" + varname + \" = \" + valueToGLSL([props.x,props.y,props.z]) + \";\\n\";\r\n\r\n\t\tfor(var i = 0;i < LGraphShaderVec3.varmodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar varmode = LGraphShaderVec3.varmodes[i];\r\n\t\t\tvar inlink = getInputLinkID(this,i);\r\n\t\t\tif(!inlink)\r\n\t\t\t\tcontinue;\r\n\t\t\tcode += \"\t\" + varname + \".\"+varmode+\" = \" + inlink + \";\\n\";\r\n\t\t}\r\n\r\n\t\tfor(var i = 0; i < LGraphShaderVec3.varmodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar varmode = LGraphShaderVec3.varmodes[i];\r\n\t\t\tvar outlink = getOutputLinkID(this,i);\r\n\t\t\tif(!outlink)\r\n\t\t\t\tcontinue;\r\n\t\t\tvar type = GLSL_types_const[varmode.length - 1];\r\n\t\t\tcode += \"\t\"+type+\" \" + outlink + \" = \" + varname + \".\" + varmode + \";\\n\";\r\n\t\t\tthis.setOutputData( i, type );\r\n\t\t}\r\n\r\n\t\tcontext.addCode( \"code\", code, this.shader_destination );\r\n\t}\r\n\r\n\tregisterShaderNode( \"const/vec3\", LGraphShaderVec3 );\t\r\n\r\n\r\n\tfunction LGraphShaderVec4()\r\n\t{\r\n\t\tthis.addInput(\"xyzw\",\"vec4\");\r\n\t\tthis.addInput(\"xyz\",\"vec3\");\r\n\t\tthis.addInput(\"x\",\"float\");\r\n\t\tthis.addInput(\"y\",\"float\");\r\n\t\tthis.addInput(\"z\",\"float\");\r\n\t\tthis.addInput(\"w\",\"float\");\r\n\t\tthis.addInput(\"xy\",\"vec2\");\r\n\t\tthis.addInput(\"yz\",\"vec2\");\r\n\t\tthis.addInput(\"zw\",\"vec2\");\r\n\t\tthis.addOutput(\"xyzw\",\"vec4\");\r\n\t\tthis.addOutput(\"xyz\",\"vec3\");\r\n\t\tthis.addOutput(\"x\",\"float\");\r\n\t\tthis.addOutput(\"y\",\"float\");\r\n\t\tthis.addOutput(\"z\",\"float\");\r\n\t\tthis.addOutput(\"xy\",\"vec2\");\r\n\t\tthis.addOutput(\"yz\",\"vec2\");\r\n\t\tthis.addOutput(\"zw\",\"vec2\");\r\n\r\n\t\tthis.properties = { x:0, y: 0, z: 0, w: 0 };\r\n\t}\r\n\r\n\tLGraphShaderVec4.title = \"vec4\";\r\n\tLGraphShaderVec4.varmodes = [\"xyzw\",\"xyz\",\"x\",\"y\",\"z\",\"w\",\"xy\",\"yz\",\"zw\"];\r\n\r\n\tLGraphShaderVec4.prototype.onPropertyChanged = function()\r\n\t{\r\n\t\tif(this.graph)\r\n\t\t\tthis.graph._version++;\r\n\t}\r\n\r\n\tLGraphShaderVec4.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tvar props = this.properties;\r\n\r\n\t\tvar varname = getShaderNodeVarName(this);\r\n\t\tvar code = \"vec4 \" + varname + \" = \" + valueToGLSL([props.x,props.y,props.z,props.w]) + \";\\n\";\r\n\r\n\t\tfor(var i = 0;i < LGraphShaderVec4.varmodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar varmode = LGraphShaderVec4.varmodes[i];\r\n\t\t\tvar inlink = getInputLinkID(this,i);\r\n\t\t\tif(!inlink)\r\n\t\t\t\tcontinue;\r\n\t\t\tcode += \"\t\" + varname + \".\"+varmode+\" = \" + inlink + \";\\n\";\r\n\t\t}\r\n\r\n\t\tfor(var i = 0;i < LGraphShaderVec4.varmodes.length; ++i)\r\n\t\t{\r\n\t\t\tvar varmode = LGraphShaderVec4.varmodes[i];\r\n\t\t\tvar outlink = getOutputLinkID(this,i);\r\n\t\t\tif(!outlink)\r\n\t\t\t\tcontinue;\r\n\t\t\tvar type = GLSL_types_const[varmode.length - 1];\r\n\t\t\tcode += \"\t\"+type+\" \" + outlink + \" = \" + varname + \".\" + varmode + \";\\n\";\r\n\t\t\tthis.setOutputData( i, type );\r\n\t\t}\r\n\r\n\t\tcontext.addCode( \"code\", code, this.shader_destination );\r\n\r\n\t}\r\n\r\n\tregisterShaderNode( \"const/vec4\", LGraphShaderVec4 );\t\r\n\t\r\n\t//*********************************\r\n\r\n\tfunction LGraphShaderFragColor() {\r\n\t\tthis.addInput(\"color\", LGShaders.ALL_TYPES );\r\n\t\tthis.block_delete = true;\r\n\t}\r\n\r\n\tLGraphShaderFragColor.title = \"FragColor\";\r\n\tLGraphShaderFragColor.desc = \"Pixel final color\";\r\n\r\n\tLGraphShaderFragColor.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tvar link_name = getInputLinkID( this, 0 );\r\n\t\tif(!link_name)\r\n\t\t\treturn;\r\n\t\tvar type = this.getInputData(0);\r\n\t\tvar code = varToTypeGLSL( link_name, type, \"vec4\" );\r\n\t\tcontext.addCode(\"fs_code\", \"fragcolor = \" + code + \";\");\r\n\t}\r\n\r\n\tregisterShaderNode( \"output/fragcolor\", LGraphShaderFragColor );\r\n\r\n\r\n\t/*\r\n\tfunction LGraphShaderDiscard()\r\n\t{\r\n\t\tthis.addInput(\"v\",\"T\");\r\n\t\tthis.addInput(\"min\",\"T\");\r\n\t\tthis.properties = { min_value: 0.0 };\r\n\t\tthis.addWidget(\"number\",\"min\",0,{ step: 0.01, property: \"min_value\" });\r\n\t}\r\n\r\n\tLGraphShaderDiscard.title = \"Discard\";\r\n\r\n\tLGraphShaderDiscard.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar inlink = getInputLinkID(this,0);\r\n\t\tvar inlink1 = getInputLinkID(this,1);\r\n\r\n\t\tif(!inlink && !inlink1) //not connected\r\n\t\t\treturn;\r\n\t\tcontext.addCode(\"code\", return_type + \" \" + outlink + \" = ( (\" + inlink + \" - \"+minv+\") / (\"+ maxv+\" - \"+minv+\") ) * (\"+ maxv2+\" - \"+minv2+\") + \" + minv2 + \";\", this.shader_destination );\r\n\t\tthis.setOutputData( 0, return_type );\r\n\t}\r\n\r\n\tregisterShaderNode( \"output/discard\", LGraphShaderDiscard );\r\n\t*/\r\n\r\n\r\n\t// *************************************************\r\n\r\n\tfunction LGraphShaderOperation()\r\n\t{\r\n\t\tthis.addInput(\"A\", LGShaders.ALL_TYPES );\r\n\t\tthis.addInput(\"B\", LGShaders.ALL_TYPES );\r\n\t\tthis.addOutput(\"out\",\"\");\r\n\t\tthis.properties = {\r\n\t\t\toperation: \"*\"\r\n\t\t};\r\n\t\tthis.addWidget(\"combo\",\"op.\",this.properties.operation,{ property: \"operation\", values: LGraphShaderOperation.operations });\r\n\t}\r\n\r\n\tLGraphShaderOperation.title = \"Operation\";\r\n\tLGraphShaderOperation.operations = [\"+\",\"-\",\"*\",\"/\"];\r\n\r\n\tLGraphShaderOperation.prototype.getTitle = function()\r\n\t{\r\n\t\tif(this.flags.collapsed)\r\n\t\t\treturn \"A\" + this.properties.operation + \"B\";\r\n\t\telse\r\n\t\t\treturn \"Operation\";\r\n\t}\r\n\r\n\tLGraphShaderOperation.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tif(!this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar inlinks = [];\r\n\t\tfor(var i = 0; i < 3; ++i)\r\n\t\t\tinlinks.push( { name: getInputLinkID(this,i), type: this.getInputData(i) || \"float\" } );\r\n\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\t\tif(!outlink) //not connected\r\n\t\t\treturn;\r\n\r\n\t\t//func_desc\r\n\t\tvar base_type = inlinks[0].type;\r\n\t\tvar return_type = base_type;\r\n\t\tvar op = this.properties.operation;\r\n\r\n\t\tvar params = [];\r\n\t\tfor(var i = 0; i < 2; ++i)\r\n\t\t{\r\n\t\t\tvar param_code = inlinks[i].name;\r\n\t\t\tif(param_code == null) //not plugged\r\n\t\t\t{\r\n\t\t\t\tparam_code = p.value != null ? p.value : \"(1.0)\";\r\n\t\t\t\tinlinks[i].type = \"float\";\r\n\t\t\t}\r\n\r\n\t\t\t//convert\r\n\t\t\tif( inlinks[i].type != base_type ) \r\n\t\t\t{\r\n\t\t\t\tif( inlinks[i].type == \"float\" && (op == \"*\" || op == \"/\") )\r\n\t\t\t\t{\r\n\t\t\t\t\t//I find hard to create the opposite condition now, so I prefeer an else\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\tparam_code = convertVarToGLSLType( param_code, inlinks[i].type, base_type );\r\n\t\t\t}\r\n\t\t\tparams.push( param_code );\r\n\t\t}\r\n\t\t\r\n\t\tcontext.addCode(\"code\", return_type + \" \" + outlink + \" = \"+ params[0] + op + params[1] + \";\", this.shader_destination );\r\n\t\tthis.setOutputData( 0, return_type );\r\n\t}\r\n\r\n\tregisterShaderNode( \"math/operation\", LGraphShaderOperation );\r\n\r\n\r\n\tfunction LGraphShaderFunc()\r\n\t{\r\n\t\tthis.addInput(\"A\", LGShaders.ALL_TYPES );\r\n\t\tthis.addInput(\"B\", LGShaders.ALL_TYPES );\r\n\t\tthis.addOutput(\"out\",\"\");\r\n\t\tthis.properties = {\r\n\t\t\tfunc: \"floor\"\r\n\t\t};\r\n\t\tthis._current = \"floor\";\r\n\t\tthis.addWidget(\"combo\",\"func\",this.properties.func,{ property: \"func\", values: GLSL_functions_name });\r\n\t}\r\n\r\n\tLGraphShaderFunc.title = \"Func\";\r\n\r\n\tLGraphShaderFunc.prototype.onPropertyChanged = function(name,value)\r\n\t{\r\n\t\tif(this.graph)\r\n\t\t\tthis.graph._version++;\r\n\r\n\t\tif(name == \"func\")\r\n\t\t{\r\n\t\t\tvar func_desc = GLSL_functions[ value ];\r\n\t\t\tif(!func_desc)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t//remove extra inputs\r\n\t\t\tfor(var i = func_desc.params.length; i < this.inputs.length; ++i)\r\n\t\t\t\tthis.removeInput(i);\r\n\r\n\t\t\t//add and update inputs\r\n\t\t\tfor(var i = 0; i < func_desc.params.length; ++i)\r\n\t\t\t{\r\n\t\t\t\tvar p = func_desc.params[i];\r\n\t\t\t\tif( this.inputs[i] )\r\n\t\t\t\t\tthis.inputs[i].name = p.name + (p.value ? \" (\" + p.value + \")\" : \"\");\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.addInput( p.name, LGShaders.ALL_TYPES );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphShaderFunc.prototype.getTitle = function()\r\n\t{\r\n\t\tif(this.flags.collapsed)\r\n\t\t\treturn this.properties.func;\r\n\t\telse\r\n\t\t\treturn \"Func\";\r\n\t}\r\n\r\n\tLGraphShaderFunc.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination)\r\n\t\t\treturn;\r\n\r\n\t\tif(!this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar inlinks = [];\r\n\t\tfor(var i = 0; i < 3; ++i)\r\n\t\t\tinlinks.push( { name: getInputLinkID(this,i), type: this.getInputData(i) || \"float\" } );\r\n\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\t\tif(!outlink) //not connected\r\n\t\t\treturn;\r\n\r\n\t\tvar func_desc = GLSL_functions[ this.properties.func ];\r\n\t\tif(!func_desc)\r\n\t\t\treturn;\r\n\r\n\t\t//func_desc\r\n\t\tvar base_type = inlinks[0].type;\r\n\t\tvar return_type = func_desc.return_type;\r\n\t\tif( return_type == \"T\" )\r\n\t\t\treturn_type = base_type;\r\n\r\n\t\tvar params = [];\r\n\t\tfor(var i = 0; i < func_desc.params.length; ++i)\r\n\t\t{\r\n\t\t\tvar p = func_desc.params[i];\r\n\t\t\tvar param_code = inlinks[i].name;\r\n\t\t\tif(param_code == null) //not plugged\r\n\t\t\t{\r\n\t\t\t\tparam_code = p.value != null ? p.value : \"(1.0)\";\r\n\t\t\t\tinlinks[i].type = \"float\";\r\n\t\t\t}\r\n\t\t\tif( (p.type == \"T\" && inlinks[i].type != base_type) ||\r\n\t\t\t\t(p.type != \"T\" && inlinks[i].type != base_type) )\r\n\t\t\t\tparam_code = convertVarToGLSLType( param_code, inlinks[i].type, base_type );\r\n\t\t\tparams.push( param_code );\r\n\t\t}\r\n\t\t\r\n\t\tcontext.addFunction(\"round\",\"float round(float v){ return floor(v+0.5); }\\nvec2 round(vec2 v){ return floor(v+vec2(0.5));}\\nvec3 round(vec3 v){ return floor(v+vec3(0.5));}\\nvec4 round(vec4 v){ return floor(v+vec4(0.5)); }\\n\");\r\n\t\tcontext.addCode(\"code\", return_type + \" \" + outlink + \" = \"+func_desc.func+\"(\"+params.join(\",\")+\");\", this.shader_destination );\r\n\r\n\t\tthis.setOutputData( 0, return_type );\r\n\t}\r\n\r\n\tregisterShaderNode( \"math/func\", LGraphShaderFunc );\r\n\r\n\r\n\r\n\tfunction LGraphShaderSnippet()\r\n\t{\r\n\t\tthis.addInput(\"A\", LGShaders.ALL_TYPES );\r\n\t\tthis.addInput(\"B\", LGShaders.ALL_TYPES );\r\n\t\tthis.addOutput(\"C\",\"vec4\");\r\n\t\tthis.properties = {\r\n\t\t\tcode:\"C = A+B\",\r\n\t\t\ttype: \"vec4\"\r\n\t\t}\r\n\t\tthis.addWidget(\"text\",\"code\",this.properties.code,{ property: \"code\" });\r\n\t\tthis.addWidget(\"combo\",\"type\",this.properties.type,{ values:[\"float\",\"vec2\",\"vec3\",\"vec4\"], property: \"type\" });\r\n\t}\r\n\r\n\tLGraphShaderSnippet.title = \"Snippet\";\r\n\r\n\tLGraphShaderSnippet.prototype.onPropertyChanged = function(name,value)\r\n\t{\r\n\t\tif(this.graph)\r\n\t\t\tthis.graph._version++;\r\n\r\n\t\tif(name == \"type\"&& this.outputs[0].type != value)\r\n\t\t{\r\n\t\t\tthis.disconnectOutput(0);\r\n\t\t\tthis.outputs[0].type = value;\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphShaderSnippet.prototype.getTitle = function()\r\n\t{\r\n\t\tif(this.flags.collapsed)\r\n\t\t\treturn this.properties.code;\r\n\t\telse\r\n\t\t\treturn \"Snippet\";\r\n\t}\r\n\r\n\tLGraphShaderSnippet.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination || !this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar inlinkA = getInputLinkID(this,0);\r\n\t\tif(!inlinkA)\r\n\t\t\tinlinkA = \"1.0\";\r\n\t\tvar inlinkB = getInputLinkID(this,1);\r\n\t\tif(!inlinkB)\r\n\t\t\tinlinkB = \"1.0\";\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\t\tif(!outlink) //not connected\r\n\t\t\treturn;\r\n\r\n\t\tvar inA_type = this.getInputData(0) || \"float\";\r\n\t\tvar inB_type = this.getInputData(1) || \"float\";\r\n\t\tvar return_type = this.properties.type;\r\n\r\n\t\t//cannot resolve input\r\n\t\tif(inA_type == \"T\" || inB_type == \"T\")\r\n\t\t{\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar funcname = \"funcSnippet\" + this.id;\r\n\r\n\t\tvar func_code = \"\\n\" + return_type + \" \" + funcname + \"( \" + inA_type + \" A, \" + inB_type + \" B) {\\n\";\r\n\t\tfunc_code += \"\t\" + return_type + \" C = \" + return_type + \"(0.0);\\n\";\r\n\t\tfunc_code += \"\t\" + this.properties.code + \";\\n\";\r\n\t\tfunc_code += \"\treturn C;\\n}\\n\";\r\n\r\n\t\tcontext.addCode(\"functions\", func_code, this.shader_destination );\r\n\t\tcontext.addCode(\"code\", return_type + \" \" + outlink + \" = \"+funcname+\"(\"+inlinkA+\",\"+inlinkB+\");\", this.shader_destination );\r\n\r\n\t\tthis.setOutputData( 0, return_type );\r\n\t}\r\n\r\n\tregisterShaderNode( \"utils/snippet\", LGraphShaderSnippet );\r\n\r\n\t//************************************\r\n\r\n\tfunction LGraphShaderRand()\r\n\t{\r\n\t\tthis.addOutput(\"out\",\"float\");\r\n\t}\r\n\r\n\tLGraphShaderRand.title = \"Rand\";\r\n\r\n\tLGraphShaderRand.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination || !this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\r\n\t\tcontext.addUniform( \"u_rand\" + this.id, \"float\", function(){ return Math.random(); });\r\n\t\tcontext.addCode(\"code\", \"float \" + outlink + \" = u_rand\" + this.id +\";\", this.shader_destination );\r\n\t\tthis.setOutputData( 0, \"float\" );\r\n\t}\r\n\r\n\tregisterShaderNode( \"input/rand\", LGraphShaderRand );\r\n\r\n\t//noise\r\n\t//https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\r\n\tfunction LGraphShaderNoise()\r\n\t{\r\n\t\tthis.addInput(\"out\", LGShaders.ALL_TYPES );\r\n\t\tthis.addInput(\"scale\", \"float\" );\r\n\t\tthis.addOutput(\"out\",\"float\");\r\n\t\tthis.properties = {\r\n\t\t\ttype: \"noise\",\r\n\t\t\tscale: 1\r\n\t\t};\r\n\t\tthis.addWidget(\"combo\",\"type\", this.properties.type, { property: \"type\", values: LGraphShaderNoise.NOISE_TYPES });\r\n\t\tthis.addWidget(\"number\",\"scale\", this.properties.scale, { property: \"scale\" });\r\n\t}\r\n\r\n\tLGraphShaderNoise.NOISE_TYPES = [\"noise\",\"rand\"];\r\n\r\n\tLGraphShaderNoise.title = \"noise\";\r\n\r\n\tLGraphShaderNoise.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination || !this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar inlink = getInputLinkID(this,0);\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\r\n\t\tvar intype = this.getInputData(0);\r\n\t\tif(!inlink)\r\n\t\t{\r\n\t\t\tintype = \"vec2\";\r\n\t\t\tinlink = context.buffer_names.uvs;\r\n\t\t}\r\n\r\n\t\tcontext.addFunction(\"noise\",LGraphShaderNoise.shader_functions);\r\n\t\tcontext.addUniform( \"u_noise_scale\" + this.id, \"float\", this.properties.scale );\r\n\t\tif( intype == \"float\" )\r\n\t\t\tcontext.addCode(\"code\", \"float \" + outlink + \" = snoise( vec2(\" + inlink +\") * u_noise_scale\" + this.id +\");\", this.shader_destination );\r\n\t\telse if( intype == \"vec2\" || intype == \"vec3\" )\r\n\t\t\tcontext.addCode(\"code\", \"float \" + outlink + \" = snoise(\" + inlink +\" * u_noise_scale\" + this.id +\");\", this.shader_destination );\r\n\t\telse if( intype == \"vec4\" )\r\n\t\t\tcontext.addCode(\"code\", \"float \" + outlink + \" = snoise(\" + inlink +\".xyz * u_noise_scale\" + this.id +\");\", this.shader_destination );\r\n\t\tthis.setOutputData( 0, \"float\" );\r\n\t}\r\n\r\n\tregisterShaderNode( \"math/noise\", LGraphShaderNoise );\r\n\r\nLGraphShaderNoise.shader_functions = \"\\n\\\r\nvec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }\\n\\\r\n\\n\\\r\nfloat snoise(vec2 v){\\n\\\r\n  const vec4 C = vec4(0.211324865405187, 0.366025403784439,-0.577350269189626, 0.024390243902439);\\n\\\r\n  vec2 i  = floor(v + dot(v, C.yy) );\\n\\\r\n  vec2 x0 = v -   i + dot(i, C.xx);\\n\\\r\n  vec2 i1;\\n\\\r\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\\n\\\r\n  vec4 x12 = x0.xyxy + C.xxzz;\\n\\\r\n  x12.xy -= i1;\\n\\\r\n  i = mod(i, 289.0);\\n\\\r\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\\n\\\r\n  + i.x + vec3(0.0, i1.x, 1.0 ));\\n\\\r\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)), 0.0);\\n\\\r\n  m = m*m ;\\n\\\r\n  m = m*m ;\\n\\\r\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\\n\\\r\n  vec3 h = abs(x) - 0.5;\\n\\\r\n  vec3 ox = floor(x + 0.5);\\n\\\r\n  vec3 a0 = x - ox;\\n\\\r\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\\n\\\r\n  vec3 g;\\n\\\r\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\\n\\\r\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\\n\\\r\n  return 130.0 * dot(m, g);\\n\\\r\n}\\n\\\r\nvec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\\n\\\r\nvec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\\n\\\r\n\\n\\\r\nfloat snoise(vec3 v){ \\n\\\r\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\\n\\\r\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\\n\\\r\n\\n\\\r\n// First corner\\n\\\r\n  vec3 i  = floor(v + dot(v, C.yyy) );\\n\\\r\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\\n\\\r\n\\n\\\r\n// Other corners\\n\\\r\n  vec3 g = step(x0.yzx, x0.xyz);\\n\\\r\n  vec3 l = 1.0 - g;\\n\\\r\n  vec3 i1 = min( g.xyz, l.zxy );\\n\\\r\n  vec3 i2 = max( g.xyz, l.zxy );\\n\\\r\n\\n\\\r\n  //  x0 = x0 - 0. + 0.0 * C \\n\\\r\n  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\\n\\\r\n  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\\n\\\r\n  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\\n\\\r\n\\n\\\r\n// Permutations\\n\\\r\n  i = mod(i, 289.0 ); \\n\\\r\n  vec4 p = permute( permute( permute( \\n\\\r\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\\n\\\r\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \\n\\\r\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\\n\\\r\n\\n\\\r\n// Gradients\\n\\\r\n// ( N*N points uniformly over a square, mapped onto an octahedron.)\\n\\\r\n  float n_ = 1.0/7.0; // N=7\\n\\\r\n  vec3  ns = n_ * D.wyz - D.xzx;\\n\\\r\n\\n\\\r\n  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\\n\\\r\n\\n\\\r\n  vec4 x_ = floor(j * ns.z);\\n\\\r\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\\n\\\r\n\\n\\\r\n  vec4 x = x_ *ns.x + ns.yyyy;\\n\\\r\n  vec4 y = y_ *ns.x + ns.yyyy;\\n\\\r\n  vec4 h = 1.0 - abs(x) - abs(y);\\n\\\r\n\\n\\\r\n  vec4 b0 = vec4( x.xy, y.xy );\\n\\\r\n  vec4 b1 = vec4( x.zw, y.zw );\\n\\\r\n\\n\\\r\n  vec4 s0 = floor(b0)*2.0 + 1.0;\\n\\\r\n  vec4 s1 = floor(b1)*2.0 + 1.0;\\n\\\r\n  vec4 sh = -step(h, vec4(0.0));\\n\\\r\n\\n\\\r\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\\n\\\r\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\\n\\\r\n\\n\\\r\n  vec3 p0 = vec3(a0.xy,h.x);\\n\\\r\n  vec3 p1 = vec3(a0.zw,h.y);\\n\\\r\n  vec3 p2 = vec3(a1.xy,h.z);\\n\\\r\n  vec3 p3 = vec3(a1.zw,h.w);\\n\\\r\n\\n\\\r\n//Normalise gradients\\n\\\r\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\\n\\\r\n  p0 *= norm.x;\\n\\\r\n  p1 *= norm.y;\\n\\\r\n  p2 *= norm.z;\\n\\\r\n  p3 *= norm.w;\\n\\\r\n\\n\\\r\n// Mix final noise value\\n\\\r\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\\n\\\r\n  m = m * m;\\n\\\r\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),dot(p2,x2), dot(p3,x3) ) );\\n\\\r\n}\\n\\\r\n\\n\\\r\nvec3 hash3( vec2 p ){\\n\\\r\n    vec3 q = vec3( dot(p,vec2(127.1,311.7)), \\n\\\r\n\t\t\t\t   dot(p,vec2(269.5,183.3)), \\n\\\r\n\t\t\t\t   dot(p,vec2(419.2,371.9)) );\\n\\\r\n\treturn fract(sin(q)*43758.5453);\\n\\\r\n}\\n\\\r\nvec4 hash4( vec3 p ){\\n\\\r\n    vec4 q = vec4( dot(p,vec3(127.1,311.7,257.3)), \\n\\\r\n\t\t\t\t   dot(p,vec3(269.5,183.3,335.1)), \\n\\\r\n\t\t\t\t   dot(p,vec3(314.5,235.1,467.3)), \\n\\\r\n\t\t\t\t   dot(p,vec3(419.2,371.9,114.9)) );\\n\\\r\n\treturn fract(sin(q)*43758.5453);\\n\\\r\n}\\n\\\r\n\\n\\\r\nfloat iqnoise( in vec2 x, float u, float v ){\\n\\\r\n    vec2 p = floor(x);\\n\\\r\n    vec2 f = fract(x);\\n\\\r\n\t\\n\\\r\n\tfloat k = 1.0+63.0*pow(1.0-v,4.0);\\n\\\r\n\t\\n\\\r\n\tfloat va = 0.0;\\n\\\r\n\tfloat wt = 0.0;\\n\\\r\n    for( int j=-2; j<=2; j++ )\\n\\\r\n    for( int i=-2; i<=2; i++ )\\n\\\r\n    {\\n\\\r\n        vec2 g = vec2( float(i),float(j) );\\n\\\r\n\t\tvec3 o = hash3( p + g )*vec3(u,u,1.0);\\n\\\r\n\t\tvec2 r = g - f + o.xy;\\n\\\r\n\t\tfloat d = dot(r,r);\\n\\\r\n\t\tfloat ww = pow( 1.0-smoothstep(0.0,1.414,sqrt(d)), k );\\n\\\r\n\t\tva += o.z*ww;\\n\\\r\n\t\twt += ww;\\n\\\r\n    }\\n\\\r\n\t\\n\\\r\n    return va/wt;\\n\\\r\n}\\n\\\r\n\"\r\n\r\n\tfunction LGraphShaderTime()\r\n\t{\r\n\t\tthis.addOutput(\"out\",\"float\");\r\n\t}\r\n\r\n\tLGraphShaderTime.title = \"Time\";\r\n\r\n\tLGraphShaderTime.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination || !this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\r\n\t\tcontext.addUniform( \"u_time\" + this.id, \"float\", function(){ return getTime() * 0.001; });\r\n\t\tcontext.addCode(\"code\", \"float \" + outlink + \" = u_time\" + this.id +\";\", this.shader_destination );\r\n\t\tthis.setOutputData( 0, \"float\" );\r\n\t}\r\n\r\n\tregisterShaderNode( \"input/time\", LGraphShaderTime );\r\n\r\n\r\n\tfunction LGraphShaderDither()\r\n\t{\r\n\t\tthis.addInput(\"in\",\"T\");\r\n\t\tthis.addOutput(\"out\",\"float\");\r\n\t}\r\n\r\n\tLGraphShaderDither.title = \"Dither\";\r\n\r\n\tLGraphShaderDither.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination || !this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar inlink = getInputLinkID(this,0);\r\n\t\tvar return_type = \"float\";\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\t\tvar intype = this.getInputData(0);\r\n\t\tinlink = varToTypeGLSL( inlink, intype, \"float\" );\r\n\t\tcontext.addFunction(\"dither8x8\", LGraphShaderDither.dither_func);\r\n\t\tcontext.addCode(\"code\", return_type + \" \" + outlink + \" = dither8x8(\"+ inlink +\");\", this.shader_destination );\r\n\t\tthis.setOutputData( 0, return_type );\r\n\t}\r\n\r\n\tLGraphShaderDither.dither_values = [0.515625,0.140625,0.640625,0.046875,0.546875,0.171875,0.671875,0.765625,0.265625,0.890625,0.390625,0.796875,0.296875,0.921875,0.421875,0.203125,0.703125,0.078125,0.578125,0.234375,0.734375,0.109375,0.609375,0.953125,0.453125,0.828125,0.328125,0.984375,0.484375,0.859375,0.359375,0.0625,0.5625,0.1875,0.6875,0.03125,0.53125,0.15625,0.65625,0.8125,0.3125,0.9375,0.4375,0.78125,0.28125,0.90625,0.40625,0.25,0.75,0.125,0.625,0.21875,0.71875,0.09375,0.59375,1.0001,0.5,0.875,0.375,0.96875,0.46875,0.84375,0.34375];\r\n\t\r\n\tLGraphShaderDither.dither_func = \"\\n\\\r\n\t\tfloat dither8x8(float brightness) {\\n\\\r\n\t\t  vec2 position = vec2(0.0);\\n\\\r\n\t\t  #ifdef FRAGMENT\\n\\\r\n\t\t\tposition = gl_FragCoord.xy;\\n\\\r\n\t\t  #endif\\n\\\r\n\t\t  int x = int(mod(position.x, 8.0));\\n\\\r\n\t\t  int y = int(mod(position.y, 8.0));\\n\\\r\n\t\t  int index = x + y * 8;\\n\\\r\n\t\t  float limit = 0.0;\\n\\\r\n\t\t  if (x < 8) {\\n\\\r\n\t\t\tif(index==0) limit = 0.015625;\\n\\\r\n\t\t\t\"+(LGraphShaderDither.dither_values.map( function(v,i){ return \"else if(index== \"+(i+1)+\") limit = \" + v + \";\"}).join(\"\\n\"))+\"\\n\\\r\n\t\t  }\\n\\\r\n\t\t  return brightness < limit ? 0.0 : 1.0;\\n\\\r\n\t\t}\\n\",\r\n\r\n\tregisterShaderNode( \"math/dither\", LGraphShaderDither );\r\n\r\n\tfunction LGraphShaderRemap()\r\n\t{\r\n\t\tthis.addInput(\"\", LGShaders.ALL_TYPES );\r\n\t\tthis.addOutput(\"\",\"\");\r\n\t\tthis.properties = {\r\n\t\t\tmin_value: 0,\r\n\t\t\tmax_value: 1,\r\n\t\t\tmin_value2: 0,\r\n\t\t\tmax_value2: 1\r\n\t\t};\r\n\t\tthis.addWidget(\"number\",\"min\",0,{ step: 0.1, property: \"min_value\" });\r\n\t\tthis.addWidget(\"number\",\"max\",1,{ step: 0.1, property: \"max_value\" });\r\n\t\tthis.addWidget(\"number\",\"min2\",0,{ step: 0.1, property: \"min_value2\"});\r\n\t\tthis.addWidget(\"number\",\"max2\",1,{ step: 0.1, property: \"max_value2\"});\r\n\t}\r\n\r\n\tLGraphShaderRemap.title = \"Remap\";\r\n\r\n\tLGraphShaderRemap.prototype.onPropertyChanged = function()\r\n\t{\r\n\t\tif(this.graph)\r\n\t\t\tthis.graph._version++;\r\n\t}\r\n\r\n\tLGraphShaderRemap.prototype.onConnectionsChange = function()\r\n\t{\r\n\t\tvar return_type = this.getInputDataType(0);\r\n\t\tthis.outputs[0].type = return_type || \"T\";\r\n\t}\r\n\r\n\tLGraphShaderRemap.prototype.onGetCode = function( context )\r\n\t{\r\n\t\tif(!this.shader_destination || !this.isOutputConnected(0))\r\n\t\t\treturn;\r\n\r\n\t\tvar inlink = getInputLinkID(this,0);\r\n\t\tvar outlink = getOutputLinkID(this,0);\r\n\t\tif(!inlink && !outlink) //not connected\r\n\t\t\treturn;\r\n\r\n\t\tvar return_type = this.getInputDataType(0);\r\n\t\tthis.outputs[0].type = return_type;\r\n\t\tif(return_type == \"T\")\r\n\t\t{\r\n\t\t\tconsole.warn(\"node type is T and cannot be resolved\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(!inlink)\r\n\t\t{\r\n\t\t\tcontext.addCode(\"code\",\"\t\" + return_type + \" \" + outlink + \" = \" + return_type + \"(0.0);\\n\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar minv = valueToGLSL( this.properties.min_value );\r\n\t\tvar maxv = valueToGLSL( this.properties.max_value );\r\n\t\tvar minv2 = valueToGLSL( this.properties.min_value2 );\r\n\t\tvar maxv2 = valueToGLSL( this.properties.max_value2 );\r\n\r\n\t\tcontext.addCode(\"code\", return_type + \" \" + outlink + \" = ( (\" + inlink + \" - \"+minv+\") / (\"+ maxv+\" - \"+minv+\") ) * (\"+ maxv2+\" - \"+minv2+\") + \" + minv2 + \";\", this.shader_destination );\r\n\t\tthis.setOutputData( 0, return_type );\r\n\t}\r\n\r\n\tregisterShaderNode( \"math/remap\", LGraphShaderRemap );\r\n\r\n})(this);\r\n\r\n\r\n\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n\tvar view_matrix = new Float32Array(16);\r\n\tvar projection_matrix = new Float32Array(16);\r\n\tvar viewprojection_matrix = new Float32Array(16);\r\n\tvar model_matrix = new Float32Array(16);\r\n\tvar global_uniforms = {\r\n\t\tu_view: view_matrix,\r\n\t\tu_projection: projection_matrix,\r\n\t\tu_viewprojection: viewprojection_matrix,\r\n\t\tu_model: model_matrix \r\n\t};\r\n\r\n\tLiteGraph.LGraphRender = {\r\n\t\tonRequestCameraMatrices: null //overwrite with your 3D engine specifics, it will receive (view_matrix, projection_matrix,viewprojection_matrix) and must be filled\r\n\t};\r\n\r\n\tfunction generateGeometryId() {\r\n\t\treturn (Math.random() * 100000)|0;\r\n\t}\r\n\r\n\tfunction LGraphPoints3D() {\r\n\r\n\t\tthis.addInput(\"obj\", \"\");\r\n\t\tthis.addInput(\"radius\", \"number\");\r\n\r\n\t\tthis.addOutput(\"out\", \"geometry\");\r\n\t\tthis.addOutput(\"points\", \"[vec3]\");\r\n\t\tthis.properties = {\r\n\t\t\tradius: 1,\r\n\t\t\tnum_points: 4096,\r\n\t\t\tgenerate_normals: true,\r\n\t\t\tregular: false,\r\n\t\t\tmode: LGraphPoints3D.SPHERE,\r\n\t\t\tforce_update: false\r\n\t\t};\r\n\r\n\t\tthis.points = new Float32Array( this.properties.num_points * 3 );\r\n\t\tthis.normals = new Float32Array( this.properties.num_points * 3 );\r\n\t\tthis.must_update = true;\r\n\t\tthis.version = 0;\r\n\r\n\t\tvar that = this;\r\n\t\tthis.addWidget(\"button\",\"update\",null, function(){ that.must_update = true; });\r\n\r\n\t\tthis.geometry = {\r\n\t\t\tvertices: null,\r\n\t\t\t_id: generateGeometryId()\r\n\t\t}\r\n\r\n\t\tthis._old_obj = null;\r\n\t\tthis._last_radius = null;\r\n\t}\r\n\r\n\tglobal.LGraphPoints3D = LGraphPoints3D;\r\n\r\n\tLGraphPoints3D.RECTANGLE = 1;\r\n\tLGraphPoints3D.CIRCLE = 2;\r\n\r\n\tLGraphPoints3D.CUBE = 10;\r\n\tLGraphPoints3D.SPHERE = 11;\r\n\tLGraphPoints3D.HEMISPHERE = 12;\r\n\tLGraphPoints3D.INSIDE_SPHERE = 13;\r\n\r\n\tLGraphPoints3D.OBJECT = 20;\r\n\tLGraphPoints3D.OBJECT_UNIFORMLY = 21;\r\n\tLGraphPoints3D.OBJECT_INSIDE = 22;\r\n\r\n\tLGraphPoints3D.MODE_VALUES = { \"rectangle\":LGraphPoints3D.RECTANGLE, \"circle\":LGraphPoints3D.CIRCLE, \"cube\":LGraphPoints3D.CUBE, \"sphere\":LGraphPoints3D.SPHERE, \"hemisphere\":LGraphPoints3D.HEMISPHERE, \"inside_sphere\":LGraphPoints3D.INSIDE_SPHERE, \"object\":LGraphPoints3D.OBJECT, \"object_uniformly\":LGraphPoints3D.OBJECT_UNIFORMLY, \"object_inside\":LGraphPoints3D.OBJECT_INSIDE };\r\n\r\n\tLGraphPoints3D.widgets_info = {\r\n\t\tmode: { widget: \"combo\", values: LGraphPoints3D.MODE_VALUES }\r\n\t};\r\n\r\n\tLGraphPoints3D.title = \"list of points\";\r\n\tLGraphPoints3D.desc = \"returns an array of points\";\r\n\r\n\tLGraphPoints3D.prototype.onPropertyChanged = function(name,value)\r\n\t{\r\n\t\tthis.must_update = true;\r\n\t}\r\n\r\n\tLGraphPoints3D.prototype.onExecute = function() {\r\n\r\n\t\tvar obj = this.getInputData(0);\r\n\t\tif( obj != this._old_obj || (obj && obj._version != this._old_obj_version) )\r\n\t\t{\r\n\t\t\tthis._old_obj = obj;\r\n\t\t\tthis.must_update = true;\r\n\t\t}\r\n\r\n\t\tvar radius = this.getInputData(1);\r\n\t\tif(radius == null)\r\n\t\t\tradius = this.properties.radius;\r\n\t\tif( this._last_radius != radius )\r\n\t\t{\r\n\t\t\tthis._last_radius = radius;\r\n\t\t\tthis.must_update = true;\r\n\t\t}\r\n\r\n\t\tif(this.must_update || this.properties.force_update )\r\n\t\t{\r\n\t\t\tthis.must_update = false;\r\n\t\t\tthis.updatePoints();\r\n\t\t}\r\n\r\n\t\tthis.geometry.vertices = this.points;\r\n\t\tthis.geometry.normals = this.normals;\r\n\t\tthis.geometry._version = this.version;\r\n\r\n\t\tthis.setOutputData( 0, this.geometry );\r\n\t}\r\n\r\n\tLGraphPoints3D.prototype.updatePoints = function() {\r\n\t\tvar num_points = this.properties.num_points|0;\r\n\t\tif(num_points < 1)\r\n\t\t\tnum_points = 1;\r\n\r\n\t\tif(!this.points || this.points.length != num_points * 3)\r\n\t\t\tthis.points = new Float32Array( num_points * 3 );\r\n\r\n\t\tif(this.properties.generate_normals)\r\n\t\t{\r\n\t\t\tif (!this.normals || this.normals.length != this.points.length)\r\n\t\t\t\tthis.normals = new Float32Array( this.points.length );\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.normals = null;\r\n\r\n\t\tvar radius = this._last_radius || this.properties.radius;\r\n\t\tvar mode = this.properties.mode;\r\n\r\n\t\tvar obj = this.getInputData(0);\r\n\t\tthis._old_obj_version = obj ? obj._version : null;\r\n\r\n\t\tthis.points = LGraphPoints3D.generatePoints( radius, num_points, mode, this.points, this.normals, this.properties.regular, obj );\r\n\r\n\t\tthis.version++;\r\n\t}\r\n\r\n\t//global\r\n\tLGraphPoints3D.generatePoints = function( radius, num_points, mode, points, normals, regular, obj )\r\n\t{\r\n\t\tvar size = num_points * 3;\r\n\t\tif(!points || points.length != size)\r\n\t\t\tpoints = new Float32Array( size );\r\n\t\tvar temp = new Float32Array(3);\r\n\t\tvar UP = new Float32Array([0,1,0]);\r\n\r\n\t\tif(regular)\r\n\t\t{\r\n\t\t\tif( mode == LGraphPoints3D.RECTANGLE)\r\n\t\t\t{\r\n\t\t\t\tvar side = Math.floor(Math.sqrt(num_points));\r\n\t\t\t\tfor(var i = 0; i < side; ++i)\r\n\t\t\t\tfor(var j = 0; j < side; ++j)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar pos = i*3 + j*3*side;\r\n\t\t\t\t\tpoints[pos] = ((i/side) - 0.5) * radius * 2;\r\n\t\t\t\t\tpoints[pos+1] = 0;\r\n\t\t\t\t\tpoints[pos+2] = ((j/side) - 0.5) * radius * 2;\r\n\t\t\t\t}\r\n\t\t\t\tpoints = new Float32Array( points.subarray(0,side*side*3) );\r\n\t\t\t\tif(normals)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor(var i = 0; i < normals.length; i+=3)\r\n\t\t\t\t\t\tnormals.set(UP, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.SPHERE)\r\n\t\t\t{\r\n\t\t\t\tvar side = Math.floor(Math.sqrt(num_points));\r\n\t\t\t\tfor(var i = 0; i < side; ++i)\r\n\t\t\t\tfor(var j = 0; j < side; ++j)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar pos = i*3 + j*3*side;\r\n\t\t\t\t\tpolarToCartesian( temp, (i/side) * 2 * Math.PI, ((j/side) - 0.5) * 2 * Math.PI, radius );\r\n\t\t\t\t\tpoints[pos] = temp[0];\r\n\t\t\t\t\tpoints[pos+1] = temp[1];\r\n\t\t\t\t\tpoints[pos+2] = temp[2];\r\n\t\t\t\t}\r\n\t\t\t\tpoints = new Float32Array( points.subarray(0,side*side*3) );\r\n\t\t\t\tif(normals)\r\n\t\t\t\t\tLGraphPoints3D.generateSphericalNormals( points, normals );\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.CIRCLE)\r\n\t\t\t{\r\n\t\t\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar angle = 2 * Math.PI * (i/size);\r\n\t\t\t\t\tpoints[i] = Math.cos( angle ) * radius;\r\n\t\t\t\t\tpoints[i+1] = 0;\r\n\t\t\t\t\tpoints[i+2] = Math.sin( angle ) * radius;\r\n\t\t\t\t}\r\n\t\t\t\tif(normals)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor(var i = 0; i < normals.length; i+=3)\r\n\t\t\t\t\t\tnormals.set(UP, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse //non regular\r\n\t\t{\r\n\t\t\tif( mode == LGraphPoints3D.RECTANGLE)\r\n\t\t\t{\r\n\t\t\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t\t\t{\r\n\t\t\t\t\tpoints[i] = (Math.random() - 0.5) * radius * 2;\r\n\t\t\t\t\tpoints[i+1] = 0;\r\n\t\t\t\t\tpoints[i+2] = (Math.random() - 0.5) * radius * 2;\r\n\t\t\t\t}\r\n\t\t\t\tif(normals)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor(var i = 0; i < normals.length; i+=3)\r\n\t\t\t\t\t\tnormals.set(UP, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.CUBE)\r\n\t\t\t{\r\n\t\t\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t\t\t{\r\n\t\t\t\t\tpoints[i] = (Math.random() - 0.5) * radius * 2;\r\n\t\t\t\t\tpoints[i+1] = (Math.random() - 0.5) * radius * 2;\r\n\t\t\t\t\tpoints[i+2] = (Math.random() - 0.5) * radius * 2;\r\n\t\t\t\t}\r\n\t\t\t\tif(normals)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor(var i = 0; i < normals.length; i+=3)\r\n\t\t\t\t\t\tnormals.set(UP, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.SPHERE)\r\n\t\t\t{\r\n\t\t\t\tLGraphPoints3D.generateSphere( points, size, radius );\r\n\t\t\t\tif(normals)\r\n\t\t\t\t\tLGraphPoints3D.generateSphericalNormals( points, normals );\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.HEMISPHERE)\r\n\t\t\t{\r\n\t\t\t\tLGraphPoints3D.generateHemisphere( points, size, radius );\r\n\t\t\t\tif(normals)\r\n\t\t\t\t\tLGraphPoints3D.generateSphericalNormals( points, normals );\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.CIRCLE)\r\n\t\t\t{\r\n\t\t\t\tLGraphPoints3D.generateInsideCircle( points, size, radius );\r\n\t\t\t\tif(normals)\r\n\t\t\t\t\tLGraphPoints3D.generateSphericalNormals( points, normals );\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.INSIDE_SPHERE)\r\n\t\t\t{\r\n\t\t\t\tLGraphPoints3D.generateInsideSphere( points, size, radius );\r\n\t\t\t\tif(normals)\r\n\t\t\t\t\tLGraphPoints3D.generateSphericalNormals( points, normals );\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.OBJECT)\r\n\t\t\t{\r\n\t\t\t\tLGraphPoints3D.generateFromObject( points, normals, size, obj, false );\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.OBJECT_UNIFORMLY)\r\n\t\t\t{\r\n\t\t\t\tLGraphPoints3D.generateFromObject( points, normals, size, obj, true );\r\n\t\t\t}\r\n\t\t\telse if( mode == LGraphPoints3D.OBJECT_INSIDE)\r\n\t\t\t{\r\n\t\t\t\tLGraphPoints3D.generateFromInsideObject( points, size, obj );\r\n\t\t\t\t//if(normals)\r\n\t\t\t\t//\tLGraphPoints3D.generateSphericalNormals( points, normals );\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tconsole.warn(\"wrong mode in LGraphPoints3D\");\r\n\t\t}\r\n\r\n\t\treturn points;\r\n\t}\r\n\r\n\tLGraphPoints3D.generateSphericalNormals = function(points, normals)\r\n\t{\r\n\t\tvar temp = new Float32Array(3);\r\n\t\tfor(var i = 0; i < normals.length; i+=3)\r\n\t\t{\r\n\t\t\ttemp[0] = points[i];\r\n\t\t\ttemp[1] = points[i+1];\r\n\t\t\ttemp[2] = points[i+2];\r\n\t\t\tvec3.normalize(temp,temp);\r\n\t\t\tnormals.set(temp,i);\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphPoints3D.generateSphere = function (points, size, radius)\r\n\t{\r\n\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t{\r\n\t\t\tvar r1 = Math.random();\r\n\t\t\tvar r2 = Math.random();\r\n\t\t\tvar x = 2 * Math.cos( 2 * Math.PI * r1 ) * Math.sqrt( r2 * (1-r2) );\r\n\t\t\tvar y = 1 - 2 * r2;\r\n\t\t\tvar z = 2 * Math.sin( 2 * Math.PI * r1 ) * Math.sqrt( r2 * (1-r2) );\r\n\t\t\tpoints[i] = x * radius;\r\n\t\t\tpoints[i+1] = y * radius;\r\n\t\t\tpoints[i+2] = z * radius;\r\n\t\t}\t\t\t\r\n\t}\r\n\r\n\tLGraphPoints3D.generateHemisphere = function (points, size, radius)\r\n\t{\r\n\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t{\r\n\t\t\tvar r1 = Math.random();\r\n\t\t\tvar r2 = Math.random();\r\n\t\t\tvar x = Math.cos( 2 * Math.PI * r1 ) * Math.sqrt(1 - r2*r2 );\r\n\t\t\tvar y = r2;\r\n\t\t\tvar z = Math.sin( 2 * Math.PI * r1 ) * Math.sqrt(1 - r2*r2 );\r\n\t\t\tpoints[i] = x * radius;\r\n\t\t\tpoints[i+1] = y * radius;\r\n\t\t\tpoints[i+2] = z * radius;\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphPoints3D.generateInsideCircle = function (points, size, radius)\r\n\t{\r\n\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t{\r\n\t\t\tvar r1 = Math.random();\r\n\t\t\tvar r2 = Math.random();\r\n\t\t\tvar x = Math.cos( 2 * Math.PI * r1 ) * Math.sqrt(1 - r2*r2 );\r\n\t\t\tvar y = r2;\r\n\t\t\tvar z = Math.sin( 2 * Math.PI * r1 ) * Math.sqrt(1 - r2*r2 );\r\n\t\t\tpoints[i] = x * radius;\r\n\t\t\tpoints[i+1] = 0;\r\n\t\t\tpoints[i+2] = z * radius;\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphPoints3D.generateInsideSphere = function (points, size, radius)\r\n\t{\r\n\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t{\r\n\t\t\tvar u = Math.random();\r\n\t\t\tvar v = Math.random();\r\n\t\t\tvar theta = u * 2.0 * Math.PI;\r\n\t\t\tvar phi = Math.acos(2.0 * v - 1.0);\r\n\t\t\tvar r = Math.cbrt(Math.random()) * radius;\r\n\t\t\tvar sinTheta = Math.sin(theta);\r\n\t\t\tvar cosTheta = Math.cos(theta);\r\n\t\t\tvar sinPhi = Math.sin(phi);\r\n\t\t\tvar cosPhi = Math.cos(phi);\r\n\t\t\tpoints[i] = r * sinPhi * cosTheta;\r\n\t\t\tpoints[i+1] = r * sinPhi * sinTheta;\r\n\t\t\tpoints[i+2] = r * cosPhi;\r\n\t\t}\t\r\n\t}\r\n\r\n\tfunction findRandomTriangle( areas, f )\r\n\t{\r\n\t\tvar l = areas.length;\r\n\t\tvar imin = 0;\r\n\t\tvar imid = 0;\r\n\t\tvar imax = l;\r\n\r\n\t\tif(l == 0)\r\n\t\t\treturn -1;\r\n\t\tif(l == 1)\r\n\t\t\treturn 0;\r\n\t\t//dichotomic search\r\n\t\twhile (imax >= imin)\r\n\t\t{\r\n\t\t\timid = ((imax + imin)*0.5)|0;\r\n\t\t\tvar t = areas[ imid ];\r\n\t\t\tif( t == f )\r\n\t\t\t\treturn imid; \r\n\t\t\tif( imin == (imax - 1) )\r\n\t\t\t\treturn imin;\r\n\t\t\tif (t < f)\r\n\t\t\t\timin = imid;\r\n\t\t\telse         \r\n\t\t\t\timax = imid;\r\n\t\t}\r\n\t\treturn imid;\t\t\r\n\t}\r\n\r\n\tLGraphPoints3D.generateFromObject = function( points, normals, size, obj, evenly )\r\n\t{\r\n\t\tif(!obj)\r\n\t\t\treturn;\r\n\r\n\t\tvar vertices = null;\r\n\t\tvar mesh_normals = null;\r\n\t\tvar indices = null;\r\n\t\tvar areas = null;\r\n\t\tif( obj.constructor === GL.Mesh )\r\n\t\t{\r\n\t\t\tvertices = obj.vertexBuffers.vertices.data;\r\n\t\t\tmesh_normals = obj.vertexBuffers.normals ? obj.vertexBuffers.normals.data : null;\r\n\t\t\tindices = obj.indexBuffers.indices ? obj.indexBuffers.indices.data : null;\r\n\t\t\tif(!indices)\r\n\t\t\t\tindices = obj.indexBuffers.triangles ? obj.indexBuffers.triangles.data : null;\r\n\t\t}\r\n\t\tif(!vertices)\r\n\t\t\treturn null;\r\n\t\tvar num_triangles = indices ? indices.length / 3 : vertices.length / (3*3);\r\n\t\tvar total_area = 0; //sum of areas of all triangles\r\n\r\n\t\tif(evenly)\r\n\t\t{\r\n\t\t\tareas = new Float32Array(num_triangles); //accum\r\n\t\t\tfor(var i = 0; i < num_triangles; ++i)\r\n\t\t\t{\r\n\t\t\t\tif(indices)\r\n\t\t\t\t{\r\n\t\t\t\t\ta = indices[i*3]*3;\r\n\t\t\t\t\tb = indices[i*3+1]*3;\r\n\t\t\t\t\tc = indices[i*3+2]*3;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\ta = i*9;\r\n\t\t\t\t\tb = i*9+3;\r\n\t\t\t\t\tc = i*9+6;\r\n\t\t\t\t}\r\n\t\t\t\tvar P1 = vertices.subarray(a,a+3);\r\n\t\t\t\tvar P2 = vertices.subarray(b,b+3);\r\n\t\t\t\tvar P3 = vertices.subarray(c,c+3);\r\n\t\t\t\tvar aL = vec3.distance( P1, P2 );\r\n\t\t\t\tvar bL = vec3.distance( P2, P3 );\r\n\t\t\t\tvar cL = vec3.distance( P3, P1 );\r\n\t\t\t\tvar s = (aL + bL+ cL) / 2;\r\n\t\t\t\ttotal_area += Math.sqrt(s * (s - aL) * (s - bL) * (s - cL));\r\n\t\t\t\tareas[i] = total_area;\r\n\t\t\t}\t\t\t\r\n\t\t\tfor(var i = 0; i < num_triangles; ++i) //normalize\r\n\t\t\t\tareas[i] /= total_area;\r\n\t\t}\r\n\r\n\t\tfor(var i = 0; i < size; i+=3)\r\n\t\t{\r\n\t\t\tvar r = Math.random();\r\n\t\t\tvar index = evenly ? findRandomTriangle( areas, r ) : Math.floor(r * num_triangles );\r\n\t\t\t//get random triangle\r\n\t\t\tvar a = 0;\r\n\t\t\tvar b = 0;\r\n\t\t\tvar c = 0;\r\n\t\t\tif(indices)\r\n\t\t\t{\r\n\t\t\t\ta = indices[index*3]*3;\r\n\t\t\t\tb = indices[index*3+1]*3;\r\n\t\t\t\tc = indices[index*3+2]*3;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\ta = index*9;\r\n\t\t\t\tb = index*9+3;\r\n\t\t\t\tc = index*9+6;\r\n\t\t\t}\r\n\t\t\tvar s = Math.random();\r\n\t\t\tvar t = Math.random();\r\n\t\t\tvar sqrt_s = Math.sqrt(s);\r\n\t\t\tvar af = 1 - sqrt_s;\r\n\t\t\tvar bf = sqrt_s * ( 1 - t);\r\n\t\t\tvar cf = t * sqrt_s;\r\n\t\t\tpoints[i] = af * vertices[a] + bf*vertices[b] + cf*vertices[c];\r\n\t\t\tpoints[i+1] = af * vertices[a+1] + bf*vertices[b+1] + cf*vertices[c+1];\r\n\t\t\tpoints[i+2] = af * vertices[a+2] + bf*vertices[b+2] + cf*vertices[c+2];\r\n\t\t\tif(normals && mesh_normals)\r\n\t\t\t{\r\n\t\t\t\tnormals[i] = af * mesh_normals[a] + bf*mesh_normals[b] + cf*mesh_normals[c];\r\n\t\t\t\tnormals[i+1] = af * mesh_normals[a+1] + bf*mesh_normals[b+1] + cf*mesh_normals[c+1];\r\n\t\t\t\tnormals[i+2] = af * mesh_normals[a+2] + bf*mesh_normals[b+2] + cf*mesh_normals[c+2];\r\n\t\t\t\tvar N = normals.subarray(i,i+3);\r\n\t\t\t\tvec3.normalize(N,N);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphPoints3D.generateFromInsideObject = function( points, size, mesh )\r\n\t{\r\n\t\tif(!mesh || mesh.constructor !== GL.Mesh)\r\n\t\t\treturn;\r\n\r\n\t\tvar aabb = mesh.getBoundingBox();\r\n\t\tif(!mesh.octree)\r\n\t\t\tmesh.octree = new GL.Octree( mesh );\r\n\t\tvar octree = mesh.octree;\r\n\t\tvar origin = vec3.create();\r\n\t\tvar direction = vec3.fromValues(1,0,0);\r\n\t\tvar temp = vec3.create();\r\n\t\tvar i = 0;\r\n\t\tvar tries = 0;\r\n\t\twhile(i < size && tries < points.length * 10) //limit to avoid problems\r\n\t\t{\r\n\t\t\ttries += 1\r\n\t\t\tvar r = vec3.random(temp); //random point inside the aabb\r\n\t\t\tr[0] = (r[0] * 2 - 1) * aabb[3] + aabb[0];\r\n\t\t\tr[1] = (r[1] * 2 - 1) * aabb[4] + aabb[1];\r\n\t\t\tr[2] = (r[2] * 2 - 1) * aabb[5] + aabb[2];\r\n\t\t\torigin.set(r);\r\n\t\t\tvar hit = octree.testRay( origin, direction, 0, 10000, true, GL.Octree.ALL );\r\n\t\t\tif(!hit || hit.length % 2 == 0) //not inside\r\n\t\t\t\tcontinue;\r\n\t\t\tpoints.set( r, i );\r\n\t\t\ti+=3;\r\n\t\t}\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/points3D\", LGraphPoints3D );\r\n\r\n\r\n\r\n\tfunction LGraphPointsToInstances() {\r\n\t\tthis.addInput(\"points\", \"geometry\");\r\n\t\tthis.addOutput(\"instances\", \"[mat4]\");\r\n\t\tthis.properties = {\r\n\t\t\tmode: 1,\r\n\t\t\tautoupdate: true\r\n\t\t};\r\n\r\n\t\tthis.must_update = true;\r\n\t\tthis.matrices = [];\r\n\t\tthis.first_time = true;\r\n\t}\r\n\r\n\tLGraphPointsToInstances.NORMAL = 0;\r\n\tLGraphPointsToInstances.VERTICAL = 1;\r\n\tLGraphPointsToInstances.SPHERICAL = 2;\r\n\tLGraphPointsToInstances.RANDOM = 3;\r\n\tLGraphPointsToInstances.RANDOM_VERTICAL = 4;\r\n\r\n\tLGraphPointsToInstances.modes = {\"normal\":0,\"vertical\":1,\"spherical\":2,\"random\":3,\"random_vertical\":4};\r\n\tLGraphPointsToInstances.widgets_info = {\r\n\t\tmode: { widget: \"combo\", values: LGraphPointsToInstances.modes }\r\n\t};\r\n\r\n\tLGraphPointsToInstances.title = \"points to inst\";\r\n\r\n\tLGraphPointsToInstances.prototype.onExecute = function()\r\n\t{\r\n\t\tvar geo = this.getInputData(0);\r\n\t\tif( !geo )\r\n\t\t{\r\n\t\t\tthis.setOutputData(0,null);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif( !this.isOutputConnected(0) )\r\n\t\t\treturn;\r\n\r\n\t\tvar has_changed = (geo._version != this._version || geo._id != this._geometry_id);\r\n\r\n\t\tif( has_changed && this.properties.autoupdate || this.first_time )\r\n\t\t{\r\n\t\t\tthis.first_time = false;\r\n\t\t\tthis.updateInstances( geo );\r\n\t\t}\r\n\r\n\t\tthis.setOutputData( 0, this.matrices );\r\n\t}\r\n\r\n\tLGraphPointsToInstances.prototype.updateInstances = function( geometry )\r\n\t{\r\n\t\tvar vertices = geometry.vertices;\r\n\t\tif(!vertices)\r\n\t\t\treturn null;\r\n\t\tvar normals = geometry.normals;\r\n\r\n\t\tvar matrices = this.matrices;\r\n\t\tvar num_points = vertices.length / 3;\r\n\t\tif( matrices.length != num_points)\r\n\t\t\tmatrices.length = num_points;\r\n\t\tvar identity = mat4.create();\r\n\t\tvar temp = vec3.create();\r\n\t\tvar zero = vec3.create();\r\n\t\tvar UP = vec3.fromValues(0,1,0);\r\n\t\tvar FRONT = vec3.fromValues(0,0,-1);\r\n\t\tvar RIGHT = vec3.fromValues(1,0,0);\r\n\t\tvar R = quat.create();\r\n\r\n\t\tvar front = vec3.create();\r\n\t\tvar right = vec3.create();\r\n\t\tvar top = vec3.create();\r\n\r\n\t\tfor(var i = 0; i < vertices.length; i += 3)\r\n\t\t{\r\n\t\t\tvar index = i/3;\r\n\t\t\tvar m = matrices[index];\r\n\t\t\tif(!m)\r\n\t\t\t\tm = matrices[index] = mat4.create();\r\n\t\t\tm.set( identity );\r\n\t\t\tvar point = vertices.subarray(i,i+3);\r\n\r\n\t\t\tswitch(this.properties.mode)\r\n\t\t\t{\r\n\t\t\t\tcase LGraphPointsToInstances.NORMAL: \r\n\t\t\t\t\tmat4.setTranslation( m, point );\r\n\t\t\t\t\tif(normals)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar normal = normals.subarray(i,i+3);\r\n\t\t\t\t\t\ttop.set( normal );\r\n\t\t\t\t\t\tvec3.normalize( top, top );\r\n\t\t\t\t\t\tvec3.cross( right, FRONT, top );\r\n\t\t\t\t\t\tvec3.normalize( right, right );\r\n\t\t\t\t\t\tvec3.cross( front, right, top );\r\n\t\t\t\t\t\tvec3.normalize( front, front );\r\n\t\t\t\t\t\tm.set(right,0);\r\n\t\t\t\t\t\tm.set(top,4);\r\n\t\t\t\t\t\tm.set(front,8);\r\n\t\t\t\t\t\tmat4.setTranslation( m, point );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LGraphPointsToInstances.VERTICAL: \r\n\t\t\t\t\tmat4.setTranslation( m, point );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LGraphPointsToInstances.SPHERICAL: \r\n\t\t\t\t\tfront.set( point );\r\n\t\t\t\t\tvec3.normalize( front, front );\r\n\t\t\t\t\tvec3.cross( right, UP, front );\r\n\t\t\t\t\tvec3.normalize( right, right );\r\n\t\t\t\t\tvec3.cross( top, front, right );\r\n\t\t\t\t\tvec3.normalize( top, top );\r\n\t\t\t\t\tm.set(right,0);\r\n\t\t\t\t\tm.set(top,4);\r\n\t\t\t\t\tm.set(front,8);\r\n\t\t\t\t\tmat4.setTranslation( m, point );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LGraphPointsToInstances.RANDOM:\r\n\t\t\t\t\ttemp[0] = Math.random()*2 - 1;\r\n\t\t\t\t\ttemp[1] = Math.random()*2 - 1;\r\n\t\t\t\t\ttemp[2] = Math.random()*2 - 1;\r\n\t\t\t\t\tvec3.normalize( temp, temp );\r\n\t\t\t\t\tquat.setAxisAngle( R, temp, Math.random() * 2 * Math.PI );\r\n\t\t\t\t\tmat4.fromQuat(m, R);\r\n\t\t\t\t\tmat4.setTranslation( m, point );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LGraphPointsToInstances.RANDOM_VERTICAL:\r\n\t\t\t\t\tquat.setAxisAngle( R, UP, Math.random() * 2 * Math.PI );\r\n\t\t\t\t\tmat4.fromQuat(m, R);\r\n\t\t\t\t\tmat4.setTranslation( m, point );\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._version = geometry._version;\r\n\t\tthis._geometry_id = geometry._id;\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/points_to_instances\", LGraphPointsToInstances );\r\n\r\n\r\n\tfunction LGraphGeometryTransform() {\r\n\t\tthis.addInput(\"in\", \"geometry,[mat4]\");\r\n\t\tthis.addInput(\"mat4\", \"mat4\");\r\n\t\tthis.addOutput(\"out\", \"geometry\");\r\n\t\tthis.properties = {};\r\n\r\n\t\tthis.geometry = {\r\n\t\t\ttype: \"triangles\",\r\n\t\t\tvertices: null,\r\n\t\t\t_id: generateGeometryId(),\r\n\t\t\t_version: 0\r\n\t\t};\r\n\r\n\t\tthis._last_geometry_id = -1;\r\n\t\tthis._last_version = -1;\r\n\t\tthis._last_key = \"\";\r\n\r\n\t\tthis.must_update = true;\r\n\t}\r\n\r\n\tLGraphGeometryTransform.title = \"Transform\";\r\n\r\n\tLGraphGeometryTransform.prototype.onExecute = function() {\r\n\r\n\t\tvar input = this.getInputData(0);\r\n\t\tvar model = this.getInputData(1);\r\n\r\n\t\tif(!input)\r\n\t\t\treturn;\r\n\r\n\t\t//array of matrices\r\n\t\tif(input.constructor === Array)\r\n\t\t{\r\n\t\t\tif(input.length == 0)\r\n\t\t\t\treturn;\r\n\t\t\tthis.outputs[0].type = \"[mat4]\";\r\n\t\t\tif( !this.isOutputConnected(0) )\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif(!model)\r\n\t\t\t{\r\n\t\t\t\tthis.setOutputData(0,input);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!this._output)\r\n\t\t\t\tthis._output = new Array();\r\n\t\t\tif(this._output.length != input.length)\r\n\t\t\t\tthis._output.length = input.length;\r\n\t\t\tfor(var i = 0; i < input.length; ++i)\r\n\t\t\t{\r\n\t\t\t\tvar m = this._output[i];\r\n\t\t\t\tif(!m)\r\n\t\t\t\t\tm = this._output[i] = mat4.create();\r\n\t\t\t\tmat4.multiply(m,input[i],model);\r\n\t\t\t}\r\n\t\t\tthis.setOutputData(0,this._output);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//geometry\r\n\t\tif(!input.vertices || !input.vertices.length)\r\n\t\t\treturn;\r\n\t\tvar geo = input;\r\n\t\tthis.outputs[0].type = \"geometry\";\r\n\t\tif( !this.isOutputConnected(0) )\r\n\t\t\treturn;\r\n\t\tif(!model)\r\n\t\t{\r\n\t\t\tthis.setOutputData(0,geo);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar key = typedArrayToArray(model).join(\",\");\r\n\r\n\t\tif( this.must_update || geo._id != this._last_geometry_id || geo._version != this._last_version || key != this._last_key )\r\n\t\t{\r\n\t\t\tthis.updateGeometry(geo, model);\r\n\t\t\tthis._last_key = key;\r\n\t\t\tthis._last_version = geo._version;\r\n\t\t\tthis._last_geometry_id = geo._id;\r\n\t\t\tthis.must_update = false;\r\n\t\t}\r\n\r\n\t\tthis.setOutputData(0,this.geometry);\r\n\t}\r\n\r\n\tLGraphGeometryTransform.prototype.updateGeometry = function(geometry, model) {\r\n\t\tvar old_vertices = geometry.vertices;\r\n\t\tvar vertices = this.geometry.vertices;\r\n\t\tif( !vertices || vertices.length != old_vertices.length )\r\n\t\t\tvertices = this.geometry.vertices = new Float32Array( old_vertices.length );\r\n\t\tvar temp = vec3.create();\r\n\r\n\t\tfor(var i = 0, l = vertices.length; i < l; i+=3)\r\n\t\t{\r\n\t\t\ttemp[0] = old_vertices[i]; temp[1] = old_vertices[i+1]; temp[2] = old_vertices[i+2]; \r\n\t\t\tmat4.multiplyVec3( temp, model, temp );\r\n\t\t\tvertices[i] = temp[0]; vertices[i+1] = temp[1]; vertices[i+2] = temp[2];\r\n\t\t}\r\n\r\n\t\tif(geometry.normals)\r\n\t\t{\r\n\t\t\tif( !this.geometry.normals || this.geometry.normals.length != geometry.normals.length )\r\n\t\t\t\tthis.geometry.normals = new Float32Array( geometry.normals.length );\r\n\t\t\tvar normals = this.geometry.normals;\r\n\t\t\tvar normal_model = mat4.invert(mat4.create(), model);\r\n\t\t\tif(normal_model)\r\n\t\t\t\tmat4.transpose(normal_model, normal_model);\r\n\t\t\tvar old_normals = geometry.normals;\r\n\t\t\tfor(var i = 0, l = normals.length; i < l; i+=3)\r\n\t\t\t{\r\n\t\t\t\ttemp[0] = old_normals[i]; temp[1] = old_normals[i+1]; temp[2] = old_normals[i+2]; \r\n\t\t\t\tmat4.multiplyVec3( temp, normal_model, temp );\r\n\t\t\t\tnormals[i] = temp[0]; normals[i+1] = temp[1]; normals[i+2] = temp[2];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.geometry.type = geometry.type;\r\n\t\tthis.geometry._version++;\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/transform\", LGraphGeometryTransform );\r\n\r\n\r\n\tfunction LGraphGeometryPolygon() {\r\n\t\tthis.addInput(\"sides\", \"number\");\r\n\t\tthis.addInput(\"radius\", \"number\");\r\n\t\tthis.addOutput(\"out\", \"geometry\");\r\n\t\tthis.properties = { sides: 6, radius: 1, uvs: false }\r\n\r\n\t\tthis.geometry = {\r\n\t\t\ttype: \"line_loop\",\r\n\t\t\tvertices: null,\r\n\t\t\t_id: generateGeometryId()\r\n\t\t};\r\n\t\tthis.geometry_id = -1;\r\n\t\tthis.version = -1;\r\n\t\tthis.must_update = true;\r\n\r\n\t\tthis.last_info = { sides: -1, radius: -1 };\r\n\t}\r\n\r\n\tLGraphGeometryPolygon.title = \"Polygon\";\r\n\r\n\tLGraphGeometryPolygon.prototype.onExecute = function() {\r\n\r\n\t\tif( !this.isOutputConnected(0) )\r\n\t\t\treturn;\r\n\r\n\t\tvar sides = this.getInputOrProperty(\"sides\");\r\n\t\tvar radius = this.getInputOrProperty(\"radius\");\r\n\t\tsides = Math.max(3,sides)|0;\r\n\r\n\t\t//update\r\n\t\tif( this.last_info.sides != sides || this.last_info.radius != radius )\r\n\t\t\tthis.updateGeometry(sides, radius);\r\n\r\n\t\tthis.setOutputData(0,this.geometry);\r\n\t}\r\n\r\n\tLGraphGeometryPolygon.prototype.updateGeometry = function(sides, radius) {\r\n\t\tvar num = 3*sides;\r\n\t\tvar vertices = this.geometry.vertices;\r\n\t\tif( !vertices || vertices.length != num )\r\n\t\t\tvertices = this.geometry.vertices = new Float32Array( 3*sides );\r\n\t\tvar delta = (Math.PI * 2) / sides;\r\n\t\tvar gen_uvs = this.properties.uvs;\r\n\t\tif(gen_uvs)\r\n\t\t{\r\n\t\t\tuvs = this.geometry.coords = new Float32Array( 3*sides );\r\n\t\t}\r\n\r\n\r\n\t\tfor(var i = 0; i < sides; ++i)\r\n\t\t{\r\n\t\t\tvar angle = delta * -i;\r\n\t\t\tvar x = Math.cos( angle ) * radius;\r\n\t\t\tvar y = 0;\r\n\t\t\tvar z = Math.sin( angle ) * radius;\r\n\t\t\tvertices[i*3] = x;\r\n\t\t\tvertices[i*3+1] = y;\r\n\t\t\tvertices[i*3+2] = z;\r\n\r\n\t\t\tif(gen_uvs)\r\n\t\t\t{\r\n\t\t\t\t\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.geometry._id = ++this.geometry_id;\r\n\t\tthis.geometry._version = ++this.version;\r\n\t\tthis.last_info.sides = sides;\r\n\t\tthis.last_info.radius = radius;\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/polygon\", LGraphGeometryPolygon );\r\n\r\n\r\n\tfunction LGraphGeometryExtrude() {\r\n\r\n\t\tthis.addInput(\"\", \"geometry\");\r\n\t\tthis.addOutput(\"\", \"geometry\");\r\n\t\tthis.properties = { top_cap: true, bottom_cap: true, offset: [0,100,0] };\r\n\t\tthis.version = -1;\r\n\r\n\t\tthis._last_geo_version = -1;\r\n\t\tthis._must_update = true;\r\n\t}\r\n\r\n\tLGraphGeometryExtrude.title = \"extrude\";\r\n\r\n\tLGraphGeometryExtrude.prototype.onPropertyChanged = function(name, value)\r\n\t{\r\n\t\tthis._must_update = true;\r\n\t}\r\n\r\n\tLGraphGeometryExtrude.prototype.onExecute = function()\r\n\t{\r\n\t\tvar geo = this.getInputData(0);\r\n\t\tif( !geo || !this.isOutputConnected(0) )\r\n\t\t\treturn;\r\n\r\n\t\tif(geo.version != this._last_geo_version || this._must_update)\r\n\t\t{\r\n\t\t\tthis._geo = this.extrudeGeometry( geo, this._geo );\r\n\t\t\tif(this._geo)\r\n\t\t\t\tthis._geo.version = this.version++;\r\n\t\t\tthis._must_update = false;\r\n\t\t}\r\n\r\n\t\tthis.setOutputData(0, this._geo);\r\n\t}\r\n\r\n\tLGraphGeometryExtrude.prototype.extrudeGeometry = function( geo )\r\n\t{\r\n\t\t//for every pair of vertices\r\n\t\tvar vertices = geo.vertices;\r\n\t\tvar num_points = vertices.length / 3;\r\n\r\n\t\tvar tempA = vec3.create();\r\n\t\tvar tempB = vec3.create();\r\n\t\tvar tempC = vec3.create();\r\n\t\tvar tempD = vec3.create();\r\n\t\tvar offset = new Float32Array( this.properties.offset );\r\n\r\n\t\tif(geo.type == \"line_loop\")\r\n\t\t{\r\n\t\t\tvar new_vertices = new Float32Array( num_points * 6 * 3 ); //every points become 6 ( caps not included )\r\n\t\t\tvar npos = 0;\r\n\t\t\tfor(var i = 0, l = vertices.length; i < l; i += 3)\r\n\t\t\t{\r\n\t\t\t\ttempA[0] = vertices[i]; tempA[1] = vertices[i+1]; tempA[2] = vertices[i+2];\r\n\r\n\t\t\t\tif( i+3 < l ) //loop\r\n\t\t\t\t{\r\n\t\t\t\t\ttempB[0] = vertices[i+3]; tempB[1] = vertices[i+4]; tempB[2] = vertices[i+5];\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\ttempB[0] = vertices[0]; tempB[1] = vertices[1]; tempB[2] = vertices[2];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvec3.add( tempC, tempA, offset );\r\n\t\t\t\tvec3.add( tempD, tempB, offset );\r\n\r\n\t\t\t\tnew_vertices.set( tempA, npos ); npos += 3;\r\n\t\t\t\tnew_vertices.set( tempB, npos ); npos += 3;\r\n\t\t\t\tnew_vertices.set( tempC, npos ); npos += 3;\r\n\r\n\t\t\t\tnew_vertices.set( tempB, npos ); npos += 3;\r\n\t\t\t\tnew_vertices.set( tempD, npos ); npos += 3;\r\n\t\t\t\tnew_vertices.set( tempC, npos ); npos += 3;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar out_geo = {\r\n\t\t\t_id: generateGeometryId(),\r\n\t\t\ttype: \"triangles\",\r\n\t\t\tvertices: new_vertices\r\n\t\t};\r\n\r\n\t\treturn out_geo;\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/extrude\", LGraphGeometryExtrude );\r\n\r\n\r\n\tfunction LGraphGeometryEval() {\r\n\t\tthis.addInput(\"in\", \"geometry\");\r\n\t\tthis.addOutput(\"out\", \"geometry\");\r\n\r\n\t\tthis.properties = {\r\n\t\t\tcode: \"V[1] += 0.01 * Math.sin(I + T*0.001);\",\r\n\t\t\texecute_every_frame: false\r\n\t\t};\r\n\r\n\t\tthis.geometry = null;\r\n\t\tthis.geometry_id = -1;\r\n\t\tthis.version = -1;\r\n\t\tthis.must_update = true;\r\n\r\n\t\tthis.vertices = null;\r\n\t\tthis.func = null;\r\n\t}\r\n\r\n\tLGraphGeometryEval.title = \"geoeval\";\r\n\tLGraphGeometryEval.desc = \"eval code\";\r\n\r\n\tLGraphGeometryEval.widgets_info = {\r\n\t\tcode: { widget: \"code\" }\r\n\t};\r\n\r\n\tLGraphGeometryEval.prototype.onConfigure = function(o)\r\n\t{\r\n\t\tthis.compileCode();\r\n\t}\r\n\r\n\tLGraphGeometryEval.prototype.compileCode = function()\r\n\t{\r\n\t\tif(!this.properties.code)\r\n\t\t\treturn;\r\n\r\n\t\ttry\r\n\t\t{\r\n\t\t\tthis.func = new Function(\"V\",\"I\",\"T\", this.properties.code); \r\n\t\t\tthis.boxcolor = \"#AFA\";\r\n\t\t\tthis.must_update = true;\r\n\t\t}\r\n\t\tcatch (err)\r\n\t\t{\r\n\t\t\tthis.boxcolor = \"red\";\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphGeometryEval.prototype.onPropertyChanged = function(name, value)\r\n\t{\r\n\t\tif(name == \"code\")\r\n\t\t{\r\n\t\t\tthis.properties.code = value;\r\n\t\t\tthis.compileCode();\r\n\t\t}\r\n\t}\r\n\r\n\tLGraphGeometryEval.prototype.onExecute = function() {\r\n\t\tvar geometry = this.getInputData(0);\r\n\t\tif(!geometry)\r\n\t\t\treturn;\r\n\r\n\t\tif(!this.func)\r\n\t\t{\r\n\t\t\tthis.setOutputData(0,geometry);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif( this.geometry_id != geometry._id || this.version != geometry._version || this.must_update || this.properties.execute_every_frame )\r\n\t\t{\r\n\t\t\tthis.must_update = false;\r\n\t\t\tthis.geometry_id = geometry._id;\r\n\t\t\tif(this.properties.execute_every_frame)\r\n\t\t\t\tthis.version++;\r\n\t\t\telse\r\n\t\t\t\tthis.version = geometry._version;\r\n\t\t\tvar func = this.func;\r\n\t\t\tvar T = getTime();\r\n\r\n\t\t\t//clone\r\n\t\t\tif(!this.geometry)\r\n\t\t\t\tthis.geometry = {};\r\n\t\t\tfor(var i in geometry)\r\n\t\t\t{\r\n\t\t\t\tif(geometry[i] == null)\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tif( geometry[i].constructor == Float32Array )\r\n\t\t\t\t\tthis.geometry[i] = new Float32Array( geometry[i] );\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.geometry[i] = geometry[i];\r\n\t\t\t}\r\n\t\t\tthis.geometry._id = geometry._id;\r\n\t\t\tif(this.properties.execute_every_frame)\r\n\t\t\t\tthis.geometry._version = this.version;\r\n\t\t\telse\r\n\t\t\t\tthis.geometry._version = geometry._version + 1;\r\n\r\n\t\t\tvar V = vec3.create();\r\n\t\t\tvar vertices = this.vertices;\r\n\t\t\tif(!vertices || this.vertices.length != geometry.vertices.length)\r\n\t\t\t\tvertices = this.vertices = new Float32Array( geometry.vertices );\r\n\t\t\telse\r\n\t\t\t\tvertices.set( geometry.vertices );\r\n\t\t\tfor(var i = 0; i < vertices.length; i+=3)\r\n\t\t\t{\r\n\t\t\t\tV[0] = vertices[i];\r\n\t\t\t\tV[1] = vertices[i+1];\r\n\t\t\t\tV[2] = vertices[i+2];\r\n\t\t\t\tfunc(V,i/3,T);\r\n\t\t\t\tvertices[i] = V[0];\r\n\t\t\t\tvertices[i+1] = V[1];\r\n\t\t\t\tvertices[i+2] = V[2];\r\n\t\t\t}\r\n\t\t\tthis.geometry.vertices = vertices;\r\n\t\t}\r\n\r\n\t\tthis.setOutputData(0,this.geometry);\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/eval\", LGraphGeometryEval );\r\n\r\n/*\r\nfunction LGraphGeometryDisplace() {\r\n\t\tthis.addInput(\"in\", \"geometry\");\r\n\t\tthis.addInput(\"img\", \"image\");\r\n\t\tthis.addOutput(\"out\", \"geometry\");\r\n\r\n\t\tthis.properties = {\r\n\t\t\tgrid_size: 1\r\n\t\t};\r\n\r\n\t\tthis.geometry = null;\r\n\t\tthis.geometry_id = -1;\r\n\t\tthis.version = -1;\r\n\t\tthis.must_update = true;\r\n\r\n\t\tthis.vertices = null;\r\n\t}\r\n\r\n\tLGraphGeometryDisplace.title = \"displace\";\r\n\tLGraphGeometryDisplace.desc = \"displace points\";\r\n\r\n\tLGraphGeometryDisplace.prototype.onExecute = function() {\r\n\t\tvar geometry = this.getInputData(0);\r\n\t\tvar image = this.getInputData(1);\r\n\t\tif(!geometry)\r\n\t\t\treturn;\r\n\r\n\t\tif(!image)\r\n\t\t{\r\n\t\t\tthis.setOutputData(0,geometry);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif( this.geometry_id != geometry._id || this.version != geometry._version || this.must_update )\r\n\t\t{\r\n\t\t\tthis.must_update = false;\r\n\t\t\tthis.geometry_id = geometry._id;\r\n\t\t\tthis.version = geometry._version;\r\n\r\n\t\t\t//copy\r\n\t\t\tthis.geometry = {};\r\n\t\t\tfor(var i in geometry)\r\n\t\t\t\tthis.geometry[i] = geometry[i];\r\n\t\t\tthis.geometry._id = geometry._id;\r\n\t\t\tthis.geometry._version = geometry._version + 1;\r\n\r\n\t\t\tvar grid_size = this.properties.grid_size;\r\n\t\t\tif(grid_size != 0)\r\n\t\t\t{\r\n\t\t\t\tvar vertices = this.vertices;\r\n\t\t\t\tif(!vertices || this.vertices.length != this.geometry.vertices.length)\r\n\t\t\t\t\tvertices = this.vertices = new Float32Array( this.geometry.vertices );\r\n\t\t\t\tfor(var i = 0; i < vertices.length; i+=3)\r\n\t\t\t\t{\r\n\t\t\t\t\tvertices[i] = Math.round(vertices[i]/grid_size) * grid_size;\r\n\t\t\t\t\tvertices[i+1] = Math.round(vertices[i+1]/grid_size) * grid_size;\r\n\t\t\t\t\tvertices[i+2] = Math.round(vertices[i+2]/grid_size) * grid_size;\r\n\t\t\t\t}\r\n\t\t\t\tthis.geometry.vertices = vertices;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.setOutputData(0,this.geometry);\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/displace\", LGraphGeometryDisplace );\r\n*/\r\n\r\n\tfunction LGraphConnectPoints() {\r\n\t\tthis.addInput(\"in\", \"geometry\");\r\n\t\tthis.addOutput(\"out\", \"geometry\");\r\n\r\n\t\tthis.properties = {\r\n\t\t\tmin_dist: 0.4,\r\n\t\t\tmax_dist: 0.5,\r\n\t\t\tmax_connections: 0,\r\n\t\t\tprobability: 1\r\n\t\t};\r\n\r\n\t\tthis.geometry_id = -1;\r\n\t\tthis.version = -1;\r\n\t\tthis.my_version = 1;\r\n\t\tthis.must_update = true;\r\n\t}\r\n\r\n\tLGraphConnectPoints.title = \"connect points\";\r\n\tLGraphConnectPoints.desc = \"adds indices between near points\";\r\n\r\n\tLGraphConnectPoints.prototype.onPropertyChanged = function(name,value)\r\n\t{\r\n\t\tthis.must_update = true;\r\n\t}\r\n\r\n\tLGraphConnectPoints.prototype.onExecute = function() {\r\n\t\tvar geometry = this.getInputData(0);\r\n\t\tif(!geometry)\r\n\t\t\treturn;\r\n\r\n\t\tif( this.geometry_id != geometry._id || this.version != geometry._version || this.must_update )\r\n\t\t{\r\n\t\t\tthis.must_update = false;\r\n\t\t\tthis.geometry_id = geometry._id;\r\n\t\t\tthis.version = geometry._version;\r\n\r\n\t\t\t//copy\r\n\t\t\tthis.geometry = {};\r\n\t\t\tfor(var i in geometry)\r\n\t\t\t\tthis.geometry[i] = geometry[i];\r\n\t\t\tthis.geometry._id = generateGeometryId();\r\n\t\t\tthis.geometry._version = this.my_version++;\r\n\r\n\t\t\tvar vertices = geometry.vertices;\r\n\t\t\tvar l = vertices.length;\r\n\t\t\tvar min_dist = this.properties.min_dist;\r\n\t\t\tvar max_dist = this.properties.max_dist;\r\n\t\t\tvar probability = this.properties.probability;\r\n\t\t\tvar max_connections = this.properties.max_connections;\r\n\t\t\tvar indices = [];\r\n\t\t\t\r\n\t\t\tfor(var i = 0; i < l; i+=3)\r\n\t\t\t{\r\n\t\t\t\tvar x = vertices[i];\r\n\t\t\t\tvar y = vertices[i+1];\r\n\t\t\t\tvar z = vertices[i+2];\r\n\t\t\t\tvar connections = 0;\r\n\t\t\t\tfor(var j = i+3; j < l; j+=3)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar x2 = vertices[j];\r\n\t\t\t\t\tvar y2 = vertices[j+1];\r\n\t\t\t\t\tvar z2 = vertices[j+2];\r\n\t\t\t\t\tvar dist = Math.sqrt( (x-x2)*(x-x2) + (y-y2)*(y-y2) + (z-z2)*(z-z2));\r\n\t\t\t\t\tif(dist > max_dist || dist < min_dist || (probability < 1 && probability < Math.random()) )\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tindices.push(i/3,j/3);\r\n\t\t\t\t\tconnections += 1;\r\n\t\t\t\t\tif(max_connections && connections > max_connections)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.geometry.indices = this.indices = new Uint32Array(indices);\r\n\t\t}\r\n\r\n\t\tif(this.indices && this.indices.length)\r\n\t\t{\r\n\t\t\tthis.geometry.indices = this.indices;\r\n\t\t\tthis.setOutputData( 0, this.geometry );\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.setOutputData( 0, null );\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/connectPoints\", LGraphConnectPoints );\r\n\r\n    //Works with Litegl.js to create WebGL nodes\r\n    if (typeof GL == \"undefined\") //LiteGL RELATED **********************************************\r\n\t\treturn;\r\n\r\n\tfunction LGraphToGeometry() {\r\n\t\tthis.addInput(\"mesh\", \"mesh\");\r\n\t\tthis.addOutput(\"out\", \"geometry\");\r\n\r\n\t\tthis.geometry = {};\r\n\t\tthis.last_mesh = null;\r\n\t}\r\n\r\n\tLGraphToGeometry.title = \"to geometry\";\r\n\tLGraphToGeometry.desc = \"converts a mesh to geometry\";\r\n\r\n\tLGraphToGeometry.prototype.onExecute = function() {\r\n\t\tvar mesh = this.getInputData(0);\r\n\t\tif(!mesh)\r\n\t\t\treturn;\r\n\r\n\t\tif(mesh != this.last_mesh)\r\n\t\t{\r\n\t\t\tthis.last_mesh = mesh;\r\n\t\t\tfor(i in mesh.vertexBuffers)\r\n\t\t\t{\r\n\t\t\t\tvar buffer = mesh.vertexBuffers[i];\r\n\t\t\t\tthis.geometry[i] = buffer.data\r\n\t\t\t}\r\n\t\t\tif(mesh.indexBuffers[\"triangles\"])\r\n\t\t\t\tthis.geometry.indices = mesh.indexBuffers[\"triangles\"].data;\r\n\r\n\t\t\tthis.geometry._id = generateGeometryId();\r\n\t\t\tthis.geometry._version = 0;\r\n\t\t}\r\n\r\n\t\tthis.setOutputData(0,this.geometry);\r\n\t\tif(this.geometry)\r\n\t\t\tthis.setOutputData(1,this.geometry.vertices);\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/toGeometry\", LGraphToGeometry );\r\n\r\n\tfunction LGraphGeometryToMesh() {\r\n\t\tthis.addInput(\"in\", \"geometry\");\r\n\t\tthis.addOutput(\"mesh\", \"mesh\");\r\n\t\tthis.properties = {};\r\n\t\tthis.version = -1;\r\n\t\tthis.mesh = null;\r\n\t}\r\n\r\n\tLGraphGeometryToMesh.title = \"Geo to Mesh\";\r\n\r\n\tLGraphGeometryToMesh.prototype.updateMesh = function(geometry)\r\n\t{\r\n\t\tif(!this.mesh)\r\n\t\t\tthis.mesh = new GL.Mesh();\r\n\r\n\t\tfor(var i in geometry)\r\n\t\t{\r\n\t\t\tif(i[0] == \"_\")\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tvar buffer_data = geometry[i];\r\n\r\n\t\t\tvar info = GL.Mesh.common_buffers[i];\r\n\t\t\tif(!info && i != \"indices\") //unknown buffer\r\n\t\t\t\tcontinue;\r\n\t\t\tvar spacing = info ? info.spacing : 3;\r\n\t\t\tvar mesh_buffer = this.mesh.vertexBuffers[i];\r\n\r\n\t\t\tif(!mesh_buffer || mesh_buffer.data.length != buffer_data.length)\r\n\t\t\t{\r\n\t\t\t\tmesh_buffer = new GL.Buffer( i == \"indices\" ? GL.ELEMENT_ARRAY_BUFFER : GL.ARRAY_BUFFER, buffer_data, spacing, GL.DYNAMIC_DRAW );\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tmesh_buffer.data.set( buffer_data );\r\n\t\t\t\tmesh_buffer.upload(GL.DYNAMIC_DRAW);\r\n\t\t\t}\r\n\r\n\t\t\tthis.mesh.addBuffer( i, mesh_buffer );\r\n\t\t}\r\n\r\n\t\tif(this.mesh.vertexBuffers.normals &&this.mesh.vertexBuffers.normals.data.length != this.mesh.vertexBuffers.vertices.data.length )\r\n\t\t{\r\n\t\t\tvar n = new Float32Array([0,1,0]);\r\n\t\t\tvar normals = new Float32Array( this.mesh.vertexBuffers.vertices.data.length );\r\n\t\t\tfor(var i = 0; i < normals.length; i+= 3)\r\n\t\t\t\tnormals.set( n, i );\r\n\t\t\tmesh_buffer = new GL.Buffer( GL.ARRAY_BUFFER, normals, 3 );\r\n\t\t\tthis.mesh.addBuffer( \"normals\", mesh_buffer );\r\n\t\t}\r\n\r\n\t\tthis.mesh.updateBoundingBox();\r\n\t\tthis.geometry_id = this.mesh.id = geometry._id;\r\n\t\tthis.version = this.mesh.version = geometry._version;\r\n\t\treturn this.mesh;\r\n\t}\r\n\r\n\tLGraphGeometryToMesh.prototype.onExecute = function() {\r\n\r\n\t\tvar geometry = this.getInputData(0);\r\n\t\tif(!geometry)\r\n\t\t\treturn;\r\n\t\tif( this.version != geometry._version || this.geometry_id != geometry._id )\r\n\t\t\tthis.updateMesh( geometry );\r\n\t\tthis.setOutputData(0, this.mesh);\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/toMesh\", LGraphGeometryToMesh );\r\n\r\n\tfunction LGraphRenderMesh() {\r\n\t\tthis.addInput(\"mesh\", \"mesh\");\r\n\t\tthis.addInput(\"mat4\", \"mat4\");\r\n\t\tthis.addInput(\"tex\", \"texture\");\r\n\r\n\t\tthis.properties = {\r\n\t\t\tenabled: true,\r\n\t\t\tprimitive: GL.TRIANGLES,\r\n\t\t\tadditive: false,\r\n\t\t\tcolor: [1,1,1],\r\n\t\t\topacity: 1\r\n\t\t};\r\n\r\n\t\tthis.color = vec4.create([1,1,1,1]);\r\n\t\tthis.model_matrix = mat4.create();\r\n\t\tthis.uniforms = {\r\n\t\t\tu_color: this.color,\r\n\t\t\tu_model: this.model_matrix\r\n\t\t};\r\n\t}\r\n\r\n\tLGraphRenderMesh.title = \"Render Mesh\";\r\n\tLGraphRenderMesh.desc = \"renders a mesh flat\";\r\n\r\n\tLGraphRenderMesh.PRIMITIVE_VALUES = { \"points\":GL.POINTS, \"lines\":GL.LINES, \"line_loop\":GL.LINE_LOOP,\"line_strip\":GL.LINE_STRIP, \"triangles\":GL.TRIANGLES, \"triangle_fan\":GL.TRIANGLE_FAN, \"triangle_strip\":GL.TRIANGLE_STRIP };\r\n\r\n\tLGraphRenderMesh.widgets_info = {\r\n\t\tprimitive: { widget: \"combo\", values: LGraphRenderMesh.PRIMITIVE_VALUES },\r\n\t\tcolor: { widget: \"color\" }\r\n\t};\r\n\r\n\tLGraphRenderMesh.prototype.onExecute = function() {\r\n\r\n\t\tif(!this.properties.enabled)\r\n\t\t\treturn;\r\n\r\n\t\tvar mesh = this.getInputData(0);\r\n\t\tif(!mesh)\r\n\t\t\treturn;\r\n\r\n\t\tif(!LiteGraph.LGraphRender.onRequestCameraMatrices)\r\n\t\t{\r\n\t\t\tconsole.warn(\"cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tLiteGraph.LGraphRender.onRequestCameraMatrices( view_matrix, projection_matrix,viewprojection_matrix );\r\n\t\tvar shader = null;\r\n\t\tvar texture = this.getInputData(2);\r\n\t\tif(texture)\r\n\t\t{\r\n\t\t\tshader = gl.shaders[\"textured\"];\r\n\t\t\tif(!shader)\r\n\t\t\t\tshader = gl.shaders[\"textured\"] = new GL.Shader( LGraphRenderPoints.vertex_shader_code, LGraphRenderPoints.fragment_shader_code, { USE_TEXTURE:\"\" });\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tshader = gl.shaders[\"flat\"];\r\n\t\t\tif(!shader)\r\n\t\t\t\tshader = gl.shaders[\"flat\"] = new GL.Shader( LGraphRenderPoints.vertex_shader_code, LGraphRenderPoints.fragment_shader_code );\r\n\t\t}\r\n\r\n\t\tthis.color.set( this.properties.color );\r\n\t\tthis.color[3] = this.properties.opacity;\r\n\r\n\t\tvar model_matrix = this.model_matrix;\r\n\t\tvar m = this.getInputData(1);\r\n\t\tif(m)\r\n\t\t\tmodel_matrix.set(m);\r\n\t\telse\r\n\t\t\tmat4.identity( model_matrix );\r\n\r\n\t\tthis.uniforms.u_point_size = 1;\r\n\t\tvar primitive = this.properties.primitive;\r\n\r\n\t\tshader.uniforms( global_uniforms );\r\n\t\tshader.uniforms( this.uniforms );\r\n\r\n\t\tif(this.properties.opacity >= 1)\r\n\t\t\tgl.disable( gl.BLEND );\r\n\t\telse\r\n\t\t\tgl.enable( gl.BLEND );\r\n\t\tgl.enable( gl.DEPTH_TEST );\r\n\t\tif( this.properties.additive )\r\n\t\t{\r\n\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE );\r\n\t\t\tgl.depthMask( false );\r\n\t\t}\r\n\t\telse\r\n\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA );\r\n\r\n\t\tvar indices = \"indices\";\r\n\t\tif( mesh.indexBuffers.triangles )\r\n\t\t\tindices = \"triangles\";\r\n\t\tshader.draw( mesh, primitive, indices );\r\n\t\tgl.disable( gl.BLEND );\r\n\t\tgl.depthMask( true );\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/render_mesh\", LGraphRenderMesh );\r\n\r\n\t//**************************\r\n\r\n\r\n\tfunction LGraphGeometryPrimitive() {\r\n\t\tthis.addInput(\"size\", \"number\");\r\n\t\tthis.addOutput(\"out\", \"mesh\");\r\n\t\tthis.properties = { type: 1, size: 1, subdivisions: 32 };\r\n\r\n\t\tthis.version = (Math.random() * 100000)|0;\r\n\t\tthis.last_info = { type: -1, size: -1, subdivisions: -1 };\r\n\t}\r\n\r\n\tLGraphGeometryPrimitive.title = \"Primitive\";\r\n\r\n\tLGraphGeometryPrimitive.VALID = { \"CUBE\":1, \"PLANE\":2, \"CYLINDER\":3, \"SPHERE\":4, \"CIRCLE\":5, \"HEMISPHERE\":6, \"ICOSAHEDRON\":7, \"CONE\":8, \"QUAD\":9 };\r\n\tLGraphGeometryPrimitive.widgets_info = {\r\n\t\ttype: { widget: \"combo\", values: LGraphGeometryPrimitive.VALID }\r\n\t};\r\n\r\n\tLGraphGeometryPrimitive.prototype.onExecute = function() {\r\n\r\n\t\tif( !this.isOutputConnected(0) )\r\n\t\t\treturn;\r\n\r\n\t\tvar size = this.getInputOrProperty(\"size\");\r\n\r\n\t\t//update\r\n\t\tif( this.last_info.type != this.properties.type || this.last_info.size != size || this.last_info.subdivisions != this.properties.subdivisions )\r\n\t\t\tthis.updateMesh( this.properties.type, size, this.properties.subdivisions );\r\n\r\n\t\tthis.setOutputData(0,this._mesh);\r\n\t}\r\n\r\n\tLGraphGeometryPrimitive.prototype.updateMesh = function(type, size, subdivisions)\r\n\t{\r\n\t\tsubdivisions = Math.max(0,subdivisions)|0;\r\n\r\n\t\tswitch (type)\r\n\t\t{\r\n\t\t\tcase 1: //CUBE: \r\n\t\t\t\tthis._mesh = GL.Mesh.cube({size: size, normals:true,coords:true});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2: //PLANE:\r\n\t\t\t\tthis._mesh = GL.Mesh.plane({size: size, xz: true, detail: subdivisions, normals:true,coords:true});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3: //CYLINDER:\r\n\t\t\t\tthis._mesh = GL.Mesh.cylinder({size: size, subdivisions: subdivisions, normals:true,coords:true});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4: //SPHERE:\r\n\t\t\t\tthis._mesh = GL.Mesh.sphere({size: size, \"long\": subdivisions, lat: subdivisions, normals:true,coords:true});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5: //CIRCLE:\r\n\t\t\t\tthis._mesh = GL.Mesh.circle({size: size, slices: subdivisions, normals:true, coords:true});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6: //HEMISPHERE:\r\n\t\t\t\tthis._mesh = GL.Mesh.sphere({size: size, \"long\": subdivisions, lat: subdivisions, normals:true, coords:true, hemi: true});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 7: //ICOSAHEDRON:\r\n\t\t\t\tthis._mesh = GL.Mesh.icosahedron({size: size, subdivisions:subdivisions });\r\n\t\t\t\tbreak;\r\n\t\t\tcase 8: //CONE:\r\n\t\t\t\tthis._mesh = GL.Mesh.cone({radius: size, height: size, subdivisions:subdivisions });\r\n\t\t\t\tbreak;\r\n\t\t\tcase 9: //QUAD:\r\n\t\t\t\tthis._mesh = GL.Mesh.plane({size: size, xz: false, detail: subdivisions, normals:true, coords:true });\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis.last_info.type = type;\r\n\t\tthis.last_info.size = size;\r\n\t\tthis.last_info.subdivisions = subdivisions;\r\n\t\tthis._mesh.version = this.version++;\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/mesh_primitive\", LGraphGeometryPrimitive );\r\n\r\n\r\n\tfunction LGraphRenderPoints() {\r\n\t\tthis.addInput(\"in\", \"geometry\");\r\n\t\tthis.addInput(\"mat4\", \"mat4\");\r\n\t\tthis.addInput(\"tex\", \"texture\");\r\n\t\tthis.properties = {\r\n\t\t\tenabled: true,\r\n\t\t\tpoint_size: 0.1,\r\n\t\t\tfixed_size: false,\r\n\t\t\tadditive: true,\r\n\t\t\tcolor: [1,1,1],\r\n\t\t\topacity: 1\r\n\t\t};\r\n\r\n\t\tthis.color = vec4.create([1,1,1,1]);\r\n\r\n\t\tthis.uniforms = {\r\n\t\t\tu_point_size: 1,\r\n\t\t\tu_perspective: 1,\r\n\t\t\tu_point_perspective: 1,\r\n\t\t\tu_color: this.color\r\n\t\t};\r\n\r\n\t\tthis.geometry_id = -1;\r\n\t\tthis.version = -1;\r\n\t\tthis.mesh = null;\r\n\t}\r\n\r\n\tLGraphRenderPoints.title = \"renderPoints\";\r\n\tLGraphRenderPoints.desc = \"render points with a texture\";\r\n\r\n\tLGraphRenderPoints.widgets_info = {\r\n\t\tcolor: { widget: \"color\" }\r\n\t};\r\n\r\n\tLGraphRenderPoints.prototype.updateMesh = function(geometry)\r\n\t{\r\n\t\tvar buffer = this.buffer;\r\n\t\tif(!this.buffer || !this.buffer.data || this.buffer.data.length != geometry.vertices.length)\r\n\t\t\tthis.buffer = new GL.Buffer( GL.ARRAY_BUFFER, geometry.vertices,3,GL.DYNAMIC_DRAW);\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.buffer.data.set( geometry.vertices );\r\n\t\t\tthis.buffer.upload(GL.DYNAMIC_DRAW);\r\n\t\t}\r\n\r\n\t\tif(!this.mesh)\r\n\t\t\tthis.mesh = new GL.Mesh();\r\n\r\n\t\tthis.mesh.addBuffer(\"vertices\",this.buffer);\r\n\t\tthis.geometry_id = this.mesh.id = geometry._id;\r\n\t\tthis.version = this.mesh.version = geometry._version;\r\n\t}\r\n\r\n\tLGraphRenderPoints.prototype.onExecute = function() {\r\n\r\n\t\tif(!this.properties.enabled)\r\n\t\t\treturn;\r\n\r\n\t\tvar geometry = this.getInputData(0);\r\n\t\tif(!geometry)\r\n\t\t\treturn;\r\n\t\tif(this.version != geometry._version || this.geometry_id != geometry._id )\r\n\t\t\tthis.updateMesh( geometry );\r\n\r\n\t\tif(!LiteGraph.LGraphRender.onRequestCameraMatrices)\r\n\t\t{\r\n\t\t\tconsole.warn(\"cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tLiteGraph.LGraphRender.onRequestCameraMatrices( view_matrix, projection_matrix,viewprojection_matrix );\r\n\t\tvar shader = null;\r\n\r\n\t\tvar texture = this.getInputData(2);\r\n\t\t\r\n\t\tif(texture)\r\n\t\t{\r\n\t\t\tshader = gl.shaders[\"textured_points\"];\r\n\t\t\tif(!shader)\r\n\t\t\t\tshader = gl.shaders[\"textured_points\"] = new GL.Shader( LGraphRenderPoints.vertex_shader_code, LGraphRenderPoints.fragment_shader_code, { USE_TEXTURED_POINTS:\"\" });\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tshader = gl.shaders[\"points\"];\r\n\t\t\tif(!shader)\r\n\t\t\t\tshader = gl.shaders[\"points\"] = new GL.Shader( LGraphRenderPoints.vertex_shader_code, LGraphRenderPoints.fragment_shader_code, { USE_POINTS: \"\" });\r\n\t\t}\r\n\r\n\t\tthis.color.set( this.properties.color );\r\n\t\tthis.color[3] = this.properties.opacity;\r\n\r\n\t\tvar m = this.getInputData(1);\r\n\t\tif(m)\r\n\t\t\tmodel_matrix.set(m);\r\n\t\telse\r\n\t\t\tmat4.identity( model_matrix );\r\n\r\n\t\tthis.uniforms.u_point_size = this.properties.point_size;\r\n\t\tthis.uniforms.u_point_perspective = this.properties.fixed_size ? 0 : 1;\r\n\t\tthis.uniforms.u_perspective = gl.viewport_data[3] * projection_matrix[5];\r\n\r\n\t\tshader.uniforms( global_uniforms );\r\n\t\tshader.uniforms( this.uniforms );\r\n\r\n\t\tif(this.properties.opacity >= 1)\r\n\t\t\tgl.disable( gl.BLEND );\r\n\t\telse\r\n\t\t\tgl.enable( gl.BLEND );\r\n\r\n\t\tgl.enable( gl.DEPTH_TEST );\r\n\t\tif( this.properties.additive )\r\n\t\t{\r\n\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE );\r\n\t\t\tgl.depthMask( false );\r\n\t\t}\r\n\t\telse\r\n\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA );\r\n\r\n\t\tshader.draw( this.mesh, GL.POINTS );\r\n\r\n\t\tgl.disable( gl.BLEND );\r\n\t\tgl.depthMask( true );\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/render_points\", LGraphRenderPoints );\r\n\r\n\tLGraphRenderPoints.vertex_shader_code = '\\\r\n\t\tprecision mediump float;\\n\\\r\n\t\tattribute vec3 a_vertex;\\n\\\r\n\t\tvarying vec3 v_vertex;\\n\\\r\n\t\tattribute vec3 a_normal;\\n\\\r\n\t\tvarying vec3 v_normal;\\n\\\r\n\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\tattribute vec4 a_color;\\n\\\r\n\t\t\tvarying vec4 v_color;\\n\\\r\n\t\t#endif\\n\\\r\n\t\tattribute vec2 a_coord;\\n\\\r\n\t\tvarying vec2 v_coord;\\n\\\r\n\t\t#ifdef USE_SIZE\\n\\\r\n\t\t\tattribute float a_extra;\\n\\\r\n\t\t#endif\\n\\\r\n\t\t#ifdef USE_INSTANCING\\n\\\r\n\t\t\tattribute mat4 u_model;\\n\\\r\n\t\t#else\\n\\\r\n\t\t\tuniform mat4 u_model;\\n\\\r\n\t\t#endif\\n\\\r\n\t\tuniform mat4 u_viewprojection;\\n\\\r\n\t\tuniform float u_point_size;\\n\\\r\n\t\tuniform float u_perspective;\\n\\\r\n\t\tuniform float u_point_perspective;\\n\\\r\n\t\tfloat computePointSize(float radius, float w)\\n\\\r\n\t\t{\\n\\\r\n\t\t\tif(radius < 0.0)\\n\\\r\n\t\t\t\treturn -radius;\\n\\\r\n\t\t\treturn u_perspective * radius / w;\\n\\\r\n\t\t}\\n\\\r\n\t\tvoid main() {\\n\\\r\n\t\t\tv_coord = a_coord;\\n\\\r\n\t\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\t\tv_color = a_color;\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\tv_vertex = ( u_model * vec4( a_vertex, 1.0 )).xyz;\\n\\\r\n\t\t\tv_normal = ( u_model * vec4( a_normal, 0.0 )).xyz;\\n\\\r\n\t\t\tgl_Position = u_viewprojection * vec4(v_vertex,1.0);\\n\\\r\n\t\t\tgl_PointSize = u_point_size;\\n\\\r\n\t\t\t#ifdef USE_SIZE\\n\\\r\n\t\t\t\tgl_PointSize = a_extra;\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\tif(u_point_perspective != 0.0)\\n\\\r\n\t\t\t\tgl_PointSize = computePointSize( gl_PointSize, gl_Position.w );\\n\\\r\n\t\t}\\\r\n\t';\r\n\r\n\tLGraphRenderPoints.fragment_shader_code = '\\\r\n\t\tprecision mediump float;\\n\\\r\n\t\tuniform vec4 u_color;\\n\\\r\n\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\tvarying vec4 v_color;\\n\\\r\n\t\t#endif\\n\\\r\n\t\tvarying vec2 v_coord;\\n\\\r\n\t\tuniform sampler2D u_texture;\\n\\\r\n\t\tvoid main() {\\n\\\r\n\t\t\tvec4 color = u_color;\\n\\\r\n\t\t\t#ifdef USE_TEXTURED_POINTS\\n\\\r\n\t\t\t\tcolor *= texture2D(u_texture, gl_PointCoord.xy);\\n\\\r\n\t\t\t#else\\n\\\r\n\t\t\t\t#ifdef USE_TEXTURE\\n\\\r\n\t\t\t\t  color *= texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\t  if(color.a < 0.1)\\n\\\r\n\t\t\t\t\tdiscard;\\n\\\r\n\t\t\t\t#endif\\n\\\r\n\t\t\t\t#ifdef USE_POINTS\\n\\\r\n\t\t\t\t\tfloat dist = length( gl_PointCoord.xy - vec2(0.5) );\\n\\\r\n\t\t\t\t\tif( dist > 0.45 )\\n\\\r\n\t\t\t\t\t\tdiscard;\\n\\\r\n\t\t\t\t#endif\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\t\tcolor *= v_color;\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\tgl_FragColor = color;\\n\\\r\n\t\t}\\\r\n\t';\r\n\r\n\t//based on https://inconvergent.net/2019/depth-of-field/\r\n\t/*\r\n\tfunction LGraphRenderGeometryDOF() {\r\n\t\tthis.addInput(\"in\", \"geometry\");\r\n\t\tthis.addInput(\"mat4\", \"mat4\");\r\n\t\tthis.addInput(\"tex\", \"texture\");\r\n\t\tthis.properties = {\r\n\t\t\tenabled: true,\r\n\t\t\tlines: true,\r\n\t\t\tpoint_size: 0.1,\r\n\t\t\tfixed_size: false,\r\n\t\t\tadditive: true,\r\n\t\t\tcolor: [1,1,1],\r\n\t\t\topacity: 1\r\n\t\t};\r\n\r\n\t\tthis.color = vec4.create([1,1,1,1]);\r\n\r\n\t\tthis.uniforms = {\r\n\t\t\tu_point_size: 1,\r\n\t\t\tu_perspective: 1,\r\n\t\t\tu_point_perspective: 1,\r\n\t\t\tu_color: this.color\r\n\t\t};\r\n\r\n\t\tthis.geometry_id = -1;\r\n\t\tthis.version = -1;\r\n\t\tthis.mesh = null;\r\n\t}\r\n\r\n\tLGraphRenderGeometryDOF.widgets_info = {\r\n\t\tcolor: { widget: \"color\" }\r\n\t};\r\n\r\n\tLGraphRenderGeometryDOF.prototype.updateMesh = function(geometry)\r\n\t{\r\n\t\tvar buffer = this.buffer;\r\n\t\tif(!this.buffer || this.buffer.data.length != geometry.vertices.length)\r\n\t\t\tthis.buffer = new GL.Buffer( GL.ARRAY_BUFFER, geometry.vertices,3,GL.DYNAMIC_DRAW);\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.buffer.data.set( geometry.vertices );\r\n\t\t\tthis.buffer.upload(GL.DYNAMIC_DRAW);\r\n\t\t}\r\n\r\n\t\tif(!this.mesh)\r\n\t\t\tthis.mesh = new GL.Mesh();\r\n\r\n\t\tthis.mesh.addBuffer(\"vertices\",this.buffer);\r\n\t\tthis.geometry_id = this.mesh.id = geometry._id;\r\n\t\tthis.version = this.mesh.version = geometry._version;\r\n\t}\r\n\r\n\tLGraphRenderGeometryDOF.prototype.onExecute = function() {\r\n\r\n\t\tif(!this.properties.enabled)\r\n\t\t\treturn;\r\n\r\n\t\tvar geometry = this.getInputData(0);\r\n\t\tif(!geometry)\r\n\t\t\treturn;\r\n\t\tif(this.version != geometry._version || this.geometry_id != geometry._id )\r\n\t\t\tthis.updateMesh( geometry );\r\n\r\n\t\tif(!LiteGraph.LGraphRender.onRequestCameraMatrices)\r\n\t\t{\r\n\t\t\tconsole.warn(\"cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tLiteGraph.LGraphRender.onRequestCameraMatrices( view_matrix, projection_matrix,viewprojection_matrix );\r\n\t\tvar shader = null;\r\n\r\n\t\tvar texture = this.getInputData(2);\r\n\t\t\r\n\t\tif(texture)\r\n\t\t{\r\n\t\t\tshader = gl.shaders[\"textured_points\"];\r\n\t\t\tif(!shader)\r\n\t\t\t\tshader = gl.shaders[\"textured_points\"] = new GL.Shader( LGraphRenderGeometryDOF.vertex_shader_code, LGraphRenderGeometryDOF.fragment_shader_code, { USE_TEXTURED_POINTS:\"\" });\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tshader = gl.shaders[\"points\"];\r\n\t\t\tif(!shader)\r\n\t\t\t\tshader = gl.shaders[\"points\"] = new GL.Shader( LGraphRenderGeometryDOF.vertex_shader_code, LGraphRenderGeometryDOF.fragment_shader_code, { USE_POINTS: \"\" });\r\n\t\t}\r\n\r\n\t\tthis.color.set( this.properties.color );\r\n\t\tthis.color[3] = this.properties.opacity;\r\n\r\n\t\tvar m = this.getInputData(1);\r\n\t\tif(m)\r\n\t\t\tmodel_matrix.set(m);\r\n\t\telse\r\n\t\t\tmat4.identity( model_matrix );\r\n\r\n\t\tthis.uniforms.u_point_size = this.properties.point_size;\r\n\t\tthis.uniforms.u_point_perspective = this.properties.fixed_size ? 0 : 1;\r\n\t\tthis.uniforms.u_perspective = gl.viewport_data[3] * projection_matrix[5];\r\n\r\n\t\tshader.uniforms( global_uniforms );\r\n\t\tshader.uniforms( this.uniforms );\r\n\r\n\t\tif(this.properties.opacity >= 1)\r\n\t\t\tgl.disable( gl.BLEND );\r\n\t\telse\r\n\t\t\tgl.enable( gl.BLEND );\r\n\r\n\t\tgl.enable( gl.DEPTH_TEST );\r\n\t\tif( this.properties.additive )\r\n\t\t{\r\n\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE );\r\n\t\t\tgl.depthMask( false );\r\n\t\t}\r\n\t\telse\r\n\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA );\r\n\r\n\t\tshader.draw( this.mesh, GL.POINTS );\r\n\r\n\t\tgl.disable( gl.BLEND );\r\n\t\tgl.depthMask( true );\r\n\t}\r\n\r\n\tLiteGraph.registerNodeType( \"geometry/render_dof\", LGraphRenderGeometryDOF );\r\n\r\n\tLGraphRenderGeometryDOF.vertex_shader_code = '\\\r\n\t\tprecision mediump float;\\n\\\r\n\t\tattribute vec3 a_vertex;\\n\\\r\n\t\tvarying vec3 v_vertex;\\n\\\r\n\t\tattribute vec3 a_normal;\\n\\\r\n\t\tvarying vec3 v_normal;\\n\\\r\n\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\tattribute vec4 a_color;\\n\\\r\n\t\t\tvarying vec4 v_color;\\n\\\r\n\t\t#endif\\n\\\r\n\t\tattribute vec2 a_coord;\\n\\\r\n\t\tvarying vec2 v_coord;\\n\\\r\n\t\t#ifdef USE_SIZE\\n\\\r\n\t\t\tattribute float a_extra;\\n\\\r\n\t\t#endif\\n\\\r\n\t\t#ifdef USE_INSTANCING\\n\\\r\n\t\t\tattribute mat4 u_model;\\n\\\r\n\t\t#else\\n\\\r\n\t\t\tuniform mat4 u_model;\\n\\\r\n\t\t#endif\\n\\\r\n\t\tuniform mat4 u_viewprojection;\\n\\\r\n\t\tuniform float u_point_size;\\n\\\r\n\t\tuniform float u_perspective;\\n\\\r\n\t\tuniform float u_point_perspective;\\n\\\r\n\t\tfloat computePointSize(float radius, float w)\\n\\\r\n\t\t{\\n\\\r\n\t\t\tif(radius < 0.0)\\n\\\r\n\t\t\t\treturn -radius;\\n\\\r\n\t\t\treturn u_perspective * radius / w;\\n\\\r\n\t\t}\\n\\\r\n\t\tvoid main() {\\n\\\r\n\t\t\tv_coord = a_coord;\\n\\\r\n\t\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\t\tv_color = a_color;\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\tv_vertex = ( u_model * vec4( a_vertex, 1.0 )).xyz;\\n\\\r\n\t\t\tv_normal = ( u_model * vec4( a_normal, 0.0 )).xyz;\\n\\\r\n\t\t\tgl_Position = u_viewprojection * vec4(v_vertex,1.0);\\n\\\r\n\t\t\tgl_PointSize = u_point_size;\\n\\\r\n\t\t\t#ifdef USE_SIZE\\n\\\r\n\t\t\t\tgl_PointSize = a_extra;\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\tif(u_point_perspective != 0.0)\\n\\\r\n\t\t\t\tgl_PointSize = computePointSize( gl_PointSize, gl_Position.w );\\n\\\r\n\t\t}\\\r\n\t';\r\n\r\n\tLGraphRenderGeometryDOF.fragment_shader_code = '\\\r\n\t\tprecision mediump float;\\n\\\r\n\t\tuniform vec4 u_color;\\n\\\r\n\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\tvarying vec4 v_color;\\n\\\r\n\t\t#endif\\n\\\r\n\t\tvarying vec2 v_coord;\\n\\\r\n\t\tuniform sampler2D u_texture;\\n\\\r\n\t\tvoid main() {\\n\\\r\n\t\t\tvec4 color = u_color;\\n\\\r\n\t\t\t#ifdef USE_TEXTURED_POINTS\\n\\\r\n\t\t\t\tcolor *= texture2D(u_texture, gl_PointCoord.xy);\\n\\\r\n\t\t\t#else\\n\\\r\n\t\t\t\t#ifdef USE_TEXTURE\\n\\\r\n\t\t\t\t  color *= texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\t  if(color.a < 0.1)\\n\\\r\n\t\t\t\t\tdiscard;\\n\\\r\n\t\t\t\t#endif\\n\\\r\n\t\t\t\t#ifdef USE_POINTS\\n\\\r\n\t\t\t\t\tfloat dist = length( gl_PointCoord.xy - vec2(0.5) );\\n\\\r\n\t\t\t\t\tif( dist > 0.45 )\\n\\\r\n\t\t\t\t\t\tdiscard;\\n\\\r\n\t\t\t\t#endif\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\t#ifdef USE_COLOR\\n\\\r\n\t\t\t\tcolor *= v_color;\\n\\\r\n\t\t\t#endif\\n\\\r\n\t\t\tgl_FragColor = color;\\n\\\r\n\t\t}\\\r\n\t';\r\n\t*/\r\n\r\n\r\n\r\n})(this);\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n    var LGraphTexture = global.LGraphTexture;\r\n\r\n    //Works with Litegl.js to create WebGL nodes\r\n    if (typeof GL != \"undefined\") {\r\n        // Texture Lens *****************************************\r\n        function LGraphFXLens() {\r\n            this.addInput(\"Texture\", \"Texture\");\r\n            this.addInput(\"Aberration\", \"number\");\r\n            this.addInput(\"Distortion\", \"number\");\r\n            this.addInput(\"Blur\", \"number\");\r\n            this.addOutput(\"Texture\", \"Texture\");\r\n            this.properties = {\r\n                aberration: 1.0,\r\n                distortion: 1.0,\r\n                blur: 1.0,\r\n                precision: LGraphTexture.DEFAULT\r\n            };\r\n\r\n            if (!LGraphFXLens._shader) {\r\n                LGraphFXLens._shader = new GL.Shader(\r\n                    GL.Shader.SCREEN_VERTEX_SHADER,\r\n                    LGraphFXLens.pixel_shader\r\n                );\r\n                LGraphFXLens._texture = new GL.Texture(3, 1, {\r\n                    format: gl.RGB,\r\n                    wrap: gl.CLAMP_TO_EDGE,\r\n                    magFilter: gl.LINEAR,\r\n                    minFilter: gl.LINEAR,\r\n                    pixel_data: [255, 0, 0, 0, 255, 0, 0, 0, 255]\r\n                });\r\n            }\r\n        }\r\n\r\n        LGraphFXLens.title = \"Lens\";\r\n        LGraphFXLens.desc = \"Camera Lens distortion\";\r\n        LGraphFXLens.widgets_info = {\r\n            precision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\r\n        };\r\n\r\n        LGraphFXLens.prototype.onExecute = function() {\r\n            var tex = this.getInputData(0);\r\n            if (this.properties.precision === LGraphTexture.PASS_THROUGH) {\r\n                this.setOutputData(0, tex);\r\n                return;\r\n            }\r\n\r\n            if (!tex) {\r\n                return;\r\n            }\r\n\r\n            this._tex = LGraphTexture.getTargetTexture(\r\n                tex,\r\n                this._tex,\r\n                this.properties.precision\r\n            );\r\n\r\n            var aberration = this.properties.aberration;\r\n            if (this.isInputConnected(1)) {\r\n                aberration = this.getInputData(1);\r\n                this.properties.aberration = aberration;\r\n            }\r\n\r\n            var distortion = this.properties.distortion;\r\n            if (this.isInputConnected(2)) {\r\n                distortion = this.getInputData(2);\r\n                this.properties.distortion = distortion;\r\n            }\r\n\r\n            var blur = this.properties.blur;\r\n            if (this.isInputConnected(3)) {\r\n                blur = this.getInputData(3);\r\n                this.properties.blur = blur;\r\n            }\r\n\r\n            gl.disable(gl.BLEND);\r\n            gl.disable(gl.DEPTH_TEST);\r\n            var mesh = Mesh.getScreenQuad();\r\n            var shader = LGraphFXLens._shader;\r\n            //var camera = LS.Renderer._current_camera;\r\n\r\n            this._tex.drawTo(function() {\r\n                tex.bind(0);\r\n                shader\r\n                    .uniforms({\r\n                        u_texture: 0,\r\n                        u_aberration: aberration,\r\n                        u_distortion: distortion,\r\n                        u_blur: blur\r\n                    })\r\n                    .draw(mesh);\r\n            });\r\n\r\n            this.setOutputData(0, this._tex);\r\n        };\r\n\r\n        LGraphFXLens.pixel_shader =\r\n            \"precision highp float;\\n\\\r\n\t\t\tprecision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform vec2 u_camera_planes;\\n\\\r\n\t\t\tuniform float u_aberration;\\n\\\r\n\t\t\tuniform float u_distortion;\\n\\\r\n\t\t\tuniform float u_blur;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec2 coord = v_coord;\\n\\\r\n\t\t\t\tfloat dist = distance(vec2(0.5), coord);\\n\\\r\n\t\t\t\tvec2 dist_coord = coord - vec2(0.5);\\n\\\r\n\t\t\t\tfloat percent = 1.0 + ((0.5 - dist) / 0.5) * u_distortion;\\n\\\r\n\t\t\t\tdist_coord *= percent;\\n\\\r\n\t\t\t\tcoord = dist_coord + vec2(0.5);\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture,coord, u_blur * dist);\\n\\\r\n\t\t\t\tcolor.r = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0+0.01*u_aberration), u_blur * dist ).r;\\n\\\r\n\t\t\t\tcolor.b = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0-0.01*u_aberration), u_blur * dist ).b;\\n\\\r\n\t\t\t\tgl_FragColor = color;\\n\\\r\n\t\t\t}\\n\\\r\n\t\t\t\";\r\n        /*\r\n\t\t\tfloat normalized_tunable_sigmoid(float xs, float k)\\n\\\r\n\t\t\t{\\n\\\r\n\t\t\t\txs = xs * 2.0 - 1.0;\\n\\\r\n\t\t\t\tfloat signx = sign(xs);\\n\\\r\n\t\t\t\tfloat absx = abs(xs);\\n\\\r\n\t\t\t\treturn signx * ((-k - 1.0)*absx)/(2.0*(-2.0*k*absx+k-1.0)) + 0.5;\\n\\\r\n\t\t\t}\\n\\\r\n\t\t*/\r\n\r\n        LiteGraph.registerNodeType(\"fx/lens\", LGraphFXLens);\r\n        global.LGraphFXLens = LGraphFXLens;\r\n\r\n        /* not working yet\r\n\tfunction LGraphDepthOfField()\r\n\t{\r\n\t\tthis.addInput(\"Color\",\"Texture\");\r\n\t\tthis.addInput(\"Linear Depth\",\"Texture\");\r\n\t\tthis.addInput(\"Camera\",\"camera\");\r\n\t\tthis.addOutput(\"Texture\",\"Texture\");\r\n\t\tthis.properties = { high_precision: false };\r\n\t}\r\n\r\n\tLGraphDepthOfField.title = \"Depth Of Field\";\r\n\tLGraphDepthOfField.desc = \"Applies a depth of field effect\";\r\n\r\n\tLGraphDepthOfField.prototype.onExecute = function()\r\n\t{\r\n\t\tvar tex = this.getInputData(0);\r\n\t\tvar depth = this.getInputData(1);\r\n\t\tvar camera = this.getInputData(2);\r\n\r\n\t\tif(!tex || !depth || !camera) \r\n\t\t{\r\n\t\t\tthis.setOutputData(0, tex);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar precision = gl.UNSIGNED_BYTE;\r\n\t\tif(this.properties.high_precision)\r\n\t\t\tprecision = gl.half_float_ext ? gl.HALF_FLOAT_OES : gl.FLOAT;\t\t\t\r\n\t\tif(!this._temp_texture || this._temp_texture.type != precision ||\r\n\t\t\tthis._temp_texture.width != tex.width || this._temp_texture.height != tex.height)\r\n\t\t\tthis._temp_texture = new GL.Texture( tex.width, tex.height, { type: precision, format: gl.RGBA, filter: gl.LINEAR });\r\n\r\n\t\tvar shader = LGraphDepthOfField._shader = new GL.Shader( GL.Shader.SCREEN_VERTEX_SHADER, LGraphDepthOfField._pixel_shader );\r\n\r\n\t\tvar screen_mesh = Mesh.getScreenQuad();\r\n\r\n\t\tgl.disable( gl.DEPTH_TEST );\r\n\t\tgl.disable( gl.BLEND );\r\n\r\n\t\tvar camera_position = camera.getEye();\r\n\t\tvar focus_point = camera.getCenter();\r\n\t\tvar distance = vec3.distance( camera_position, focus_point );\r\n\t\tvar far = camera.far;\r\n\t\tvar focus_range = distance * 0.5;\r\n\r\n\t\tthis._temp_texture.drawTo( function() {\r\n\t\t\ttex.bind(0);\r\n\t\t\tdepth.bind(1);\r\n\t\t\tshader.uniforms({u_texture:0, u_depth_texture:1, u_resolution: [1/tex.width, 1/tex.height], u_far: far, u_focus_point: distance, u_focus_scale: focus_range }).draw(screen_mesh);\r\n\t\t});\r\n\r\n\t\tthis.setOutputData(0, this._temp_texture);\r\n\t}\r\n\r\n\t//from http://tuxedolabs.blogspot.com.es/2018/05/bokeh-depth-of-field-in-single-pass.html\r\n\tLGraphDepthOfField._pixel_shader = \"\\n\\\r\n\t\tprecision highp float;\\n\\\r\n\t\tvarying vec2 v_coord;\\n\\\r\n\t\tuniform sampler2D u_texture; //Image to be processed\\n\\\r\n\t\tuniform sampler2D u_depth_texture; //Linear depth, where 1.0 == far plane\\n\\\r\n\t\tuniform vec2 u_iresolution; //The size of a pixel: vec2(1.0/width, 1.0/height)\\n\\\r\n\t\tuniform float u_far; // Far plane\\n\\\r\n\t\tuniform float u_focus_point;\\n\\\r\n\t\tuniform float u_focus_scale;\\n\\\r\n\t\t\\n\\\r\n\t\tconst float GOLDEN_ANGLE = 2.39996323;\\n\\\r\n\t\tconst float MAX_BLUR_SIZE = 20.0;\\n\\\r\n\t\tconst float RAD_SCALE = 0.5; // Smaller = nicer blur, larger = faster\\n\\\r\n\t\t\\n\\\r\n\t\tfloat getBlurSize(float depth, float focusPoint, float focusScale)\\n\\\r\n\t\t{\\n\\\r\n\t\t float coc = clamp((1.0 / focusPoint - 1.0 / depth)*focusScale, -1.0, 1.0);\\n\\\r\n\t\t return abs(coc) * MAX_BLUR_SIZE;\\n\\\r\n\t\t}\\n\\\r\n\t\t\\n\\\r\n\t\tvec3 depthOfField(vec2 texCoord, float focusPoint, float focusScale)\\n\\\r\n\t\t{\\n\\\r\n\t\t float centerDepth = texture2D(u_depth_texture, texCoord).r * u_far;\\n\\\r\n\t\t float centerSize = getBlurSize(centerDepth, focusPoint, focusScale);\\n\\\r\n\t\t vec3 color = texture2D(u_texture, v_coord).rgb;\\n\\\r\n\t\t float tot = 1.0;\\n\\\r\n\t\t\\n\\\r\n\t\t float radius = RAD_SCALE;\\n\\\r\n\t\t for (float ang = 0.0; ang < 100.0; ang += GOLDEN_ANGLE)\\n\\\r\n\t\t {\\n\\\r\n\t\t  vec2 tc = texCoord + vec2(cos(ang), sin(ang)) * u_iresolution * radius;\\n\\\r\n\t\t\t\\n\\\r\n\t\t  vec3 sampleColor = texture2D(u_texture, tc).rgb;\\n\\\r\n\t\t  float sampleDepth = texture2D(u_depth_texture, tc).r * u_far;\\n\\\r\n\t\t  float sampleSize = getBlurSize( sampleDepth, focusPoint, focusScale );\\n\\\r\n\t\t  if (sampleDepth > centerDepth)\\n\\\r\n\t\t   sampleSize = clamp(sampleSize, 0.0, centerSize*2.0);\\n\\\r\n\t\t\t\\n\\\r\n\t\t  float m = smoothstep(radius-0.5, radius+0.5, sampleSize);\\n\\\r\n\t\t  color += mix(color/tot, sampleColor, m);\\n\\\r\n\t\t  tot += 1.0;\\n\\\r\n\t\t  radius += RAD_SCALE/radius;\\n\\\r\n\t\t  if(radius>=MAX_BLUR_SIZE)\\n\\\r\n\t\t\t return color / tot;\\n\\\r\n\t\t }\\n\\\r\n\t\t return color / tot;\\n\\\r\n\t\t}\\n\\\r\n\t\tvoid main()\\n\\\r\n\t\t{\\n\\\r\n\t\t\tgl_FragColor = vec4( depthOfField( v_coord, u_focus_point, u_focus_scale ), 1.0 );\\n\\\r\n\t\t\t//gl_FragColor = vec4( texture2D(u_depth_texture, v_coord).r );\\n\\\r\n\t\t}\\n\\\r\n\t\t\";\r\n\r\n\tLiteGraph.registerNodeType(\"fx/DOF\", LGraphDepthOfField );\r\n\tglobal.LGraphDepthOfField = LGraphDepthOfField;\r\n\t*/\r\n\r\n        //*******************************************************\r\n\r\n        function LGraphFXBokeh() {\r\n            this.addInput(\"Texture\", \"Texture\");\r\n            this.addInput(\"Blurred\", \"Texture\");\r\n            this.addInput(\"Mask\", \"Texture\");\r\n            this.addInput(\"Threshold\", \"number\");\r\n            this.addOutput(\"Texture\", \"Texture\");\r\n            this.properties = {\r\n                shape: \"\",\r\n                size: 10,\r\n                alpha: 1.0,\r\n                threshold: 1.0,\r\n                high_precision: false\r\n            };\r\n        }\r\n\r\n        LGraphFXBokeh.title = \"Bokeh\";\r\n        LGraphFXBokeh.desc = \"applies an Bokeh effect\";\r\n\r\n        LGraphFXBokeh.widgets_info = { shape: { widget: \"texture\" } };\r\n\r\n        LGraphFXBokeh.prototype.onExecute = function() {\r\n            var tex = this.getInputData(0);\r\n            var blurred_tex = this.getInputData(1);\r\n            var mask_tex = this.getInputData(2);\r\n            if (!tex || !mask_tex || !this.properties.shape) {\r\n                this.setOutputData(0, tex);\r\n                return;\r\n            }\r\n\r\n            if (!blurred_tex) {\r\n                blurred_tex = tex;\r\n            }\r\n\r\n            var shape_tex = LGraphTexture.getTexture(this.properties.shape);\r\n            if (!shape_tex) {\r\n                return;\r\n            }\r\n\r\n            var threshold = this.properties.threshold;\r\n            if (this.isInputConnected(3)) {\r\n                threshold = this.getInputData(3);\r\n                this.properties.threshold = threshold;\r\n            }\r\n\r\n            var precision = gl.UNSIGNED_BYTE;\r\n            if (this.properties.high_precision) {\r\n                precision = gl.half_float_ext ? gl.HALF_FLOAT_OES : gl.FLOAT;\r\n            }\r\n            if (\r\n                !this._temp_texture ||\r\n                this._temp_texture.type != precision ||\r\n                this._temp_texture.width != tex.width ||\r\n                this._temp_texture.height != tex.height\r\n            ) {\r\n                this._temp_texture = new GL.Texture(tex.width, tex.height, {\r\n                    type: precision,\r\n                    format: gl.RGBA,\r\n                    filter: gl.LINEAR\r\n                });\r\n            }\r\n\r\n            //iterations\r\n            var size = this.properties.size;\r\n\r\n            var first_shader = LGraphFXBokeh._first_shader;\r\n            if (!first_shader) {\r\n                first_shader = LGraphFXBokeh._first_shader = new GL.Shader(\r\n                    Shader.SCREEN_VERTEX_SHADER,\r\n                    LGraphFXBokeh._first_pixel_shader\r\n                );\r\n            }\r\n\r\n            var second_shader = LGraphFXBokeh._second_shader;\r\n            if (!second_shader) {\r\n                second_shader = LGraphFXBokeh._second_shader = new GL.Shader(\r\n                    LGraphFXBokeh._second_vertex_shader,\r\n                    LGraphFXBokeh._second_pixel_shader\r\n                );\r\n            }\r\n\r\n            var points_mesh = this._points_mesh;\r\n            if (\r\n                !points_mesh ||\r\n                points_mesh._width != tex.width ||\r\n                points_mesh._height != tex.height ||\r\n                points_mesh._spacing != 2\r\n            ) {\r\n                points_mesh = this.createPointsMesh(tex.width, tex.height, 2);\r\n            }\r\n\r\n            var screen_mesh = Mesh.getScreenQuad();\r\n\r\n            var point_size = this.properties.size;\r\n            var min_light = this.properties.min_light;\r\n            var alpha = this.properties.alpha;\r\n\r\n            gl.disable(gl.DEPTH_TEST);\r\n            gl.disable(gl.BLEND);\r\n\r\n            this._temp_texture.drawTo(function() {\r\n                tex.bind(0);\r\n                blurred_tex.bind(1);\r\n                mask_tex.bind(2);\r\n                first_shader\r\n                    .uniforms({\r\n                        u_texture: 0,\r\n                        u_texture_blur: 1,\r\n                        u_mask: 2,\r\n                        u_texsize: [tex.width, tex.height]\r\n                    })\r\n                    .draw(screen_mesh);\r\n            });\r\n\r\n            this._temp_texture.drawTo(function() {\r\n                //clear because we use blending\r\n                //gl.clearColor(0.0,0.0,0.0,1.0);\r\n                //gl.clear( gl.COLOR_BUFFER_BIT );\r\n                gl.enable(gl.BLEND);\r\n                gl.blendFunc(gl.ONE, gl.ONE);\r\n\r\n                tex.bind(0);\r\n                shape_tex.bind(3);\r\n                second_shader\r\n                    .uniforms({\r\n                        u_texture: 0,\r\n                        u_mask: 2,\r\n                        u_shape: 3,\r\n                        u_alpha: alpha,\r\n                        u_threshold: threshold,\r\n                        u_pointSize: point_size,\r\n                        u_itexsize: [1.0 / tex.width, 1.0 / tex.height]\r\n                    })\r\n                    .draw(points_mesh, gl.POINTS);\r\n            });\r\n\r\n            this.setOutputData(0, this._temp_texture);\r\n        };\r\n\r\n        LGraphFXBokeh.prototype.createPointsMesh = function(\r\n            width,\r\n            height,\r\n            spacing\r\n        ) {\r\n            var nwidth = Math.round(width / spacing);\r\n            var nheight = Math.round(height / spacing);\r\n\r\n            var vertices = new Float32Array(nwidth * nheight * 2);\r\n\r\n            var ny = -1;\r\n            var dx = (2 / width) * spacing;\r\n            var dy = (2 / height) * spacing;\r\n            for (var y = 0; y < nheight; ++y) {\r\n                var nx = -1;\r\n                for (var x = 0; x < nwidth; ++x) {\r\n                    var pos = y * nwidth * 2 + x * 2;\r\n                    vertices[pos] = nx;\r\n                    vertices[pos + 1] = ny;\r\n                    nx += dx;\r\n                }\r\n                ny += dy;\r\n            }\r\n\r\n            this._points_mesh = GL.Mesh.load({ vertices2D: vertices });\r\n            this._points_mesh._width = width;\r\n            this._points_mesh._height = height;\r\n            this._points_mesh._spacing = spacing;\r\n\r\n            return this._points_mesh;\r\n        };\r\n\r\n        /*\r\n\tLGraphTextureBokeh._pixel_shader = \"precision highp float;\\n\\\r\n\t\t\tvarying vec2 a_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform sampler2D u_shape;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec4 color = texture2D( u_texture, gl_PointCoord );\\n\\\r\n\t\t\t\tcolor *= v_color * u_alpha;\\n\\\r\n\t\t\t\tgl_FragColor = color;\\n\\\r\n\t\t\t}\\n\";\r\n\t*/\r\n\r\n        LGraphFXBokeh._first_pixel_shader =\r\n            \"precision highp float;\\n\\\r\n\t\t\tprecision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform sampler2D u_texture_blur;\\n\\\r\n\t\t\tuniform sampler2D u_mask;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\tvec4 blurred_color = texture2D(u_texture_blur, v_coord);\\n\\\r\n\t\t\t\tfloat mask = texture2D(u_mask, v_coord).x;\\n\\\r\n\t\t\t   gl_FragColor = mix(color, blurred_color, mask);\\n\\\r\n\t\t\t}\\n\\\r\n\t\t\t\";\r\n\r\n        LGraphFXBokeh._second_vertex_shader =\r\n            \"precision highp float;\\n\\\r\n\t\t\tattribute vec2 a_vertex2D;\\n\\\r\n\t\t\tvarying vec4 v_color;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform sampler2D u_mask;\\n\\\r\n\t\t\tuniform vec2 u_itexsize;\\n\\\r\n\t\t\tuniform float u_pointSize;\\n\\\r\n\t\t\tuniform float u_threshold;\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec2 coord = a_vertex2D * 0.5 + 0.5;\\n\\\r\n\t\t\t\tv_color = texture2D( u_texture, coord );\\n\\\r\n\t\t\t\tv_color += texture2D( u_texture, coord + vec2(u_itexsize.x, 0.0) );\\n\\\r\n\t\t\t\tv_color += texture2D( u_texture, coord + vec2(0.0, u_itexsize.y));\\n\\\r\n\t\t\t\tv_color += texture2D( u_texture, coord + u_itexsize);\\n\\\r\n\t\t\t\tv_color *= 0.25;\\n\\\r\n\t\t\t\tfloat mask = texture2D(u_mask, coord).x;\\n\\\r\n\t\t\t\tfloat luminance = length(v_color) * mask;\\n\\\r\n\t\t\t\t/*luminance /= (u_pointSize*u_pointSize)*0.01 */;\\n\\\r\n\t\t\t\tluminance -= u_threshold;\\n\\\r\n\t\t\t\tif(luminance < 0.0)\\n\\\r\n\t\t\t\t{\\n\\\r\n\t\t\t\t\tgl_Position.x = -100.0;\\n\\\r\n\t\t\t\t\treturn;\\n\\\r\n\t\t\t\t}\\n\\\r\n\t\t\t\tgl_PointSize = u_pointSize;\\n\\\r\n\t\t\t\tgl_Position = vec4(a_vertex2D,0.0,1.0);\\n\\\r\n\t\t\t}\\n\\\r\n\t\t\t\";\r\n\r\n        LGraphFXBokeh._second_pixel_shader =\r\n            \"precision highp float;\\n\\\r\n\t\t\tvarying vec4 v_color;\\n\\\r\n\t\t\tuniform sampler2D u_shape;\\n\\\r\n\t\t\tuniform float u_alpha;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec4 color = texture2D( u_shape, gl_PointCoord );\\n\\\r\n\t\t\t\tcolor *= v_color * u_alpha;\\n\\\r\n\t\t\t\tgl_FragColor = color;\\n\\\r\n\t\t\t}\\n\";\r\n\r\n        LiteGraph.registerNodeType(\"fx/bokeh\", LGraphFXBokeh);\r\n        global.LGraphFXBokeh = LGraphFXBokeh;\r\n\r\n        //************************************************\r\n\r\n        function LGraphFXGeneric() {\r\n            this.addInput(\"Texture\", \"Texture\");\r\n            this.addInput(\"value1\", \"number\");\r\n            this.addInput(\"value2\", \"number\");\r\n            this.addOutput(\"Texture\", \"Texture\");\r\n            this.properties = {\r\n                fx: \"halftone\",\r\n                value1: 1,\r\n                value2: 1,\r\n                precision: LGraphTexture.DEFAULT\r\n            };\r\n        }\r\n\r\n        LGraphFXGeneric.title = \"FX\";\r\n        LGraphFXGeneric.desc = \"applies an FX from a list\";\r\n\r\n        LGraphFXGeneric.widgets_info = {\r\n            fx: {\r\n                widget: \"combo\",\r\n                values: [\"halftone\", \"pixelate\", \"lowpalette\", \"noise\", \"gamma\"]\r\n            },\r\n            precision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\r\n        };\r\n        LGraphFXGeneric.shaders = {};\r\n\r\n        LGraphFXGeneric.prototype.onExecute = function() {\r\n            if (!this.isOutputConnected(0)) {\r\n                return;\r\n            } //saves work\r\n\r\n            var tex = this.getInputData(0);\r\n            if (this.properties.precision === LGraphTexture.PASS_THROUGH) {\r\n                this.setOutputData(0, tex);\r\n                return;\r\n            }\r\n\r\n            if (!tex) {\r\n                return;\r\n            }\r\n\r\n            this._tex = LGraphTexture.getTargetTexture(\r\n                tex,\r\n                this._tex,\r\n                this.properties.precision\r\n            );\r\n\r\n            //iterations\r\n            var value1 = this.properties.value1;\r\n            if (this.isInputConnected(1)) {\r\n                value1 = this.getInputData(1);\r\n                this.properties.value1 = value1;\r\n            }\r\n\r\n            var value2 = this.properties.value2;\r\n            if (this.isInputConnected(2)) {\r\n                value2 = this.getInputData(2);\r\n                this.properties.value2 = value2;\r\n            }\r\n\r\n            var fx = this.properties.fx;\r\n            var shader = LGraphFXGeneric.shaders[fx];\r\n            if (!shader) {\r\n                var pixel_shader_code = LGraphFXGeneric[\"pixel_shader_\" + fx];\r\n                if (!pixel_shader_code) {\r\n                    return;\r\n                }\r\n\r\n                shader = LGraphFXGeneric.shaders[fx] = new GL.Shader(\r\n                    Shader.SCREEN_VERTEX_SHADER,\r\n                    pixel_shader_code\r\n                );\r\n            }\r\n\r\n            gl.disable(gl.BLEND);\r\n            gl.disable(gl.DEPTH_TEST);\r\n            var mesh = Mesh.getScreenQuad();\r\n            var camera = global.LS ? LS.Renderer._current_camera : null;\r\n            var camera_planes;\r\n            if (camera) {\r\n                camera_planes = [\r\n                    LS.Renderer._current_camera.near,\r\n                    LS.Renderer._current_camera.far\r\n                ];\r\n            } else {\r\n                camera_planes = [1, 100];\r\n            }\r\n\r\n            var noise = null;\r\n            if (fx == \"noise\") {\r\n                noise = LGraphTexture.getNoiseTexture();\r\n            }\r\n\r\n            this._tex.drawTo(function() {\r\n                tex.bind(0);\r\n                if (fx == \"noise\") {\r\n                    noise.bind(1);\r\n                }\r\n\r\n                shader\r\n                    .uniforms({\r\n                        u_texture: 0,\r\n                        u_noise: 1,\r\n                        u_size: [tex.width, tex.height],\r\n                        u_rand: [Math.random(), Math.random()],\r\n                        u_value1: value1,\r\n                        u_value2: value2,\r\n                        u_camera_planes: camera_planes\r\n                    })\r\n                    .draw(mesh);\r\n            });\r\n\r\n            this.setOutputData(0, this._tex);\r\n        };\r\n\r\n        LGraphFXGeneric.pixel_shader_halftone =\r\n            \"precision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform vec2 u_camera_planes;\\n\\\r\n\t\t\tuniform vec2 u_size;\\n\\\r\n\t\t\tuniform float u_value1;\\n\\\r\n\t\t\tuniform float u_value2;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tfloat pattern() {\\n\\\r\n\t\t\t\tfloat s = sin(u_value1 * 3.1415), c = cos(u_value1 * 3.1415);\\n\\\r\n\t\t\t\tvec2 tex = v_coord * u_size.xy;\\n\\\r\n\t\t\t\tvec2 point = vec2(\\n\\\r\n\t\t\t\t   c * tex.x - s * tex.y ,\\n\\\r\n\t\t\t\t   s * tex.x + c * tex.y \\n\\\r\n\t\t\t\t) * u_value2;\\n\\\r\n\t\t\t\treturn (sin(point.x) * sin(point.y)) * 4.0;\\n\\\r\n\t\t\t}\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\tfloat average = (color.r + color.g + color.b) / 3.0;\\n\\\r\n\t\t\t\tgl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\\n\\\r\n\t\t\t}\\n\";\r\n\r\n        LGraphFXGeneric.pixel_shader_pixelate =\r\n            \"precision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform vec2 u_camera_planes;\\n\\\r\n\t\t\tuniform vec2 u_size;\\n\\\r\n\t\t\tuniform float u_value1;\\n\\\r\n\t\t\tuniform float u_value2;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec2 coord = vec2( floor(v_coord.x * u_value1) / u_value1, floor(v_coord.y * u_value2) / u_value2 );\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture, coord);\\n\\\r\n\t\t\t\tgl_FragColor = color;\\n\\\r\n\t\t\t}\\n\";\r\n\r\n        LGraphFXGeneric.pixel_shader_lowpalette =\r\n            \"precision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform vec2 u_camera_planes;\\n\\\r\n\t\t\tuniform vec2 u_size;\\n\\\r\n\t\t\tuniform float u_value1;\\n\\\r\n\t\t\tuniform float u_value2;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\tgl_FragColor = floor(color * u_value1) / u_value1;\\n\\\r\n\t\t\t}\\n\";\r\n\r\n        LGraphFXGeneric.pixel_shader_noise =\r\n            \"precision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform sampler2D u_noise;\\n\\\r\n\t\t\tuniform vec2 u_size;\\n\\\r\n\t\t\tuniform float u_value1;\\n\\\r\n\t\t\tuniform float u_value2;\\n\\\r\n\t\t\tuniform vec2 u_rand;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\tvec3 noise = texture2D(u_noise, v_coord * vec2(u_size.x / 512.0, u_size.y / 512.0) + u_rand).xyz - vec3(0.5);\\n\\\r\n\t\t\t\tgl_FragColor = vec4( color.xyz + noise * u_value1, color.a );\\n\\\r\n\t\t\t}\\n\";\r\n\r\n        LGraphFXGeneric.pixel_shader_gamma =\r\n            \"precision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform float u_value1;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\tfloat gamma = 1.0 / u_value1;\\n\\\r\n\t\t\t\tgl_FragColor = vec4( pow( color.xyz, vec3(gamma) ), color.a );\\n\\\r\n\t\t\t}\\n\";\r\n\r\n        LiteGraph.registerNodeType(\"fx/generic\", LGraphFXGeneric);\r\n        global.LGraphFXGeneric = LGraphFXGeneric;\r\n\r\n        // Vigneting ************************************\r\n\r\n        function LGraphFXVigneting() {\r\n            this.addInput(\"Tex.\", \"Texture\");\r\n            this.addInput(\"intensity\", \"number\");\r\n\r\n            this.addOutput(\"Texture\", \"Texture\");\r\n            this.properties = {\r\n                intensity: 1,\r\n                invert: false,\r\n                precision: LGraphTexture.DEFAULT\r\n            };\r\n\r\n            if (!LGraphFXVigneting._shader) {\r\n                LGraphFXVigneting._shader = new GL.Shader(\r\n                    Shader.SCREEN_VERTEX_SHADER,\r\n                    LGraphFXVigneting.pixel_shader\r\n                );\r\n            }\r\n        }\r\n\r\n        LGraphFXVigneting.title = \"Vigneting\";\r\n        LGraphFXVigneting.desc = \"Vigneting\";\r\n\r\n        LGraphFXVigneting.widgets_info = {\r\n            precision: { widget: \"combo\", values: LGraphTexture.MODE_VALUES }\r\n        };\r\n\r\n        LGraphFXVigneting.prototype.onExecute = function() {\r\n            var tex = this.getInputData(0);\r\n\r\n            if (this.properties.precision === LGraphTexture.PASS_THROUGH) {\r\n                this.setOutputData(0, tex);\r\n                return;\r\n            }\r\n\r\n            if (!tex) {\r\n                return;\r\n            }\r\n\r\n            this._tex = LGraphTexture.getTargetTexture(\r\n                tex,\r\n                this._tex,\r\n                this.properties.precision\r\n            );\r\n\r\n            var intensity = this.properties.intensity;\r\n            if (this.isInputConnected(1)) {\r\n                intensity = this.getInputData(1);\r\n                this.properties.intensity = intensity;\r\n            }\r\n\r\n            gl.disable(gl.BLEND);\r\n            gl.disable(gl.DEPTH_TEST);\r\n\r\n            var mesh = Mesh.getScreenQuad();\r\n            var shader = LGraphFXVigneting._shader;\r\n            var invert = this.properties.invert;\r\n\r\n            this._tex.drawTo(function() {\r\n                tex.bind(0);\r\n                shader\r\n                    .uniforms({\r\n                        u_texture: 0,\r\n                        u_intensity: intensity,\r\n                        u_isize: [1 / tex.width, 1 / tex.height],\r\n                        u_invert: invert ? 1 : 0\r\n                    })\r\n                    .draw(mesh);\r\n            });\r\n\r\n            this.setOutputData(0, this._tex);\r\n        };\r\n\r\n        LGraphFXVigneting.pixel_shader =\r\n            \"precision highp float;\\n\\\r\n\t\t\tprecision highp float;\\n\\\r\n\t\t\tvarying vec2 v_coord;\\n\\\r\n\t\t\tuniform sampler2D u_texture;\\n\\\r\n\t\t\tuniform float u_intensity;\\n\\\r\n\t\t\tuniform int u_invert;\\n\\\r\n\t\t\t\\n\\\r\n\t\t\tvoid main() {\\n\\\r\n\t\t\t\tfloat luminance = 1.0 - length( v_coord - vec2(0.5) ) * 1.414;\\n\\\r\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\\n\\\r\n\t\t\t\tif(u_invert == 1)\\n\\\r\n\t\t\t\t\tluminance = 1.0 - luminance;\\n\\\r\n\t\t\t\tluminance = mix(1.0, luminance, u_intensity);\\n\\\r\n\t\t\t   gl_FragColor = vec4( luminance * color.xyz, color.a);\\n\\\r\n\t\t\t}\\n\\\r\n\t\t\t\";\r\n\r\n        LiteGraph.registerNodeType(\"fx/vigneting\", LGraphFXVigneting);\r\n        global.LGraphFXVigneting = LGraphFXVigneting;\r\n    }\r\n})(this);\r\n\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n    var MIDI_COLOR = \"#243\";\r\n\r\n    function MIDIEvent(data) {\r\n        this.channel = 0;\r\n        this.cmd = 0;\r\n        this.data = new Uint32Array(3);\r\n\r\n        if (data) {\r\n            this.setup(data);\r\n        }\r\n    }\r\n\r\n    LiteGraph.MIDIEvent = MIDIEvent;\r\n\r\n    MIDIEvent.prototype.fromJSON = function(o) {\r\n        this.setup(o.data);\r\n    };\r\n\r\n    MIDIEvent.prototype.setup = function(data) {\r\n        var raw_data = data;\r\n        if (data.constructor === Object) {\r\n            raw_data = data.data;\r\n        }\r\n\r\n        this.data.set(raw_data);\r\n\r\n        var midiStatus = raw_data[0];\r\n        this.status = midiStatus;\r\n\r\n        var midiCommand = midiStatus & 0xf0;\r\n\r\n        if (midiStatus >= 0xf0) {\r\n            this.cmd = midiStatus;\r\n        } else {\r\n            this.cmd = midiCommand;\r\n        }\r\n\r\n        if (this.cmd == MIDIEvent.NOTEON && this.velocity == 0) {\r\n            this.cmd = MIDIEvent.NOTEOFF;\r\n        }\r\n\r\n        this.cmd_str = MIDIEvent.commands[this.cmd] || \"\";\r\n\r\n        if (\r\n            midiCommand >= MIDIEvent.NOTEON ||\r\n            midiCommand <= MIDIEvent.NOTEOFF\r\n        ) {\r\n            this.channel = midiStatus & 0x0f;\r\n        }\r\n    };\r\n\r\n    Object.defineProperty(MIDIEvent.prototype, \"velocity\", {\r\n        get: function() {\r\n            if (this.cmd == MIDIEvent.NOTEON) {\r\n                return this.data[2];\r\n            }\r\n            return -1;\r\n        },\r\n        set: function(v) {\r\n            this.data[2] = v; //  v / 127;\r\n        },\r\n        enumerable: true\r\n    });\r\n\r\n    MIDIEvent.notes = [\r\n        \"A\",\r\n        \"A#\",\r\n        \"B\",\r\n        \"C\",\r\n        \"C#\",\r\n        \"D\",\r\n        \"D#\",\r\n        \"E\",\r\n        \"F\",\r\n        \"F#\",\r\n        \"G\",\r\n        \"G#\"\r\n    ];\r\n    MIDIEvent.note_to_index = {\r\n        A: 0,\r\n        \"A#\": 1,\r\n        B: 2,\r\n        C: 3,\r\n        \"C#\": 4,\r\n        D: 5,\r\n        \"D#\": 6,\r\n        E: 7,\r\n        F: 8,\r\n        \"F#\": 9,\r\n        G: 10,\r\n        \"G#\": 11\r\n    };\r\n\r\n    Object.defineProperty(MIDIEvent.prototype, \"note\", {\r\n        get: function() {\r\n            if (this.cmd != MIDIEvent.NOTEON) {\r\n                return -1;\r\n            }\r\n            return MIDIEvent.toNoteString(this.data[1], true);\r\n        },\r\n        set: function(v) {\r\n            throw \"notes cannot be assigned this way, must modify the data[1]\";\r\n        },\r\n        enumerable: true\r\n    });\r\n\r\n    Object.defineProperty(MIDIEvent.prototype, \"octave\", {\r\n        get: function() {\r\n            if (this.cmd != MIDIEvent.NOTEON) {\r\n                return -1;\r\n            }\r\n            var octave = this.data[1] - 24;\r\n            return Math.floor(octave / 12 + 1);\r\n        },\r\n        set: function(v) {\r\n            throw \"octave cannot be assigned this way, must modify the data[1]\";\r\n        },\r\n        enumerable: true\r\n    });\r\n\r\n    //returns HZs\r\n    MIDIEvent.prototype.getPitch = function() {\r\n        return Math.pow(2, (this.data[1] - 69) / 12) * 440;\r\n    };\r\n\r\n    MIDIEvent.computePitch = function(note) {\r\n        return Math.pow(2, (note - 69) / 12) * 440;\r\n    };\r\n\r\n    MIDIEvent.prototype.getCC = function() {\r\n        return this.data[1];\r\n    };\r\n\r\n    MIDIEvent.prototype.getCCValue = function() {\r\n        return this.data[2];\r\n    };\r\n\r\n    //not tested, there is a formula missing here\r\n    MIDIEvent.prototype.getPitchBend = function() {\r\n        return this.data[1] + (this.data[2] << 7) - 8192;\r\n    };\r\n\r\n    MIDIEvent.computePitchBend = function(v1, v2) {\r\n        return v1 + (v2 << 7) - 8192;\r\n    };\r\n\r\n    MIDIEvent.prototype.setCommandFromString = function(str) {\r\n        this.cmd = MIDIEvent.computeCommandFromString(str);\r\n    };\r\n\r\n    MIDIEvent.computeCommandFromString = function(str) {\r\n        if (!str) {\r\n            return 0;\r\n        }\r\n\r\n        if (str && str.constructor === Number) {\r\n            return str;\r\n        }\r\n\r\n        str = str.toUpperCase();\r\n        switch (str) {\r\n            case \"NOTE ON\":\r\n            case \"NOTEON\":\r\n                return MIDIEvent.NOTEON;\r\n                break;\r\n            case \"NOTE OFF\":\r\n            case \"NOTEOFF\":\r\n                return MIDIEvent.NOTEON;\r\n                break;\r\n            case \"KEY PRESSURE\":\r\n            case \"KEYPRESSURE\":\r\n                return MIDIEvent.KEYPRESSURE;\r\n                break;\r\n            case \"CONTROLLER CHANGE\":\r\n            case \"CONTROLLERCHANGE\":\r\n            case \"CC\":\r\n                return MIDIEvent.CONTROLLERCHANGE;\r\n                break;\r\n            case \"PROGRAM CHANGE\":\r\n            case \"PROGRAMCHANGE\":\r\n            case \"PC\":\r\n                return MIDIEvent.PROGRAMCHANGE;\r\n                break;\r\n            case \"CHANNEL PRESSURE\":\r\n            case \"CHANNELPRESSURE\":\r\n                return MIDIEvent.CHANNELPRESSURE;\r\n                break;\r\n            case \"PITCH BEND\":\r\n            case \"PITCHBEND\":\r\n                return MIDIEvent.PITCHBEND;\r\n                break;\r\n            case \"TIME TICK\":\r\n            case \"TIMETICK\":\r\n                return MIDIEvent.TIMETICK;\r\n                break;\r\n            default:\r\n                return Number(str); //assume its a hex code\r\n        }\r\n    };\r\n\r\n    //transform from a pitch number to string like \"C4\"\r\n    MIDIEvent.toNoteString = function(d, skip_octave) {\r\n        d = Math.round(d); //in case it has decimals\r\n        var note = d - 21;\r\n        var octave = Math.floor((d - 24) / 12 + 1);\r\n        note = note % 12;\r\n        if (note < 0) {\r\n            note = 12 + note;\r\n        }\r\n        return MIDIEvent.notes[note] + (skip_octave ? \"\" : octave);\r\n    };\r\n\r\n    MIDIEvent.NoteStringToPitch = function(str) {\r\n        str = str.toUpperCase();\r\n        var note = str[0];\r\n        var octave = 4;\r\n\r\n        if (str[1] == \"#\") {\r\n            note += \"#\";\r\n            if (str.length > 2) {\r\n                octave = Number(str[2]);\r\n            }\r\n        } else {\r\n            if (str.length > 1) {\r\n                octave = Number(str[1]);\r\n            }\r\n        }\r\n        var pitch = MIDIEvent.note_to_index[note];\r\n        if (pitch == null) {\r\n            return null;\r\n        }\r\n        return (octave - 1) * 12 + pitch + 21;\r\n    };\r\n\r\n    MIDIEvent.prototype.toString = function() {\r\n        var str = \"\" + this.channel + \". \";\r\n        switch (this.cmd) {\r\n            case MIDIEvent.NOTEON:\r\n                str += \"NOTEON \" + MIDIEvent.toNoteString(this.data[1]);\r\n                break;\r\n            case MIDIEvent.NOTEOFF:\r\n                str += \"NOTEOFF \" + MIDIEvent.toNoteString(this.data[1]);\r\n                break;\r\n            case MIDIEvent.CONTROLLERCHANGE:\r\n                str += \"CC \" + this.data[1] + \" \" + this.data[2];\r\n                break;\r\n            case MIDIEvent.PROGRAMCHANGE:\r\n                str += \"PC \" + this.data[1];\r\n                break;\r\n            case MIDIEvent.PITCHBEND:\r\n                str += \"PITCHBEND \" + this.getPitchBend();\r\n                break;\r\n            case MIDIEvent.KEYPRESSURE:\r\n                str += \"KEYPRESS \" + this.data[1];\r\n                break;\r\n        }\r\n\r\n        return str;\r\n    };\r\n\r\n    MIDIEvent.prototype.toHexString = function() {\r\n        var str = \"\";\r\n        for (var i = 0; i < this.data.length; i++) {\r\n            str += this.data[i].toString(16) + \" \";\r\n        }\r\n    };\r\n\r\n    MIDIEvent.prototype.toJSON = function() {\r\n        return {\r\n            data: [this.data[0], this.data[1], this.data[2]],\r\n            object_class: \"MIDIEvent\"\r\n        };\r\n    };\r\n\r\n    MIDIEvent.NOTEOFF = 0x80;\r\n    MIDIEvent.NOTEON = 0x90;\r\n    MIDIEvent.KEYPRESSURE = 0xa0;\r\n    MIDIEvent.CONTROLLERCHANGE = 0xb0;\r\n    MIDIEvent.PROGRAMCHANGE = 0xc0;\r\n    MIDIEvent.CHANNELPRESSURE = 0xd0;\r\n    MIDIEvent.PITCHBEND = 0xe0;\r\n    MIDIEvent.TIMETICK = 0xf8;\r\n\r\n    MIDIEvent.commands = {\r\n        0x80: \"note off\",\r\n        0x90: \"note on\",\r\n        0xa0: \"key pressure\",\r\n        0xb0: \"controller change\",\r\n        0xc0: \"program change\",\r\n        0xd0: \"channel pressure\",\r\n        0xe0: \"pitch bend\",\r\n        0xf0: \"system\",\r\n        0xf2: \"Song pos\",\r\n        0xf3: \"Song select\",\r\n        0xf6: \"Tune request\",\r\n        0xf8: \"time tick\",\r\n        0xfa: \"Start Song\",\r\n        0xfb: \"Continue Song\",\r\n        0xfc: \"Stop Song\",\r\n        0xfe: \"Sensing\",\r\n        0xff: \"Reset\"\r\n    };\r\n\r\n    MIDIEvent.commands_short = {\r\n        0x80: \"NOTEOFF\",\r\n        0x90: \"NOTEOFF\",\r\n        0xa0: \"KEYP\",\r\n        0xb0: \"CC\",\r\n        0xc0: \"PC\",\r\n        0xd0: \"CP\",\r\n        0xe0: \"PB\",\r\n        0xf0: \"SYS\",\r\n        0xf2: \"POS\",\r\n        0xf3: \"SELECT\",\r\n        0xf6: \"TUNEREQ\",\r\n        0xf8: \"TT\",\r\n        0xfa: \"START\",\r\n        0xfb: \"CONTINUE\",\r\n        0xfc: \"STOP\",\r\n        0xfe: \"SENS\",\r\n        0xff: \"RESET\"\r\n    };\r\n\r\n    MIDIEvent.commands_reversed = {};\r\n    for (var i in MIDIEvent.commands) {\r\n        MIDIEvent.commands_reversed[MIDIEvent.commands[i]] = i;\r\n    }\r\n\r\n    //MIDI wrapper, instantiate by MIDIIn and MIDIOut\r\n    function MIDIInterface(on_ready, on_error) {\r\n        if (!navigator.requestMIDIAccess) {\r\n            this.error = \"not suppoorted\";\r\n            if (on_error) {\r\n                on_error(\"Not supported\");\r\n            } else {\r\n                console.error(\"MIDI NOT SUPPORTED, enable by chrome://flags\");\r\n            }\r\n            return;\r\n        }\r\n\r\n        this.on_ready = on_ready;\r\n\r\n        this.state = {\r\n            note: [],\r\n            cc: []\r\n        };\r\n\r\n\t\tthis.input_ports = null;\r\n\t\tthis.input_ports_info = [];\r\n\t\tthis.output_ports = null;\r\n\t\tthis.output_ports_info = [];\r\n\r\n        navigator.requestMIDIAccess().then(this.onMIDISuccess.bind(this), this.onMIDIFailure.bind(this));\r\n    }\r\n\r\n    MIDIInterface.input = null;\r\n\r\n    MIDIInterface.MIDIEvent = MIDIEvent;\r\n\r\n    MIDIInterface.prototype.onMIDISuccess = function(midiAccess) {\r\n        console.log(\"MIDI ready!\");\r\n        console.log(midiAccess);\r\n        this.midi = midiAccess; // store in the global (in real usage, would probably keep in an object instance)\r\n        this.updatePorts();\r\n\r\n        if (this.on_ready) {\r\n            this.on_ready(this);\r\n        }\r\n    };\r\n\r\n    MIDIInterface.prototype.updatePorts = function() {\r\n        var midi = this.midi;\r\n        this.input_ports = midi.inputs;\r\n\t\tthis.input_ports_info = [];\r\n        this.output_ports = midi.outputs;\r\n\t\tthis.output_ports_info = [];\r\n\r\n        var num = 0;\r\n\r\n        var it = this.input_ports.values();\r\n        var it_value = it.next();\r\n        while (it_value && it_value.done === false) {\r\n            var port_info = it_value.value;\r\n\t\t\tthis.input_ports_info.push(port_info);\r\n            console.log( \"Input port [type:'\" + port_info.type + \"'] id:'\" + port_info.id + \"' manufacturer:'\" + port_info.manufacturer + \"' name:'\" + port_info.name + \"' version:'\" + port_info.version + \"'\" );\r\n            num++;\r\n            it_value = it.next();\r\n        }\r\n        this.num_input_ports = num;\r\n\r\n        num = 0;\r\n        var it = this.output_ports.values();\r\n        var it_value = it.next();\r\n        while (it_value && it_value.done === false) {\r\n            var port_info = it_value.value;\r\n\t\t\tthis.output_ports_info.push(port_info);\r\n            console.log( \"Output port [type:'\" + port_info.type + \"'] id:'\" + port_info.id + \"' manufacturer:'\" + port_info.manufacturer + \"' name:'\" + port_info.name + \"' version:'\" + port_info.version + \"'\" );\r\n            num++;\r\n            it_value = it.next();\r\n        }\r\n        this.num_output_ports = num;\r\n    };\r\n\r\n    MIDIInterface.prototype.onMIDIFailure = function(msg) {\r\n        console.error(\"Failed to get MIDI access - \" + msg);\r\n    };\r\n\r\n    MIDIInterface.prototype.openInputPort = function(port, callback) {\r\n        var input_port = this.input_ports.get(\"input-\" + port);\r\n        if (!input_port) {\r\n            return false;\r\n        }\r\n        MIDIInterface.input = this;\r\n        var that = this;\r\n\r\n        input_port.onmidimessage = function(a) {\r\n            var midi_event = new MIDIEvent(a.data);\r\n            that.updateState(midi_event);\r\n            if (callback) {\r\n                callback(a.data, midi_event);\r\n            }\r\n            if (MIDIInterface.on_message) {\r\n                MIDIInterface.on_message(a.data, midi_event);\r\n            }\r\n        };\r\n        console.log(\"port open: \", input_port);\r\n        return true;\r\n    };\r\n\r\n    MIDIInterface.parseMsg = function(data) {};\r\n\r\n    MIDIInterface.prototype.updateState = function(midi_event) {\r\n        switch (midi_event.cmd) {\r\n            case MIDIEvent.NOTEON:\r\n                this.state.note[midi_event.value1 | 0] = midi_event.value2;\r\n                break;\r\n            case MIDIEvent.NOTEOFF:\r\n                this.state.note[midi_event.value1 | 0] = 0;\r\n                break;\r\n            case MIDIEvent.CONTROLLERCHANGE:\r\n                this.state.cc[midi_event.getCC()] = midi_event.getCCValue();\r\n                break;\r\n        }\r\n    };\r\n\r\n    MIDIInterface.prototype.sendMIDI = function(port, midi_data) {\r\n        if (!midi_data) {\r\n            return;\r\n        }\r\n\r\n        var output_port = this.output_ports_info[port];//this.output_ports.get(\"output-\" + port);\r\n        if (!output_port) {\r\n            return;\r\n        }\r\n\r\n        MIDIInterface.output = this;\r\n\r\n        if (midi_data.constructor === MIDIEvent) {\r\n            output_port.send(midi_data.data);\r\n        } else {\r\n            output_port.send(midi_data);\r\n        }\r\n    };\r\n\r\n    function LGMIDIIn() {\r\n        this.addOutput(\"on_midi\", LiteGraph.EVENT);\r\n        this.addOutput(\"out\", \"midi\");\r\n        this.properties = { port: 0 };\r\n        this._last_midi_event = null;\r\n        this._current_midi_event = null;\r\n        this.boxcolor = \"#AAA\";\r\n        this._last_time = 0;\r\n\r\n        var that = this;\r\n        new MIDIInterface(function(midi) {\r\n            //open\r\n            that._midi = midi;\r\n            if (that._waiting) {\r\n                that.onStart();\r\n            }\r\n            that._waiting = false;\r\n        });\r\n    }\r\n\r\n    LGMIDIIn.MIDIInterface = MIDIInterface;\r\n\r\n    LGMIDIIn.title = \"MIDI Input\";\r\n    LGMIDIIn.desc = \"Reads MIDI from a input port\";\r\n    LGMIDIIn.color = MIDI_COLOR;\r\n\r\n    LGMIDIIn.prototype.getPropertyInfo = function(name) {\r\n        if (!this._midi) {\r\n            return;\r\n        }\r\n\r\n        if (name == \"port\") {\r\n            var values = {};\r\n            for (var i = 0; i < this._midi.input_ports_info.length; ++i) {\r\n                var input = this._midi.input_ports_info[i];\r\n                values[i] = i + \".- \" + input.name + \" version:\" + input.version;\r\n            }\r\n            return { type: \"enum\", values: values };\r\n        }\r\n    };\r\n\r\n    LGMIDIIn.prototype.onStart = function() {\r\n        if (this._midi) {\r\n            this._midi.openInputPort(\r\n                this.properties.port,\r\n                this.onMIDIEvent.bind(this)\r\n            );\r\n        } else {\r\n            this._waiting = true;\r\n        }\r\n    };\r\n\r\n    LGMIDIIn.prototype.onMIDIEvent = function(data, midi_event) {\r\n        this._last_midi_event = midi_event;\r\n        this.boxcolor = \"#AFA\";\r\n        this._last_time = LiteGraph.getTime();\r\n        this.trigger(\"on_midi\", midi_event);\r\n        if (midi_event.cmd == MIDIEvent.NOTEON) {\r\n            this.trigger(\"on_noteon\", midi_event);\r\n        } else if (midi_event.cmd == MIDIEvent.NOTEOFF) {\r\n            this.trigger(\"on_noteoff\", midi_event);\r\n        } else if (midi_event.cmd == MIDIEvent.CONTROLLERCHANGE) {\r\n            this.trigger(\"on_cc\", midi_event);\r\n        } else if (midi_event.cmd == MIDIEvent.PROGRAMCHANGE) {\r\n            this.trigger(\"on_pc\", midi_event);\r\n        } else if (midi_event.cmd == MIDIEvent.PITCHBEND) {\r\n            this.trigger(\"on_pitchbend\", midi_event);\r\n        }\r\n    };\r\n\r\n    LGMIDIIn.prototype.onDrawBackground = function(ctx) {\r\n        this.boxcolor = \"#AAA\";\r\n        if (!this.flags.collapsed && this._last_midi_event) {\r\n            ctx.fillStyle = \"white\";\r\n            var now = LiteGraph.getTime();\r\n            var f = 1.0 - Math.max(0, (now - this._last_time) * 0.001);\r\n            if (f > 0) {\r\n                var t = ctx.globalAlpha;\r\n                ctx.globalAlpha *= f;\r\n                ctx.font = \"12px Tahoma\";\r\n                ctx.fillText(\r\n                    this._last_midi_event.toString(),\r\n                    2,\r\n                    this.size[1] * 0.5 + 3\r\n                );\r\n                //ctx.fillRect(0,0,this.size[0],this.size[1]);\r\n                ctx.globalAlpha = t;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGMIDIIn.prototype.onExecute = function() {\r\n        if (this.outputs) {\r\n            var last = this._last_midi_event;\r\n            for (var i = 0; i < this.outputs.length; ++i) {\r\n                var output = this.outputs[i];\r\n                var v = null;\r\n                switch (output.name) {\r\n                    case \"midi\":\r\n                        v = this._midi;\r\n                        break;\r\n                    case \"last_midi\":\r\n                        v = last;\r\n                        break;\r\n                    default:\r\n                        continue;\r\n                }\r\n                this.setOutputData(i, v);\r\n            }\r\n        }\r\n    };\r\n\r\n    LGMIDIIn.prototype.onGetOutputs = function() {\r\n        return [\r\n            [\"last_midi\", \"midi\"],\r\n            [\"on_midi\", LiteGraph.EVENT],\r\n            [\"on_noteon\", LiteGraph.EVENT],\r\n            [\"on_noteoff\", LiteGraph.EVENT],\r\n            [\"on_cc\", LiteGraph.EVENT],\r\n            [\"on_pc\", LiteGraph.EVENT],\r\n            [\"on_pitchbend\", LiteGraph.EVENT]\r\n        ];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/input\", LGMIDIIn);\r\n\r\n    function LGMIDIOut() {\r\n        this.addInput(\"send\", LiteGraph.EVENT);\r\n        this.properties = { port: 0 };\r\n\r\n        var that = this;\r\n        new MIDIInterface(function(midi) {\r\n            that._midi = midi;\r\n\t\t\tthat.widget.options.values = that.getMIDIOutputs();\r\n        });\r\n\t\tthis.widget = this.addWidget(\"combo\",\"Device\",this.properties.port,{ property: \"port\", values: this.getMIDIOutputs.bind(this) });\r\n\t\tthis.size = [340,60];\r\n    }\r\n\r\n    LGMIDIOut.MIDIInterface = MIDIInterface;\r\n\r\n    LGMIDIOut.title = \"MIDI Output\";\r\n    LGMIDIOut.desc = \"Sends MIDI to output channel\";\r\n    LGMIDIOut.color = MIDI_COLOR;\r\n\r\n    LGMIDIOut.prototype.onGetPropertyInfo = function(name) {\r\n        if (!this._midi) {\r\n            return;\r\n        }\r\n\r\n        if (name == \"port\") {\r\n\t\t\tvar values = this.getMIDIOutputs();\r\n            return { type: \"enum\", values: values };\r\n        }\r\n    };\r\n\tLGMIDIOut.default_ports = {0:\"unknown\"};\r\n\r\n\tLGMIDIOut.prototype.getMIDIOutputs = function()\r\n\t{\r\n\t\tvar values = {};\r\n\t\tif(!this._midi)\r\n\t\t\treturn LGMIDIOut.default_ports;\r\n\t\tif(this._midi.output_ports_info)\r\n\t\tfor (var i = 0; i < this._midi.output_ports_info.length; ++i) {\r\n\t\t\tvar output = this._midi.output_ports_info[i];\r\n\t\t\tif(!output)\r\n\t\t\t\tcontinue;\r\n\t\t\tvar name = i + \".- \" + output.name + \" version:\" + output.version;\r\n\t\t\tvalues[i] = name;\r\n\t\t}\r\n\t\treturn values;\r\n\t}\r\n\r\n    LGMIDIOut.prototype.onAction = function(event, midi_event) {\r\n        //console.log(midi_event);\r\n        if (!this._midi) {\r\n            return;\r\n        }\r\n        if (event == \"send\") {\r\n            this._midi.sendMIDI(this.properties.port, midi_event);\r\n        }\r\n        this.trigger(\"midi\", midi_event);\r\n    };\r\n\r\n    LGMIDIOut.prototype.onGetInputs = function() {\r\n        return [[\"send\", LiteGraph.ACTION]];\r\n    };\r\n\r\n    LGMIDIOut.prototype.onGetOutputs = function() {\r\n        return [[\"on_midi\", LiteGraph.EVENT]];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/output\", LGMIDIOut);\r\n\r\n\r\n    function LGMIDIShow() {\r\n        this.addInput(\"on_midi\", LiteGraph.EVENT);\r\n        this._str = \"\";\r\n        this.size = [200, 40];\r\n    }\r\n\r\n    LGMIDIShow.title = \"MIDI Show\";\r\n    LGMIDIShow.desc = \"Shows MIDI in the graph\";\r\n    LGMIDIShow.color = MIDI_COLOR;\r\n\r\n    LGMIDIShow.prototype.getTitle = function() {\r\n        if (this.flags.collapsed) {\r\n            return this._str;\r\n        }\r\n        return this.title;\r\n    };\r\n\r\n    LGMIDIShow.prototype.onAction = function(event, midi_event) {\r\n        if (!midi_event) {\r\n            return;\r\n        }\r\n        if (midi_event.constructor === MIDIEvent) {\r\n            this._str = midi_event.toString();\r\n        } else {\r\n            this._str = \"???\";\r\n        }\r\n    };\r\n\r\n    LGMIDIShow.prototype.onDrawForeground = function(ctx) {\r\n        if (!this._str || this.flags.collapsed) {\r\n            return;\r\n        }\r\n\r\n        ctx.font = \"30px Arial\";\r\n        ctx.fillText(this._str, 10, this.size[1] * 0.8);\r\n    };\r\n\r\n    LGMIDIShow.prototype.onGetInputs = function() {\r\n        return [[\"in\", LiteGraph.ACTION]];\r\n    };\r\n\r\n    LGMIDIShow.prototype.onGetOutputs = function() {\r\n        return [[\"on_midi\", LiteGraph.EVENT]];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/show\", LGMIDIShow);\r\n\r\n    function LGMIDIFilter() {\r\n        this.properties = {\r\n            channel: -1,\r\n            cmd: -1,\r\n            min_value: -1,\r\n            max_value: -1\r\n        };\r\n\r\n        var that = this;\r\n        this._learning = false;\r\n        this.addWidget(\"button\", \"Learn\", \"\", function() {\r\n            that._learning = true;\r\n            that.boxcolor = \"#FA3\";\r\n        });\r\n\r\n        this.addInput(\"in\", LiteGraph.EVENT);\r\n        this.addOutput(\"on_midi\", LiteGraph.EVENT);\r\n        this.boxcolor = \"#AAA\";\r\n    }\r\n\r\n    LGMIDIFilter.title = \"MIDI Filter\";\r\n    LGMIDIFilter.desc = \"Filters MIDI messages\";\r\n    LGMIDIFilter.color = MIDI_COLOR;\r\n\r\n    LGMIDIFilter[\"@cmd\"] = {\r\n        type: \"enum\",\r\n        title: \"Command\",\r\n        values: MIDIEvent.commands_reversed\r\n    };\r\n\r\n    LGMIDIFilter.prototype.getTitle = function() {\r\n        var str = null;\r\n        if (this.properties.cmd == -1) {\r\n            str = \"Nothing\";\r\n        } else {\r\n            str = MIDIEvent.commands_short[this.properties.cmd] || \"Unknown\";\r\n        }\r\n\r\n        if (\r\n            this.properties.min_value != -1 &&\r\n            this.properties.max_value != -1\r\n        ) {\r\n            str +=\r\n                \" \" +\r\n                (this.properties.min_value == this.properties.max_value\r\n                    ? this.properties.max_value\r\n                    : this.properties.min_value +\r\n                      \"..\" +\r\n                      this.properties.max_value);\r\n        }\r\n\r\n        return \"Filter: \" + str;\r\n    };\r\n\r\n    LGMIDIFilter.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"cmd\") {\r\n            var num = Number(value);\r\n            if (isNaN(num)) {\r\n                num = MIDIEvent.commands[value] || 0;\r\n            }\r\n            this.properties.cmd = num;\r\n        }\r\n    };\r\n\r\n    LGMIDIFilter.prototype.onAction = function(event, midi_event) {\r\n        if (!midi_event || midi_event.constructor !== MIDIEvent) {\r\n            return;\r\n        }\r\n\r\n        if (this._learning) {\r\n            this._learning = false;\r\n            this.boxcolor = \"#AAA\";\r\n            this.properties.channel = midi_event.channel;\r\n            this.properties.cmd = midi_event.cmd;\r\n            this.properties.min_value = this.properties.max_value =\r\n                midi_event.data[1];\r\n        } else {\r\n            if (\r\n                this.properties.channel != -1 &&\r\n                midi_event.channel != this.properties.channel\r\n            ) {\r\n                return;\r\n            }\r\n            if (\r\n                this.properties.cmd != -1 &&\r\n                midi_event.cmd != this.properties.cmd\r\n            ) {\r\n                return;\r\n            }\r\n            if (\r\n                this.properties.min_value != -1 &&\r\n                midi_event.data[1] < this.properties.min_value\r\n            ) {\r\n                return;\r\n            }\r\n            if (\r\n                this.properties.max_value != -1 &&\r\n                midi_event.data[1] > this.properties.max_value\r\n            ) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.trigger(\"on_midi\", midi_event);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/filter\", LGMIDIFilter);\r\n\r\n    function LGMIDIEvent() {\r\n        this.properties = {\r\n            channel: 0,\r\n            cmd: 144, //0x90\r\n            value1: 1,\r\n            value2: 1\r\n        };\r\n\r\n        this.addInput(\"send\", LiteGraph.EVENT);\r\n        this.addInput(\"assign\", LiteGraph.EVENT);\r\n        this.addOutput(\"on_midi\", LiteGraph.EVENT);\r\n\r\n        this.midi_event = new MIDIEvent();\r\n        this.gate = false;\r\n    }\r\n\r\n    LGMIDIEvent.title = \"MIDIEvent\";\r\n    LGMIDIEvent.desc = \"Create a MIDI Event\";\r\n    LGMIDIEvent.color = MIDI_COLOR;\r\n\r\n    LGMIDIEvent.prototype.onAction = function(event, midi_event) {\r\n        if (event == \"assign\") {\r\n            this.properties.channel = midi_event.channel;\r\n            this.properties.cmd = midi_event.cmd;\r\n            this.properties.value1 = midi_event.data[1];\r\n            this.properties.value2 = midi_event.data[2];\r\n            if (midi_event.cmd == MIDIEvent.NOTEON) {\r\n                this.gate = true;\r\n            } else if (midi_event.cmd == MIDIEvent.NOTEOFF) {\r\n                this.gate = false;\r\n            }\r\n            return;\r\n        }\r\n\r\n        //send\r\n        var midi_event = this.midi_event;\r\n        midi_event.channel = this.properties.channel;\r\n        if (this.properties.cmd && this.properties.cmd.constructor === String) {\r\n            midi_event.setCommandFromString(this.properties.cmd);\r\n        } else {\r\n            midi_event.cmd = this.properties.cmd;\r\n        }\r\n        midi_event.data[0] = midi_event.cmd | midi_event.channel;\r\n        midi_event.data[1] = Number(this.properties.value1);\r\n        midi_event.data[2] = Number(this.properties.value2);\r\n\r\n        this.trigger(\"on_midi\", midi_event);\r\n    };\r\n\r\n    LGMIDIEvent.prototype.onExecute = function() {\r\n        var props = this.properties;\r\n\r\n        if (this.inputs) {\r\n            for (var i = 0; i < this.inputs.length; ++i) {\r\n                var input = this.inputs[i];\r\n                if (input.link == -1) {\r\n                    continue;\r\n                }\r\n                switch (input.name) {\r\n                    case \"note\":\r\n                        var v = this.getInputData(i);\r\n                        if (v != null) {\r\n                            if (v.constructor === String) {\r\n                                v = MIDIEvent.NoteStringToPitch(v);\r\n                            }\r\n                            this.properties.value1 = (v | 0) % 255;\r\n                        }\r\n                        break;\r\n                    case \"cmd\":\r\n                        var v = this.getInputData(i);\r\n                        if (v != null) {\r\n                            this.properties.cmd = v;\r\n                        }\r\n                        break;\r\n                    case \"value1\":\r\n                        var v = this.getInputData(i);\r\n                        if (v != null) {\r\n                            this.properties.value1 = clamp(v|0,0,127);\r\n                        }\r\n                        break;\r\n                    case \"value2\":\r\n                        var v = this.getInputData(i);\r\n                        if (v != null) {\r\n                            this.properties.value2 = clamp(v|0,0,127);\r\n                        }\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this.outputs) {\r\n            for (var i = 0; i < this.outputs.length; ++i) {\r\n                var output = this.outputs[i];\r\n                var v = null;\r\n                switch (output.name) {\r\n                    case \"midi\":\r\n                        v = new MIDIEvent();\r\n                        v.setup([props.cmd, props.value1, props.value2]);\r\n                        v.channel = props.channel;\r\n                        break;\r\n                    case \"command\":\r\n                        v = props.cmd;\r\n                        break;\r\n                    case \"cc\":\r\n                        v = props.value1;\r\n                        break;\r\n                    case \"cc_value\":\r\n                        v = props.value2;\r\n                        break;\r\n                    case \"note\":\r\n                        v =\r\n                            props.cmd == MIDIEvent.NOTEON ||\r\n                            props.cmd == MIDIEvent.NOTEOFF\r\n                                ? props.value1\r\n                                : null;\r\n                        break;\r\n                    case \"velocity\":\r\n                        v = props.cmd == MIDIEvent.NOTEON ? props.value2 : null;\r\n                        break;\r\n                    case \"pitch\":\r\n                        v =\r\n                            props.cmd == MIDIEvent.NOTEON\r\n                                ? MIDIEvent.computePitch(props.value1)\r\n                                : null;\r\n                        break;\r\n                    case \"pitchbend\":\r\n                        v =\r\n                            props.cmd == MIDIEvent.PITCHBEND\r\n                                ? MIDIEvent.computePitchBend(\r\n                                      props.value1,\r\n                                      props.value2\r\n                                  )\r\n                                : null;\r\n                        break;\r\n                    case \"gate\":\r\n                        v = this.gate;\r\n                        break;\r\n                    default:\r\n                        continue;\r\n                }\r\n                if (v !== null) {\r\n                    this.setOutputData(i, v);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    LGMIDIEvent.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"cmd\") {\r\n            this.properties.cmd = MIDIEvent.computeCommandFromString(value);\r\n        }\r\n    };\r\n\r\n    LGMIDIEvent.prototype.onGetInputs = function() {\r\n        return [[\"cmd\", \"number\"],[\"note\", \"number\"],[\"value1\", \"number\"],[\"value2\", \"number\"]];\r\n    };\r\n\r\n    LGMIDIEvent.prototype.onGetOutputs = function() {\r\n        return [\r\n            [\"midi\", \"midi\"],\r\n            [\"on_midi\", LiteGraph.EVENT],\r\n            [\"command\", \"number\"],\r\n            [\"note\", \"number\"],\r\n            [\"velocity\", \"number\"],\r\n            [\"cc\", \"number\"],\r\n            [\"cc_value\", \"number\"],\r\n            [\"pitch\", \"number\"],\r\n            [\"gate\", \"bool\"],\r\n            [\"pitchbend\", \"number\"]\r\n        ];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/event\", LGMIDIEvent);\r\n\r\n    function LGMIDICC() {\r\n        this.properties = {\r\n            //\t\tchannel: 0,\r\n            cc: 1,\r\n            value: 0\r\n        };\r\n\r\n        this.addOutput(\"value\", \"number\");\r\n    }\r\n\r\n    LGMIDICC.title = \"MIDICC\";\r\n    LGMIDICC.desc = \"gets a Controller Change\";\r\n    LGMIDICC.color = MIDI_COLOR;\r\n\r\n    LGMIDICC.prototype.onExecute = function() {\r\n        var props = this.properties;\r\n        if (MIDIInterface.input) {\r\n            this.properties.value =\r\n                MIDIInterface.input.state.cc[this.properties.cc];\r\n        }\r\n        this.setOutputData(0, this.properties.value);\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/cc\", LGMIDICC);\r\n\r\n    function LGMIDIGenerator() {\r\n        this.addInput(\"generate\", LiteGraph.ACTION);\r\n        this.addInput(\"scale\", \"string\");\r\n        this.addInput(\"octave\", \"number\");\r\n        this.addOutput(\"note\", LiteGraph.EVENT);\r\n        this.properties = {\r\n            notes: \"A,A#,B,C,C#,D,D#,E,F,F#,G,G#\",\r\n            octave: 2,\r\n            duration: 0.5,\r\n            mode: \"sequence\"\r\n        };\r\n\r\n        this.notes_pitches = LGMIDIGenerator.processScale(\r\n            this.properties.notes\r\n        );\r\n        this.sequence_index = 0;\r\n    }\r\n\r\n    LGMIDIGenerator.title = \"MIDI Generator\";\r\n    LGMIDIGenerator.desc = \"Generates a random MIDI note\";\r\n    LGMIDIGenerator.color = MIDI_COLOR;\r\n\r\n    LGMIDIGenerator.processScale = function(scale) {\r\n        var notes = scale.split(\",\");\r\n        for (var i = 0; i < notes.length; ++i) {\r\n            var n = notes[i];\r\n            if ((n.length == 2 && n[1] != \"#\") || n.length > 2) {\r\n                notes[i] = -LiteGraph.MIDIEvent.NoteStringToPitch(n);\r\n            } else {\r\n                notes[i] = MIDIEvent.note_to_index[n] || 0;\r\n            }\r\n        }\r\n        return notes;\r\n    };\r\n\r\n    LGMIDIGenerator.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"notes\") {\r\n            this.notes_pitches = LGMIDIGenerator.processScale(value);\r\n        }\r\n    };\r\n\r\n    LGMIDIGenerator.prototype.onExecute = function() {\r\n        var octave = this.getInputData(2);\r\n        if (octave != null) {\r\n            this.properties.octave = octave;\r\n        }\r\n\r\n        var scale = this.getInputData(1);\r\n        if (scale) {\r\n            this.notes_pitches = LGMIDIGenerator.processScale(scale);\r\n        }\r\n    };\r\n\r\n    LGMIDIGenerator.prototype.onAction = function(event, midi_event) {\r\n        //var range = this.properties.max - this.properties.min;\r\n        //var pitch = this.properties.min + ((Math.random() * range)|0);\r\n        var pitch = 0;\r\n        var range = this.notes_pitches.length;\r\n        var index = 0;\r\n\r\n        if (this.properties.mode == \"sequence\") {\r\n            index = this.sequence_index = (this.sequence_index + 1) % range;\r\n        } else if (this.properties.mode == \"random\") {\r\n            index = Math.floor(Math.random() * range);\r\n        }\r\n\r\n        var note = this.notes_pitches[index];\r\n        if (note >= 0) {\r\n            pitch = note + (this.properties.octave - 1) * 12 + 33;\r\n        } else {\r\n            pitch = -note;\r\n        }\r\n\r\n        var midi_event = new MIDIEvent();\r\n        midi_event.setup([MIDIEvent.NOTEON, pitch, 10]);\r\n        var duration = this.properties.duration || 1;\r\n        this.trigger(\"note\", midi_event);\r\n\r\n        //noteoff\r\n        setTimeout(\r\n            function() {\r\n                var midi_event = new MIDIEvent();\r\n                midi_event.setup([MIDIEvent.NOTEOFF, pitch, 0]);\r\n                this.trigger(\"note\", midi_event);\r\n            }.bind(this),\r\n            duration * 1000\r\n        );\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/generator\", LGMIDIGenerator);\r\n\r\n    function LGMIDITranspose() {\r\n        this.properties = {\r\n            amount: 0\r\n        };\r\n        this.addInput(\"in\", LiteGraph.ACTION);\r\n        this.addInput(\"amount\", \"number\");\r\n        this.addOutput(\"out\", LiteGraph.EVENT);\r\n\r\n        this.midi_event = new MIDIEvent();\r\n    }\r\n\r\n    LGMIDITranspose.title = \"MIDI Transpose\";\r\n    LGMIDITranspose.desc = \"Transpose a MIDI note\";\r\n    LGMIDITranspose.color = MIDI_COLOR;\r\n\r\n    LGMIDITranspose.prototype.onAction = function(event, midi_event) {\r\n        if (!midi_event || midi_event.constructor !== MIDIEvent) {\r\n            return;\r\n        }\r\n\r\n        if (\r\n            midi_event.data[0] == MIDIEvent.NOTEON ||\r\n            midi_event.data[0] == MIDIEvent.NOTEOFF\r\n        ) {\r\n            this.midi_event = new MIDIEvent();\r\n            this.midi_event.setup(midi_event.data);\r\n            this.midi_event.data[1] = Math.round(\r\n                this.midi_event.data[1] + this.properties.amount\r\n            );\r\n            this.trigger(\"out\", this.midi_event);\r\n        } else {\r\n            this.trigger(\"out\", midi_event);\r\n        }\r\n    };\r\n\r\n    LGMIDITranspose.prototype.onExecute = function() {\r\n        var amount = this.getInputData(1);\r\n        if (amount != null) {\r\n            this.properties.amount = amount;\r\n        }\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/transpose\", LGMIDITranspose);\r\n\r\n    function LGMIDIQuantize() {\r\n        this.properties = {\r\n            scale: \"A,A#,B,C,C#,D,D#,E,F,F#,G,G#\"\r\n        };\r\n        this.addInput(\"note\", LiteGraph.ACTION);\r\n        this.addInput(\"scale\", \"string\");\r\n        this.addOutput(\"out\", LiteGraph.EVENT);\r\n\r\n        this.valid_notes = new Array(12);\r\n        this.offset_notes = new Array(12);\r\n        this.processScale(this.properties.scale);\r\n    }\r\n\r\n    LGMIDIQuantize.title = \"MIDI Quantize Pitch\";\r\n    LGMIDIQuantize.desc = \"Transpose a MIDI note tp fit an scale\";\r\n    LGMIDIQuantize.color = MIDI_COLOR;\r\n\r\n    LGMIDIQuantize.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"scale\") {\r\n            this.processScale(value);\r\n        }\r\n    };\r\n\r\n    LGMIDIQuantize.prototype.processScale = function(scale) {\r\n        this._current_scale = scale;\r\n        this.notes_pitches = LGMIDIGenerator.processScale(scale);\r\n        for (var i = 0; i < 12; ++i) {\r\n            this.valid_notes[i] = this.notes_pitches.indexOf(i) != -1;\r\n        }\r\n        for (var i = 0; i < 12; ++i) {\r\n            if (this.valid_notes[i]) {\r\n                this.offset_notes[i] = 0;\r\n                continue;\r\n            }\r\n            for (var j = 1; j < 12; ++j) {\r\n                if (this.valid_notes[(i - j) % 12]) {\r\n                    this.offset_notes[i] = -j;\r\n                    break;\r\n                }\r\n                if (this.valid_notes[(i + j) % 12]) {\r\n                    this.offset_notes[i] = j;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    LGMIDIQuantize.prototype.onAction = function(event, midi_event) {\r\n        if (!midi_event || midi_event.constructor !== MIDIEvent) {\r\n            return;\r\n        }\r\n\r\n        if (\r\n            midi_event.data[0] == MIDIEvent.NOTEON ||\r\n            midi_event.data[0] == MIDIEvent.NOTEOFF\r\n        ) {\r\n            this.midi_event = new MIDIEvent();\r\n            this.midi_event.setup(midi_event.data);\r\n            var note = midi_event.note;\r\n            var index = MIDIEvent.note_to_index[note];\r\n            var offset = this.offset_notes[index];\r\n            this.midi_event.data[1] += offset;\r\n            this.trigger(\"out\", this.midi_event);\r\n        } else {\r\n            this.trigger(\"out\", midi_event);\r\n        }\r\n    };\r\n\r\n    LGMIDIQuantize.prototype.onExecute = function() {\r\n        var scale = this.getInputData(1);\r\n        if (scale != null && scale != this._current_scale) {\r\n            this.processScale(scale);\r\n        }\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/quantize\", LGMIDIQuantize);\r\n\r\n\tfunction LGMIDIFromFile() {\r\n        this.properties = {\r\n            url: \"\",\r\n\t\t\tautoplay: true\r\n        };\r\n\r\n        this.addInput(\"play\", LiteGraph.ACTION);\r\n        this.addInput(\"pause\", LiteGraph.ACTION);\r\n        this.addOutput(\"note\", LiteGraph.EVENT);\r\n\t\tthis._midi = null;\r\n\t\tthis._current_time = 0;\r\n\t\tthis._playing = false;\r\n\r\n        if (typeof MidiParser == \"undefined\") {\r\n            console.error(\r\n                \"midi-parser.js not included, LGMidiPlay requires that library: https://raw.githubusercontent.com/colxi/midi-parser-js/master/src/main.js\"\r\n            );\r\n            this.boxcolor = \"red\";\r\n\t\t}\r\n\r\n\t}\r\n\r\n    LGMIDIFromFile.title = \"MIDI fromFile\";\r\n    LGMIDIFromFile.desc = \"Plays a MIDI file\";\r\n    LGMIDIFromFile.color = MIDI_COLOR;\r\n\r\n\tLGMIDIFromFile.prototype.onAction = function( name )\r\n\t{\r\n\t\tif(name == \"play\")\r\n\t\t\tthis.play();\r\n\t\telse if(name == \"pause\")\r\n\t\t\tthis._playing = !this._playing;\r\n\t}\r\n\r\n\tLGMIDIFromFile.prototype.onPropertyChanged = function(name,value)\r\n\t{\r\n\t\tif(name == \"url\")\r\n\t\t\tthis.loadMIDIFile(value);\r\n\t}\r\n\r\n    LGMIDIFromFile.prototype.onExecute = function() {\r\n\t\tif(!this._midi)\r\n\t\t\treturn;\r\n\r\n\t\tif(!this._playing)\r\n\t\t\treturn;\r\n\r\n\t\tthis._current_time += this.graph.elapsed_time;\r\n\t\tvar current_time = this._current_time * 100;\r\n\r\n\t\tfor(var i = 0; i < this._midi.tracks; ++i)\r\n\t\t{\r\n\t\t\tvar track = this._midi.track[i];\r\n\t\t\tif(!track._last_pos)\r\n\t\t\t{\r\n\t\t\t\ttrack._last_pos = 0;\r\n\t\t\t\ttrack._time = 0;\r\n\t\t\t}\r\n\r\n\t\t\tvar elem = track.event[ track._last_pos ];\r\n\t\t\tif(elem && (track._time + elem.deltaTime) <= current_time )\r\n\t\t\t{\r\n\t\t\t\ttrack._last_pos++;\r\n\t\t\t\ttrack._time += elem.deltaTime;\r\n\r\n\t\t\t\tif(elem.data)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar midi_cmd = elem.type << 4 + elem.channel;\r\n\t\t\t\t\tvar midi_event = new MIDIEvent();\r\n\t\t\t\t\tmidi_event.setup([midi_cmd, elem.data[0], elem.data[1]]);\r\n\t\t\t\t\tthis.trigger(\"note\", midi_event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n    };\r\n\r\n\tLGMIDIFromFile.prototype.play = function()\r\n\t{\r\n\t\tthis._playing = true;\r\n\t\tthis._current_time = 0;\r\n\t\tif(!this._midi)\r\n\t\t\treturn;\r\n\r\n\t\tfor(var i = 0; i < this._midi.tracks; ++i)\r\n\t\t{\r\n\t\t\tvar track = this._midi.track[i];\r\n\t\t\ttrack._last_pos = 0;\r\n\t\t\ttrack._time = 0;\r\n\t\t}\t\t\r\n\t}\r\n\r\n\tLGMIDIFromFile.prototype.loadMIDIFile = function(url)\r\n\t{\r\n\t\tvar that = this;\r\n\t\tLiteGraph.fetchFile( url, \"arraybuffer\", function(data)\r\n\t\t{\r\n\t\t\tthat.boxcolor = \"#AFA\";\r\n\t\t\tthat._midi = MidiParser.parse( new Uint8Array(data) );\r\n\t\t\tif(that.properties.autoplay)\r\n\t\t\t\tthat.play();\r\n\t\t}, function(err){\r\n\t\t\tthat.boxcolor = \"#FAA\";\r\n\t\t\tthat._midi = null;\r\n\t\t});\r\n\t}\r\n\r\n\tLGMIDIFromFile.prototype.onDropFile = function(file)\r\n\t{\r\n\t\tthis.properties.url = \"\";\r\n\t\tthis.loadMIDIFile( file );\r\n\t}\r\n\r\n    LiteGraph.registerNodeType(\"midi/fromFile\", LGMIDIFromFile);\r\n\r\n\r\n    function LGMIDIPlay() {\r\n        this.properties = {\r\n            volume: 0.5,\r\n            duration: 1\r\n        };\r\n        this.addInput(\"note\", LiteGraph.ACTION);\r\n        this.addInput(\"volume\", \"number\");\r\n        this.addInput(\"duration\", \"number\");\r\n        this.addOutput(\"note\", LiteGraph.EVENT);\r\n\r\n        if (typeof AudioSynth == \"undefined\") {\r\n            console.error(\r\n                \"Audiosynth.js not included, LGMidiPlay requires that library\"\r\n            );\r\n            this.boxcolor = \"red\";\r\n        } else {\r\n            var Synth = (this.synth = new AudioSynth());\r\n            this.instrument = Synth.createInstrument(\"piano\");\r\n        }\r\n    }\r\n\r\n    LGMIDIPlay.title = \"MIDI Play\";\r\n    LGMIDIPlay.desc = \"Plays a MIDI note\";\r\n    LGMIDIPlay.color = MIDI_COLOR;\r\n\r\n    LGMIDIPlay.prototype.onAction = function(event, midi_event) {\r\n        if (!midi_event || midi_event.constructor !== MIDIEvent) {\r\n            return;\r\n        }\r\n\r\n        if (this.instrument && midi_event.data[0] == MIDIEvent.NOTEON) {\r\n            var note = midi_event.note; //C#\r\n            if (!note || note == \"undefined\" || note.constructor !== String) {\r\n                return;\r\n            }\r\n            this.instrument.play(\r\n                note,\r\n                midi_event.octave,\r\n                this.properties.duration,\r\n                this.properties.volume\r\n            );\r\n        }\r\n        this.trigger(\"note\", midi_event);\r\n    };\r\n\r\n    LGMIDIPlay.prototype.onExecute = function() {\r\n        var volume = this.getInputData(1);\r\n        if (volume != null) {\r\n            this.properties.volume = volume;\r\n        }\r\n\r\n        var duration = this.getInputData(2);\r\n        if (duration != null) {\r\n            this.properties.duration = duration;\r\n        }\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/play\", LGMIDIPlay);\r\n\r\n    function LGMIDIKeys() {\r\n        this.properties = {\r\n            num_octaves: 2,\r\n            start_octave: 2\r\n        };\r\n        this.addInput(\"note\", LiteGraph.ACTION);\r\n        this.addInput(\"reset\", LiteGraph.ACTION);\r\n        this.addOutput(\"note\", LiteGraph.EVENT);\r\n        this.size = [400, 100];\r\n        this.keys = [];\r\n        this._last_key = -1;\r\n    }\r\n\r\n    LGMIDIKeys.title = \"MIDI Keys\";\r\n    LGMIDIKeys.desc = \"Keyboard to play notes\";\r\n    LGMIDIKeys.color = MIDI_COLOR;\r\n\r\n    LGMIDIKeys.keys = [\r\n        { x: 0, w: 1, h: 1, t: 0 },\r\n        { x: 0.75, w: 0.5, h: 0.6, t: 1 },\r\n        { x: 1, w: 1, h: 1, t: 0 },\r\n        { x: 1.75, w: 0.5, h: 0.6, t: 1 },\r\n        { x: 2, w: 1, h: 1, t: 0 },\r\n        { x: 2.75, w: 0.5, h: 0.6, t: 1 },\r\n        { x: 3, w: 1, h: 1, t: 0 },\r\n        { x: 4, w: 1, h: 1, t: 0 },\r\n        { x: 4.75, w: 0.5, h: 0.6, t: 1 },\r\n        { x: 5, w: 1, h: 1, t: 0 },\r\n        { x: 5.75, w: 0.5, h: 0.6, t: 1 },\r\n        { x: 6, w: 1, h: 1, t: 0 }\r\n    ];\r\n\r\n    LGMIDIKeys.prototype.onDrawForeground = function(ctx) {\r\n        if (this.flags.collapsed) {\r\n            return;\r\n        }\r\n\r\n        var num_keys = this.properties.num_octaves * 12;\r\n        this.keys.length = num_keys;\r\n        var key_width = this.size[0] / (this.properties.num_octaves * 7);\r\n        var key_height = this.size[1];\r\n\r\n        ctx.globalAlpha = 1;\r\n\r\n        for (\r\n            var k = 0;\r\n            k < 2;\r\n            k++ //draw first whites (0) then blacks (1)\r\n        ) {\r\n            for (var i = 0; i < num_keys; ++i) {\r\n                var key_info = LGMIDIKeys.keys[i % 12];\r\n                if (key_info.t != k) {\r\n                    continue;\r\n                }\r\n                var octave = Math.floor(i / 12);\r\n                var x = octave * 7 * key_width + key_info.x * key_width;\r\n                if (k == 0) {\r\n                    ctx.fillStyle = this.keys[i] ? \"#CCC\" : \"white\";\r\n                } else {\r\n                    ctx.fillStyle = this.keys[i] ? \"#333\" : \"black\";\r\n                }\r\n                ctx.fillRect(\r\n                    x + 1,\r\n                    0,\r\n                    key_width * key_info.w - 2,\r\n                    key_height * key_info.h\r\n                );\r\n            }\r\n        }\r\n    };\r\n\r\n    LGMIDIKeys.prototype.getKeyIndex = function(pos) {\r\n        var num_keys = this.properties.num_octaves * 12;\r\n        var key_width = this.size[0] / (this.properties.num_octaves * 7);\r\n        var key_height = this.size[1];\r\n\r\n        for (\r\n            var k = 1;\r\n            k >= 0;\r\n            k-- //test blacks first (1) then whites (0)\r\n        ) {\r\n            for (var i = 0; i < this.keys.length; ++i) {\r\n                var key_info = LGMIDIKeys.keys[i % 12];\r\n                if (key_info.t != k) {\r\n                    continue;\r\n                }\r\n                var octave = Math.floor(i / 12);\r\n                var x = octave * 7 * key_width + key_info.x * key_width;\r\n                var w = key_width * key_info.w;\r\n                var h = key_height * key_info.h;\r\n                if (pos[0] < x || pos[0] > x + w || pos[1] > h) {\r\n                    continue;\r\n                }\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    };\r\n\r\n    LGMIDIKeys.prototype.onAction = function(event, params) {\r\n        if (event == \"reset\") {\r\n            for (var i = 0; i < this.keys.length; ++i) {\r\n                this.keys[i] = false;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (!params || params.constructor !== MIDIEvent) {\r\n            return;\r\n        }\r\n        var midi_event = params;\r\n        var start_note = (this.properties.start_octave - 1) * 12 + 29;\r\n        var index = midi_event.data[1] - start_note;\r\n        if (index >= 0 && index < this.keys.length) {\r\n            if (midi_event.data[0] == MIDIEvent.NOTEON) {\r\n                this.keys[index] = true;\r\n            } else if (midi_event.data[0] == MIDIEvent.NOTEOFF) {\r\n                this.keys[index] = false;\r\n            }\r\n        }\r\n\r\n        this.trigger(\"note\", midi_event);\r\n    };\r\n\r\n    LGMIDIKeys.prototype.onMouseDown = function(e, pos) {\r\n        if (pos[1] < 0) {\r\n            return;\r\n        }\r\n        var index = this.getKeyIndex(pos);\r\n        this.keys[index] = true;\r\n        this._last_key = index;\r\n        var pitch = (this.properties.start_octave - 1) * 12 + 29 + index;\r\n        var midi_event = new MIDIEvent();\r\n        midi_event.setup([MIDIEvent.NOTEON, pitch, 100]);\r\n        this.trigger(\"note\", midi_event);\r\n        return true;\r\n    };\r\n\r\n    LGMIDIKeys.prototype.onMouseMove = function(e, pos) {\r\n        if (pos[1] < 0 || this._last_key == -1) {\r\n            return;\r\n        }\r\n        this.setDirtyCanvas(true);\r\n        var index = this.getKeyIndex(pos);\r\n        if (this._last_key == index) {\r\n            return true;\r\n        }\r\n        this.keys[this._last_key] = false;\r\n        var pitch =\r\n            (this.properties.start_octave - 1) * 12 + 29 + this._last_key;\r\n        var midi_event = new MIDIEvent();\r\n        midi_event.setup([MIDIEvent.NOTEOFF, pitch, 100]);\r\n        this.trigger(\"note\", midi_event);\r\n\r\n        this.keys[index] = true;\r\n        var pitch = (this.properties.start_octave - 1) * 12 + 29 + index;\r\n        var midi_event = new MIDIEvent();\r\n        midi_event.setup([MIDIEvent.NOTEON, pitch, 100]);\r\n        this.trigger(\"note\", midi_event);\r\n\r\n        this._last_key = index;\r\n        return true;\r\n    };\r\n\r\n    LGMIDIKeys.prototype.onMouseUp = function(e, pos) {\r\n        if (pos[1] < 0) {\r\n            return;\r\n        }\r\n        var index = this.getKeyIndex(pos);\r\n        this.keys[index] = false;\r\n        this._last_key = -1;\r\n        var pitch = (this.properties.start_octave - 1) * 12 + 29 + index;\r\n        var midi_event = new MIDIEvent();\r\n        midi_event.setup([MIDIEvent.NOTEOFF, pitch, 100]);\r\n        this.trigger(\"note\", midi_event);\r\n        return true;\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"midi/keys\", LGMIDIKeys);\r\n\r\n    function now() {\r\n        return window.performance.now();\r\n    }\r\n})(this);\r\n\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n    var LGAudio = {};\r\n    global.LGAudio = LGAudio;\r\n\r\n    LGAudio.getAudioContext = function() {\r\n        if (!this._audio_context) {\r\n            window.AudioContext =\r\n                window.AudioContext || window.webkitAudioContext;\r\n            if (!window.AudioContext) {\r\n                console.error(\"AudioContext not supported by browser\");\r\n                return null;\r\n            }\r\n            this._audio_context = new AudioContext();\r\n            this._audio_context.onmessage = function(msg) {\r\n                console.log(\"msg\", msg);\r\n            };\r\n            this._audio_context.onended = function(msg) {\r\n                console.log(\"ended\", msg);\r\n            };\r\n            this._audio_context.oncomplete = function(msg) {\r\n                console.log(\"complete\", msg);\r\n            };\r\n        }\r\n\r\n        //in case it crashes\r\n        //if(this._audio_context.state == \"suspended\")\r\n        //\tthis._audio_context.resume();\r\n        return this._audio_context;\r\n    };\r\n\r\n    LGAudio.connect = function(audionodeA, audionodeB) {\r\n        try {\r\n            audionodeA.connect(audionodeB);\r\n        } catch (err) {\r\n            console.warn(\"LGraphAudio:\", err);\r\n        }\r\n    };\r\n\r\n    LGAudio.disconnect = function(audionodeA, audionodeB) {\r\n        try {\r\n            audionodeA.disconnect(audionodeB);\r\n        } catch (err) {\r\n            console.warn(\"LGraphAudio:\", err);\r\n        }\r\n    };\r\n\r\n    LGAudio.changeAllAudiosConnections = function(node, connect) {\r\n        if (node.inputs) {\r\n            for (var i = 0; i < node.inputs.length; ++i) {\r\n                var input = node.inputs[i];\r\n                var link_info = node.graph.links[input.link];\r\n                if (!link_info) {\r\n                    continue;\r\n                }\r\n\r\n                var origin_node = node.graph.getNodeById(link_info.origin_id);\r\n                var origin_audionode = null;\r\n                if (origin_node.getAudioNodeInOutputSlot) {\r\n                    origin_audionode = origin_node.getAudioNodeInOutputSlot(\r\n                        link_info.origin_slot\r\n                    );\r\n                } else {\r\n                    origin_audionode = origin_node.audionode;\r\n                }\r\n\r\n                var target_audionode = null;\r\n                if (node.getAudioNodeInInputSlot) {\r\n                    target_audionode = node.getAudioNodeInInputSlot(i);\r\n                } else {\r\n                    target_audionode = node.audionode;\r\n                }\r\n\r\n                if (connect) {\r\n                    LGAudio.connect(origin_audionode, target_audionode);\r\n                } else {\r\n                    LGAudio.disconnect(origin_audionode, target_audionode);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (node.outputs) {\r\n            for (var i = 0; i < node.outputs.length; ++i) {\r\n                var output = node.outputs[i];\r\n                for (var j = 0; j < output.links.length; ++j) {\r\n                    var link_info = node.graph.links[output.links[j]];\r\n                    if (!link_info) {\r\n                        continue;\r\n                    }\r\n\r\n                    var origin_audionode = null;\r\n                    if (node.getAudioNodeInOutputSlot) {\r\n                        origin_audionode = node.getAudioNodeInOutputSlot(i);\r\n                    } else {\r\n                        origin_audionode = node.audionode;\r\n                    }\r\n\r\n                    var target_node = node.graph.getNodeById(\r\n                        link_info.target_id\r\n                    );\r\n                    var target_audionode = null;\r\n                    if (target_node.getAudioNodeInInputSlot) {\r\n                        target_audionode = target_node.getAudioNodeInInputSlot(\r\n                            link_info.target_slot\r\n                        );\r\n                    } else {\r\n                        target_audionode = target_node.audionode;\r\n                    }\r\n\r\n                    if (connect) {\r\n                        LGAudio.connect(origin_audionode, target_audionode);\r\n                    } else {\r\n                        LGAudio.disconnect(origin_audionode, target_audionode);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    //used by many nodes\r\n    LGAudio.onConnectionsChange = function(\r\n        connection,\r\n        slot,\r\n        connected,\r\n        link_info\r\n    ) {\r\n        //only process the outputs events\r\n        if (connection != LiteGraph.OUTPUT) {\r\n            return;\r\n        }\r\n\r\n        var target_node = null;\r\n        if (link_info) {\r\n            target_node = this.graph.getNodeById(link_info.target_id);\r\n        }\r\n\r\n        if (!target_node) {\r\n            return;\r\n        }\r\n\r\n        //get origin audionode\r\n        var local_audionode = null;\r\n        if (this.getAudioNodeInOutputSlot) {\r\n            local_audionode = this.getAudioNodeInOutputSlot(slot);\r\n        } else {\r\n            local_audionode = this.audionode;\r\n        }\r\n\r\n        //get target audionode\r\n        var target_audionode = null;\r\n        if (target_node.getAudioNodeInInputSlot) {\r\n            target_audionode = target_node.getAudioNodeInInputSlot(\r\n                link_info.target_slot\r\n            );\r\n        } else {\r\n            target_audionode = target_node.audionode;\r\n        }\r\n\r\n        //do the connection/disconnection\r\n        if (connected) {\r\n            LGAudio.connect(local_audionode, target_audionode);\r\n        } else {\r\n            LGAudio.disconnect(local_audionode, target_audionode);\r\n        }\r\n    };\r\n\r\n    //this function helps creating wrappers to existing classes\r\n    LGAudio.createAudioNodeWrapper = function(class_object) {\r\n        var old_func = class_object.prototype.onPropertyChanged;\r\n\r\n        class_object.prototype.onPropertyChanged = function(name, value) {\r\n            if (old_func) {\r\n                old_func.call(this, name, value);\r\n            }\r\n\r\n            if (!this.audionode) {\r\n                return;\r\n            }\r\n\r\n            if (this.audionode[name] === undefined) {\r\n                return;\r\n            }\r\n\r\n            if (this.audionode[name].value !== undefined) {\r\n                this.audionode[name].value = value;\r\n            } else {\r\n                this.audionode[name] = value;\r\n            }\r\n        };\r\n\r\n        class_object.prototype.onConnectionsChange =\r\n            LGAudio.onConnectionsChange;\r\n    };\r\n\r\n    //contains the samples decoded of the loaded audios in AudioBuffer format\r\n    LGAudio.cached_audios = {};\r\n\r\n    LGAudio.loadSound = function(url, on_complete, on_error) {\r\n        if (LGAudio.cached_audios[url] && url.indexOf(\"blob:\") == -1) {\r\n            if (on_complete) {\r\n                on_complete(LGAudio.cached_audios[url]);\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (LGAudio.onProcessAudioURL) {\r\n            url = LGAudio.onProcessAudioURL(url);\r\n        }\r\n\r\n        //load new sample\r\n        var request = new XMLHttpRequest();\r\n        request.open(\"GET\", url, true);\r\n        request.responseType = \"arraybuffer\";\r\n\r\n        var context = LGAudio.getAudioContext();\r\n\r\n        // Decode asynchronously\r\n        request.onload = function() {\r\n            console.log(\"AudioSource loaded\");\r\n            context.decodeAudioData(\r\n                request.response,\r\n                function(buffer) {\r\n                    console.log(\"AudioSource decoded\");\r\n                    LGAudio.cached_audios[url] = buffer;\r\n                    if (on_complete) {\r\n                        on_complete(buffer);\r\n                    }\r\n                },\r\n                onError\r\n            );\r\n        };\r\n        request.send();\r\n\r\n        function onError(err) {\r\n            console.log(\"Audio loading sample error:\", err);\r\n            if (on_error) {\r\n                on_error(err);\r\n            }\r\n        }\r\n\r\n        return request;\r\n    };\r\n\r\n    //****************************************************\r\n\r\n    function LGAudioSource() {\r\n        this.properties = {\r\n            src: \"\",\r\n            gain: 0.5,\r\n            loop: true,\r\n            autoplay: true,\r\n            playbackRate: 1\r\n        };\r\n\r\n        this._loading_audio = false;\r\n        this._audiobuffer = null; //points to AudioBuffer with the audio samples decoded\r\n        this._audionodes = [];\r\n        this._last_sourcenode = null; //the last AudioBufferSourceNode (there could be more if there are several sounds playing)\r\n\r\n        this.addOutput(\"out\", \"audio\");\r\n        this.addInput(\"gain\", \"number\");\r\n\r\n        //init context\r\n        var context = LGAudio.getAudioContext();\r\n\r\n        //create gain node to control volume\r\n        this.audionode = context.createGain();\r\n        this.audionode.graphnode = this;\r\n        this.audionode.gain.value = this.properties.gain;\r\n\r\n        //debug\r\n        if (this.properties.src) {\r\n            this.loadSound(this.properties.src);\r\n        }\r\n    }\r\n\r\n\tLGAudioSource.desc = \"Plays an audio file\";\r\n    LGAudioSource[\"@src\"] = { widget: \"resource\" };\r\n    LGAudioSource.supported_extensions = [\"wav\", \"ogg\", \"mp3\"];\r\n\r\n    LGAudioSource.prototype.onAdded = function(graph) {\r\n        if (graph.status === LGraph.STATUS_RUNNING) {\r\n            this.onStart();\r\n        }\r\n    };\r\n\r\n    LGAudioSource.prototype.onStart = function() {\r\n        if (!this._audiobuffer) {\r\n            return;\r\n        }\r\n\r\n        if (this.properties.autoplay) {\r\n\t\t\tthis.playBuffer(this._audiobuffer);\r\n        }\r\n    };\r\n\r\n    LGAudioSource.prototype.onStop = function() {\r\n        this.stopAllSounds();\r\n    };\r\n\r\n    LGAudioSource.prototype.onPause = function() {\r\n        this.pauseAllSounds();\r\n    };\r\n\r\n    LGAudioSource.prototype.onUnpause = function() {\r\n        this.unpauseAllSounds();\r\n        //this.onStart();\r\n    };\r\n\r\n    LGAudioSource.prototype.onRemoved = function() {\r\n        this.stopAllSounds();\r\n        if (this._dropped_url) {\r\n            URL.revokeObjectURL(this._url);\r\n        }\r\n    };\r\n\r\n    LGAudioSource.prototype.stopAllSounds = function() {\r\n        //iterate and stop\r\n        for (var i = 0; i < this._audionodes.length; ++i) {\r\n            if (this._audionodes[i].started) {\r\n                this._audionodes[i].started = false;\r\n                this._audionodes[i].stop();\r\n            }\r\n            //this._audionodes[i].disconnect( this.audionode );\r\n        }\r\n        this._audionodes.length = 0;\r\n    };\r\n\r\n    LGAudioSource.prototype.pauseAllSounds = function() {\r\n        LGAudio.getAudioContext().suspend();\r\n    };\r\n\r\n    LGAudioSource.prototype.unpauseAllSounds = function() {\r\n        LGAudio.getAudioContext().resume();\r\n    };\r\n\r\n    LGAudioSource.prototype.onExecute = function() {\r\n        if (this.inputs) {\r\n            for (var i = 0; i < this.inputs.length; ++i) {\r\n                var input = this.inputs[i];\r\n                if (input.link == null) {\r\n                    continue;\r\n                }\r\n                var v = this.getInputData(i);\r\n                if (v === undefined) {\r\n                    continue;\r\n                }\r\n                if (input.name == \"gain\")\r\n                    this.audionode.gain.value = v;\r\n                else if (input.name == \"src\") {\r\n                    this.setProperty(\"src\",v);\r\n                } else if (input.name == \"playbackRate\") {\r\n                    this.properties.playbackRate = v;\r\n                    for (var j = 0; j < this._audionodes.length; ++j) {\r\n                        this._audionodes[j].playbackRate.value = v;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this.outputs) {\r\n            for (var i = 0; i < this.outputs.length; ++i) {\r\n                var output = this.outputs[i];\r\n                if (output.name == \"buffer\" && this._audiobuffer) {\r\n                    this.setOutputData(i, this._audiobuffer);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioSource.prototype.onAction = function(event) {\r\n        if (this._audiobuffer) {\r\n            if (event == \"Play\") {\r\n                this.playBuffer(this._audiobuffer);\r\n            } else if (event == \"Stop\") {\r\n                this.stopAllSounds();\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioSource.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"src\") {\r\n            this.loadSound(value);\r\n        } else if (name == \"gain\") {\r\n            this.audionode.gain.value = value;\r\n        } else if (name == \"playbackRate\") {\r\n            for (var j = 0; j < this._audionodes.length; ++j) {\r\n                this._audionodes[j].playbackRate.value = value;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioSource.prototype.playBuffer = function(buffer) {\r\n        var that = this;\r\n        var context = LGAudio.getAudioContext();\r\n\r\n        //create a new audionode (this is mandatory, AudioAPI doesnt like to reuse old ones)\r\n        var audionode = context.createBufferSource(); //create a AudioBufferSourceNode\r\n        this._last_sourcenode = audionode;\r\n        audionode.graphnode = this;\r\n        audionode.buffer = buffer;\r\n        audionode.loop = this.properties.loop;\r\n        audionode.playbackRate.value = this.properties.playbackRate;\r\n        this._audionodes.push(audionode);\r\n        audionode.connect(this.audionode); //connect to gain\r\n\r\n\t\tthis._audionodes.push(audionode);\r\n\r\n\t\tthis.trigger(\"start\");\r\n\r\n        audionode.onended = function() {\r\n            //console.log(\"ended!\");\r\n            that.trigger(\"ended\");\r\n            //remove\r\n            var index = that._audionodes.indexOf(audionode);\r\n            if (index != -1) {\r\n                that._audionodes.splice(index, 1);\r\n            }\r\n        };\r\n\r\n        if (!audionode.started) {\r\n            audionode.started = true;\r\n            audionode.start();\r\n        }\r\n        return audionode;\r\n    };\r\n\r\n    LGAudioSource.prototype.loadSound = function(url) {\r\n        var that = this;\r\n\r\n        //kill previous load\r\n        if (this._request) {\r\n            this._request.abort();\r\n            this._request = null;\r\n        }\r\n\r\n        this._audiobuffer = null; //points to the audiobuffer once the audio is loaded\r\n        this._loading_audio = false;\r\n\r\n        if (!url) {\r\n            return;\r\n        }\r\n\r\n        this._request = LGAudio.loadSound(url, inner);\r\n\r\n        this._loading_audio = true;\r\n        this.boxcolor = \"#AA4\";\r\n\r\n        function inner(buffer) {\r\n            this.boxcolor = LiteGraph.NODE_DEFAULT_BOXCOLOR;\r\n            that._audiobuffer = buffer;\r\n            that._loading_audio = false;\r\n            //if is playing, then play it\r\n            if (that.graph && that.graph.status === LGraph.STATUS_RUNNING) {\r\n                that.onStart();\r\n            } //this controls the autoplay already\r\n        }\r\n    };\r\n\r\n    //Helps connect/disconnect AudioNodes when new connections are made in the node\r\n    LGAudioSource.prototype.onConnectionsChange = LGAudio.onConnectionsChange;\r\n\r\n    LGAudioSource.prototype.onGetInputs = function() {\r\n        return [\r\n            [\"playbackRate\", \"number\"],\r\n\t\t\t[\"src\",\"string\"],\r\n            [\"Play\", LiteGraph.ACTION],\r\n            [\"Stop\", LiteGraph.ACTION]\r\n        ];\r\n    };\r\n\r\n    LGAudioSource.prototype.onGetOutputs = function() {\r\n        return [[\"buffer\", \"audiobuffer\"], [\"start\", LiteGraph.EVENT], [\"ended\", LiteGraph.EVENT]];\r\n    };\r\n\r\n    LGAudioSource.prototype.onDropFile = function(file) {\r\n        if (this._dropped_url) {\r\n            URL.revokeObjectURL(this._dropped_url);\r\n        }\r\n        var url = URL.createObjectURL(file);\r\n        this.properties.src = url;\r\n        this.loadSound(url);\r\n        this._dropped_url = url;\r\n    };\r\n\r\n    LGAudioSource.title = \"Source\";\r\n    LGAudioSource.desc = \"Plays audio\";\r\n    LiteGraph.registerNodeType(\"audio/source\", LGAudioSource);\r\n\r\n    //****************************************************\r\n\r\n    function LGAudioMediaSource() {\r\n        this.properties = {\r\n            gain: 0.5\r\n        };\r\n\r\n        this._audionodes = [];\r\n        this._media_stream = null;\r\n\r\n        this.addOutput(\"out\", \"audio\");\r\n        this.addInput(\"gain\", \"number\");\r\n\r\n        //create gain node to control volume\r\n        var context = LGAudio.getAudioContext();\r\n        this.audionode = context.createGain();\r\n        this.audionode.graphnode = this;\r\n        this.audionode.gain.value = this.properties.gain;\r\n    }\r\n\r\n    LGAudioMediaSource.prototype.onAdded = function(graph) {\r\n        if (graph.status === LGraph.STATUS_RUNNING) {\r\n            this.onStart();\r\n        }\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onStart = function() {\r\n        if (this._media_stream == null && !this._waiting_confirmation) {\r\n            this.openStream();\r\n        }\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onStop = function() {\r\n        this.audionode.gain.value = 0;\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onPause = function() {\r\n        this.audionode.gain.value = 0;\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onUnpause = function() {\r\n        this.audionode.gain.value = this.properties.gain;\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onRemoved = function() {\r\n        this.audionode.gain.value = 0;\r\n        if (this.audiosource_node) {\r\n            this.audiosource_node.disconnect(this.audionode);\r\n            this.audiosource_node = null;\r\n        }\r\n        if (this._media_stream) {\r\n            var tracks = this._media_stream.getTracks();\r\n            if (tracks.length) {\r\n                tracks[0].stop();\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.openStream = function() {\r\n        if (!navigator.mediaDevices) {\r\n            console.log(\r\n                \"getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags\"\r\n            );\r\n            return;\r\n        }\r\n\r\n        this._waiting_confirmation = true;\r\n\r\n        // Not showing vendor prefixes.\r\n        navigator.mediaDevices\r\n            .getUserMedia({ audio: true, video: false })\r\n            .then(this.streamReady.bind(this))\r\n            .catch(onFailSoHard);\r\n\r\n        var that = this;\r\n        function onFailSoHard(err) {\r\n            console.log(\"Media rejected\", err);\r\n            that._media_stream = false;\r\n            that.boxcolor = \"red\";\r\n        }\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.streamReady = function(localMediaStream) {\r\n        this._media_stream = localMediaStream;\r\n        //this._waiting_confirmation = false;\r\n\r\n        //init context\r\n        if (this.audiosource_node) {\r\n            this.audiosource_node.disconnect(this.audionode);\r\n        }\r\n        var context = LGAudio.getAudioContext();\r\n        this.audiosource_node = context.createMediaStreamSource(\r\n            localMediaStream\r\n        );\r\n        this.audiosource_node.graphnode = this;\r\n        this.audiosource_node.connect(this.audionode);\r\n        this.boxcolor = \"white\";\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onExecute = function() {\r\n        if (this._media_stream == null && !this._waiting_confirmation) {\r\n            this.openStream();\r\n        }\r\n\r\n        if (this.inputs) {\r\n            for (var i = 0; i < this.inputs.length; ++i) {\r\n                var input = this.inputs[i];\r\n                if (input.link == null) {\r\n                    continue;\r\n                }\r\n                var v = this.getInputData(i);\r\n                if (v === undefined) {\r\n                    continue;\r\n                }\r\n                if (input.name == \"gain\") {\r\n                    this.audionode.gain.value = this.properties.gain = v;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onAction = function(event) {\r\n        if (event == \"Play\") {\r\n            this.audionode.gain.value = this.properties.gain;\r\n        } else if (event == \"Stop\") {\r\n            this.audionode.gain.value = 0;\r\n        }\r\n    };\r\n\r\n    LGAudioMediaSource.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"gain\") {\r\n            this.audionode.gain.value = value;\r\n        }\r\n    };\r\n\r\n    //Helps connect/disconnect AudioNodes when new connections are made in the node\r\n    LGAudioMediaSource.prototype.onConnectionsChange =\r\n        LGAudio.onConnectionsChange;\r\n\r\n    LGAudioMediaSource.prototype.onGetInputs = function() {\r\n        return [\r\n            [\"playbackRate\", \"number\"],\r\n            [\"Play\", LiteGraph.ACTION],\r\n            [\"Stop\", LiteGraph.ACTION]\r\n        ];\r\n    };\r\n\r\n    LGAudioMediaSource.title = \"MediaSource\";\r\n    LGAudioMediaSource.desc = \"Plays microphone\";\r\n    LiteGraph.registerNodeType(\"audio/media_source\", LGAudioMediaSource);\r\n\r\n    //*****************************************************\r\n\r\n    function LGAudioAnalyser() {\r\n        this.properties = {\r\n            fftSize: 2048,\r\n            minDecibels: -100,\r\n            maxDecibels: -10,\r\n            smoothingTimeConstant: 0.5\r\n        };\r\n\r\n        var context = LGAudio.getAudioContext();\r\n\r\n        this.audionode = context.createAnalyser();\r\n        this.audionode.graphnode = this;\r\n        this.audionode.fftSize = this.properties.fftSize;\r\n        this.audionode.minDecibels = this.properties.minDecibels;\r\n        this.audionode.maxDecibels = this.properties.maxDecibels;\r\n        this.audionode.smoothingTimeConstant = this.properties.smoothingTimeConstant;\r\n\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addOutput(\"freqs\", \"array\");\r\n        this.addOutput(\"samples\", \"array\");\r\n\r\n        this._freq_bin = null;\r\n        this._time_bin = null;\r\n    }\r\n\r\n    LGAudioAnalyser.prototype.onPropertyChanged = function(name, value) {\r\n        this.audionode[name] = value;\r\n    };\r\n\r\n    LGAudioAnalyser.prototype.onExecute = function() {\r\n        if (this.isOutputConnected(0)) {\r\n            //send FFT\r\n            var bufferLength = this.audionode.frequencyBinCount;\r\n            if (!this._freq_bin || this._freq_bin.length != bufferLength) {\r\n                this._freq_bin = new Uint8Array(bufferLength);\r\n            }\r\n            this.audionode.getByteFrequencyData(this._freq_bin);\r\n            this.setOutputData(0, this._freq_bin);\r\n        }\r\n\r\n        //send analyzer\r\n        if (this.isOutputConnected(1)) {\r\n            //send Samples\r\n            var bufferLength = this.audionode.frequencyBinCount;\r\n            if (!this._time_bin || this._time_bin.length != bufferLength) {\r\n                this._time_bin = new Uint8Array(bufferLength);\r\n            }\r\n            this.audionode.getByteTimeDomainData(this._time_bin);\r\n            this.setOutputData(1, this._time_bin);\r\n        }\r\n\r\n        //properties\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var input = this.inputs[i];\r\n            if (input.link == null) {\r\n                continue;\r\n            }\r\n            var v = this.getInputData(i);\r\n            if (v !== undefined) {\r\n                this.audionode[input.name].value = v;\r\n            }\r\n        }\r\n\r\n        //time domain\r\n        //this.audionode.getFloatTimeDomainData( dataArray );\r\n    };\r\n\r\n    LGAudioAnalyser.prototype.onGetInputs = function() {\r\n        return [\r\n            [\"minDecibels\", \"number\"],\r\n            [\"maxDecibels\", \"number\"],\r\n            [\"smoothingTimeConstant\", \"number\"]\r\n        ];\r\n    };\r\n\r\n    LGAudioAnalyser.prototype.onGetOutputs = function() {\r\n        return [[\"freqs\", \"array\"], [\"samples\", \"array\"]];\r\n    };\r\n\r\n    LGAudioAnalyser.title = \"Analyser\";\r\n    LGAudioAnalyser.desc = \"Audio Analyser\";\r\n    LiteGraph.registerNodeType(\"audio/analyser\", LGAudioAnalyser);\r\n\r\n    //*****************************************************\r\n\r\n    function LGAudioGain() {\r\n        //default\r\n        this.properties = {\r\n            gain: 1\r\n        };\r\n\r\n        this.audionode = LGAudio.getAudioContext().createGain();\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addInput(\"gain\", \"number\");\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudioGain.prototype.onExecute = function() {\r\n        if (!this.inputs || !this.inputs.length) {\r\n            return;\r\n        }\r\n\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var input = this.inputs[i];\r\n            var v = this.getInputData(i);\r\n            if (v !== undefined) {\r\n                this.audionode[input.name].value = v;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioGain);\r\n\r\n    LGAudioGain.title = \"Gain\";\r\n    LGAudioGain.desc = \"Audio gain\";\r\n    LiteGraph.registerNodeType(\"audio/gain\", LGAudioGain);\r\n\r\n    function LGAudioConvolver() {\r\n        //default\r\n        this.properties = {\r\n            impulse_src: \"\",\r\n            normalize: true\r\n        };\r\n\r\n        this.audionode = LGAudio.getAudioContext().createConvolver();\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioConvolver);\r\n\r\n    LGAudioConvolver.prototype.onRemove = function() {\r\n        if (this._dropped_url) {\r\n            URL.revokeObjectURL(this._dropped_url);\r\n        }\r\n    };\r\n\r\n    LGAudioConvolver.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"impulse_src\") {\r\n            this.loadImpulse(value);\r\n        } else if (name == \"normalize\") {\r\n            this.audionode.normalize = value;\r\n        }\r\n    };\r\n\r\n    LGAudioConvolver.prototype.onDropFile = function(file) {\r\n        if (this._dropped_url) {\r\n            URL.revokeObjectURL(this._dropped_url);\r\n        }\r\n        this._dropped_url = URL.createObjectURL(file);\r\n        this.properties.impulse_src = this._dropped_url;\r\n        this.loadImpulse(this._dropped_url);\r\n    };\r\n\r\n    LGAudioConvolver.prototype.loadImpulse = function(url) {\r\n        var that = this;\r\n\r\n        //kill previous load\r\n        if (this._request) {\r\n            this._request.abort();\r\n            this._request = null;\r\n        }\r\n\r\n        this._impulse_buffer = null;\r\n        this._loading_impulse = false;\r\n\r\n        if (!url) {\r\n            return;\r\n        }\r\n\r\n        //load new sample\r\n        this._request = LGAudio.loadSound(url, inner);\r\n        this._loading_impulse = true;\r\n\r\n        // Decode asynchronously\r\n        function inner(buffer) {\r\n            that._impulse_buffer = buffer;\r\n            that.audionode.buffer = buffer;\r\n            console.log(\"Impulse signal set\");\r\n            that._loading_impulse = false;\r\n        }\r\n    };\r\n\r\n    LGAudioConvolver.title = \"Convolver\";\r\n    LGAudioConvolver.desc = \"Convolves the signal (used for reverb)\";\r\n    LiteGraph.registerNodeType(\"audio/convolver\", LGAudioConvolver);\r\n\r\n    function LGAudioDynamicsCompressor() {\r\n        //default\r\n        this.properties = {\r\n            threshold: -50,\r\n            knee: 40,\r\n            ratio: 12,\r\n            reduction: -20,\r\n            attack: 0,\r\n            release: 0.25\r\n        };\r\n\r\n        this.audionode = LGAudio.getAudioContext().createDynamicsCompressor();\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioDynamicsCompressor);\r\n\r\n    LGAudioDynamicsCompressor.prototype.onExecute = function() {\r\n        if (!this.inputs || !this.inputs.length) {\r\n            return;\r\n        }\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var input = this.inputs[i];\r\n            if (input.link == null) {\r\n                continue;\r\n            }\r\n            var v = this.getInputData(i);\r\n            if (v !== undefined) {\r\n                this.audionode[input.name].value = v;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioDynamicsCompressor.prototype.onGetInputs = function() {\r\n        return [\r\n            [\"threshold\", \"number\"],\r\n            [\"knee\", \"number\"],\r\n            [\"ratio\", \"number\"],\r\n            [\"reduction\", \"number\"],\r\n            [\"attack\", \"number\"],\r\n            [\"release\", \"number\"]\r\n        ];\r\n    };\r\n\r\n    LGAudioDynamicsCompressor.title = \"DynamicsCompressor\";\r\n    LGAudioDynamicsCompressor.desc = \"Dynamics Compressor\";\r\n    LiteGraph.registerNodeType(\r\n        \"audio/dynamicsCompressor\",\r\n        LGAudioDynamicsCompressor\r\n    );\r\n\r\n    function LGAudioWaveShaper() {\r\n        //default\r\n        this.properties = {};\r\n\r\n        this.audionode = LGAudio.getAudioContext().createWaveShaper();\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addInput(\"shape\", \"waveshape\");\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudioWaveShaper.prototype.onExecute = function() {\r\n        if (!this.inputs || !this.inputs.length) {\r\n            return;\r\n        }\r\n        var v = this.getInputData(1);\r\n        if (v === undefined) {\r\n            return;\r\n        }\r\n        this.audionode.curve = v;\r\n    };\r\n\r\n    LGAudioWaveShaper.prototype.setWaveShape = function(shape) {\r\n        this.audionode.curve = shape;\r\n    };\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioWaveShaper);\r\n\r\n    /* disabled till I dont find a way to do a wave shape\r\nLGAudioWaveShaper.title = \"WaveShaper\";\r\nLGAudioWaveShaper.desc = \"Distortion using wave shape\";\r\nLiteGraph.registerNodeType(\"audio/waveShaper\", LGAudioWaveShaper);\r\n*/\r\n\r\n    function LGAudioMixer() {\r\n        //default\r\n        this.properties = {\r\n            gain1: 0.5,\r\n            gain2: 0.5\r\n        };\r\n\r\n        this.audionode = LGAudio.getAudioContext().createGain();\r\n\r\n        this.audionode1 = LGAudio.getAudioContext().createGain();\r\n        this.audionode1.gain.value = this.properties.gain1;\r\n        this.audionode2 = LGAudio.getAudioContext().createGain();\r\n        this.audionode2.gain.value = this.properties.gain2;\r\n\r\n        this.audionode1.connect(this.audionode);\r\n        this.audionode2.connect(this.audionode);\r\n\r\n        this.addInput(\"in1\", \"audio\");\r\n        this.addInput(\"in1 gain\", \"number\");\r\n        this.addInput(\"in2\", \"audio\");\r\n        this.addInput(\"in2 gain\", \"number\");\r\n\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudioMixer.prototype.getAudioNodeInInputSlot = function(slot) {\r\n        if (slot == 0) {\r\n            return this.audionode1;\r\n        } else if (slot == 2) {\r\n            return this.audionode2;\r\n        }\r\n    };\r\n\r\n    LGAudioMixer.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"gain1\") {\r\n            this.audionode1.gain.value = value;\r\n        } else if (name == \"gain2\") {\r\n            this.audionode2.gain.value = value;\r\n        }\r\n    };\r\n\r\n    LGAudioMixer.prototype.onExecute = function() {\r\n        if (!this.inputs || !this.inputs.length) {\r\n            return;\r\n        }\r\n\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var input = this.inputs[i];\r\n\r\n            if (input.link == null || input.type == \"audio\") {\r\n                continue;\r\n            }\r\n\r\n            var v = this.getInputData(i);\r\n            if (v === undefined) {\r\n                continue;\r\n            }\r\n\r\n            if (i == 1) {\r\n                this.audionode1.gain.value = v;\r\n            } else if (i == 3) {\r\n                this.audionode2.gain.value = v;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioMixer);\r\n\r\n    LGAudioMixer.title = \"Mixer\";\r\n    LGAudioMixer.desc = \"Audio mixer\";\r\n    LiteGraph.registerNodeType(\"audio/mixer\", LGAudioMixer);\r\n\r\n    function LGAudioADSR() {\r\n        //default\r\n        this.properties = {\r\n            A: 0.1,\r\n            D: 0.1,\r\n            S: 0.1,\r\n            R: 0.1\r\n        };\r\n\r\n        this.audionode = LGAudio.getAudioContext().createGain();\r\n        this.audionode.gain.value = 0;\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addInput(\"gate\", \"boolean\");\r\n        this.addOutput(\"out\", \"audio\");\r\n        this.gate = false;\r\n    }\r\n\r\n    LGAudioADSR.prototype.onExecute = function() {\r\n        var audioContext = LGAudio.getAudioContext();\r\n        var now = audioContext.currentTime;\r\n        var node = this.audionode;\r\n        var gain = node.gain;\r\n        var current_gate = this.getInputData(1);\r\n\r\n        var A = this.getInputOrProperty(\"A\");\r\n        var D = this.getInputOrProperty(\"D\");\r\n        var S = this.getInputOrProperty(\"S\");\r\n        var R = this.getInputOrProperty(\"R\");\r\n\r\n        if (!this.gate && current_gate) {\r\n            gain.cancelScheduledValues(0);\r\n            gain.setValueAtTime(0, now);\r\n            gain.linearRampToValueAtTime(1, now + A);\r\n            gain.linearRampToValueAtTime(S, now + A + D);\r\n        } else if (this.gate && !current_gate) {\r\n            gain.cancelScheduledValues(0);\r\n            gain.setValueAtTime(gain.value, now);\r\n            gain.linearRampToValueAtTime(0, now + R);\r\n        }\r\n\r\n        this.gate = current_gate;\r\n    };\r\n\r\n    LGAudioADSR.prototype.onGetInputs = function() {\r\n        return [\r\n            [\"A\", \"number\"],\r\n            [\"D\", \"number\"],\r\n            [\"S\", \"number\"],\r\n            [\"R\", \"number\"]\r\n        ];\r\n    };\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioADSR);\r\n\r\n    LGAudioADSR.title = \"ADSR\";\r\n    LGAudioADSR.desc = \"Audio envelope\";\r\n    LiteGraph.registerNodeType(\"audio/adsr\", LGAudioADSR);\r\n\r\n    function LGAudioDelay() {\r\n        //default\r\n        this.properties = {\r\n            delayTime: 0.5\r\n        };\r\n\r\n        this.audionode = LGAudio.getAudioContext().createDelay(10);\r\n        this.audionode.delayTime.value = this.properties.delayTime;\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addInput(\"time\", \"number\");\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioDelay);\r\n\r\n    LGAudioDelay.prototype.onExecute = function() {\r\n        var v = this.getInputData(1);\r\n        if (v !== undefined) {\r\n            this.audionode.delayTime.value = v;\r\n        }\r\n    };\r\n\r\n    LGAudioDelay.title = \"Delay\";\r\n    LGAudioDelay.desc = \"Audio delay\";\r\n    LiteGraph.registerNodeType(\"audio/delay\", LGAudioDelay);\r\n\r\n    function LGAudioBiquadFilter() {\r\n        //default\r\n        this.properties = {\r\n            frequency: 350,\r\n            detune: 0,\r\n            Q: 1\r\n        };\r\n        this.addProperty(\"type\", \"lowpass\", \"enum\", {\r\n            values: [\r\n                \"lowpass\",\r\n                \"highpass\",\r\n                \"bandpass\",\r\n                \"lowshelf\",\r\n                \"highshelf\",\r\n                \"peaking\",\r\n                \"notch\",\r\n                \"allpass\"\r\n            ]\r\n        });\r\n\r\n        //create node\r\n        this.audionode = LGAudio.getAudioContext().createBiquadFilter();\r\n\r\n        //slots\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudioBiquadFilter.prototype.onExecute = function() {\r\n        if (!this.inputs || !this.inputs.length) {\r\n            return;\r\n        }\r\n\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var input = this.inputs[i];\r\n            if (input.link == null) {\r\n                continue;\r\n            }\r\n            var v = this.getInputData(i);\r\n            if (v !== undefined) {\r\n                this.audionode[input.name].value = v;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioBiquadFilter.prototype.onGetInputs = function() {\r\n        return [[\"frequency\", \"number\"], [\"detune\", \"number\"], [\"Q\", \"number\"]];\r\n    };\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioBiquadFilter);\r\n\r\n    LGAudioBiquadFilter.title = \"BiquadFilter\";\r\n    LGAudioBiquadFilter.desc = \"Audio filter\";\r\n    LiteGraph.registerNodeType(\"audio/biquadfilter\", LGAudioBiquadFilter);\r\n\r\n    function LGAudioOscillatorNode() {\r\n        //default\r\n        this.properties = {\r\n            frequency: 440,\r\n            detune: 0,\r\n            type: \"sine\"\r\n        };\r\n        this.addProperty(\"type\", \"sine\", \"enum\", {\r\n            values: [\"sine\", \"square\", \"sawtooth\", \"triangle\", \"custom\"]\r\n        });\r\n\r\n        //create node\r\n        this.audionode = LGAudio.getAudioContext().createOscillator();\r\n\r\n        //slots\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudioOscillatorNode.prototype.onStart = function() {\r\n        if (!this.audionode.started) {\r\n            this.audionode.started = true;\r\n            try {\r\n                this.audionode.start();\r\n            } catch (err) {}\r\n        }\r\n    };\r\n\r\n    LGAudioOscillatorNode.prototype.onStop = function() {\r\n        if (this.audionode.started) {\r\n            this.audionode.started = false;\r\n            this.audionode.stop();\r\n        }\r\n    };\r\n\r\n    LGAudioOscillatorNode.prototype.onPause = function() {\r\n        this.onStop();\r\n    };\r\n\r\n    LGAudioOscillatorNode.prototype.onUnpause = function() {\r\n        this.onStart();\r\n    };\r\n\r\n    LGAudioOscillatorNode.prototype.onExecute = function() {\r\n        if (!this.inputs || !this.inputs.length) {\r\n            return;\r\n        }\r\n\r\n        for (var i = 0; i < this.inputs.length; ++i) {\r\n            var input = this.inputs[i];\r\n            if (input.link == null) {\r\n                continue;\r\n            }\r\n            var v = this.getInputData(i);\r\n            if (v !== undefined) {\r\n                this.audionode[input.name].value = v;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioOscillatorNode.prototype.onGetInputs = function() {\r\n        return [\r\n            [\"frequency\", \"number\"],\r\n            [\"detune\", \"number\"],\r\n            [\"type\", \"string\"]\r\n        ];\r\n    };\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioOscillatorNode);\r\n\r\n    LGAudioOscillatorNode.title = \"Oscillator\";\r\n    LGAudioOscillatorNode.desc = \"Oscillator\";\r\n    LiteGraph.registerNodeType(\"audio/oscillator\", LGAudioOscillatorNode);\r\n\r\n    //*****************************************************\r\n\r\n    //EXTRA\r\n\r\n    function LGAudioVisualization() {\r\n        this.properties = {\r\n            continuous: true,\r\n            mark: -1\r\n        };\r\n\r\n        this.addInput(\"data\", \"array\");\r\n        this.addInput(\"mark\", \"number\");\r\n        this.size = [300, 200];\r\n        this._last_buffer = null;\r\n    }\r\n\r\n    LGAudioVisualization.prototype.onExecute = function() {\r\n        this._last_buffer = this.getInputData(0);\r\n        var v = this.getInputData(1);\r\n        if (v !== undefined) {\r\n            this.properties.mark = v;\r\n        }\r\n        this.setDirtyCanvas(true, false);\r\n    };\r\n\r\n    LGAudioVisualization.prototype.onDrawForeground = function(ctx) {\r\n        if (!this._last_buffer) {\r\n            return;\r\n        }\r\n\r\n        var buffer = this._last_buffer;\r\n\r\n        //delta represents how many samples we advance per pixel\r\n        var delta = buffer.length / this.size[0];\r\n        var h = this.size[1];\r\n\r\n        ctx.fillStyle = \"black\";\r\n        ctx.fillRect(0, 0, this.size[0], this.size[1]);\r\n        ctx.strokeStyle = \"white\";\r\n        ctx.beginPath();\r\n        var x = 0;\r\n\r\n        if (this.properties.continuous) {\r\n            ctx.moveTo(x, h);\r\n            for (var i = 0; i < buffer.length; i += delta) {\r\n                ctx.lineTo(x, h - (buffer[i | 0] / 255) * h);\r\n                x++;\r\n            }\r\n        } else {\r\n            for (var i = 0; i < buffer.length; i += delta) {\r\n                ctx.moveTo(x + 0.5, h);\r\n                ctx.lineTo(x + 0.5, h - (buffer[i | 0] / 255) * h);\r\n                x++;\r\n            }\r\n        }\r\n        ctx.stroke();\r\n\r\n        if (this.properties.mark >= 0) {\r\n            var samplerate = LGAudio.getAudioContext().sampleRate;\r\n            var binfreq = samplerate / buffer.length;\r\n            var x = (2 * (this.properties.mark / binfreq)) / delta;\r\n            if (x >= this.size[0]) {\r\n                x = this.size[0] - 1;\r\n            }\r\n            ctx.strokeStyle = \"red\";\r\n            ctx.beginPath();\r\n            ctx.moveTo(x, h);\r\n            ctx.lineTo(x, 0);\r\n            ctx.stroke();\r\n        }\r\n    };\r\n\r\n    LGAudioVisualization.title = \"Visualization\";\r\n    LGAudioVisualization.desc = \"Audio Visualization\";\r\n    LiteGraph.registerNodeType(\"audio/visualization\", LGAudioVisualization);\r\n\r\n    function LGAudioBandSignal() {\r\n        //default\r\n        this.properties = {\r\n            band: 440,\r\n            amplitude: 1\r\n        };\r\n\r\n        this.addInput(\"freqs\", \"array\");\r\n        this.addOutput(\"signal\", \"number\");\r\n    }\r\n\r\n    LGAudioBandSignal.prototype.onExecute = function() {\r\n        this._freqs = this.getInputData(0);\r\n        if (!this._freqs) {\r\n            return;\r\n        }\r\n\r\n        var band = this.properties.band;\r\n        var v = this.getInputData(1);\r\n        if (v !== undefined) {\r\n            band = v;\r\n        }\r\n\r\n        var samplerate = LGAudio.getAudioContext().sampleRate;\r\n        var binfreq = samplerate / this._freqs.length;\r\n        var index = 2 * (band / binfreq);\r\n        var v = 0;\r\n        if (index < 0) {\r\n            v = this._freqs[0];\r\n        }\r\n        if (index >= this._freqs.length) {\r\n            v = this._freqs[this._freqs.length - 1];\r\n        } else {\r\n            var pos = index | 0;\r\n            var v0 = this._freqs[pos];\r\n            var v1 = this._freqs[pos + 1];\r\n            var f = index - pos;\r\n            v = v0 * (1 - f) + v1 * f;\r\n        }\r\n\r\n        this.setOutputData(0, (v / 255) * this.properties.amplitude);\r\n    };\r\n\r\n    LGAudioBandSignal.prototype.onGetInputs = function() {\r\n        return [[\"band\", \"number\"]];\r\n    };\r\n\r\n    LGAudioBandSignal.title = \"Signal\";\r\n    LGAudioBandSignal.desc = \"extract the signal of some frequency\";\r\n    LiteGraph.registerNodeType(\"audio/signal\", LGAudioBandSignal);\r\n\r\n    function LGAudioScript() {\r\n        if (!LGAudioScript.default_code) {\r\n            var code = LGAudioScript.default_function.toString();\r\n            var index = code.indexOf(\"{\") + 1;\r\n            var index2 = code.lastIndexOf(\"}\");\r\n            LGAudioScript.default_code = code.substr(index, index2 - index);\r\n        }\r\n\r\n        //default\r\n        this.properties = {\r\n            code: LGAudioScript.default_code\r\n        };\r\n\r\n        //create node\r\n        var ctx = LGAudio.getAudioContext();\r\n        if (ctx.createScriptProcessor) {\r\n            this.audionode = ctx.createScriptProcessor(4096, 1, 1);\r\n        }\r\n        //buffer size, input channels, output channels\r\n        else {\r\n            console.warn(\"ScriptProcessorNode deprecated\");\r\n            this.audionode = ctx.createGain(); //bypass audio\r\n        }\r\n\r\n        this.processCode();\r\n        if (!LGAudioScript._bypass_function) {\r\n            LGAudioScript._bypass_function = this.audionode.onaudioprocess;\r\n        }\r\n\r\n        //slots\r\n        this.addInput(\"in\", \"audio\");\r\n        this.addOutput(\"out\", \"audio\");\r\n    }\r\n\r\n    LGAudioScript.prototype.onAdded = function(graph) {\r\n        if (graph.status == LGraph.STATUS_RUNNING) {\r\n            this.audionode.onaudioprocess = this._callback;\r\n        }\r\n    };\r\n\r\n    LGAudioScript[\"@code\"] = { widget: \"code\", type: \"code\" };\r\n\r\n    LGAudioScript.prototype.onStart = function() {\r\n        this.audionode.onaudioprocess = this._callback;\r\n    };\r\n\r\n    LGAudioScript.prototype.onStop = function() {\r\n        this.audionode.onaudioprocess = LGAudioScript._bypass_function;\r\n    };\r\n\r\n    LGAudioScript.prototype.onPause = function() {\r\n        this.audionode.onaudioprocess = LGAudioScript._bypass_function;\r\n    };\r\n\r\n    LGAudioScript.prototype.onUnpause = function() {\r\n        this.audionode.onaudioprocess = this._callback;\r\n    };\r\n\r\n    LGAudioScript.prototype.onExecute = function() {\r\n        //nothing! because we need an onExecute to receive onStart... fix that\r\n    };\r\n\r\n    LGAudioScript.prototype.onRemoved = function() {\r\n        this.audionode.onaudioprocess = LGAudioScript._bypass_function;\r\n    };\r\n\r\n    LGAudioScript.prototype.processCode = function() {\r\n        try {\r\n            var func = new Function(\"properties\", this.properties.code);\r\n            this._script = new func(this.properties);\r\n            this._old_code = this.properties.code;\r\n            this._callback = this._script.onaudioprocess;\r\n        } catch (err) {\r\n            console.error(\"Error in onaudioprocess code\", err);\r\n            this._callback = LGAudioScript._bypass_function;\r\n            this.audionode.onaudioprocess = this._callback;\r\n        }\r\n    };\r\n\r\n    LGAudioScript.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"code\") {\r\n            this.properties.code = value;\r\n            this.processCode();\r\n            if (this.graph && this.graph.status == LGraph.STATUS_RUNNING) {\r\n                this.audionode.onaudioprocess = this._callback;\r\n            }\r\n        }\r\n    };\r\n\r\n    LGAudioScript.default_function = function() {\r\n        this.onaudioprocess = function(audioProcessingEvent) {\r\n            // The input buffer is the song we loaded earlier\r\n            var inputBuffer = audioProcessingEvent.inputBuffer;\r\n\r\n            // The output buffer contains the samples that will be modified and played\r\n            var outputBuffer = audioProcessingEvent.outputBuffer;\r\n\r\n            // Loop through the output channels (in this case there is only one)\r\n            for (\r\n                var channel = 0;\r\n                channel < outputBuffer.numberOfChannels;\r\n                channel++\r\n            ) {\r\n                var inputData = inputBuffer.getChannelData(channel);\r\n                var outputData = outputBuffer.getChannelData(channel);\r\n\r\n                // Loop through the 4096 samples\r\n                for (var sample = 0; sample < inputBuffer.length; sample++) {\r\n                    // make output equal to the same as the input\r\n                    outputData[sample] = inputData[sample];\r\n                }\r\n            }\r\n        };\r\n    };\r\n\r\n    LGAudio.createAudioNodeWrapper(LGAudioScript);\r\n\r\n    LGAudioScript.title = \"Script\";\r\n    LGAudioScript.desc = \"apply script to signal\";\r\n    LiteGraph.registerNodeType(\"audio/script\", LGAudioScript);\r\n\r\n    function LGAudioDestination() {\r\n        this.audionode = LGAudio.getAudioContext().destination;\r\n        this.addInput(\"in\", \"audio\");\r\n    }\r\n\r\n    LGAudioDestination.title = \"Destination\";\r\n    LGAudioDestination.desc = \"Audio output\";\r\n    LiteGraph.registerNodeType(\"audio/destination\", LGAudioDestination);\r\n})(this);\r\n\n//event related nodes\r\n(function(global) {\r\n    var LiteGraph = global.LiteGraph;\r\n\r\n    function LGWebSocket() {\r\n        this.size = [60, 20];\r\n        this.addInput(\"send\", LiteGraph.ACTION);\r\n        this.addOutput(\"received\", LiteGraph.EVENT);\r\n        this.addInput(\"in\", 0);\r\n        this.addOutput(\"out\", 0);\r\n        this.properties = {\r\n            url: \"\",\r\n            room: \"lgraph\", //allows to filter messages,\r\n            only_send_changes: true\r\n        };\r\n        this._ws = null;\r\n        this._last_sent_data = [];\r\n        this._last_received_data = [];\r\n    }\r\n\r\n    LGWebSocket.title = \"WebSocket\";\r\n    LGWebSocket.desc = \"Send data through a websocket\";\r\n\r\n    LGWebSocket.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"url\") {\r\n            this.connectSocket();\r\n        }\r\n    };\r\n\r\n    LGWebSocket.prototype.onExecute = function() {\r\n        if (!this._ws && this.properties.url) {\r\n            this.connectSocket();\r\n        }\r\n\r\n        if (!this._ws || this._ws.readyState != WebSocket.OPEN) {\r\n            return;\r\n        }\r\n\r\n        var room = this.properties.room;\r\n        var only_changes = this.properties.only_send_changes;\r\n\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var data = this.getInputData(i);\r\n            if (data == null) {\r\n                continue;\r\n            }\r\n            var json;\r\n            try {\r\n                json = JSON.stringify({\r\n                    type: 0,\r\n                    room: room,\r\n                    channel: i,\r\n                    data: data\r\n                });\r\n            } catch (err) {\r\n                continue;\r\n            }\r\n            if (only_changes && this._last_sent_data[i] == json) {\r\n                continue;\r\n            }\r\n\r\n            this._last_sent_data[i] = json;\r\n            this._ws.send(json);\r\n        }\r\n\r\n        for (var i = 1; i < this.outputs.length; ++i) {\r\n            this.setOutputData(i, this._last_received_data[i]);\r\n        }\r\n\r\n        if (this.boxcolor == \"#AFA\") {\r\n            this.boxcolor = \"#6C6\";\r\n        }\r\n    };\r\n\r\n    LGWebSocket.prototype.connectSocket = function() {\r\n        var that = this;\r\n        var url = this.properties.url;\r\n        if (url.substr(0, 2) != \"ws\") {\r\n            url = \"ws://\" + url;\r\n        }\r\n        this._ws = new WebSocket(url);\r\n        this._ws.onopen = function() {\r\n            console.log(\"ready\");\r\n            that.boxcolor = \"#6C6\";\r\n        };\r\n        this._ws.onmessage = function(e) {\r\n            that.boxcolor = \"#AFA\";\r\n            var data = JSON.parse(e.data);\r\n            if (data.room && data.room != that.properties.room) {\r\n                return;\r\n            }\r\n            if (data.type == 1) {\r\n                if (\r\n                    data.data.object_class &&\r\n                    LiteGraph[data.data.object_class]\r\n                ) {\r\n                    var obj = null;\r\n                    try {\r\n                        obj = new LiteGraph[data.data.object_class](data.data);\r\n                        that.triggerSlot(0, obj);\r\n                    } catch (err) {\r\n                        return;\r\n                    }\r\n                } else {\r\n                    that.triggerSlot(0, data.data);\r\n                }\r\n            } else {\r\n                that._last_received_data[data.channel || 0] = data.data;\r\n            }\r\n        };\r\n        this._ws.onerror = function(e) {\r\n            console.log(\"couldnt connect to websocket\");\r\n            that.boxcolor = \"#E88\";\r\n        };\r\n        this._ws.onclose = function(e) {\r\n            console.log(\"connection closed\");\r\n            that.boxcolor = \"#000\";\r\n        };\r\n    };\r\n\r\n    LGWebSocket.prototype.send = function(data) {\r\n        if (!this._ws || this._ws.readyState != WebSocket.OPEN) {\r\n            return;\r\n        }\r\n        this._ws.send(JSON.stringify({ type: 1, msg: data }));\r\n    };\r\n\r\n    LGWebSocket.prototype.onAction = function(action, param) {\r\n        if (!this._ws || this._ws.readyState != WebSocket.OPEN) {\r\n            return;\r\n        }\r\n        this._ws.send({\r\n            type: 1,\r\n            room: this.properties.room,\r\n            action: action,\r\n            data: param\r\n        });\r\n    };\r\n\r\n    LGWebSocket.prototype.onGetInputs = function() {\r\n        return [[\"in\", 0]];\r\n    };\r\n\r\n    LGWebSocket.prototype.onGetOutputs = function() {\r\n        return [[\"out\", 0]];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"network/websocket\", LGWebSocket);\r\n\r\n    //It is like a websocket but using the SillyServer.js server that bounces packets back to all clients connected:\r\n    //For more information: https://github.com/jagenjo/SillyServer.js\r\n\r\n    function LGSillyClient() {\r\n        //this.size = [60,20];\r\n        this.room_widget = this.addWidget(\r\n            \"text\",\r\n            \"Room\",\r\n            \"lgraph\",\r\n            this.setRoom.bind(this)\r\n        );\r\n        this.addWidget(\r\n            \"button\",\r\n            \"Reconnect\",\r\n            null,\r\n            this.connectSocket.bind(this)\r\n        );\r\n\r\n        this.addInput(\"send\", LiteGraph.ACTION);\r\n        this.addOutput(\"received\", LiteGraph.EVENT);\r\n        this.addInput(\"in\", 0);\r\n        this.addOutput(\"out\", 0);\r\n        this.properties = {\r\n            url: \"tamats.com:55000\",\r\n            room: \"lgraph\",\r\n            only_send_changes: true\r\n        };\r\n\r\n        this._server = null;\r\n        this.connectSocket();\r\n        this._last_sent_data = [];\r\n        this._last_received_data = [];\r\n\r\n\t\tif(typeof(SillyClient) == \"undefined\")\r\n\t\t\tconsole.warn(\"remember to add SillyClient.js to your project: https://tamats.com/projects/sillyserver/src/sillyclient.js\");\r\n    }\r\n\r\n    LGSillyClient.title = \"SillyClient\";\r\n    LGSillyClient.desc = \"Connects to SillyServer to broadcast messages\";\r\n\r\n    LGSillyClient.prototype.onPropertyChanged = function(name, value) {\r\n        if (name == \"room\") {\r\n            this.room_widget.value = value;\r\n        }\r\n        this.connectSocket();\r\n    };\r\n\r\n    LGSillyClient.prototype.setRoom = function(room_name) {\r\n        this.properties.room = room_name;\r\n        this.room_widget.value = room_name;\r\n        this.connectSocket();\r\n    };\r\n\r\n    //force label names\r\n    LGSillyClient.prototype.onDrawForeground = function() {\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var slot = this.inputs[i];\r\n            slot.label = \"in_\" + i;\r\n        }\r\n        for (var i = 1; i < this.outputs.length; ++i) {\r\n            var slot = this.outputs[i];\r\n            slot.label = \"out_\" + i;\r\n        }\r\n    };\r\n\r\n    LGSillyClient.prototype.onExecute = function() {\r\n        if (!this._server || !this._server.is_connected) {\r\n            return;\r\n        }\r\n\r\n        var only_send_changes = this.properties.only_send_changes;\r\n\r\n        for (var i = 1; i < this.inputs.length; ++i) {\r\n            var data = this.getInputData(i);\r\n\t\t\tvar prev_data = this._last_sent_data[i];\r\n            if (data != null) {\r\n                if (only_send_changes)\r\n\t\t\t\t{\t\r\n\t\t\t\t\tvar is_equal = true;\r\n\t\t\t\t\tif( data && data.length && prev_data && prev_data.length == data.length && data.constructor !== String)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfor(var j = 0; j < data.length; ++j)\r\n\t\t\t\t\t\t\tif( prev_data[j] != data[j] )\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tis_equal = false;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if(this._last_sent_data[i] != data)\r\n\t\t\t\t\t\tis_equal = false;\r\n\t\t\t\t\tif(is_equal)\r\n\t\t\t\t\t\t\tcontinue;\r\n                }\r\n                this._server.sendMessage({ type: 0, channel: i, data: data });\r\n\t\t\t\tif( data.length && data.constructor !== String )\r\n\t\t\t\t{\r\n\t\t\t\t\tif( this._last_sent_data[i] )\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis._last_sent_data[i].length = data.length;\r\n\t\t\t\t\t\tfor(var j = 0; j < data.length; ++j)\r\n\t\t\t\t\t\t\tthis._last_sent_data[i][j] = data[j];\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse //create\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(data.constructor === Array)\r\n\t\t\t\t\t\t\tthis._last_sent_data[i] = data.concat();\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tthis._last_sent_data[i] = new data.constructor( data );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t                this._last_sent_data[i] = data; //should be cloned\r\n            }\r\n        }\r\n\r\n        for (var i = 1; i < this.outputs.length; ++i) {\r\n            this.setOutputData(i, this._last_received_data[i]);\r\n        }\r\n\r\n        if (this.boxcolor == \"#AFA\") {\r\n            this.boxcolor = \"#6C6\";\r\n        }\r\n    };\r\n\r\n    LGSillyClient.prototype.connectSocket = function() {\r\n        var that = this;\r\n        if (typeof SillyClient == \"undefined\") {\r\n            if (!this._error) {\r\n                console.error(\r\n                    \"SillyClient node cannot be used, you must include SillyServer.js\"\r\n                );\r\n            }\r\n            this._error = true;\r\n            return;\r\n        }\r\n\r\n        this._server = new SillyClient();\r\n        this._server.on_ready = function() {\r\n            console.log(\"ready\");\r\n            that.boxcolor = \"#6C6\";\r\n        };\r\n        this._server.on_message = function(id, msg) {\r\n            var data = null;\r\n            try {\r\n                data = JSON.parse(msg);\r\n            } catch (err) {\r\n                return;\r\n            }\r\n\r\n            if (data.type == 1) {\r\n                //EVENT slot\r\n                if (\r\n                    data.data.object_class &&\r\n                    LiteGraph[data.data.object_class]\r\n                ) {\r\n                    var obj = null;\r\n                    try {\r\n                        obj = new LiteGraph[data.data.object_class](data.data);\r\n                        that.triggerSlot(0, obj);\r\n                    } catch (err) {\r\n                        return;\r\n                    }\r\n                } else {\r\n                    that.triggerSlot(0, data.data);\r\n                }\r\n            } //for FLOW slots\r\n            else {\r\n                that._last_received_data[data.channel || 0] = data.data;\r\n            }\r\n            that.boxcolor = \"#AFA\";\r\n        };\r\n        this._server.on_error = function(e) {\r\n            console.log(\"couldnt connect to websocket\");\r\n            that.boxcolor = \"#E88\";\r\n        };\r\n        this._server.on_close = function(e) {\r\n            console.log(\"connection closed\");\r\n            that.boxcolor = \"#000\";\r\n        };\r\n\r\n        if (this.properties.url && this.properties.room) {\r\n            try {\r\n                this._server.connect(this.properties.url, this.properties.room);\r\n            } catch (err) {\r\n                console.error(\"SillyServer error: \" + err);\r\n                this._server = null;\r\n                return;\r\n            }\r\n            this._final_url = this.properties.url + \"/\" + this.properties.room;\r\n        }\r\n    };\r\n\r\n    LGSillyClient.prototype.send = function(data) {\r\n        if (!this._server || !this._server.is_connected) {\r\n            return;\r\n        }\r\n        this._server.sendMessage({ type: 1, data: data });\r\n    };\r\n\r\n    LGSillyClient.prototype.onAction = function(action, param) {\r\n        if (!this._server || !this._server.is_connected) {\r\n            return;\r\n        }\r\n        this._server.sendMessage({ type: 1, action: action, data: param });\r\n    };\r\n\r\n    LGSillyClient.prototype.onGetInputs = function() {\r\n        return [[\"in\", 0]];\r\n    };\r\n\r\n    LGSillyClient.prototype.onGetOutputs = function() {\r\n        return [[\"out\", 0]];\r\n    };\r\n\r\n    LiteGraph.registerNodeType(\"network/sillyclient\", LGSillyClient);\r\n\r\n//HTTP Request\r\nfunction HTTPRequestNode() {\r\n\tvar that = this;\r\n\tthis.addInput(\"request\", LiteGraph.ACTION);\r\n\tthis.addInput(\"url\", \"string\");\r\n\tthis.addProperty(\"url\", \"\");\r\n\tthis.addOutput(\"ready\", LiteGraph.EVENT);\r\n    this.addOutput(\"data\", \"string\");\r\n\tthis.addWidget(\"button\", \"Fetch\", null, this.fetch.bind(this));\r\n\tthis._data = null;\r\n\tthis._fetching = null;\r\n}\r\n\r\nHTTPRequestNode.title = \"HTTP Request\";\r\nHTTPRequestNode.desc = \"Fetch data through HTTP\";\r\n\r\nHTTPRequestNode.prototype.fetch = function()\r\n{\r\n\tvar url = this.properties.url;\r\n\tif(!url)\r\n\t\treturn;\r\n\r\n\tthis.boxcolor = \"#FF0\";\r\n\tvar that = this;\r\n\tthis._fetching = fetch(url)\r\n\t.then(resp=>{\r\n\t\tif(!resp.ok)\r\n\t\t{\r\n\t\t\tthis.boxcolor = \"#F00\";\r\n\t\t\tthat.trigger(\"error\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.boxcolor = \"#0F0\";\r\n\t\t\treturn resp.text();\r\n\t\t}\r\n\t})\r\n\t.then(data=>{\r\n\t\tthat._data = data;\r\n\t\tthat._fetching = null;\r\n\t\tthat.trigger(\"ready\");\r\n\t});\r\n}\r\n\r\nHTTPRequestNode.prototype.onAction = function(evt)\r\n{\r\n\tif(evt == \"request\")\r\n\t\tthis.fetch();\r\n}\r\n\r\nHTTPRequestNode.prototype.onExecute = function() {\r\n\tthis.setOutputData(1, this._data);\r\n};\r\n\r\nHTTPRequestNode.prototype.onGetOutputs = function() {\r\n\treturn [[\"error\",LiteGraph.EVENT]];\r\n}\r\n\r\nLiteGraph.registerNodeType(\"network/httprequest\", HTTPRequestNode);\r\n\r\n\r\n\t\r\n})(this);\r\n\n","'use strict';\n\n(function () {\n  var out$ = typeof exports != 'undefined' && exports || typeof define != 'undefined' && {} || this || window;\n  if (typeof define !== 'undefined') define('save-svg-as-png', [], function () {\n    return out$;\n  });\n  out$.default = out$;\n\n  var xmlNs = 'http://www.w3.org/2000/xmlns/';\n  var xhtmlNs = 'http://www.w3.org/1999/xhtml';\n  var svgNs = 'http://www.w3.org/2000/svg';\n  var doctype = '<?xml version=\"1.0\" standalone=\"no\"?><!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [<!ENTITY nbsp \"&#160;\">]>';\n  var urlRegex = /url\\([\"']?(.+?)[\"']?\\)/;\n  var fontFormats = {\n    woff2: 'font/woff2',\n    woff: 'font/woff',\n    otf: 'application/x-font-opentype',\n    ttf: 'application/x-font-ttf',\n    eot: 'application/vnd.ms-fontobject',\n    sfnt: 'application/font-sfnt',\n    svg: 'image/svg+xml'\n  };\n\n  var isElement = function isElement(obj) {\n    return obj instanceof HTMLElement || obj instanceof SVGElement;\n  };\n  var requireDomNode = function requireDomNode(el) {\n    if (!isElement(el)) throw new Error('an HTMLElement or SVGElement is required; got ' + el);\n  };\n  var requireDomNodePromise = function requireDomNodePromise(el) {\n    return new Promise(function (resolve, reject) {\n      if (isElement(el)) resolve(el);else reject(new Error('an HTMLElement or SVGElement is required; got ' + el));\n    });\n  };\n  var isExternal = function isExternal(url) {\n    return url && url.lastIndexOf('http', 0) === 0 && url.lastIndexOf(window.location.host) === -1;\n  };\n\n  var getFontMimeTypeFromUrl = function getFontMimeTypeFromUrl(fontUrl) {\n    var formats = Object.keys(fontFormats).filter(function (extension) {\n      return fontUrl.indexOf('.' + extension) > 0;\n    }).map(function (extension) {\n      return fontFormats[extension];\n    });\n    if (formats) return formats[0];\n    console.error('Unknown font format for ' + fontUrl + '. Fonts may not be working correctly.');\n    return 'application/octet-stream';\n  };\n\n  var arrayBufferToBase64 = function arrayBufferToBase64(buffer) {\n    var binary = '';\n    var bytes = new Uint8Array(buffer);\n    for (var i = 0; i < bytes.byteLength; i++) {\n      binary += String.fromCharCode(bytes[i]);\n    }return window.btoa(binary);\n  };\n\n  var getDimension = function getDimension(el, clone, dim) {\n    var v = el.viewBox && el.viewBox.baseVal && el.viewBox.baseVal[dim] || clone.getAttribute(dim) !== null && !clone.getAttribute(dim).match(/%$/) && parseInt(clone.getAttribute(dim)) || el.getBoundingClientRect()[dim] || parseInt(clone.style[dim]) || parseInt(window.getComputedStyle(el).getPropertyValue(dim));\n    return typeof v === 'undefined' || v === null || isNaN(parseFloat(v)) ? 0 : v;\n  };\n\n  var getDimensions = function getDimensions(el, clone, width, height) {\n    if (el.tagName === 'svg') return {\n      width: width || getDimension(el, clone, 'width'),\n      height: height || getDimension(el, clone, 'height')\n    };else if (el.getBBox) {\n      var _el$getBBox = el.getBBox(),\n          x = _el$getBBox.x,\n          y = _el$getBBox.y,\n          _width = _el$getBBox.width,\n          _height = _el$getBBox.height;\n\n      return {\n        width: x + _width,\n        height: y + _height\n      };\n    }\n  };\n\n  var reEncode = function reEncode(data) {\n    return decodeURIComponent(encodeURIComponent(data).replace(/%([0-9A-F]{2})/g, function (match, p1) {\n      var c = String.fromCharCode('0x' + p1);\n      return c === '%' ? '%25' : c;\n    }));\n  };\n\n  var uriToBlob = function uriToBlob(uri) {\n    var byteString = window.atob(uri.split(',')[1]);\n    var mimeString = uri.split(',')[0].split(':')[1].split(';')[0];\n    var buffer = new ArrayBuffer(byteString.length);\n    var intArray = new Uint8Array(buffer);\n    for (var i = 0; i < byteString.length; i++) {\n      intArray[i] = byteString.charCodeAt(i);\n    }\n    return new Blob([buffer], { type: mimeString });\n  };\n\n  var query = function query(el, selector) {\n    if (!selector) return;\n    try {\n      return el.querySelector(selector) || el.parentNode && el.parentNode.querySelector(selector);\n    } catch (err) {\n      console.warn('Invalid CSS selector \"' + selector + '\"', err);\n    }\n  };\n\n  var detectCssFont = function detectCssFont(rule, href) {\n    // Match CSS font-face rules to external links.\n    // @font-face {\n    //   src: local('Abel'), url(https://fonts.gstatic.com/s/abel/v6/UzN-iejR1VoXU2Oc-7LsbvesZW2xOQ-xsNqO47m55DA.woff2);\n    // }\n    var match = rule.cssText.match(urlRegex);\n    var url = match && match[1] || '';\n    if (!url || url.match(/^data:/) || url === 'about:blank') return;\n    var fullUrl = url.startsWith('../') ? href + '/../' + url : url.startsWith('./') ? href + '/.' + url : url;\n    return {\n      text: rule.cssText,\n      format: getFontMimeTypeFromUrl(fullUrl),\n      url: fullUrl\n    };\n  };\n\n  var inlineImages = function inlineImages(el) {\n    return Promise.all(Array.from(el.querySelectorAll('image')).map(function (image) {\n      var href = image.getAttributeNS('http://www.w3.org/1999/xlink', 'href') || image.getAttribute('href');\n      if (!href) return Promise.resolve(null);\n      if (isExternal(href)) {\n        href += (href.indexOf('?') === -1 ? '?' : '&') + 't=' + new Date().valueOf();\n      }\n      return new Promise(function (resolve, reject) {\n        var canvas = document.createElement('canvas');\n        var img = new Image();\n        img.crossOrigin = 'anonymous';\n        img.src = href;\n        img.onerror = function () {\n          return reject(new Error('Could not load ' + href));\n        };\n        img.onload = function () {\n          canvas.width = img.width;\n          canvas.height = img.height;\n          canvas.getContext('2d').drawImage(img, 0, 0);\n          image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', canvas.toDataURL('image/png'));\n          resolve(true);\n        };\n      });\n    }));\n  };\n\n  var cachedFonts = {};\n  var inlineFonts = function inlineFonts(fonts) {\n    return Promise.all(fonts.map(function (font) {\n      return new Promise(function (resolve, reject) {\n        if (cachedFonts[font.url]) return resolve(cachedFonts[font.url]);\n\n        var req = new XMLHttpRequest();\n        req.addEventListener('load', function () {\n          // TODO: it may also be worth it to wait until fonts are fully loaded before\n          // attempting to rasterize them. (e.g. use https://developer.mozilla.org/en-US/docs/Web/API/FontFaceSet)\n          var fontInBase64 = arrayBufferToBase64(req.response);\n          var fontUri = font.text.replace(urlRegex, 'url(\"data:' + font.format + ';base64,' + fontInBase64 + '\")') + '\\n';\n          cachedFonts[font.url] = fontUri;\n          resolve(fontUri);\n        });\n        req.addEventListener('error', function (e) {\n          console.warn('Failed to load font from: ' + font.url, e);\n          cachedFonts[font.url] = null;\n          resolve(null);\n        });\n        req.addEventListener('abort', function (e) {\n          console.warn('Aborted loading font from: ' + font.url, e);\n          resolve(null);\n        });\n        req.open('GET', font.url);\n        req.responseType = 'arraybuffer';\n        req.send();\n      });\n    })).then(function (fontCss) {\n      return fontCss.filter(function (x) {\n        return x;\n      }).join('');\n    });\n  };\n\n  var cachedRules = null;\n  var styleSheetRules = function styleSheetRules() {\n    if (cachedRules) return cachedRules;\n    return cachedRules = Array.from(document.styleSheets).map(function (sheet) {\n      try {\n        return { rules: sheet.cssRules, href: sheet.href };\n      } catch (e) {\n        console.warn('Stylesheet could not be loaded: ' + sheet.href, e);\n        return {};\n      }\n    });\n  };\n\n  var inlineCss = function inlineCss(el, options) {\n    var _ref = options || {},\n        selectorRemap = _ref.selectorRemap,\n        modifyStyle = _ref.modifyStyle,\n        modifyCss = _ref.modifyCss,\n        fonts = _ref.fonts,\n        excludeUnusedCss = _ref.excludeUnusedCss;\n\n    var generateCss = modifyCss || function (selector, properties) {\n      var sel = selectorRemap ? selectorRemap(selector) : selector;\n      var props = modifyStyle ? modifyStyle(properties) : properties;\n      return sel + '{' + props + '}\\n';\n    };\n    var css = [];\n    var detectFonts = typeof fonts === 'undefined';\n    var fontList = fonts || [];\n    styleSheetRules().forEach(function (_ref2) {\n      var rules = _ref2.rules,\n          href = _ref2.href;\n\n      if (!rules) return;\n      Array.from(rules).forEach(function (rule) {\n        if (typeof rule.style != 'undefined') {\n          if (query(el, rule.selectorText)) css.push(generateCss(rule.selectorText, rule.style.cssText));else if (detectFonts && rule.cssText.match(/^@font-face/)) {\n            var font = detectCssFont(rule, href);\n            if (font) fontList.push(font);\n          } else if (!excludeUnusedCss) {\n            css.push(rule.cssText);\n          }\n        }\n      });\n    });\n\n    return inlineFonts(fontList).then(function (fontCss) {\n      return css.join('\\n') + fontCss;\n    });\n  };\n\n  var downloadOptions = function downloadOptions() {\n    if (!navigator.msSaveOrOpenBlob && !('download' in document.createElement('a'))) {\n      return { popup: window.open() };\n    }\n  };\n\n  out$.prepareSvg = function (el, options, done) {\n    requireDomNode(el);\n\n    var _ref3 = options || {},\n        _ref3$left = _ref3.left,\n        left = _ref3$left === undefined ? 0 : _ref3$left,\n        _ref3$top = _ref3.top,\n        top = _ref3$top === undefined ? 0 : _ref3$top,\n        w = _ref3.width,\n        h = _ref3.height,\n        _ref3$scale = _ref3.scale,\n        scale = _ref3$scale === undefined ? 1 : _ref3$scale,\n        _ref3$responsive = _ref3.responsive,\n        responsive = _ref3$responsive === undefined ? false : _ref3$responsive,\n        _ref3$excludeCss = _ref3.excludeCss,\n        excludeCss = _ref3$excludeCss === undefined ? false : _ref3$excludeCss;\n\n    return inlineImages(el).then(function () {\n      var clone = el.cloneNode(true);\n      clone.style.backgroundColor = (options || {}).backgroundColor || el.style.backgroundColor;\n\n      var _getDimensions = getDimensions(el, clone, w, h),\n          width = _getDimensions.width,\n          height = _getDimensions.height;\n\n      if (el.tagName !== 'svg') {\n        if (el.getBBox) {\n          if (clone.getAttribute('transform') != null) {\n            clone.setAttribute('transform', clone.getAttribute('transform').replace(/translate\\(.*?\\)/, ''));\n          }\n          var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n          svg.appendChild(clone);\n          clone = svg;\n        } else {\n          console.error('Attempted to render non-SVG element', el);\n          return;\n        }\n      }\n\n      clone.setAttribute('version', '1.1');\n      clone.setAttribute('viewBox', [left, top, width, height].join(' '));\n      if (!clone.getAttribute('xmlns')) clone.setAttributeNS(xmlNs, 'xmlns', svgNs);\n      if (!clone.getAttribute('xmlns:xlink')) clone.setAttributeNS(xmlNs, 'xmlns:xlink', 'http://www.w3.org/1999/xlink');\n\n      if (responsive) {\n        clone.removeAttribute('width');\n        clone.removeAttribute('height');\n        clone.setAttribute('preserveAspectRatio', 'xMinYMin meet');\n      } else {\n        clone.setAttribute('width', width * scale);\n        clone.setAttribute('height', height * scale);\n      }\n\n      Array.from(clone.querySelectorAll('foreignObject > *')).forEach(function (foreignObject) {\n        foreignObject.setAttributeNS(xmlNs, 'xmlns', foreignObject.tagName === 'svg' ? svgNs : xhtmlNs);\n      });\n\n      if (excludeCss) {\n        var outer = document.createElement('div');\n        outer.appendChild(clone);\n        var src = outer.innerHTML;\n        if (typeof done === 'function') done(src, width, height);else return { src: src, width: width, height: height };\n      } else {\n        return inlineCss(el, options).then(function (css) {\n          var style = document.createElement('style');\n          style.setAttribute('type', 'text/css');\n          style.innerHTML = '<![CDATA[\\n' + css + '\\n]]>';\n\n          var defs = document.createElement('defs');\n          defs.appendChild(style);\n          clone.insertBefore(defs, clone.firstChild);\n\n          var outer = document.createElement('div');\n          outer.appendChild(clone);\n          var src = outer.innerHTML.replace(/NS\\d+:href/gi, 'xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href');\n\n          if (typeof done === 'function') done(src, width, height);else return { src: src, width: width, height: height };\n        });\n      }\n    });\n  };\n\n  out$.svgAsDataUri = function (el, options, done) {\n    requireDomNode(el);\n    return out$.prepareSvg(el, options).then(function (_ref4) {\n      var src = _ref4.src,\n          width = _ref4.width,\n          height = _ref4.height;\n\n      var svgXml = 'data:image/svg+xml;base64,' + window.btoa(reEncode(doctype + src));\n      if (typeof done === 'function') {\n        done(svgXml, width, height);\n      }\n      return svgXml;\n    });\n  };\n\n  out$.svgAsPngUri = function (el, options, done) {\n    requireDomNode(el);\n\n    var _ref5 = options || {},\n        _ref5$encoderType = _ref5.encoderType,\n        encoderType = _ref5$encoderType === undefined ? 'image/png' : _ref5$encoderType,\n        _ref5$encoderOptions = _ref5.encoderOptions,\n        encoderOptions = _ref5$encoderOptions === undefined ? 0.8 : _ref5$encoderOptions,\n        canvg = _ref5.canvg;\n\n    var convertToPng = function convertToPng(_ref6) {\n      var src = _ref6.src,\n          width = _ref6.width,\n          height = _ref6.height;\n\n      var canvas = document.createElement('canvas');\n      var context = canvas.getContext('2d');\n      var pixelRatio = window.devicePixelRatio || 1;\n\n      canvas.width = width * pixelRatio;\n      canvas.height = height * pixelRatio;\n      canvas.style.width = canvas.width + 'px';\n      canvas.style.height = canvas.height + 'px';\n      context.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n\n      if (canvg) canvg(canvas, src);else context.drawImage(src, 0, 0);\n\n      var png = void 0;\n      try {\n        png = canvas.toDataURL(encoderType, encoderOptions);\n      } catch (e) {\n        if (typeof SecurityError !== 'undefined' && e instanceof SecurityError || e.name === 'SecurityError') {\n          console.error('Rendered SVG images cannot be downloaded in this browser.');\n          return;\n        } else throw e;\n      }\n      if (typeof done === 'function') done(png, canvas.width, canvas.height);\n      return Promise.resolve(png);\n    };\n\n    if (canvg) return out$.prepareSvg(el, options).then(convertToPng);else return out$.svgAsDataUri(el, options).then(function (uri) {\n      return new Promise(function (resolve, reject) {\n        var image = new Image();\n        image.onload = function () {\n          return resolve(convertToPng({\n            src: image,\n            width: image.width,\n            height: image.height\n          }));\n        };\n        image.onerror = function () {\n          reject('There was an error loading the data URI as an image on the following SVG\\n' + window.atob(uri.slice(26)) + 'Open the following link to see browser\\'s diagnosis\\n' + uri);\n        };\n        image.src = uri;\n      });\n    });\n  };\n\n  out$.download = function (name, uri, options) {\n    if (navigator.msSaveOrOpenBlob) navigator.msSaveOrOpenBlob(uriToBlob(uri), name);else {\n      var saveLink = document.createElement('a');\n      if ('download' in saveLink) {\n        saveLink.download = name;\n        saveLink.style.display = 'none';\n        document.body.appendChild(saveLink);\n        try {\n          var blob = uriToBlob(uri);\n          var url = URL.createObjectURL(blob);\n          saveLink.href = url;\n          saveLink.onclick = function () {\n            return requestAnimationFrame(function () {\n              return URL.revokeObjectURL(url);\n            });\n          };\n        } catch (e) {\n          console.error(e);\n          console.warn('Error while getting object URL. Falling back to string URL.');\n          saveLink.href = uri;\n        }\n        saveLink.click();\n        document.body.removeChild(saveLink);\n      } else if (options && options.popup) {\n        options.popup.document.title = name;\n        options.popup.location.replace(uri);\n      }\n    }\n  };\n\n  out$.saveSvg = function (el, name, options) {\n    var downloadOpts = downloadOptions(); // don't inline, can't be async\n    return requireDomNodePromise(el).then(function (el) {\n      return out$.svgAsDataUri(el, options || {});\n    }).then(function (uri) {\n      return out$.download(name, uri, downloadOpts);\n    });\n  };\n\n  out$.saveSvgAsPng = function (el, name, options) {\n    var downloadOpts = downloadOptions(); // don't inline, can't be async\n    return requireDomNodePromise(el).then(function (el) {\n      return out$.svgAsPngUri(el, options || {});\n    }).then(function (uri) {\n      return out$.download(name, uri, downloadOpts);\n    });\n  };\n})();","\"use strict\";\n\nvar stylesInDOM = [];\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n  for (var i = 0; i < stylesInDOM.length; i++) {\n    if (stylesInDOM[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n  return result;\n}\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var indexByIdentifier = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3],\n      supports: item[4],\n      layer: item[5]\n    };\n    if (indexByIdentifier !== -1) {\n      stylesInDOM[indexByIdentifier].references++;\n      stylesInDOM[indexByIdentifier].updater(obj);\n    } else {\n      var updater = addElementStyle(obj, options);\n      options.byIndex = i;\n      stylesInDOM.splice(i, 0, {\n        identifier: identifier,\n        updater: updater,\n        references: 1\n      });\n    }\n    identifiers.push(identifier);\n  }\n  return identifiers;\n}\nfunction addElementStyle(obj, options) {\n  var api = options.domAPI(options);\n  api.update(obj);\n  var updater = function updater(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap && newObj.supports === obj.supports && newObj.layer === obj.layer) {\n        return;\n      }\n      api.update(obj = newObj);\n    } else {\n      api.remove();\n    }\n  };\n  return updater;\n}\nmodule.exports = function (list, options) {\n  options = options || {};\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDOM[index].references--;\n    }\n    var newLastIdentifiers = modulesToDom(newList, options);\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n      var _index = getIndexByIdentifier(_identifier);\n      if (stylesInDOM[_index].references === 0) {\n        stylesInDOM[_index].updater();\n        stylesInDOM.splice(_index, 1);\n      }\n    }\n    lastIdentifiers = newLastIdentifiers;\n  };\n};","\"use strict\";\n\nvar memo = {};\n\n/* istanbul ignore next  */\nfunction getTarget(target) {\n  if (typeof memo[target] === \"undefined\") {\n    var styleTarget = document.querySelector(target);\n\n    // Special case to return head of iframe instead of iframe itself\n    if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n      try {\n        // This will throw an exception if access to iframe is blocked\n        // due to cross-origin restrictions\n        styleTarget = styleTarget.contentDocument.head;\n      } catch (e) {\n        // istanbul ignore next\n        styleTarget = null;\n      }\n    }\n    memo[target] = styleTarget;\n  }\n  return memo[target];\n}\n\n/* istanbul ignore next  */\nfunction insertBySelector(insert, style) {\n  var target = getTarget(insert);\n  if (!target) {\n    throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n  }\n  target.appendChild(style);\n}\nmodule.exports = insertBySelector;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction insertStyleElement(options) {\n  var element = document.createElement(\"style\");\n  options.setAttributes(element, options.attributes);\n  options.insert(element, options.options);\n  return element;\n}\nmodule.exports = insertStyleElement;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction setAttributesWithoutAttributes(styleElement) {\n  var nonce = typeof __webpack_nonce__ !== \"undefined\" ? __webpack_nonce__ : null;\n  if (nonce) {\n    styleElement.setAttribute(\"nonce\", nonce);\n  }\n}\nmodule.exports = setAttributesWithoutAttributes;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction apply(styleElement, options, obj) {\n  var css = \"\";\n  if (obj.supports) {\n    css += \"@supports (\".concat(obj.supports, \") {\");\n  }\n  if (obj.media) {\n    css += \"@media \".concat(obj.media, \" {\");\n  }\n  var needLayer = typeof obj.layer !== \"undefined\";\n  if (needLayer) {\n    css += \"@layer\".concat(obj.layer.length > 0 ? \" \".concat(obj.layer) : \"\", \" {\");\n  }\n  css += obj.css;\n  if (needLayer) {\n    css += \"}\";\n  }\n  if (obj.media) {\n    css += \"}\";\n  }\n  if (obj.supports) {\n    css += \"}\";\n  }\n  var sourceMap = obj.sourceMap;\n  if (sourceMap && typeof btoa !== \"undefined\") {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  }\n\n  // For old IE\n  /* istanbul ignore if  */\n  options.styleTagTransform(css, styleElement, options.options);\n}\nfunction removeStyleElement(styleElement) {\n  // istanbul ignore if\n  if (styleElement.parentNode === null) {\n    return false;\n  }\n  styleElement.parentNode.removeChild(styleElement);\n}\n\n/* istanbul ignore next  */\nfunction domAPI(options) {\n  if (typeof document === \"undefined\") {\n    return {\n      update: function update() {},\n      remove: function remove() {}\n    };\n  }\n  var styleElement = options.insertStyleElement(options);\n  return {\n    update: function update(obj) {\n      apply(styleElement, options, obj);\n    },\n    remove: function remove() {\n      removeStyleElement(styleElement);\n    }\n  };\n}\nmodule.exports = domAPI;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction styleTagTransform(css, styleElement) {\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css;\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild);\n    }\n    styleElement.appendChild(document.createTextNode(css));\n  }\n}\nmodule.exports = styleTagTransform;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var getCurrentScript = function() {\n    var script = document.currentScript;\n    if (!script) {\n        /* Shim for IE11 and below */\n        /* Do not take into account async scripts and inline scripts */\n\n        var doc_scripts = document.getElementsByTagName('script');\n        var scripts = [];\n\n        for (var i = 0; i < doc_scripts.length; i++) {\n            scripts.push(doc_scripts[i]);\n        }\n\n        scripts = scripts.filter(function(s) { return !s.async && !s.text && !s.textContent; });\n        script = scripts.slice(-1)[0];\n    }\n\n    return script;\n};\n\nvar isLocalScript = function(script) {\n    return /\\/_dash-component-suites\\//.test(script.src);\n};\n\nObject.defineProperty(__webpack_require__, 'p', {\n    get: (function () {\n        var script = getCurrentScript();\n\n        var url = script.src.split('/').slice(0, -1).join('/') + '/';\n\n        return function() {\n            return url;\n        };\n    })()\n});\n\nif (typeof jsonpScriptSrc !== 'undefined') {\n    var __jsonpScriptSrc__ = jsonpScriptSrc;\n    jsonpScriptSrc = function(chunkId) {\n        var script = getCurrentScript();\n        var isLocal = isLocalScript(script);\n\n        var src = __jsonpScriptSrc__(chunkId);\n\n        if(!isLocal) {\n            return src;\n        }\n\n        var srcFragments = src.split('/');\n        var fileFragments = srcFragments.slice(-1)[0].split('.');\n\n        fileFragments.splice(1, 0, \"v0_0_1m1737944403\");\n        srcFragments.splice(-1, 1, fileFragments.join('.'))\n\n        return srcFragments.join('/');\n    };\n}\n","__webpack_require__.nc = undefined;","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"React\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"PropTypes\"];","import React, { useEffect, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { saveSvgAsPng, svgAsPngUri } from 'save-svg-as-png';\n\nconst Mermaid = (props) => {\n    const { id, chart, config, className, export_trigger, setProps } = props;\n    const mermaidRef = useRef(null);\n    const scriptRef = useRef(null);\n    const [lastExportTrigger, setLastExportTrigger] = React.useState(export_trigger);\n    \n    // Export function\n    const generateImage = async () => {\n        console.log('Starting Mermaid diagram export...');\n        \n        try {\n            // Find the SVG element\n            const svgElement = mermaidRef.current.querySelector('svg');\n            if (!svgElement) {\n                console.error('SVG element not found in Mermaid diagram');\n                return;\n            }\n\n            // Generate timestamp for filename\n            const now = new Date();\n            const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, \"0\")}-${String(now.getDate()).padStart(2, \"0\")}`;\n            const timeStr = `${String(now.getHours()).padStart(2, \"0\")}${String(now.getMinutes()).padStart(2, \"0\")}${String(now.getSeconds()).padStart(2, \"0\")}`;\n            const fileName = `mermaid_${dateStr}_${timeStr}.png`;\n\n            console.log('Found SVG, preparing to export...', {\n                width: svgElement.width.baseVal.value,\n                height: svgElement.height.baseVal.value,\n                viewBox: svgElement.getAttribute('viewBox')\n            });\n\n            // Export options\n            const options = {\n                scale: 2,                    // Higher quality\n                backgroundColor: '#ffffff',  // White background\n                encoderOptions: 1,           // Highest quality\n                encoderType: 'image/png',\n                fonts: [],                   // Auto-detect fonts\n                excludeUnusedCss: true,      // Optimize CSS\n                width: svgElement.width.baseVal.value,\n                height: svgElement.height.baseVal.value\n            };\n\n            // First try to get the PNG URI to verify the conversion works\n            try {\n                const uri = await svgAsPngUri(svgElement, options);\n                console.log('Successfully generated PNG URI');\n                \n                // If URI generation successful, save the file\n                await saveSvgAsPng(svgElement, fileName, options);\n                console.log('Export completed successfully');\n            } catch (error) {\n                console.error('Error during PNG conversion:', error);\n                throw error;\n            }\n\n        } catch (error) {\n            console.error('Error in generateImage:', error);\n        }\n    };\n\n    // Watch for changes to export_trigger\n    useEffect(() => {\n        if (export_trigger !== lastExportTrigger) {\n            console.log('Export triggered');\n            generateImage();\n            setLastExportTrigger(export_trigger);\n            // Report back that the export was handled\n            if (setProps) {\n                setProps({ export_trigger: export_trigger });\n            }\n        }\n    }, [export_trigger, lastExportTrigger, setProps]);\n\n    // Original Mermaid initialization code\n    useEffect(() => {\n        const loadScript = () => {\n            return new Promise((resolve, reject) => {\n                if (window.mermaid) {\n                    resolve();\n                    return;\n                }\n\n                if (scriptRef.current) {\n                    scriptRef.current.addEventListener('load', () => resolve());\n                    scriptRef.current.addEventListener('error', () => reject());\n                    return;\n                }\n\n                const script = document.createElement('script');\n                script.src = \"https://unpkg.com/mermaid@11.4.1/dist/mermaid.min.js\";\n                script.async = true;\n                script.onload = () => resolve();\n                script.onerror = () => reject();\n                \n                scriptRef.current = script;\n                document.body.appendChild(script);\n            });\n        };\n\n        const initializeMermaid = () => {\n            if (!window.mermaid) return false;\n            \n            const defaultConfig = {\n                startOnLoad: true,\n                theme: 'default',\n                securityLevel: 'loose'\n            };\n            \n            window.mermaid.initialize({ ...defaultConfig, ...config });\n            return true;\n        };\n\n        const renderDiagram = async () => {\n            if (!mermaidRef.current || !chart) return;\n\n            try {\n                await loadScript();\n                \n                if (!initializeMermaid()) {\n                    throw new Error('Failed to initialize Mermaid');\n                }\n\n                mermaidRef.current.innerHTML = '';\n\n                const element = document.createElement('pre');\n                element.className = 'mermaid';\n                element.textContent = chart;\n                mermaidRef.current.appendChild(element);\n\n                await window.mermaid.run({\n                    nodes: [element]\n                });\n\n            } catch (err) {\n                console.error('Mermaid rendering error:', err);\n                if (mermaidRef.current) {\n                    mermaidRef.current.innerHTML = `\n                        <div style=\"color: red; padding: 10px; border: 1px solid red; border-radius: 4px;\">\n                            Error rendering diagram: ${err.message || 'Unknown error'}\n                        </div>`;\n                }\n            }\n        };\n\n        renderDiagram();\n\n        return () => {\n            if (scriptRef.current && scriptRef.current.parentNode) {\n                scriptRef.current.parentNode.removeChild(scriptRef.current);\n                scriptRef.current = null;\n            }\n        };\n    }, [chart, config]);\n\n    return (\n        <div \n            id={id}\n            className={className}\n            ref={mermaidRef}\n            style={{ \n                width: '100%',\n                minHeight: '100px',\n                backgroundColor: '#ffffff',\n                padding: '20px'\n            }}\n        />\n    );\n};\n\nMermaid.defaultProps = {\n    className: '',\n    config: null,\n    export_trigger: 0\n};\n\nMermaid.propTypes = {\n    /**\n     * The ID used to identify this component in Dash callbacks.\n     */\n    id: PropTypes.string.isRequired,\n\n    /**\n     * The Mermaid diagram definition in text format.\n     */\n    chart: PropTypes.string.isRequired,\n\n    /**\n     * Optional configuration object for Mermaid initialization.\n     */\n    config: PropTypes.object,\n\n    /**\n     * Optional CSS class name for the container div.\n     */\n    className: PropTypes.string,\n\n    /**\n     * Trigger for exporting the diagram as PNG.\n     */\n    export_trigger: PropTypes.number,\n\n    /**\n     * Dash callback setter\n     */\n    setProps: PropTypes.func\n};\n\nexport default Mermaid;\n","import { useReducer, useRef, useDebugValue, useEffect, useLayoutEffect } from 'react';\n\nfunction createStore(createState) {\n  let state;\n  const listeners = /* @__PURE__ */ new Set();\n  const setState = (partial, replace) => {\n    const nextState = typeof partial === \"function\" ? partial(state) : partial;\n    if (nextState !== state) {\n      const previousState = state;\n      state = replace ? nextState : Object.assign({}, state, nextState);\n      listeners.forEach((listener) => listener(state, previousState));\n    }\n  };\n  const getState = () => state;\n  const subscribeWithSelector = (listener, selector = getState, equalityFn = Object.is) => {\n    console.warn(\"[DEPRECATED] Please use `subscribeWithSelector` middleware\");\n    let currentSlice = selector(state);\n    function listenerToAdd() {\n      const nextSlice = selector(state);\n      if (!equalityFn(currentSlice, nextSlice)) {\n        const previousSlice = currentSlice;\n        listener(currentSlice = nextSlice, previousSlice);\n      }\n    }\n    listeners.add(listenerToAdd);\n    return () => listeners.delete(listenerToAdd);\n  };\n  const subscribe = (listener, selector, equalityFn) => {\n    if (selector || equalityFn) {\n      return subscribeWithSelector(listener, selector, equalityFn);\n    }\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  };\n  const destroy = () => listeners.clear();\n  const api = { setState, getState, subscribe, destroy };\n  state = createState(setState, getState, api);\n  return api;\n}\n\nconst isSSR = typeof window === \"undefined\" || !window.navigator || /ServerSideRendering|^Deno\\//.test(window.navigator.userAgent);\nconst useIsomorphicLayoutEffect = isSSR ? useEffect : useLayoutEffect;\nfunction create(createState) {\n  const api = typeof createState === \"function\" ? createStore(createState) : createState;\n  const useStore = (selector = api.getState, equalityFn = Object.is) => {\n    const [, forceUpdate] = useReducer((c) => c + 1, 0);\n    const state = api.getState();\n    const stateRef = useRef(state);\n    const selectorRef = useRef(selector);\n    const equalityFnRef = useRef(equalityFn);\n    const erroredRef = useRef(false);\n    const currentSliceRef = useRef();\n    if (currentSliceRef.current === void 0) {\n      currentSliceRef.current = selector(state);\n    }\n    let newStateSlice;\n    let hasNewStateSlice = false;\n    if (stateRef.current !== state || selectorRef.current !== selector || equalityFnRef.current !== equalityFn || erroredRef.current) {\n      newStateSlice = selector(state);\n      hasNewStateSlice = !equalityFn(currentSliceRef.current, newStateSlice);\n    }\n    useIsomorphicLayoutEffect(() => {\n      if (hasNewStateSlice) {\n        currentSliceRef.current = newStateSlice;\n      }\n      stateRef.current = state;\n      selectorRef.current = selector;\n      equalityFnRef.current = equalityFn;\n      erroredRef.current = false;\n    });\n    const stateBeforeSubscriptionRef = useRef(state);\n    useIsomorphicLayoutEffect(() => {\n      const listener = () => {\n        try {\n          const nextState = api.getState();\n          const nextStateSlice = selectorRef.current(nextState);\n          if (!equalityFnRef.current(currentSliceRef.current, nextStateSlice)) {\n            stateRef.current = nextState;\n            currentSliceRef.current = nextStateSlice;\n            forceUpdate();\n          }\n        } catch (error) {\n          erroredRef.current = true;\n          forceUpdate();\n        }\n      };\n      const unsubscribe = api.subscribe(listener);\n      if (api.getState() !== stateBeforeSubscriptionRef.current) {\n        listener();\n      }\n      return unsubscribe;\n    }, []);\n    const sliceToReturn = hasNewStateSlice ? newStateSlice : currentSliceRef.current;\n    useDebugValue(sliceToReturn);\n    return sliceToReturn;\n  };\n  Object.assign(useStore, api);\n  useStore[Symbol.iterator] = function() {\n    console.warn(\"[useStore, api] = create() is deprecated and will be removed in v4\");\n    const items = [useStore, api];\n    return {\n      next() {\n        const done = items.length <= 0;\n        return { value: items.shift(), done };\n      }\n    };\n  };\n  return useStore;\n}\n\nexport { create as default };\n","var noop = {value: () => {}};\n\nfunction dispatch() {\n  for (var i = 0, n = arguments.length, _ = {}, t; i < n; ++i) {\n    if (!(t = arguments[i] + \"\") || (t in _) || /[\\s.]/.test(t)) throw new Error(\"illegal type: \" + t);\n    _[t] = [];\n  }\n  return new Dispatch(_);\n}\n\nfunction Dispatch(_) {\n  this._ = _;\n}\n\nfunction parseTypenames(typenames, types) {\n  return typenames.trim().split(/^|\\s+/).map(function(t) {\n    var name = \"\", i = t.indexOf(\".\");\n    if (i >= 0) name = t.slice(i + 1), t = t.slice(0, i);\n    if (t && !types.hasOwnProperty(t)) throw new Error(\"unknown type: \" + t);\n    return {type: t, name: name};\n  });\n}\n\nDispatch.prototype = dispatch.prototype = {\n  constructor: Dispatch,\n  on: function(typename, callback) {\n    var _ = this._,\n        T = parseTypenames(typename + \"\", _),\n        t,\n        i = -1,\n        n = T.length;\n\n    // If no callback was specified, return the callback of the given type and name.\n    if (arguments.length < 2) {\n      while (++i < n) if ((t = (typename = T[i]).type) && (t = get(_[t], typename.name))) return t;\n      return;\n    }\n\n    // If a type was specified, set the callback for the given type and name.\n    // Otherwise, if a null callback was specified, remove callbacks of the given name.\n    if (callback != null && typeof callback !== \"function\") throw new Error(\"invalid callback: \" + callback);\n    while (++i < n) {\n      if (t = (typename = T[i]).type) _[t] = set(_[t], typename.name, callback);\n      else if (callback == null) for (t in _) _[t] = set(_[t], typename.name, null);\n    }\n\n    return this;\n  },\n  copy: function() {\n    var copy = {}, _ = this._;\n    for (var t in _) copy[t] = _[t].slice();\n    return new Dispatch(copy);\n  },\n  call: function(type, that) {\n    if ((n = arguments.length - 2) > 0) for (var args = new Array(n), i = 0, n, t; i < n; ++i) args[i] = arguments[i + 2];\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  },\n  apply: function(type, that, args) {\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (var t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  }\n};\n\nfunction get(type, name) {\n  for (var i = 0, n = type.length, c; i < n; ++i) {\n    if ((c = type[i]).name === name) {\n      return c.value;\n    }\n  }\n}\n\nfunction set(type, name, callback) {\n  for (var i = 0, n = type.length; i < n; ++i) {\n    if (type[i].name === name) {\n      type[i] = noop, type = type.slice(0, i).concat(type.slice(i + 1));\n      break;\n    }\n  }\n  if (callback != null) type.push({name: name, value: callback});\n  return type;\n}\n\nexport default dispatch;\n","function none() {}\n\nexport default function(selector) {\n  return selector == null ? none : function() {\n    return this.querySelector(selector);\n  };\n}\n","function empty() {\n  return [];\n}\n\nexport default function(selector) {\n  return selector == null ? empty : function() {\n    return this.querySelectorAll(selector);\n  };\n}\n","export default function(selector) {\n  return function() {\n    return this.matches(selector);\n  };\n}\n\nexport function childMatcher(selector) {\n  return function(node) {\n    return node.matches(selector);\n  };\n}\n\n","import {childMatcher} from \"../matcher.js\";\n\nvar find = Array.prototype.find;\n\nfunction childFind(match) {\n  return function() {\n    return find.call(this.children, match);\n  };\n}\n\nfunction childFirst() {\n  return this.firstElementChild;\n}\n\nexport default function(match) {\n  return this.select(match == null ? childFirst\n      : childFind(typeof match === \"function\" ? match : childMatcher(match)));\n}\n","import {childMatcher} from \"../matcher.js\";\n\nvar filter = Array.prototype.filter;\n\nfunction children() {\n  return Array.from(this.children);\n}\n\nfunction childrenFilter(match) {\n  return function() {\n    return filter.call(this.children, match);\n  };\n}\n\nexport default function(match) {\n  return this.selectAll(match == null ? children\n      : childrenFilter(typeof match === \"function\" ? match : childMatcher(match)));\n}\n","export default function(update) {\n  return new Array(update.length);\n}\n","import sparse from \"./sparse.js\";\nimport {Selection} from \"./index.js\";\n\nexport default function() {\n  return new Selection(this._enter || this._groups.map(sparse), this._parents);\n}\n\nexport function EnterNode(parent, datum) {\n  this.ownerDocument = parent.ownerDocument;\n  this.namespaceURI = parent.namespaceURI;\n  this._next = null;\n  this._parent = parent;\n  this.__data__ = datum;\n}\n\nEnterNode.prototype = {\n  constructor: EnterNode,\n  appendChild: function(child) { return this._parent.insertBefore(child, this._next); },\n  insertBefore: function(child, next) { return this._parent.insertBefore(child, next); },\n  querySelector: function(selector) { return this._parent.querySelector(selector); },\n  querySelectorAll: function(selector) { return this._parent.querySelectorAll(selector); }\n};\n","import {Selection} from \"./index.js\";\nimport {EnterNode} from \"./enter.js\";\nimport constant from \"../constant.js\";\n\nfunction bindIndex(parent, group, enter, update, exit, data) {\n  var i = 0,\n      node,\n      groupLength = group.length,\n      dataLength = data.length;\n\n  // Put any non-null nodes that fit into update.\n  // Put any null nodes into enter.\n  // Put any remaining data into enter.\n  for (; i < dataLength; ++i) {\n    if (node = group[i]) {\n      node.__data__ = data[i];\n      update[i] = node;\n    } else {\n      enter[i] = new EnterNode(parent, data[i]);\n    }\n  }\n\n  // Put any non-null nodes that don’t fit into exit.\n  for (; i < groupLength; ++i) {\n    if (node = group[i]) {\n      exit[i] = node;\n    }\n  }\n}\n\nfunction bindKey(parent, group, enter, update, exit, data, key) {\n  var i,\n      node,\n      nodeByKeyValue = new Map,\n      groupLength = group.length,\n      dataLength = data.length,\n      keyValues = new Array(groupLength),\n      keyValue;\n\n  // Compute the key for each node.\n  // If multiple nodes have the same key, the duplicates are added to exit.\n  for (i = 0; i < groupLength; ++i) {\n    if (node = group[i]) {\n      keyValues[i] = keyValue = key.call(node, node.__data__, i, group) + \"\";\n      if (nodeByKeyValue.has(keyValue)) {\n        exit[i] = node;\n      } else {\n        nodeByKeyValue.set(keyValue, node);\n      }\n    }\n  }\n\n  // Compute the key for each datum.\n  // If there a node associated with this key, join and add it to update.\n  // If there is not (or the key is a duplicate), add it to enter.\n  for (i = 0; i < dataLength; ++i) {\n    keyValue = key.call(parent, data[i], i, data) + \"\";\n    if (node = nodeByKeyValue.get(keyValue)) {\n      update[i] = node;\n      node.__data__ = data[i];\n      nodeByKeyValue.delete(keyValue);\n    } else {\n      enter[i] = new EnterNode(parent, data[i]);\n    }\n  }\n\n  // Add any remaining nodes that were not bound to data to exit.\n  for (i = 0; i < groupLength; ++i) {\n    if ((node = group[i]) && (nodeByKeyValue.get(keyValues[i]) === node)) {\n      exit[i] = node;\n    }\n  }\n}\n\nfunction datum(node) {\n  return node.__data__;\n}\n\nexport default function(value, key) {\n  if (!arguments.length) return Array.from(this, datum);\n\n  var bind = key ? bindKey : bindIndex,\n      parents = this._parents,\n      groups = this._groups;\n\n  if (typeof value !== \"function\") value = constant(value);\n\n  for (var m = groups.length, update = new Array(m), enter = new Array(m), exit = new Array(m), j = 0; j < m; ++j) {\n    var parent = parents[j],\n        group = groups[j],\n        groupLength = group.length,\n        data = arraylike(value.call(parent, parent && parent.__data__, j, parents)),\n        dataLength = data.length,\n        enterGroup = enter[j] = new Array(dataLength),\n        updateGroup = update[j] = new Array(dataLength),\n        exitGroup = exit[j] = new Array(groupLength);\n\n    bind(parent, group, enterGroup, updateGroup, exitGroup, data, key);\n\n    // Now connect the enter nodes to their following update node, such that\n    // appendChild can insert the materialized enter node before this node,\n    // rather than at the end of the parent node.\n    for (var i0 = 0, i1 = 0, previous, next; i0 < dataLength; ++i0) {\n      if (previous = enterGroup[i0]) {\n        if (i0 >= i1) i1 = i0 + 1;\n        while (!(next = updateGroup[i1]) && ++i1 < dataLength);\n        previous._next = next || null;\n      }\n    }\n  }\n\n  update = new Selection(update, parents);\n  update._enter = enter;\n  update._exit = exit;\n  return update;\n}\n\n// Given some data, this returns an array-like view of it: an object that\n// exposes a length property and allows numeric indexing. Note that unlike\n// selectAll, this isn’t worried about “live” collections because the resulting\n// array will only be used briefly while data is being bound. (It is possible to\n// cause the data to change while iterating by using a key function, but please\n// don’t; we’d rather avoid a gratuitous copy.)\nfunction arraylike(data) {\n  return typeof data === \"object\" && \"length\" in data\n    ? data // Array, TypedArray, NodeList, array-like\n    : Array.from(data); // Map, Set, iterable, string, or anything else\n}\n","import {Selection} from \"./index.js\";\n\nexport default function(compare) {\n  if (!compare) compare = ascending;\n\n  function compareNode(a, b) {\n    return a && b ? compare(a.__data__, b.__data__) : !a - !b;\n  }\n\n  for (var groups = this._groups, m = groups.length, sortgroups = new Array(m), j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, sortgroup = sortgroups[j] = new Array(n), node, i = 0; i < n; ++i) {\n      if (node = group[i]) {\n        sortgroup[i] = node;\n      }\n    }\n    sortgroup.sort(compareNode);\n  }\n\n  return new Selection(sortgroups, this._parents).order();\n}\n\nfunction ascending(a, b) {\n  return a < b ? -1 : a > b ? 1 : a >= b ? 0 : NaN;\n}\n","export var xhtml = \"http://www.w3.org/1999/xhtml\";\n\nexport default {\n  svg: \"http://www.w3.org/2000/svg\",\n  xhtml: xhtml,\n  xlink: \"http://www.w3.org/1999/xlink\",\n  xml: \"http://www.w3.org/XML/1998/namespace\",\n  xmlns: \"http://www.w3.org/2000/xmlns/\"\n};\n","import namespaces from \"./namespaces.js\";\n\nexport default function(name) {\n  var prefix = name += \"\", i = prefix.indexOf(\":\");\n  if (i >= 0 && (prefix = name.slice(0, i)) !== \"xmlns\") name = name.slice(i + 1);\n  return namespaces.hasOwnProperty(prefix) ? {space: namespaces[prefix], local: name} : name; // eslint-disable-line no-prototype-builtins\n}\n","import namespace from \"../namespace.js\";\n\nfunction attrRemove(name) {\n  return function() {\n    this.removeAttribute(name);\n  };\n}\n\nfunction attrRemoveNS(fullname) {\n  return function() {\n    this.removeAttributeNS(fullname.space, fullname.local);\n  };\n}\n\nfunction attrConstant(name, value) {\n  return function() {\n    this.setAttribute(name, value);\n  };\n}\n\nfunction attrConstantNS(fullname, value) {\n  return function() {\n    this.setAttributeNS(fullname.space, fullname.local, value);\n  };\n}\n\nfunction attrFunction(name, value) {\n  return function() {\n    var v = value.apply(this, arguments);\n    if (v == null) this.removeAttribute(name);\n    else this.setAttribute(name, v);\n  };\n}\n\nfunction attrFunctionNS(fullname, value) {\n  return function() {\n    var v = value.apply(this, arguments);\n    if (v == null) this.removeAttributeNS(fullname.space, fullname.local);\n    else this.setAttributeNS(fullname.space, fullname.local, v);\n  };\n}\n\nexport default function(name, value) {\n  var fullname = namespace(name);\n\n  if (arguments.length < 2) {\n    var node = this.node();\n    return fullname.local\n        ? node.getAttributeNS(fullname.space, fullname.local)\n        : node.getAttribute(fullname);\n  }\n\n  return this.each((value == null\n      ? (fullname.local ? attrRemoveNS : attrRemove) : (typeof value === \"function\"\n      ? (fullname.local ? attrFunctionNS : attrFunction)\n      : (fullname.local ? attrConstantNS : attrConstant)))(fullname, value));\n}\n","export default function(node) {\n  return (node.ownerDocument && node.ownerDocument.defaultView) // node is a Node\n      || (node.document && node) // node is a Window\n      || node.defaultView; // node is a Document\n}\n","import defaultView from \"../window.js\";\n\nfunction styleRemove(name) {\n  return function() {\n    this.style.removeProperty(name);\n  };\n}\n\nfunction styleConstant(name, value, priority) {\n  return function() {\n    this.style.setProperty(name, value, priority);\n  };\n}\n\nfunction styleFunction(name, value, priority) {\n  return function() {\n    var v = value.apply(this, arguments);\n    if (v == null) this.style.removeProperty(name);\n    else this.style.setProperty(name, v, priority);\n  };\n}\n\nexport default function(name, value, priority) {\n  return arguments.length > 1\n      ? this.each((value == null\n            ? styleRemove : typeof value === \"function\"\n            ? styleFunction\n            : styleConstant)(name, value, priority == null ? \"\" : priority))\n      : styleValue(this.node(), name);\n}\n\nexport function styleValue(node, name) {\n  return node.style.getPropertyValue(name)\n      || defaultView(node).getComputedStyle(node, null).getPropertyValue(name);\n}\n","function propertyRemove(name) {\n  return function() {\n    delete this[name];\n  };\n}\n\nfunction propertyConstant(name, value) {\n  return function() {\n    this[name] = value;\n  };\n}\n\nfunction propertyFunction(name, value) {\n  return function() {\n    var v = value.apply(this, arguments);\n    if (v == null) delete this[name];\n    else this[name] = v;\n  };\n}\n\nexport default function(name, value) {\n  return arguments.length > 1\n      ? this.each((value == null\n          ? propertyRemove : typeof value === \"function\"\n          ? propertyFunction\n          : propertyConstant)(name, value))\n      : this.node()[name];\n}\n","function classArray(string) {\n  return string.trim().split(/^|\\s+/);\n}\n\nfunction classList(node) {\n  return node.classList || new ClassList(node);\n}\n\nfunction ClassList(node) {\n  this._node = node;\n  this._names = classArray(node.getAttribute(\"class\") || \"\");\n}\n\nClassList.prototype = {\n  add: function(name) {\n    var i = this._names.indexOf(name);\n    if (i < 0) {\n      this._names.push(name);\n      this._node.setAttribute(\"class\", this._names.join(\" \"));\n    }\n  },\n  remove: function(name) {\n    var i = this._names.indexOf(name);\n    if (i >= 0) {\n      this._names.splice(i, 1);\n      this._node.setAttribute(\"class\", this._names.join(\" \"));\n    }\n  },\n  contains: function(name) {\n    return this._names.indexOf(name) >= 0;\n  }\n};\n\nfunction classedAdd(node, names) {\n  var list = classList(node), i = -1, n = names.length;\n  while (++i < n) list.add(names[i]);\n}\n\nfunction classedRemove(node, names) {\n  var list = classList(node), i = -1, n = names.length;\n  while (++i < n) list.remove(names[i]);\n}\n\nfunction classedTrue(names) {\n  return function() {\n    classedAdd(this, names);\n  };\n}\n\nfunction classedFalse(names) {\n  return function() {\n    classedRemove(this, names);\n  };\n}\n\nfunction classedFunction(names, value) {\n  return function() {\n    (value.apply(this, arguments) ? classedAdd : classedRemove)(this, names);\n  };\n}\n\nexport default function(name, value) {\n  var names = classArray(name + \"\");\n\n  if (arguments.length < 2) {\n    var list = classList(this.node()), i = -1, n = names.length;\n    while (++i < n) if (!list.contains(names[i])) return false;\n    return true;\n  }\n\n  return this.each((typeof value === \"function\"\n      ? classedFunction : value\n      ? classedTrue\n      : classedFalse)(names, value));\n}\n","function textRemove() {\n  this.textContent = \"\";\n}\n\nfunction textConstant(value) {\n  return function() {\n    this.textContent = value;\n  };\n}\n\nfunction textFunction(value) {\n  return function() {\n    var v = value.apply(this, arguments);\n    this.textContent = v == null ? \"\" : v;\n  };\n}\n\nexport default function(value) {\n  return arguments.length\n      ? this.each(value == null\n          ? textRemove : (typeof value === \"function\"\n          ? textFunction\n          : textConstant)(value))\n      : this.node().textContent;\n}\n","function htmlRemove() {\n  this.innerHTML = \"\";\n}\n\nfunction htmlConstant(value) {\n  return function() {\n    this.innerHTML = value;\n  };\n}\n\nfunction htmlFunction(value) {\n  return function() {\n    var v = value.apply(this, arguments);\n    this.innerHTML = v == null ? \"\" : v;\n  };\n}\n\nexport default function(value) {\n  return arguments.length\n      ? this.each(value == null\n          ? htmlRemove : (typeof value === \"function\"\n          ? htmlFunction\n          : htmlConstant)(value))\n      : this.node().innerHTML;\n}\n","function raise() {\n  if (this.nextSibling) this.parentNode.appendChild(this);\n}\n\nexport default function() {\n  return this.each(raise);\n}\n","function lower() {\n  if (this.previousSibling) this.parentNode.insertBefore(this, this.parentNode.firstChild);\n}\n\nexport default function() {\n  return this.each(lower);\n}\n","import namespace from \"./namespace.js\";\nimport {xhtml} from \"./namespaces.js\";\n\nfunction creatorInherit(name) {\n  return function() {\n    var document = this.ownerDocument,\n        uri = this.namespaceURI;\n    return uri === xhtml && document.documentElement.namespaceURI === xhtml\n        ? document.createElement(name)\n        : document.createElementNS(uri, name);\n  };\n}\n\nfunction creatorFixed(fullname) {\n  return function() {\n    return this.ownerDocument.createElementNS(fullname.space, fullname.local);\n  };\n}\n\nexport default function(name) {\n  var fullname = namespace(name);\n  return (fullname.local\n      ? creatorFixed\n      : creatorInherit)(fullname);\n}\n","import creator from \"../creator.js\";\nimport selector from \"../selector.js\";\n\nfunction constantNull() {\n  return null;\n}\n\nexport default function(name, before) {\n  var create = typeof name === \"function\" ? name : creator(name),\n      select = before == null ? constantNull : typeof before === \"function\" ? before : selector(before);\n  return this.select(function() {\n    return this.insertBefore(create.apply(this, arguments), select.apply(this, arguments) || null);\n  });\n}\n","function remove() {\n  var parent = this.parentNode;\n  if (parent) parent.removeChild(this);\n}\n\nexport default function() {\n  return this.each(remove);\n}\n","function selection_cloneShallow() {\n  var clone = this.cloneNode(false), parent = this.parentNode;\n  return parent ? parent.insertBefore(clone, this.nextSibling) : clone;\n}\n\nfunction selection_cloneDeep() {\n  var clone = this.cloneNode(true), parent = this.parentNode;\n  return parent ? parent.insertBefore(clone, this.nextSibling) : clone;\n}\n\nexport default function(deep) {\n  return this.select(deep ? selection_cloneDeep : selection_cloneShallow);\n}\n","function contextListener(listener) {\n  return function(event) {\n    listener.call(this, event, this.__data__);\n  };\n}\n\nfunction parseTypenames(typenames) {\n  return typenames.trim().split(/^|\\s+/).map(function(t) {\n    var name = \"\", i = t.indexOf(\".\");\n    if (i >= 0) name = t.slice(i + 1), t = t.slice(0, i);\n    return {type: t, name: name};\n  });\n}\n\nfunction onRemove(typename) {\n  return function() {\n    var on = this.__on;\n    if (!on) return;\n    for (var j = 0, i = -1, m = on.length, o; j < m; ++j) {\n      if (o = on[j], (!typename.type || o.type === typename.type) && o.name === typename.name) {\n        this.removeEventListener(o.type, o.listener, o.options);\n      } else {\n        on[++i] = o;\n      }\n    }\n    if (++i) on.length = i;\n    else delete this.__on;\n  };\n}\n\nfunction onAdd(typename, value, options) {\n  return function() {\n    var on = this.__on, o, listener = contextListener(value);\n    if (on) for (var j = 0, m = on.length; j < m; ++j) {\n      if ((o = on[j]).type === typename.type && o.name === typename.name) {\n        this.removeEventListener(o.type, o.listener, o.options);\n        this.addEventListener(o.type, o.listener = listener, o.options = options);\n        o.value = value;\n        return;\n      }\n    }\n    this.addEventListener(typename.type, listener, options);\n    o = {type: typename.type, name: typename.name, value: value, listener: listener, options: options};\n    if (!on) this.__on = [o];\n    else on.push(o);\n  };\n}\n\nexport default function(typename, value, options) {\n  var typenames = parseTypenames(typename + \"\"), i, n = typenames.length, t;\n\n  if (arguments.length < 2) {\n    var on = this.node().__on;\n    if (on) for (var j = 0, m = on.length, o; j < m; ++j) {\n      for (i = 0, o = on[j]; i < n; ++i) {\n        if ((t = typenames[i]).type === o.type && t.name === o.name) {\n          return o.value;\n        }\n      }\n    }\n    return;\n  }\n\n  on = value ? onAdd : onRemove;\n  for (i = 0; i < n; ++i) this.each(on(typenames[i], value, options));\n  return this;\n}\n","import defaultView from \"../window.js\";\n\nfunction dispatchEvent(node, type, params) {\n  var window = defaultView(node),\n      event = window.CustomEvent;\n\n  if (typeof event === \"function\") {\n    event = new event(type, params);\n  } else {\n    event = window.document.createEvent(\"Event\");\n    if (params) event.initEvent(type, params.bubbles, params.cancelable), event.detail = params.detail;\n    else event.initEvent(type, false, false);\n  }\n\n  node.dispatchEvent(event);\n}\n\nfunction dispatchConstant(type, params) {\n  return function() {\n    return dispatchEvent(this, type, params);\n  };\n}\n\nfunction dispatchFunction(type, params) {\n  return function() {\n    return dispatchEvent(this, type, params.apply(this, arguments));\n  };\n}\n\nexport default function(type, params) {\n  return this.each((typeof params === \"function\"\n      ? dispatchFunction\n      : dispatchConstant)(type, params));\n}\n","import selection_select from \"./select.js\";\nimport selection_selectAll from \"./selectAll.js\";\nimport selection_selectChild from \"./selectChild.js\";\nimport selection_selectChildren from \"./selectChildren.js\";\nimport selection_filter from \"./filter.js\";\nimport selection_data from \"./data.js\";\nimport selection_enter from \"./enter.js\";\nimport selection_exit from \"./exit.js\";\nimport selection_join from \"./join.js\";\nimport selection_merge from \"./merge.js\";\nimport selection_order from \"./order.js\";\nimport selection_sort from \"./sort.js\";\nimport selection_call from \"./call.js\";\nimport selection_nodes from \"./nodes.js\";\nimport selection_node from \"./node.js\";\nimport selection_size from \"./size.js\";\nimport selection_empty from \"./empty.js\";\nimport selection_each from \"./each.js\";\nimport selection_attr from \"./attr.js\";\nimport selection_style from \"./style.js\";\nimport selection_property from \"./property.js\";\nimport selection_classed from \"./classed.js\";\nimport selection_text from \"./text.js\";\nimport selection_html from \"./html.js\";\nimport selection_raise from \"./raise.js\";\nimport selection_lower from \"./lower.js\";\nimport selection_append from \"./append.js\";\nimport selection_insert from \"./insert.js\";\nimport selection_remove from \"./remove.js\";\nimport selection_clone from \"./clone.js\";\nimport selection_datum from \"./datum.js\";\nimport selection_on from \"./on.js\";\nimport selection_dispatch from \"./dispatch.js\";\nimport selection_iterator from \"./iterator.js\";\n\nexport var root = [null];\n\nexport function Selection(groups, parents) {\n  this._groups = groups;\n  this._parents = parents;\n}\n\nfunction selection() {\n  return new Selection([[document.documentElement]], root);\n}\n\nfunction selection_selection() {\n  return this;\n}\n\nSelection.prototype = selection.prototype = {\n  constructor: Selection,\n  select: selection_select,\n  selectAll: selection_selectAll,\n  selectChild: selection_selectChild,\n  selectChildren: selection_selectChildren,\n  filter: selection_filter,\n  data: selection_data,\n  enter: selection_enter,\n  exit: selection_exit,\n  join: selection_join,\n  merge: selection_merge,\n  selection: selection_selection,\n  order: selection_order,\n  sort: selection_sort,\n  call: selection_call,\n  nodes: selection_nodes,\n  node: selection_node,\n  size: selection_size,\n  empty: selection_empty,\n  each: selection_each,\n  attr: selection_attr,\n  style: selection_style,\n  property: selection_property,\n  classed: selection_classed,\n  text: selection_text,\n  html: selection_html,\n  raise: selection_raise,\n  lower: selection_lower,\n  append: selection_append,\n  insert: selection_insert,\n  remove: selection_remove,\n  clone: selection_clone,\n  datum: selection_datum,\n  on: selection_on,\n  dispatch: selection_dispatch,\n  [Symbol.iterator]: selection_iterator\n};\n\nexport default selection;\n","import {Selection} from \"./index.js\";\nimport selector from \"../selector.js\";\n\nexport default function(select) {\n  if (typeof select !== \"function\") select = selector(select);\n\n  for (var groups = this._groups, m = groups.length, subgroups = new Array(m), j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, subgroup = subgroups[j] = new Array(n), node, subnode, i = 0; i < n; ++i) {\n      if ((node = group[i]) && (subnode = select.call(node, node.__data__, i, group))) {\n        if (\"__data__\" in node) subnode.__data__ = node.__data__;\n        subgroup[i] = subnode;\n      }\n    }\n  }\n\n  return new Selection(subgroups, this._parents);\n}\n","import {Selection} from \"./index.js\";\nimport array from \"../array.js\";\nimport selectorAll from \"../selectorAll.js\";\n\nfunction arrayAll(select) {\n  return function() {\n    return array(select.apply(this, arguments));\n  };\n}\n\nexport default function(select) {\n  if (typeof select === \"function\") select = arrayAll(select);\n  else select = selectorAll(select);\n\n  for (var groups = this._groups, m = groups.length, subgroups = [], parents = [], j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, node, i = 0; i < n; ++i) {\n      if (node = group[i]) {\n        subgroups.push(select.call(node, node.__data__, i, group));\n        parents.push(node);\n      }\n    }\n  }\n\n  return new Selection(subgroups, parents);\n}\n","// Given something array like (or null), returns something that is strictly an\n// array. This is used to ensure that array-like objects passed to d3.selectAll\n// or selection.selectAll are converted into proper arrays when creating a\n// selection; we don’t ever want to create a selection backed by a live\n// HTMLCollection or NodeList. However, note that selection.selectAll will use a\n// static NodeList as a group, since it safely derived from querySelectorAll.\nexport default function array(x) {\n  return x == null ? [] : Array.isArray(x) ? x : Array.from(x);\n}\n","import {Selection} from \"./index.js\";\nimport matcher from \"../matcher.js\";\n\nexport default function(match) {\n  if (typeof match !== \"function\") match = matcher(match);\n\n  for (var groups = this._groups, m = groups.length, subgroups = new Array(m), j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, subgroup = subgroups[j] = [], node, i = 0; i < n; ++i) {\n      if ((node = group[i]) && match.call(node, node.__data__, i, group)) {\n        subgroup.push(node);\n      }\n    }\n  }\n\n  return new Selection(subgroups, this._parents);\n}\n","export default function(x) {\n  return function() {\n    return x;\n  };\n}\n","import sparse from \"./sparse.js\";\nimport {Selection} from \"./index.js\";\n\nexport default function() {\n  return new Selection(this._exit || this._groups.map(sparse), this._parents);\n}\n","export default function(onenter, onupdate, onexit) {\n  var enter = this.enter(), update = this, exit = this.exit();\n  if (typeof onenter === \"function\") {\n    enter = onenter(enter);\n    if (enter) enter = enter.selection();\n  } else {\n    enter = enter.append(onenter + \"\");\n  }\n  if (onupdate != null) {\n    update = onupdate(update);\n    if (update) update = update.selection();\n  }\n  if (onexit == null) exit.remove(); else onexit(exit);\n  return enter && update ? enter.merge(update).order() : update;\n}\n","import {Selection} from \"./index.js\";\n\nexport default function(context) {\n  var selection = context.selection ? context.selection() : context;\n\n  for (var groups0 = this._groups, groups1 = selection._groups, m0 = groups0.length, m1 = groups1.length, m = Math.min(m0, m1), merges = new Array(m0), j = 0; j < m; ++j) {\n    for (var group0 = groups0[j], group1 = groups1[j], n = group0.length, merge = merges[j] = new Array(n), node, i = 0; i < n; ++i) {\n      if (node = group0[i] || group1[i]) {\n        merge[i] = node;\n      }\n    }\n  }\n\n  for (; j < m0; ++j) {\n    merges[j] = groups0[j];\n  }\n\n  return new Selection(merges, this._parents);\n}\n","export default function() {\n\n  for (var groups = this._groups, j = -1, m = groups.length; ++j < m;) {\n    for (var group = groups[j], i = group.length - 1, next = group[i], node; --i >= 0;) {\n      if (node = group[i]) {\n        if (next && node.compareDocumentPosition(next) ^ 4) next.parentNode.insertBefore(node, next);\n        next = node;\n      }\n    }\n  }\n\n  return this;\n}\n","export default function() {\n  var callback = arguments[0];\n  arguments[0] = this;\n  callback.apply(null, arguments);\n  return this;\n}\n","export default function() {\n  return Array.from(this);\n}\n","export default function() {\n\n  for (var groups = this._groups, j = 0, m = groups.length; j < m; ++j) {\n    for (var group = groups[j], i = 0, n = group.length; i < n; ++i) {\n      var node = group[i];\n      if (node) return node;\n    }\n  }\n\n  return null;\n}\n","export default function() {\n  let size = 0;\n  for (const node of this) ++size; // eslint-disable-line no-unused-vars\n  return size;\n}\n","export default function() {\n  return !this.node();\n}\n","export default function(callback) {\n\n  for (var groups = this._groups, j = 0, m = groups.length; j < m; ++j) {\n    for (var group = groups[j], i = 0, n = group.length, node; i < n; ++i) {\n      if (node = group[i]) callback.call(node, node.__data__, i, group);\n    }\n  }\n\n  return this;\n}\n","import creator from \"../creator.js\";\n\nexport default function(name) {\n  var create = typeof name === \"function\" ? name : creator(name);\n  return this.select(function() {\n    return this.appendChild(create.apply(this, arguments));\n  });\n}\n","export default function(value) {\n  return arguments.length\n      ? this.property(\"__data__\", value)\n      : this.node().__data__;\n}\n","export default function*() {\n  for (var groups = this._groups, j = 0, m = groups.length; j < m; ++j) {\n    for (var group = groups[j], i = 0, n = group.length, node; i < n; ++i) {\n      if (node = group[i]) yield node;\n    }\n  }\n}\n","import {Selection, root} from \"./selection/index.js\";\n\nexport default function(selector) {\n  return typeof selector === \"string\"\n      ? new Selection([[document.querySelector(selector)]], [document.documentElement])\n      : new Selection([[selector]], root);\n}\n","// These are typically used in conjunction with noevent to ensure that we can\n// preventDefault on the event.\nexport const nonpassive = {passive: false};\nexport const nonpassivecapture = {capture: true, passive: false};\n\nexport function nopropagation(event) {\n  event.stopImmediatePropagation();\n}\n\nexport default function(event) {\n  event.preventDefault();\n  event.stopImmediatePropagation();\n}\n","import {select} from \"d3-selection\";\nimport noevent, {nonpassivecapture} from \"./noevent.js\";\n\nexport default function(view) {\n  var root = view.document.documentElement,\n      selection = select(view).on(\"dragstart.drag\", noevent, nonpassivecapture);\n  if (\"onselectstart\" in root) {\n    selection.on(\"selectstart.drag\", noevent, nonpassivecapture);\n  } else {\n    root.__noselect = root.style.MozUserSelect;\n    root.style.MozUserSelect = \"none\";\n  }\n}\n\nexport function yesdrag(view, noclick) {\n  var root = view.document.documentElement,\n      selection = select(view).on(\"dragstart.drag\", null);\n  if (noclick) {\n    selection.on(\"click.drag\", noevent, nonpassivecapture);\n    setTimeout(function() { selection.on(\"click.drag\", null); }, 0);\n  }\n  if (\"onselectstart\" in root) {\n    selection.on(\"selectstart.drag\", null);\n  } else {\n    root.style.MozUserSelect = root.__noselect;\n    delete root.__noselect;\n  }\n}\n","var epsilon2 = 1e-12;\n\nfunction cosh(x) {\n  return ((x = Math.exp(x)) + 1 / x) / 2;\n}\n\nfunction sinh(x) {\n  return ((x = Math.exp(x)) - 1 / x) / 2;\n}\n\nfunction tanh(x) {\n  return ((x = Math.exp(2 * x)) - 1) / (x + 1);\n}\n\nexport default (function zoomRho(rho, rho2, rho4) {\n\n  // p0 = [ux0, uy0, w0]\n  // p1 = [ux1, uy1, w1]\n  function zoom(p0, p1) {\n    var ux0 = p0[0], uy0 = p0[1], w0 = p0[2],\n        ux1 = p1[0], uy1 = p1[1], w1 = p1[2],\n        dx = ux1 - ux0,\n        dy = uy1 - uy0,\n        d2 = dx * dx + dy * dy,\n        i,\n        S;\n\n    // Special case for u0 ≅ u1.\n    if (d2 < epsilon2) {\n      S = Math.log(w1 / w0) / rho;\n      i = function(t) {\n        return [\n          ux0 + t * dx,\n          uy0 + t * dy,\n          w0 * Math.exp(rho * t * S)\n        ];\n      }\n    }\n\n    // General case.\n    else {\n      var d1 = Math.sqrt(d2),\n          b0 = (w1 * w1 - w0 * w0 + rho4 * d2) / (2 * w0 * rho2 * d1),\n          b1 = (w1 * w1 - w0 * w0 - rho4 * d2) / (2 * w1 * rho2 * d1),\n          r0 = Math.log(Math.sqrt(b0 * b0 + 1) - b0),\n          r1 = Math.log(Math.sqrt(b1 * b1 + 1) - b1);\n      S = (r1 - r0) / rho;\n      i = function(t) {\n        var s = t * S,\n            coshr0 = cosh(r0),\n            u = w0 / (rho2 * d1) * (coshr0 * tanh(rho * s + r0) - sinh(r0));\n        return [\n          ux0 + u * dx,\n          uy0 + u * dy,\n          w0 * coshr0 / cosh(rho * s + r0)\n        ];\n      }\n    }\n\n    i.duration = S * 1000 * rho / Math.SQRT2;\n\n    return i;\n  }\n\n  zoom.rho = function(_) {\n    var _1 = Math.max(1e-3, +_), _2 = _1 * _1, _4 = _2 * _2;\n    return zoomRho(_1, _2, _4);\n  };\n\n  return zoom;\n})(Math.SQRT2, 2, 4);\n","import sourceEvent from \"./sourceEvent.js\";\n\nexport default function(event, node) {\n  event = sourceEvent(event);\n  if (node === undefined) node = event.currentTarget;\n  if (node) {\n    var svg = node.ownerSVGElement || node;\n    if (svg.createSVGPoint) {\n      var point = svg.createSVGPoint();\n      point.x = event.clientX, point.y = event.clientY;\n      point = point.matrixTransform(node.getScreenCTM().inverse());\n      return [point.x, point.y];\n    }\n    if (node.getBoundingClientRect) {\n      var rect = node.getBoundingClientRect();\n      return [event.clientX - rect.left - node.clientLeft, event.clientY - rect.top - node.clientTop];\n    }\n  }\n  return [event.pageX, event.pageY];\n}\n","export default function(event) {\n  let sourceEvent;\n  while (sourceEvent = event.sourceEvent) event = sourceEvent;\n  return event;\n}\n","var frame = 0, // is an animation frame pending?\n    timeout = 0, // is a timeout pending?\n    interval = 0, // are any timers active?\n    pokeDelay = 1000, // how frequently we check for clock skew\n    taskHead,\n    taskTail,\n    clockLast = 0,\n    clockNow = 0,\n    clockSkew = 0,\n    clock = typeof performance === \"object\" && performance.now ? performance : Date,\n    setFrame = typeof window === \"object\" && window.requestAnimationFrame ? window.requestAnimationFrame.bind(window) : function(f) { setTimeout(f, 17); };\n\nexport function now() {\n  return clockNow || (setFrame(clearNow), clockNow = clock.now() + clockSkew);\n}\n\nfunction clearNow() {\n  clockNow = 0;\n}\n\nexport function Timer() {\n  this._call =\n  this._time =\n  this._next = null;\n}\n\nTimer.prototype = timer.prototype = {\n  constructor: Timer,\n  restart: function(callback, delay, time) {\n    if (typeof callback !== \"function\") throw new TypeError(\"callback is not a function\");\n    time = (time == null ? now() : +time) + (delay == null ? 0 : +delay);\n    if (!this._next && taskTail !== this) {\n      if (taskTail) taskTail._next = this;\n      else taskHead = this;\n      taskTail = this;\n    }\n    this._call = callback;\n    this._time = time;\n    sleep();\n  },\n  stop: function() {\n    if (this._call) {\n      this._call = null;\n      this._time = Infinity;\n      sleep();\n    }\n  }\n};\n\nexport function timer(callback, delay, time) {\n  var t = new Timer;\n  t.restart(callback, delay, time);\n  return t;\n}\n\nexport function timerFlush() {\n  now(); // Get the current time, if not already set.\n  ++frame; // Pretend we’ve set an alarm, if we haven’t already.\n  var t = taskHead, e;\n  while (t) {\n    if ((e = clockNow - t._time) >= 0) t._call.call(undefined, e);\n    t = t._next;\n  }\n  --frame;\n}\n\nfunction wake() {\n  clockNow = (clockLast = clock.now()) + clockSkew;\n  frame = timeout = 0;\n  try {\n    timerFlush();\n  } finally {\n    frame = 0;\n    nap();\n    clockNow = 0;\n  }\n}\n\nfunction poke() {\n  var now = clock.now(), delay = now - clockLast;\n  if (delay > pokeDelay) clockSkew -= delay, clockLast = now;\n}\n\nfunction nap() {\n  var t0, t1 = taskHead, t2, time = Infinity;\n  while (t1) {\n    if (t1._call) {\n      if (time > t1._time) time = t1._time;\n      t0 = t1, t1 = t1._next;\n    } else {\n      t2 = t1._next, t1._next = null;\n      t1 = t0 ? t0._next = t2 : taskHead = t2;\n    }\n  }\n  taskTail = t0;\n  sleep(time);\n}\n\nfunction sleep(time) {\n  if (frame) return; // Soonest alarm already set, or will be.\n  if (timeout) timeout = clearTimeout(timeout);\n  var delay = time - clockNow; // Strictly less than if we recomputed clockNow.\n  if (delay > 24) {\n    if (time < Infinity) timeout = setTimeout(wake, time - clock.now() - clockSkew);\n    if (interval) interval = clearInterval(interval);\n  } else {\n    if (!interval) clockLast = clock.now(), interval = setInterval(poke, pokeDelay);\n    frame = 1, setFrame(wake);\n  }\n}\n","import {Timer} from \"./timer.js\";\n\nexport default function(callback, delay, time) {\n  var t = new Timer;\n  delay = delay == null ? 0 : +delay;\n  t.restart(elapsed => {\n    t.stop();\n    callback(elapsed + delay);\n  }, delay, time);\n  return t;\n}\n","import {dispatch} from \"d3-dispatch\";\nimport {timer, timeout} from \"d3-timer\";\n\nvar emptyOn = dispatch(\"start\", \"end\", \"cancel\", \"interrupt\");\nvar emptyTween = [];\n\nexport var CREATED = 0;\nexport var SCHEDULED = 1;\nexport var STARTING = 2;\nexport var STARTED = 3;\nexport var RUNNING = 4;\nexport var ENDING = 5;\nexport var ENDED = 6;\n\nexport default function(node, name, id, index, group, timing) {\n  var schedules = node.__transition;\n  if (!schedules) node.__transition = {};\n  else if (id in schedules) return;\n  create(node, id, {\n    name: name,\n    index: index, // For context during callback.\n    group: group, // For context during callback.\n    on: emptyOn,\n    tween: emptyTween,\n    time: timing.time,\n    delay: timing.delay,\n    duration: timing.duration,\n    ease: timing.ease,\n    timer: null,\n    state: CREATED\n  });\n}\n\nexport function init(node, id) {\n  var schedule = get(node, id);\n  if (schedule.state > CREATED) throw new Error(\"too late; already scheduled\");\n  return schedule;\n}\n\nexport function set(node, id) {\n  var schedule = get(node, id);\n  if (schedule.state > STARTED) throw new Error(\"too late; already running\");\n  return schedule;\n}\n\nexport function get(node, id) {\n  var schedule = node.__transition;\n  if (!schedule || !(schedule = schedule[id])) throw new Error(\"transition not found\");\n  return schedule;\n}\n\nfunction create(node, id, self) {\n  var schedules = node.__transition,\n      tween;\n\n  // Initialize the self timer when the transition is created.\n  // Note the actual delay is not known until the first callback!\n  schedules[id] = self;\n  self.timer = timer(schedule, 0, self.time);\n\n  function schedule(elapsed) {\n    self.state = SCHEDULED;\n    self.timer.restart(start, self.delay, self.time);\n\n    // If the elapsed delay is less than our first sleep, start immediately.\n    if (self.delay <= elapsed) start(elapsed - self.delay);\n  }\n\n  function start(elapsed) {\n    var i, j, n, o;\n\n    // If the state is not SCHEDULED, then we previously errored on start.\n    if (self.state !== SCHEDULED) return stop();\n\n    for (i in schedules) {\n      o = schedules[i];\n      if (o.name !== self.name) continue;\n\n      // While this element already has a starting transition during this frame,\n      // defer starting an interrupting transition until that transition has a\n      // chance to tick (and possibly end); see d3/d3-transition#54!\n      if (o.state === STARTED) return timeout(start);\n\n      // Interrupt the active transition, if any.\n      if (o.state === RUNNING) {\n        o.state = ENDED;\n        o.timer.stop();\n        o.on.call(\"interrupt\", node, node.__data__, o.index, o.group);\n        delete schedules[i];\n      }\n\n      // Cancel any pre-empted transitions.\n      else if (+i < id) {\n        o.state = ENDED;\n        o.timer.stop();\n        o.on.call(\"cancel\", node, node.__data__, o.index, o.group);\n        delete schedules[i];\n      }\n    }\n\n    // Defer the first tick to end of the current frame; see d3/d3#1576.\n    // Note the transition may be canceled after start and before the first tick!\n    // Note this must be scheduled before the start event; see d3/d3-transition#16!\n    // Assuming this is successful, subsequent callbacks go straight to tick.\n    timeout(function() {\n      if (self.state === STARTED) {\n        self.state = RUNNING;\n        self.timer.restart(tick, self.delay, self.time);\n        tick(elapsed);\n      }\n    });\n\n    // Dispatch the start event.\n    // Note this must be done before the tween are initialized.\n    self.state = STARTING;\n    self.on.call(\"start\", node, node.__data__, self.index, self.group);\n    if (self.state !== STARTING) return; // interrupted\n    self.state = STARTED;\n\n    // Initialize the tween, deleting null tween.\n    tween = new Array(n = self.tween.length);\n    for (i = 0, j = -1; i < n; ++i) {\n      if (o = self.tween[i].value.call(node, node.__data__, self.index, self.group)) {\n        tween[++j] = o;\n      }\n    }\n    tween.length = j + 1;\n  }\n\n  function tick(elapsed) {\n    var t = elapsed < self.duration ? self.ease.call(null, elapsed / self.duration) : (self.timer.restart(stop), self.state = ENDING, 1),\n        i = -1,\n        n = tween.length;\n\n    while (++i < n) {\n      tween[i].call(node, t);\n    }\n\n    // Dispatch the end event.\n    if (self.state === ENDING) {\n      self.on.call(\"end\", node, node.__data__, self.index, self.group);\n      stop();\n    }\n  }\n\n  function stop() {\n    self.state = ENDED;\n    self.timer.stop();\n    delete schedules[id];\n    for (var i in schedules) return; // eslint-disable-line no-unused-vars\n    delete node.__transition;\n  }\n}\n","import {STARTING, ENDING, ENDED} from \"./transition/schedule.js\";\n\nexport default function(node, name) {\n  var schedules = node.__transition,\n      schedule,\n      active,\n      empty = true,\n      i;\n\n  if (!schedules) return;\n\n  name = name == null ? null : name + \"\";\n\n  for (i in schedules) {\n    if ((schedule = schedules[i]).name !== name) { empty = false; continue; }\n    active = schedule.state > STARTING && schedule.state < ENDING;\n    schedule.state = ENDED;\n    schedule.timer.stop();\n    schedule.on.call(active ? \"interrupt\" : \"cancel\", node, node.__data__, schedule.index, schedule.group);\n    delete schedules[i];\n  }\n\n  if (empty) delete node.__transition;\n}\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return a * (1 - t) + b * t;\n  };\n}\n","var degrees = 180 / Math.PI;\n\nexport var identity = {\n  translateX: 0,\n  translateY: 0,\n  rotate: 0,\n  skewX: 0,\n  scaleX: 1,\n  scaleY: 1\n};\n\nexport default function(a, b, c, d, e, f) {\n  var scaleX, scaleY, skewX;\n  if (scaleX = Math.sqrt(a * a + b * b)) a /= scaleX, b /= scaleX;\n  if (skewX = a * c + b * d) c -= a * skewX, d -= b * skewX;\n  if (scaleY = Math.sqrt(c * c + d * d)) c /= scaleY, d /= scaleY, skewX /= scaleY;\n  if (a * d < b * c) a = -a, b = -b, skewX = -skewX, scaleX = -scaleX;\n  return {\n    translateX: e,\n    translateY: f,\n    rotate: Math.atan2(b, a) * degrees,\n    skewX: Math.atan(skewX) * degrees,\n    scaleX: scaleX,\n    scaleY: scaleY\n  };\n}\n","import decompose, {identity} from \"./decompose.js\";\n\nvar svgNode;\n\n/* eslint-disable no-undef */\nexport function parseCss(value) {\n  const m = new (typeof DOMMatrix === \"function\" ? DOMMatrix : WebKitCSSMatrix)(value + \"\");\n  return m.isIdentity ? identity : decompose(m.a, m.b, m.c, m.d, m.e, m.f);\n}\n\nexport function parseSvg(value) {\n  if (value == null) return identity;\n  if (!svgNode) svgNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n  svgNode.setAttribute(\"transform\", value);\n  if (!(value = svgNode.transform.baseVal.consolidate())) return identity;\n  value = value.matrix;\n  return decompose(value.a, value.b, value.c, value.d, value.e, value.f);\n}\n","import number from \"../number.js\";\nimport {parseCss, parseSvg} from \"./parse.js\";\n\nfunction interpolateTransform(parse, pxComma, pxParen, degParen) {\n\n  function pop(s) {\n    return s.length ? s.pop() + \" \" : \"\";\n  }\n\n  function translate(xa, ya, xb, yb, s, q) {\n    if (xa !== xb || ya !== yb) {\n      var i = s.push(\"translate(\", null, pxComma, null, pxParen);\n      q.push({i: i - 4, x: number(xa, xb)}, {i: i - 2, x: number(ya, yb)});\n    } else if (xb || yb) {\n      s.push(\"translate(\" + xb + pxComma + yb + pxParen);\n    }\n  }\n\n  function rotate(a, b, s, q) {\n    if (a !== b) {\n      if (a - b > 180) b += 360; else if (b - a > 180) a += 360; // shortest path\n      q.push({i: s.push(pop(s) + \"rotate(\", null, degParen) - 2, x: number(a, b)});\n    } else if (b) {\n      s.push(pop(s) + \"rotate(\" + b + degParen);\n    }\n  }\n\n  function skewX(a, b, s, q) {\n    if (a !== b) {\n      q.push({i: s.push(pop(s) + \"skewX(\", null, degParen) - 2, x: number(a, b)});\n    } else if (b) {\n      s.push(pop(s) + \"skewX(\" + b + degParen);\n    }\n  }\n\n  function scale(xa, ya, xb, yb, s, q) {\n    if (xa !== xb || ya !== yb) {\n      var i = s.push(pop(s) + \"scale(\", null, \",\", null, \")\");\n      q.push({i: i - 4, x: number(xa, xb)}, {i: i - 2, x: number(ya, yb)});\n    } else if (xb !== 1 || yb !== 1) {\n      s.push(pop(s) + \"scale(\" + xb + \",\" + yb + \")\");\n    }\n  }\n\n  return function(a, b) {\n    var s = [], // string constants and placeholders\n        q = []; // number interpolators\n    a = parse(a), b = parse(b);\n    translate(a.translateX, a.translateY, b.translateX, b.translateY, s, q);\n    rotate(a.rotate, b.rotate, s, q);\n    skewX(a.skewX, b.skewX, s, q);\n    scale(a.scaleX, a.scaleY, b.scaleX, b.scaleY, s, q);\n    a = b = null; // gc\n    return function(t) {\n      var i = -1, n = q.length, o;\n      while (++i < n) s[(o = q[i]).i] = o.x(t);\n      return s.join(\"\");\n    };\n  };\n}\n\nexport var interpolateTransformCss = interpolateTransform(parseCss, \"px, \", \"px)\", \"deg)\");\nexport var interpolateTransformSvg = interpolateTransform(parseSvg, \", \", \")\", \")\");\n","import {get, set} from \"./schedule.js\";\n\nfunction tweenRemove(id, name) {\n  var tween0, tween1;\n  return function() {\n    var schedule = set(this, id),\n        tween = schedule.tween;\n\n    // If this node shared tween with the previous node,\n    // just assign the updated shared tween and we’re done!\n    // Otherwise, copy-on-write.\n    if (tween !== tween0) {\n      tween1 = tween0 = tween;\n      for (var i = 0, n = tween1.length; i < n; ++i) {\n        if (tween1[i].name === name) {\n          tween1 = tween1.slice();\n          tween1.splice(i, 1);\n          break;\n        }\n      }\n    }\n\n    schedule.tween = tween1;\n  };\n}\n\nfunction tweenFunction(id, name, value) {\n  var tween0, tween1;\n  if (typeof value !== \"function\") throw new Error;\n  return function() {\n    var schedule = set(this, id),\n        tween = schedule.tween;\n\n    // If this node shared tween with the previous node,\n    // just assign the updated shared tween and we’re done!\n    // Otherwise, copy-on-write.\n    if (tween !== tween0) {\n      tween1 = (tween0 = tween).slice();\n      for (var t = {name: name, value: value}, i = 0, n = tween1.length; i < n; ++i) {\n        if (tween1[i].name === name) {\n          tween1[i] = t;\n          break;\n        }\n      }\n      if (i === n) tween1.push(t);\n    }\n\n    schedule.tween = tween1;\n  };\n}\n\nexport default function(name, value) {\n  var id = this._id;\n\n  name += \"\";\n\n  if (arguments.length < 2) {\n    var tween = get(this.node(), id).tween;\n    for (var i = 0, n = tween.length, t; i < n; ++i) {\n      if ((t = tween[i]).name === name) {\n        return t.value;\n      }\n    }\n    return null;\n  }\n\n  return this.each((value == null ? tweenRemove : tweenFunction)(id, name, value));\n}\n\nexport function tweenValue(transition, name, value) {\n  var id = transition._id;\n\n  transition.each(function() {\n    var schedule = set(this, id);\n    (schedule.value || (schedule.value = {}))[name] = value.apply(this, arguments);\n  });\n\n  return function(node) {\n    return get(node, id).value[name];\n  };\n}\n","export default function(constructor, factory, prototype) {\n  constructor.prototype = factory.prototype = prototype;\n  prototype.constructor = constructor;\n}\n\nexport function extend(parent, definition) {\n  var prototype = Object.create(parent.prototype);\n  for (var key in definition) prototype[key] = definition[key];\n  return prototype;\n}\n","import define, {extend} from \"./define.js\";\n\nexport function Color() {}\n\nexport var darker = 0.7;\nexport var brighter = 1 / darker;\n\nvar reI = \"\\\\s*([+-]?\\\\d+)\\\\s*\",\n    reN = \"\\\\s*([+-]?(?:\\\\d*\\\\.)?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",\n    reP = \"\\\\s*([+-]?(?:\\\\d*\\\\.)?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",\n    reHex = /^#([0-9a-f]{3,8})$/,\n    reRgbInteger = new RegExp(`^rgb\\\\(${reI},${reI},${reI}\\\\)$`),\n    reRgbPercent = new RegExp(`^rgb\\\\(${reP},${reP},${reP}\\\\)$`),\n    reRgbaInteger = new RegExp(`^rgba\\\\(${reI},${reI},${reI},${reN}\\\\)$`),\n    reRgbaPercent = new RegExp(`^rgba\\\\(${reP},${reP},${reP},${reN}\\\\)$`),\n    reHslPercent = new RegExp(`^hsl\\\\(${reN},${reP},${reP}\\\\)$`),\n    reHslaPercent = new RegExp(`^hsla\\\\(${reN},${reP},${reP},${reN}\\\\)$`);\n\nvar named = {\n  aliceblue: 0xf0f8ff,\n  antiquewhite: 0xfaebd7,\n  aqua: 0x00ffff,\n  aquamarine: 0x7fffd4,\n  azure: 0xf0ffff,\n  beige: 0xf5f5dc,\n  bisque: 0xffe4c4,\n  black: 0x000000,\n  blanchedalmond: 0xffebcd,\n  blue: 0x0000ff,\n  blueviolet: 0x8a2be2,\n  brown: 0xa52a2a,\n  burlywood: 0xdeb887,\n  cadetblue: 0x5f9ea0,\n  chartreuse: 0x7fff00,\n  chocolate: 0xd2691e,\n  coral: 0xff7f50,\n  cornflowerblue: 0x6495ed,\n  cornsilk: 0xfff8dc,\n  crimson: 0xdc143c,\n  cyan: 0x00ffff,\n  darkblue: 0x00008b,\n  darkcyan: 0x008b8b,\n  darkgoldenrod: 0xb8860b,\n  darkgray: 0xa9a9a9,\n  darkgreen: 0x006400,\n  darkgrey: 0xa9a9a9,\n  darkkhaki: 0xbdb76b,\n  darkmagenta: 0x8b008b,\n  darkolivegreen: 0x556b2f,\n  darkorange: 0xff8c00,\n  darkorchid: 0x9932cc,\n  darkred: 0x8b0000,\n  darksalmon: 0xe9967a,\n  darkseagreen: 0x8fbc8f,\n  darkslateblue: 0x483d8b,\n  darkslategray: 0x2f4f4f,\n  darkslategrey: 0x2f4f4f,\n  darkturquoise: 0x00ced1,\n  darkviolet: 0x9400d3,\n  deeppink: 0xff1493,\n  deepskyblue: 0x00bfff,\n  dimgray: 0x696969,\n  dimgrey: 0x696969,\n  dodgerblue: 0x1e90ff,\n  firebrick: 0xb22222,\n  floralwhite: 0xfffaf0,\n  forestgreen: 0x228b22,\n  fuchsia: 0xff00ff,\n  gainsboro: 0xdcdcdc,\n  ghostwhite: 0xf8f8ff,\n  gold: 0xffd700,\n  goldenrod: 0xdaa520,\n  gray: 0x808080,\n  green: 0x008000,\n  greenyellow: 0xadff2f,\n  grey: 0x808080,\n  honeydew: 0xf0fff0,\n  hotpink: 0xff69b4,\n  indianred: 0xcd5c5c,\n  indigo: 0x4b0082,\n  ivory: 0xfffff0,\n  khaki: 0xf0e68c,\n  lavender: 0xe6e6fa,\n  lavenderblush: 0xfff0f5,\n  lawngreen: 0x7cfc00,\n  lemonchiffon: 0xfffacd,\n  lightblue: 0xadd8e6,\n  lightcoral: 0xf08080,\n  lightcyan: 0xe0ffff,\n  lightgoldenrodyellow: 0xfafad2,\n  lightgray: 0xd3d3d3,\n  lightgreen: 0x90ee90,\n  lightgrey: 0xd3d3d3,\n  lightpink: 0xffb6c1,\n  lightsalmon: 0xffa07a,\n  lightseagreen: 0x20b2aa,\n  lightskyblue: 0x87cefa,\n  lightslategray: 0x778899,\n  lightslategrey: 0x778899,\n  lightsteelblue: 0xb0c4de,\n  lightyellow: 0xffffe0,\n  lime: 0x00ff00,\n  limegreen: 0x32cd32,\n  linen: 0xfaf0e6,\n  magenta: 0xff00ff,\n  maroon: 0x800000,\n  mediumaquamarine: 0x66cdaa,\n  mediumblue: 0x0000cd,\n  mediumorchid: 0xba55d3,\n  mediumpurple: 0x9370db,\n  mediumseagreen: 0x3cb371,\n  mediumslateblue: 0x7b68ee,\n  mediumspringgreen: 0x00fa9a,\n  mediumturquoise: 0x48d1cc,\n  mediumvioletred: 0xc71585,\n  midnightblue: 0x191970,\n  mintcream: 0xf5fffa,\n  mistyrose: 0xffe4e1,\n  moccasin: 0xffe4b5,\n  navajowhite: 0xffdead,\n  navy: 0x000080,\n  oldlace: 0xfdf5e6,\n  olive: 0x808000,\n  olivedrab: 0x6b8e23,\n  orange: 0xffa500,\n  orangered: 0xff4500,\n  orchid: 0xda70d6,\n  palegoldenrod: 0xeee8aa,\n  palegreen: 0x98fb98,\n  paleturquoise: 0xafeeee,\n  palevioletred: 0xdb7093,\n  papayawhip: 0xffefd5,\n  peachpuff: 0xffdab9,\n  peru: 0xcd853f,\n  pink: 0xffc0cb,\n  plum: 0xdda0dd,\n  powderblue: 0xb0e0e6,\n  purple: 0x800080,\n  rebeccapurple: 0x663399,\n  red: 0xff0000,\n  rosybrown: 0xbc8f8f,\n  royalblue: 0x4169e1,\n  saddlebrown: 0x8b4513,\n  salmon: 0xfa8072,\n  sandybrown: 0xf4a460,\n  seagreen: 0x2e8b57,\n  seashell: 0xfff5ee,\n  sienna: 0xa0522d,\n  silver: 0xc0c0c0,\n  skyblue: 0x87ceeb,\n  slateblue: 0x6a5acd,\n  slategray: 0x708090,\n  slategrey: 0x708090,\n  snow: 0xfffafa,\n  springgreen: 0x00ff7f,\n  steelblue: 0x4682b4,\n  tan: 0xd2b48c,\n  teal: 0x008080,\n  thistle: 0xd8bfd8,\n  tomato: 0xff6347,\n  turquoise: 0x40e0d0,\n  violet: 0xee82ee,\n  wheat: 0xf5deb3,\n  white: 0xffffff,\n  whitesmoke: 0xf5f5f5,\n  yellow: 0xffff00,\n  yellowgreen: 0x9acd32\n};\n\ndefine(Color, color, {\n  copy(channels) {\n    return Object.assign(new this.constructor, this, channels);\n  },\n  displayable() {\n    return this.rgb().displayable();\n  },\n  hex: color_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: color_formatHex,\n  formatHex8: color_formatHex8,\n  formatHsl: color_formatHsl,\n  formatRgb: color_formatRgb,\n  toString: color_formatRgb\n});\n\nfunction color_formatHex() {\n  return this.rgb().formatHex();\n}\n\nfunction color_formatHex8() {\n  return this.rgb().formatHex8();\n}\n\nfunction color_formatHsl() {\n  return hslConvert(this).formatHsl();\n}\n\nfunction color_formatRgb() {\n  return this.rgb().formatRgb();\n}\n\nexport default function color(format) {\n  var m, l;\n  format = (format + \"\").trim().toLowerCase();\n  return (m = reHex.exec(format)) ? (l = m[1].length, m = parseInt(m[1], 16), l === 6 ? rgbn(m) // #ff0000\n      : l === 3 ? new Rgb((m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), ((m & 0xf) << 4) | (m & 0xf), 1) // #f00\n      : l === 8 ? rgba(m >> 24 & 0xff, m >> 16 & 0xff, m >> 8 & 0xff, (m & 0xff) / 0xff) // #ff000000\n      : l === 4 ? rgba((m >> 12 & 0xf) | (m >> 8 & 0xf0), (m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), (((m & 0xf) << 4) | (m & 0xf)) / 0xff) // #f000\n      : null) // invalid hex\n      : (m = reRgbInteger.exec(format)) ? new Rgb(m[1], m[2], m[3], 1) // rgb(255, 0, 0)\n      : (m = reRgbPercent.exec(format)) ? new Rgb(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, 1) // rgb(100%, 0%, 0%)\n      : (m = reRgbaInteger.exec(format)) ? rgba(m[1], m[2], m[3], m[4]) // rgba(255, 0, 0, 1)\n      : (m = reRgbaPercent.exec(format)) ? rgba(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, m[4]) // rgb(100%, 0%, 0%, 1)\n      : (m = reHslPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, 1) // hsl(120, 50%, 50%)\n      : (m = reHslaPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, m[4]) // hsla(120, 50%, 50%, 1)\n      : named.hasOwnProperty(format) ? rgbn(named[format]) // eslint-disable-line no-prototype-builtins\n      : format === \"transparent\" ? new Rgb(NaN, NaN, NaN, 0)\n      : null;\n}\n\nfunction rgbn(n) {\n  return new Rgb(n >> 16 & 0xff, n >> 8 & 0xff, n & 0xff, 1);\n}\n\nfunction rgba(r, g, b, a) {\n  if (a <= 0) r = g = b = NaN;\n  return new Rgb(r, g, b, a);\n}\n\nexport function rgbConvert(o) {\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Rgb;\n  o = o.rgb();\n  return new Rgb(o.r, o.g, o.b, o.opacity);\n}\n\nexport function rgb(r, g, b, opacity) {\n  return arguments.length === 1 ? rgbConvert(r) : new Rgb(r, g, b, opacity == null ? 1 : opacity);\n}\n\nexport function Rgb(r, g, b, opacity) {\n  this.r = +r;\n  this.g = +g;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Rgb, rgb, extend(Color, {\n  brighter(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  darker(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  rgb() {\n    return this;\n  },\n  clamp() {\n    return new Rgb(clampi(this.r), clampi(this.g), clampi(this.b), clampa(this.opacity));\n  },\n  displayable() {\n    return (-0.5 <= this.r && this.r < 255.5)\n        && (-0.5 <= this.g && this.g < 255.5)\n        && (-0.5 <= this.b && this.b < 255.5)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  hex: rgb_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: rgb_formatHex,\n  formatHex8: rgb_formatHex8,\n  formatRgb: rgb_formatRgb,\n  toString: rgb_formatRgb\n}));\n\nfunction rgb_formatHex() {\n  return `#${hex(this.r)}${hex(this.g)}${hex(this.b)}`;\n}\n\nfunction rgb_formatHex8() {\n  return `#${hex(this.r)}${hex(this.g)}${hex(this.b)}${hex((isNaN(this.opacity) ? 1 : this.opacity) * 255)}`;\n}\n\nfunction rgb_formatRgb() {\n  const a = clampa(this.opacity);\n  return `${a === 1 ? \"rgb(\" : \"rgba(\"}${clampi(this.r)}, ${clampi(this.g)}, ${clampi(this.b)}${a === 1 ? \")\" : `, ${a})`}`;\n}\n\nfunction clampa(opacity) {\n  return isNaN(opacity) ? 1 : Math.max(0, Math.min(1, opacity));\n}\n\nfunction clampi(value) {\n  return Math.max(0, Math.min(255, Math.round(value) || 0));\n}\n\nfunction hex(value) {\n  value = clampi(value);\n  return (value < 16 ? \"0\" : \"\") + value.toString(16);\n}\n\nfunction hsla(h, s, l, a) {\n  if (a <= 0) h = s = l = NaN;\n  else if (l <= 0 || l >= 1) h = s = NaN;\n  else if (s <= 0) h = NaN;\n  return new Hsl(h, s, l, a);\n}\n\nexport function hslConvert(o) {\n  if (o instanceof Hsl) return new Hsl(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Hsl;\n  if (o instanceof Hsl) return o;\n  o = o.rgb();\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      min = Math.min(r, g, b),\n      max = Math.max(r, g, b),\n      h = NaN,\n      s = max - min,\n      l = (max + min) / 2;\n  if (s) {\n    if (r === max) h = (g - b) / s + (g < b) * 6;\n    else if (g === max) h = (b - r) / s + 2;\n    else h = (r - g) / s + 4;\n    s /= l < 0.5 ? max + min : 2 - max - min;\n    h *= 60;\n  } else {\n    s = l > 0 && l < 1 ? 0 : h;\n  }\n  return new Hsl(h, s, l, o.opacity);\n}\n\nexport function hsl(h, s, l, opacity) {\n  return arguments.length === 1 ? hslConvert(h) : new Hsl(h, s, l, opacity == null ? 1 : opacity);\n}\n\nfunction Hsl(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hsl, hsl, extend(Color, {\n  brighter(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb() {\n    var h = this.h % 360 + (this.h < 0) * 360,\n        s = isNaN(h) || isNaN(this.s) ? 0 : this.s,\n        l = this.l,\n        m2 = l + (l < 0.5 ? l : 1 - l) * s,\n        m1 = 2 * l - m2;\n    return new Rgb(\n      hsl2rgb(h >= 240 ? h - 240 : h + 120, m1, m2),\n      hsl2rgb(h, m1, m2),\n      hsl2rgb(h < 120 ? h + 240 : h - 120, m1, m2),\n      this.opacity\n    );\n  },\n  clamp() {\n    return new Hsl(clamph(this.h), clampt(this.s), clampt(this.l), clampa(this.opacity));\n  },\n  displayable() {\n    return (0 <= this.s && this.s <= 1 || isNaN(this.s))\n        && (0 <= this.l && this.l <= 1)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  formatHsl() {\n    const a = clampa(this.opacity);\n    return `${a === 1 ? \"hsl(\" : \"hsla(\"}${clamph(this.h)}, ${clampt(this.s) * 100}%, ${clampt(this.l) * 100}%${a === 1 ? \")\" : `, ${a})`}`;\n  }\n}));\n\nfunction clamph(value) {\n  value = (value || 0) % 360;\n  return value < 0 ? value + 360 : value;\n}\n\nfunction clampt(value) {\n  return Math.max(0, Math.min(1, value || 0));\n}\n\n/* From FvD 13.37, CSS Color Module Level 3 */\nfunction hsl2rgb(h, m1, m2) {\n  return (h < 60 ? m1 + (m2 - m1) * h / 60\n      : h < 180 ? m2\n      : h < 240 ? m1 + (m2 - m1) * (240 - h) / 60\n      : m1) * 255;\n}\n","export function basis(t1, v0, v1, v2, v3) {\n  var t2 = t1 * t1, t3 = t2 * t1;\n  return ((1 - 3 * t1 + 3 * t2 - t3) * v0\n      + (4 - 6 * t2 + 3 * t3) * v1\n      + (1 + 3 * t1 + 3 * t2 - 3 * t3) * v2\n      + t3 * v3) / 6;\n}\n\nexport default function(values) {\n  var n = values.length - 1;\n  return function(t) {\n    var i = t <= 0 ? (t = 0) : t >= 1 ? (t = 1, n - 1) : Math.floor(t * n),\n        v1 = values[i],\n        v2 = values[i + 1],\n        v0 = i > 0 ? values[i - 1] : 2 * v1 - v2,\n        v3 = i < n - 1 ? values[i + 2] : 2 * v2 - v1;\n    return basis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n","export default x => () => x;\n","import constant from \"./constant.js\";\n\nfunction linear(a, d) {\n  return function(t) {\n    return a + t * d;\n  };\n}\n\nfunction exponential(a, b, y) {\n  return a = Math.pow(a, y), b = Math.pow(b, y) - a, y = 1 / y, function(t) {\n    return Math.pow(a + t * b, y);\n  };\n}\n\nexport function hue(a, b) {\n  var d = b - a;\n  return d ? linear(a, d > 180 || d < -180 ? d - 360 * Math.round(d / 360) : d) : constant(isNaN(a) ? b : a);\n}\n\nexport function gamma(y) {\n  return (y = +y) === 1 ? nogamma : function(a, b) {\n    return b - a ? exponential(a, b, y) : constant(isNaN(a) ? b : a);\n  };\n}\n\nexport default function nogamma(a, b) {\n  var d = b - a;\n  return d ? linear(a, d) : constant(isNaN(a) ? b : a);\n}\n","import {rgb as colorRgb} from \"d3-color\";\nimport basis from \"./basis.js\";\nimport basisClosed from \"./basisClosed.js\";\nimport nogamma, {gamma} from \"./color.js\";\n\nexport default (function rgbGamma(y) {\n  var color = gamma(y);\n\n  function rgb(start, end) {\n    var r = color((start = colorRgb(start)).r, (end = colorRgb(end)).r),\n        g = color(start.g, end.g),\n        b = color(start.b, end.b),\n        opacity = nogamma(start.opacity, end.opacity);\n    return function(t) {\n      start.r = r(t);\n      start.g = g(t);\n      start.b = b(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n\n  rgb.gamma = rgbGamma;\n\n  return rgb;\n})(1);\n\nfunction rgbSpline(spline) {\n  return function(colors) {\n    var n = colors.length,\n        r = new Array(n),\n        g = new Array(n),\n        b = new Array(n),\n        i, color;\n    for (i = 0; i < n; ++i) {\n      color = colorRgb(colors[i]);\n      r[i] = color.r || 0;\n      g[i] = color.g || 0;\n      b[i] = color.b || 0;\n    }\n    r = spline(r);\n    g = spline(g);\n    b = spline(b);\n    color.opacity = 1;\n    return function(t) {\n      color.r = r(t);\n      color.g = g(t);\n      color.b = b(t);\n      return color + \"\";\n    };\n  };\n}\n\nexport var rgbBasis = rgbSpline(basis);\nexport var rgbBasisClosed = rgbSpline(basisClosed);\n","import {basis} from \"./basis.js\";\n\nexport default function(values) {\n  var n = values.length;\n  return function(t) {\n    var i = Math.floor(((t %= 1) < 0 ? ++t : t) * n),\n        v0 = values[(i + n - 1) % n],\n        v1 = values[i % n],\n        v2 = values[(i + 1) % n],\n        v3 = values[(i + 2) % n];\n    return basis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n","import number from \"./number.js\";\n\nvar reA = /[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,\n    reB = new RegExp(reA.source, \"g\");\n\nfunction zero(b) {\n  return function() {\n    return b;\n  };\n}\n\nfunction one(b) {\n  return function(t) {\n    return b(t) + \"\";\n  };\n}\n\nexport default function(a, b) {\n  var bi = reA.lastIndex = reB.lastIndex = 0, // scan index for next number in b\n      am, // current match in a\n      bm, // current match in b\n      bs, // string preceding current number in b, if any\n      i = -1, // index in s\n      s = [], // string constants and placeholders\n      q = []; // number interpolators\n\n  // Coerce inputs to strings.\n  a = a + \"\", b = b + \"\";\n\n  // Interpolate pairs of numbers in a & b.\n  while ((am = reA.exec(a))\n      && (bm = reB.exec(b))) {\n    if ((bs = bm.index) > bi) { // a string precedes the next number in b\n      bs = b.slice(bi, bs);\n      if (s[i]) s[i] += bs; // coalesce with previous string\n      else s[++i] = bs;\n    }\n    if ((am = am[0]) === (bm = bm[0])) { // numbers in a & b match\n      if (s[i]) s[i] += bm; // coalesce with previous string\n      else s[++i] = bm;\n    } else { // interpolate non-matching numbers\n      s[++i] = null;\n      q.push({i: i, x: number(am, bm)});\n    }\n    bi = reB.lastIndex;\n  }\n\n  // Add remains of b.\n  if (bi < b.length) {\n    bs = b.slice(bi);\n    if (s[i]) s[i] += bs; // coalesce with previous string\n    else s[++i] = bs;\n  }\n\n  // Special optimization for only a single match.\n  // Otherwise, interpolate each of the numbers and rejoin the string.\n  return s.length < 2 ? (q[0]\n      ? one(q[0].x)\n      : zero(b))\n      : (b = q.length, function(t) {\n          for (var i = 0, o; i < b; ++i) s[(o = q[i]).i] = o.x(t);\n          return s.join(\"\");\n        });\n}\n","import {color} from \"d3-color\";\nimport {interpolateNumber, interpolateRgb, interpolateString} from \"d3-interpolate\";\n\nexport default function(a, b) {\n  var c;\n  return (typeof b === \"number\" ? interpolateNumber\n      : b instanceof color ? interpolateRgb\n      : (c = color(b)) ? (b = c, interpolateRgb)\n      : interpolateString)(a, b);\n}\n","import {interpolateTransformSvg as interpolateTransform} from \"d3-interpolate\";\nimport {namespace} from \"d3-selection\";\nimport {tweenValue} from \"./tween.js\";\nimport interpolate from \"./interpolate.js\";\n\nfunction attrRemove(name) {\n  return function() {\n    this.removeAttribute(name);\n  };\n}\n\nfunction attrRemoveNS(fullname) {\n  return function() {\n    this.removeAttributeNS(fullname.space, fullname.local);\n  };\n}\n\nfunction attrConstant(name, interpolate, value1) {\n  var string00,\n      string1 = value1 + \"\",\n      interpolate0;\n  return function() {\n    var string0 = this.getAttribute(name);\n    return string0 === string1 ? null\n        : string0 === string00 ? interpolate0\n        : interpolate0 = interpolate(string00 = string0, value1);\n  };\n}\n\nfunction attrConstantNS(fullname, interpolate, value1) {\n  var string00,\n      string1 = value1 + \"\",\n      interpolate0;\n  return function() {\n    var string0 = this.getAttributeNS(fullname.space, fullname.local);\n    return string0 === string1 ? null\n        : string0 === string00 ? interpolate0\n        : interpolate0 = interpolate(string00 = string0, value1);\n  };\n}\n\nfunction attrFunction(name, interpolate, value) {\n  var string00,\n      string10,\n      interpolate0;\n  return function() {\n    var string0, value1 = value(this), string1;\n    if (value1 == null) return void this.removeAttribute(name);\n    string0 = this.getAttribute(name);\n    string1 = value1 + \"\";\n    return string0 === string1 ? null\n        : string0 === string00 && string1 === string10 ? interpolate0\n        : (string10 = string1, interpolate0 = interpolate(string00 = string0, value1));\n  };\n}\n\nfunction attrFunctionNS(fullname, interpolate, value) {\n  var string00,\n      string10,\n      interpolate0;\n  return function() {\n    var string0, value1 = value(this), string1;\n    if (value1 == null) return void this.removeAttributeNS(fullname.space, fullname.local);\n    string0 = this.getAttributeNS(fullname.space, fullname.local);\n    string1 = value1 + \"\";\n    return string0 === string1 ? null\n        : string0 === string00 && string1 === string10 ? interpolate0\n        : (string10 = string1, interpolate0 = interpolate(string00 = string0, value1));\n  };\n}\n\nexport default function(name, value) {\n  var fullname = namespace(name), i = fullname === \"transform\" ? interpolateTransform : interpolate;\n  return this.attrTween(name, typeof value === \"function\"\n      ? (fullname.local ? attrFunctionNS : attrFunction)(fullname, i, tweenValue(this, \"attr.\" + name, value))\n      : value == null ? (fullname.local ? attrRemoveNS : attrRemove)(fullname)\n      : (fullname.local ? attrConstantNS : attrConstant)(fullname, i, value));\n}\n","import {namespace} from \"d3-selection\";\n\nfunction attrInterpolate(name, i) {\n  return function(t) {\n    this.setAttribute(name, i.call(this, t));\n  };\n}\n\nfunction attrInterpolateNS(fullname, i) {\n  return function(t) {\n    this.setAttributeNS(fullname.space, fullname.local, i.call(this, t));\n  };\n}\n\nfunction attrTweenNS(fullname, value) {\n  var t0, i0;\n  function tween() {\n    var i = value.apply(this, arguments);\n    if (i !== i0) t0 = (i0 = i) && attrInterpolateNS(fullname, i);\n    return t0;\n  }\n  tween._value = value;\n  return tween;\n}\n\nfunction attrTween(name, value) {\n  var t0, i0;\n  function tween() {\n    var i = value.apply(this, arguments);\n    if (i !== i0) t0 = (i0 = i) && attrInterpolate(name, i);\n    return t0;\n  }\n  tween._value = value;\n  return tween;\n}\n\nexport default function(name, value) {\n  var key = \"attr.\" + name;\n  if (arguments.length < 2) return (key = this.tween(key)) && key._value;\n  if (value == null) return this.tween(key, null);\n  if (typeof value !== \"function\") throw new Error;\n  var fullname = namespace(name);\n  return this.tween(key, (fullname.local ? attrTweenNS : attrTween)(fullname, value));\n}\n","import {get, init} from \"./schedule.js\";\n\nfunction delayFunction(id, value) {\n  return function() {\n    init(this, id).delay = +value.apply(this, arguments);\n  };\n}\n\nfunction delayConstant(id, value) {\n  return value = +value, function() {\n    init(this, id).delay = value;\n  };\n}\n\nexport default function(value) {\n  var id = this._id;\n\n  return arguments.length\n      ? this.each((typeof value === \"function\"\n          ? delayFunction\n          : delayConstant)(id, value))\n      : get(this.node(), id).delay;\n}\n","import {get, set} from \"./schedule.js\";\n\nfunction durationFunction(id, value) {\n  return function() {\n    set(this, id).duration = +value.apply(this, arguments);\n  };\n}\n\nfunction durationConstant(id, value) {\n  return value = +value, function() {\n    set(this, id).duration = value;\n  };\n}\n\nexport default function(value) {\n  var id = this._id;\n\n  return arguments.length\n      ? this.each((typeof value === \"function\"\n          ? durationFunction\n          : durationConstant)(id, value))\n      : get(this.node(), id).duration;\n}\n","import {selection} from \"d3-selection\";\n\nvar Selection = selection.prototype.constructor;\n\nexport default function() {\n  return new Selection(this._groups, this._parents);\n}\n","import {interpolateTransformCss as interpolateTransform} from \"d3-interpolate\";\nimport {style} from \"d3-selection\";\nimport {set} from \"./schedule.js\";\nimport {tweenValue} from \"./tween.js\";\nimport interpolate from \"./interpolate.js\";\n\nfunction styleNull(name, interpolate) {\n  var string00,\n      string10,\n      interpolate0;\n  return function() {\n    var string0 = style(this, name),\n        string1 = (this.style.removeProperty(name), style(this, name));\n    return string0 === string1 ? null\n        : string0 === string00 && string1 === string10 ? interpolate0\n        : interpolate0 = interpolate(string00 = string0, string10 = string1);\n  };\n}\n\nfunction styleRemove(name) {\n  return function() {\n    this.style.removeProperty(name);\n  };\n}\n\nfunction styleConstant(name, interpolate, value1) {\n  var string00,\n      string1 = value1 + \"\",\n      interpolate0;\n  return function() {\n    var string0 = style(this, name);\n    return string0 === string1 ? null\n        : string0 === string00 ? interpolate0\n        : interpolate0 = interpolate(string00 = string0, value1);\n  };\n}\n\nfunction styleFunction(name, interpolate, value) {\n  var string00,\n      string10,\n      interpolate0;\n  return function() {\n    var string0 = style(this, name),\n        value1 = value(this),\n        string1 = value1 + \"\";\n    if (value1 == null) string1 = value1 = (this.style.removeProperty(name), style(this, name));\n    return string0 === string1 ? null\n        : string0 === string00 && string1 === string10 ? interpolate0\n        : (string10 = string1, interpolate0 = interpolate(string00 = string0, value1));\n  };\n}\n\nfunction styleMaybeRemove(id, name) {\n  var on0, on1, listener0, key = \"style.\" + name, event = \"end.\" + key, remove;\n  return function() {\n    var schedule = set(this, id),\n        on = schedule.on,\n        listener = schedule.value[key] == null ? remove || (remove = styleRemove(name)) : undefined;\n\n    // If this node shared a dispatch with the previous node,\n    // just assign the updated shared dispatch and we’re done!\n    // Otherwise, copy-on-write.\n    if (on !== on0 || listener0 !== listener) (on1 = (on0 = on).copy()).on(event, listener0 = listener);\n\n    schedule.on = on1;\n  };\n}\n\nexport default function(name, value, priority) {\n  var i = (name += \"\") === \"transform\" ? interpolateTransform : interpolate;\n  return value == null ? this\n      .styleTween(name, styleNull(name, i))\n      .on(\"end.style.\" + name, styleRemove(name))\n    : typeof value === \"function\" ? this\n      .styleTween(name, styleFunction(name, i, tweenValue(this, \"style.\" + name, value)))\n      .each(styleMaybeRemove(this._id, name))\n    : this\n      .styleTween(name, styleConstant(name, i, value), priority)\n      .on(\"end.style.\" + name, null);\n}\n","import {selection} from \"d3-selection\";\nimport transition_attr from \"./attr.js\";\nimport transition_attrTween from \"./attrTween.js\";\nimport transition_delay from \"./delay.js\";\nimport transition_duration from \"./duration.js\";\nimport transition_ease from \"./ease.js\";\nimport transition_easeVarying from \"./easeVarying.js\";\nimport transition_filter from \"./filter.js\";\nimport transition_merge from \"./merge.js\";\nimport transition_on from \"./on.js\";\nimport transition_remove from \"./remove.js\";\nimport transition_select from \"./select.js\";\nimport transition_selectAll from \"./selectAll.js\";\nimport transition_selection from \"./selection.js\";\nimport transition_style from \"./style.js\";\nimport transition_styleTween from \"./styleTween.js\";\nimport transition_text from \"./text.js\";\nimport transition_textTween from \"./textTween.js\";\nimport transition_transition from \"./transition.js\";\nimport transition_tween from \"./tween.js\";\nimport transition_end from \"./end.js\";\n\nvar id = 0;\n\nexport function Transition(groups, parents, name, id) {\n  this._groups = groups;\n  this._parents = parents;\n  this._name = name;\n  this._id = id;\n}\n\nexport default function transition(name) {\n  return selection().transition(name);\n}\n\nexport function newId() {\n  return ++id;\n}\n\nvar selection_prototype = selection.prototype;\n\nTransition.prototype = transition.prototype = {\n  constructor: Transition,\n  select: transition_select,\n  selectAll: transition_selectAll,\n  selectChild: selection_prototype.selectChild,\n  selectChildren: selection_prototype.selectChildren,\n  filter: transition_filter,\n  merge: transition_merge,\n  selection: transition_selection,\n  transition: transition_transition,\n  call: selection_prototype.call,\n  nodes: selection_prototype.nodes,\n  node: selection_prototype.node,\n  size: selection_prototype.size,\n  empty: selection_prototype.empty,\n  each: selection_prototype.each,\n  on: transition_on,\n  attr: transition_attr,\n  attrTween: transition_attrTween,\n  style: transition_style,\n  styleTween: transition_styleTween,\n  text: transition_text,\n  textTween: transition_textTween,\n  remove: transition_remove,\n  tween: transition_tween,\n  delay: transition_delay,\n  duration: transition_duration,\n  ease: transition_ease,\n  easeVarying: transition_easeVarying,\n  end: transition_end,\n  [Symbol.iterator]: selection_prototype[Symbol.iterator]\n};\n","import {selector} from \"d3-selection\";\nimport {Transition} from \"./index.js\";\nimport schedule, {get} from \"./schedule.js\";\n\nexport default function(select) {\n  var name = this._name,\n      id = this._id;\n\n  if (typeof select !== \"function\") select = selector(select);\n\n  for (var groups = this._groups, m = groups.length, subgroups = new Array(m), j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, subgroup = subgroups[j] = new Array(n), node, subnode, i = 0; i < n; ++i) {\n      if ((node = group[i]) && (subnode = select.call(node, node.__data__, i, group))) {\n        if (\"__data__\" in node) subnode.__data__ = node.__data__;\n        subgroup[i] = subnode;\n        schedule(subgroup[i], name, id, i, subgroup, get(node, id));\n      }\n    }\n  }\n\n  return new Transition(subgroups, this._parents, name, id);\n}\n","import {selectorAll} from \"d3-selection\";\nimport {Transition} from \"./index.js\";\nimport schedule, {get} from \"./schedule.js\";\n\nexport default function(select) {\n  var name = this._name,\n      id = this._id;\n\n  if (typeof select !== \"function\") select = selectorAll(select);\n\n  for (var groups = this._groups, m = groups.length, subgroups = [], parents = [], j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, node, i = 0; i < n; ++i) {\n      if (node = group[i]) {\n        for (var children = select.call(node, node.__data__, i, group), child, inherit = get(node, id), k = 0, l = children.length; k < l; ++k) {\n          if (child = children[k]) {\n            schedule(child, name, id, k, children, inherit);\n          }\n        }\n        subgroups.push(children);\n        parents.push(node);\n      }\n    }\n  }\n\n  return new Transition(subgroups, parents, name, id);\n}\n","import {matcher} from \"d3-selection\";\nimport {Transition} from \"./index.js\";\n\nexport default function(match) {\n  if (typeof match !== \"function\") match = matcher(match);\n\n  for (var groups = this._groups, m = groups.length, subgroups = new Array(m), j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, subgroup = subgroups[j] = [], node, i = 0; i < n; ++i) {\n      if ((node = group[i]) && match.call(node, node.__data__, i, group)) {\n        subgroup.push(node);\n      }\n    }\n  }\n\n  return new Transition(subgroups, this._parents, this._name, this._id);\n}\n","import {Transition} from \"./index.js\";\n\nexport default function(transition) {\n  if (transition._id !== this._id) throw new Error;\n\n  for (var groups0 = this._groups, groups1 = transition._groups, m0 = groups0.length, m1 = groups1.length, m = Math.min(m0, m1), merges = new Array(m0), j = 0; j < m; ++j) {\n    for (var group0 = groups0[j], group1 = groups1[j], n = group0.length, merge = merges[j] = new Array(n), node, i = 0; i < n; ++i) {\n      if (node = group0[i] || group1[i]) {\n        merge[i] = node;\n      }\n    }\n  }\n\n  for (; j < m0; ++j) {\n    merges[j] = groups0[j];\n  }\n\n  return new Transition(merges, this._parents, this._name, this._id);\n}\n","import {Transition, newId} from \"./index.js\";\nimport schedule, {get} from \"./schedule.js\";\n\nexport default function() {\n  var name = this._name,\n      id0 = this._id,\n      id1 = newId();\n\n  for (var groups = this._groups, m = groups.length, j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, node, i = 0; i < n; ++i) {\n      if (node = group[i]) {\n        var inherit = get(node, id0);\n        schedule(node, name, id1, i, group, {\n          time: inherit.time + inherit.delay + inherit.duration,\n          delay: 0,\n          duration: inherit.duration,\n          ease: inherit.ease\n        });\n      }\n    }\n  }\n\n  return new Transition(groups, this._parents, name, id1);\n}\n","import {get, set, init} from \"./schedule.js\";\n\nfunction start(name) {\n  return (name + \"\").trim().split(/^|\\s+/).every(function(t) {\n    var i = t.indexOf(\".\");\n    if (i >= 0) t = t.slice(0, i);\n    return !t || t === \"start\";\n  });\n}\n\nfunction onFunction(id, name, listener) {\n  var on0, on1, sit = start(name) ? init : set;\n  return function() {\n    var schedule = sit(this, id),\n        on = schedule.on;\n\n    // If this node shared a dispatch with the previous node,\n    // just assign the updated shared dispatch and we’re done!\n    // Otherwise, copy-on-write.\n    if (on !== on0) (on1 = (on0 = on).copy()).on(name, listener);\n\n    schedule.on = on1;\n  };\n}\n\nexport default function(name, listener) {\n  var id = this._id;\n\n  return arguments.length < 2\n      ? get(this.node(), id).on.on(name)\n      : this.each(onFunction(id, name, listener));\n}\n","function styleInterpolate(name, i, priority) {\n  return function(t) {\n    this.style.setProperty(name, i.call(this, t), priority);\n  };\n}\n\nfunction styleTween(name, value, priority) {\n  var t, i0;\n  function tween() {\n    var i = value.apply(this, arguments);\n    if (i !== i0) t = (i0 = i) && styleInterpolate(name, i, priority);\n    return t;\n  }\n  tween._value = value;\n  return tween;\n}\n\nexport default function(name, value, priority) {\n  var key = \"style.\" + (name += \"\");\n  if (arguments.length < 2) return (key = this.tween(key)) && key._value;\n  if (value == null) return this.tween(key, null);\n  if (typeof value !== \"function\") throw new Error;\n  return this.tween(key, styleTween(name, value, priority == null ? \"\" : priority));\n}\n","import {tweenValue} from \"./tween.js\";\n\nfunction textConstant(value) {\n  return function() {\n    this.textContent = value;\n  };\n}\n\nfunction textFunction(value) {\n  return function() {\n    var value1 = value(this);\n    this.textContent = value1 == null ? \"\" : value1;\n  };\n}\n\nexport default function(value) {\n  return this.tween(\"text\", typeof value === \"function\"\n      ? textFunction(tweenValue(this, \"text\", value))\n      : textConstant(value == null ? \"\" : value + \"\"));\n}\n","function textInterpolate(i) {\n  return function(t) {\n    this.textContent = i.call(this, t);\n  };\n}\n\nfunction textTween(value) {\n  var t0, i0;\n  function tween() {\n    var i = value.apply(this, arguments);\n    if (i !== i0) t0 = (i0 = i) && textInterpolate(i);\n    return t0;\n  }\n  tween._value = value;\n  return tween;\n}\n\nexport default function(value) {\n  var key = \"text\";\n  if (arguments.length < 1) return (key = this.tween(key)) && key._value;\n  if (value == null) return this.tween(key, null);\n  if (typeof value !== \"function\") throw new Error;\n  return this.tween(key, textTween(value));\n}\n","function removeFunction(id) {\n  return function() {\n    var parent = this.parentNode;\n    for (var i in this.__transition) if (+i !== id) return;\n    if (parent) parent.removeChild(this);\n  };\n}\n\nexport default function() {\n  return this.on(\"end.remove\", removeFunction(this._id));\n}\n","import {get, set} from \"./schedule.js\";\n\nfunction easeConstant(id, value) {\n  if (typeof value !== \"function\") throw new Error;\n  return function() {\n    set(this, id).ease = value;\n  };\n}\n\nexport default function(value) {\n  var id = this._id;\n\n  return arguments.length\n      ? this.each(easeConstant(id, value))\n      : get(this.node(), id).ease;\n}\n","import {set} from \"./schedule.js\";\n\nfunction easeVarying(id, value) {\n  return function() {\n    var v = value.apply(this, arguments);\n    if (typeof v !== \"function\") throw new Error;\n    set(this, id).ease = v;\n  };\n}\n\nexport default function(value) {\n  if (typeof value !== \"function\") throw new Error;\n  return this.each(easeVarying(this._id, value));\n}\n","import {set} from \"./schedule.js\";\n\nexport default function() {\n  var on0, on1, that = this, id = that._id, size = that.size();\n  return new Promise(function(resolve, reject) {\n    var cancel = {value: reject},\n        end = {value: function() { if (--size === 0) resolve(); }};\n\n    that.each(function() {\n      var schedule = set(this, id),\n          on = schedule.on;\n\n      // If this node shared a dispatch with the previous node,\n      // just assign the updated shared dispatch and we’re done!\n      // Otherwise, copy-on-write.\n      if (on !== on0) {\n        on1 = (on0 = on).copy();\n        on1._.cancel.push(cancel);\n        on1._.interrupt.push(cancel);\n        on1._.end.push(end);\n      }\n\n      schedule.on = on1;\n    });\n\n    // The selection was empty, resolve end immediately\n    if (size === 0) resolve();\n  });\n}\n","import {Transition, newId} from \"../transition/index.js\";\nimport schedule from \"../transition/schedule.js\";\nimport {easeCubicInOut} from \"d3-ease\";\nimport {now} from \"d3-timer\";\n\nvar defaultTiming = {\n  time: null, // Set on use.\n  delay: 0,\n  duration: 250,\n  ease: easeCubicInOut\n};\n\nfunction inherit(node, id) {\n  var timing;\n  while (!(timing = node.__transition) || !(timing = timing[id])) {\n    if (!(node = node.parentNode)) {\n      throw new Error(`transition ${id} not found`);\n    }\n  }\n  return timing;\n}\n\nexport default function(name) {\n  var id,\n      timing;\n\n  if (name instanceof Transition) {\n    id = name._id, name = name._name;\n  } else {\n    id = newId(), (timing = defaultTiming).time = now(), name = name == null ? null : name + \"\";\n  }\n\n  for (var groups = this._groups, m = groups.length, j = 0; j < m; ++j) {\n    for (var group = groups[j], n = group.length, node, i = 0; i < n; ++i) {\n      if (node = group[i]) {\n        schedule(node, name, id, i, group, timing || inherit(node, id));\n      }\n    }\n  }\n\n  return new Transition(groups, this._parents, name, id);\n}\n","export function cubicIn(t) {\n  return t * t * t;\n}\n\nexport function cubicOut(t) {\n  return --t * t * t + 1;\n}\n\nexport function cubicInOut(t) {\n  return ((t *= 2) <= 1 ? t * t * t : (t -= 2) * t * t + 2) / 2;\n}\n","import {selection} from \"d3-selection\";\nimport selection_interrupt from \"./interrupt.js\";\nimport selection_transition from \"./transition.js\";\n\nselection.prototype.interrupt = selection_interrupt;\nselection.prototype.transition = selection_transition;\n","import interrupt from \"../interrupt.js\";\n\nexport default function(name) {\n  return this.each(function() {\n    interrupt(this, name);\n  });\n}\n","export default x => () => x;\n","export default function ZoomEvent(type, {\n  sourceEvent,\n  target,\n  transform,\n  dispatch\n}) {\n  Object.defineProperties(this, {\n    type: {value: type, enumerable: true, configurable: true},\n    sourceEvent: {value: sourceEvent, enumerable: true, configurable: true},\n    target: {value: target, enumerable: true, configurable: true},\n    transform: {value: transform, enumerable: true, configurable: true},\n    _: {value: dispatch}\n  });\n}\n","export function Transform(k, x, y) {\n  this.k = k;\n  this.x = x;\n  this.y = y;\n}\n\nTransform.prototype = {\n  constructor: Transform,\n  scale: function(k) {\n    return k === 1 ? this : new Transform(this.k * k, this.x, this.y);\n  },\n  translate: function(x, y) {\n    return x === 0 & y === 0 ? this : new Transform(this.k, this.x + this.k * x, this.y + this.k * y);\n  },\n  apply: function(point) {\n    return [point[0] * this.k + this.x, point[1] * this.k + this.y];\n  },\n  applyX: function(x) {\n    return x * this.k + this.x;\n  },\n  applyY: function(y) {\n    return y * this.k + this.y;\n  },\n  invert: function(location) {\n    return [(location[0] - this.x) / this.k, (location[1] - this.y) / this.k];\n  },\n  invertX: function(x) {\n    return (x - this.x) / this.k;\n  },\n  invertY: function(y) {\n    return (y - this.y) / this.k;\n  },\n  rescaleX: function(x) {\n    return x.copy().domain(x.range().map(this.invertX, this).map(x.invert, x));\n  },\n  rescaleY: function(y) {\n    return y.copy().domain(y.range().map(this.invertY, this).map(y.invert, y));\n  },\n  toString: function() {\n    return \"translate(\" + this.x + \",\" + this.y + \") scale(\" + this.k + \")\";\n  }\n};\n\nexport var identity = new Transform(1, 0, 0);\n\ntransform.prototype = Transform.prototype;\n\nexport default function transform(node) {\n  while (!node.__zoom) if (!(node = node.parentNode)) return identity;\n  return node.__zoom;\n}\n","import create from 'zustand';\nimport createContext from 'zustand/context';\nimport { zoomIdentity } from 'd3-zoom';\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nvar ConnectionMode;\n\n(function (ConnectionMode) {\n  ConnectionMode[\"Strict\"] = \"strict\";\n  ConnectionMode[\"Loose\"] = \"loose\";\n})(ConnectionMode || (ConnectionMode = {}));\n\nvar BackgroundVariant;\n\n(function (BackgroundVariant) {\n  BackgroundVariant[\"Lines\"] = \"lines\";\n  BackgroundVariant[\"Dots\"] = \"dots\";\n})(BackgroundVariant || (BackgroundVariant = {}));\n\nvar PanOnScrollMode;\n\n(function (PanOnScrollMode) {\n  PanOnScrollMode[\"Free\"] = \"free\";\n  PanOnScrollMode[\"Vertical\"] = \"vertical\";\n  PanOnScrollMode[\"Horizontal\"] = \"horizontal\";\n})(PanOnScrollMode || (PanOnScrollMode = {}));\n\nvar ConnectionLineType;\n\n(function (ConnectionLineType) {\n  ConnectionLineType[\"Bezier\"] = \"default\";\n  ConnectionLineType[\"Straight\"] = \"straight\";\n  ConnectionLineType[\"Step\"] = \"step\";\n  ConnectionLineType[\"SmoothStep\"] = \"smoothstep\";\n  ConnectionLineType[\"SimpleBezier\"] = \"simplebezier\";\n})(ConnectionLineType || (ConnectionLineType = {}));\n\nvar MarkerType;\n\n(function (MarkerType) {\n  MarkerType[\"Arrow\"] = \"arrow\";\n  MarkerType[\"ArrowClosed\"] = \"arrowclosed\";\n})(MarkerType || (MarkerType = {}));\n\nvar Position;\n\n(function (Position) {\n  Position[\"Left\"] = \"left\";\n  Position[\"Top\"] = \"top\";\n  Position[\"Right\"] = \"right\";\n  Position[\"Bottom\"] = \"bottom\";\n})(Position || (Position = {}));\n\nvar getDimensions = function getDimensions(node) {\n  return {\n    width: node.offsetWidth,\n    height: node.offsetHeight\n  };\n};\nvar clamp = function clamp(val) {\n  var min = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  var max = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n  return Math.min(Math.max(val, min), max);\n};\nvar clampPosition = function clampPosition(position, extent) {\n  return {\n    x: clamp(position.x, extent[0][0], extent[1][0]),\n    y: clamp(position.y, extent[0][1], extent[1][1])\n  };\n};\nvar getHostForElement = function getHostForElement(element) {\n  var _element$getRootNode, _window;\n\n  return ((_element$getRootNode = element.getRootNode) === null || _element$getRootNode === void 0 ? void 0 : _element$getRootNode.call(element)) || ((_window = window) === null || _window === void 0 ? void 0 : _window.document);\n};\nvar getBoundsOfBoxes = function getBoundsOfBoxes(box1, box2) {\n  return {\n    x: Math.min(box1.x, box2.x),\n    y: Math.min(box1.y, box2.y),\n    x2: Math.max(box1.x2, box2.x2),\n    y2: Math.max(box1.y2, box2.y2)\n  };\n};\nvar rectToBox = function rectToBox(_ref) {\n  var x = _ref.x,\n      y = _ref.y,\n      width = _ref.width,\n      height = _ref.height;\n  return {\n    x: x,\n    y: y,\n    x2: x + width,\n    y2: y + height\n  };\n};\nvar boxToRect = function boxToRect(_ref2) {\n  var x = _ref2.x,\n      y = _ref2.y,\n      x2 = _ref2.x2,\n      y2 = _ref2.y2;\n  return {\n    x: x,\n    y: y,\n    width: x2 - x,\n    height: y2 - y\n  };\n};\nvar getBoundsofRects = function getBoundsofRects(rect1, rect2) {\n  return boxToRect(getBoundsOfBoxes(rectToBox(rect1), rectToBox(rect2)));\n};\nvar isNumeric = function isNumeric(n) {\n  return !isNaN(n) && isFinite(n);\n};\nvar internalsSymbol = Symbol('internals');\n\nfunction ownKeys$4(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$4(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$4(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$4(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction handleParentExpand(res, updateItem) {\n  var parent = res.find(function (e) {\n    return e.id === updateItem.parentNode;\n  });\n\n  if (parent) {\n    var extendWidth = updateItem.position.x + updateItem.width - parent.width;\n    var extendHeight = updateItem.position.y + updateItem.height - parent.height;\n\n    if (extendWidth > 0 || extendHeight > 0 || updateItem.position.x < 0 || updateItem.position.y < 0) {\n      var _parent$style$width, _parent$style$height;\n\n      parent.style = _objectSpread$4({}, parent.style) || {};\n      parent.style.width = (_parent$style$width = parent.style.width) !== null && _parent$style$width !== void 0 ? _parent$style$width : parent.width;\n      parent.style.height = (_parent$style$height = parent.style.height) !== null && _parent$style$height !== void 0 ? _parent$style$height : parent.height;\n\n      if (extendWidth > 0) {\n        parent.style.width += extendWidth;\n      }\n\n      if (extendHeight > 0) {\n        parent.style.height += extendHeight;\n      }\n\n      if (updateItem.position.x < 0) {\n        var xDiff = Math.abs(updateItem.position.x);\n        parent.position.x = parent.position.x - xDiff;\n        parent.style.width += xDiff;\n        updateItem.position.x = 0;\n      }\n\n      if (updateItem.position.y < 0) {\n        var yDiff = Math.abs(updateItem.position.y);\n        parent.position.y = parent.position.y - yDiff;\n        parent.style.height += yDiff;\n        updateItem.position.y = 0;\n      }\n\n      parent.width = parent.style.width;\n      parent.height = parent.style.height;\n    }\n  }\n}\n\nfunction applyChanges(changes, elements) {\n  // we need this hack to handle the setNodes and setEdges function of the useReactFlow hook for controlled flows\n  if (changes.some(function (c) {\n    return c.type === 'reset';\n  })) {\n    return changes.filter(function (c) {\n      return c.type === 'reset';\n    }).map(function (c) {\n      return c.item;\n    });\n  }\n\n  var initElements = changes.filter(function (c) {\n    return c.type === 'add';\n  }).map(function (c) {\n    return c.item;\n  });\n  return elements.reduce(function (res, item) {\n    var currentChange = changes.find(function (c) {\n      return c.id === item.id;\n    });\n\n    if (currentChange) {\n      switch (currentChange.type) {\n        case 'select':\n          {\n            res.push(_objectSpread$4(_objectSpread$4({}, item), {}, {\n              selected: currentChange.selected\n            }));\n            return res;\n          }\n\n        case 'position':\n          {\n            var updateItem = _objectSpread$4({}, item);\n\n            if (typeof currentChange.position !== 'undefined') {\n              updateItem.position = currentChange.position;\n            }\n\n            if (typeof currentChange.positionAbsolute !== 'undefined') {\n              updateItem.positionAbsolute = currentChange.positionAbsolute;\n            }\n\n            if (typeof currentChange.dragging !== 'undefined') {\n              updateItem.dragging = currentChange.dragging;\n            }\n\n            if (updateItem.expandParent) {\n              handleParentExpand(res, updateItem);\n            }\n\n            res.push(updateItem);\n            return res;\n          }\n\n        case 'dimensions':\n          {\n            var _updateItem = _objectSpread$4({}, item);\n\n            if (typeof currentChange.dimensions !== 'undefined') {\n              _updateItem.width = currentChange.dimensions.width;\n              _updateItem.height = currentChange.dimensions.height;\n            }\n\n            if (_updateItem.expandParent) {\n              handleParentExpand(res, _updateItem);\n            }\n\n            res.push(_updateItem);\n            return res;\n          }\n\n        case 'remove':\n          {\n            return res;\n          }\n      }\n    }\n\n    res.push(item);\n    return res;\n  }, initElements);\n}\n\nfunction applyNodeChanges(changes, nodes) {\n  return applyChanges(changes, nodes);\n}\nfunction applyEdgeChanges(changes, edges) {\n  return applyChanges(changes, edges);\n}\nvar createSelectionChange = function createSelectionChange(id, selected) {\n  return {\n    id: id,\n    type: 'select',\n    selected: selected\n  };\n};\nfunction getSelectionChanges(items, selectedIds) {\n  return items.reduce(function (res, item) {\n    var willBeSelected = selectedIds.includes(item.id);\n\n    if (!item.selected && willBeSelected) {\n      item.selected = true;\n      res.push(createSelectionChange(item.id, true));\n    } else if (item.selected && !willBeSelected) {\n      item.selected = false;\n      res.push(createSelectionChange(item.id, false));\n    }\n\n    return res;\n  }, []);\n}\n\nfunction ownKeys$3(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$3(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$3(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$3(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nvar getHandleBounds = function getHandleBounds(selector, nodeElement, zoom) {\n  var handles = nodeElement.querySelectorAll(selector);\n\n  if (!handles || !handles.length) {\n    return null;\n  }\n\n  var handlesArray = Array.from(handles);\n  var nodeBounds = nodeElement.getBoundingClientRect();\n  return handlesArray.map(function (handle) {\n    var handleBounds = handle.getBoundingClientRect();\n    return _objectSpread$3({\n      id: handle.getAttribute('data-handleid'),\n      position: handle.getAttribute('data-handlepos'),\n      x: (handleBounds.left - nodeBounds.left) / zoom,\n      y: (handleBounds.top - nodeBounds.top) / zoom\n    }, getDimensions(handle));\n  });\n};\nfunction getMouseHandler(id, getState, handler) {\n  return handler === undefined ? handler : function (event) {\n    var node = getState().nodeInternals.get(id);\n    handler(event, _objectSpread$3({}, node));\n  };\n} // this handler is called by\n// 1. the click handler when node is not draggable or selectNodesOnDrag = false\n// or\n// 2. the on drag start handler when node is draggable and selectNodesOnDrag = true\n\nfunction handleNodeClick(_ref) {\n  var id = _ref.id,\n      store = _ref.store;\n\n  var _store$getState = store.getState(),\n      addSelectedNodes = _store$getState.addSelectedNodes,\n      unselectNodesAndEdges = _store$getState.unselectNodesAndEdges,\n      multiSelectionActive = _store$getState.multiSelectionActive,\n      nodeInternals = _store$getState.nodeInternals;\n\n  var node = nodeInternals.get(id);\n  store.setState({\n    nodesSelectionActive: false\n  });\n\n  if (!node.selected) {\n    addSelectedNodes([id]);\n  } else if (node.selected && multiSelectionActive) {\n    unselectNodesAndEdges({\n      nodes: [node]\n    });\n  }\n}\n\nfunction ownKeys$2(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$2(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$2(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$2(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nvar isEdge = function isEdge(element) {\n  return 'id' in element && 'source' in element && 'target' in element;\n};\nvar isNode = function isNode(element) {\n  return 'id' in element && !('source' in element) && !('target' in element);\n};\nvar getOutgoers = function getOutgoers(node, nodes, edges) {\n  if (!isNode(node)) {\n    return [];\n  }\n\n  var outgoerIds = edges.filter(function (e) {\n    return e.source === node.id;\n  }).map(function (e) {\n    return e.target;\n  });\n  return nodes.filter(function (n) {\n    return outgoerIds.includes(n.id);\n  });\n};\nvar getIncomers = function getIncomers(node, nodes, edges) {\n  if (!isNode(node)) {\n    return [];\n  }\n\n  var incomersIds = edges.filter(function (e) {\n    return e.target === node.id;\n  }).map(function (e) {\n    return e.source;\n  });\n  return nodes.filter(function (n) {\n    return incomersIds.includes(n.id);\n  });\n};\n\nvar getEdgeId = function getEdgeId(_ref) {\n  var source = _ref.source,\n      sourceHandle = _ref.sourceHandle,\n      target = _ref.target,\n      targetHandle = _ref.targetHandle;\n  return \"reactflow__edge-\".concat(source).concat(sourceHandle || '', \"-\").concat(target).concat(targetHandle || '');\n};\n\nvar getMarkerId = function getMarkerId(marker, rfId) {\n  if (typeof marker === 'undefined') {\n    return '';\n  }\n\n  if (typeof marker === 'string') {\n    return marker;\n  }\n\n  var idPrefix = rfId ? \"\".concat(rfId, \"__\") : '';\n  return \"\".concat(idPrefix).concat(Object.keys(marker).sort().map(function (key) {\n    return \"\".concat(key, \"=\").concat(marker[key]);\n  }).join('&'));\n};\n\nvar connectionExists = function connectionExists(edge, edges) {\n  return edges.some(function (el) {\n    return el.source === edge.source && el.target === edge.target && (el.sourceHandle === edge.sourceHandle || !el.sourceHandle && !edge.sourceHandle) && (el.targetHandle === edge.targetHandle || !el.targetHandle && !edge.targetHandle);\n  });\n};\n\nvar addEdge = function addEdge(edgeParams, edges) {\n  if (!edgeParams.source || !edgeParams.target) {\n    // @ts-ignore\n    if (process.env.NODE_ENV === 'development') {\n      console.warn(\"[React Flow]: Can't create edge. An edge needs a source and a target. Help: https://reactflow.dev/error#600\");\n    }\n\n    return edges;\n  }\n\n  var edge;\n\n  if (isEdge(edgeParams)) {\n    edge = _objectSpread$2({}, edgeParams);\n  } else {\n    edge = _objectSpread$2(_objectSpread$2({}, edgeParams), {}, {\n      id: getEdgeId(edgeParams)\n    });\n  }\n\n  if (connectionExists(edge, edges)) {\n    return edges;\n  }\n\n  return edges.concat(edge);\n};\nvar updateEdge = function updateEdge(oldEdge, newConnection, edges) {\n  if (!newConnection.source || !newConnection.target) {\n    // @ts-ignore\n    if (process.env.NODE_ENV === 'development') {\n      console.warn(\"[React Flow]: Can't create a new edge. An edge needs a source and a target. Help: https://reactflow.dev/error#600\");\n    }\n\n    return edges;\n  }\n\n  var foundEdge = edges.find(function (e) {\n    return e.id === oldEdge.id;\n  });\n\n  if (!foundEdge) {\n    // @ts-ignore\n    if (process.env.NODE_ENV === 'development') {\n      console.warn(\"[React Flow]: The old edge with id=\".concat(oldEdge.id, \" does not exist. Help: https://reactflow.dev/error#700\"));\n    }\n\n    return edges;\n  } // Remove old edge and create the new edge with parameters of old edge.\n\n\n  var edge = _objectSpread$2(_objectSpread$2({}, oldEdge), {}, {\n    id: getEdgeId(newConnection),\n    source: newConnection.source,\n    target: newConnection.target,\n    sourceHandle: newConnection.sourceHandle,\n    targetHandle: newConnection.targetHandle\n  });\n\n  return edges.filter(function (e) {\n    return e.id !== oldEdge.id;\n  }).concat(edge);\n};\nvar pointToRendererPoint = function pointToRendererPoint(_ref2, _ref3, snapToGrid, _ref4) {\n  var x = _ref2.x,\n      y = _ref2.y;\n\n  var _ref5 = _slicedToArray(_ref3, 3),\n      tx = _ref5[0],\n      ty = _ref5[1],\n      tScale = _ref5[2];\n\n  var _ref6 = _slicedToArray(_ref4, 2),\n      snapX = _ref6[0],\n      snapY = _ref6[1];\n\n  var position = {\n    x: (x - tx) / tScale,\n    y: (y - ty) / tScale\n  };\n\n  if (snapToGrid) {\n    return {\n      x: snapX * Math.round(position.x / snapX),\n      y: snapY * Math.round(position.y / snapY)\n    };\n  }\n\n  return position;\n};\nvar getRectOfNodes = function getRectOfNodes(nodes) {\n  if (nodes.length === 0) {\n    return {\n      x: 0,\n      y: 0,\n      width: 0,\n      height: 0\n    };\n  }\n\n  var box = nodes.reduce(function (currBox, _ref7) {\n    var positionAbsolute = _ref7.positionAbsolute,\n        position = _ref7.position,\n        width = _ref7.width,\n        height = _ref7.height;\n    return getBoundsOfBoxes(currBox, rectToBox({\n      x: positionAbsolute ? positionAbsolute.x : position.x,\n      y: positionAbsolute ? positionAbsolute.y : position.y,\n      width: width || 0,\n      height: height || 0\n    }));\n  }, {\n    x: Infinity,\n    y: Infinity,\n    x2: -Infinity,\n    y2: -Infinity\n  });\n  return boxToRect(box);\n};\nvar getNodesInside = function getNodesInside(nodeInternals, rect) {\n  var _ref8 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [0, 0, 1],\n      _ref9 = _slicedToArray(_ref8, 3),\n      tx = _ref9[0],\n      ty = _ref9[1],\n      tScale = _ref9[2];\n\n  var partially = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var excludeNonSelectableNodes = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n  var rBox = rectToBox({\n    x: (rect.x - tx) / tScale,\n    y: (rect.y - ty) / tScale,\n    width: rect.width / tScale,\n    height: rect.height / tScale\n  });\n  var visibleNodes = [];\n  nodeInternals.forEach(function (node) {\n    var positionAbsolute = node.positionAbsolute,\n        width = node.width,\n        height = node.height,\n        _node$selectable = node.selectable,\n        selectable = _node$selectable === void 0 ? true : _node$selectable;\n\n    if (excludeNonSelectableNodes && !selectable) {\n      return false;\n    }\n\n    var nBox = rectToBox(_objectSpread$2(_objectSpread$2({}, positionAbsolute), {}, {\n      width: width || 0,\n      height: height || 0\n    }));\n    var xOverlap = Math.max(0, Math.min(rBox.x2, nBox.x2) - Math.max(rBox.x, nBox.x));\n    var yOverlap = Math.max(0, Math.min(rBox.y2, nBox.y2) - Math.max(rBox.y, nBox.y));\n    var overlappingArea = Math.ceil(xOverlap * yOverlap);\n    var notInitialized = typeof width === 'undefined' || typeof height === 'undefined' || width === null || height === null;\n    var partiallyVisible = partially && overlappingArea > 0;\n    var area = (width || 0) * (height || 0);\n    var isVisible = notInitialized || partiallyVisible || overlappingArea >= area;\n\n    if (isVisible) {\n      visibleNodes.push(node);\n    }\n  });\n  return visibleNodes;\n};\nvar getConnectedEdges = function getConnectedEdges(nodes, edges) {\n  var nodeIds = nodes.map(function (node) {\n    return node.id;\n  });\n  return edges.filter(function (edge) {\n    return nodeIds.includes(edge.source) || nodeIds.includes(edge.target);\n  });\n};\nvar getTransformForBounds = function getTransformForBounds(bounds, width, height, minZoom, maxZoom) {\n  var padding = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0.1;\n  var xZoom = width / (bounds.width * (1 + padding));\n  var yZoom = height / (bounds.height * (1 + padding));\n  var zoom = Math.min(xZoom, yZoom);\n  var clampedZoom = clamp(zoom, minZoom, maxZoom);\n  var boundsCenterX = bounds.x + bounds.width / 2;\n  var boundsCenterY = bounds.y + bounds.height / 2;\n  var x = width / 2 - boundsCenterX * clampedZoom;\n  var y = height / 2 - boundsCenterY * clampedZoom;\n  return [x, y, clampedZoom];\n};\nvar getD3Transition = function getD3Transition(selection) {\n  var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  return selection.transition().duration(duration);\n};\n\nfunction ownKeys$1(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$1(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$1(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$1(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction calculateXYZPosition(node, nodeInternals, parentNodes, result) {\n  var _result$x, _parentNode$position$, _parentNode$position, _result$y, _parentNode$position$2, _parentNode$position2, _parentNode$internals, _parentNode$internals2, _result$z, _parentNode$internals3, _parentNode$internals4, _result$z2;\n\n  if (!node.parentNode) {\n    return result;\n  }\n\n  var parentNode = nodeInternals.get(node.parentNode);\n  return calculateXYZPosition(parentNode, nodeInternals, parentNodes, {\n    x: ((_result$x = result.x) !== null && _result$x !== void 0 ? _result$x : 0) + ((_parentNode$position$ = (_parentNode$position = parentNode.position) === null || _parentNode$position === void 0 ? void 0 : _parentNode$position.x) !== null && _parentNode$position$ !== void 0 ? _parentNode$position$ : 0),\n    y: ((_result$y = result.y) !== null && _result$y !== void 0 ? _result$y : 0) + ((_parentNode$position$2 = (_parentNode$position2 = parentNode.position) === null || _parentNode$position2 === void 0 ? void 0 : _parentNode$position2.y) !== null && _parentNode$position$2 !== void 0 ? _parentNode$position$2 : 0),\n    z: ((_parentNode$internals = (_parentNode$internals2 = parentNode[internalsSymbol]) === null || _parentNode$internals2 === void 0 ? void 0 : _parentNode$internals2.z) !== null && _parentNode$internals !== void 0 ? _parentNode$internals : 0) > ((_result$z = result.z) !== null && _result$z !== void 0 ? _result$z : 0) ? (_parentNode$internals3 = (_parentNode$internals4 = parentNode[internalsSymbol]) === null || _parentNode$internals4 === void 0 ? void 0 : _parentNode$internals4.z) !== null && _parentNode$internals3 !== void 0 ? _parentNode$internals3 : 0 : (_result$z2 = result.z) !== null && _result$z2 !== void 0 ? _result$z2 : 0\n  });\n}\n\nfunction createNodeInternals(nodes, nodeInternals) {\n  var nextNodeInternals = new Map();\n  var parentNodes = {};\n  nodes.forEach(function (node) {\n    var _currInternals$intern;\n\n    var z = isNumeric(node.zIndex) ? node.zIndex : node.selected ? 1000 : 0;\n    var currInternals = nodeInternals.get(node.id);\n\n    var internals = _objectSpread$1(_objectSpread$1({\n      width: currInternals === null || currInternals === void 0 ? void 0 : currInternals.width,\n      height: currInternals === null || currInternals === void 0 ? void 0 : currInternals.height\n    }, node), {}, {\n      positionAbsolute: {\n        x: node.position.x,\n        y: node.position.y\n      }\n    });\n\n    if (node.parentNode) {\n      internals.parentNode = node.parentNode;\n      parentNodes[node.parentNode] = true;\n    }\n\n    Object.defineProperty(internals, internalsSymbol, {\n      enumerable: false,\n      value: {\n        handleBounds: currInternals === null || currInternals === void 0 ? void 0 : (_currInternals$intern = currInternals[internalsSymbol]) === null || _currInternals$intern === void 0 ? void 0 : _currInternals$intern.handleBounds,\n        z: z\n      }\n    });\n    nextNodeInternals.set(node.id, internals);\n  });\n  nextNodeInternals.forEach(function (node) {\n    if (node.parentNode && !nextNodeInternals.has(node.parentNode)) {\n      throw new Error(\"Parent node \".concat(node.parentNode, \" not found\"));\n    }\n\n    if (node.parentNode || parentNodes[node.id]) {\n      var _node$internalsSymbol, _node$internalsSymbol2;\n\n      var _calculateXYZPosition = calculateXYZPosition(node, nextNodeInternals, parentNodes, _objectSpread$1(_objectSpread$1({}, node.position), {}, {\n        z: (_node$internalsSymbol = (_node$internalsSymbol2 = node[internalsSymbol]) === null || _node$internalsSymbol2 === void 0 ? void 0 : _node$internalsSymbol2.z) !== null && _node$internalsSymbol !== void 0 ? _node$internalsSymbol : 0\n      })),\n          x = _calculateXYZPosition.x,\n          y = _calculateXYZPosition.y,\n          z = _calculateXYZPosition.z;\n\n      node.positionAbsolute = {\n        x: x,\n        y: y\n      };\n      node[internalsSymbol].z = z;\n\n      if (parentNodes[node.id]) {\n        node[internalsSymbol].isParent = true;\n      }\n    }\n  });\n  return nextNodeInternals;\n}\nfunction fitView(get) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  var _get = get(),\n      nodeInternals = _get.nodeInternals,\n      width = _get.width,\n      height = _get.height,\n      minZoom = _get.minZoom,\n      maxZoom = _get.maxZoom,\n      d3Zoom = _get.d3Zoom,\n      d3Selection = _get.d3Selection,\n      fitViewOnInitDone = _get.fitViewOnInitDone,\n      fitViewOnInit = _get.fitViewOnInit;\n\n  if (options.initial && !fitViewOnInitDone && fitViewOnInit || !options.initial) {\n    if (d3Zoom && d3Selection) {\n      var nodes = Array.from(nodeInternals.values()).filter(function (n) {\n        return options.includeHiddenNodes ? n.width && n.height : !n.hidden;\n      });\n      var nodesInitialized = nodes.every(function (n) {\n        return n.width && n.height;\n      });\n\n      if (nodes.length > 0 && nodesInitialized) {\n        var _options$minZoom, _options$maxZoom, _options$padding;\n\n        var bounds = getRectOfNodes(nodes);\n\n        var _getTransformForBound = getTransformForBounds(bounds, width, height, (_options$minZoom = options.minZoom) !== null && _options$minZoom !== void 0 ? _options$minZoom : minZoom, (_options$maxZoom = options.maxZoom) !== null && _options$maxZoom !== void 0 ? _options$maxZoom : maxZoom, (_options$padding = options.padding) !== null && _options$padding !== void 0 ? _options$padding : 0.1),\n            _getTransformForBound2 = _slicedToArray(_getTransformForBound, 3),\n            x = _getTransformForBound2[0],\n            y = _getTransformForBound2[1],\n            zoom = _getTransformForBound2[2];\n\n        var nextTransform = zoomIdentity.translate(x, y).scale(zoom);\n\n        if (typeof options.duration === 'number' && options.duration > 0) {\n          d3Zoom.transform(getD3Transition(d3Selection, options.duration), nextTransform);\n        } else {\n          d3Zoom.transform(d3Selection, nextTransform);\n        }\n\n        return true;\n      }\n    }\n  }\n\n  return false;\n}\nfunction handleControlledNodeSelectionChange(nodeChanges, nodeInternals) {\n  nodeChanges.forEach(function (change) {\n    var node = nodeInternals.get(change.id);\n\n    if (node) {\n      var _objectSpread2;\n\n      nodeInternals.set(node.id, _objectSpread$1(_objectSpread$1({}, node), {}, (_objectSpread2 = {}, _defineProperty(_objectSpread2, internalsSymbol, node[internalsSymbol]), _defineProperty(_objectSpread2, \"selected\", change.selected), _objectSpread2)));\n    }\n  });\n  return new Map(nodeInternals);\n}\nfunction handleControlledEdgeSelectionChange(edgeChanges, edges) {\n  return edges.map(function (e) {\n    var change = edgeChanges.find(function (change) {\n      return change.id === e.id;\n    });\n\n    if (change) {\n      e.selected = change.selected;\n    }\n\n    return e;\n  });\n}\nfunction updateNodesAndEdgesSelections(_ref) {\n  var changedNodes = _ref.changedNodes,\n      changedEdges = _ref.changedEdges,\n      get = _ref.get,\n      set = _ref.set;\n\n  var _get2 = get(),\n      nodeInternals = _get2.nodeInternals,\n      edges = _get2.edges,\n      onNodesChange = _get2.onNodesChange,\n      onEdgesChange = _get2.onEdgesChange,\n      hasDefaultNodes = _get2.hasDefaultNodes,\n      hasDefaultEdges = _get2.hasDefaultEdges;\n\n  if (changedNodes !== null && changedNodes !== void 0 && changedNodes.length) {\n    if (hasDefaultNodes) {\n      set({\n        nodeInternals: handleControlledNodeSelectionChange(changedNodes, nodeInternals)\n      });\n    }\n\n    onNodesChange === null || onNodesChange === void 0 ? void 0 : onNodesChange(changedNodes);\n  }\n\n  if (changedEdges !== null && changedEdges !== void 0 && changedEdges.length) {\n    if (hasDefaultEdges) {\n      set({\n        edges: handleControlledEdgeSelectionChange(changedEdges, edges)\n      });\n    }\n\n    onEdgesChange === null || onEdgesChange === void 0 ? void 0 : onEdgesChange(changedEdges);\n  }\n}\n\nvar infiniteExtent = [[Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY], [Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY]];\nvar initialState = {\n  width: 0,\n  height: 0,\n  transform: [0, 0, 1],\n  nodeInternals: new Map(),\n  edges: [],\n  onNodesChange: null,\n  onEdgesChange: null,\n  hasDefaultNodes: false,\n  hasDefaultEdges: false,\n  d3Zoom: null,\n  d3Selection: null,\n  d3ZoomHandler: undefined,\n  minZoom: 0.5,\n  maxZoom: 2,\n  translateExtent: infiniteExtent,\n  nodeExtent: infiniteExtent,\n  nodesSelectionActive: false,\n  userSelectionActive: false,\n  connectionNodeId: null,\n  connectionHandleId: null,\n  connectionHandleType: 'source',\n  connectionPosition: {\n    x: 0,\n    y: 0\n  },\n  connectionMode: ConnectionMode.Strict,\n  domNode: null,\n  snapGrid: [15, 15],\n  snapToGrid: false,\n  nodesDraggable: true,\n  nodesConnectable: true,\n  elementsSelectable: true,\n  fitViewOnInit: false,\n  fitViewOnInitDone: false,\n  fitViewOnInitOptions: undefined,\n  multiSelectionActive: false,\n  reactFlowVersion: \"10.3.17\" ,\n  connectionStartHandle: null,\n  connectOnClick: true\n};\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar _createContext = createContext(),\n    Provider = _createContext.Provider,\n    useStore = _createContext.useStore,\n    useStoreApi = _createContext.useStoreApi;\n\nvar createStore = function createStore() {\n  return create(function (set, get) {\n    return _objectSpread(_objectSpread({}, initialState), {}, {\n      setNodes: function setNodes(nodes) {\n        set({\n          nodeInternals: createNodeInternals(nodes, get().nodeInternals)\n        });\n      },\n      setEdges: function setEdges(edges) {\n        var _get = get(),\n            _get$defaultEdgeOptio = _get.defaultEdgeOptions,\n            defaultEdgeOptions = _get$defaultEdgeOptio === void 0 ? {} : _get$defaultEdgeOptio;\n\n        set({\n          edges: edges.map(function (e) {\n            return _objectSpread(_objectSpread({}, defaultEdgeOptions), e);\n          })\n        });\n      },\n      setDefaultNodesAndEdges: function setDefaultNodesAndEdges(nodes, edges) {\n        var hasDefaultNodes = typeof nodes !== 'undefined';\n        var hasDefaultEdges = typeof edges !== 'undefined';\n        var nodeInternals = hasDefaultNodes ? createNodeInternals(nodes, new Map()) : new Map();\n        var nextEdges = hasDefaultEdges ? edges : [];\n        set({\n          nodeInternals: nodeInternals,\n          edges: nextEdges,\n          hasDefaultNodes: hasDefaultNodes,\n          hasDefaultEdges: hasDefaultEdges\n        });\n      },\n      updateNodeDimensions: function updateNodeDimensions(updates) {\n        var _get2 = get(),\n            onNodesChange = _get2.onNodesChange,\n            nodeInternals = _get2.nodeInternals,\n            fitViewOnInit = _get2.fitViewOnInit,\n            fitViewOnInitDone = _get2.fitViewOnInitDone,\n            fitViewOnInitOptions = _get2.fitViewOnInitOptions,\n            domNode = _get2.domNode;\n\n        var viewportNode = domNode === null || domNode === void 0 ? void 0 : domNode.querySelector('.react-flow__viewport');\n\n        if (!viewportNode) {\n          return;\n        }\n\n        var style = window.getComputedStyle(viewportNode);\n\n        var _window$DOMMatrixRead = new window.DOMMatrixReadOnly(style.transform),\n            zoom = _window$DOMMatrixRead.m22;\n\n        var changes = updates.reduce(function (res, update) {\n          var node = nodeInternals.get(update.id);\n\n          if (node) {\n            var dimensions = getDimensions(update.nodeElement);\n            var doUpdate = !!(dimensions.width && dimensions.height && (node.width !== dimensions.width || node.height !== dimensions.height || update.forceUpdate));\n\n            if (doUpdate) {\n              nodeInternals.set(node.id, _objectSpread(_objectSpread({}, node), {}, _defineProperty({}, internalsSymbol, _objectSpread(_objectSpread({}, node[internalsSymbol]), {}, {\n                handleBounds: {\n                  source: getHandleBounds('.source', update.nodeElement, zoom),\n                  target: getHandleBounds('.target', update.nodeElement, zoom)\n                }\n              })), dimensions));\n              res.push({\n                id: node.id,\n                type: 'dimensions',\n                dimensions: dimensions\n              });\n            }\n          }\n\n          return res;\n        }, []);\n        var nextFitViewOnInitDone = fitViewOnInitDone || fitViewOnInit && !fitViewOnInitDone && fitView(get, _objectSpread({\n          initial: true\n        }, fitViewOnInitOptions));\n        set({\n          nodeInternals: new Map(nodeInternals),\n          fitViewOnInitDone: nextFitViewOnInitDone\n        });\n\n        if ((changes === null || changes === void 0 ? void 0 : changes.length) > 0) {\n          onNodesChange === null || onNodesChange === void 0 ? void 0 : onNodesChange(changes);\n        }\n      },\n      updateNodePositions: function updateNodePositions(nodeDragItems) {\n        var positionChanged = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n        var dragging = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n        var _get3 = get(),\n            onNodesChange = _get3.onNodesChange,\n            nodeInternals = _get3.nodeInternals,\n            hasDefaultNodes = _get3.hasDefaultNodes;\n\n        if (hasDefaultNodes || onNodesChange) {\n          var changes = nodeDragItems.map(function (node) {\n            var change = {\n              id: node.id,\n              type: 'position',\n              dragging: dragging\n            };\n\n            if (positionChanged) {\n              change.positionAbsolute = node.positionAbsolute;\n              change.position = node.position;\n            }\n\n            return change;\n          });\n\n          if (changes !== null && changes !== void 0 && changes.length) {\n            if (hasDefaultNodes) {\n              var nodes = applyNodeChanges(changes, Array.from(nodeInternals.values()));\n              var nextNodeInternals = createNodeInternals(nodes, nodeInternals);\n              set({\n                nodeInternals: nextNodeInternals\n              });\n            }\n\n            onNodesChange === null || onNodesChange === void 0 ? void 0 : onNodesChange(changes);\n          }\n        }\n      },\n      addSelectedNodes: function addSelectedNodes(selectedNodeIds) {\n        var _get4 = get(),\n            multiSelectionActive = _get4.multiSelectionActive,\n            nodeInternals = _get4.nodeInternals,\n            edges = _get4.edges;\n\n        var changedNodes;\n        var changedEdges = null;\n\n        if (multiSelectionActive) {\n          changedNodes = selectedNodeIds.map(function (nodeId) {\n            return createSelectionChange(nodeId, true);\n          });\n        } else {\n          changedNodes = getSelectionChanges(Array.from(nodeInternals.values()), selectedNodeIds);\n          changedEdges = getSelectionChanges(edges, []);\n        }\n\n        updateNodesAndEdgesSelections({\n          changedNodes: changedNodes,\n          changedEdges: changedEdges,\n          get: get,\n          set: set\n        });\n      },\n      addSelectedEdges: function addSelectedEdges(selectedEdgeIds) {\n        var _get5 = get(),\n            multiSelectionActive = _get5.multiSelectionActive,\n            edges = _get5.edges,\n            nodeInternals = _get5.nodeInternals;\n\n        var changedEdges;\n        var changedNodes = null;\n\n        if (multiSelectionActive) {\n          changedEdges = selectedEdgeIds.map(function (edgeId) {\n            return createSelectionChange(edgeId, true);\n          });\n        } else {\n          changedEdges = getSelectionChanges(edges, selectedEdgeIds);\n          changedNodes = getSelectionChanges(Array.from(nodeInternals.values()), []);\n        }\n\n        updateNodesAndEdgesSelections({\n          changedNodes: changedNodes,\n          changedEdges: changedEdges,\n          get: get,\n          set: set\n        });\n      },\n      unselectNodesAndEdges: function unselectNodesAndEdges() {\n        var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n            nodes = _ref.nodes,\n            edges = _ref.edges;\n\n        var _get6 = get(),\n            nodeInternals = _get6.nodeInternals,\n            storeEdges = _get6.edges;\n\n        var nodesToUnselect = nodes ? nodes : Array.from(nodeInternals.values());\n        var edgesToUnselect = edges ? edges : storeEdges;\n        var changedNodes = nodesToUnselect.map(function (n) {\n          n.selected = false;\n          return createSelectionChange(n.id, false);\n        });\n        var changedEdges = edgesToUnselect.map(function (edge) {\n          return createSelectionChange(edge.id, false);\n        });\n        updateNodesAndEdgesSelections({\n          changedNodes: changedNodes,\n          changedEdges: changedEdges,\n          get: get,\n          set: set\n        });\n      },\n      setMinZoom: function setMinZoom(minZoom) {\n        var _get7 = get(),\n            d3Zoom = _get7.d3Zoom,\n            maxZoom = _get7.maxZoom;\n\n        d3Zoom === null || d3Zoom === void 0 ? void 0 : d3Zoom.scaleExtent([minZoom, maxZoom]);\n        set({\n          minZoom: minZoom\n        });\n      },\n      setMaxZoom: function setMaxZoom(maxZoom) {\n        var _get8 = get(),\n            d3Zoom = _get8.d3Zoom,\n            minZoom = _get8.minZoom;\n\n        d3Zoom === null || d3Zoom === void 0 ? void 0 : d3Zoom.scaleExtent([minZoom, maxZoom]);\n        set({\n          maxZoom: maxZoom\n        });\n      },\n      setTranslateExtent: function setTranslateExtent(translateExtent) {\n        var _get9 = get(),\n            d3Zoom = _get9.d3Zoom;\n\n        d3Zoom === null || d3Zoom === void 0 ? void 0 : d3Zoom.translateExtent(translateExtent);\n        set({\n          translateExtent: translateExtent\n        });\n      },\n      resetSelectedElements: function resetSelectedElements() {\n        var _get10 = get(),\n            nodeInternals = _get10.nodeInternals,\n            edges = _get10.edges;\n\n        var nodes = Array.from(nodeInternals.values());\n        var nodesToUnselect = nodes.filter(function (e) {\n          return e.selected;\n        }).map(function (n) {\n          return createSelectionChange(n.id, false);\n        });\n        var edgesToUnselect = edges.filter(function (e) {\n          return e.selected;\n        }).map(function (e) {\n          return createSelectionChange(e.id, false);\n        });\n        updateNodesAndEdgesSelections({\n          changedNodes: nodesToUnselect,\n          changedEdges: edgesToUnselect,\n          get: get,\n          set: set\n        });\n      },\n      setNodeExtent: function setNodeExtent(nodeExtent) {\n        var _get11 = get(),\n            nodeInternals = _get11.nodeInternals;\n\n        nodeInternals.forEach(function (node) {\n          node.positionAbsolute = clampPosition(node.position, nodeExtent);\n        });\n        set({\n          nodeExtent: nodeExtent,\n          nodeInternals: new Map(nodeInternals)\n        });\n      },\n      reset: function reset() {\n        return set(_objectSpread({}, initialState));\n      }\n    });\n  });\n};\n\nexport { isNode as A, isEdge as B, ConnectionMode as C, getOutgoers as D, getIncomers as E, updateEdge as F, getTransformForBounds as G, BackgroundVariant as H, getBoundsofRects as I, _arrayLikeToArray as J, _unsupportedIterableToArray as K, getD3Transition as L, MarkerType as M, fitView as N, Position as P, _slicedToArray as _, _defineProperty as a, useStore as b, addEdge as c, getMarkerId as d, getConnectedEdges as e, getDimensions as f, getHostForElement as g, PanOnScrollMode as h, internalsSymbol as i, clamp as j, getNodesInside as k, getSelectionChanges as l, clampPosition as m, handleNodeClick as n, getRectOfNodes as o, pointToRendererPoint as p, ConnectionLineType as q, rectToBox as r, isNumeric as s, getMouseHandler as t, useStoreApi as u, Provider as v, createStore as w, infiniteExtent as x, applyNodeChanges as y, applyEdgeChanges as z };\n//# sourceMappingURL=index-a12c80bd.js.map\n","export function nopropagation(event) {\n  event.stopImmediatePropagation();\n}\n\nexport default function(event) {\n  event.preventDefault();\n  event.stopImmediatePropagation();\n}\n","import {dispatch} from \"d3-dispatch\";\nimport {dragDisable, dragEnable} from \"d3-drag\";\nimport {interpolateZoom} from \"d3-interpolate\";\nimport {select, pointer} from \"d3-selection\";\nimport {interrupt} from \"d3-transition\";\nimport constant from \"./constant.js\";\nimport ZoomEvent from \"./event.js\";\nimport {Transform, identity} from \"./transform.js\";\nimport noevent, {nopropagation} from \"./noevent.js\";\n\n// Ignore right-click, since that should open the context menu.\n// except for pinch-to-zoom, which is sent as a wheel+ctrlKey event\nfunction defaultFilter(event) {\n  return (!event.ctrlKey || event.type === 'wheel') && !event.button;\n}\n\nfunction defaultExtent() {\n  var e = this;\n  if (e instanceof SVGElement) {\n    e = e.ownerSVGElement || e;\n    if (e.hasAttribute(\"viewBox\")) {\n      e = e.viewBox.baseVal;\n      return [[e.x, e.y], [e.x + e.width, e.y + e.height]];\n    }\n    return [[0, 0], [e.width.baseVal.value, e.height.baseVal.value]];\n  }\n  return [[0, 0], [e.clientWidth, e.clientHeight]];\n}\n\nfunction defaultTransform() {\n  return this.__zoom || identity;\n}\n\nfunction defaultWheelDelta(event) {\n  return -event.deltaY * (event.deltaMode === 1 ? 0.05 : event.deltaMode ? 1 : 0.002) * (event.ctrlKey ? 10 : 1);\n}\n\nfunction defaultTouchable() {\n  return navigator.maxTouchPoints || (\"ontouchstart\" in this);\n}\n\nfunction defaultConstrain(transform, extent, translateExtent) {\n  var dx0 = transform.invertX(extent[0][0]) - translateExtent[0][0],\n      dx1 = transform.invertX(extent[1][0]) - translateExtent[1][0],\n      dy0 = transform.invertY(extent[0][1]) - translateExtent[0][1],\n      dy1 = transform.invertY(extent[1][1]) - translateExtent[1][1];\n  return transform.translate(\n    dx1 > dx0 ? (dx0 + dx1) / 2 : Math.min(0, dx0) || Math.max(0, dx1),\n    dy1 > dy0 ? (dy0 + dy1) / 2 : Math.min(0, dy0) || Math.max(0, dy1)\n  );\n}\n\nexport default function() {\n  var filter = defaultFilter,\n      extent = defaultExtent,\n      constrain = defaultConstrain,\n      wheelDelta = defaultWheelDelta,\n      touchable = defaultTouchable,\n      scaleExtent = [0, Infinity],\n      translateExtent = [[-Infinity, -Infinity], [Infinity, Infinity]],\n      duration = 250,\n      interpolate = interpolateZoom,\n      listeners = dispatch(\"start\", \"zoom\", \"end\"),\n      touchstarting,\n      touchfirst,\n      touchending,\n      touchDelay = 500,\n      wheelDelay = 150,\n      clickDistance2 = 0,\n      tapDistance = 10;\n\n  function zoom(selection) {\n    selection\n        .property(\"__zoom\", defaultTransform)\n        .on(\"wheel.zoom\", wheeled, {passive: false})\n        .on(\"mousedown.zoom\", mousedowned)\n        .on(\"dblclick.zoom\", dblclicked)\n      .filter(touchable)\n        .on(\"touchstart.zoom\", touchstarted)\n        .on(\"touchmove.zoom\", touchmoved)\n        .on(\"touchend.zoom touchcancel.zoom\", touchended)\n        .style(\"-webkit-tap-highlight-color\", \"rgba(0,0,0,0)\");\n  }\n\n  zoom.transform = function(collection, transform, point, event) {\n    var selection = collection.selection ? collection.selection() : collection;\n    selection.property(\"__zoom\", defaultTransform);\n    if (collection !== selection) {\n      schedule(collection, transform, point, event);\n    } else {\n      selection.interrupt().each(function() {\n        gesture(this, arguments)\n          .event(event)\n          .start()\n          .zoom(null, typeof transform === \"function\" ? transform.apply(this, arguments) : transform)\n          .end();\n      });\n    }\n  };\n\n  zoom.scaleBy = function(selection, k, p, event) {\n    zoom.scaleTo(selection, function() {\n      var k0 = this.__zoom.k,\n          k1 = typeof k === \"function\" ? k.apply(this, arguments) : k;\n      return k0 * k1;\n    }, p, event);\n  };\n\n  zoom.scaleTo = function(selection, k, p, event) {\n    zoom.transform(selection, function() {\n      var e = extent.apply(this, arguments),\n          t0 = this.__zoom,\n          p0 = p == null ? centroid(e) : typeof p === \"function\" ? p.apply(this, arguments) : p,\n          p1 = t0.invert(p0),\n          k1 = typeof k === \"function\" ? k.apply(this, arguments) : k;\n      return constrain(translate(scale(t0, k1), p0, p1), e, translateExtent);\n    }, p, event);\n  };\n\n  zoom.translateBy = function(selection, x, y, event) {\n    zoom.transform(selection, function() {\n      return constrain(this.__zoom.translate(\n        typeof x === \"function\" ? x.apply(this, arguments) : x,\n        typeof y === \"function\" ? y.apply(this, arguments) : y\n      ), extent.apply(this, arguments), translateExtent);\n    }, null, event);\n  };\n\n  zoom.translateTo = function(selection, x, y, p, event) {\n    zoom.transform(selection, function() {\n      var e = extent.apply(this, arguments),\n          t = this.__zoom,\n          p0 = p == null ? centroid(e) : typeof p === \"function\" ? p.apply(this, arguments) : p;\n      return constrain(identity.translate(p0[0], p0[1]).scale(t.k).translate(\n        typeof x === \"function\" ? -x.apply(this, arguments) : -x,\n        typeof y === \"function\" ? -y.apply(this, arguments) : -y\n      ), e, translateExtent);\n    }, p, event);\n  };\n\n  function scale(transform, k) {\n    k = Math.max(scaleExtent[0], Math.min(scaleExtent[1], k));\n    return k === transform.k ? transform : new Transform(k, transform.x, transform.y);\n  }\n\n  function translate(transform, p0, p1) {\n    var x = p0[0] - p1[0] * transform.k, y = p0[1] - p1[1] * transform.k;\n    return x === transform.x && y === transform.y ? transform : new Transform(transform.k, x, y);\n  }\n\n  function centroid(extent) {\n    return [(+extent[0][0] + +extent[1][0]) / 2, (+extent[0][1] + +extent[1][1]) / 2];\n  }\n\n  function schedule(transition, transform, point, event) {\n    transition\n        .on(\"start.zoom\", function() { gesture(this, arguments).event(event).start(); })\n        .on(\"interrupt.zoom end.zoom\", function() { gesture(this, arguments).event(event).end(); })\n        .tween(\"zoom\", function() {\n          var that = this,\n              args = arguments,\n              g = gesture(that, args).event(event),\n              e = extent.apply(that, args),\n              p = point == null ? centroid(e) : typeof point === \"function\" ? point.apply(that, args) : point,\n              w = Math.max(e[1][0] - e[0][0], e[1][1] - e[0][1]),\n              a = that.__zoom,\n              b = typeof transform === \"function\" ? transform.apply(that, args) : transform,\n              i = interpolate(a.invert(p).concat(w / a.k), b.invert(p).concat(w / b.k));\n          return function(t) {\n            if (t === 1) t = b; // Avoid rounding error on end.\n            else { var l = i(t), k = w / l[2]; t = new Transform(k, p[0] - l[0] * k, p[1] - l[1] * k); }\n            g.zoom(null, t);\n          };\n        });\n  }\n\n  function gesture(that, args, clean) {\n    return (!clean && that.__zooming) || new Gesture(that, args);\n  }\n\n  function Gesture(that, args) {\n    this.that = that;\n    this.args = args;\n    this.active = 0;\n    this.sourceEvent = null;\n    this.extent = extent.apply(that, args);\n    this.taps = 0;\n  }\n\n  Gesture.prototype = {\n    event: function(event) {\n      if (event) this.sourceEvent = event;\n      return this;\n    },\n    start: function() {\n      if (++this.active === 1) {\n        this.that.__zooming = this;\n        this.emit(\"start\");\n      }\n      return this;\n    },\n    zoom: function(key, transform) {\n      if (this.mouse && key !== \"mouse\") this.mouse[1] = transform.invert(this.mouse[0]);\n      if (this.touch0 && key !== \"touch\") this.touch0[1] = transform.invert(this.touch0[0]);\n      if (this.touch1 && key !== \"touch\") this.touch1[1] = transform.invert(this.touch1[0]);\n      this.that.__zoom = transform;\n      this.emit(\"zoom\");\n      return this;\n    },\n    end: function() {\n      if (--this.active === 0) {\n        delete this.that.__zooming;\n        this.emit(\"end\");\n      }\n      return this;\n    },\n    emit: function(type) {\n      var d = select(this.that).datum();\n      listeners.call(\n        type,\n        this.that,\n        new ZoomEvent(type, {\n          sourceEvent: this.sourceEvent,\n          target: zoom,\n          type,\n          transform: this.that.__zoom,\n          dispatch: listeners\n        }),\n        d\n      );\n    }\n  };\n\n  function wheeled(event, ...args) {\n    if (!filter.apply(this, arguments)) return;\n    var g = gesture(this, args).event(event),\n        t = this.__zoom,\n        k = Math.max(scaleExtent[0], Math.min(scaleExtent[1], t.k * Math.pow(2, wheelDelta.apply(this, arguments)))),\n        p = pointer(event);\n\n    // If the mouse is in the same location as before, reuse it.\n    // If there were recent wheel events, reset the wheel idle timeout.\n    if (g.wheel) {\n      if (g.mouse[0][0] !== p[0] || g.mouse[0][1] !== p[1]) {\n        g.mouse[1] = t.invert(g.mouse[0] = p);\n      }\n      clearTimeout(g.wheel);\n    }\n\n    // If this wheel event won’t trigger a transform change, ignore it.\n    else if (t.k === k) return;\n\n    // Otherwise, capture the mouse point and location at the start.\n    else {\n      g.mouse = [p, t.invert(p)];\n      interrupt(this);\n      g.start();\n    }\n\n    noevent(event);\n    g.wheel = setTimeout(wheelidled, wheelDelay);\n    g.zoom(\"mouse\", constrain(translate(scale(t, k), g.mouse[0], g.mouse[1]), g.extent, translateExtent));\n\n    function wheelidled() {\n      g.wheel = null;\n      g.end();\n    }\n  }\n\n  function mousedowned(event, ...args) {\n    if (touchending || !filter.apply(this, arguments)) return;\n    var currentTarget = event.currentTarget,\n        g = gesture(this, args, true).event(event),\n        v = select(event.view).on(\"mousemove.zoom\", mousemoved, true).on(\"mouseup.zoom\", mouseupped, true),\n        p = pointer(event, currentTarget),\n        x0 = event.clientX,\n        y0 = event.clientY;\n\n    dragDisable(event.view);\n    nopropagation(event);\n    g.mouse = [p, this.__zoom.invert(p)];\n    interrupt(this);\n    g.start();\n\n    function mousemoved(event) {\n      noevent(event);\n      if (!g.moved) {\n        var dx = event.clientX - x0, dy = event.clientY - y0;\n        g.moved = dx * dx + dy * dy > clickDistance2;\n      }\n      g.event(event)\n       .zoom(\"mouse\", constrain(translate(g.that.__zoom, g.mouse[0] = pointer(event, currentTarget), g.mouse[1]), g.extent, translateExtent));\n    }\n\n    function mouseupped(event) {\n      v.on(\"mousemove.zoom mouseup.zoom\", null);\n      dragEnable(event.view, g.moved);\n      noevent(event);\n      g.event(event).end();\n    }\n  }\n\n  function dblclicked(event, ...args) {\n    if (!filter.apply(this, arguments)) return;\n    var t0 = this.__zoom,\n        p0 = pointer(event.changedTouches ? event.changedTouches[0] : event, this),\n        p1 = t0.invert(p0),\n        k1 = t0.k * (event.shiftKey ? 0.5 : 2),\n        t1 = constrain(translate(scale(t0, k1), p0, p1), extent.apply(this, args), translateExtent);\n\n    noevent(event);\n    if (duration > 0) select(this).transition().duration(duration).call(schedule, t1, p0, event);\n    else select(this).call(zoom.transform, t1, p0, event);\n  }\n\n  function touchstarted(event, ...args) {\n    if (!filter.apply(this, arguments)) return;\n    var touches = event.touches,\n        n = touches.length,\n        g = gesture(this, args, event.changedTouches.length === n).event(event),\n        started, i, t, p;\n\n    nopropagation(event);\n    for (i = 0; i < n; ++i) {\n      t = touches[i], p = pointer(t, this);\n      p = [p, this.__zoom.invert(p), t.identifier];\n      if (!g.touch0) g.touch0 = p, started = true, g.taps = 1 + !!touchstarting;\n      else if (!g.touch1 && g.touch0[2] !== p[2]) g.touch1 = p, g.taps = 0;\n    }\n\n    if (touchstarting) touchstarting = clearTimeout(touchstarting);\n\n    if (started) {\n      if (g.taps < 2) touchfirst = p[0], touchstarting = setTimeout(function() { touchstarting = null; }, touchDelay);\n      interrupt(this);\n      g.start();\n    }\n  }\n\n  function touchmoved(event, ...args) {\n    if (!this.__zooming) return;\n    var g = gesture(this, args).event(event),\n        touches = event.changedTouches,\n        n = touches.length, i, t, p, l;\n\n    noevent(event);\n    for (i = 0; i < n; ++i) {\n      t = touches[i], p = pointer(t, this);\n      if (g.touch0 && g.touch0[2] === t.identifier) g.touch0[0] = p;\n      else if (g.touch1 && g.touch1[2] === t.identifier) g.touch1[0] = p;\n    }\n    t = g.that.__zoom;\n    if (g.touch1) {\n      var p0 = g.touch0[0], l0 = g.touch0[1],\n          p1 = g.touch1[0], l1 = g.touch1[1],\n          dp = (dp = p1[0] - p0[0]) * dp + (dp = p1[1] - p0[1]) * dp,\n          dl = (dl = l1[0] - l0[0]) * dl + (dl = l1[1] - l0[1]) * dl;\n      t = scale(t, Math.sqrt(dp / dl));\n      p = [(p0[0] + p1[0]) / 2, (p0[1] + p1[1]) / 2];\n      l = [(l0[0] + l1[0]) / 2, (l0[1] + l1[1]) / 2];\n    }\n    else if (g.touch0) p = g.touch0[0], l = g.touch0[1];\n    else return;\n\n    g.zoom(\"touch\", constrain(translate(t, p, l), g.extent, translateExtent));\n  }\n\n  function touchended(event, ...args) {\n    if (!this.__zooming) return;\n    var g = gesture(this, args).event(event),\n        touches = event.changedTouches,\n        n = touches.length, i, t;\n\n    nopropagation(event);\n    if (touchending) clearTimeout(touchending);\n    touchending = setTimeout(function() { touchending = null; }, touchDelay);\n    for (i = 0; i < n; ++i) {\n      t = touches[i];\n      if (g.touch0 && g.touch0[2] === t.identifier) delete g.touch0;\n      else if (g.touch1 && g.touch1[2] === t.identifier) delete g.touch1;\n    }\n    if (g.touch1 && !g.touch0) g.touch0 = g.touch1, delete g.touch1;\n    if (g.touch0) g.touch0[1] = this.__zoom.invert(g.touch0[0]);\n    else {\n      g.end();\n      // If this was a dbltap, reroute to the (optional) dblclick.zoom handler.\n      if (g.taps === 2) {\n        t = pointer(t, this);\n        if (Math.hypot(touchfirst[0] - t[0], touchfirst[1] - t[1]) < tapDistance) {\n          var p = select(this).on(\"dblclick.zoom\");\n          if (p) p.apply(this, arguments);\n        }\n      }\n    }\n  }\n\n  zoom.wheelDelta = function(_) {\n    return arguments.length ? (wheelDelta = typeof _ === \"function\" ? _ : constant(+_), zoom) : wheelDelta;\n  };\n\n  zoom.filter = function(_) {\n    return arguments.length ? (filter = typeof _ === \"function\" ? _ : constant(!!_), zoom) : filter;\n  };\n\n  zoom.touchable = function(_) {\n    return arguments.length ? (touchable = typeof _ === \"function\" ? _ : constant(!!_), zoom) : touchable;\n  };\n\n  zoom.extent = function(_) {\n    return arguments.length ? (extent = typeof _ === \"function\" ? _ : constant([[+_[0][0], +_[0][1]], [+_[1][0], +_[1][1]]]), zoom) : extent;\n  };\n\n  zoom.scaleExtent = function(_) {\n    return arguments.length ? (scaleExtent[0] = +_[0], scaleExtent[1] = +_[1], zoom) : [scaleExtent[0], scaleExtent[1]];\n  };\n\n  zoom.translateExtent = function(_) {\n    return arguments.length ? (translateExtent[0][0] = +_[0][0], translateExtent[1][0] = +_[1][0], translateExtent[0][1] = +_[0][1], translateExtent[1][1] = +_[1][1], zoom) : [[translateExtent[0][0], translateExtent[0][1]], [translateExtent[1][0], translateExtent[1][1]]];\n  };\n\n  zoom.constrain = function(_) {\n    return arguments.length ? (constrain = _, zoom) : constrain;\n  };\n\n  zoom.duration = function(_) {\n    return arguments.length ? (duration = +_, zoom) : duration;\n  };\n\n  zoom.interpolate = function(_) {\n    return arguments.length ? (interpolate = _, zoom) : interpolate;\n  };\n\n  zoom.on = function() {\n    var value = listeners.on.apply(listeners, arguments);\n    return value === listeners ? zoom : value;\n  };\n\n  zoom.clickDistance = function(_) {\n    return arguments.length ? (clickDistance2 = (_ = +_) * _, zoom) : Math.sqrt(clickDistance2);\n  };\n\n  zoom.tapDistance = function(_) {\n    return arguments.length ? (tapDistance = +_, zoom) : tapDistance;\n  };\n\n  return zoom;\n}\n","import { createContext as createContext$1, useRef, createElement, useContext, useMemo } from 'react';\n\nfunction createContext() {\n  const ZustandContext = createContext$1(void 0);\n  const Provider = ({\n    initialStore,\n    createStore,\n    children\n  }) => {\n    const storeRef = useRef();\n    if (!storeRef.current) {\n      if (initialStore) {\n        console.warn(\"Provider initialStore is deprecated and will be removed in the next version.\");\n        if (!createStore) {\n          createStore = () => initialStore;\n        }\n      }\n      storeRef.current = createStore();\n    }\n    return createElement(ZustandContext.Provider, { value: storeRef.current }, children);\n  };\n  const useStore = (selector, equalityFn = Object.is) => {\n    const useProviderStore = useContext(ZustandContext);\n    if (!useProviderStore) {\n      throw new Error(\"Seems like you have not used zustand provider as an ancestor.\");\n    }\n    return useProviderStore(selector, equalityFn);\n  };\n  const useStoreApi = () => {\n    const useProviderStore = useContext(ZustandContext);\n    if (!useProviderStore) {\n      throw new Error(\"Seems like you have not used zustand provider as an ancestor.\");\n    }\n    return useMemo(() => ({\n      getState: useProviderStore.getState,\n      setState: useProviderStore.setState,\n      subscribe: useProviderStore.subscribe,\n      destroy: useProviderStore.destroy\n    }), [useProviderStore]);\n  };\n  return {\n    Provider,\n    useStore,\n    useStoreApi\n  };\n}\n\nexport { createContext as default };\n","function shallow(objA, objB) {\n  if (Object.is(objA, objB)) {\n    return true;\n  }\n  if (typeof objA !== \"object\" || objA === null || typeof objB !== \"object\" || objB === null) {\n    return false;\n  }\n  const keysA = Object.keys(objA);\n  if (keysA.length !== Object.keys(objB).length) {\n    return false;\n  }\n  for (let i = 0; i < keysA.length; i++) {\n    if (!Object.prototype.hasOwnProperty.call(objB, keysA[i]) || !Object.is(objA[keysA[i]], objB[keysA[i]])) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport { shallow as default };\n","import { J as _arrayLikeToArray, K as _unsupportedIterableToArray, u as useStoreApi, b as useStore, L as getD3Transition, _ as _slicedToArray, N as fitView, G as getTransformForBounds, p as pointToRendererPoint, a as _defineProperty } from './index-a12c80bd.js';\nimport { useMemo, useCallback } from 'react';\nimport { zoomIdentity } from 'd3-zoom';\nimport shallow from 'zustand/shallow';\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nvar initialViewportHelper = {\n  zoomIn: function zoomIn() {},\n  zoomOut: function zoomOut() {},\n  zoomTo: function zoomTo(_) {},\n  getZoom: function getZoom() {\n    return 1;\n  },\n  setViewport: function setViewport(_) {},\n  getViewport: function getViewport() {\n    return {\n      x: 0,\n      y: 0,\n      zoom: 1\n    };\n  },\n  fitView: function fitView() {\n  },\n  setCenter: function setCenter(_, __) {},\n  fitBounds: function fitBounds(_) {},\n  project: function project(position) {\n    return position;\n  },\n  viewportInitialized: false\n};\n\nvar selector = function selector(s) {\n  return {\n    d3Zoom: s.d3Zoom,\n    d3Selection: s.d3Selection\n  };\n};\n\nvar useViewportHelper = function useViewportHelper() {\n  var store = useStoreApi();\n\n  var _useStore = useStore(selector, shallow),\n      d3Zoom = _useStore.d3Zoom,\n      d3Selection = _useStore.d3Selection;\n\n  var viewportHelperFunctions = useMemo(function () {\n    if (d3Selection && d3Zoom) {\n      return {\n        zoomIn: function zoomIn(options) {\n          return d3Zoom.scaleBy(getD3Transition(d3Selection, options === null || options === void 0 ? void 0 : options.duration), 1.2);\n        },\n        zoomOut: function zoomOut(options) {\n          return d3Zoom.scaleBy(getD3Transition(d3Selection, options === null || options === void 0 ? void 0 : options.duration), 1 / 1.2);\n        },\n        zoomTo: function zoomTo(zoomLevel, options) {\n          return d3Zoom.scaleTo(getD3Transition(d3Selection, options === null || options === void 0 ? void 0 : options.duration), zoomLevel);\n        },\n        getZoom: function getZoom() {\n          return store.getState().transform[2];\n        },\n        setViewport: function setViewport(transform, options) {\n          var _transform$x, _transform$y, _transform$zoom;\n\n          var _store$getState$trans = _slicedToArray(store.getState().transform, 3),\n              x = _store$getState$trans[0],\n              y = _store$getState$trans[1],\n              zoom = _store$getState$trans[2];\n\n          var nextTransform = zoomIdentity.translate((_transform$x = transform.x) !== null && _transform$x !== void 0 ? _transform$x : x, (_transform$y = transform.y) !== null && _transform$y !== void 0 ? _transform$y : y).scale((_transform$zoom = transform.zoom) !== null && _transform$zoom !== void 0 ? _transform$zoom : zoom);\n          d3Zoom.transform(getD3Transition(d3Selection, options === null || options === void 0 ? void 0 : options.duration), nextTransform);\n        },\n        getViewport: function getViewport() {\n          var _store$getState$trans2 = _slicedToArray(store.getState().transform, 3),\n              x = _store$getState$trans2[0],\n              y = _store$getState$trans2[1],\n              zoom = _store$getState$trans2[2];\n\n          return {\n            x: x,\n            y: y,\n            zoom: zoom\n          };\n        },\n        fitView: function fitView$1(options) {\n          return fitView(store.getState, options);\n        },\n        setCenter: function setCenter(x, y, options) {\n          var _store$getState = store.getState(),\n              width = _store$getState.width,\n              height = _store$getState.height,\n              maxZoom = _store$getState.maxZoom;\n\n          var nextZoom = typeof (options === null || options === void 0 ? void 0 : options.zoom) !== 'undefined' ? options.zoom : maxZoom;\n          var centerX = width / 2 - x * nextZoom;\n          var centerY = height / 2 - y * nextZoom;\n          var transform = zoomIdentity.translate(centerX, centerY).scale(nextZoom);\n          d3Zoom.transform(getD3Transition(d3Selection, options === null || options === void 0 ? void 0 : options.duration), transform);\n        },\n        fitBounds: function fitBounds(bounds, options) {\n          var _options$padding;\n\n          var _store$getState2 = store.getState(),\n              width = _store$getState2.width,\n              height = _store$getState2.height,\n              minZoom = _store$getState2.minZoom,\n              maxZoom = _store$getState2.maxZoom;\n\n          var _getTransformForBound = getTransformForBounds(bounds, width, height, minZoom, maxZoom, (_options$padding = options === null || options === void 0 ? void 0 : options.padding) !== null && _options$padding !== void 0 ? _options$padding : 0.1),\n              _getTransformForBound2 = _slicedToArray(_getTransformForBound, 3),\n              x = _getTransformForBound2[0],\n              y = _getTransformForBound2[1],\n              zoom = _getTransformForBound2[2];\n\n          var transform = zoomIdentity.translate(x, y).scale(zoom);\n          d3Zoom.transform(getD3Transition(d3Selection, options === null || options === void 0 ? void 0 : options.duration), transform);\n        },\n        project: function project(position) {\n          var _store$getState3 = store.getState(),\n              transform = _store$getState3.transform,\n              snapToGrid = _store$getState3.snapToGrid,\n              snapGrid = _store$getState3.snapGrid;\n\n          return pointToRendererPoint(position, transform, snapToGrid, snapGrid);\n        },\n        viewportInitialized: true\n      };\n    }\n\n    return initialViewportHelper;\n  }, [d3Zoom, d3Selection]);\n  return viewportHelperFunctions;\n};\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction useReactFlow() {\n  var viewportHelper = useViewportHelper();\n  var store = useStoreApi();\n  var getNodes = useCallback(function () {\n    var _store$getState = store.getState(),\n        nodeInternals = _store$getState.nodeInternals;\n\n    var nodes = Array.from(nodeInternals.values());\n    return nodes.map(function (n) {\n      return _objectSpread({}, n);\n    });\n  }, []);\n  var getNode = useCallback(function (id) {\n    var _store$getState2 = store.getState(),\n        nodeInternals = _store$getState2.nodeInternals;\n\n    return nodeInternals.get(id);\n  }, []);\n  var getEdges = useCallback(function () {\n    var _store$getState3 = store.getState(),\n        _store$getState3$edge = _store$getState3.edges,\n        edges = _store$getState3$edge === void 0 ? [] : _store$getState3$edge;\n\n    return edges.map(function (e) {\n      return _objectSpread({}, e);\n    });\n  }, []);\n  var getEdge = useCallback(function (id) {\n    var _store$getState4 = store.getState(),\n        _store$getState4$edge = _store$getState4.edges,\n        edges = _store$getState4$edge === void 0 ? [] : _store$getState4$edge;\n\n    return edges.find(function (e) {\n      return e.id === id;\n    });\n  }, []);\n  var setNodes = useCallback(function (payload) {\n    var _store$getState5 = store.getState(),\n        nodeInternals = _store$getState5.nodeInternals,\n        setNodes = _store$getState5.setNodes,\n        hasDefaultNodes = _store$getState5.hasDefaultNodes,\n        onNodesChange = _store$getState5.onNodesChange;\n\n    var nodes = Array.from(nodeInternals.values());\n    var nextNodes = typeof payload === 'function' ? payload(nodes) : payload;\n\n    if (hasDefaultNodes) {\n      setNodes(nextNodes);\n    } else if (onNodesChange) {\n      var changes = nextNodes.length === 0 ? nodes.map(function (node) {\n        return {\n          type: 'remove',\n          id: node.id\n        };\n      }) : nextNodes.map(function (node) {\n        return {\n          item: node,\n          type: 'reset'\n        };\n      });\n      onNodesChange(changes);\n    }\n  }, []);\n  var setEdges = useCallback(function (payload) {\n    var _store$getState6 = store.getState(),\n        _store$getState6$edge = _store$getState6.edges,\n        edges = _store$getState6$edge === void 0 ? [] : _store$getState6$edge,\n        setEdges = _store$getState6.setEdges,\n        hasDefaultEdges = _store$getState6.hasDefaultEdges,\n        onEdgesChange = _store$getState6.onEdgesChange;\n\n    var nextEdges = typeof payload === 'function' ? payload(edges) : payload;\n\n    if (hasDefaultEdges) {\n      setEdges(nextEdges);\n    } else if (onEdgesChange) {\n      var changes = nextEdges.length === 0 ? edges.map(function (edge) {\n        return {\n          type: 'remove',\n          id: edge.id\n        };\n      }) : nextEdges.map(function (edge) {\n        return {\n          item: edge,\n          type: 'reset'\n        };\n      });\n      onEdgesChange(changes);\n    }\n  }, []);\n  var addNodes = useCallback(function (payload) {\n    var nodes = Array.isArray(payload) ? payload : [payload];\n\n    var _store$getState7 = store.getState(),\n        nodeInternals = _store$getState7.nodeInternals,\n        setNodes = _store$getState7.setNodes,\n        hasDefaultNodes = _store$getState7.hasDefaultNodes,\n        onNodesChange = _store$getState7.onNodesChange;\n\n    if (hasDefaultNodes) {\n      var currentNodes = Array.from(nodeInternals.values());\n      var nextNodes = [].concat(currentNodes, _toConsumableArray(nodes));\n      setNodes(nextNodes);\n    } else if (onNodesChange) {\n      var changes = nodes.map(function (node) {\n        return {\n          item: node,\n          type: 'add'\n        };\n      });\n      onNodesChange(changes);\n    }\n  }, []);\n  var addEdges = useCallback(function (payload) {\n    var nextEdges = Array.isArray(payload) ? payload : [payload];\n\n    var _store$getState8 = store.getState(),\n        _store$getState8$edge = _store$getState8.edges,\n        edges = _store$getState8$edge === void 0 ? [] : _store$getState8$edge,\n        setEdges = _store$getState8.setEdges,\n        hasDefaultEdges = _store$getState8.hasDefaultEdges,\n        onEdgesChange = _store$getState8.onEdgesChange;\n\n    if (hasDefaultEdges) {\n      setEdges([].concat(_toConsumableArray(edges), _toConsumableArray(nextEdges)));\n    } else if (onEdgesChange) {\n      var changes = nextEdges.map(function (edge) {\n        return {\n          item: edge,\n          type: 'add'\n        };\n      });\n      onEdgesChange(changes);\n    }\n  }, []);\n  var toObject = useCallback(function () {\n    var _store$getState9 = store.getState(),\n        nodeInternals = _store$getState9.nodeInternals,\n        _store$getState9$edge = _store$getState9.edges,\n        edges = _store$getState9$edge === void 0 ? [] : _store$getState9$edge,\n        transform = _store$getState9.transform;\n\n    var nodes = Array.from(nodeInternals.values());\n\n    var _transform = _slicedToArray(transform, 3),\n        x = _transform[0],\n        y = _transform[1],\n        zoom = _transform[2];\n\n    return {\n      nodes: nodes.map(function (n) {\n        return _objectSpread({}, n);\n      }),\n      edges: edges.map(function (e) {\n        return _objectSpread({}, e);\n      }),\n      viewport: {\n        x: x,\n        y: y,\n        zoom: zoom\n      }\n    };\n  }, []);\n  return useMemo(function () {\n    return _objectSpread(_objectSpread({}, viewportHelper), {}, {\n      getNodes: getNodes,\n      getNode: getNode,\n      getEdges: getEdges,\n      getEdge: getEdge,\n      setNodes: setNodes,\n      setEdges: setEdges,\n      addNodes: addNodes,\n      addEdges: addEdges,\n      toObject: toObject\n    });\n  }, [viewportHelper, getNodes, getNode, getEdges, getEdge, setNodes, setEdges, addNodes, addEdges, toObject]);\n}\n\nexport { _toConsumableArray as _, useReactFlow as u };\n//# sourceMappingURL=useReactFlow-993c30ca.js.map\n","export default function cc(names) {\n  if (typeof names === \"string\" || typeof names === \"number\") return \"\" + names\n\n  let out = \"\"\n\n  if (Array.isArray(names)) {\n    for (let i = 0, tmp; i < names.length; i++) {\n      if ((tmp = cc(names[i])) !== \"\") {\n        out += (out && \" \") + tmp\n      }\n    }\n  } else {\n    for (let k in names) {\n      if (names[k]) out += (out && \" \") + k\n    }\n  }\n\n  return out\n}\n","import { u as useStoreApi, _ as _slicedToArray, b as useStore, a as _defineProperty } from './index-a12c80bd.js';\nimport React, { memo, useState, useEffect } from 'react';\nimport cc from 'classcat';\nimport { u as useReactFlow } from './useReactFlow-993c30ca.js';\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction PlusIcon() {\n  return /*#__PURE__*/React.createElement(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 32 32\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z\"\n  }));\n}\n\nfunction MinusIcon() {\n  return /*#__PURE__*/React.createElement(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 32 5\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M0 0h32v4.2H0z\"\n  }));\n}\n\nfunction FitViewIcon() {\n  return /*#__PURE__*/React.createElement(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 32 30\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z\"\n  }));\n}\n\nfunction LockIcon() {\n  return /*#__PURE__*/React.createElement(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 25 32\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z\"\n  }));\n}\n\nfunction UnlockIcon() {\n  return /*#__PURE__*/React.createElement(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 25 32\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z\"\n  }));\n}\n\nvar _excluded = [\"children\", \"className\"];\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nvar ControlButton = function ControlButton(_ref) {\n  var children = _ref.children,\n      className = _ref.className,\n      rest = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"button\", _objectSpread({\n    type: \"button\",\n    className: cc(['react-flow__controls-button', className])\n  }, rest), children);\n};\n\nvar isInteractiveSelector = function isInteractiveSelector(s) {\n  return s.nodesDraggable && s.nodesConnectable && s.elementsSelectable;\n};\n\nvar Controls = function Controls(_ref2) {\n  var style = _ref2.style,\n      _ref2$showZoom = _ref2.showZoom,\n      showZoom = _ref2$showZoom === void 0 ? true : _ref2$showZoom,\n      _ref2$showFitView = _ref2.showFitView,\n      showFitView = _ref2$showFitView === void 0 ? true : _ref2$showFitView,\n      _ref2$showInteractive = _ref2.showInteractive,\n      showInteractive = _ref2$showInteractive === void 0 ? true : _ref2$showInteractive,\n      fitViewOptions = _ref2.fitViewOptions,\n      onZoomIn = _ref2.onZoomIn,\n      onZoomOut = _ref2.onZoomOut,\n      onFitView = _ref2.onFitView,\n      onInteractiveChange = _ref2.onInteractiveChange,\n      className = _ref2.className,\n      children = _ref2.children;\n  var store = useStoreApi();\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isVisible = _useState2[0],\n      setIsVisible = _useState2[1];\n\n  var isInteractive = useStore(isInteractiveSelector);\n\n  var _useReactFlow = useReactFlow(),\n      zoomIn = _useReactFlow.zoomIn,\n      zoomOut = _useReactFlow.zoomOut,\n      fitView = _useReactFlow.fitView;\n\n  useEffect(function () {\n    setIsVisible(true);\n  }, []);\n\n  if (!isVisible) {\n    return null;\n  }\n\n  var onZoomInHandler = function onZoomInHandler() {\n    zoomIn === null || zoomIn === void 0 ? void 0 : zoomIn();\n    onZoomIn === null || onZoomIn === void 0 ? void 0 : onZoomIn();\n  };\n\n  var onZoomOutHandler = function onZoomOutHandler() {\n    zoomOut === null || zoomOut === void 0 ? void 0 : zoomOut();\n    onZoomOut === null || onZoomOut === void 0 ? void 0 : onZoomOut();\n  };\n\n  var onFitViewHandler = function onFitViewHandler() {\n    fitView === null || fitView === void 0 ? void 0 : fitView(fitViewOptions);\n    onFitView === null || onFitView === void 0 ? void 0 : onFitView();\n  };\n\n  var onToggleInteractivity = function onToggleInteractivity() {\n    store.setState({\n      nodesDraggable: !isInteractive,\n      nodesConnectable: !isInteractive,\n      elementsSelectable: !isInteractive\n    });\n    onInteractiveChange === null || onInteractiveChange === void 0 ? void 0 : onInteractiveChange(!isInteractive);\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: cc(['react-flow__controls', className]),\n    style: style\n  }, showZoom && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ControlButton, {\n    onClick: onZoomInHandler,\n    className: \"react-flow__controls-zoomin\",\n    title: \"zoom in\",\n    \"aria-label\": \"zoom in\"\n  }, /*#__PURE__*/React.createElement(PlusIcon, null)), /*#__PURE__*/React.createElement(ControlButton, {\n    onClick: onZoomOutHandler,\n    className: \"react-flow__controls-zoomout\",\n    title: \"zoom out\",\n    \"aria-label\": \"zoom out\"\n  }, /*#__PURE__*/React.createElement(MinusIcon, null))), showFitView && /*#__PURE__*/React.createElement(ControlButton, {\n    className: \"react-flow__controls-fitview\",\n    onClick: onFitViewHandler,\n    title: \"fit view\",\n    \"aria-label\": \"fit view\"\n  }, /*#__PURE__*/React.createElement(FitViewIcon, null)), showInteractive && /*#__PURE__*/React.createElement(ControlButton, {\n    className: \"react-flow__controls-interactive\",\n    onClick: onToggleInteractivity,\n    title: \"toggle interactivity\",\n    \"aria-label\": \"toggle interactivity\"\n  }, isInteractive ? /*#__PURE__*/React.createElement(UnlockIcon, null) : /*#__PURE__*/React.createElement(LockIcon, null)), children);\n};\n\nControls.displayName = 'Controls';\nvar index = /*#__PURE__*/memo(Controls);\n\nexport { ControlButton as C, _objectWithoutProperties as _, index as i };\n//# sourceMappingURL=index-20df97c0.js.map\n","export default x => () => x;\n","export default function DragEvent(type, {\n  sourceEvent,\n  subject,\n  target,\n  identifier,\n  active,\n  x, y, dx, dy,\n  dispatch\n}) {\n  Object.defineProperties(this, {\n    type: {value: type, enumerable: true, configurable: true},\n    sourceEvent: {value: sourceEvent, enumerable: true, configurable: true},\n    subject: {value: subject, enumerable: true, configurable: true},\n    target: {value: target, enumerable: true, configurable: true},\n    identifier: {value: identifier, enumerable: true, configurable: true},\n    active: {value: active, enumerable: true, configurable: true},\n    x: {value: x, enumerable: true, configurable: true},\n    y: {value: y, enumerable: true, configurable: true},\n    dx: {value: dx, enumerable: true, configurable: true},\n    dy: {value: dy, enumerable: true, configurable: true},\n    _: {value: dispatch}\n  });\n}\n\nDragEvent.prototype.on = function() {\n  var value = this._.on.apply(this._, arguments);\n  return value === this._ ? this : value;\n};\n","import {dispatch} from \"d3-dispatch\";\nimport {select, pointer} from \"d3-selection\";\nimport nodrag, {yesdrag} from \"./nodrag.js\";\nimport noevent, {nonpassive, nonpassivecapture, nopropagation} from \"./noevent.js\";\nimport constant from \"./constant.js\";\nimport DragEvent from \"./event.js\";\n\n// Ignore right-click, since that should open the context menu.\nfunction defaultFilter(event) {\n  return !event.ctrlKey && !event.button;\n}\n\nfunction defaultContainer() {\n  return this.parentNode;\n}\n\nfunction defaultSubject(event, d) {\n  return d == null ? {x: event.x, y: event.y} : d;\n}\n\nfunction defaultTouchable() {\n  return navigator.maxTouchPoints || (\"ontouchstart\" in this);\n}\n\nexport default function() {\n  var filter = defaultFilter,\n      container = defaultContainer,\n      subject = defaultSubject,\n      touchable = defaultTouchable,\n      gestures = {},\n      listeners = dispatch(\"start\", \"drag\", \"end\"),\n      active = 0,\n      mousedownx,\n      mousedowny,\n      mousemoving,\n      touchending,\n      clickDistance2 = 0;\n\n  function drag(selection) {\n    selection\n        .on(\"mousedown.drag\", mousedowned)\n      .filter(touchable)\n        .on(\"touchstart.drag\", touchstarted)\n        .on(\"touchmove.drag\", touchmoved, nonpassive)\n        .on(\"touchend.drag touchcancel.drag\", touchended)\n        .style(\"touch-action\", \"none\")\n        .style(\"-webkit-tap-highlight-color\", \"rgba(0,0,0,0)\");\n  }\n\n  function mousedowned(event, d) {\n    if (touchending || !filter.call(this, event, d)) return;\n    var gesture = beforestart(this, container.call(this, event, d), event, d, \"mouse\");\n    if (!gesture) return;\n    select(event.view)\n      .on(\"mousemove.drag\", mousemoved, nonpassivecapture)\n      .on(\"mouseup.drag\", mouseupped, nonpassivecapture);\n    nodrag(event.view);\n    nopropagation(event);\n    mousemoving = false;\n    mousedownx = event.clientX;\n    mousedowny = event.clientY;\n    gesture(\"start\", event);\n  }\n\n  function mousemoved(event) {\n    noevent(event);\n    if (!mousemoving) {\n      var dx = event.clientX - mousedownx, dy = event.clientY - mousedowny;\n      mousemoving = dx * dx + dy * dy > clickDistance2;\n    }\n    gestures.mouse(\"drag\", event);\n  }\n\n  function mouseupped(event) {\n    select(event.view).on(\"mousemove.drag mouseup.drag\", null);\n    yesdrag(event.view, mousemoving);\n    noevent(event);\n    gestures.mouse(\"end\", event);\n  }\n\n  function touchstarted(event, d) {\n    if (!filter.call(this, event, d)) return;\n    var touches = event.changedTouches,\n        c = container.call(this, event, d),\n        n = touches.length, i, gesture;\n\n    for (i = 0; i < n; ++i) {\n      if (gesture = beforestart(this, c, event, d, touches[i].identifier, touches[i])) {\n        nopropagation(event);\n        gesture(\"start\", event, touches[i]);\n      }\n    }\n  }\n\n  function touchmoved(event) {\n    var touches = event.changedTouches,\n        n = touches.length, i, gesture;\n\n    for (i = 0; i < n; ++i) {\n      if (gesture = gestures[touches[i].identifier]) {\n        noevent(event);\n        gesture(\"drag\", event, touches[i]);\n      }\n    }\n  }\n\n  function touchended(event) {\n    var touches = event.changedTouches,\n        n = touches.length, i, gesture;\n\n    if (touchending) clearTimeout(touchending);\n    touchending = setTimeout(function() { touchending = null; }, 500); // Ghost clicks are delayed!\n    for (i = 0; i < n; ++i) {\n      if (gesture = gestures[touches[i].identifier]) {\n        nopropagation(event);\n        gesture(\"end\", event, touches[i]);\n      }\n    }\n  }\n\n  function beforestart(that, container, event, d, identifier, touch) {\n    var dispatch = listeners.copy(),\n        p = pointer(touch || event, container), dx, dy,\n        s;\n\n    if ((s = subject.call(that, new DragEvent(\"beforestart\", {\n        sourceEvent: event,\n        target: drag,\n        identifier,\n        active,\n        x: p[0],\n        y: p[1],\n        dx: 0,\n        dy: 0,\n        dispatch\n      }), d)) == null) return;\n\n    dx = s.x - p[0] || 0;\n    dy = s.y - p[1] || 0;\n\n    return function gesture(type, event, touch) {\n      var p0 = p, n;\n      switch (type) {\n        case \"start\": gestures[identifier] = gesture, n = active++; break;\n        case \"end\": delete gestures[identifier], --active; // falls through\n        case \"drag\": p = pointer(touch || event, container), n = active; break;\n      }\n      dispatch.call(\n        type,\n        that,\n        new DragEvent(type, {\n          sourceEvent: event,\n          subject: s,\n          target: drag,\n          identifier,\n          active: n,\n          x: p[0] + dx,\n          y: p[1] + dy,\n          dx: p[0] - p0[0],\n          dy: p[1] - p0[1],\n          dispatch\n        }),\n        d\n      );\n    };\n  }\n\n  drag.filter = function(_) {\n    return arguments.length ? (filter = typeof _ === \"function\" ? _ : constant(!!_), drag) : filter;\n  };\n\n  drag.container = function(_) {\n    return arguments.length ? (container = typeof _ === \"function\" ? _ : constant(_), drag) : container;\n  };\n\n  drag.subject = function(_) {\n    return arguments.length ? (subject = typeof _ === \"function\" ? _ : constant(_), drag) : subject;\n  };\n\n  drag.touchable = function(_) {\n    return arguments.length ? (touchable = typeof _ === \"function\" ? _ : constant(!!_), drag) : touchable;\n  };\n\n  drag.on = function() {\n    var value = listeners.on.apply(listeners, arguments);\n    return value === listeners ? drag : value;\n  };\n\n  drag.clickDistance = function(_) {\n    return arguments.length ? (clickDistance2 = (_ = +_) * _, drag) : Math.sqrt(clickDistance2);\n  };\n\n  return drag;\n}\n","import { _ as _slicedToArray, a as _defineProperty, P as Position, C as ConnectionMode, g as getHostForElement, u as useStoreApi, b as useStore, c as addEdge, d as getMarkerId, i as internalsSymbol, r as rectToBox, e as getConnectedEdges, f as getDimensions, h as PanOnScrollMode, j as clamp, k as getNodesInside, l as getSelectionChanges, m as clampPosition, p as pointToRendererPoint, n as handleNodeClick, o as getRectOfNodes, q as ConnectionLineType, M as MarkerType, s as isNumeric, t as getMouseHandler$1, v as Provider$1, w as createStore, x as infiniteExtent, y as applyNodeChanges, z as applyEdgeChanges } from './index-a12c80bd.js';\nexport { H as BackgroundVariant, q as ConnectionLineType, C as ConnectionMode, M as MarkerType, h as PanOnScrollMode, P as Position, c as addEdge, z as applyEdgeChanges, y as applyNodeChanges, e as getConnectedEdges, E as getIncomers, D as getOutgoers, o as getRectOfNodes, G as getTransformForBounds, i as internalsSymbol, B as isEdge, A as isNode, F as updateEdge, b as useStore, u as useStoreApi } from './index-a12c80bd.js';\nimport { _ as _objectWithoutProperties } from './index-20df97c0.js';\nexport { C as ControlButton, i as Controls } from './index-20df97c0.js';\nimport React, { memo, useRef, useState, useEffect, createContext, forwardRef, useContext, useMemo, useCallback } from 'react';\nimport cc from 'classcat';\nimport { _ as _toConsumableArray, u as useReactFlow } from './useReactFlow-993c30ca.js';\nexport { u as useReactFlow } from './useReactFlow-993c30ca.js';\nimport shallow from 'zustand/shallow';\nimport { zoom, zoomIdentity } from 'd3-zoom';\nimport { select, pointer } from 'd3-selection';\nimport { drag } from 'd3-drag';\nexport { default as MiniMap } from './index2.js';\nexport { default as Background } from './index3.js';\nexport { default as useUpdateNodeInternals } from './useUpdateNodeInternals.js';\nexport { default as useNodes } from './useNodes.js';\nexport { default as useEdges } from './useEdges.js';\nexport { default as useViewport } from './useViewport.js';\nimport 'zustand';\nimport 'zustand/context';\n\nvar accounts = ['paid-pro', 'paid-sponsor', 'paid-enterprise', 'paid-custom'];\n\nfunction Attribution(_ref) {\n  var proOptions = _ref.proOptions,\n      _ref$position = _ref.position,\n      position = _ref$position === void 0 ? 'bottom-right' : _ref$position;\n\n  if (proOptions !== null && proOptions !== void 0 && proOptions.account && accounts.includes(proOptions === null || proOptions === void 0 ? void 0 : proOptions.account) && proOptions !== null && proOptions !== void 0 && proOptions.hideAttribution) {\n    return null;\n  }\n\n  var positionClasses = \"\".concat(position).split('-');\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: cc(['react-flow__attribution'].concat(_toConsumableArray(positionClasses))),\n    \"data-message\": \"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev/pricing\"\n  }, /*#__PURE__*/React.createElement(\"a\", {\n    href: \"https://reactflow.dev\",\n    target: \"_blank\",\n    rel: \"noopener noreferrer\"\n  }, \"React Flow\"));\n}\n\nvar _excluded$2 = [\"x\", \"y\", \"label\", \"labelStyle\", \"labelShowBg\", \"labelBgStyle\", \"labelBgPadding\", \"labelBgBorderRadius\", \"children\", \"className\"];\n\nfunction ownKeys$c(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$c(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$c(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$c(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar EdgeText = function EdgeText(_ref) {\n  var x = _ref.x,\n      y = _ref.y,\n      label = _ref.label,\n      _ref$labelStyle = _ref.labelStyle,\n      labelStyle = _ref$labelStyle === void 0 ? {} : _ref$labelStyle,\n      _ref$labelShowBg = _ref.labelShowBg,\n      labelShowBg = _ref$labelShowBg === void 0 ? true : _ref$labelShowBg,\n      _ref$labelBgStyle = _ref.labelBgStyle,\n      labelBgStyle = _ref$labelBgStyle === void 0 ? {} : _ref$labelBgStyle,\n      _ref$labelBgPadding = _ref.labelBgPadding,\n      labelBgPadding = _ref$labelBgPadding === void 0 ? [2, 4] : _ref$labelBgPadding,\n      _ref$labelBgBorderRad = _ref.labelBgBorderRadius,\n      labelBgBorderRadius = _ref$labelBgBorderRad === void 0 ? 2 : _ref$labelBgBorderRad,\n      children = _ref.children,\n      className = _ref.className,\n      rest = _objectWithoutProperties(_ref, _excluded$2);\n\n  var edgeRef = useRef(null);\n\n  var _useState = useState({\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      edgeTextBbox = _useState2[0],\n      setEdgeTextBbox = _useState2[1];\n\n  var edgeTextClasses = cc(['react-flow__edge-textwrapper', className]);\n  useEffect(function () {\n    if (edgeRef.current) {\n      var textBbox = edgeRef.current.getBBox();\n      setEdgeTextBbox({\n        x: textBbox.x,\n        y: textBbox.y,\n        width: textBbox.width,\n        height: textBbox.height\n      });\n    }\n  }, [label]);\n\n  if (typeof label === 'undefined' || !label) {\n    return null;\n  }\n\n  return /*#__PURE__*/React.createElement(\"g\", _objectSpread$c({\n    transform: \"translate(\".concat(x - edgeTextBbox.width / 2, \" \").concat(y - edgeTextBbox.height / 2, \")\"),\n    className: edgeTextClasses\n  }, rest), labelShowBg && /*#__PURE__*/React.createElement(\"rect\", {\n    width: edgeTextBbox.width + 2 * labelBgPadding[0],\n    x: -labelBgPadding[0],\n    y: -labelBgPadding[1],\n    height: edgeTextBbox.height + 2 * labelBgPadding[1],\n    className: \"react-flow__edge-textbg\",\n    style: labelBgStyle,\n    rx: labelBgBorderRadius,\n    ry: labelBgBorderRadius\n  }), /*#__PURE__*/React.createElement(\"text\", {\n    className: \"react-flow__edge-text\",\n    y: edgeTextBbox.height / 2,\n    dy: \"0.3em\",\n    ref: edgeRef,\n    style: labelStyle\n  }, label), children);\n};\n\nvar EdgeText$1 = /*#__PURE__*/memo(EdgeText);\n\nvar BaseEdge = (function (_ref) {\n  var path = _ref.path,\n      centerX = _ref.centerX,\n      centerY = _ref.centerY,\n      label = _ref.label,\n      labelStyle = _ref.labelStyle,\n      labelShowBg = _ref.labelShowBg,\n      labelBgStyle = _ref.labelBgStyle,\n      labelBgPadding = _ref.labelBgPadding,\n      labelBgBorderRadius = _ref.labelBgBorderRadius,\n      style = _ref.style,\n      markerEnd = _ref.markerEnd,\n      markerStart = _ref.markerStart;\n  var text = label ? /*#__PURE__*/React.createElement(EdgeText$1, {\n    x: centerX,\n    y: centerY,\n    label: label,\n    labelStyle: labelStyle,\n    labelShowBg: labelShowBg,\n    labelBgStyle: labelBgStyle,\n    labelBgPadding: labelBgPadding,\n    labelBgBorderRadius: labelBgBorderRadius\n  }) : null;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"path\", {\n    style: style,\n    d: path,\n    className: \"react-flow__edge-path\",\n    markerEnd: markerEnd,\n    markerStart: markerStart\n  }), text);\n});\n\nfunction getControl(_ref) {\n  var pos = _ref.pos,\n      x1 = _ref.x1,\n      y1 = _ref.y1,\n      x2 = _ref.x2,\n      y2 = _ref.y2;\n  var ctX, ctY;\n\n  switch (pos) {\n    case Position.Left:\n    case Position.Right:\n      {\n        ctX = 0.5 * (x1 + x2);\n        ctY = y1;\n      }\n      break;\n\n    case Position.Top:\n    case Position.Bottom:\n      {\n        ctX = x1;\n        ctY = 0.5 * (y1 + y2);\n      }\n      break;\n  }\n\n  return [ctX, ctY];\n}\n\nfunction getSimpleBezierPath(_ref2) {\n  var sourceX = _ref2.sourceX,\n      sourceY = _ref2.sourceY,\n      _ref2$sourcePosition = _ref2.sourcePosition,\n      sourcePosition = _ref2$sourcePosition === void 0 ? Position.Bottom : _ref2$sourcePosition,\n      targetX = _ref2.targetX,\n      targetY = _ref2.targetY,\n      _ref2$targetPosition = _ref2.targetPosition,\n      targetPosition = _ref2$targetPosition === void 0 ? Position.Top : _ref2$targetPosition;\n\n  var _getControl = getControl({\n    pos: sourcePosition,\n    x1: sourceX,\n    y1: sourceY,\n    x2: targetX,\n    y2: targetY\n  }),\n      _getControl2 = _slicedToArray(_getControl, 2),\n      sourceControlX = _getControl2[0],\n      sourceControlY = _getControl2[1];\n\n  var _getControl3 = getControl({\n    pos: targetPosition,\n    x1: targetX,\n    y1: targetY,\n    x2: sourceX,\n    y2: sourceY\n  }),\n      _getControl4 = _slicedToArray(_getControl3, 2),\n      targetControlX = _getControl4[0],\n      targetControlY = _getControl4[1];\n\n  return \"M\".concat(sourceX, \",\").concat(sourceY, \" C\").concat(sourceControlX, \",\").concat(sourceControlY, \" \").concat(targetControlX, \",\").concat(targetControlY, \" \").concat(targetX, \",\").concat(targetY);\n} // @TODO: this function will recalculate the control points\n// one option is to let getXXXPath() return center points\n// but will introduce breaking changes\n// the getCenter() of other types of edges might need to change, too\n\nfunction getSimpleBezierCenter(_ref3) {\n  var sourceX = _ref3.sourceX,\n      sourceY = _ref3.sourceY,\n      _ref3$sourcePosition = _ref3.sourcePosition,\n      sourcePosition = _ref3$sourcePosition === void 0 ? Position.Bottom : _ref3$sourcePosition,\n      targetX = _ref3.targetX,\n      targetY = _ref3.targetY,\n      _ref3$targetPosition = _ref3.targetPosition,\n      targetPosition = _ref3$targetPosition === void 0 ? Position.Top : _ref3$targetPosition;\n\n  var _getControl5 = getControl({\n    pos: sourcePosition,\n    x1: sourceX,\n    y1: sourceY,\n    x2: targetX,\n    y2: targetY\n  }),\n      _getControl6 = _slicedToArray(_getControl5, 2),\n      sourceControlX = _getControl6[0],\n      sourceControlY = _getControl6[1];\n\n  var _getControl7 = getControl({\n    pos: targetPosition,\n    x1: targetX,\n    y1: targetY,\n    x2: sourceX,\n    y2: sourceY\n  }),\n      _getControl8 = _slicedToArray(_getControl7, 2),\n      targetControlX = _getControl8[0],\n      targetControlY = _getControl8[1]; // cubic bezier t=0.5 mid point, not the actual mid point, but easy to calculate\n  // https://stackoverflow.com/questions/67516101/how-to-find-distance-mid-point-of-bezier-curve\n\n\n  var centerX = sourceX * 0.125 + sourceControlX * 0.375 + targetControlX * 0.375 + targetX * 0.125;\n  var centerY = sourceY * 0.125 + sourceControlY * 0.375 + targetControlY * 0.375 + targetY * 0.125;\n  var xOffset = Math.abs(centerX - sourceX);\n  var yOffset = Math.abs(centerY - sourceY);\n  return [centerX, centerY, xOffset, yOffset];\n}\nvar SimpleBezierEdge = /*#__PURE__*/memo(function (_ref4) {\n  var sourceX = _ref4.sourceX,\n      sourceY = _ref4.sourceY,\n      targetX = _ref4.targetX,\n      targetY = _ref4.targetY,\n      _ref4$sourcePosition = _ref4.sourcePosition,\n      sourcePosition = _ref4$sourcePosition === void 0 ? Position.Bottom : _ref4$sourcePosition,\n      _ref4$targetPosition = _ref4.targetPosition,\n      targetPosition = _ref4$targetPosition === void 0 ? Position.Top : _ref4$targetPosition,\n      label = _ref4.label,\n      labelStyle = _ref4.labelStyle,\n      labelShowBg = _ref4.labelShowBg,\n      labelBgStyle = _ref4.labelBgStyle,\n      labelBgPadding = _ref4.labelBgPadding,\n      labelBgBorderRadius = _ref4.labelBgBorderRadius,\n      style = _ref4.style,\n      markerEnd = _ref4.markerEnd,\n      markerStart = _ref4.markerStart;\n  var params = {\n    sourceX: sourceX,\n    sourceY: sourceY,\n    sourcePosition: sourcePosition,\n    targetX: targetX,\n    targetY: targetY,\n    targetPosition: targetPosition\n  };\n  var path = getSimpleBezierPath(params);\n\n  var _getSimpleBezierCente = getSimpleBezierCenter(params),\n      _getSimpleBezierCente2 = _slicedToArray(_getSimpleBezierCente, 2),\n      centerX = _getSimpleBezierCente2[0],\n      centerY = _getSimpleBezierCente2[1];\n\n  return /*#__PURE__*/React.createElement(BaseEdge, {\n    path: path,\n    centerX: centerX,\n    centerY: centerY,\n    label: label,\n    labelStyle: labelStyle,\n    labelShowBg: labelShowBg,\n    labelBgStyle: labelBgStyle,\n    labelBgPadding: labelBgPadding,\n    labelBgBorderRadius: labelBgBorderRadius,\n    style: style,\n    markerEnd: markerEnd,\n    markerStart: markerStart\n  });\n});\n\nfunction ownKeys$b(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$b(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$b(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$b(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nvar getMarkerEnd = function getMarkerEnd(markerType, markerEndId) {\n  if (typeof markerEndId !== 'undefined' && markerEndId) {\n    return \"url(#\".concat(markerEndId, \")\");\n  }\n\n  return typeof markerType !== 'undefined' ? \"url(#react-flow__\".concat(markerType, \")\") : 'none';\n};\nvar LeftOrRight = [Position.Left, Position.Right];\nvar getCenter = function getCenter(_ref) {\n  var sourceX = _ref.sourceX,\n      sourceY = _ref.sourceY,\n      targetX = _ref.targetX,\n      targetY = _ref.targetY,\n      _ref$sourcePosition = _ref.sourcePosition,\n      sourcePosition = _ref$sourcePosition === void 0 ? Position.Bottom : _ref$sourcePosition,\n      _ref$targetPosition = _ref.targetPosition,\n      targetPosition = _ref$targetPosition === void 0 ? Position.Top : _ref$targetPosition;\n  var sourceIsLeftOrRight = LeftOrRight.includes(sourcePosition);\n  var targetIsLeftOrRight = LeftOrRight.includes(targetPosition); // we expect flows to be horizontal or vertical (all handles left or right respectively top or bottom)\n  // a mixed edge is when one the source is on the left and the target is on the top for example.\n\n  var mixedEdge = sourceIsLeftOrRight && !targetIsLeftOrRight || targetIsLeftOrRight && !sourceIsLeftOrRight;\n\n  if (mixedEdge) {\n    var _xOffset = sourceIsLeftOrRight ? Math.abs(targetX - sourceX) : 0;\n\n    var _centerX = sourceX > targetX ? sourceX - _xOffset : sourceX + _xOffset;\n\n    var _yOffset = sourceIsLeftOrRight ? 0 : Math.abs(targetY - sourceY);\n\n    var _centerY = sourceY < targetY ? sourceY + _yOffset : sourceY - _yOffset;\n\n    return [_centerX, _centerY, _xOffset, _yOffset];\n  }\n\n  var xOffset = Math.abs(targetX - sourceX) / 2;\n  var centerX = targetX < sourceX ? targetX + xOffset : targetX - xOffset;\n  var yOffset = Math.abs(targetY - sourceY) / 2;\n  var centerY = targetY < sourceY ? targetY + yOffset : targetY - yOffset;\n  return [centerX, centerY, xOffset, yOffset];\n};\nfunction getMouseHandler(id, getState, handler) {\n  return handler === undefined ? handler : function (event) {\n    var edge = getState().edges.find(function (e) {\n      return e.id === id;\n    });\n    handler(event, _objectSpread$b({}, edge));\n  };\n}\n\n// The name indicates the direction of the path. \"bottomLeftCorner\" goes\n// from bottom to the left and \"leftBottomCorner\" goes from left to the bottom.\n// We have to consider the direction of the paths because of the animated lines.\n\nvar bottomLeftCorner = function bottomLeftCorner(x, y, size) {\n  return \"L \".concat(x, \",\").concat(y - size, \"Q \").concat(x, \",\").concat(y, \" \").concat(x + size, \",\").concat(y);\n};\n\nvar leftBottomCorner = function leftBottomCorner(x, y, size) {\n  return \"L \".concat(x + size, \",\").concat(y, \"Q \").concat(x, \",\").concat(y, \" \").concat(x, \",\").concat(y - size);\n};\n\nvar bottomRightCorner = function bottomRightCorner(x, y, size) {\n  return \"L \".concat(x, \",\").concat(y - size, \"Q \").concat(x, \",\").concat(y, \" \").concat(x - size, \",\").concat(y);\n};\n\nvar rightBottomCorner = function rightBottomCorner(x, y, size) {\n  return \"L \".concat(x - size, \",\").concat(y, \"Q \").concat(x, \",\").concat(y, \" \").concat(x, \",\").concat(y - size);\n};\n\nvar leftTopCorner = function leftTopCorner(x, y, size) {\n  return \"L \".concat(x + size, \",\").concat(y, \"Q \").concat(x, \",\").concat(y, \" \").concat(x, \",\").concat(y + size);\n};\n\nvar topLeftCorner = function topLeftCorner(x, y, size) {\n  return \"L \".concat(x, \",\").concat(y + size, \"Q \").concat(x, \",\").concat(y, \" \").concat(x + size, \",\").concat(y);\n};\n\nvar topRightCorner = function topRightCorner(x, y, size) {\n  return \"L \".concat(x, \",\").concat(y + size, \"Q \").concat(x, \",\").concat(y, \" \").concat(x - size, \",\").concat(y);\n};\n\nvar rightTopCorner = function rightTopCorner(x, y, size) {\n  return \"L \".concat(x - size, \",\").concat(y, \"Q \").concat(x, \",\").concat(y, \" \").concat(x, \",\").concat(y + size);\n};\n\nfunction getSmoothStepPath(_ref) {\n  var sourceX = _ref.sourceX,\n      sourceY = _ref.sourceY,\n      _ref$sourcePosition = _ref.sourcePosition,\n      sourcePosition = _ref$sourcePosition === void 0 ? Position.Bottom : _ref$sourcePosition,\n      targetX = _ref.targetX,\n      targetY = _ref.targetY,\n      _ref$targetPosition = _ref.targetPosition,\n      targetPosition = _ref$targetPosition === void 0 ? Position.Top : _ref$targetPosition,\n      _ref$borderRadius = _ref.borderRadius,\n      borderRadius = _ref$borderRadius === void 0 ? 5 : _ref$borderRadius,\n      centerX = _ref.centerX,\n      centerY = _ref.centerY;\n\n  var _getCenter = getCenter({\n    sourceX: sourceX,\n    sourceY: sourceY,\n    targetX: targetX,\n    targetY: targetY\n  }),\n      _getCenter2 = _slicedToArray(_getCenter, 4),\n      _centerX = _getCenter2[0],\n      _centerY = _getCenter2[1],\n      offsetX = _getCenter2[2],\n      offsetY = _getCenter2[3];\n\n  var cornerWidth = Math.min(borderRadius, Math.abs(targetX - sourceX));\n  var cornerHeight = Math.min(borderRadius, Math.abs(targetY - sourceY));\n  var cornerSize = Math.min(cornerWidth, cornerHeight, offsetX, offsetY);\n  var leftAndRight = [Position.Left, Position.Right];\n  var cX = typeof centerX !== 'undefined' ? centerX : _centerX;\n  var cY = typeof centerY !== 'undefined' ? centerY : _centerY;\n  var firstCornerPath = null;\n  var secondCornerPath = null;\n\n  if (sourceX <= targetX) {\n    firstCornerPath = sourceY <= targetY ? bottomLeftCorner(sourceX, cY, cornerSize) : topLeftCorner(sourceX, cY, cornerSize);\n    secondCornerPath = sourceY <= targetY ? rightTopCorner(targetX, cY, cornerSize) : rightBottomCorner(targetX, cY, cornerSize);\n  } else {\n    firstCornerPath = sourceY < targetY ? bottomRightCorner(sourceX, cY, cornerSize) : topRightCorner(sourceX, cY, cornerSize);\n    secondCornerPath = sourceY < targetY ? leftTopCorner(targetX, cY, cornerSize) : leftBottomCorner(targetX, cY, cornerSize);\n  }\n\n  if (leftAndRight.includes(sourcePosition) && leftAndRight.includes(targetPosition)) {\n    if (sourceX <= targetX) {\n      firstCornerPath = sourceY <= targetY ? rightTopCorner(cX, sourceY, cornerSize) : rightBottomCorner(cX, sourceY, cornerSize);\n      secondCornerPath = sourceY <= targetY ? bottomLeftCorner(cX, targetY, cornerSize) : topLeftCorner(cX, targetY, cornerSize);\n    } else if (sourcePosition === Position.Right && targetPosition === Position.Left || sourcePosition === Position.Left && targetPosition === Position.Right || sourcePosition === Position.Left && targetPosition === Position.Left) {\n      // and sourceX > targetX\n      firstCornerPath = sourceY <= targetY ? leftTopCorner(cX, sourceY, cornerSize) : leftBottomCorner(cX, sourceY, cornerSize);\n      secondCornerPath = sourceY <= targetY ? bottomRightCorner(cX, targetY, cornerSize) : topRightCorner(cX, targetY, cornerSize);\n    }\n  } else if (leftAndRight.includes(sourcePosition) && !leftAndRight.includes(targetPosition)) {\n    if (sourceX <= targetX) {\n      firstCornerPath = sourceY <= targetY ? rightTopCorner(targetX, sourceY, cornerSize) : rightBottomCorner(targetX, sourceY, cornerSize);\n    } else {\n      firstCornerPath = sourceY <= targetY ? leftTopCorner(targetX, sourceY, cornerSize) : leftBottomCorner(targetX, sourceY, cornerSize);\n    }\n\n    secondCornerPath = '';\n  } else if (!leftAndRight.includes(sourcePosition) && leftAndRight.includes(targetPosition)) {\n    if (sourceX <= targetX) {\n      firstCornerPath = sourceY <= targetY ? bottomLeftCorner(sourceX, targetY, cornerSize) : topLeftCorner(sourceX, targetY, cornerSize);\n    } else {\n      firstCornerPath = sourceY <= targetY ? bottomRightCorner(sourceX, targetY, cornerSize) : topRightCorner(sourceX, targetY, cornerSize);\n    }\n\n    secondCornerPath = '';\n  }\n\n  return \"M \".concat(sourceX, \",\").concat(sourceY).concat(firstCornerPath).concat(secondCornerPath, \"L \").concat(targetX, \",\").concat(targetY);\n}\nvar SmoothStepEdge = /*#__PURE__*/memo(function (_ref2) {\n  var sourceX = _ref2.sourceX,\n      sourceY = _ref2.sourceY,\n      targetX = _ref2.targetX,\n      targetY = _ref2.targetY,\n      label = _ref2.label,\n      labelStyle = _ref2.labelStyle,\n      labelShowBg = _ref2.labelShowBg,\n      labelBgStyle = _ref2.labelBgStyle,\n      labelBgPadding = _ref2.labelBgPadding,\n      labelBgBorderRadius = _ref2.labelBgBorderRadius,\n      style = _ref2.style,\n      _ref2$sourcePosition = _ref2.sourcePosition,\n      sourcePosition = _ref2$sourcePosition === void 0 ? Position.Bottom : _ref2$sourcePosition,\n      _ref2$targetPosition = _ref2.targetPosition,\n      targetPosition = _ref2$targetPosition === void 0 ? Position.Top : _ref2$targetPosition,\n      markerEnd = _ref2.markerEnd,\n      markerStart = _ref2.markerStart,\n      _ref2$borderRadius = _ref2.borderRadius,\n      borderRadius = _ref2$borderRadius === void 0 ? 5 : _ref2$borderRadius;\n\n  var _getCenter3 = getCenter({\n    sourceX: sourceX,\n    sourceY: sourceY,\n    targetX: targetX,\n    targetY: targetY,\n    sourcePosition: sourcePosition,\n    targetPosition: targetPosition\n  }),\n      _getCenter4 = _slicedToArray(_getCenter3, 2),\n      centerX = _getCenter4[0],\n      centerY = _getCenter4[1];\n\n  var path = getSmoothStepPath({\n    sourceX: sourceX,\n    sourceY: sourceY,\n    sourcePosition: sourcePosition,\n    targetX: targetX,\n    targetY: targetY,\n    targetPosition: targetPosition,\n    borderRadius: borderRadius\n  });\n  return /*#__PURE__*/React.createElement(BaseEdge, {\n    path: path,\n    centerX: centerX,\n    centerY: centerY,\n    label: label,\n    labelStyle: labelStyle,\n    labelShowBg: labelShowBg,\n    labelBgStyle: labelBgStyle,\n    labelBgPadding: labelBgPadding,\n    labelBgBorderRadius: labelBgBorderRadius,\n    style: style,\n    markerEnd: markerEnd,\n    markerStart: markerStart\n  });\n});\n\nfunction ownKeys$a(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$a(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$a(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$a(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nvar StepEdge = /*#__PURE__*/memo(function (props) {\n  return /*#__PURE__*/React.createElement(SmoothStepEdge, _objectSpread$a(_objectSpread$a({}, props), {}, {\n    borderRadius: 0\n  }));\n});\n\nvar StraightEdge = /*#__PURE__*/memo(function (_ref) {\n  var sourceX = _ref.sourceX,\n      sourceY = _ref.sourceY,\n      targetX = _ref.targetX,\n      targetY = _ref.targetY,\n      label = _ref.label,\n      labelStyle = _ref.labelStyle,\n      labelShowBg = _ref.labelShowBg,\n      labelBgStyle = _ref.labelBgStyle,\n      labelBgPadding = _ref.labelBgPadding,\n      labelBgBorderRadius = _ref.labelBgBorderRadius,\n      style = _ref.style,\n      markerEnd = _ref.markerEnd,\n      markerStart = _ref.markerStart;\n  var yOffset = Math.abs(targetY - sourceY) / 2;\n  var centerY = targetY < sourceY ? targetY + yOffset : targetY - yOffset;\n  var xOffset = Math.abs(targetX - sourceX) / 2;\n  var centerX = targetX < sourceX ? targetX + xOffset : targetX - xOffset;\n  var path = \"M \".concat(sourceX, \",\").concat(sourceY, \"L \").concat(targetX, \",\").concat(targetY);\n  return /*#__PURE__*/React.createElement(BaseEdge, {\n    path: path,\n    centerX: centerX,\n    centerY: centerY,\n    label: label,\n    labelStyle: labelStyle,\n    labelShowBg: labelShowBg,\n    labelBgStyle: labelBgStyle,\n    labelBgPadding: labelBgPadding,\n    labelBgBorderRadius: labelBgBorderRadius,\n    style: style,\n    markerEnd: markerEnd,\n    markerStart: markerStart\n  });\n});\n\nfunction calculateControlOffset(distance, curvature) {\n  if (distance >= 0) {\n    return 0.5 * distance;\n  } else {\n    return curvature * 25 * Math.sqrt(-distance);\n  }\n}\n\nfunction getControlWithCurvature(_ref) {\n  var pos = _ref.pos,\n      x1 = _ref.x1,\n      y1 = _ref.y1,\n      x2 = _ref.x2,\n      y2 = _ref.y2,\n      c = _ref.c;\n  var ctX, ctY;\n\n  switch (pos) {\n    case Position.Left:\n      {\n        ctX = x1 - calculateControlOffset(x1 - x2, c);\n        ctY = y1;\n      }\n      break;\n\n    case Position.Right:\n      {\n        ctX = x1 + calculateControlOffset(x2 - x1, c);\n        ctY = y1;\n      }\n      break;\n\n    case Position.Top:\n      {\n        ctX = x1;\n        ctY = y1 - calculateControlOffset(y1 - y2, c);\n      }\n      break;\n\n    case Position.Bottom:\n      {\n        ctX = x1;\n        ctY = y1 + calculateControlOffset(y2 - y1, c);\n      }\n      break;\n  }\n\n  return [ctX, ctY];\n}\n\nfunction getBezierPath(_ref2) {\n  var sourceX = _ref2.sourceX,\n      sourceY = _ref2.sourceY,\n      _ref2$sourcePosition = _ref2.sourcePosition,\n      sourcePosition = _ref2$sourcePosition === void 0 ? Position.Bottom : _ref2$sourcePosition,\n      targetX = _ref2.targetX,\n      targetY = _ref2.targetY,\n      _ref2$targetPosition = _ref2.targetPosition,\n      targetPosition = _ref2$targetPosition === void 0 ? Position.Top : _ref2$targetPosition,\n      _ref2$curvature = _ref2.curvature,\n      curvature = _ref2$curvature === void 0 ? 0.25 : _ref2$curvature;\n\n  var _getControlWithCurvat = getControlWithCurvature({\n    pos: sourcePosition,\n    x1: sourceX,\n    y1: sourceY,\n    x2: targetX,\n    y2: targetY,\n    c: curvature\n  }),\n      _getControlWithCurvat2 = _slicedToArray(_getControlWithCurvat, 2),\n      sourceControlX = _getControlWithCurvat2[0],\n      sourceControlY = _getControlWithCurvat2[1];\n\n  var _getControlWithCurvat3 = getControlWithCurvature({\n    pos: targetPosition,\n    x1: targetX,\n    y1: targetY,\n    x2: sourceX,\n    y2: sourceY,\n    c: curvature\n  }),\n      _getControlWithCurvat4 = _slicedToArray(_getControlWithCurvat3, 2),\n      targetControlX = _getControlWithCurvat4[0],\n      targetControlY = _getControlWithCurvat4[1];\n\n  return \"M\".concat(sourceX, \",\").concat(sourceY, \" C\").concat(sourceControlX, \",\").concat(sourceControlY, \" \").concat(targetControlX, \",\").concat(targetControlY, \" \").concat(targetX, \",\").concat(targetY);\n} // @TODO: this function will recalculate the control points\n// one option is to let getXXXPath() return center points\n// but will introduce breaking changes\n// the getCenter() of other types of edges might need to change, too\n\nfunction getBezierCenter(_ref3) {\n  var sourceX = _ref3.sourceX,\n      sourceY = _ref3.sourceY,\n      _ref3$sourcePosition = _ref3.sourcePosition,\n      sourcePosition = _ref3$sourcePosition === void 0 ? Position.Bottom : _ref3$sourcePosition,\n      targetX = _ref3.targetX,\n      targetY = _ref3.targetY,\n      _ref3$targetPosition = _ref3.targetPosition,\n      targetPosition = _ref3$targetPosition === void 0 ? Position.Top : _ref3$targetPosition,\n      _ref3$curvature = _ref3.curvature,\n      curvature = _ref3$curvature === void 0 ? 0.25 : _ref3$curvature;\n\n  var _getControlWithCurvat5 = getControlWithCurvature({\n    pos: sourcePosition,\n    x1: sourceX,\n    y1: sourceY,\n    x2: targetX,\n    y2: targetY,\n    c: curvature\n  }),\n      _getControlWithCurvat6 = _slicedToArray(_getControlWithCurvat5, 2),\n      sourceControlX = _getControlWithCurvat6[0],\n      sourceControlY = _getControlWithCurvat6[1];\n\n  var _getControlWithCurvat7 = getControlWithCurvature({\n    pos: targetPosition,\n    x1: targetX,\n    y1: targetY,\n    x2: sourceX,\n    y2: sourceY,\n    c: curvature\n  }),\n      _getControlWithCurvat8 = _slicedToArray(_getControlWithCurvat7, 2),\n      targetControlX = _getControlWithCurvat8[0],\n      targetControlY = _getControlWithCurvat8[1]; // cubic bezier t=0.5 mid point, not the actual mid point, but easy to calculate\n  // https://stackoverflow.com/questions/67516101/how-to-find-distance-mid-point-of-bezier-curve\n\n\n  var centerX = sourceX * 0.125 + sourceControlX * 0.375 + targetControlX * 0.375 + targetX * 0.125;\n  var centerY = sourceY * 0.125 + sourceControlY * 0.375 + targetControlY * 0.375 + targetY * 0.125;\n  var xOffset = Math.abs(centerX - sourceX);\n  var yOffset = Math.abs(centerY - sourceY);\n  return [centerX, centerY, xOffset, yOffset];\n}\nvar BezierEdge = /*#__PURE__*/memo(function (_ref4) {\n  var sourceX = _ref4.sourceX,\n      sourceY = _ref4.sourceY,\n      targetX = _ref4.targetX,\n      targetY = _ref4.targetY,\n      _ref4$sourcePosition = _ref4.sourcePosition,\n      sourcePosition = _ref4$sourcePosition === void 0 ? Position.Bottom : _ref4$sourcePosition,\n      _ref4$targetPosition = _ref4.targetPosition,\n      targetPosition = _ref4$targetPosition === void 0 ? Position.Top : _ref4$targetPosition,\n      label = _ref4.label,\n      labelStyle = _ref4.labelStyle,\n      labelShowBg = _ref4.labelShowBg,\n      labelBgStyle = _ref4.labelBgStyle,\n      labelBgPadding = _ref4.labelBgPadding,\n      labelBgBorderRadius = _ref4.labelBgBorderRadius,\n      style = _ref4.style,\n      markerEnd = _ref4.markerEnd,\n      markerStart = _ref4.markerStart,\n      curvature = _ref4.curvature;\n  var params = {\n    sourceX: sourceX,\n    sourceY: sourceY,\n    sourcePosition: sourcePosition,\n    targetX: targetX,\n    targetY: targetY,\n    targetPosition: targetPosition,\n    curvature: curvature\n  };\n  var path = getBezierPath(params);\n\n  var _getBezierCenter = getBezierCenter(params),\n      _getBezierCenter2 = _slicedToArray(_getBezierCenter, 2),\n      centerX = _getBezierCenter2[0],\n      centerY = _getBezierCenter2[1];\n\n  return /*#__PURE__*/React.createElement(BaseEdge, {\n    path: path,\n    centerX: centerX,\n    centerY: centerY,\n    label: label,\n    labelStyle: labelStyle,\n    labelShowBg: labelShowBg,\n    labelBgStyle: labelBgStyle,\n    labelBgPadding: labelBgPadding,\n    labelBgBorderRadius: labelBgBorderRadius,\n    style: style,\n    markerEnd: markerEnd,\n    markerStart: markerStart\n  });\n});\n\nvar NodeIdContext = /*#__PURE__*/createContext(null);\nvar Provider = NodeIdContext.Provider;\nNodeIdContext.Consumer;\n\nfunction checkElementBelowIsValid(event, connectionMode, isTarget, nodeId, handleId, isValidConnection, doc) {\n  var elementBelow = doc.elementFromPoint(event.clientX, event.clientY);\n  var elementBelowIsTarget = (elementBelow === null || elementBelow === void 0 ? void 0 : elementBelow.classList.contains('target')) || false;\n  var elementBelowIsSource = (elementBelow === null || elementBelow === void 0 ? void 0 : elementBelow.classList.contains('source')) || false;\n  var result = {\n    elementBelow: elementBelow,\n    isValid: false,\n    connection: {\n      source: null,\n      target: null,\n      sourceHandle: null,\n      targetHandle: null\n    },\n    isHoveringHandle: false\n  };\n\n  if (elementBelow && (elementBelowIsTarget || elementBelowIsSource)) {\n    result.isHoveringHandle = true;\n    var elementBelowNodeId = elementBelow.getAttribute('data-nodeid');\n    var elementBelowHandleId = elementBelow.getAttribute('data-handleid');\n    var connection = isTarget ? {\n      source: elementBelowNodeId,\n      sourceHandle: elementBelowHandleId,\n      target: nodeId,\n      targetHandle: handleId\n    } : {\n      source: nodeId,\n      sourceHandle: handleId,\n      target: elementBelowNodeId,\n      targetHandle: elementBelowHandleId\n    };\n    result.connection = connection; // in strict mode we don't allow target to target or source to source connections\n\n    var isValid = connectionMode === ConnectionMode.Strict ? isTarget && elementBelowIsSource || !isTarget && elementBelowIsTarget : true;\n\n    if (isValid) {\n      result.isValid = isValidConnection(connection);\n    }\n  }\n\n  return result;\n}\n\nfunction resetRecentHandle(hoveredHandle) {\n  hoveredHandle === null || hoveredHandle === void 0 ? void 0 : hoveredHandle.classList.remove('react-flow__handle-valid');\n  hoveredHandle === null || hoveredHandle === void 0 ? void 0 : hoveredHandle.classList.remove('react-flow__handle-connecting');\n}\n\nfunction handleMouseDown(_ref) {\n  var event = _ref.event,\n      handleId = _ref.handleId,\n      nodeId = _ref.nodeId,\n      onConnect = _ref.onConnect,\n      isTarget = _ref.isTarget,\n      getState = _ref.getState,\n      setState = _ref.setState,\n      isValidConnection = _ref.isValidConnection,\n      elementEdgeUpdaterType = _ref.elementEdgeUpdaterType,\n      onEdgeUpdateEnd = _ref.onEdgeUpdateEnd;\n  var reactFlowNode = event.target.closest('.react-flow'); // when react-flow is used inside a shadow root we can't use document\n\n  var doc = getHostForElement(event.target);\n\n  if (!doc) {\n    return;\n  }\n\n  var elementBelow = doc.elementFromPoint(event.clientX, event.clientY);\n  var elementBelowIsTarget = elementBelow === null || elementBelow === void 0 ? void 0 : elementBelow.classList.contains('target');\n  var elementBelowIsSource = elementBelow === null || elementBelow === void 0 ? void 0 : elementBelow.classList.contains('source');\n\n  if (!reactFlowNode || !elementBelowIsTarget && !elementBelowIsSource && !elementEdgeUpdaterType) {\n    return;\n  }\n\n  var _getState = getState(),\n      onConnectStart = _getState.onConnectStart,\n      connectionMode = _getState.connectionMode;\n\n  var handleType = elementEdgeUpdaterType ? elementEdgeUpdaterType : elementBelowIsTarget ? 'target' : 'source';\n  var containerBounds = reactFlowNode.getBoundingClientRect();\n  var recentHoveredHandle;\n  setState({\n    connectionPosition: {\n      x: event.clientX - containerBounds.left,\n      y: event.clientY - containerBounds.top\n    },\n    connectionNodeId: nodeId,\n    connectionHandleId: handleId,\n    connectionHandleType: handleType\n  });\n  onConnectStart === null || onConnectStart === void 0 ? void 0 : onConnectStart(event, {\n    nodeId: nodeId,\n    handleId: handleId,\n    handleType: handleType\n  });\n\n  function onMouseMove(event) {\n    setState({\n      connectionPosition: {\n        x: event.clientX - containerBounds.left,\n        y: event.clientY - containerBounds.top\n      }\n    });\n\n    var _checkElementBelowIsV = checkElementBelowIsValid(event, connectionMode, isTarget, nodeId, handleId, isValidConnection, doc),\n        connection = _checkElementBelowIsV.connection,\n        elementBelow = _checkElementBelowIsV.elementBelow,\n        isValid = _checkElementBelowIsV.isValid,\n        isHoveringHandle = _checkElementBelowIsV.isHoveringHandle;\n\n    if (!isHoveringHandle) {\n      return resetRecentHandle(recentHoveredHandle);\n    }\n\n    if (connection.source !== connection.target && elementBelow) {\n      resetRecentHandle(recentHoveredHandle);\n      recentHoveredHandle = elementBelow;\n      elementBelow.classList.add('react-flow__handle-connecting');\n      elementBelow.classList.toggle('react-flow__handle-valid', isValid);\n    }\n  }\n\n  function onMouseUp(event) {\n    var _getState2 = getState(),\n        onConnectStop = _getState2.onConnectStop,\n        onConnectEnd = _getState2.onConnectEnd;\n\n    var _checkElementBelowIsV2 = checkElementBelowIsValid(event, connectionMode, isTarget, nodeId, handleId, isValidConnection, doc),\n        connection = _checkElementBelowIsV2.connection,\n        isValid = _checkElementBelowIsV2.isValid;\n\n    onConnectStop === null || onConnectStop === void 0 ? void 0 : onConnectStop(event);\n\n    if (isValid) {\n      onConnect === null || onConnect === void 0 ? void 0 : onConnect(connection);\n    }\n\n    onConnectEnd === null || onConnectEnd === void 0 ? void 0 : onConnectEnd(event);\n\n    if (elementEdgeUpdaterType && onEdgeUpdateEnd) {\n      onEdgeUpdateEnd(event);\n    }\n\n    resetRecentHandle(recentHoveredHandle);\n    setState({\n      connectionNodeId: null,\n      connectionHandleId: null,\n      connectionHandleType: null\n    });\n    doc.removeEventListener('mousemove', onMouseMove);\n    doc.removeEventListener('mouseup', onMouseUp);\n  }\n\n  doc.addEventListener('mousemove', onMouseMove);\n  doc.addEventListener('mouseup', onMouseUp);\n}\n\nvar _excluded$1 = [\"type\", \"position\", \"isValidConnection\", \"isConnectable\", \"id\", \"onConnect\", \"children\", \"className\", \"onMouseDown\"];\n\nfunction ownKeys$9(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$9(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$9(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$9(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar alwaysValid = function alwaysValid() {\n  return true;\n};\n\nvar selector$a = function selector(s) {\n  return {\n    connectionStartHandle: s.connectionStartHandle,\n    connectOnClick: s.connectOnClick\n  };\n};\n\nvar Handle = /*#__PURE__*/forwardRef(function (_ref, ref) {\n  var _ref$type = _ref.type,\n      type = _ref$type === void 0 ? 'source' : _ref$type,\n      _ref$position = _ref.position,\n      position = _ref$position === void 0 ? Position.Top : _ref$position,\n      _ref$isValidConnectio = _ref.isValidConnection,\n      isValidConnection = _ref$isValidConnectio === void 0 ? alwaysValid : _ref$isValidConnectio,\n      _ref$isConnectable = _ref.isConnectable,\n      isConnectable = _ref$isConnectable === void 0 ? true : _ref$isConnectable,\n      id = _ref.id,\n      onConnect = _ref.onConnect,\n      children = _ref.children,\n      className = _ref.className,\n      onMouseDown = _ref.onMouseDown,\n      rest = _objectWithoutProperties(_ref, _excluded$1);\n\n  var store = useStoreApi();\n  var nodeId = useContext(NodeIdContext);\n\n  var _useStore = useStore(selector$a, shallow),\n      connectionStartHandle = _useStore.connectionStartHandle,\n      connectOnClick = _useStore.connectOnClick;\n\n  var handleId = id || null;\n  var isTarget = type === 'target';\n\n  var onConnectExtended = function onConnectExtended(params) {\n    var _store$getState = store.getState(),\n        defaultEdgeOptions = _store$getState.defaultEdgeOptions,\n        onConnectAction = _store$getState.onConnect,\n        hasDefaultEdges = _store$getState.hasDefaultEdges;\n\n    var edgeParams = _objectSpread$9(_objectSpread$9({}, defaultEdgeOptions), params);\n\n    if (hasDefaultEdges) {\n      var _store$getState2 = store.getState(),\n          edges = _store$getState2.edges;\n\n      store.setState({\n        edges: addEdge(edgeParams, edges)\n      });\n    }\n\n    onConnectAction === null || onConnectAction === void 0 ? void 0 : onConnectAction(edgeParams);\n    onConnect === null || onConnect === void 0 ? void 0 : onConnect(edgeParams);\n  };\n\n  var onMouseDownHandler = function onMouseDownHandler(event) {\n    if (event.button === 0) {\n      handleMouseDown({\n        event: event,\n        handleId: handleId,\n        nodeId: nodeId,\n        onConnect: onConnectExtended,\n        isTarget: isTarget,\n        getState: store.getState,\n        setState: store.setState,\n        isValidConnection: isValidConnection\n      });\n    }\n\n    onMouseDown === null || onMouseDown === void 0 ? void 0 : onMouseDown(event);\n  };\n\n  var onClick = function onClick(event) {\n    var _store$getState3 = store.getState(),\n        onClickConnectStart = _store$getState3.onClickConnectStart,\n        onClickConnectStop = _store$getState3.onClickConnectStop,\n        onClickConnectEnd = _store$getState3.onClickConnectEnd,\n        connectionMode = _store$getState3.connectionMode;\n\n    if (!connectionStartHandle) {\n      onClickConnectStart === null || onClickConnectStart === void 0 ? void 0 : onClickConnectStart(event, {\n        nodeId: nodeId,\n        handleId: handleId,\n        handleType: type\n      });\n      store.setState({\n        connectionStartHandle: {\n          nodeId: nodeId,\n          type: type,\n          handleId: handleId\n        }\n      });\n      return;\n    }\n\n    var doc = getHostForElement(event.target);\n\n    var _checkElementBelowIsV = checkElementBelowIsValid(event, connectionMode, connectionStartHandle.type === 'target', connectionStartHandle.nodeId, connectionStartHandle.handleId || null, isValidConnection, doc),\n        connection = _checkElementBelowIsV.connection,\n        isValid = _checkElementBelowIsV.isValid;\n\n    onClickConnectStop === null || onClickConnectStop === void 0 ? void 0 : onClickConnectStop(event);\n\n    if (isValid) {\n      onConnectExtended(connection);\n    }\n\n    onClickConnectEnd === null || onClickConnectEnd === void 0 ? void 0 : onClickConnectEnd(event);\n    store.setState({\n      connectionStartHandle: null\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", _objectSpread$9({\n    \"data-handleid\": handleId,\n    \"data-nodeid\": nodeId,\n    \"data-handlepos\": position,\n    className: cc(['react-flow__handle', \"react-flow__handle-\".concat(position), 'nodrag', className, {\n      source: !isTarget,\n      target: isTarget,\n      connectable: isConnectable,\n      connecting: (connectionStartHandle === null || connectionStartHandle === void 0 ? void 0 : connectionStartHandle.nodeId) === nodeId && (connectionStartHandle === null || connectionStartHandle === void 0 ? void 0 : connectionStartHandle.handleId) === handleId && (connectionStartHandle === null || connectionStartHandle === void 0 ? void 0 : connectionStartHandle.type) === type\n    }]),\n    onMouseDown: onMouseDownHandler,\n    onClick: connectOnClick ? onClick : undefined,\n    ref: ref\n  }, rest), children);\n});\nHandle.displayName = 'Handle';\nvar Handle$1 = /*#__PURE__*/memo(Handle);\n\nvar DefaultNode = function DefaultNode(_ref) {\n  var data = _ref.data,\n      isConnectable = _ref.isConnectable,\n      _ref$targetPosition = _ref.targetPosition,\n      targetPosition = _ref$targetPosition === void 0 ? Position.Top : _ref$targetPosition,\n      _ref$sourcePosition = _ref.sourcePosition,\n      sourcePosition = _ref$sourcePosition === void 0 ? Position.Bottom : _ref$sourcePosition;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Handle$1, {\n    type: \"target\",\n    position: targetPosition,\n    isConnectable: isConnectable\n  }), data === null || data === void 0 ? void 0 : data.label, /*#__PURE__*/React.createElement(Handle$1, {\n    type: \"source\",\n    position: sourcePosition,\n    isConnectable: isConnectable\n  }));\n};\n\nDefaultNode.displayName = 'DefaultNode';\nvar DefaultNode$1 = /*#__PURE__*/memo(DefaultNode);\n\nvar InputNode = function InputNode(_ref) {\n  var data = _ref.data,\n      isConnectable = _ref.isConnectable,\n      _ref$sourcePosition = _ref.sourcePosition,\n      sourcePosition = _ref$sourcePosition === void 0 ? Position.Bottom : _ref$sourcePosition;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, data === null || data === void 0 ? void 0 : data.label, /*#__PURE__*/React.createElement(Handle$1, {\n    type: \"source\",\n    position: sourcePosition,\n    isConnectable: isConnectable\n  }));\n};\n\nInputNode.displayName = 'InputNode';\nvar InputNode$1 = /*#__PURE__*/memo(InputNode);\n\nvar OutputNode = function OutputNode(_ref) {\n  var data = _ref.data,\n      isConnectable = _ref.isConnectable,\n      _ref$targetPosition = _ref.targetPosition,\n      targetPosition = _ref$targetPosition === void 0 ? Position.Top : _ref$targetPosition;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Handle$1, {\n    type: \"target\",\n    position: targetPosition,\n    isConnectable: isConnectable\n  }), data === null || data === void 0 ? void 0 : data.label);\n};\n\nOutputNode.displayName = 'OutputNode';\nvar OutputNode$1 = /*#__PURE__*/memo(OutputNode);\n\nvar selector$9 = function selector(s) {\n  return {\n    selectedNodes: Array.from(s.nodeInternals.values()).filter(function (n) {\n      return n.selected;\n    }),\n    selectedEdges: s.edges.filter(function (e) {\n      return e.selected;\n    })\n  };\n};\n\nvar areEqual = function areEqual(objA, objB) {\n  var selectedNodeIdsA = objA.selectedNodes.map(function (n) {\n    return n.id;\n  });\n  var selectedNodeIdsB = objB.selectedNodes.map(function (n) {\n    return n.id;\n  });\n  var selectedEdgeIdsA = objA.selectedEdges.map(function (e) {\n    return e.id;\n  });\n  var selectedEdgeIdsB = objB.selectedEdges.map(function (e) {\n    return e.id;\n  });\n  return shallow(selectedNodeIdsA, selectedNodeIdsB) && shallow(selectedEdgeIdsA, selectedEdgeIdsB);\n}; // This is just a helper component for calling the onSelectionChange listener.\n// @TODO: Now that we have the onNodesChange and on EdgesChange listeners, do we still need this component?\n\n\nfunction SelectionListener(_ref) {\n  var onSelectionChange = _ref.onSelectionChange;\n\n  var _useStore = useStore(selector$9, areEqual),\n      selectedNodes = _useStore.selectedNodes,\n      selectedEdges = _useStore.selectedEdges;\n\n  useEffect(function () {\n    onSelectionChange({\n      nodes: selectedNodes,\n      edges: selectedEdges\n    });\n  }, [selectedNodes, selectedEdges]);\n  return null;\n}\n\nvar SelectionListener$1 = /*#__PURE__*/memo(SelectionListener);\n\nvar selector$8 = function selector(s) {\n  return {\n    setNodes: s.setNodes,\n    setEdges: s.setEdges,\n    setDefaultNodesAndEdges: s.setDefaultNodesAndEdges,\n    setMinZoom: s.setMinZoom,\n    setMaxZoom: s.setMaxZoom,\n    setTranslateExtent: s.setTranslateExtent,\n    setNodeExtent: s.setNodeExtent,\n    reset: s.reset\n  };\n};\n\nfunction useStoreUpdater(value, setStoreState) {\n  useEffect(function () {\n    if (typeof value !== 'undefined') {\n      setStoreState(value);\n    }\n  }, [value]);\n}\n\nfunction useDirectStoreUpdater(key, value, setState) {\n  useEffect(function () {\n    if (typeof value !== 'undefined') {\n      // @ts-ignore\n      setState(_defineProperty({}, key, value));\n    }\n  }, [value]);\n}\n\nvar StoreUpdater = function StoreUpdater(_ref) {\n  var nodes = _ref.nodes,\n      edges = _ref.edges,\n      defaultNodes = _ref.defaultNodes,\n      defaultEdges = _ref.defaultEdges,\n      onConnect = _ref.onConnect,\n      onConnectStart = _ref.onConnectStart,\n      onConnectStop = _ref.onConnectStop,\n      onConnectEnd = _ref.onConnectEnd,\n      onClickConnectStart = _ref.onClickConnectStart,\n      onClickConnectStop = _ref.onClickConnectStop,\n      onClickConnectEnd = _ref.onClickConnectEnd,\n      nodesDraggable = _ref.nodesDraggable,\n      nodesConnectable = _ref.nodesConnectable,\n      minZoom = _ref.minZoom,\n      maxZoom = _ref.maxZoom,\n      nodeExtent = _ref.nodeExtent,\n      onNodesChange = _ref.onNodesChange,\n      onEdgesChange = _ref.onEdgesChange,\n      elementsSelectable = _ref.elementsSelectable,\n      connectionMode = _ref.connectionMode,\n      snapGrid = _ref.snapGrid,\n      snapToGrid = _ref.snapToGrid,\n      translateExtent = _ref.translateExtent,\n      connectOnClick = _ref.connectOnClick,\n      defaultEdgeOptions = _ref.defaultEdgeOptions,\n      fitView = _ref.fitView,\n      fitViewOptions = _ref.fitViewOptions,\n      onNodesDelete = _ref.onNodesDelete,\n      onEdgesDelete = _ref.onEdgesDelete,\n      onNodeDrag = _ref.onNodeDrag,\n      onNodeDragStart = _ref.onNodeDragStart,\n      onNodeDragStop = _ref.onNodeDragStop,\n      onSelectionDrag = _ref.onSelectionDrag,\n      onSelectionDragStart = _ref.onSelectionDragStart,\n      onSelectionDragStop = _ref.onSelectionDragStop;\n\n  var _useStore = useStore(selector$8, shallow),\n      setNodes = _useStore.setNodes,\n      setEdges = _useStore.setEdges,\n      setDefaultNodesAndEdges = _useStore.setDefaultNodesAndEdges,\n      setMinZoom = _useStore.setMinZoom,\n      setMaxZoom = _useStore.setMaxZoom,\n      setTranslateExtent = _useStore.setTranslateExtent,\n      setNodeExtent = _useStore.setNodeExtent,\n      reset = _useStore.reset;\n\n  var store = useStoreApi();\n  useEffect(function () {\n    setDefaultNodesAndEdges(defaultNodes, defaultEdges);\n    return function () {\n      reset();\n    };\n  }, []);\n  useDirectStoreUpdater('defaultEdgeOptions', defaultEdgeOptions, store.setState);\n  useDirectStoreUpdater('connectionMode', connectionMode, store.setState);\n  useDirectStoreUpdater('onConnect', onConnect, store.setState);\n  useDirectStoreUpdater('onConnectStart', onConnectStart, store.setState);\n  useDirectStoreUpdater('onConnectStop', onConnectStop, store.setState);\n  useDirectStoreUpdater('onConnectEnd', onConnectEnd, store.setState);\n  useDirectStoreUpdater('onClickConnectStart', onClickConnectStart, store.setState);\n  useDirectStoreUpdater('onClickConnectStop', onClickConnectStop, store.setState);\n  useDirectStoreUpdater('onClickConnectEnd', onClickConnectEnd, store.setState);\n  useDirectStoreUpdater('nodesDraggable', nodesDraggable, store.setState);\n  useDirectStoreUpdater('nodesConnectable', nodesConnectable, store.setState);\n  useDirectStoreUpdater('elementsSelectable', elementsSelectable, store.setState);\n  useDirectStoreUpdater('snapToGrid', snapToGrid, store.setState);\n  useDirectStoreUpdater('snapGrid', snapGrid, store.setState);\n  useDirectStoreUpdater('onNodesChange', onNodesChange, store.setState);\n  useDirectStoreUpdater('onEdgesChange', onEdgesChange, store.setState);\n  useDirectStoreUpdater('connectOnClick', connectOnClick, store.setState);\n  useDirectStoreUpdater('fitViewOnInit', fitView, store.setState);\n  useDirectStoreUpdater('fitViewOnInitOptions', fitViewOptions, store.setState);\n  useDirectStoreUpdater('onNodesDelete', onNodesDelete, store.setState);\n  useDirectStoreUpdater('onEdgesDelete', onEdgesDelete, store.setState);\n  useDirectStoreUpdater('onNodeDrag', onNodeDrag, store.setState);\n  useDirectStoreUpdater('onNodeDragStart', onNodeDragStart, store.setState);\n  useDirectStoreUpdater('onNodeDragStop', onNodeDragStop, store.setState);\n  useDirectStoreUpdater('onSelectionDrag', onSelectionDrag, store.setState);\n  useDirectStoreUpdater('onSelectionDragStart', onSelectionDragStart, store.setState);\n  useDirectStoreUpdater('onSelectionDragStop', onSelectionDragStop, store.setState);\n  useStoreUpdater(nodes, setNodes);\n  useStoreUpdater(edges, setEdges);\n  useStoreUpdater(defaultNodes, setNodes);\n  useStoreUpdater(defaultEdges, setEdges);\n  useStoreUpdater(minZoom, setMinZoom);\n  useStoreUpdater(maxZoom, setMaxZoom);\n  useStoreUpdater(translateExtent, setTranslateExtent);\n  useStoreUpdater(nodeExtent, setNodeExtent);\n  return null;\n};\n\nvar css_248z$1 = \".react-flow{height:100%;overflow:hidden;position:relative;width:100%}.react-flow__container{height:100%;left:0;position:absolute;top:0;width:100%}.react-flow__pane{z-index:1}.react-flow__viewport{pointer-events:none;transform-origin:0 0;z-index:2}.react-flow__renderer{z-index:4}.react-flow__selectionpane{z-index:5}.react-flow .react-flow__edges{overflow:visible;pointer-events:none}.react-flow .react-flow__connectionline{z-index:1001}.react-flow__edge{pointer-events:visibleStroke}.react-flow__edge.inactive{pointer-events:none}@-webkit-keyframes dashdraw{0%{stroke-dashoffset:10}}@keyframes dashdraw{0%{stroke-dashoffset:10}}.react-flow__edge-path{fill:none}.react-flow__edge-textwrapper{pointer-events:all}.react-flow__edge-text{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.react-flow__connection{pointer-events:none}.react-flow__connection .animated{stroke-dasharray:5;-webkit-animation:dashdraw .5s linear infinite;animation:dashdraw .5s linear infinite}.react-flow__connection-path{fill:none}.react-flow__nodes{pointer-events:none;transform-origin:0 0}.react-flow__node{box-sizing:border-box;pointer-events:all;position:absolute;transform-origin:0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.react-flow__nodesselection{pointer-events:none;transform-origin:left top;z-index:3}.react-flow__nodesselection-rect{cursor:-webkit-grab;cursor:grab;pointer-events:all;position:absolute}.react-flow__handle{pointer-events:none;position:absolute}.react-flow__handle.connectable{pointer-events:all}.react-flow__handle-bottom{bottom:-4px;left:50%;top:auto;transform:translate(-50%)}.react-flow__handle-top{left:50%;top:-4px;transform:translate(-50%)}.react-flow__handle-left{left:-4px;top:50%;transform:translateY(-50%)}.react-flow__handle-right{right:-4px;top:50%;transform:translateY(-50%)}.react-flow__edgeupdater{cursor:move;pointer-events:all}.react-flow__controls{bottom:20px;left:15px;position:absolute;z-index:5}.react-flow__controls-button{border:none;height:24px;width:24px}.react-flow__controls-button svg{width:100%}.react-flow__minimap{bottom:20px;position:absolute;right:15px;z-index:5}.react-flow__attribution{background:hsla(0,0%,100%,.5);color:#999;font-size:10px;padding:2px 3px;position:absolute;z-index:1000}.react-flow__attribution a{color:#555;text-decoration:none}.react-flow__attribution.top{top:0}.react-flow__attribution.bottom{bottom:0}.react-flow__attribution.left{left:0}.react-flow__attribution.right{right:0}.react-flow__attribution.center{left:50%;transform:translateX(-50%)}\";\nvar css = css_248z$1;\n\nvar css_248z = \".react-flow__edge.selected .react-flow__edge-path{stroke:#555}.react-flow__edge.animated path{stroke-dasharray:5;-webkit-animation:dashdraw .5s linear infinite;animation:dashdraw .5s linear infinite}.react-flow__edge.updating .react-flow__edge-path{stroke:#777}.react-flow__edge-path{stroke:#b1b1b7;stroke-width:1}.react-flow__edge-text{font-size:10px}.react-flow__edge-textbg{fill:#fff}.react-flow__connection-path{stroke:#b1b1b7;stroke-width:1}.react-flow__node{cursor:-webkit-grab;cursor:grab}.react-flow__node-default,.react-flow__node-group,.react-flow__node-input,.react-flow__node-output{background:#fff;border:1px solid #1a192b;border-radius:3px;color:#222;font-size:12px;padding:10px;text-align:center;width:150px}.react-flow__node-default.selected,.react-flow__node-group.selected,.react-flow__node-input.selected,.react-flow__node-output.selected{box-shadow:0 0 0 .5px #1a192b}.react-flow__node-default .react-flow__handle,.react-flow__node-group .react-flow__handle,.react-flow__node-input .react-flow__handle,.react-flow__node-output .react-flow__handle{background:#1a192b}.react-flow__node-default.selectable:hover,.react-flow__node-group.selectable:hover,.react-flow__node-input.selectable:hover,.react-flow__node-output.selectable:hover{box-shadow:0 1px 4px 1px rgba(0,0,0,.08)}.react-flow__node-default.selectable.selected,.react-flow__node-group.selectable.selected,.react-flow__node-input.selectable.selected,.react-flow__node-output.selectable.selected{box-shadow:0 0 0 .5px #1a192b}.react-flow__node-group{background:hsla(0,0%,94%,.25);border-color:#1a192b}.react-flow__nodesselection-rect,.react-flow__selection{background:rgba(0,89,220,.08);border:1px dotted rgba(0,89,220,.8)}.react-flow__handle{background:#555;border:1px solid #fff;border-radius:100%;height:6px;width:6px}.react-flow__handle.connectable{cursor:crosshair}.react-flow__minimap{background-color:#fff}.react-flow__controls{box-shadow:0 0 2px 1px rgba(0,0,0,.08)}.react-flow__controls-button{align-items:center;background:#fefefe;border-bottom:1px solid #eee;box-sizing:content-box;cursor:pointer;display:flex;height:16px;justify-content:center;padding:5px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:16px}.react-flow__controls-button svg{max-height:12px;max-width:12px}.react-flow__controls-button:hover{background:#f4f4f4}\";\nvar theme = css_248z;\n\nvar shiftX = function shiftX(x, shift, position) {\n  if (position === Position.Left) return x - shift;\n  if (position === Position.Right) return x + shift;\n  return x;\n};\n\nvar shiftY = function shiftY(y, shift, position) {\n  if (position === Position.Top) return y - shift;\n  if (position === Position.Bottom) return y + shift;\n  return y;\n};\n\nvar EdgeAnchor = function EdgeAnchor(_ref) {\n  var className = _ref.className,\n      position = _ref.position,\n      centerX = _ref.centerX,\n      centerY = _ref.centerY,\n      _ref$radius = _ref.radius,\n      radius = _ref$radius === void 0 ? 10 : _ref$radius;\n  return /*#__PURE__*/React.createElement(\"circle\", {\n    className: cc(['react-flow__edgeupdater', className]),\n    cx: shiftX(centerX, radius, position),\n    cy: shiftY(centerY, radius, position),\n    r: radius,\n    stroke: \"transparent\",\n    fill: \"transparent\"\n  });\n};\n\nvar wrapEdge = (function (EdgeComponent) {\n  var EdgeWrapper = function EdgeWrapper(_ref) {\n    var id = _ref.id,\n        className = _ref.className,\n        type = _ref.type,\n        data = _ref.data,\n        onClick = _ref.onClick,\n        onEdgeDoubleClick = _ref.onEdgeDoubleClick,\n        selected = _ref.selected,\n        animated = _ref.animated,\n        label = _ref.label,\n        labelStyle = _ref.labelStyle,\n        labelShowBg = _ref.labelShowBg,\n        labelBgStyle = _ref.labelBgStyle,\n        labelBgPadding = _ref.labelBgPadding,\n        labelBgBorderRadius = _ref.labelBgBorderRadius,\n        style = _ref.style,\n        source = _ref.source,\n        target = _ref.target,\n        sourceX = _ref.sourceX,\n        sourceY = _ref.sourceY,\n        targetX = _ref.targetX,\n        targetY = _ref.targetY,\n        sourcePosition = _ref.sourcePosition,\n        targetPosition = _ref.targetPosition,\n        elementsSelectable = _ref.elementsSelectable,\n        hidden = _ref.hidden,\n        sourceHandleId = _ref.sourceHandleId,\n        targetHandleId = _ref.targetHandleId,\n        onContextMenu = _ref.onContextMenu,\n        onMouseEnter = _ref.onMouseEnter,\n        onMouseMove = _ref.onMouseMove,\n        onMouseLeave = _ref.onMouseLeave,\n        edgeUpdaterRadius = _ref.edgeUpdaterRadius,\n        onEdgeUpdate = _ref.onEdgeUpdate,\n        onEdgeUpdateStart = _ref.onEdgeUpdateStart,\n        onEdgeUpdateEnd = _ref.onEdgeUpdateEnd,\n        markerEnd = _ref.markerEnd,\n        markerStart = _ref.markerStart,\n        rfId = _ref.rfId;\n\n    var _useState = useState(false),\n        _useState2 = _slicedToArray(_useState, 2),\n        updating = _useState2[0],\n        setUpdating = _useState2[1];\n\n    var store = useStoreApi();\n\n    var onEdgeClick = function onEdgeClick(event) {\n      var _store$getState = store.getState(),\n          edges = _store$getState.edges,\n          addSelectedEdges = _store$getState.addSelectedEdges;\n\n      var edge = edges.find(function (e) {\n        return e.id === id;\n      });\n\n      if (elementsSelectable) {\n        store.setState({\n          nodesSelectionActive: false\n        });\n        addSelectedEdges([id]);\n      }\n\n      onClick === null || onClick === void 0 ? void 0 : onClick(event, edge);\n    };\n\n    var onEdgeDoubleClickHandler = getMouseHandler(id, store.getState, onEdgeDoubleClick);\n    var onEdgeContextMenu = getMouseHandler(id, store.getState, onContextMenu);\n    var onEdgeMouseEnter = getMouseHandler(id, store.getState, onMouseEnter);\n    var onEdgeMouseMove = getMouseHandler(id, store.getState, onMouseMove);\n    var onEdgeMouseLeave = getMouseHandler(id, store.getState, onMouseLeave);\n\n    var handleEdgeUpdater = function handleEdgeUpdater(event, isSourceHandle) {\n      var nodeId = isSourceHandle ? target : source;\n      var handleId = (isSourceHandle ? targetHandleId : sourceHandleId) || null;\n      var handleType = isSourceHandle ? 'target' : 'source';\n\n      var isValidConnection = function isValidConnection() {\n        return true;\n      };\n\n      var isTarget = isSourceHandle;\n      var edge = store.getState().edges.find(function (e) {\n        return e.id === id;\n      });\n      onEdgeUpdateStart === null || onEdgeUpdateStart === void 0 ? void 0 : onEdgeUpdateStart(event, edge, handleType);\n\n      var _onEdgeUpdateEnd = onEdgeUpdateEnd ? function (evt) {\n        return onEdgeUpdateEnd(evt, edge, handleType);\n      } : undefined;\n\n      var onConnectEdge = function onConnectEdge(connection) {\n        return onEdgeUpdate === null || onEdgeUpdate === void 0 ? void 0 : onEdgeUpdate(edge, connection);\n      };\n\n      handleMouseDown({\n        event: event,\n        handleId: handleId,\n        nodeId: nodeId,\n        onConnect: onConnectEdge,\n        isTarget: isTarget,\n        getState: store.getState,\n        setState: store.setState,\n        isValidConnection: isValidConnection,\n        elementEdgeUpdaterType: handleType,\n        onEdgeUpdateEnd: _onEdgeUpdateEnd\n      });\n    };\n\n    var onEdgeUpdaterSourceMouseDown = function onEdgeUpdaterSourceMouseDown(event) {\n      return handleEdgeUpdater(event, true);\n    };\n\n    var onEdgeUpdaterTargetMouseDown = function onEdgeUpdaterTargetMouseDown(event) {\n      return handleEdgeUpdater(event, false);\n    };\n\n    var onEdgeUpdaterMouseEnter = function onEdgeUpdaterMouseEnter() {\n      return setUpdating(true);\n    };\n\n    var onEdgeUpdaterMouseOut = function onEdgeUpdaterMouseOut() {\n      return setUpdating(false);\n    };\n\n    var markerStartUrl = useMemo(function () {\n      return \"url(#\".concat(getMarkerId(markerStart, rfId), \")\");\n    }, [markerStart, rfId]);\n    var markerEndUrl = useMemo(function () {\n      return \"url(#\".concat(getMarkerId(markerEnd, rfId), \")\");\n    }, [markerEnd, rfId]);\n\n    if (hidden) {\n      return null;\n    }\n\n    var inactive = !elementsSelectable && !onClick;\n    var handleEdgeUpdate = typeof onEdgeUpdate !== 'undefined';\n    var edgeClasses = cc(['react-flow__edge', \"react-flow__edge-\".concat(type), className, {\n      selected: selected,\n      animated: animated,\n      inactive: inactive,\n      updating: updating\n    }]);\n    return /*#__PURE__*/React.createElement(\"g\", {\n      className: edgeClasses,\n      onClick: onEdgeClick,\n      onDoubleClick: onEdgeDoubleClickHandler,\n      onContextMenu: onEdgeContextMenu,\n      onMouseEnter: onEdgeMouseEnter,\n      onMouseMove: onEdgeMouseMove,\n      onMouseLeave: onEdgeMouseLeave\n    }, /*#__PURE__*/React.createElement(EdgeComponent, {\n      id: id,\n      source: source,\n      target: target,\n      selected: selected,\n      animated: animated,\n      label: label,\n      labelStyle: labelStyle,\n      labelShowBg: labelShowBg,\n      labelBgStyle: labelBgStyle,\n      labelBgPadding: labelBgPadding,\n      labelBgBorderRadius: labelBgBorderRadius,\n      data: data,\n      style: style,\n      sourceX: sourceX,\n      sourceY: sourceY,\n      targetX: targetX,\n      targetY: targetY,\n      sourcePosition: sourcePosition,\n      targetPosition: targetPosition,\n      sourceHandleId: sourceHandleId,\n      targetHandleId: targetHandleId,\n      markerStart: markerStartUrl,\n      markerEnd: markerEndUrl,\n      \"data-testid\": \"rf__edge-\".concat(id)\n    }), handleEdgeUpdate && /*#__PURE__*/React.createElement(\"g\", {\n      onMouseDown: onEdgeUpdaterSourceMouseDown,\n      onMouseEnter: onEdgeUpdaterMouseEnter,\n      onMouseOut: onEdgeUpdaterMouseOut\n    }, /*#__PURE__*/React.createElement(EdgeAnchor, {\n      position: sourcePosition,\n      centerX: sourceX,\n      centerY: sourceY,\n      radius: edgeUpdaterRadius\n    })), handleEdgeUpdate && /*#__PURE__*/React.createElement(\"g\", {\n      onMouseDown: onEdgeUpdaterTargetMouseDown,\n      onMouseEnter: onEdgeUpdaterMouseEnter,\n      onMouseOut: onEdgeUpdaterMouseOut\n    }, /*#__PURE__*/React.createElement(EdgeAnchor, {\n      position: targetPosition,\n      centerX: targetX,\n      centerY: targetY,\n      radius: edgeUpdaterRadius\n    })));\n  };\n\n  EdgeWrapper.displayName = 'EdgeWrapper';\n  return /*#__PURE__*/memo(EdgeWrapper);\n});\n\nfunction ownKeys$8(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$8(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$8(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$8(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction createEdgeTypes(edgeTypes) {\n  var standardTypes = {\n    \"default\": wrapEdge(edgeTypes[\"default\"] || BezierEdge),\n    straight: wrapEdge(edgeTypes.bezier || StraightEdge),\n    step: wrapEdge(edgeTypes.step || StepEdge),\n    smoothstep: wrapEdge(edgeTypes.step || SmoothStepEdge),\n    simplebezier: wrapEdge(edgeTypes.simplebezier || SimpleBezierEdge)\n  };\n  var wrappedTypes = {};\n  var specialTypes = Object.keys(edgeTypes).filter(function (k) {\n    return !['default', 'bezier'].includes(k);\n  }).reduce(function (res, key) {\n    res[key] = wrapEdge(edgeTypes[key] || BezierEdge);\n    return res;\n  }, wrappedTypes);\n  return _objectSpread$8(_objectSpread$8({}, standardTypes), specialTypes);\n}\nfunction getHandlePosition(position, nodeRect) {\n  var handle = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  var x = ((handle === null || handle === void 0 ? void 0 : handle.x) || 0) + nodeRect.x;\n  var y = ((handle === null || handle === void 0 ? void 0 : handle.y) || 0) + nodeRect.y;\n  var width = (handle === null || handle === void 0 ? void 0 : handle.width) || nodeRect.width;\n  var height = (handle === null || handle === void 0 ? void 0 : handle.height) || nodeRect.height;\n\n  switch (position) {\n    case Position.Top:\n      return {\n        x: x + width / 2,\n        y: y\n      };\n\n    case Position.Right:\n      return {\n        x: x + width,\n        y: y + height / 2\n      };\n\n    case Position.Bottom:\n      return {\n        x: x + width / 2,\n        y: y + height\n      };\n\n    case Position.Left:\n      return {\n        x: x,\n        y: y + height / 2\n      };\n  }\n}\nfunction getHandle(bounds, handleId) {\n  if (!bounds) {\n    return null;\n  } // there is no handleId when there are no multiple handles/ handles with ids\n  // so we just pick the first one\n\n\n  var handle = null;\n\n  if (bounds.length === 1 || !handleId) {\n    handle = bounds[0];\n  } else if (handleId) {\n    handle = bounds.find(function (d) {\n      return d.id === handleId;\n    });\n  }\n\n  return typeof handle === 'undefined' ? null : handle;\n}\nvar getEdgePositions = function getEdgePositions(sourceNodeRect, sourceHandle, sourcePosition, targetNodeRect, targetHandle, targetPosition) {\n  var sourceHandlePos = getHandlePosition(sourcePosition, sourceNodeRect, sourceHandle);\n  var targetHandlePos = getHandlePosition(targetPosition, targetNodeRect, targetHandle);\n  return {\n    sourceX: sourceHandlePos.x,\n    sourceY: sourceHandlePos.y,\n    targetX: targetHandlePos.x,\n    targetY: targetHandlePos.y\n  };\n};\nfunction isEdgeVisible(_ref) {\n  var sourcePos = _ref.sourcePos,\n      targetPos = _ref.targetPos,\n      sourceWidth = _ref.sourceWidth,\n      sourceHeight = _ref.sourceHeight,\n      targetWidth = _ref.targetWidth,\n      targetHeight = _ref.targetHeight,\n      width = _ref.width,\n      height = _ref.height,\n      transform = _ref.transform;\n  var edgeBox = {\n    x: Math.min(sourcePos.x, targetPos.x),\n    y: Math.min(sourcePos.y, targetPos.y),\n    x2: Math.max(sourcePos.x + sourceWidth, targetPos.x + targetWidth),\n    y2: Math.max(sourcePos.y + sourceHeight, targetPos.y + targetHeight)\n  };\n\n  if (edgeBox.x === edgeBox.x2) {\n    edgeBox.x2 += 1;\n  }\n\n  if (edgeBox.y === edgeBox.y2) {\n    edgeBox.y2 += 1;\n  }\n\n  var viewBox = rectToBox({\n    x: (0 - transform[0]) / transform[2],\n    y: (0 - transform[1]) / transform[2],\n    width: width / transform[2],\n    height: height / transform[2]\n  });\n  var xOverlap = Math.max(0, Math.min(viewBox.x2, edgeBox.x2) - Math.max(viewBox.x, edgeBox.x));\n  var yOverlap = Math.max(0, Math.min(viewBox.y2, edgeBox.y2) - Math.max(viewBox.y, edgeBox.y));\n  var overlappingArea = Math.ceil(xOverlap * yOverlap);\n  return overlappingArea > 0;\n}\nfunction getNodeData(nodeInternals, nodeId) {\n  var _node$internalsSymbol, _node$positionAbsolut, _node$positionAbsolut2, _node$positionAbsolut3, _node$positionAbsolut4;\n\n  var node = nodeInternals.get(nodeId);\n  var handleBounds = (node === null || node === void 0 ? void 0 : (_node$internalsSymbol = node[internalsSymbol]) === null || _node$internalsSymbol === void 0 ? void 0 : _node$internalsSymbol.handleBounds) || null;\n  var isInvalid = !node || !handleBounds || !node.width || !node.height || typeof ((_node$positionAbsolut = node.positionAbsolute) === null || _node$positionAbsolut === void 0 ? void 0 : _node$positionAbsolut.x) === 'undefined' || typeof ((_node$positionAbsolut2 = node.positionAbsolute) === null || _node$positionAbsolut2 === void 0 ? void 0 : _node$positionAbsolut2.y) === 'undefined';\n  return [{\n    x: (node === null || node === void 0 ? void 0 : (_node$positionAbsolut3 = node.positionAbsolute) === null || _node$positionAbsolut3 === void 0 ? void 0 : _node$positionAbsolut3.x) || 0,\n    y: (node === null || node === void 0 ? void 0 : (_node$positionAbsolut4 = node.positionAbsolute) === null || _node$positionAbsolut4 === void 0 ? void 0 : _node$positionAbsolut4.y) || 0,\n    width: (node === null || node === void 0 ? void 0 : node.width) || 0,\n    height: (node === null || node === void 0 ? void 0 : node.height) || 0\n  }, handleBounds, !isInvalid];\n}\n\nvar doc = typeof document !== 'undefined' ? document : null; // the keycode can be a string 'a' or an array of strings ['a', 'a+d']\n// a string means a single key 'a' or a combination when '+' is used 'a+d'\n// an array means different possibilites. Explainer: ['a', 'd+s'] here the\n// user can use the single key 'a' or the combination 'd' + 's'\n\nvar useKeyPress = (function () {\n  var keyCode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n    target: doc\n  };\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      keyPressed = _useState2[0],\n      setKeyPressed = _useState2[1]; // we need to remember the pressed keys in order to support combinations\n\n\n  var pressedKeys = useRef(new Set([])); // keyCodes = array with single keys [['a']] or key combinations [['a', 's']]\n  // keysToWatch = array with all keys flattened ['a', 'd', 'ShiftLeft']\n  // used to check if we store event.code or event.key. When the code is in the list of keysToWatch\n  // we use the code otherwise the key. Explainer: When you press the left \"command\" key, the code is \"MetaLeft\"\n  // and the key is \"Meta\". We want users to be able to pass keys and codes so we assume that the key is meant when\n  // we can't find it in the list of keysToWatch.\n\n  var _useMemo = useMemo(function () {\n    if (keyCode !== null) {\n      var keyCodeArr = Array.isArray(keyCode) ? keyCode : [keyCode];\n      var keys = keyCodeArr.filter(function (kc) {\n        return typeof kc === 'string';\n      }).map(function (kc) {\n        return kc.split('+');\n      });\n      var keysFlat = keys.reduce(function (res, item) {\n        return res.concat.apply(res, _toConsumableArray(item));\n      }, []);\n      return [keys, keysFlat];\n    }\n\n    return [[], []];\n  }, [keyCode]),\n      _useMemo2 = _slicedToArray(_useMemo, 2),\n      keyCodes = _useMemo2[0],\n      keysToWatch = _useMemo2[1];\n\n  useEffect(function () {\n    if (keyCode !== null) {\n      var _options$target, _options$target2;\n\n      var downHandler = function downHandler(event) {\n        if (isInputDOMNode(event)) {\n          return false;\n        }\n\n        var keyOrCode = useKeyOrCode(event.code, keysToWatch);\n        pressedKeys.current.add(event[keyOrCode]);\n\n        if (isMatchingKey(keyCodes, pressedKeys.current, false)) {\n          event.preventDefault();\n          setKeyPressed(true);\n        }\n      };\n\n      var upHandler = function upHandler(event) {\n        if (isInputDOMNode(event)) {\n          return false;\n        }\n\n        var keyOrCode = useKeyOrCode(event.code, keysToWatch);\n\n        if (isMatchingKey(keyCodes, pressedKeys.current, true)) {\n          setKeyPressed(false);\n          pressedKeys.current.clear();\n        } else {\n          pressedKeys.current[\"delete\"](event[keyOrCode]);\n        }\n      };\n\n      var resetHandler = function resetHandler() {\n        pressedKeys.current.clear();\n        setKeyPressed(false);\n      };\n\n      options === null || options === void 0 ? void 0 : (_options$target = options.target) === null || _options$target === void 0 ? void 0 : _options$target.addEventListener('keydown', downHandler);\n      options === null || options === void 0 ? void 0 : (_options$target2 = options.target) === null || _options$target2 === void 0 ? void 0 : _options$target2.addEventListener('keyup', upHandler);\n      window.addEventListener('blur', resetHandler);\n      return function () {\n        var _options$target3, _options$target4;\n\n        options === null || options === void 0 ? void 0 : (_options$target3 = options.target) === null || _options$target3 === void 0 ? void 0 : _options$target3.removeEventListener('keydown', downHandler);\n        options === null || options === void 0 ? void 0 : (_options$target4 = options.target) === null || _options$target4 === void 0 ? void 0 : _options$target4.removeEventListener('keyup', upHandler);\n        window.removeEventListener('blur', resetHandler);\n      };\n    }\n  }, [keyCode, setKeyPressed]);\n  return keyPressed;\n}); // utils\n\nfunction isMatchingKey(keyCodes, pressedKeys, isUp) {\n  return keyCodes // we only want to compare same sizes of keyCode definitions\n  // and pressed keys. When the user specified 'Meta' as a key somewhere\n  // this would also be truthy without this filter when user presses 'Meta' + 'r'\n  .filter(function (keys) {\n    return isUp || keys.length === pressedKeys.size;\n  }) // since we want to support multiple possibilities only one of the\n  // combinations need to be part of the pressed keys\n  .some(function (keys) {\n    return keys.every(function (k) {\n      return pressedKeys.has(k);\n    });\n  });\n}\n\nfunction useKeyOrCode(eventCode, keysToWatch) {\n  return keysToWatch.includes(eventCode) ? 'code' : 'key';\n}\n\nfunction isInputDOMNode(event) {\n  var _event$composedPath;\n\n  // using composed path for handling shadow dom\n  var target = ((_event$composedPath = event.composedPath) === null || _event$composedPath === void 0 ? void 0 : _event$composedPath.call(event)[0]) || event.target;\n  return ['INPUT', 'SELECT', 'TEXTAREA'].includes(target === null || target === void 0 ? void 0 : target.nodeName) || (target === null || target === void 0 ? void 0 : target.hasAttribute('contenteditable'));\n}\n\nvar selector$7 = function selector(s) {\n  return {\n    onNodesChange: s.onNodesChange,\n    onEdgesChange: s.onEdgesChange\n  };\n};\n\nvar useGlobalKeyHandler = (function (_ref) {\n  var deleteKeyCode = _ref.deleteKeyCode,\n      multiSelectionKeyCode = _ref.multiSelectionKeyCode;\n  var store = useStoreApi();\n\n  var _useStore = useStore(selector$7, shallow),\n      onNodesChange = _useStore.onNodesChange,\n      onEdgesChange = _useStore.onEdgesChange;\n\n  var deleteKeyPressed = useKeyPress(deleteKeyCode);\n  var multiSelectionKeyPressed = useKeyPress(multiSelectionKeyCode);\n  useEffect(function () {\n    var _store$getState = store.getState(),\n        nodeInternals = _store$getState.nodeInternals,\n        edges = _store$getState.edges,\n        hasDefaultNodes = _store$getState.hasDefaultNodes,\n        hasDefaultEdges = _store$getState.hasDefaultEdges,\n        onNodesDelete = _store$getState.onNodesDelete,\n        onEdgesDelete = _store$getState.onEdgesDelete;\n\n    var nodes = Array.from(nodeInternals.values());\n    var nodesToRemove = nodes.reduce(function (res, node) {\n      if (!node.selected && node.parentNode && res.find(function (n) {\n        return n.id === node.parentNode;\n      })) {\n        res.push(node);\n      } else if (node.selected) {\n        res.push(node);\n      }\n\n      return res;\n    }, []);\n    var selectedEdges = edges.filter(function (e) {\n      return e.selected;\n    });\n\n    if (deleteKeyPressed && (nodesToRemove || selectedEdges)) {\n      var connectedEdges = getConnectedEdges(nodesToRemove, edges);\n      var edgesToRemove = [].concat(_toConsumableArray(selectedEdges), _toConsumableArray(connectedEdges));\n      var edgeIdsToRemove = edgesToRemove.reduce(function (res, edge) {\n        if (!res.includes(edge.id)) {\n          res.push(edge.id);\n        }\n\n        return res;\n      }, []);\n\n      if (hasDefaultEdges || hasDefaultNodes) {\n        if (hasDefaultEdges) {\n          store.setState({\n            edges: edges.filter(function (e) {\n              return !edgeIdsToRemove.includes(e.id);\n            })\n          });\n        }\n\n        if (hasDefaultNodes) {\n          nodesToRemove.forEach(function (node) {\n            nodeInternals[\"delete\"](node.id);\n          });\n          store.setState({\n            nodeInternals: new Map(nodeInternals)\n          });\n        }\n      }\n\n      if (edgeIdsToRemove.length > 0) {\n        onEdgesDelete === null || onEdgesDelete === void 0 ? void 0 : onEdgesDelete(edgesToRemove);\n\n        if (onEdgesChange) {\n          var edgeChanges = edgeIdsToRemove.map(function (id) {\n            return {\n              id: id,\n              type: 'remove'\n            };\n          });\n          onEdgesChange(edgeChanges);\n        }\n      }\n\n      if (nodesToRemove.length > 0) {\n        onNodesDelete === null || onNodesDelete === void 0 ? void 0 : onNodesDelete(nodesToRemove);\n\n        if (onNodesChange) {\n          var nodeChanges = nodesToRemove.map(function (n) {\n            return {\n              id: n.id,\n              type: 'remove'\n            };\n          });\n          onNodesChange(nodeChanges);\n        }\n      }\n\n      store.setState({\n        nodesSelectionActive: false\n      });\n    }\n  }, [deleteKeyPressed, onNodesChange, onEdgesChange]);\n  useEffect(function () {\n    store.setState({\n      multiSelectionActive: multiSelectionKeyPressed\n    });\n  }, [multiSelectionKeyPressed]);\n});\n\nfunction useResizeHandler(rendererNode) {\n  var store = useStoreApi();\n  useEffect(function () {\n    var resizeObserver;\n\n    var updateDimensions = function updateDimensions() {\n      if (!rendererNode.current) {\n        return;\n      }\n\n      var size = getDimensions(rendererNode.current); // @ts-ignore\n\n      if (process.env.NODE_ENV === 'development') {\n        if (size.height === 0 || size.width === 0) {\n          console.warn('[React Flow]: The React Flow parent container needs a width and a height to render the graph. Help: https://reactflow.dev/error#400');\n        }\n      }\n\n      store.setState({\n        width: size.width || 500,\n        height: size.height || 500\n      });\n    };\n\n    updateDimensions();\n    window.onresize = updateDimensions;\n\n    if (rendererNode.current) {\n      resizeObserver = new ResizeObserver(function () {\n        return updateDimensions();\n      });\n      resizeObserver.observe(rendererNode.current);\n    }\n\n    return function () {\n      window.onresize = null;\n\n      if (resizeObserver && rendererNode.current) {\n        resizeObserver.unobserve(rendererNode.current);\n      }\n    };\n  }, []);\n}\n\nvar viewChanged = function viewChanged(prevViewport, eventViewport) {\n  return prevViewport.x !== eventViewport.x || prevViewport.y !== eventViewport.y || prevViewport.zoom !== eventViewport.k;\n};\n\nvar eventToFlowTransform = function eventToFlowTransform(eventViewport) {\n  return {\n    x: eventViewport.x,\n    y: eventViewport.y,\n    zoom: eventViewport.k\n  };\n};\n\nvar isWrappedWithClass = function isWrappedWithClass(event, className) {\n  return event.target.closest(\".\".concat(className));\n};\n\nvar selector$6 = function selector(s) {\n  return {\n    d3Zoom: s.d3Zoom,\n    d3Selection: s.d3Selection,\n    d3ZoomHandler: s.d3ZoomHandler\n  };\n};\n\nvar ZoomPane = function ZoomPane(_ref) {\n  var onMove = _ref.onMove,\n      onMoveStart = _ref.onMoveStart,\n      onMoveEnd = _ref.onMoveEnd,\n      _ref$zoomOnScroll = _ref.zoomOnScroll,\n      zoomOnScroll = _ref$zoomOnScroll === void 0 ? true : _ref$zoomOnScroll,\n      _ref$zoomOnPinch = _ref.zoomOnPinch,\n      zoomOnPinch = _ref$zoomOnPinch === void 0 ? true : _ref$zoomOnPinch,\n      _ref$panOnScroll = _ref.panOnScroll,\n      panOnScroll = _ref$panOnScroll === void 0 ? false : _ref$panOnScroll,\n      _ref$panOnScrollSpeed = _ref.panOnScrollSpeed,\n      panOnScrollSpeed = _ref$panOnScrollSpeed === void 0 ? 0.5 : _ref$panOnScrollSpeed,\n      _ref$panOnScrollMode = _ref.panOnScrollMode,\n      panOnScrollMode = _ref$panOnScrollMode === void 0 ? PanOnScrollMode.Free : _ref$panOnScrollMode,\n      _ref$zoomOnDoubleClic = _ref.zoomOnDoubleClick,\n      zoomOnDoubleClick = _ref$zoomOnDoubleClic === void 0 ? true : _ref$zoomOnDoubleClic,\n      selectionKeyPressed = _ref.selectionKeyPressed,\n      elementsSelectable = _ref.elementsSelectable,\n      _ref$panOnDrag = _ref.panOnDrag,\n      panOnDrag = _ref$panOnDrag === void 0 ? true : _ref$panOnDrag,\n      translateExtent = _ref.translateExtent,\n      minZoom = _ref.minZoom,\n      maxZoom = _ref.maxZoom,\n      _ref$defaultZoom = _ref.defaultZoom,\n      defaultZoom = _ref$defaultZoom === void 0 ? 1 : _ref$defaultZoom,\n      _ref$defaultPosition = _ref.defaultPosition,\n      defaultPosition = _ref$defaultPosition === void 0 ? [0, 0] : _ref$defaultPosition,\n      zoomActivationKeyCode = _ref.zoomActivationKeyCode,\n      _ref$preventScrolling = _ref.preventScrolling,\n      preventScrolling = _ref$preventScrolling === void 0 ? true : _ref$preventScrolling,\n      children = _ref.children,\n      noWheelClassName = _ref.noWheelClassName,\n      noPanClassName = _ref.noPanClassName;\n  var store = useStoreApi();\n  var isZoomingOrPanning = useRef(false);\n  var zoomPane = useRef(null);\n  var prevTransform = useRef({\n    x: 0,\n    y: 0,\n    zoom: 0\n  });\n\n  var _useStore = useStore(selector$6, shallow),\n      d3Zoom = _useStore.d3Zoom,\n      d3Selection = _useStore.d3Selection,\n      d3ZoomHandler = _useStore.d3ZoomHandler;\n\n  var zoomActivationKeyPressed = useKeyPress(zoomActivationKeyCode);\n  useResizeHandler(zoomPane);\n  useEffect(function () {\n    if (zoomPane.current) {\n      var _selection$node;\n\n      var d3ZoomInstance = zoom().scaleExtent([minZoom, maxZoom]).translateExtent(translateExtent);\n      var selection = select(zoomPane.current).call(d3ZoomInstance);\n      var clampedX = clamp(defaultPosition[0], translateExtent[0][0], translateExtent[1][0]);\n      var clampedY = clamp(defaultPosition[1], translateExtent[0][1], translateExtent[1][1]);\n      var clampedZoom = clamp(defaultZoom, minZoom, maxZoom);\n      var updatedTransform = zoomIdentity.translate(clampedX, clampedY).scale(clampedZoom);\n      d3ZoomInstance.transform(selection, updatedTransform);\n      store.setState({\n        d3Zoom: d3ZoomInstance,\n        d3Selection: selection,\n        d3ZoomHandler: selection.on('wheel.zoom'),\n        // we need to pass transform because zoom handler is not registered when we set the initial transform\n        transform: [clampedX, clampedY, clampedZoom],\n        domNode: (_selection$node = selection.node()) === null || _selection$node === void 0 ? void 0 : _selection$node.closest('.react-flow')\n      });\n    }\n  }, []);\n  useEffect(function () {\n    if (d3Selection && d3Zoom) {\n      if (panOnScroll && !zoomActivationKeyPressed) {\n        d3Selection.on('wheel', function (event) {\n          if (isWrappedWithClass(event, noWheelClassName)) {\n            return false;\n          }\n\n          event.preventDefault();\n          event.stopImmediatePropagation();\n          var currentZoom = d3Selection.property('__zoom').k || 1;\n\n          if (event.ctrlKey && zoomOnPinch) {\n            var point = pointer(event); // taken from https://github.com/d3/d3-zoom/blob/master/src/zoom.js\n\n            var pinchDelta = -event.deltaY * (event.deltaMode === 1 ? 0.05 : event.deltaMode ? 1 : 0.002) * 10;\n\n            var _zoom = currentZoom * Math.pow(2, pinchDelta);\n\n            d3Zoom.scaleTo(d3Selection, _zoom, point);\n            return;\n          } // increase scroll speed in firefox\n          // firefox: deltaMode === 1; chrome: deltaMode === 0\n\n\n          var deltaNormalize = event.deltaMode === 1 ? 20 : 1;\n          var deltaX = panOnScrollMode === PanOnScrollMode.Vertical ? 0 : event.deltaX * deltaNormalize;\n          var deltaY = panOnScrollMode === PanOnScrollMode.Horizontal ? 0 : event.deltaY * deltaNormalize;\n          d3Zoom.translateBy(d3Selection, -(deltaX / currentZoom) * panOnScrollSpeed, -(deltaY / currentZoom) * panOnScrollSpeed);\n        }).on('wheel.zoom', null);\n      } else if (typeof d3ZoomHandler !== 'undefined') {\n        d3Selection.on('wheel', function (event) {\n          if (!preventScrolling || isWrappedWithClass(event, noWheelClassName)) {\n            return null;\n          }\n\n          event.preventDefault();\n        }).on('wheel.zoom', d3ZoomHandler);\n      }\n    }\n  }, [panOnScroll, panOnScrollMode, d3Selection, d3Zoom, d3ZoomHandler, zoomActivationKeyPressed, zoomOnPinch, preventScrolling, noWheelClassName]);\n  useEffect(function () {\n    if (d3Zoom) {\n      if (selectionKeyPressed && !isZoomingOrPanning.current) {\n        d3Zoom.on('zoom', null);\n      } else if (!selectionKeyPressed) {\n        d3Zoom.on('zoom', function (event) {\n          store.setState({\n            transform: [event.transform.x, event.transform.y, event.transform.k]\n          });\n\n          if (onMove) {\n            var flowTransform = eventToFlowTransform(event.transform);\n            onMove(event.sourceEvent, flowTransform);\n          }\n        });\n      }\n    }\n  }, [selectionKeyPressed, d3Zoom, onMove]);\n  useEffect(function () {\n    if (d3Zoom) {\n      d3Zoom.on('start', function (event) {\n        isZoomingOrPanning.current = true;\n\n        if (onMoveStart) {\n          var flowTransform = eventToFlowTransform(event.transform);\n          prevTransform.current = flowTransform;\n          onMoveStart(event.sourceEvent, flowTransform);\n        }\n      });\n    }\n  }, [d3Zoom, onMoveStart]);\n  useEffect(function () {\n    if (d3Zoom) {\n      d3Zoom.on('end', function (event) {\n        isZoomingOrPanning.current = false;\n\n        if (onMoveEnd && viewChanged(prevTransform.current, event.transform)) {\n          var flowTransform = eventToFlowTransform(event.transform);\n          prevTransform.current = flowTransform;\n          onMoveEnd(event.sourceEvent, flowTransform);\n        }\n      });\n    }\n  }, [d3Zoom, onMoveEnd]);\n  useEffect(function () {\n    if (d3Zoom) {\n      d3Zoom.filter(function (event) {\n        var zoomScroll = zoomActivationKeyPressed || zoomOnScroll;\n        var pinchZoom = zoomOnPinch && event.ctrlKey; // if all interactions are disabled, we prevent all zoom events\n\n        if (!panOnDrag && !zoomScroll && !panOnScroll && !zoomOnDoubleClick && !zoomOnPinch) {\n          return false;\n        } // during a selection we prevent all other interactions\n\n\n        if (selectionKeyPressed) {\n          return false;\n        } // if zoom on double click is disabled, we prevent the double click event\n\n\n        if (!zoomOnDoubleClick && event.type === 'dblclick') {\n          return false;\n        } // if the target element is inside an element with the nowheel class, we prevent zooming\n\n\n        if (isWrappedWithClass(event, noWheelClassName) && event.type === 'wheel') {\n          return false;\n        } // if the target element is inside an element with the nopan class, we prevent panning\n\n\n        if (isWrappedWithClass(event, noPanClassName) && event.type !== 'wheel') {\n          return false;\n        }\n\n        if (!zoomOnPinch && event.ctrlKey && event.type === 'wheel') {\n          return false;\n        } // when there is no scroll handling enabled, we prevent all wheel events\n\n\n        if (!zoomScroll && !panOnScroll && !pinchZoom && event.type === 'wheel') {\n          return false;\n        } // if the pane is not movable, we prevent dragging it with mousestart or touchstart\n\n\n        if (!panOnDrag && (event.type === 'mousedown' || event.type === 'touchstart')) {\n          return false;\n        } // default filter for d3-zoom\n\n\n        return (!event.ctrlKey || event.type === 'wheel') && !event.button;\n      });\n    }\n  }, [d3Zoom, zoomOnScroll, zoomOnPinch, panOnScroll, zoomOnDoubleClick, panOnDrag, selectionKeyPressed, elementsSelectable, zoomActivationKeyPressed]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"react-flow__renderer react-flow__container\",\n    ref: zoomPane\n  }, children);\n};\n\nfunction ownKeys$7(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$7(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$7(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$7(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction getMousePosition(event, containerBounds) {\n  return {\n    x: event.clientX - containerBounds.left,\n    y: event.clientY - containerBounds.top\n  };\n}\n\nvar selector$5 = function selector(s) {\n  return {\n    userSelectionActive: s.userSelectionActive,\n    elementsSelectable: s.elementsSelectable\n  };\n};\n\nvar initialRect = {\n  startX: 0,\n  startY: 0,\n  x: 0,\n  y: 0,\n  width: 0,\n  height: 0,\n  draw: false\n};\nvar UserSelection = /*#__PURE__*/memo(function (_ref) {\n  var selectionKeyPressed = _ref.selectionKeyPressed;\n  var store = useStoreApi();\n  var prevSelectedNodesCount = useRef(0);\n  var prevSelectedEdgesCount = useRef(0);\n  var containerBounds = useRef();\n\n  var _useState = useState(initialRect),\n      _useState2 = _slicedToArray(_useState, 2),\n      userSelectionRect = _useState2[0],\n      setUserSelectionRect = _useState2[1];\n\n  var _useStore = useStore(selector$5, shallow),\n      userSelectionActive = _useStore.userSelectionActive,\n      elementsSelectable = _useStore.elementsSelectable;\n\n  var renderUserSelectionPane = userSelectionActive || selectionKeyPressed;\n\n  if (!elementsSelectable || !renderUserSelectionPane) {\n    return null;\n  }\n\n  var resetUserSelection = function resetUserSelection() {\n    setUserSelectionRect(initialRect);\n    store.setState({\n      userSelectionActive: false\n    });\n    prevSelectedNodesCount.current = 0;\n    prevSelectedEdgesCount.current = 0;\n  };\n\n  var onMouseDown = function onMouseDown(event) {\n    var reactFlowNode = event.target.closest('.react-flow');\n    containerBounds.current = reactFlowNode.getBoundingClientRect();\n    var mousePos = getMousePosition(event, containerBounds.current);\n    setUserSelectionRect({\n      width: 0,\n      height: 0,\n      startX: mousePos.x,\n      startY: mousePos.y,\n      x: mousePos.x,\n      y: mousePos.y,\n      draw: true\n    });\n    store.setState({\n      userSelectionActive: true,\n      nodesSelectionActive: false\n    });\n  };\n\n  var onMouseMove = function onMouseMove(event) {\n    var _userSelectionRect$st, _userSelectionRect$st2;\n\n    if (!selectionKeyPressed || !userSelectionRect.draw || !containerBounds.current) {\n      return;\n    }\n\n    var mousePos = getMousePosition(event, containerBounds.current);\n    var startX = (_userSelectionRect$st = userSelectionRect.startX) !== null && _userSelectionRect$st !== void 0 ? _userSelectionRect$st : 0;\n    var startY = (_userSelectionRect$st2 = userSelectionRect.startY) !== null && _userSelectionRect$st2 !== void 0 ? _userSelectionRect$st2 : 0;\n\n    var nextUserSelectRect = _objectSpread$7(_objectSpread$7({}, userSelectionRect), {}, {\n      x: mousePos.x < startX ? mousePos.x : startX,\n      y: mousePos.y < startY ? mousePos.y : startY,\n      width: Math.abs(mousePos.x - startX),\n      height: Math.abs(mousePos.y - startY)\n    });\n\n    var _store$getState = store.getState(),\n        nodeInternals = _store$getState.nodeInternals,\n        edges = _store$getState.edges,\n        transform = _store$getState.transform,\n        onNodesChange = _store$getState.onNodesChange,\n        onEdgesChange = _store$getState.onEdgesChange;\n\n    var nodes = Array.from(nodeInternals.values());\n    var selectedNodes = getNodesInside(nodeInternals, nextUserSelectRect, transform, false, true);\n    var selectedEdgeIds = getConnectedEdges(selectedNodes, edges).map(function (e) {\n      return e.id;\n    });\n    var selectedNodeIds = selectedNodes.map(function (n) {\n      return n.id;\n    });\n\n    if (prevSelectedNodesCount.current !== selectedNodeIds.length) {\n      prevSelectedNodesCount.current = selectedNodeIds.length;\n      var changes = getSelectionChanges(nodes, selectedNodeIds);\n\n      if (changes.length) {\n        onNodesChange === null || onNodesChange === void 0 ? void 0 : onNodesChange(changes);\n      }\n    }\n\n    if (prevSelectedEdgesCount.current !== selectedEdgeIds.length) {\n      prevSelectedEdgesCount.current = selectedEdgeIds.length;\n\n      var _changes = getSelectionChanges(edges, selectedEdgeIds);\n\n      if (_changes.length) {\n        onEdgesChange === null || onEdgesChange === void 0 ? void 0 : onEdgesChange(_changes);\n      }\n    }\n\n    setUserSelectionRect(nextUserSelectRect);\n  };\n\n  var onMouseUp = function onMouseUp() {\n    store.setState({\n      nodesSelectionActive: prevSelectedNodesCount.current > 0\n    });\n    resetUserSelection();\n  };\n\n  var onMouseLeave = function onMouseLeave() {\n    store.setState({\n      nodesSelectionActive: false\n    });\n    resetUserSelection();\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"react-flow__selectionpane react-flow__container\",\n    onMouseDown: onMouseDown,\n    onMouseMove: onMouseMove,\n    onMouseUp: onMouseUp,\n    onMouseLeave: onMouseLeave\n  }, userSelectionRect.draw && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"react-flow__selection react-flow__container\",\n    style: {\n      width: userSelectionRect.width,\n      height: userSelectionRect.height,\n      transform: \"translate(\".concat(userSelectionRect.x, \"px, \").concat(userSelectionRect.y, \"px)\")\n    }\n  }));\n});\n\nfunction ownKeys$6(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$6(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$6(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$6(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction isParentSelected(node, nodeInternals) {\n  if (!node.parentNode) {\n    return false;\n  }\n\n  var parentNode = nodeInternals.get(node.parentNode);\n\n  if (!parentNode) {\n    return false;\n  }\n\n  if (parentNode.selected) {\n    return true;\n  }\n\n  return isParentSelected(parentNode, nodeInternals);\n}\nfunction hasSelector(target, selector, nodeRef) {\n  var current = target;\n\n  do {\n    var _current;\n\n    if ((_current = current) !== null && _current !== void 0 && _current.matches(selector)) return true;\n    if (current === nodeRef.current) return false;\n    current = current.parentElement;\n  } while (current);\n\n  return false;\n} // looks for all selected nodes and created a NodeDragItem for each of them\n\nfunction getDragItems(nodeInternals, mousePos, nodeId) {\n  return Array.from(nodeInternals.values()).filter(function (n) {\n    return (n.selected || n.id === nodeId) && (!n.parentNode || !isParentSelected(n, nodeInternals));\n  }).map(function (n) {\n    var _n$positionAbsolute$x, _n$positionAbsolute, _n$positionAbsolute$y, _n$positionAbsolute2;\n\n    return {\n      id: n.id,\n      position: n.position || {\n        x: 0,\n        y: 0\n      },\n      positionAbsolute: n.positionAbsolute || {\n        x: 0,\n        y: 0\n      },\n      distance: {\n        x: mousePos.x - ((_n$positionAbsolute$x = (_n$positionAbsolute = n.positionAbsolute) === null || _n$positionAbsolute === void 0 ? void 0 : _n$positionAbsolute.x) !== null && _n$positionAbsolute$x !== void 0 ? _n$positionAbsolute$x : 0),\n        y: mousePos.y - ((_n$positionAbsolute$y = (_n$positionAbsolute2 = n.positionAbsolute) === null || _n$positionAbsolute2 === void 0 ? void 0 : _n$positionAbsolute2.y) !== null && _n$positionAbsolute$y !== void 0 ? _n$positionAbsolute$y : 0)\n      },\n      delta: {\n        x: 0,\n        y: 0\n      },\n      extent: n.extent,\n      parentNode: n.parentNode,\n      width: n.width,\n      height: n.height\n    };\n  });\n}\nfunction updatePosition(dragItem, mousePos, snapToGrid, _ref, nodeInternals, nodeExtent) {\n  var _ref2 = _slicedToArray(_ref, 2),\n      snapX = _ref2[0],\n      snapY = _ref2[1];\n\n  var currentExtent = dragItem.extent || nodeExtent;\n  var nextPosition = {\n    x: mousePos.x - dragItem.distance.x,\n    y: mousePos.y - dragItem.distance.y\n  };\n\n  if (snapToGrid) {\n    nextPosition.x = snapX * Math.round(nextPosition.x / snapX);\n    nextPosition.y = snapY * Math.round(nextPosition.y / snapY);\n  }\n\n  if (dragItem.extent === 'parent') {\n    if (dragItem.parentNode && dragItem.width && dragItem.height) {\n      var parent = nodeInternals.get(dragItem.parentNode);\n      currentExtent = parent !== null && parent !== void 0 && parent.positionAbsolute && parent !== null && parent !== void 0 && parent.width && parent !== null && parent !== void 0 && parent.height ? [[parent.positionAbsolute.x, parent.positionAbsolute.y], [parent.positionAbsolute.x + parent.width - dragItem.width, parent.positionAbsolute.y + parent.height - dragItem.height]] : currentExtent;\n    } else {\n      // @ts-ignore\n      if (process.env.NODE_ENV === 'development') {\n        console.warn('[React Flow]: Only child nodes can use a parent extent. Help: https://reactflow.dev/error#500');\n      }\n\n      currentExtent = nodeExtent;\n    }\n  } else if (dragItem.extent && dragItem.parentNode) {\n    var _parent$positionAbsol, _parent$positionAbsol2, _parent$positionAbsol3, _parent$positionAbsol4;\n\n    var _parent = nodeInternals.get(dragItem.parentNode);\n\n    var parentX = (_parent$positionAbsol = _parent === null || _parent === void 0 ? void 0 : (_parent$positionAbsol2 = _parent.positionAbsolute) === null || _parent$positionAbsol2 === void 0 ? void 0 : _parent$positionAbsol2.x) !== null && _parent$positionAbsol !== void 0 ? _parent$positionAbsol : 0;\n    var parentY = (_parent$positionAbsol3 = _parent === null || _parent === void 0 ? void 0 : (_parent$positionAbsol4 = _parent.positionAbsolute) === null || _parent$positionAbsol4 === void 0 ? void 0 : _parent$positionAbsol4.y) !== null && _parent$positionAbsol3 !== void 0 ? _parent$positionAbsol3 : 0;\n    currentExtent = [[dragItem.extent[0][0] + parentX, dragItem.extent[0][1] + parentY], [dragItem.extent[1][0] + parentX, dragItem.extent[1][1] + parentY]];\n  }\n\n  var parentPosition = {\n    x: 0,\n    y: 0\n  };\n\n  if (dragItem.parentNode) {\n    var _parentNode$positionA, _parentNode$positionA2, _parentNode$positionA3, _parentNode$positionA4;\n\n    var parentNode = nodeInternals.get(dragItem.parentNode);\n    parentPosition = {\n      x: (_parentNode$positionA = parentNode === null || parentNode === void 0 ? void 0 : (_parentNode$positionA2 = parentNode.positionAbsolute) === null || _parentNode$positionA2 === void 0 ? void 0 : _parentNode$positionA2.x) !== null && _parentNode$positionA !== void 0 ? _parentNode$positionA : 0,\n      y: (_parentNode$positionA3 = parentNode === null || parentNode === void 0 ? void 0 : (_parentNode$positionA4 = parentNode.positionAbsolute) === null || _parentNode$positionA4 === void 0 ? void 0 : _parentNode$positionA4.y) !== null && _parentNode$positionA3 !== void 0 ? _parentNode$positionA3 : 0\n    };\n  }\n\n  dragItem.positionAbsolute = currentExtent ? clampPosition(nextPosition, currentExtent) : nextPosition;\n  dragItem.position = {\n    x: dragItem.positionAbsolute.x - parentPosition.x,\n    y: dragItem.positionAbsolute.y - parentPosition.y\n  };\n  return dragItem;\n} // returns two params:\n// 1. the dragged node (or the first of the list, if we are dragging a node selection)\n// 2. array of selected nodes (for multi selections)\n\nfunction getEventHandlerParams(_ref3) {\n  var nodeId = _ref3.nodeId,\n      dragItems = _ref3.dragItems,\n      nodeInternals = _ref3.nodeInternals;\n  var extentedDragItems = dragItems.map(function (n) {\n    var node = nodeInternals.get(n.id);\n    return _objectSpread$6(_objectSpread$6({}, node), {}, {\n      position: n.position,\n      positionAbsolute: n.positionAbsolute\n    });\n  });\n  return [nodeId ? extentedDragItems.find(function (n) {\n    return n.id === nodeId;\n  }) : extentedDragItems[0], extentedDragItems];\n}\n\nfunction wrapSelectionDragFunc(selectionFunc) {\n  return function (event, _, nodes) {\n    return selectionFunc === null || selectionFunc === void 0 ? void 0 : selectionFunc(event, nodes);\n  };\n}\n\nfunction useDrag(_ref) {\n  var nodeRef = _ref.nodeRef,\n      _ref$disabled = _ref.disabled,\n      disabled = _ref$disabled === void 0 ? false : _ref$disabled,\n      noDragClassName = _ref.noDragClassName,\n      handleSelector = _ref.handleSelector,\n      nodeId = _ref.nodeId,\n      isSelectable = _ref.isSelectable,\n      selectNodesOnDrag = _ref.selectNodesOnDrag;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      dragging = _useState2[0],\n      setDragging = _useState2[1];\n\n  var store = useStoreApi();\n  var dragItems = useRef();\n  var lastPos = useRef({\n    x: null,\n    y: null\n  }); // returns the pointer position projected to the RF coordinate system\n\n  var getPointerPosition = useCallback(function (_ref2) {\n    var sourceEvent = _ref2.sourceEvent;\n\n    var _store$getState = store.getState(),\n        transform = _store$getState.transform,\n        snapGrid = _store$getState.snapGrid,\n        snapToGrid = _store$getState.snapToGrid;\n\n    var x = sourceEvent.touches ? sourceEvent.touches[0].clientX : sourceEvent.clientX;\n    var y = sourceEvent.touches ? sourceEvent.touches[0].clientY : sourceEvent.clientY;\n    var pointerPos = pointToRendererPoint({\n      x: x,\n      y: y\n    }, transform, snapToGrid, snapGrid);\n    return pointerPos;\n  }, []);\n  useEffect(function () {\n    if (nodeRef !== null && nodeRef !== void 0 && nodeRef.current) {\n      var selection = select(nodeRef.current);\n\n      if (disabled) {\n        selection.on('.drag', null);\n      } else {\n        var dragHandler = drag().on('start', function (event) {\n          var _store$getState2 = store.getState(),\n              nodeInternals = _store$getState2.nodeInternals,\n              multiSelectionActive = _store$getState2.multiSelectionActive,\n              unselectNodesAndEdges = _store$getState2.unselectNodesAndEdges,\n              onNodeDragStart = _store$getState2.onNodeDragStart,\n              onSelectionDragStart = _store$getState2.onSelectionDragStart;\n\n          var onStart = nodeId ? onNodeDragStart : wrapSelectionDragFunc(onSelectionDragStart);\n\n          if (!selectNodesOnDrag && !multiSelectionActive && nodeId) {\n            var _nodeInternals$get;\n\n            if (!((_nodeInternals$get = nodeInternals.get(nodeId)) !== null && _nodeInternals$get !== void 0 && _nodeInternals$get.selected)) {\n              // we need to reset selected nodes when selectNodesOnDrag=false\n              unselectNodesAndEdges();\n            }\n          }\n\n          if (nodeId && isSelectable && selectNodesOnDrag) {\n            handleNodeClick({\n              id: nodeId,\n              store: store\n            });\n          }\n\n          var pointerPos = getPointerPosition(event);\n          lastPos.current = pointerPos;\n          dragItems.current = getDragItems(nodeInternals, pointerPos, nodeId);\n\n          if (onStart && dragItems.current) {\n            var _getEventHandlerParam = getEventHandlerParams({\n              nodeId: nodeId,\n              dragItems: dragItems.current,\n              nodeInternals: nodeInternals\n            }),\n                _getEventHandlerParam2 = _slicedToArray(_getEventHandlerParam, 2),\n                currentNode = _getEventHandlerParam2[0],\n                nodes = _getEventHandlerParam2[1];\n\n            onStart(event.sourceEvent, currentNode, nodes);\n          }\n        }).on('drag', function (event) {\n          var _store$getState3 = store.getState(),\n              updateNodePositions = _store$getState3.updateNodePositions,\n              snapToGrid = _store$getState3.snapToGrid,\n              snapGrid = _store$getState3.snapGrid,\n              nodeInternals = _store$getState3.nodeInternals,\n              nodeExtent = _store$getState3.nodeExtent,\n              onNodeDrag = _store$getState3.onNodeDrag,\n              onSelectionDrag = _store$getState3.onSelectionDrag;\n\n          var pointerPos = getPointerPosition(event); // skip events without movement\n\n          if ((lastPos.current.x !== pointerPos.x || lastPos.current.y !== pointerPos.y) && dragItems.current) {\n            lastPos.current = pointerPos;\n            dragItems.current = dragItems.current.map(function (n) {\n              return updatePosition(n, pointerPos, snapToGrid, snapGrid, nodeInternals, nodeExtent);\n            });\n            var onDrag = nodeId ? onNodeDrag : wrapSelectionDragFunc(onSelectionDrag);\n            updateNodePositions(dragItems.current, true, true);\n            setDragging(true);\n\n            if (onDrag) {\n              var _getEventHandlerParam3 = getEventHandlerParams({\n                nodeId: nodeId,\n                dragItems: dragItems.current,\n                nodeInternals: nodeInternals\n              }),\n                  _getEventHandlerParam4 = _slicedToArray(_getEventHandlerParam3, 2),\n                  currentNode = _getEventHandlerParam4[0],\n                  nodes = _getEventHandlerParam4[1];\n\n              onDrag(event.sourceEvent, currentNode, nodes);\n            }\n          }\n\n          event.on('end', function (event) {\n            setDragging(false);\n\n            if (dragItems.current) {\n              var _store$getState4 = store.getState(),\n                  _updateNodePositions = _store$getState4.updateNodePositions,\n                  _nodeInternals = _store$getState4.nodeInternals,\n                  onNodeDragStop = _store$getState4.onNodeDragStop,\n                  onSelectionDragStop = _store$getState4.onSelectionDragStop;\n\n              var onStop = nodeId ? onNodeDragStop : wrapSelectionDragFunc(onSelectionDragStop);\n\n              _updateNodePositions(dragItems.current, false, false);\n\n              if (onStop) {\n                var _getEventHandlerParam5 = getEventHandlerParams({\n                  nodeId: nodeId,\n                  dragItems: dragItems.current,\n                  nodeInternals: _nodeInternals\n                }),\n                    _getEventHandlerParam6 = _slicedToArray(_getEventHandlerParam5, 2),\n                    _currentNode = _getEventHandlerParam6[0],\n                    _nodes = _getEventHandlerParam6[1];\n\n                onStop(event.sourceEvent, _currentNode, _nodes);\n              }\n            }\n          });\n        }).filter(function (event) {\n          var target = event.target;\n          var isDraggable = !event.button && (!noDragClassName || !hasSelector(target, \".\".concat(noDragClassName), nodeRef)) && (!handleSelector || hasSelector(target, handleSelector, nodeRef));\n          return isDraggable;\n        });\n        selection.call(dragHandler);\n        return function () {\n          selection.on('.drag', null);\n        };\n      }\n    }\n  }, [nodeRef, disabled, noDragClassName, handleSelector, isSelectable, store, nodeId, selectNodesOnDrag, getPointerPosition]);\n  return dragging;\n}\n\nfunction ownKeys$5(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$5(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$5(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$5(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar selector$4 = function selector(s) {\n  return _objectSpread$5({\n    transformString: \"translate(\".concat(s.transform[0], \"px,\").concat(s.transform[1], \"px) scale(\").concat(s.transform[2], \")\"),\n    userSelectionActive: s.userSelectionActive\n  }, getRectOfNodes(Array.from(s.nodeInternals.values()).filter(function (n) {\n    return n.selected;\n  })));\n};\n\nvar bboxSelector = function bboxSelector(s) {\n  var selectedNodes = Array.from(s.nodeInternals.values()).filter(function (n) {\n    return n.selected;\n  });\n  return getRectOfNodes(selectedNodes);\n};\n\nfunction NodesSelection(_ref) {\n  var onSelectionContextMenu = _ref.onSelectionContextMenu,\n      noPanClassName = _ref.noPanClassName;\n  var store = useStoreApi();\n\n  var _useStore = useStore(selector$4, shallow),\n      transformString = _useStore.transformString,\n      userSelectionActive = _useStore.userSelectionActive;\n\n  var _useStore2 = useStore(bboxSelector, shallow),\n      width = _useStore2.width,\n      height = _useStore2.height,\n      left = _useStore2.x,\n      top = _useStore2.y;\n\n  var nodeRef = useRef(null);\n  useDrag({\n    nodeRef: nodeRef\n  });\n\n  if (userSelectionActive || !width || !height) {\n    return null;\n  }\n\n  var onContextMenu = onSelectionContextMenu ? function (event) {\n    var selectedNodes = Array.from(store.getState().nodeInternals.values()).filter(function (n) {\n      return n.selected;\n    });\n    onSelectionContextMenu(event, selectedNodes);\n  } : undefined;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: cc(['react-flow__nodesselection', 'react-flow__container', noPanClassName]),\n    style: {\n      transform: transformString\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: nodeRef,\n    className: \"react-flow__nodesselection-rect\",\n    onContextMenu: onContextMenu,\n    style: {\n      width: width,\n      height: height,\n      top: top,\n      left: left\n    }\n  }));\n}\n\nvar NodesSelection$1 = /*#__PURE__*/memo(NodesSelection);\n\nvar selector$3 = function selector(s) {\n  return s.nodesSelectionActive;\n};\n\nvar FlowRenderer = function FlowRenderer(_ref) {\n  var children = _ref.children,\n      onPaneClick = _ref.onPaneClick,\n      onPaneContextMenu = _ref.onPaneContextMenu,\n      onPaneScroll = _ref.onPaneScroll,\n      deleteKeyCode = _ref.deleteKeyCode,\n      onMove = _ref.onMove,\n      onMoveStart = _ref.onMoveStart,\n      onMoveEnd = _ref.onMoveEnd,\n      selectionKeyCode = _ref.selectionKeyCode,\n      multiSelectionKeyCode = _ref.multiSelectionKeyCode,\n      zoomActivationKeyCode = _ref.zoomActivationKeyCode,\n      elementsSelectable = _ref.elementsSelectable,\n      zoomOnScroll = _ref.zoomOnScroll,\n      zoomOnPinch = _ref.zoomOnPinch,\n      panOnScroll = _ref.panOnScroll,\n      panOnScrollSpeed = _ref.panOnScrollSpeed,\n      panOnScrollMode = _ref.panOnScrollMode,\n      zoomOnDoubleClick = _ref.zoomOnDoubleClick,\n      panOnDrag = _ref.panOnDrag,\n      translateExtent = _ref.translateExtent,\n      minZoom = _ref.minZoom,\n      maxZoom = _ref.maxZoom,\n      defaultZoom = _ref.defaultZoom,\n      defaultPosition = _ref.defaultPosition,\n      preventScrolling = _ref.preventScrolling,\n      onSelectionContextMenu = _ref.onSelectionContextMenu,\n      noWheelClassName = _ref.noWheelClassName,\n      noPanClassName = _ref.noPanClassName;\n  var store = useStoreApi();\n  var nodesSelectionActive = useStore(selector$3);\n  var selectionKeyPressed = useKeyPress(selectionKeyCode);\n  useGlobalKeyHandler({\n    deleteKeyCode: deleteKeyCode,\n    multiSelectionKeyCode: multiSelectionKeyCode\n  });\n\n  var onClick = function onClick(event) {\n    onPaneClick === null || onPaneClick === void 0 ? void 0 : onPaneClick(event);\n    store.getState().resetSelectedElements();\n    store.setState({\n      nodesSelectionActive: false\n    });\n  };\n\n  var onContextMenu = onPaneContextMenu ? function (event) {\n    return onPaneContextMenu(event);\n  } : undefined;\n  var onWheel = onPaneScroll ? function (event) {\n    return onPaneScroll(event);\n  } : undefined;\n  return /*#__PURE__*/React.createElement(ZoomPane, {\n    onMove: onMove,\n    onMoveStart: onMoveStart,\n    onMoveEnd: onMoveEnd,\n    selectionKeyPressed: selectionKeyPressed,\n    elementsSelectable: elementsSelectable,\n    zoomOnScroll: zoomOnScroll,\n    zoomOnPinch: zoomOnPinch,\n    panOnScroll: panOnScroll,\n    panOnScrollSpeed: panOnScrollSpeed,\n    panOnScrollMode: panOnScrollMode,\n    zoomOnDoubleClick: zoomOnDoubleClick,\n    panOnDrag: panOnDrag,\n    translateExtent: translateExtent,\n    minZoom: minZoom,\n    maxZoom: maxZoom,\n    defaultZoom: defaultZoom,\n    defaultPosition: defaultPosition,\n    zoomActivationKeyCode: zoomActivationKeyCode,\n    preventScrolling: preventScrolling,\n    noWheelClassName: noWheelClassName,\n    noPanClassName: noPanClassName\n  }, children, /*#__PURE__*/React.createElement(UserSelection, {\n    selectionKeyPressed: selectionKeyPressed\n  }), nodesSelectionActive && /*#__PURE__*/React.createElement(NodesSelection$1, {\n    onSelectionContextMenu: onSelectionContextMenu,\n    noPanClassName: noPanClassName\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"react-flow__pane react-flow__container\",\n    onClick: onClick,\n    onContextMenu: onContextMenu,\n    onWheel: onWheel\n  }));\n};\n\nFlowRenderer.displayName = 'FlowRenderer';\nvar FlowRenderer$1 = /*#__PURE__*/memo(FlowRenderer);\n\nfunction useVisibleNodes(onlyRenderVisible) {\n  var nodes = useStore(useCallback(function (s) {\n    return onlyRenderVisible ? getNodesInside(s.nodeInternals, {\n      x: 0,\n      y: 0,\n      width: s.width,\n      height: s.height\n    }, s.transform, true) : Array.from(s.nodeInternals.values());\n  }, [onlyRenderVisible]));\n  return nodes;\n}\n\nvar selector$2 = function selector(s) {\n  return {\n    nodesDraggable: s.nodesDraggable,\n    nodesConnectable: s.nodesConnectable,\n    elementsSelectable: s.elementsSelectable,\n    updateNodeDimensions: s.updateNodeDimensions\n  };\n};\n\nvar NodeRenderer = function NodeRenderer(props) {\n  var _useStore = useStore(selector$2, shallow),\n      nodesDraggable = _useStore.nodesDraggable,\n      nodesConnectable = _useStore.nodesConnectable,\n      elementsSelectable = _useStore.elementsSelectable,\n      updateNodeDimensions = _useStore.updateNodeDimensions;\n\n  var nodes = useVisibleNodes(props.onlyRenderVisibleElements);\n  var resizeObserverRef = useRef();\n  var resizeObserver = useMemo(function () {\n    if (typeof ResizeObserver === 'undefined') {\n      return null;\n    }\n\n    var observer = new ResizeObserver(function (entries) {\n      var updates = entries.map(function (entry) {\n        return {\n          id: entry.target.getAttribute('data-id'),\n          nodeElement: entry.target,\n          forceUpdate: true\n        };\n      });\n      updateNodeDimensions(updates);\n    });\n    resizeObserverRef.current = observer;\n    return observer;\n  }, []);\n  useEffect(function () {\n    return function () {\n      var _resizeObserverRef$cu;\n\n      resizeObserverRef === null || resizeObserverRef === void 0 ? void 0 : (_resizeObserverRef$cu = resizeObserverRef.current) === null || _resizeObserverRef$cu === void 0 ? void 0 : _resizeObserverRef$cu.disconnect();\n    };\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"react-flow__nodes react-flow__container\"\n  }, nodes.map(function (node) {\n    var _node$positionAbsolut, _node$positionAbsolut2, _node$positionAbsolut3, _node$positionAbsolut4, _node$internalsSymbol, _node$internalsSymbol2, _node$internalsSymbol3;\n\n    var nodeType = node.type || 'default';\n\n    if (!props.nodeTypes[nodeType]) {\n      // @ts-ignore\n      if (process.env.NODE_ENV === 'development') {\n        console.warn(\"[React Flow]: Node type \\\"\".concat(nodeType, \"\\\" not found. Using fallback type \\\"default\\\". Help: https://reactflow.dev/error#300\"));\n      }\n\n      nodeType = 'default';\n    }\n\n    var NodeComponent = props.nodeTypes[nodeType] || props.nodeTypes[\"default\"];\n    var isDraggable = !!(node.draggable || nodesDraggable && typeof node.draggable === 'undefined');\n    var isSelectable = !!(node.selectable || elementsSelectable && typeof node.selectable === 'undefined');\n    var isConnectable = !!(node.connectable || nodesConnectable && typeof node.connectable === 'undefined');\n    return /*#__PURE__*/React.createElement(NodeComponent, {\n      key: node.id,\n      id: node.id,\n      className: node.className,\n      style: node.style,\n      type: nodeType,\n      data: node.data,\n      sourcePosition: node.sourcePosition || Position.Bottom,\n      targetPosition: node.targetPosition || Position.Top,\n      hidden: node.hidden,\n      xPos: (_node$positionAbsolut = (_node$positionAbsolut2 = node.positionAbsolute) === null || _node$positionAbsolut2 === void 0 ? void 0 : _node$positionAbsolut2.x) !== null && _node$positionAbsolut !== void 0 ? _node$positionAbsolut : 0,\n      yPos: (_node$positionAbsolut3 = (_node$positionAbsolut4 = node.positionAbsolute) === null || _node$positionAbsolut4 === void 0 ? void 0 : _node$positionAbsolut4.y) !== null && _node$positionAbsolut3 !== void 0 ? _node$positionAbsolut3 : 0,\n      selectNodesOnDrag: props.selectNodesOnDrag,\n      onClick: props.onNodeClick,\n      onMouseEnter: props.onNodeMouseEnter,\n      onMouseMove: props.onNodeMouseMove,\n      onMouseLeave: props.onNodeMouseLeave,\n      onContextMenu: props.onNodeContextMenu,\n      onDoubleClick: props.onNodeDoubleClick,\n      selected: !!node.selected,\n      isDraggable: isDraggable,\n      isSelectable: isSelectable,\n      isConnectable: isConnectable,\n      resizeObserver: resizeObserver,\n      dragHandle: node.dragHandle,\n      zIndex: (_node$internalsSymbol = (_node$internalsSymbol2 = node[internalsSymbol]) === null || _node$internalsSymbol2 === void 0 ? void 0 : _node$internalsSymbol2.z) !== null && _node$internalsSymbol !== void 0 ? _node$internalsSymbol : 0,\n      isParent: !!((_node$internalsSymbol3 = node[internalsSymbol]) !== null && _node$internalsSymbol3 !== void 0 && _node$internalsSymbol3.isParent),\n      noDragClassName: props.noDragClassName,\n      noPanClassName: props.noPanClassName,\n      initialized: !!node.width && !!node.height\n    });\n  }));\n};\n\nNodeRenderer.displayName = 'NodeRenderer';\nvar NodeRenderer$1 = /*#__PURE__*/memo(NodeRenderer);\n\nvar _oppositePosition;\n\nfunction ownKeys$4(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$4(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$4(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$4(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nvar oppositePosition = (_oppositePosition = {}, _defineProperty(_oppositePosition, Position.Left, Position.Right), _defineProperty(_oppositePosition, Position.Right, Position.Left), _defineProperty(_oppositePosition, Position.Top, Position.Bottom), _defineProperty(_oppositePosition, Position.Bottom, Position.Top), _oppositePosition);\nvar ConnectionLine = (function (_ref) {\n  var _fromNode$internalsSy, _fromNode$width, _fromNode$height, _fromNode$positionAbs, _fromNode$positionAbs2;\n\n  var connectionNodeId = _ref.connectionNodeId,\n      connectionHandleType = _ref.connectionHandleType,\n      connectionLineStyle = _ref.connectionLineStyle,\n      _ref$connectionLineTy = _ref.connectionLineType,\n      connectionLineType = _ref$connectionLineTy === void 0 ? ConnectionLineType.Bezier : _ref$connectionLineTy,\n      isConnectable = _ref.isConnectable,\n      CustomConnectionLineComponent = _ref.CustomConnectionLineComponent;\n\n  var _useStore = useStore(useCallback(function (s) {\n    return {\n      fromNode: s.nodeInternals.get(connectionNodeId),\n      handleId: s.connectionHandleId,\n      toX: (s.connectionPosition.x - s.transform[0]) / s.transform[2],\n      toY: (s.connectionPosition.y - s.transform[1]) / s.transform[2]\n    };\n  }, [connectionNodeId]), shallow),\n      fromNode = _useStore.fromNode,\n      handleId = _useStore.handleId,\n      toX = _useStore.toX,\n      toY = _useStore.toY;\n\n  var fromHandleBounds = fromNode === null || fromNode === void 0 ? void 0 : (_fromNode$internalsSy = fromNode[internalsSymbol]) === null || _fromNode$internalsSy === void 0 ? void 0 : _fromNode$internalsSy.handleBounds;\n\n  if (!fromNode || !isConnectable || !(fromHandleBounds !== null && fromHandleBounds !== void 0 && fromHandleBounds[connectionHandleType])) {\n    return null;\n  }\n\n  var handleBound = fromHandleBounds[connectionHandleType];\n  var fromHandle = handleId ? handleBound.find(function (d) {\n    return d.id === handleId;\n  }) : handleBound[0];\n  var fromHandleX = fromHandle ? fromHandle.x + fromHandle.width / 2 : ((_fromNode$width = fromNode === null || fromNode === void 0 ? void 0 : fromNode.width) !== null && _fromNode$width !== void 0 ? _fromNode$width : 0) / 2;\n  var fromHandleY = fromHandle ? fromHandle.y + fromHandle.height / 2 : (_fromNode$height = fromNode === null || fromNode === void 0 ? void 0 : fromNode.height) !== null && _fromNode$height !== void 0 ? _fromNode$height : 0;\n  var fromX = ((fromNode === null || fromNode === void 0 ? void 0 : (_fromNode$positionAbs = fromNode.positionAbsolute) === null || _fromNode$positionAbs === void 0 ? void 0 : _fromNode$positionAbs.x) || 0) + fromHandleX;\n  var fromY = ((fromNode === null || fromNode === void 0 ? void 0 : (_fromNode$positionAbs2 = fromNode.positionAbsolute) === null || _fromNode$positionAbs2 === void 0 ? void 0 : _fromNode$positionAbs2.y) || 0) + fromHandleY;\n  var fromPosition = fromHandle === null || fromHandle === void 0 ? void 0 : fromHandle.position;\n\n  if (!fromPosition) {\n    return null;\n  }\n\n  var toPosition = oppositePosition[fromPosition];\n  var sourceX, sourceY, sourcePosition, targetX, targetY, targetPosition;\n\n  switch (connectionHandleType) {\n    case 'source':\n      {\n        sourceX = fromX;\n        sourceY = fromY;\n        sourcePosition = fromPosition;\n        targetX = toX;\n        targetY = toY;\n        targetPosition = toPosition;\n      }\n      break;\n\n    case 'target':\n      {\n        sourceX = toX;\n        sourceY = toY;\n        sourcePosition = toPosition;\n        targetX = fromX;\n        targetY = fromY;\n        targetPosition = fromPosition;\n      }\n      break;\n  }\n\n  if (CustomConnectionLineComponent) {\n    return /*#__PURE__*/React.createElement(\"g\", {\n      className: \"react-flow__connection\"\n    }, /*#__PURE__*/React.createElement(CustomConnectionLineComponent, {\n      connectionLineType: connectionLineType,\n      connectionLineStyle: connectionLineStyle,\n      fromNode: fromNode,\n      fromHandle: fromHandle,\n      fromX: fromX,\n      fromY: fromY,\n      toX: toX,\n      toY: toY,\n      fromPosition: fromPosition,\n      toPosition: toPosition,\n      // remove in v11\n      sourcePosition: sourcePosition,\n      targetPosition: targetPosition,\n      sourceNode: fromNode,\n      sourceHandle: fromHandle,\n      targetX: targetX,\n      targetY: targetY,\n      sourceX: sourceX,\n      sourceY: sourceY\n    }));\n  }\n\n  var dAttr = '';\n  var pathParams = {\n    sourceX: sourceX,\n    sourceY: sourceY,\n    sourcePosition: sourcePosition,\n    targetX: targetX,\n    targetY: targetY,\n    targetPosition: targetPosition\n  };\n\n  if (connectionLineType === ConnectionLineType.Bezier) {\n    // we assume the destination position is opposite to the source position\n    dAttr = getBezierPath(pathParams);\n  } else if (connectionLineType === ConnectionLineType.Step) {\n    dAttr = getSmoothStepPath(_objectSpread$4(_objectSpread$4({}, pathParams), {}, {\n      borderRadius: 0\n    }));\n  } else if (connectionLineType === ConnectionLineType.SmoothStep) {\n    dAttr = getSmoothStepPath(pathParams);\n  } else if (connectionLineType === ConnectionLineType.SimpleBezier) {\n    dAttr = getSimpleBezierPath(pathParams);\n  } else {\n    dAttr = \"M\".concat(sourceX, \",\").concat(sourceY, \" \").concat(targetX, \",\").concat(targetY);\n  }\n\n  return /*#__PURE__*/React.createElement(\"g\", {\n    className: \"react-flow__connection\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: dAttr,\n    className: \"react-flow__connection-path\",\n    style: connectionLineStyle\n  }));\n});\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n\nvar _MarkerSymbols;\n\nvar ArrowSymbol = function ArrowSymbol(_ref) {\n  var _ref$color = _ref.color,\n      color = _ref$color === void 0 ? 'none' : _ref$color,\n      _ref$strokeWidth = _ref.strokeWidth,\n      strokeWidth = _ref$strokeWidth === void 0 ? 1 : _ref$strokeWidth;\n  return /*#__PURE__*/React.createElement(\"polyline\", {\n    stroke: color,\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    strokeWidth: strokeWidth,\n    fill: \"none\",\n    points: \"-5,-4 0,0 -5,4\"\n  });\n};\n\nvar ArrowClosedSymbol = function ArrowClosedSymbol(_ref2) {\n  var _ref2$color = _ref2.color,\n      color = _ref2$color === void 0 ? 'none' : _ref2$color,\n      _ref2$strokeWidth = _ref2.strokeWidth,\n      strokeWidth = _ref2$strokeWidth === void 0 ? 1 : _ref2$strokeWidth;\n  return /*#__PURE__*/React.createElement(\"polyline\", {\n    stroke: color,\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    strokeWidth: strokeWidth,\n    fill: color,\n    points: \"-5,-4 0,0 -5,4 -5,-4\"\n  });\n};\n\nvar MarkerSymbols = (_MarkerSymbols = {}, _defineProperty(_MarkerSymbols, MarkerType.Arrow, ArrowSymbol), _defineProperty(_MarkerSymbols, MarkerType.ArrowClosed, ArrowClosedSymbol), _MarkerSymbols);\nfunction useMarkerSymbol(type) {\n  var symbol = useMemo(function () {\n    var symbolExists = MarkerSymbols.hasOwnProperty(type);\n\n    if (!symbolExists) {\n      // @ts-ignore\n      if (process.env.NODE_ENV === 'development') {\n        console.warn(\"[React Flow]: Marker type \\\"\".concat(type, \"\\\" doesn't exist. Help: https://reactflow.dev/error#900\"));\n      }\n\n      return function () {\n        return null;\n      };\n    }\n\n    return MarkerSymbols[type];\n  }, [type]);\n  return symbol;\n}\n\nfunction ownKeys$3(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$3(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$3(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$3(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar Marker = function Marker(_ref) {\n  var id = _ref.id,\n      type = _ref.type,\n      color = _ref.color,\n      _ref$width = _ref.width,\n      width = _ref$width === void 0 ? 12.5 : _ref$width,\n      _ref$height = _ref.height,\n      height = _ref$height === void 0 ? 12.5 : _ref$height,\n      _ref$markerUnits = _ref.markerUnits,\n      markerUnits = _ref$markerUnits === void 0 ? 'strokeWidth' : _ref$markerUnits,\n      strokeWidth = _ref.strokeWidth,\n      _ref$orient = _ref.orient,\n      orient = _ref$orient === void 0 ? 'auto' : _ref$orient;\n\n  var _Symbol = useMarkerSymbol(type);\n\n  return /*#__PURE__*/React.createElement(\"marker\", {\n    className: \"react-flow__arrowhead\",\n    id: id,\n    markerWidth: \"\".concat(width),\n    markerHeight: \"\".concat(height),\n    viewBox: \"-10 -10 20 20\",\n    markerUnits: markerUnits,\n    orient: orient,\n    refX: \"0\",\n    refY: \"0\"\n  }, /*#__PURE__*/React.createElement(_Symbol, {\n    color: color,\n    strokeWidth: strokeWidth\n  }));\n};\n\nvar markerSelector = function markerSelector(_ref2) {\n  var defaultColor = _ref2.defaultColor,\n      rfId = _ref2.rfId;\n  return function (s) {\n    var ids = [];\n    return s.edges.reduce(function (markers, edge) {\n      [edge.markerStart, edge.markerEnd].forEach(function (marker) {\n        if (marker && _typeof(marker) === 'object') {\n          var markerId = getMarkerId(marker, rfId);\n\n          if (!ids.includes(markerId)) {\n            markers.push(_objectSpread$3({\n              id: markerId,\n              color: marker.color || defaultColor\n            }, marker));\n            ids.push(markerId);\n          }\n        }\n      });\n      return markers;\n    }, []).sort(function (a, b) {\n      return a.id.localeCompare(b.id);\n    });\n  };\n}; // when you have multiple flows on a page and you hide the first one, the other ones have no markers anymore\n// when they do have markers with the same ids. To prevent this the user can pass a unique id to the react flow wrapper\n// that we can then use for creating our unique marker ids\n\n\nvar MarkerDefinitions = function MarkerDefinitions(_ref3) {\n  var defaultColor = _ref3.defaultColor,\n      rfId = _ref3.rfId;\n  var markers = useStore(useCallback(markerSelector({\n    defaultColor: defaultColor,\n    rfId: rfId\n  }), [defaultColor, rfId]), // the id includes all marker options, so we just need to look at that part of the marker\n  function (a, b) {\n    return !(a.length !== b.length || a.some(function (m, i) {\n      return m.id !== b[i].id;\n    }));\n  });\n  return /*#__PURE__*/React.createElement(\"defs\", null, markers.map(function (marker) {\n    return /*#__PURE__*/React.createElement(Marker, {\n      id: marker.id,\n      key: marker.id,\n      type: marker.type,\n      color: marker.color,\n      width: marker.width,\n      height: marker.height,\n      markerUnits: marker.markerUnits,\n      strokeWidth: marker.strokeWidth,\n      orient: marker.orient\n    });\n  }));\n};\n\nMarkerDefinitions.displayName = 'MarkerDefinitions';\nvar MarkerDefinitions$1 = /*#__PURE__*/memo(MarkerDefinitions);\n\nvar defaultEdgeTree = [{\n  level: 0,\n  isMaxLevel: true,\n  edges: []\n}];\n\nfunction groupEdgesByZLevel(edges, nodeInternals) {\n  var elevateEdgesOnSelect = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var maxLevel = -1;\n  var levelLookup = edges.reduce(function (tree, edge) {\n    var hasZIndex = isNumeric(edge.zIndex);\n    var z = hasZIndex ? edge.zIndex : 0;\n\n    if (elevateEdgesOnSelect) {\n      var _nodeInternals$get, _nodeInternals$get$in, _nodeInternals$get2, _nodeInternals$get2$i;\n\n      z = hasZIndex ? edge.zIndex : Math.max(((_nodeInternals$get = nodeInternals.get(edge.source)) === null || _nodeInternals$get === void 0 ? void 0 : (_nodeInternals$get$in = _nodeInternals$get[internalsSymbol]) === null || _nodeInternals$get$in === void 0 ? void 0 : _nodeInternals$get$in.z) || 0, ((_nodeInternals$get2 = nodeInternals.get(edge.target)) === null || _nodeInternals$get2 === void 0 ? void 0 : (_nodeInternals$get2$i = _nodeInternals$get2[internalsSymbol]) === null || _nodeInternals$get2$i === void 0 ? void 0 : _nodeInternals$get2$i.z) || 0);\n    }\n\n    if (tree[z]) {\n      tree[z].push(edge);\n    } else {\n      tree[z] = [edge];\n    }\n\n    maxLevel = z > maxLevel ? z : maxLevel;\n    return tree;\n  }, {});\n  var edgeTree = Object.entries(levelLookup).map(function (_ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n        key = _ref2[0],\n        edges = _ref2[1];\n\n    var level = +key;\n    return {\n      edges: edges,\n      level: level,\n      isMaxLevel: level === maxLevel\n    };\n  });\n\n  if (edgeTree.length === 0) {\n    return defaultEdgeTree;\n  }\n\n  return edgeTree;\n}\n\nfunction useVisibleEdges(onlyRenderVisible, nodeInternals, elevateEdgesOnSelect) {\n  var edges = useStore(useCallback(function (s) {\n    if (!onlyRenderVisible) {\n      return s.edges;\n    }\n\n    return s.edges.filter(function (e) {\n      var sourceNode = nodeInternals.get(e.source);\n      var targetNode = nodeInternals.get(e.target);\n      return (sourceNode === null || sourceNode === void 0 ? void 0 : sourceNode.width) && (sourceNode === null || sourceNode === void 0 ? void 0 : sourceNode.height) && (targetNode === null || targetNode === void 0 ? void 0 : targetNode.width) && (targetNode === null || targetNode === void 0 ? void 0 : targetNode.height) && isEdgeVisible({\n        sourcePos: sourceNode.positionAbsolute || {\n          x: 0,\n          y: 0\n        },\n        targetPos: targetNode.positionAbsolute || {\n          x: 0,\n          y: 0\n        },\n        sourceWidth: sourceNode.width,\n        sourceHeight: sourceNode.height,\n        targetWidth: targetNode.width,\n        targetHeight: targetNode.height,\n        width: s.width,\n        height: s.height,\n        transform: s.transform\n      });\n    });\n  }, [onlyRenderVisible, nodeInternals]));\n  return groupEdgesByZLevel(edges, nodeInternals, elevateEdgesOnSelect);\n}\n\nvar selector$1 = function selector(s) {\n  return {\n    connectionNodeId: s.connectionNodeId,\n    connectionHandleType: s.connectionHandleType,\n    nodesConnectable: s.nodesConnectable,\n    elementsSelectable: s.elementsSelectable,\n    width: s.width,\n    height: s.height,\n    connectionMode: s.connectionMode,\n    nodeInternals: s.nodeInternals\n  };\n};\n\nvar EdgeRenderer = function EdgeRenderer(props) {\n  var _useStore = useStore(selector$1, shallow),\n      connectionNodeId = _useStore.connectionNodeId,\n      connectionHandleType = _useStore.connectionHandleType,\n      nodesConnectable = _useStore.nodesConnectable,\n      elementsSelectable = _useStore.elementsSelectable,\n      width = _useStore.width,\n      height = _useStore.height,\n      connectionMode = _useStore.connectionMode,\n      nodeInternals = _useStore.nodeInternals;\n\n  var edgeTree = useVisibleEdges(props.onlyRenderVisibleElements, nodeInternals, props.elevateEdgesOnSelect);\n\n  if (!width) {\n    return null;\n  }\n\n  var connectionLineType = props.connectionLineType,\n      defaultMarkerColor = props.defaultMarkerColor,\n      connectionLineStyle = props.connectionLineStyle,\n      connectionLineComponent = props.connectionLineComponent,\n      connectionLineContainerStyle = props.connectionLineContainerStyle;\n  var renderConnectionLine = connectionNodeId && connectionHandleType;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, edgeTree.map(function (_ref) {\n    var level = _ref.level,\n        edges = _ref.edges,\n        isMaxLevel = _ref.isMaxLevel;\n    return /*#__PURE__*/React.createElement(\"svg\", {\n      key: level,\n      style: {\n        zIndex: level\n      },\n      width: width,\n      height: height,\n      className: \"react-flow__edges react-flow__container\"\n    }, isMaxLevel && /*#__PURE__*/React.createElement(MarkerDefinitions$1, {\n      defaultColor: defaultMarkerColor,\n      rfId: props.rfId\n    }), /*#__PURE__*/React.createElement(\"g\", null, edges.map(function (edge) {\n      var _getNodeData = getNodeData(nodeInternals, edge.source),\n          _getNodeData2 = _slicedToArray(_getNodeData, 3),\n          sourceNodeRect = _getNodeData2[0],\n          sourceHandleBounds = _getNodeData2[1],\n          sourceIsValid = _getNodeData2[2];\n\n      var _getNodeData3 = getNodeData(nodeInternals, edge.target),\n          _getNodeData4 = _slicedToArray(_getNodeData3, 3),\n          targetNodeRect = _getNodeData4[0],\n          targetHandleBounds = _getNodeData4[1],\n          targetIsValid = _getNodeData4[2];\n\n      if (!sourceIsValid || !targetIsValid) {\n        return null;\n      }\n\n      var edgeType = edge.type || 'default';\n\n      if (!props.edgeTypes[edgeType]) {\n        console.warn(\"[React Flow]: Edge type \\\"\".concat(edgeType, \"\\\" not found. Using fallback type \\\"default\\\". Help: https://reactflow.dev/error#300\"));\n        edgeType = 'default';\n      }\n\n      var EdgeComponent = props.edgeTypes[edgeType] || props.edgeTypes[\"default\"]; // when connection type is loose we can define all handles as sources\n\n      var targetNodeHandles = connectionMode === ConnectionMode.Strict ? targetHandleBounds.target : targetHandleBounds.target || targetHandleBounds.source;\n      var sourceHandle = getHandle(sourceHandleBounds.source, edge.sourceHandle || null);\n      var targetHandle = getHandle(targetNodeHandles, edge.targetHandle || null);\n      var sourcePosition = (sourceHandle === null || sourceHandle === void 0 ? void 0 : sourceHandle.position) || Position.Bottom;\n      var targetPosition = (targetHandle === null || targetHandle === void 0 ? void 0 : targetHandle.position) || Position.Top;\n\n      if (!sourceHandle) {\n        // @ts-ignore\n        if (process.env.NODE_ENV === 'development') {\n          console.warn(\"[React Flow]: Couldn't create edge for source handle id: \".concat(edge.sourceHandle, \"; edge id: \").concat(edge.id, \". Help: https://reactflow.dev/error#800\"));\n        }\n\n        return null;\n      }\n\n      if (!targetHandle) {\n        // @ts-ignore\n        if (process.env.NODE_ENV === 'development') {\n          console.warn(\"[React Flow]: Couldn't create edge for target handle id: \".concat(edge.targetHandle, \"; edge id: \").concat(edge.id, \". Help: https://reactflow.dev/error#800\"));\n        }\n\n        return null;\n      }\n\n      var _getEdgePositions = getEdgePositions(sourceNodeRect, sourceHandle, sourcePosition, targetNodeRect, targetHandle, targetPosition),\n          sourceX = _getEdgePositions.sourceX,\n          sourceY = _getEdgePositions.sourceY,\n          targetX = _getEdgePositions.targetX,\n          targetY = _getEdgePositions.targetY;\n\n      return /*#__PURE__*/React.createElement(EdgeComponent, {\n        key: edge.id,\n        id: edge.id,\n        className: cc([edge.className, props.noPanClassName]),\n        type: edgeType,\n        data: edge.data,\n        selected: !!edge.selected,\n        animated: !!edge.animated,\n        hidden: !!edge.hidden,\n        label: edge.label,\n        labelStyle: edge.labelStyle,\n        labelShowBg: edge.labelShowBg,\n        labelBgStyle: edge.labelBgStyle,\n        labelBgPadding: edge.labelBgPadding,\n        labelBgBorderRadius: edge.labelBgBorderRadius,\n        style: edge.style,\n        source: edge.source,\n        target: edge.target,\n        sourceHandleId: edge.sourceHandle,\n        targetHandleId: edge.targetHandle,\n        markerEnd: edge.markerEnd,\n        markerStart: edge.markerStart,\n        sourceX: sourceX,\n        sourceY: sourceY,\n        targetX: targetX,\n        targetY: targetY,\n        sourcePosition: sourcePosition,\n        targetPosition: targetPosition,\n        elementsSelectable: elementsSelectable,\n        onEdgeUpdate: props.onEdgeUpdate,\n        onContextMenu: props.onEdgeContextMenu,\n        onMouseEnter: props.onEdgeMouseEnter,\n        onMouseMove: props.onEdgeMouseMove,\n        onMouseLeave: props.onEdgeMouseLeave,\n        onClick: props.onEdgeClick,\n        edgeUpdaterRadius: props.edgeUpdaterRadius,\n        onEdgeDoubleClick: props.onEdgeDoubleClick,\n        onEdgeUpdateStart: props.onEdgeUpdateStart,\n        onEdgeUpdateEnd: props.onEdgeUpdateEnd,\n        rfId: props.rfId\n      });\n    })));\n  }), renderConnectionLine && /*#__PURE__*/React.createElement(\"svg\", {\n    style: connectionLineContainerStyle,\n    width: width,\n    height: height,\n    className: \"react-flow__edges react-flow__connectionline react-flow__container\"\n  }, /*#__PURE__*/React.createElement(ConnectionLine, {\n    connectionNodeId: connectionNodeId,\n    connectionHandleType: connectionHandleType,\n    connectionLineStyle: connectionLineStyle,\n    connectionLineType: connectionLineType,\n    isConnectable: nodesConnectable,\n    CustomConnectionLineComponent: connectionLineComponent\n  })));\n};\n\nEdgeRenderer.displayName = 'EdgeRenderer';\nvar EdgeRenderer$1 = /*#__PURE__*/memo(EdgeRenderer);\n\nvar selector = function selector(s) {\n  return \"translate(\".concat(s.transform[0], \"px,\").concat(s.transform[1], \"px) scale(\").concat(s.transform[2], \")\");\n};\n\nfunction Viewport(_ref) {\n  var children = _ref.children;\n  var transform = useStore(selector);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"react-flow__viewport react-flow__container\",\n    style: {\n      transform: transform\n    }\n  }, children);\n}\n\nfunction useOnInitHandler(onInit) {\n  var ReactFlowInstance = useReactFlow();\n  var isInitialized = useRef(false);\n  useEffect(function () {\n    if (!isInitialized.current && ReactFlowInstance.viewportInitialized && onInit) {\n      setTimeout(function () {\n        return onInit(ReactFlowInstance);\n      }, 1);\n      isInitialized.current = true;\n    }\n  }, [onInit, ReactFlowInstance.viewportInitialized]);\n}\n\nvar GraphView = function GraphView(_ref) {\n  var nodeTypes = _ref.nodeTypes,\n      edgeTypes = _ref.edgeTypes,\n      onMove = _ref.onMove,\n      onMoveStart = _ref.onMoveStart,\n      onMoveEnd = _ref.onMoveEnd,\n      onInit = _ref.onInit,\n      onNodeClick = _ref.onNodeClick,\n      onEdgeClick = _ref.onEdgeClick,\n      onNodeDoubleClick = _ref.onNodeDoubleClick,\n      onEdgeDoubleClick = _ref.onEdgeDoubleClick,\n      onNodeMouseEnter = _ref.onNodeMouseEnter,\n      onNodeMouseMove = _ref.onNodeMouseMove,\n      onNodeMouseLeave = _ref.onNodeMouseLeave,\n      onNodeContextMenu = _ref.onNodeContextMenu,\n      onSelectionContextMenu = _ref.onSelectionContextMenu,\n      connectionLineType = _ref.connectionLineType,\n      connectionLineStyle = _ref.connectionLineStyle,\n      connectionLineComponent = _ref.connectionLineComponent,\n      connectionLineContainerStyle = _ref.connectionLineContainerStyle,\n      selectionKeyCode = _ref.selectionKeyCode,\n      multiSelectionKeyCode = _ref.multiSelectionKeyCode,\n      zoomActivationKeyCode = _ref.zoomActivationKeyCode,\n      deleteKeyCode = _ref.deleteKeyCode,\n      onlyRenderVisibleElements = _ref.onlyRenderVisibleElements,\n      elementsSelectable = _ref.elementsSelectable,\n      selectNodesOnDrag = _ref.selectNodesOnDrag,\n      translateExtent = _ref.translateExtent,\n      minZoom = _ref.minZoom,\n      maxZoom = _ref.maxZoom,\n      defaultZoom = _ref.defaultZoom,\n      defaultPosition = _ref.defaultPosition,\n      preventScrolling = _ref.preventScrolling,\n      defaultMarkerColor = _ref.defaultMarkerColor,\n      zoomOnScroll = _ref.zoomOnScroll,\n      zoomOnPinch = _ref.zoomOnPinch,\n      panOnScroll = _ref.panOnScroll,\n      panOnScrollSpeed = _ref.panOnScrollSpeed,\n      panOnScrollMode = _ref.panOnScrollMode,\n      zoomOnDoubleClick = _ref.zoomOnDoubleClick,\n      panOnDrag = _ref.panOnDrag,\n      onPaneClick = _ref.onPaneClick,\n      onPaneScroll = _ref.onPaneScroll,\n      onPaneContextMenu = _ref.onPaneContextMenu,\n      onEdgeUpdate = _ref.onEdgeUpdate,\n      onEdgeContextMenu = _ref.onEdgeContextMenu,\n      onEdgeMouseEnter = _ref.onEdgeMouseEnter,\n      onEdgeMouseMove = _ref.onEdgeMouseMove,\n      onEdgeMouseLeave = _ref.onEdgeMouseLeave,\n      edgeUpdaterRadius = _ref.edgeUpdaterRadius,\n      onEdgeUpdateStart = _ref.onEdgeUpdateStart,\n      onEdgeUpdateEnd = _ref.onEdgeUpdateEnd,\n      noDragClassName = _ref.noDragClassName,\n      noWheelClassName = _ref.noWheelClassName,\n      noPanClassName = _ref.noPanClassName,\n      elevateEdgesOnSelect = _ref.elevateEdgesOnSelect,\n      id = _ref.id;\n  useOnInitHandler(onInit);\n  return /*#__PURE__*/React.createElement(FlowRenderer$1, {\n    onPaneClick: onPaneClick,\n    onPaneContextMenu: onPaneContextMenu,\n    onPaneScroll: onPaneScroll,\n    deleteKeyCode: deleteKeyCode,\n    selectionKeyCode: selectionKeyCode,\n    multiSelectionKeyCode: multiSelectionKeyCode,\n    zoomActivationKeyCode: zoomActivationKeyCode,\n    elementsSelectable: elementsSelectable,\n    onMove: onMove,\n    onMoveStart: onMoveStart,\n    onMoveEnd: onMoveEnd,\n    zoomOnScroll: zoomOnScroll,\n    zoomOnPinch: zoomOnPinch,\n    zoomOnDoubleClick: zoomOnDoubleClick,\n    panOnScroll: panOnScroll,\n    panOnScrollSpeed: panOnScrollSpeed,\n    panOnScrollMode: panOnScrollMode,\n    panOnDrag: panOnDrag,\n    translateExtent: translateExtent,\n    minZoom: minZoom,\n    maxZoom: maxZoom,\n    defaultZoom: defaultZoom,\n    defaultPosition: defaultPosition,\n    onSelectionContextMenu: onSelectionContextMenu,\n    preventScrolling: preventScrolling,\n    noDragClassName: noDragClassName,\n    noWheelClassName: noWheelClassName,\n    noPanClassName: noPanClassName\n  }, /*#__PURE__*/React.createElement(Viewport, null, /*#__PURE__*/React.createElement(EdgeRenderer$1, {\n    edgeTypes: edgeTypes,\n    onEdgeClick: onEdgeClick,\n    onEdgeDoubleClick: onEdgeDoubleClick,\n    connectionLineType: connectionLineType,\n    connectionLineStyle: connectionLineStyle,\n    connectionLineComponent: connectionLineComponent,\n    connectionLineContainerStyle: connectionLineContainerStyle,\n    onEdgeUpdate: onEdgeUpdate,\n    onlyRenderVisibleElements: onlyRenderVisibleElements,\n    onEdgeContextMenu: onEdgeContextMenu,\n    onEdgeMouseEnter: onEdgeMouseEnter,\n    onEdgeMouseMove: onEdgeMouseMove,\n    onEdgeMouseLeave: onEdgeMouseLeave,\n    onEdgeUpdateStart: onEdgeUpdateStart,\n    onEdgeUpdateEnd: onEdgeUpdateEnd,\n    edgeUpdaterRadius: edgeUpdaterRadius,\n    defaultMarkerColor: defaultMarkerColor,\n    noPanClassName: noPanClassName,\n    elevateEdgesOnSelect: !!elevateEdgesOnSelect,\n    rfId: id\n  }), /*#__PURE__*/React.createElement(NodeRenderer$1, {\n    nodeTypes: nodeTypes,\n    onNodeClick: onNodeClick,\n    onNodeDoubleClick: onNodeDoubleClick,\n    onNodeMouseEnter: onNodeMouseEnter,\n    onNodeMouseMove: onNodeMouseMove,\n    onNodeMouseLeave: onNodeMouseLeave,\n    onNodeContextMenu: onNodeContextMenu,\n    selectNodesOnDrag: selectNodesOnDrag,\n    onlyRenderVisibleElements: onlyRenderVisibleElements,\n    noPanClassName: noPanClassName,\n    noDragClassName: noDragClassName\n  })));\n};\n\nGraphView.displayName = 'GraphView';\nvar GraphView$1 = /*#__PURE__*/memo(GraphView);\n\nvar GroupNode = function GroupNode() {\n  return null;\n};\n\nGroupNode.displayName = 'GroupNode';\n\nfunction ownKeys$2(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$2(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$2(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$2(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nvar wrapNode = (function (NodeComponent) {\n  var NodeWrapper = function NodeWrapper(_ref) {\n    var id = _ref.id,\n        type = _ref.type,\n        data = _ref.data,\n        xPos = _ref.xPos,\n        yPos = _ref.yPos,\n        selected = _ref.selected,\n        onClick = _ref.onClick,\n        onMouseEnter = _ref.onMouseEnter,\n        onMouseMove = _ref.onMouseMove,\n        onMouseLeave = _ref.onMouseLeave,\n        onContextMenu = _ref.onContextMenu,\n        onDoubleClick = _ref.onDoubleClick,\n        style = _ref.style,\n        className = _ref.className,\n        isDraggable = _ref.isDraggable,\n        isSelectable = _ref.isSelectable,\n        isConnectable = _ref.isConnectable,\n        selectNodesOnDrag = _ref.selectNodesOnDrag,\n        sourcePosition = _ref.sourcePosition,\n        targetPosition = _ref.targetPosition,\n        hidden = _ref.hidden,\n        resizeObserver = _ref.resizeObserver,\n        dragHandle = _ref.dragHandle,\n        zIndex = _ref.zIndex,\n        isParent = _ref.isParent,\n        noPanClassName = _ref.noPanClassName,\n        noDragClassName = _ref.noDragClassName,\n        initialized = _ref.initialized;\n    var store = useStoreApi();\n    var nodeRef = useRef(null);\n    var prevSourcePosition = useRef(sourcePosition);\n    var prevTargetPosition = useRef(targetPosition);\n    var prevType = useRef(type);\n    var hasPointerEvents = isSelectable || isDraggable || onClick || onMouseEnter || onMouseMove || onMouseLeave;\n    var onMouseEnterHandler = getMouseHandler$1(id, store.getState, onMouseEnter);\n    var onMouseMoveHandler = getMouseHandler$1(id, store.getState, onMouseMove);\n    var onMouseLeaveHandler = getMouseHandler$1(id, store.getState, onMouseLeave);\n    var onContextMenuHandler = getMouseHandler$1(id, store.getState, onContextMenu);\n    var onDoubleClickHandler = getMouseHandler$1(id, store.getState, onDoubleClick);\n\n    var onSelectNodeHandler = function onSelectNodeHandler(event) {\n      if (isSelectable && (!selectNodesOnDrag || !isDraggable)) {\n        // this handler gets called within the drag start event when selectNodesOnDrag=true\n        handleNodeClick({\n          id: id,\n          store: store\n        });\n      }\n\n      if (onClick) {\n        var node = store.getState().nodeInternals.get(id);\n        onClick(event, _objectSpread$2({}, node));\n      }\n    };\n\n    useEffect(function () {\n      if (nodeRef.current && !hidden) {\n        var currNode = nodeRef.current;\n        resizeObserver === null || resizeObserver === void 0 ? void 0 : resizeObserver.observe(currNode);\n        return function () {\n          return resizeObserver === null || resizeObserver === void 0 ? void 0 : resizeObserver.unobserve(currNode);\n        };\n      }\n    }, [hidden]);\n    useEffect(function () {\n      // when the user programmatically changes the source or handle position, we re-initialize the node\n      var typeChanged = prevType.current !== type;\n      var sourcePosChanged = prevSourcePosition.current !== sourcePosition;\n      var targetPosChanged = prevTargetPosition.current !== targetPosition;\n\n      if (nodeRef.current && (typeChanged || sourcePosChanged || targetPosChanged)) {\n        if (typeChanged) {\n          prevType.current = type;\n        }\n\n        if (sourcePosChanged) {\n          prevSourcePosition.current = sourcePosition;\n        }\n\n        if (targetPosChanged) {\n          prevTargetPosition.current = targetPosition;\n        }\n\n        store.getState().updateNodeDimensions([{\n          id: id,\n          nodeElement: nodeRef.current,\n          forceUpdate: true\n        }]);\n      }\n    }, [id, type, sourcePosition, targetPosition]);\n    var dragging = useDrag({\n      nodeRef: nodeRef,\n      disabled: hidden || !isDraggable,\n      noDragClassName: noDragClassName,\n      handleSelector: dragHandle,\n      nodeId: id,\n      isSelectable: isSelectable,\n      selectNodesOnDrag: selectNodesOnDrag\n    });\n\n    if (hidden) {\n      return null;\n    }\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: cc(['react-flow__node', \"react-flow__node-\".concat(type), noPanClassName, className, {\n        selected: selected,\n        selectable: isSelectable,\n        parent: isParent\n      }]),\n      ref: nodeRef,\n      style: _objectSpread$2({\n        zIndex: zIndex,\n        transform: \"translate(\".concat(xPos, \"px,\").concat(yPos, \"px)\"),\n        pointerEvents: hasPointerEvents ? 'all' : 'none',\n        visibility: initialized ? 'visible' : 'hidden'\n      }, style),\n      onMouseEnter: onMouseEnterHandler,\n      onMouseMove: onMouseMoveHandler,\n      onMouseLeave: onMouseLeaveHandler,\n      onContextMenu: onContextMenuHandler,\n      onClick: onSelectNodeHandler,\n      onDoubleClick: onDoubleClickHandler,\n      \"data-testid\": \"rf__node-\".concat(id),\n      \"data-id\": id\n    }, /*#__PURE__*/React.createElement(Provider, {\n      value: id\n    }, /*#__PURE__*/React.createElement(NodeComponent, {\n      id: id,\n      data: data,\n      type: type,\n      xPos: xPos,\n      yPos: yPos,\n      selected: selected,\n      isConnectable: isConnectable,\n      sourcePosition: sourcePosition,\n      targetPosition: targetPosition,\n      dragging: dragging,\n      dragHandle: dragHandle,\n      zIndex: zIndex\n    })));\n  };\n\n  NodeWrapper.displayName = 'NodeWrapper';\n  return /*#__PURE__*/memo(NodeWrapper);\n});\n\nfunction ownKeys$1(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread$1(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$1(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$1(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction createNodeTypes(nodeTypes) {\n  var standardTypes = {\n    input: wrapNode(nodeTypes.input || InputNode$1),\n    \"default\": wrapNode(nodeTypes[\"default\"] || DefaultNode$1),\n    output: wrapNode(nodeTypes.output || OutputNode$1),\n    group: wrapNode(nodeTypes.group || GroupNode)\n  };\n  var wrappedTypes = {};\n  var specialTypes = Object.keys(nodeTypes).filter(function (k) {\n    return !['input', 'default', 'output', 'group'].includes(k);\n  }).reduce(function (res, key) {\n    res[key] = wrapNode(nodeTypes[key] || DefaultNode$1);\n    return res;\n  }, wrappedTypes);\n  return _objectSpread$1(_objectSpread$1({}, standardTypes), specialTypes);\n}\n\nfunction useNodeOrEdgeTypes(nodeOrEdgeTypes, createTypes) {\n  var typesKeysRef = useRef(null);\n  var typesParsed = useMemo(function () {\n    // @ts-ignore\n    if (process.env.NODE_ENV === 'development') {\n      var typeKeys = Object.keys(nodeOrEdgeTypes);\n\n      if (shallow(typesKeysRef.current, typeKeys)) {\n        console.warn(\"[React Flow]: It looks like you have created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them. Help: https://reactflow.dev/error#200\");\n      }\n\n      typesKeysRef.current = typeKeys;\n    }\n\n    return createTypes(nodeOrEdgeTypes);\n  }, [nodeOrEdgeTypes]);\n  return typesParsed;\n}\nfunction injectStyle(css) {\n  if (!css || typeof document === 'undefined') return;\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  head.appendChild(style);\n  style.appendChild(document.createTextNode(css));\n}\n\nvar Wrapper = function Wrapper(_ref) {\n  var children = _ref.children;\n  var isWrapped = true;\n\n  try {\n    useStoreApi();\n  } catch (e) {\n    isWrapped = false;\n  }\n\n  if (isWrapped) {\n    // we need to wrap it with a fragment because it's not allowed for children to be a ReactNode\n    // https://github.com/DefinitelyTyped/DefinitelyTyped/issues/18051\n    return /*#__PURE__*/React.createElement(React.Fragment, null, children);\n  }\n\n  return /*#__PURE__*/React.createElement(Provider$1, {\n    createStore: createStore\n  }, children);\n};\n\nWrapper.displayName = 'ReactFlowWrapper';\n\nvar _excluded = [\"nodes\", \"edges\", \"defaultNodes\", \"defaultEdges\", \"className\", \"nodeTypes\", \"edgeTypes\", \"onNodeClick\", \"onEdgeClick\", \"onInit\", \"onMove\", \"onMoveStart\", \"onMoveEnd\", \"onConnect\", \"onConnectStart\", \"onConnectStop\", \"onConnectEnd\", \"onClickConnectStart\", \"onClickConnectStop\", \"onClickConnectEnd\", \"onNodeMouseEnter\", \"onNodeMouseMove\", \"onNodeMouseLeave\", \"onNodeContextMenu\", \"onNodeDoubleClick\", \"onNodeDragStart\", \"onNodeDrag\", \"onNodeDragStop\", \"onNodesDelete\", \"onEdgesDelete\", \"onSelectionChange\", \"onSelectionDragStart\", \"onSelectionDrag\", \"onSelectionDragStop\", \"onSelectionContextMenu\", \"connectionMode\", \"connectionLineType\", \"connectionLineStyle\", \"connectionLineComponent\", \"connectionLineContainerStyle\", \"deleteKeyCode\", \"selectionKeyCode\", \"multiSelectionKeyCode\", \"zoomActivationKeyCode\", \"snapToGrid\", \"snapGrid\", \"onlyRenderVisibleElements\", \"selectNodesOnDrag\", \"nodesDraggable\", \"nodesConnectable\", \"elementsSelectable\", \"minZoom\", \"maxZoom\", \"defaultZoom\", \"defaultPosition\", \"translateExtent\", \"preventScrolling\", \"nodeExtent\", \"defaultMarkerColor\", \"zoomOnScroll\", \"zoomOnPinch\", \"panOnScroll\", \"panOnScrollSpeed\", \"panOnScrollMode\", \"zoomOnDoubleClick\", \"panOnDrag\", \"onPaneClick\", \"onPaneScroll\", \"onPaneContextMenu\", \"children\", \"onEdgeUpdate\", \"onEdgeContextMenu\", \"onEdgeDoubleClick\", \"onEdgeMouseEnter\", \"onEdgeMouseMove\", \"onEdgeMouseLeave\", \"onEdgeUpdateStart\", \"onEdgeUpdateEnd\", \"edgeUpdaterRadius\", \"onNodesChange\", \"onEdgesChange\", \"noDragClassName\", \"noWheelClassName\", \"noPanClassName\", \"fitView\", \"fitViewOptions\", \"connectOnClick\", \"attributionPosition\", \"proOptions\", \"defaultEdgeOptions\", \"elevateEdgesOnSelect\"];\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\n{\n  injectStyle(css);\n  injectStyle(theme);\n}\n\nvar defaultNodeTypes = {\n  input: InputNode$1,\n  \"default\": DefaultNode$1,\n  output: OutputNode$1\n};\nvar defaultEdgeTypes = {\n  \"default\": BezierEdge,\n  straight: StraightEdge,\n  step: StepEdge,\n  smoothstep: SmoothStepEdge,\n  simplebezier: SimpleBezierEdge\n};\nvar initSnapGrid = [15, 15];\nvar initDefaultPosition = [0, 0];\nvar ReactFlow = /*#__PURE__*/forwardRef(function (_ref, ref) {\n  var nodes = _ref.nodes,\n      edges = _ref.edges,\n      defaultNodes = _ref.defaultNodes,\n      defaultEdges = _ref.defaultEdges,\n      className = _ref.className,\n      _ref$nodeTypes = _ref.nodeTypes,\n      nodeTypes = _ref$nodeTypes === void 0 ? defaultNodeTypes : _ref$nodeTypes,\n      _ref$edgeTypes = _ref.edgeTypes,\n      edgeTypes = _ref$edgeTypes === void 0 ? defaultEdgeTypes : _ref$edgeTypes,\n      onNodeClick = _ref.onNodeClick,\n      onEdgeClick = _ref.onEdgeClick,\n      onInit = _ref.onInit,\n      onMove = _ref.onMove,\n      onMoveStart = _ref.onMoveStart,\n      onMoveEnd = _ref.onMoveEnd,\n      onConnect = _ref.onConnect,\n      onConnectStart = _ref.onConnectStart,\n      onConnectStop = _ref.onConnectStop,\n      onConnectEnd = _ref.onConnectEnd,\n      onClickConnectStart = _ref.onClickConnectStart,\n      onClickConnectStop = _ref.onClickConnectStop,\n      onClickConnectEnd = _ref.onClickConnectEnd,\n      onNodeMouseEnter = _ref.onNodeMouseEnter,\n      onNodeMouseMove = _ref.onNodeMouseMove,\n      onNodeMouseLeave = _ref.onNodeMouseLeave,\n      onNodeContextMenu = _ref.onNodeContextMenu,\n      onNodeDoubleClick = _ref.onNodeDoubleClick,\n      onNodeDragStart = _ref.onNodeDragStart,\n      onNodeDrag = _ref.onNodeDrag,\n      onNodeDragStop = _ref.onNodeDragStop,\n      onNodesDelete = _ref.onNodesDelete,\n      onEdgesDelete = _ref.onEdgesDelete,\n      onSelectionChange = _ref.onSelectionChange,\n      onSelectionDragStart = _ref.onSelectionDragStart,\n      onSelectionDrag = _ref.onSelectionDrag,\n      onSelectionDragStop = _ref.onSelectionDragStop,\n      onSelectionContextMenu = _ref.onSelectionContextMenu,\n      _ref$connectionMode = _ref.connectionMode,\n      connectionMode = _ref$connectionMode === void 0 ? ConnectionMode.Strict : _ref$connectionMode,\n      _ref$connectionLineTy = _ref.connectionLineType,\n      connectionLineType = _ref$connectionLineTy === void 0 ? ConnectionLineType.Bezier : _ref$connectionLineTy,\n      connectionLineStyle = _ref.connectionLineStyle,\n      connectionLineComponent = _ref.connectionLineComponent,\n      connectionLineContainerStyle = _ref.connectionLineContainerStyle,\n      _ref$deleteKeyCode = _ref.deleteKeyCode,\n      deleteKeyCode = _ref$deleteKeyCode === void 0 ? 'Backspace' : _ref$deleteKeyCode,\n      _ref$selectionKeyCode = _ref.selectionKeyCode,\n      selectionKeyCode = _ref$selectionKeyCode === void 0 ? 'Shift' : _ref$selectionKeyCode,\n      _ref$multiSelectionKe = _ref.multiSelectionKeyCode,\n      multiSelectionKeyCode = _ref$multiSelectionKe === void 0 ? 'Meta' : _ref$multiSelectionKe,\n      _ref$zoomActivationKe = _ref.zoomActivationKeyCode,\n      zoomActivationKeyCode = _ref$zoomActivationKe === void 0 ? 'Meta' : _ref$zoomActivationKe,\n      _ref$snapToGrid = _ref.snapToGrid,\n      snapToGrid = _ref$snapToGrid === void 0 ? false : _ref$snapToGrid,\n      _ref$snapGrid = _ref.snapGrid,\n      snapGrid = _ref$snapGrid === void 0 ? initSnapGrid : _ref$snapGrid,\n      _ref$onlyRenderVisibl = _ref.onlyRenderVisibleElements,\n      onlyRenderVisibleElements = _ref$onlyRenderVisibl === void 0 ? false : _ref$onlyRenderVisibl,\n      _ref$selectNodesOnDra = _ref.selectNodesOnDrag,\n      selectNodesOnDrag = _ref$selectNodesOnDra === void 0 ? true : _ref$selectNodesOnDra,\n      nodesDraggable = _ref.nodesDraggable,\n      nodesConnectable = _ref.nodesConnectable,\n      elementsSelectable = _ref.elementsSelectable,\n      _ref$minZoom = _ref.minZoom,\n      minZoom = _ref$minZoom === void 0 ? 0.5 : _ref$minZoom,\n      _ref$maxZoom = _ref.maxZoom,\n      maxZoom = _ref$maxZoom === void 0 ? 2 : _ref$maxZoom,\n      _ref$defaultZoom = _ref.defaultZoom,\n      defaultZoom = _ref$defaultZoom === void 0 ? 1 : _ref$defaultZoom,\n      _ref$defaultPosition = _ref.defaultPosition,\n      defaultPosition = _ref$defaultPosition === void 0 ? initDefaultPosition : _ref$defaultPosition,\n      _ref$translateExtent = _ref.translateExtent,\n      translateExtent = _ref$translateExtent === void 0 ? infiniteExtent : _ref$translateExtent,\n      _ref$preventScrolling = _ref.preventScrolling,\n      preventScrolling = _ref$preventScrolling === void 0 ? true : _ref$preventScrolling,\n      nodeExtent = _ref.nodeExtent,\n      _ref$defaultMarkerCol = _ref.defaultMarkerColor,\n      defaultMarkerColor = _ref$defaultMarkerCol === void 0 ? '#b1b1b7' : _ref$defaultMarkerCol,\n      _ref$zoomOnScroll = _ref.zoomOnScroll,\n      zoomOnScroll = _ref$zoomOnScroll === void 0 ? true : _ref$zoomOnScroll,\n      _ref$zoomOnPinch = _ref.zoomOnPinch,\n      zoomOnPinch = _ref$zoomOnPinch === void 0 ? true : _ref$zoomOnPinch,\n      _ref$panOnScroll = _ref.panOnScroll,\n      panOnScroll = _ref$panOnScroll === void 0 ? false : _ref$panOnScroll,\n      _ref$panOnScrollSpeed = _ref.panOnScrollSpeed,\n      panOnScrollSpeed = _ref$panOnScrollSpeed === void 0 ? 0.5 : _ref$panOnScrollSpeed,\n      _ref$panOnScrollMode = _ref.panOnScrollMode,\n      panOnScrollMode = _ref$panOnScrollMode === void 0 ? PanOnScrollMode.Free : _ref$panOnScrollMode,\n      _ref$zoomOnDoubleClic = _ref.zoomOnDoubleClick,\n      zoomOnDoubleClick = _ref$zoomOnDoubleClic === void 0 ? true : _ref$zoomOnDoubleClic,\n      _ref$panOnDrag = _ref.panOnDrag,\n      panOnDrag = _ref$panOnDrag === void 0 ? true : _ref$panOnDrag,\n      onPaneClick = _ref.onPaneClick,\n      onPaneScroll = _ref.onPaneScroll,\n      onPaneContextMenu = _ref.onPaneContextMenu,\n      children = _ref.children,\n      onEdgeUpdate = _ref.onEdgeUpdate,\n      onEdgeContextMenu = _ref.onEdgeContextMenu,\n      onEdgeDoubleClick = _ref.onEdgeDoubleClick,\n      onEdgeMouseEnter = _ref.onEdgeMouseEnter,\n      onEdgeMouseMove = _ref.onEdgeMouseMove,\n      onEdgeMouseLeave = _ref.onEdgeMouseLeave,\n      onEdgeUpdateStart = _ref.onEdgeUpdateStart,\n      onEdgeUpdateEnd = _ref.onEdgeUpdateEnd,\n      _ref$edgeUpdaterRadiu = _ref.edgeUpdaterRadius,\n      edgeUpdaterRadius = _ref$edgeUpdaterRadiu === void 0 ? 10 : _ref$edgeUpdaterRadiu,\n      onNodesChange = _ref.onNodesChange,\n      onEdgesChange = _ref.onEdgesChange,\n      _ref$noDragClassName = _ref.noDragClassName,\n      noDragClassName = _ref$noDragClassName === void 0 ? 'nodrag' : _ref$noDragClassName,\n      _ref$noWheelClassName = _ref.noWheelClassName,\n      noWheelClassName = _ref$noWheelClassName === void 0 ? 'nowheel' : _ref$noWheelClassName,\n      _ref$noPanClassName = _ref.noPanClassName,\n      noPanClassName = _ref$noPanClassName === void 0 ? 'nopan' : _ref$noPanClassName,\n      _ref$fitView = _ref.fitView,\n      fitView = _ref$fitView === void 0 ? false : _ref$fitView,\n      fitViewOptions = _ref.fitViewOptions,\n      _ref$connectOnClick = _ref.connectOnClick,\n      connectOnClick = _ref$connectOnClick === void 0 ? true : _ref$connectOnClick,\n      attributionPosition = _ref.attributionPosition,\n      proOptions = _ref.proOptions,\n      defaultEdgeOptions = _ref.defaultEdgeOptions,\n      _ref$elevateEdgesOnSe = _ref.elevateEdgesOnSelect,\n      elevateEdgesOnSelect = _ref$elevateEdgesOnSe === void 0 ? false : _ref$elevateEdgesOnSe,\n      rest = _objectWithoutProperties(_ref, _excluded);\n\n  var nodeTypesWrapped = useNodeOrEdgeTypes(nodeTypes, createNodeTypes);\n  var edgeTypesWrapped = useNodeOrEdgeTypes(edgeTypes, createEdgeTypes);\n  return /*#__PURE__*/React.createElement(\"div\", _objectSpread(_objectSpread({}, rest), {}, {\n    ref: ref,\n    className: cc(['react-flow', className])\n  }), /*#__PURE__*/React.createElement(Wrapper, null, /*#__PURE__*/React.createElement(GraphView$1, {\n    onInit: onInit,\n    onMove: onMove,\n    onMoveStart: onMoveStart,\n    onMoveEnd: onMoveEnd,\n    onNodeClick: onNodeClick,\n    onEdgeClick: onEdgeClick,\n    onNodeMouseEnter: onNodeMouseEnter,\n    onNodeMouseMove: onNodeMouseMove,\n    onNodeMouseLeave: onNodeMouseLeave,\n    onNodeContextMenu: onNodeContextMenu,\n    onNodeDoubleClick: onNodeDoubleClick,\n    nodeTypes: nodeTypesWrapped,\n    edgeTypes: edgeTypesWrapped,\n    connectionLineType: connectionLineType,\n    connectionLineStyle: connectionLineStyle,\n    connectionLineComponent: connectionLineComponent,\n    connectionLineContainerStyle: connectionLineContainerStyle,\n    selectionKeyCode: selectionKeyCode,\n    deleteKeyCode: deleteKeyCode,\n    multiSelectionKeyCode: multiSelectionKeyCode,\n    zoomActivationKeyCode: zoomActivationKeyCode,\n    onlyRenderVisibleElements: onlyRenderVisibleElements,\n    selectNodesOnDrag: selectNodesOnDrag,\n    translateExtent: translateExtent,\n    minZoom: minZoom,\n    maxZoom: maxZoom,\n    defaultZoom: defaultZoom,\n    defaultPosition: defaultPosition,\n    preventScrolling: preventScrolling,\n    zoomOnScroll: zoomOnScroll,\n    zoomOnPinch: zoomOnPinch,\n    zoomOnDoubleClick: zoomOnDoubleClick,\n    panOnScroll: panOnScroll,\n    panOnScrollSpeed: panOnScrollSpeed,\n    panOnScrollMode: panOnScrollMode,\n    panOnDrag: panOnDrag,\n    onPaneClick: onPaneClick,\n    onPaneScroll: onPaneScroll,\n    onPaneContextMenu: onPaneContextMenu,\n    onSelectionContextMenu: onSelectionContextMenu,\n    onEdgeUpdate: onEdgeUpdate,\n    onEdgeContextMenu: onEdgeContextMenu,\n    onEdgeDoubleClick: onEdgeDoubleClick,\n    onEdgeMouseEnter: onEdgeMouseEnter,\n    onEdgeMouseMove: onEdgeMouseMove,\n    onEdgeMouseLeave: onEdgeMouseLeave,\n    onEdgeUpdateStart: onEdgeUpdateStart,\n    onEdgeUpdateEnd: onEdgeUpdateEnd,\n    edgeUpdaterRadius: edgeUpdaterRadius,\n    defaultMarkerColor: defaultMarkerColor,\n    noDragClassName: noDragClassName,\n    noWheelClassName: noWheelClassName,\n    noPanClassName: noPanClassName,\n    elevateEdgesOnSelect: elevateEdgesOnSelect,\n    id: rest === null || rest === void 0 ? void 0 : rest.id\n  }), /*#__PURE__*/React.createElement(StoreUpdater, {\n    nodes: nodes,\n    edges: edges,\n    defaultNodes: defaultNodes,\n    defaultEdges: defaultEdges,\n    onConnect: onConnect,\n    onConnectStart: onConnectStart,\n    onConnectStop: onConnectStop,\n    onConnectEnd: onConnectEnd,\n    onClickConnectStart: onClickConnectStart,\n    onClickConnectStop: onClickConnectStop,\n    onClickConnectEnd: onClickConnectEnd,\n    nodesDraggable: nodesDraggable,\n    nodesConnectable: nodesConnectable,\n    elementsSelectable: elementsSelectable,\n    minZoom: minZoom,\n    maxZoom: maxZoom,\n    nodeExtent: nodeExtent,\n    onNodesChange: onNodesChange,\n    onEdgesChange: onEdgesChange,\n    snapToGrid: snapToGrid,\n    snapGrid: snapGrid,\n    connectionMode: connectionMode,\n    translateExtent: translateExtent,\n    connectOnClick: connectOnClick,\n    defaultEdgeOptions: defaultEdgeOptions,\n    fitView: fitView,\n    fitViewOptions: fitViewOptions,\n    onNodesDelete: onNodesDelete,\n    onEdgesDelete: onEdgesDelete,\n    onNodeDragStart: onNodeDragStart,\n    onNodeDrag: onNodeDrag,\n    onNodeDragStop: onNodeDragStop,\n    onSelectionDrag: onSelectionDrag,\n    onSelectionDragStart: onSelectionDragStart,\n    onSelectionDragStop: onSelectionDragStop\n  }), onSelectionChange && /*#__PURE__*/React.createElement(SelectionListener$1, {\n    onSelectionChange: onSelectionChange\n  }), children, /*#__PURE__*/React.createElement(Attribution, {\n    proOptions: proOptions,\n    position: attributionPosition\n  })));\n});\nReactFlow.displayName = 'ReactFlow';\n\nvar ReactFlowProvider = function ReactFlowProvider(_ref) {\n  var children = _ref.children;\n  return /*#__PURE__*/React.createElement(Provider$1, {\n    createStore: createStore\n  }, children);\n};\n\nReactFlowProvider.displayName = 'ReactFlowProvider';\n\nfunction createUseItemsState(applyChanges) {\n  return function (initialItems) {\n    var _useState = useState(initialItems),\n        _useState2 = _slicedToArray(_useState, 2),\n        items = _useState2[0],\n        setItems = _useState2[1];\n\n    var onItemsChange = useCallback(function (changes) {\n      return setItems(function (items) {\n        return applyChanges(changes, items);\n      });\n    }, []);\n    return [items, setItems, onItemsChange];\n  };\n}\n\nvar useNodesState = createUseItemsState(applyNodeChanges);\nvar useEdgesState = createUseItemsState(applyEdgeChanges);\n\nexport { BezierEdge, EdgeText$1 as EdgeText, Handle$1 as Handle, ReactFlowProvider, SimpleBezierEdge, SmoothStepEdge, StepEdge, StraightEdge, ReactFlow as default, getBezierCenter as getBezierEdgeCenter, getBezierPath, getCenter as getEdgeCenter, getMarkerEnd, getSimpleBezierCenter as getSimpleBezierEdgeCenter, getSimpleBezierPath, getSmoothStepPath, useEdgesState, useKeyPress, useNodesState };\n//# sourceMappingURL=index.js.map\n","import React, { memo } from 'react';\nimport cc from 'classcat';\nimport shallow from 'zustand/shallow';\nimport { b as useStore, I as getBoundsofRects, o as getRectOfNodes } from './index-a12c80bd.js';\nimport 'zustand';\nimport 'zustand/context';\nimport 'd3-zoom';\n\nvar MiniMapNode = function MiniMapNode(_ref) {\n  var x = _ref.x,\n      y = _ref.y,\n      width = _ref.width,\n      height = _ref.height,\n      style = _ref.style,\n      color = _ref.color,\n      strokeColor = _ref.strokeColor,\n      strokeWidth = _ref.strokeWidth,\n      className = _ref.className,\n      borderRadius = _ref.borderRadius,\n      shapeRendering = _ref.shapeRendering;\n\n  var _ref2 = style || {},\n      background = _ref2.background,\n      backgroundColor = _ref2.backgroundColor;\n\n  var fill = color || background || backgroundColor;\n  return /*#__PURE__*/React.createElement(\"rect\", {\n    className: cc(['react-flow__minimap-node', className]),\n    x: x,\n    y: y,\n    rx: borderRadius,\n    ry: borderRadius,\n    width: width,\n    height: height,\n    fill: fill,\n    stroke: strokeColor,\n    strokeWidth: strokeWidth,\n    shapeRendering: shapeRendering\n  });\n};\n\nMiniMapNode.displayName = 'MiniMapNode';\nvar MiniMapNode$1 = /*#__PURE__*/memo(MiniMapNode);\n\nvar defaultWidth = 200;\nvar defaultHeight = 150;\n\nvar selector = function selector(s) {\n  return {\n    viewBBox: {\n      x: -s.transform[0] / s.transform[2],\n      y: -s.transform[1] / s.transform[2],\n      width: s.width / s.transform[2],\n      height: s.height / s.transform[2]\n    },\n    nodes: Array.from(s.nodeInternals.values())\n  };\n};\n\nvar getAttrFunction = function getAttrFunction(func) {\n  return func instanceof Function ? func : function () {\n    return func;\n  };\n};\n\nvar MiniMap = function MiniMap(_ref) {\n  var _style$width, _style$height;\n\n  var style = _ref.style,\n      className = _ref.className,\n      _ref$nodeStrokeColor = _ref.nodeStrokeColor,\n      nodeStrokeColor = _ref$nodeStrokeColor === void 0 ? '#555' : _ref$nodeStrokeColor,\n      _ref$nodeColor = _ref.nodeColor,\n      nodeColor = _ref$nodeColor === void 0 ? '#fff' : _ref$nodeColor,\n      _ref$nodeClassName = _ref.nodeClassName,\n      nodeClassName = _ref$nodeClassName === void 0 ? '' : _ref$nodeClassName,\n      _ref$nodeBorderRadius = _ref.nodeBorderRadius,\n      nodeBorderRadius = _ref$nodeBorderRadius === void 0 ? 5 : _ref$nodeBorderRadius,\n      _ref$nodeStrokeWidth = _ref.nodeStrokeWidth,\n      nodeStrokeWidth = _ref$nodeStrokeWidth === void 0 ? 2 : _ref$nodeStrokeWidth,\n      _ref$maskColor = _ref.maskColor,\n      maskColor = _ref$maskColor === void 0 ? 'rgb(240, 242, 243, 0.7)' : _ref$maskColor;\n\n  var _useStore = useStore(selector, shallow),\n      viewBBox = _useStore.viewBBox,\n      nodes = _useStore.nodes;\n\n  var elementWidth = (_style$width = style === null || style === void 0 ? void 0 : style.width) !== null && _style$width !== void 0 ? _style$width : defaultWidth;\n  var elementHeight = (_style$height = style === null || style === void 0 ? void 0 : style.height) !== null && _style$height !== void 0 ? _style$height : defaultHeight;\n  var nodeColorFunc = getAttrFunction(nodeColor);\n  var nodeStrokeColorFunc = getAttrFunction(nodeStrokeColor);\n  var nodeClassNameFunc = getAttrFunction(nodeClassName);\n  var boundingRect = nodes.length > 0 ? getBoundsofRects(getRectOfNodes(nodes), viewBBox) : viewBBox;\n  var scaledWidth = boundingRect.width / elementWidth;\n  var scaledHeight = boundingRect.height / elementHeight;\n  var viewScale = Math.max(scaledWidth, scaledHeight);\n  var viewWidth = viewScale * elementWidth;\n  var viewHeight = viewScale * elementHeight;\n  var offset = 5 * viewScale;\n  var x = boundingRect.x - (viewWidth - boundingRect.width) / 2 - offset;\n  var y = boundingRect.y - (viewHeight - boundingRect.height) / 2 - offset;\n  var width = viewWidth + offset * 2;\n  var height = viewHeight + offset * 2;\n  var shapeRendering = typeof window === 'undefined' || !!window.chrome ? 'crispEdges' : 'geometricPrecision';\n  return /*#__PURE__*/React.createElement(\"svg\", {\n    width: elementWidth,\n    height: elementHeight,\n    viewBox: \"\".concat(x, \" \").concat(y, \" \").concat(width, \" \").concat(height),\n    style: style,\n    className: cc(['react-flow__minimap', className])\n  }, nodes.filter(function (node) {\n    return !node.hidden && node.width && node.height;\n  }).map(function (node) {\n    var _node$positionAbsolut, _node$positionAbsolut2, _node$positionAbsolut3, _node$positionAbsolut4;\n\n    return /*#__PURE__*/React.createElement(MiniMapNode$1, {\n      key: node.id,\n      x: (_node$positionAbsolut = (_node$positionAbsolut2 = node.positionAbsolute) === null || _node$positionAbsolut2 === void 0 ? void 0 : _node$positionAbsolut2.x) !== null && _node$positionAbsolut !== void 0 ? _node$positionAbsolut : 0,\n      y: (_node$positionAbsolut3 = (_node$positionAbsolut4 = node.positionAbsolute) === null || _node$positionAbsolut4 === void 0 ? void 0 : _node$positionAbsolut4.y) !== null && _node$positionAbsolut3 !== void 0 ? _node$positionAbsolut3 : 0,\n      width: node.width,\n      height: node.height,\n      style: node.style,\n      className: nodeClassNameFunc(node),\n      color: nodeColorFunc(node),\n      borderRadius: nodeBorderRadius,\n      strokeColor: nodeStrokeColorFunc(node),\n      strokeWidth: nodeStrokeWidth,\n      shapeRendering: shapeRendering\n    });\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    className: \"react-flow__minimap-mask\",\n    d: \"M\".concat(x - offset, \",\").concat(y - offset, \"h\").concat(width + offset * 2, \"v\").concat(height + offset * 2, \"h\").concat(-width - offset * 2, \"z\\n        M\").concat(viewBBox.x, \",\").concat(viewBBox.y, \"h\").concat(viewBBox.width, \"v\").concat(viewBBox.height, \"h\").concat(-viewBBox.width, \"z\"),\n    fill: maskColor,\n    fillRule: \"evenodd\"\n  }));\n};\n\nMiniMap.displayName = 'MiniMap';\nvar index = /*#__PURE__*/memo(MiniMap);\n\nexport { index as default };\n//# sourceMappingURL=index2.js.map\n","import { a as _defineProperty, H as BackgroundVariant, _ as _slicedToArray, b as useStore } from './index-a12c80bd.js';\nimport React, { memo, useRef, useState, useEffect } from 'react';\nimport cc from 'classcat';\nimport 'zustand';\nimport 'zustand/context';\nimport 'd3-zoom';\n\nvar createGridLinesPath = function createGridLinesPath(size, strokeWidth, stroke) {\n  return /*#__PURE__*/React.createElement(\"path\", {\n    stroke: stroke,\n    strokeWidth: strokeWidth,\n    d: \"M\".concat(size / 2, \" 0 V\").concat(size, \" M0 \").concat(size / 2, \" H\").concat(size)\n  });\n};\nvar createGridDotsPath = function createGridDotsPath(size, fill) {\n  return /*#__PURE__*/React.createElement(\"circle\", {\n    cx: size,\n    cy: size,\n    r: size,\n    fill: fill\n  });\n};\n\nvar _defaultColors;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nvar defaultColors = (_defaultColors = {}, _defineProperty(_defaultColors, BackgroundVariant.Dots, '#81818a'), _defineProperty(_defaultColors, BackgroundVariant.Lines, '#eee'), _defaultColors);\n\nvar transformSelector = function transformSelector(s) {\n  return s.transform;\n};\n\nvar Background = function Background(_ref) {\n  var _ref$variant = _ref.variant,\n      variant = _ref$variant === void 0 ? BackgroundVariant.Dots : _ref$variant,\n      _ref$gap = _ref.gap,\n      gap = _ref$gap === void 0 ? 15 : _ref$gap,\n      _ref$size = _ref.size,\n      size = _ref$size === void 0 ? 0.4 : _ref$size,\n      color = _ref.color,\n      style = _ref.style,\n      className = _ref.className;\n  var ref = useRef(null);\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      patternId = _useState2[0],\n      setPatternId = _useState2[1];\n\n  var _useStore = useStore(transformSelector),\n      _useStore2 = _slicedToArray(_useStore, 3),\n      tX = _useStore2[0],\n      tY = _useStore2[1],\n      tScale = _useStore2[2];\n\n  useEffect(function () {\n    // when there are multiple flows on a page we need to make sure that every background gets its own pattern.\n    var bgs = document.querySelectorAll('.react-flow__background');\n    var index = Array.from(bgs).findIndex(function (bg) {\n      return bg === ref.current;\n    });\n    setPatternId(\"pattern-\".concat(index));\n  }, []);\n  var scaledGap = gap * tScale || 1;\n  var xOffset = tX % scaledGap;\n  var yOffset = tY % scaledGap;\n  var isLines = variant === BackgroundVariant.Lines;\n  var bgColor = color ? color : defaultColors[variant];\n  var path = isLines ? createGridLinesPath(scaledGap, size, bgColor) : createGridDotsPath(size * tScale, bgColor);\n  return /*#__PURE__*/React.createElement(\"svg\", {\n    className: cc(['react-flow__background', 'react-flow__container', className]),\n    style: _objectSpread(_objectSpread({}, style), {}, {\n      width: '100%',\n      height: '100%'\n    }),\n    ref: ref\n  }, patternId && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"pattern\", {\n    id: patternId,\n    x: xOffset,\n    y: yOffset,\n    width: scaledGap,\n    height: scaledGap,\n    patternUnits: \"userSpaceOnUse\"\n  }, path), /*#__PURE__*/React.createElement(\"rect\", {\n    x: \"0\",\n    y: \"0\",\n    width: \"100%\",\n    height: \"100%\",\n    fill: \"url(#\".concat(patternId, \")\")\n  })));\n};\n\nBackground.displayName = 'Background';\nvar index = /*#__PURE__*/memo(Background);\n\nexport { index as default };\n//# sourceMappingURL=index3.js.map\n","export function resolveUrl(url, baseUrl) {\n    // url is absolute already\n    if (url.match(/^[a-z]+:\\/\\//i)) {\n        return url;\n    }\n    // url is absolute already, without protocol\n    if (url.match(/^\\/\\//)) {\n        return window.location.protocol + url;\n    }\n    // dataURI, mailto:, tel:, etc.\n    if (url.match(/^[a-z]+:/i)) {\n        return url;\n    }\n    const doc = document.implementation.createHTMLDocument();\n    const base = doc.createElement('base');\n    const a = doc.createElement('a');\n    doc.head.appendChild(base);\n    doc.body.appendChild(a);\n    if (baseUrl) {\n        base.href = baseUrl;\n    }\n    a.href = url;\n    return a.href;\n}\nexport const uuid = (() => {\n    // generate uuid for className of pseudo elements.\n    // We should not use GUIDs, otherwise pseudo elements sometimes cannot be captured.\n    let counter = 0;\n    // ref: http://stackoverflow.com/a/6248722/2519373\n    const random = () => \n    // eslint-disable-next-line no-bitwise\n    `0000${((Math.random() * 36 ** 4) << 0).toString(36)}`.slice(-4);\n    return () => {\n        counter += 1;\n        return `u${random()}${counter}`;\n    };\n})();\nexport function delay(ms) {\n    return (args) => new Promise((resolve) => {\n        setTimeout(() => resolve(args), ms);\n    });\n}\nexport function toArray(arrayLike) {\n    const arr = [];\n    for (let i = 0, l = arrayLike.length; i < l; i++) {\n        arr.push(arrayLike[i]);\n    }\n    return arr;\n}\nfunction px(node, styleProperty) {\n    const win = node.ownerDocument.defaultView || window;\n    const val = win.getComputedStyle(node).getPropertyValue(styleProperty);\n    return val ? parseFloat(val.replace('px', '')) : 0;\n}\nfunction getNodeWidth(node) {\n    const leftBorder = px(node, 'border-left-width');\n    const rightBorder = px(node, 'border-right-width');\n    return node.clientWidth + leftBorder + rightBorder;\n}\nfunction getNodeHeight(node) {\n    const topBorder = px(node, 'border-top-width');\n    const bottomBorder = px(node, 'border-bottom-width');\n    return node.clientHeight + topBorder + bottomBorder;\n}\nexport function getImageSize(targetNode, options = {}) {\n    const width = options.width || getNodeWidth(targetNode);\n    const height = options.height || getNodeHeight(targetNode);\n    return { width, height };\n}\nexport function getPixelRatio() {\n    let ratio;\n    let FINAL_PROCESS;\n    try {\n        FINAL_PROCESS = process;\n    }\n    catch (e) {\n        // pass\n    }\n    const val = FINAL_PROCESS && FINAL_PROCESS.env\n        ? FINAL_PROCESS.env.devicePixelRatio\n        : null;\n    if (val) {\n        ratio = parseInt(val, 10);\n        if (Number.isNaN(ratio)) {\n            ratio = 1;\n        }\n    }\n    return ratio || window.devicePixelRatio || 1;\n}\n// @see https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas#maximum_canvas_size\nconst canvasDimensionLimit = 16384;\nexport function checkCanvasDimensions(canvas) {\n    if (canvas.width > canvasDimensionLimit ||\n        canvas.height > canvasDimensionLimit) {\n        if (canvas.width > canvasDimensionLimit &&\n            canvas.height > canvasDimensionLimit) {\n            if (canvas.width > canvas.height) {\n                canvas.height *= canvasDimensionLimit / canvas.width;\n                canvas.width = canvasDimensionLimit;\n            }\n            else {\n                canvas.width *= canvasDimensionLimit / canvas.height;\n                canvas.height = canvasDimensionLimit;\n            }\n        }\n        else if (canvas.width > canvasDimensionLimit) {\n            canvas.height *= canvasDimensionLimit / canvas.width;\n            canvas.width = canvasDimensionLimit;\n        }\n        else {\n            canvas.width *= canvasDimensionLimit / canvas.height;\n            canvas.height = canvasDimensionLimit;\n        }\n    }\n}\nexport function canvasToBlob(canvas, options = {}) {\n    if (canvas.toBlob) {\n        return new Promise((resolve) => {\n            canvas.toBlob(resolve, options.type ? options.type : 'image/png', options.quality ? options.quality : 1);\n        });\n    }\n    return new Promise((resolve) => {\n        const binaryString = window.atob(canvas\n            .toDataURL(options.type ? options.type : undefined, options.quality ? options.quality : undefined)\n            .split(',')[1]);\n        const len = binaryString.length;\n        const binaryArray = new Uint8Array(len);\n        for (let i = 0; i < len; i += 1) {\n            binaryArray[i] = binaryString.charCodeAt(i);\n        }\n        resolve(new Blob([binaryArray], {\n            type: options.type ? options.type : 'image/png',\n        }));\n    });\n}\nexport function createImage(url) {\n    return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.decode = () => resolve(img);\n        img.onload = () => resolve(img);\n        img.onerror = reject;\n        img.crossOrigin = 'anonymous';\n        img.decoding = 'async';\n        img.src = url;\n    });\n}\nexport async function svgToDataURL(svg) {\n    return Promise.resolve()\n        .then(() => new XMLSerializer().serializeToString(svg))\n        .then(encodeURIComponent)\n        .then((html) => `data:image/svg+xml;charset=utf-8,${html}`);\n}\nexport async function nodeToDataURL(node, width, height) {\n    const xmlns = 'http://www.w3.org/2000/svg';\n    const svg = document.createElementNS(xmlns, 'svg');\n    const foreignObject = document.createElementNS(xmlns, 'foreignObject');\n    svg.setAttribute('width', `${width}`);\n    svg.setAttribute('height', `${height}`);\n    svg.setAttribute('viewBox', `0 0 ${width} ${height}`);\n    foreignObject.setAttribute('width', '100%');\n    foreignObject.setAttribute('height', '100%');\n    foreignObject.setAttribute('x', '0');\n    foreignObject.setAttribute('y', '0');\n    foreignObject.setAttribute('externalResourcesRequired', 'true');\n    svg.appendChild(foreignObject);\n    foreignObject.appendChild(node);\n    return svgToDataURL(svg);\n}\nexport const isInstanceOfElement = (node, instance) => {\n    if (node instanceof instance)\n        return true;\n    const nodePrototype = Object.getPrototypeOf(node);\n    if (nodePrototype === null)\n        return false;\n    return (nodePrototype.constructor.name === instance.name ||\n        isInstanceOfElement(nodePrototype, instance));\n};\n//# sourceMappingURL=util.js.map","import { uuid, toArray } from './util';\nfunction formatCSSText(style) {\n    const content = style.getPropertyValue('content');\n    return `${style.cssText} content: '${content.replace(/'|\"/g, '')}';`;\n}\nfunction formatCSSProperties(style) {\n    return toArray(style)\n        .map((name) => {\n        const value = style.getPropertyValue(name);\n        const priority = style.getPropertyPriority(name);\n        return `${name}: ${value}${priority ? ' !important' : ''};`;\n    })\n        .join(' ');\n}\nfunction getPseudoElementStyle(className, pseudo, style) {\n    const selector = `.${className}:${pseudo}`;\n    const cssText = style.cssText\n        ? formatCSSText(style)\n        : formatCSSProperties(style);\n    return document.createTextNode(`${selector}{${cssText}}`);\n}\nfunction clonePseudoElement(nativeNode, clonedNode, pseudo) {\n    const style = window.getComputedStyle(nativeNode, pseudo);\n    const content = style.getPropertyValue('content');\n    if (content === '' || content === 'none') {\n        return;\n    }\n    const className = uuid();\n    try {\n        clonedNode.className = `${clonedNode.className} ${className}`;\n    }\n    catch (err) {\n        return;\n    }\n    const styleElement = document.createElement('style');\n    styleElement.appendChild(getPseudoElementStyle(className, pseudo, style));\n    clonedNode.appendChild(styleElement);\n}\nexport function clonePseudoElements(nativeNode, clonedNode) {\n    clonePseudoElement(nativeNode, clonedNode, ':before');\n    clonePseudoElement(nativeNode, clonedNode, ':after');\n}\n//# sourceMappingURL=clone-pseudos.js.map","const WOFF = 'application/font-woff';\nconst JPEG = 'image/jpeg';\nconst mimes = {\n    woff: WOFF,\n    woff2: WOFF,\n    ttf: 'application/font-truetype',\n    eot: 'application/vnd.ms-fontobject',\n    png: 'image/png',\n    jpg: JPEG,\n    jpeg: JPEG,\n    gif: 'image/gif',\n    tiff: 'image/tiff',\n    svg: 'image/svg+xml',\n    webp: 'image/webp',\n};\nfunction getExtension(url) {\n    const match = /\\.([^./]*?)$/g.exec(url);\n    return match ? match[1] : '';\n}\nexport function getMimeType(url) {\n    const extension = getExtension(url).toLowerCase();\n    return mimes[extension] || '';\n}\n//# sourceMappingURL=mimes.js.map","function getContentFromDataUrl(dataURL) {\n    return dataURL.split(/,/)[1];\n}\nexport function isDataUrl(url) {\n    return url.search(/^(data:)/) !== -1;\n}\nexport function makeDataUrl(content, mimeType) {\n    return `data:${mimeType};base64,${content}`;\n}\nexport async function fetchAsDataURL(url, init, process) {\n    const res = await fetch(url, init);\n    if (res.status === 404) {\n        throw new Error(`Resource \"${res.url}\" not found`);\n    }\n    const blob = await res.blob();\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onerror = reject;\n        reader.onloadend = () => {\n            try {\n                resolve(process({ res, result: reader.result }));\n            }\n            catch (error) {\n                reject(error);\n            }\n        };\n        reader.readAsDataURL(blob);\n    });\n}\nconst cache = {};\nfunction getCacheKey(url, contentType, includeQueryParams) {\n    let key = url.replace(/\\?.*/, '');\n    if (includeQueryParams) {\n        key = url;\n    }\n    // font resource\n    if (/ttf|otf|eot|woff2?/i.test(key)) {\n        key = key.replace(/.*\\//, '');\n    }\n    return contentType ? `[${contentType}]${key}` : key;\n}\nexport async function resourceToDataURL(resourceUrl, contentType, options) {\n    const cacheKey = getCacheKey(resourceUrl, contentType, options.includeQueryParams);\n    if (cache[cacheKey] != null) {\n        return cache[cacheKey];\n    }\n    // ref: https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Bypassing_the_cache\n    if (options.cacheBust) {\n        // eslint-disable-next-line no-param-reassign\n        resourceUrl += (/\\?/.test(resourceUrl) ? '&' : '?') + new Date().getTime();\n    }\n    let dataURL;\n    try {\n        const content = await fetchAsDataURL(resourceUrl, options.fetchRequestInit, ({ res, result }) => {\n            if (!contentType) {\n                // eslint-disable-next-line no-param-reassign\n                contentType = res.headers.get('Content-Type') || '';\n            }\n            return getContentFromDataUrl(result);\n        });\n        dataURL = makeDataUrl(content, contentType);\n    }\n    catch (error) {\n        dataURL = options.imagePlaceholder || '';\n        let msg = `Failed to fetch resource: ${resourceUrl}`;\n        if (error) {\n            msg = typeof error === 'string' ? error : error.message;\n        }\n        if (msg) {\n            console.warn(msg);\n        }\n    }\n    cache[cacheKey] = dataURL;\n    return dataURL;\n}\n//# sourceMappingURL=dataurl.js.map","import { clonePseudoElements } from './clone-pseudos';\nimport { createImage, toArray, isInstanceOfElement } from './util';\nimport { getMimeType } from './mimes';\nimport { resourceToDataURL } from './dataurl';\nasync function cloneCanvasElement(canvas) {\n    const dataURL = canvas.toDataURL();\n    if (dataURL === 'data:,') {\n        return canvas.cloneNode(false);\n    }\n    return createImage(dataURL);\n}\nasync function cloneVideoElement(video, options) {\n    if (video.currentSrc) {\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n        canvas.width = video.clientWidth;\n        canvas.height = video.clientHeight;\n        ctx === null || ctx === void 0 ? void 0 : ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n        const dataURL = canvas.toDataURL();\n        return createImage(dataURL);\n    }\n    const poster = video.poster;\n    const contentType = getMimeType(poster);\n    const dataURL = await resourceToDataURL(poster, contentType, options);\n    return createImage(dataURL);\n}\nasync function cloneIFrameElement(iframe) {\n    var _a;\n    try {\n        if ((_a = iframe === null || iframe === void 0 ? void 0 : iframe.contentDocument) === null || _a === void 0 ? void 0 : _a.body) {\n            return (await cloneNode(iframe.contentDocument.body, {}, true));\n        }\n    }\n    catch (_b) {\n        // Failed to clone iframe\n    }\n    return iframe.cloneNode(false);\n}\nasync function cloneSingleNode(node, options) {\n    if (isInstanceOfElement(node, HTMLCanvasElement)) {\n        return cloneCanvasElement(node);\n    }\n    if (isInstanceOfElement(node, HTMLVideoElement)) {\n        return cloneVideoElement(node, options);\n    }\n    if (isInstanceOfElement(node, HTMLIFrameElement)) {\n        return cloneIFrameElement(node);\n    }\n    return node.cloneNode(false);\n}\nconst isSlotElement = (node) => node.tagName != null && node.tagName.toUpperCase() === 'SLOT';\nasync function cloneChildren(nativeNode, clonedNode, options) {\n    var _a, _b;\n    let children = [];\n    if (isSlotElement(nativeNode) && nativeNode.assignedNodes) {\n        children = toArray(nativeNode.assignedNodes());\n    }\n    else if (isInstanceOfElement(nativeNode, HTMLIFrameElement) &&\n        ((_a = nativeNode.contentDocument) === null || _a === void 0 ? void 0 : _a.body)) {\n        children = toArray(nativeNode.contentDocument.body.childNodes);\n    }\n    else {\n        children = toArray(((_b = nativeNode.shadowRoot) !== null && _b !== void 0 ? _b : nativeNode).childNodes);\n    }\n    if (children.length === 0 ||\n        isInstanceOfElement(nativeNode, HTMLVideoElement)) {\n        return clonedNode;\n    }\n    await children.reduce((deferred, child) => deferred\n        .then(() => cloneNode(child, options))\n        .then((clonedChild) => {\n        if (clonedChild) {\n            clonedNode.appendChild(clonedChild);\n        }\n    }), Promise.resolve());\n    return clonedNode;\n}\nfunction cloneCSSStyle(nativeNode, clonedNode) {\n    const targetStyle = clonedNode.style;\n    if (!targetStyle) {\n        return;\n    }\n    const sourceStyle = window.getComputedStyle(nativeNode);\n    if (sourceStyle.cssText) {\n        targetStyle.cssText = sourceStyle.cssText;\n        targetStyle.transformOrigin = sourceStyle.transformOrigin;\n    }\n    else {\n        toArray(sourceStyle).forEach((name) => {\n            let value = sourceStyle.getPropertyValue(name);\n            if (name === 'font-size' && value.endsWith('px')) {\n                const reducedFont = Math.floor(parseFloat(value.substring(0, value.length - 2))) - 0.1;\n                value = `${reducedFont}px`;\n            }\n            if (isInstanceOfElement(nativeNode, HTMLIFrameElement) &&\n                name === 'display' &&\n                value === 'inline') {\n                value = 'block';\n            }\n            if (name === 'd' && clonedNode.getAttribute('d')) {\n                value = `path(${clonedNode.getAttribute('d')})`;\n            }\n            targetStyle.setProperty(name, value, sourceStyle.getPropertyPriority(name));\n        });\n    }\n}\nfunction cloneInputValue(nativeNode, clonedNode) {\n    if (isInstanceOfElement(nativeNode, HTMLTextAreaElement)) {\n        clonedNode.innerHTML = nativeNode.value;\n    }\n    if (isInstanceOfElement(nativeNode, HTMLInputElement)) {\n        clonedNode.setAttribute('value', nativeNode.value);\n    }\n}\nfunction cloneSelectValue(nativeNode, clonedNode) {\n    if (isInstanceOfElement(nativeNode, HTMLSelectElement)) {\n        const clonedSelect = clonedNode;\n        const selectedOption = Array.from(clonedSelect.children).find((child) => nativeNode.value === child.getAttribute('value'));\n        if (selectedOption) {\n            selectedOption.setAttribute('selected', '');\n        }\n    }\n}\nfunction decorate(nativeNode, clonedNode) {\n    if (isInstanceOfElement(clonedNode, Element)) {\n        cloneCSSStyle(nativeNode, clonedNode);\n        clonePseudoElements(nativeNode, clonedNode);\n        cloneInputValue(nativeNode, clonedNode);\n        cloneSelectValue(nativeNode, clonedNode);\n    }\n    return clonedNode;\n}\nasync function ensureSVGSymbols(clone, options) {\n    const uses = clone.querySelectorAll ? clone.querySelectorAll('use') : [];\n    if (uses.length === 0) {\n        return clone;\n    }\n    const processedDefs = {};\n    for (let i = 0; i < uses.length; i++) {\n        const use = uses[i];\n        const id = use.getAttribute('xlink:href');\n        if (id) {\n            const exist = clone.querySelector(id);\n            const definition = document.querySelector(id);\n            if (!exist && definition && !processedDefs[id]) {\n                // eslint-disable-next-line no-await-in-loop\n                processedDefs[id] = (await cloneNode(definition, options, true));\n            }\n        }\n    }\n    const nodes = Object.values(processedDefs);\n    if (nodes.length) {\n        const ns = 'http://www.w3.org/1999/xhtml';\n        const svg = document.createElementNS(ns, 'svg');\n        svg.setAttribute('xmlns', ns);\n        svg.style.position = 'absolute';\n        svg.style.width = '0';\n        svg.style.height = '0';\n        svg.style.overflow = 'hidden';\n        svg.style.display = 'none';\n        const defs = document.createElementNS(ns, 'defs');\n        svg.appendChild(defs);\n        for (let i = 0; i < nodes.length; i++) {\n            defs.appendChild(nodes[i]);\n        }\n        clone.appendChild(svg);\n    }\n    return clone;\n}\nexport async function cloneNode(node, options, isRoot) {\n    if (!isRoot && options.filter && !options.filter(node)) {\n        return null;\n    }\n    return Promise.resolve(node)\n        .then((clonedNode) => cloneSingleNode(clonedNode, options))\n        .then((clonedNode) => cloneChildren(node, clonedNode, options))\n        .then((clonedNode) => decorate(node, clonedNode))\n        .then((clonedNode) => ensureSVGSymbols(clonedNode, options));\n}\n//# sourceMappingURL=clone-node.js.map","import { resolveUrl } from './util';\nimport { getMimeType } from './mimes';\nimport { isDataUrl, makeDataUrl, resourceToDataURL } from './dataurl';\nconst URL_REGEX = /url\\((['\"]?)([^'\"]+?)\\1\\)/g;\nconst URL_WITH_FORMAT_REGEX = /url\\([^)]+\\)\\s*format\\(([\"']?)([^\"']+)\\1\\)/g;\nconst FONT_SRC_REGEX = /src:\\s*(?:url\\([^)]+\\)\\s*format\\([^)]+\\)[,;]\\s*)+/g;\nfunction toRegex(url) {\n    // eslint-disable-next-line no-useless-escape\n    const escaped = url.replace(/([.*+?^${}()|\\[\\]\\/\\\\])/g, '\\\\$1');\n    return new RegExp(`(url\\\\(['\"]?)(${escaped})(['\"]?\\\\))`, 'g');\n}\nexport function parseURLs(cssText) {\n    const urls = [];\n    cssText.replace(URL_REGEX, (raw, quotation, url) => {\n        urls.push(url);\n        return raw;\n    });\n    return urls.filter((url) => !isDataUrl(url));\n}\nexport async function embed(cssText, resourceURL, baseURL, options, getContentFromUrl) {\n    try {\n        const resolvedURL = baseURL ? resolveUrl(resourceURL, baseURL) : resourceURL;\n        const contentType = getMimeType(resourceURL);\n        let dataURL;\n        if (getContentFromUrl) {\n            const content = await getContentFromUrl(resolvedURL);\n            dataURL = makeDataUrl(content, contentType);\n        }\n        else {\n            dataURL = await resourceToDataURL(resolvedURL, contentType, options);\n        }\n        return cssText.replace(toRegex(resourceURL), `$1${dataURL}$3`);\n    }\n    catch (error) {\n        // pass\n    }\n    return cssText;\n}\nfunction filterPreferredFontFormat(str, { preferredFontFormat }) {\n    return !preferredFontFormat\n        ? str\n        : str.replace(FONT_SRC_REGEX, (match) => {\n            // eslint-disable-next-line no-constant-condition\n            while (true) {\n                const [src, , format] = URL_WITH_FORMAT_REGEX.exec(match) || [];\n                if (!format) {\n                    return '';\n                }\n                if (format === preferredFontFormat) {\n                    return `src: ${src};`;\n                }\n            }\n        });\n}\nexport function shouldEmbed(url) {\n    return url.search(URL_REGEX) !== -1;\n}\nexport async function embedResources(cssText, baseUrl, options) {\n    if (!shouldEmbed(cssText)) {\n        return cssText;\n    }\n    const filteredCSSText = filterPreferredFontFormat(cssText, options);\n    const urls = parseURLs(filteredCSSText);\n    return urls.reduce((deferred, url) => deferred.then((css) => embed(css, url, baseUrl, options)), Promise.resolve(filteredCSSText));\n}\n//# sourceMappingURL=embed-resources.js.map","import { embedResources } from './embed-resources';\nimport { toArray, isInstanceOfElement } from './util';\nimport { isDataUrl, resourceToDataURL } from './dataurl';\nimport { getMimeType } from './mimes';\nasync function embedProp(propName, node, options) {\n    var _a;\n    const propValue = (_a = node.style) === null || _a === void 0 ? void 0 : _a.getPropertyValue(propName);\n    if (propValue) {\n        const cssString = await embedResources(propValue, null, options);\n        node.style.setProperty(propName, cssString, node.style.getPropertyPriority(propName));\n        return true;\n    }\n    return false;\n}\nasync function embedBackground(clonedNode, options) {\n    if (!(await embedProp('background', clonedNode, options))) {\n        await embedProp('background-image', clonedNode, options);\n    }\n    if (!(await embedProp('mask', clonedNode, options))) {\n        await embedProp('mask-image', clonedNode, options);\n    }\n}\nasync function embedImageNode(clonedNode, options) {\n    const isImageElement = isInstanceOfElement(clonedNode, HTMLImageElement);\n    if (!(isImageElement && !isDataUrl(clonedNode.src)) &&\n        !(isInstanceOfElement(clonedNode, SVGImageElement) &&\n            !isDataUrl(clonedNode.href.baseVal))) {\n        return;\n    }\n    const url = isImageElement ? clonedNode.src : clonedNode.href.baseVal;\n    const dataURL = await resourceToDataURL(url, getMimeType(url), options);\n    await new Promise((resolve, reject) => {\n        clonedNode.onload = resolve;\n        clonedNode.onerror = reject;\n        const image = clonedNode;\n        if (image.decode) {\n            image.decode = resolve;\n        }\n        if (image.loading === 'lazy') {\n            image.loading = 'eager';\n        }\n        if (isImageElement) {\n            clonedNode.srcset = '';\n            clonedNode.src = dataURL;\n        }\n        else {\n            clonedNode.href.baseVal = dataURL;\n        }\n    });\n}\nasync function embedChildren(clonedNode, options) {\n    const children = toArray(clonedNode.childNodes);\n    const deferreds = children.map((child) => embedImages(child, options));\n    await Promise.all(deferreds).then(() => clonedNode);\n}\nexport async function embedImages(clonedNode, options) {\n    if (isInstanceOfElement(clonedNode, Element)) {\n        await embedBackground(clonedNode, options);\n        await embedImageNode(clonedNode, options);\n        await embedChildren(clonedNode, options);\n    }\n}\n//# sourceMappingURL=embed-images.js.map","import { toArray } from './util';\nimport { fetchAsDataURL } from './dataurl';\nimport { shouldEmbed, embedResources } from './embed-resources';\nconst cssFetchCache = {};\nasync function fetchCSS(url) {\n    let cache = cssFetchCache[url];\n    if (cache != null) {\n        return cache;\n    }\n    const res = await fetch(url);\n    const cssText = await res.text();\n    cache = { url, cssText };\n    cssFetchCache[url] = cache;\n    return cache;\n}\nasync function embedFonts(data, options) {\n    let cssText = data.cssText;\n    const regexUrl = /url\\([\"']?([^\"')]+)[\"']?\\)/g;\n    const fontLocs = cssText.match(/url\\([^)]+\\)/g) || [];\n    const loadFonts = fontLocs.map(async (loc) => {\n        let url = loc.replace(regexUrl, '$1');\n        if (!url.startsWith('https://')) {\n            url = new URL(url, data.url).href;\n        }\n        return fetchAsDataURL(url, options.fetchRequestInit, ({ result }) => {\n            cssText = cssText.replace(loc, `url(${result})`);\n            return [loc, result];\n        });\n    });\n    return Promise.all(loadFonts).then(() => cssText);\n}\nfunction parseCSS(source) {\n    if (source == null) {\n        return [];\n    }\n    const result = [];\n    const commentsRegex = /(\\/\\*[\\s\\S]*?\\*\\/)/gi;\n    // strip out comments\n    let cssText = source.replace(commentsRegex, '');\n    // eslint-disable-next-line prefer-regex-literals\n    const keyframesRegex = new RegExp('((@.*?keyframes [\\\\s\\\\S]*?){([\\\\s\\\\S]*?}\\\\s*?)})', 'gi');\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n        const matches = keyframesRegex.exec(cssText);\n        if (matches === null) {\n            break;\n        }\n        result.push(matches[0]);\n    }\n    cssText = cssText.replace(keyframesRegex, '');\n    const importRegex = /@import[\\s\\S]*?url\\([^)]*\\)[\\s\\S]*?;/gi;\n    // to match css & media queries together\n    const combinedCSSRegex = '((\\\\s*?(?:\\\\/\\\\*[\\\\s\\\\S]*?\\\\*\\\\/)?\\\\s*?@media[\\\\s\\\\S]' +\n        '*?){([\\\\s\\\\S]*?)}\\\\s*?})|(([\\\\s\\\\S]*?){([\\\\s\\\\S]*?)})';\n    // unified regex\n    const unifiedRegex = new RegExp(combinedCSSRegex, 'gi');\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n        let matches = importRegex.exec(cssText);\n        if (matches === null) {\n            matches = unifiedRegex.exec(cssText);\n            if (matches === null) {\n                break;\n            }\n            else {\n                importRegex.lastIndex = unifiedRegex.lastIndex;\n            }\n        }\n        else {\n            unifiedRegex.lastIndex = importRegex.lastIndex;\n        }\n        result.push(matches[0]);\n    }\n    return result;\n}\nasync function getCSSRules(styleSheets, options) {\n    const ret = [];\n    const deferreds = [];\n    // First loop inlines imports\n    styleSheets.forEach((sheet) => {\n        if ('cssRules' in sheet) {\n            try {\n                toArray(sheet.cssRules || []).forEach((item, index) => {\n                    if (item.type === CSSRule.IMPORT_RULE) {\n                        let importIndex = index + 1;\n                        const url = item.href;\n                        const deferred = fetchCSS(url)\n                            .then((metadata) => embedFonts(metadata, options))\n                            .then((cssText) => parseCSS(cssText).forEach((rule) => {\n                            try {\n                                sheet.insertRule(rule, rule.startsWith('@import')\n                                    ? (importIndex += 1)\n                                    : sheet.cssRules.length);\n                            }\n                            catch (error) {\n                                console.error('Error inserting rule from remote css', {\n                                    rule,\n                                    error,\n                                });\n                            }\n                        }))\n                            .catch((e) => {\n                            console.error('Error loading remote css', e.toString());\n                        });\n                        deferreds.push(deferred);\n                    }\n                });\n            }\n            catch (e) {\n                const inline = styleSheets.find((a) => a.href == null) || document.styleSheets[0];\n                if (sheet.href != null) {\n                    deferreds.push(fetchCSS(sheet.href)\n                        .then((metadata) => embedFonts(metadata, options))\n                        .then((cssText) => parseCSS(cssText).forEach((rule) => {\n                        inline.insertRule(rule, sheet.cssRules.length);\n                    }))\n                        .catch((err) => {\n                        console.error('Error loading remote stylesheet', err);\n                    }));\n                }\n                console.error('Error inlining remote css file', e);\n            }\n        }\n    });\n    return Promise.all(deferreds).then(() => {\n        // Second loop parses rules\n        styleSheets.forEach((sheet) => {\n            if ('cssRules' in sheet) {\n                try {\n                    toArray(sheet.cssRules || []).forEach((item) => {\n                        ret.push(item);\n                    });\n                }\n                catch (e) {\n                    console.error(`Error while reading CSS rules from ${sheet.href}`, e);\n                }\n            }\n        });\n        return ret;\n    });\n}\nfunction getWebFontRules(cssRules) {\n    return cssRules\n        .filter((rule) => rule.type === CSSRule.FONT_FACE_RULE)\n        .filter((rule) => shouldEmbed(rule.style.getPropertyValue('src')));\n}\nasync function parseWebFontRules(node, options) {\n    if (node.ownerDocument == null) {\n        throw new Error('Provided element is not within a Document');\n    }\n    const styleSheets = toArray(node.ownerDocument.styleSheets);\n    const cssRules = await getCSSRules(styleSheets, options);\n    return getWebFontRules(cssRules);\n}\nexport async function getWebFontCSS(node, options) {\n    const rules = await parseWebFontRules(node, options);\n    const cssTexts = await Promise.all(rules.map((rule) => {\n        const baseUrl = rule.parentStyleSheet ? rule.parentStyleSheet.href : null;\n        return embedResources(rule.cssText, baseUrl, options);\n    }));\n    return cssTexts.join('\\n');\n}\nexport async function embedWebFonts(clonedNode, options) {\n    const cssText = options.fontEmbedCSS != null\n        ? options.fontEmbedCSS\n        : options.skipFonts\n            ? null\n            : await getWebFontCSS(clonedNode, options);\n    if (cssText) {\n        const styleNode = document.createElement('style');\n        const sytleContent = document.createTextNode(cssText);\n        styleNode.appendChild(sytleContent);\n        if (clonedNode.firstChild) {\n            clonedNode.insertBefore(styleNode, clonedNode.firstChild);\n        }\n        else {\n            clonedNode.appendChild(styleNode);\n        }\n    }\n}\n//# sourceMappingURL=embed-webfonts.js.map","import { cloneNode } from './clone-node';\nimport { embedImages } from './embed-images';\nimport { applyStyle } from './apply-style';\nimport { embedWebFonts, getWebFontCSS } from './embed-webfonts';\nimport { getImageSize, getPixelRatio, createImage, canvasToBlob, nodeToDataURL, checkCanvasDimensions, } from './util';\nexport async function toSvg(node, options = {}) {\n    const { width, height } = getImageSize(node, options);\n    const clonedNode = (await cloneNode(node, options, true));\n    await embedWebFonts(clonedNode, options);\n    await embedImages(clonedNode, options);\n    applyStyle(clonedNode, options);\n    const datauri = await nodeToDataURL(clonedNode, width, height);\n    return datauri;\n}\nexport async function toCanvas(node, options = {}) {\n    const { width, height } = getImageSize(node, options);\n    const svg = await toSvg(node, options);\n    const img = await createImage(svg);\n    const canvas = document.createElement('canvas');\n    const context = canvas.getContext('2d');\n    const ratio = options.pixelRatio || getPixelRatio();\n    const canvasWidth = options.canvasWidth || width;\n    const canvasHeight = options.canvasHeight || height;\n    canvas.width = canvasWidth * ratio;\n    canvas.height = canvasHeight * ratio;\n    if (!options.skipAutoScale) {\n        checkCanvasDimensions(canvas);\n    }\n    canvas.style.width = `${canvasWidth}`;\n    canvas.style.height = `${canvasHeight}`;\n    if (options.backgroundColor) {\n        context.fillStyle = options.backgroundColor;\n        context.fillRect(0, 0, canvas.width, canvas.height);\n    }\n    context.drawImage(img, 0, 0, canvas.width, canvas.height);\n    return canvas;\n}\nexport async function toPixelData(node, options = {}) {\n    const { width, height } = getImageSize(node, options);\n    const canvas = await toCanvas(node, options);\n    const ctx = canvas.getContext('2d');\n    return ctx.getImageData(0, 0, width, height).data;\n}\nexport async function toPng(node, options = {}) {\n    const canvas = await toCanvas(node, options);\n    return canvas.toDataURL();\n}\nexport async function toJpeg(node, options = {}) {\n    const canvas = await toCanvas(node, options);\n    return canvas.toDataURL('image/jpeg', options.quality || 1);\n}\nexport async function toBlob(node, options = {}) {\n    const canvas = await toCanvas(node, options);\n    const blob = await canvasToBlob(canvas);\n    return blob;\n}\nexport async function getFontEmbedCSS(node, options = {}) {\n    return getWebFontCSS(node, options);\n}\n//# sourceMappingURL=index.js.map","export function applyStyle(node, options) {\n    const { style } = node;\n    if (options.backgroundColor) {\n        style.backgroundColor = options.backgroundColor;\n    }\n    if (options.width) {\n        style.width = `${options.width}px`;\n    }\n    if (options.height) {\n        style.height = `${options.height}px`;\n    }\n    const manual = options.style;\n    if (manual != null) {\n        Object.keys(manual).forEach((key) => {\n            style[key] = manual[key];\n        });\n    }\n    return node;\n}\n//# sourceMappingURL=apply-style.js.map","/**\n * A Reactflow diagram component for Dash.\n * Renders ReactFlow diagrams from text definitions using ReactFlow version 10 (Dash does not support React version for ReactFlow version 12).\n */\n \nimport React, { Component, useCallback, useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport ReactFlow, { \n    MiniMap, \n    Controls, \n    Background, \n    ReactFlowProvider, \n    useReactFlow,\n    getRectOfNodes,\n    getTransformForBounds \n} from 'react-flow-renderer';\nimport { toPng } from 'html-to-image';\n\nconst FlowWithDownload = ({ id, nodes, edges, style, export_trigger, ...props }) => {\n    const reactFlowInstance = useReactFlow();\n    const [lastExportTrigger, setLastExportTrigger] = useState(export_trigger);\n\n    const generateImage = useCallback(() => {\n        console.log('Starting image generation process...');\n        \n        if (!reactFlowInstance) {\n            console.error('Flow instance not ready');\n            return;\n        }\n\n        try {\n            const flowNodes = reactFlowInstance.getNodes();\n            const nodesBounds = getRectOfNodes(flowNodes);\n            console.log('Node bounds:', nodesBounds);\n\n            const imageWidth = Math.max(nodesBounds.width + 200, 800);\n            const imageHeight = Math.max(nodesBounds.height + 200, 600);\n            \n            const transform = getTransformForBounds(\n                nodesBounds,\n                imageWidth,\n                imageHeight,\n                0.5,\n                2\n            );\n\n            const flowElement = document.querySelector('.react-flow__viewport');\n            if (!flowElement) {\n                console.error('Flow element not found');\n                return;\n            }\n\n            toPng(flowElement, {\n                backgroundColor: '#f8f8fa',\n                width: imageWidth,\n                height: imageHeight,\n                style: {\n                    width: String(imageWidth),\n                    height: String(imageHeight),\n                    transform: `translate(${transform[0]}px, ${transform[1]}px) scale(${transform[2]})`,\n                }\n            })\n            .then((dataUrl) => {\n                const now = new Date();\n                const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, \"0\")}-${String(now.getDate()).padStart(2, \"0\")}`;\n                const timeStr = `${String(now.getHours()).padStart(2, \"0\")}${String(now.getMinutes()).padStart(2, \"0\")}${String(now.getSeconds()).padStart(2, \"0\")}`;\n                const fileName = `flowchart_${dateStr}_${timeStr}.png`;\n\n                const a = document.createElement(\"a\");\n                a.setAttribute(\"download\", fileName);\n                a.setAttribute(\"href\", dataUrl);\n                a.click();\n                console.log('Export completed successfully');\n            })\n            .catch((error) => {\n                console.error('Error in toPng conversion:', error);\n            });\n        } catch (error) {\n            console.error('Error in generateImage:', error);\n        }\n    }, [reactFlowInstance]);\n\n    // Watch for changes to export_trigger and trigger export\n    useEffect(() => {\n        if (export_trigger !== lastExportTrigger) {\n            console.log('Export triggered');\n            generateImage();\n            setLastExportTrigger(export_trigger);\n            // Report back that the export was triggered\n            if (props.setProps) {\n                props.setProps({ export_trigger: export_trigger });\n            }\n        }\n    }, [export_trigger, generateImage, lastExportTrigger, props.setProps]);\n\n    return (\n        <div id={id} style={{ width: '100%', height: '100%', position: 'relative' }}>\n            <ReactFlow\n                nodes={nodes}\n                edges={edges}\n                {...props}\n            >\n                <Controls />\n                <MiniMap />\n                <Background />\n            </ReactFlow>\n        </div>\n    );\n};\n\nexport default class Reactflow extends Component {\n    render() {\n        const {\n            id,\n            nodes,\n            edges,\n            node_types,\n            edge_types,\n            min_zoom,\n            max_zoom,\n            default_zoom,\n            default_position,\n            fit_view,\n            snap_to_grid,\n            snap_grid,\n            nodes_draggable,\n            nodes_connectable,\n            elements_selectable,\n            pan_on_drag,\n            pan_on_scroll,\n            zoom_on_scroll,\n            zoom_on_pinch,\n            connection_mode,\n            style,\n            className,\n            export_trigger,\n            setProps\n        } = this.props;\n\n        return (\n            <div style={style}>\n                <ReactFlowProvider>\n                    <FlowWithDownload \n                        id={id}\n                        nodes={nodes}\n                        edges={edges}\n                        nodeTypes={node_types}\n                        edgeTypes={edge_types}\n                        minZoom={min_zoom}\n                        maxZoom={max_zoom}\n                        defaultZoom={default_zoom}\n                        defaultPosition={default_position}\n                        fitView={fit_view}\n                        snapToGrid={snap_to_grid}\n                        snapGrid={snap_grid}\n                        nodesDraggable={nodes_draggable}\n                        nodesConnectable={nodes_connectable}\n                        elementsSelectable={elements_selectable}\n                        panOnDrag={pan_on_drag}\n                        panOnScroll={pan_on_scroll}\n                        zoomOnScroll={zoom_on_scroll}\n                        zoomOnPinch={zoom_on_pinch}\n                        connectionMode={connection_mode}\n                        className={className}\n                        export_trigger={export_trigger}\n                        onNodesChange={(changes) => {\n                            if (setProps) {\n                                setProps({ nodes_change: changes });\n                            }\n                        }}\n                        onEdgesChange={(changes) => {\n                            if (setProps) {\n                                setProps({ edges_change: changes });\n                            }\n                        }}\n                        onConnect={(params) => {\n                            if (setProps) {\n                                setProps({ connect: params });\n                            }\n                        }}\n                        onNodeClick={(event, node) => {\n                            if (setProps) {\n                                setProps({ clicked_node: node });\n                            }\n                        }}\n                        onEdgeClick={(event, edge) => {\n                            if (setProps) {\n                                setProps({ clicked_edge: edge });\n                            }\n                        }}\n                    />\n                </ReactFlowProvider>\n            </div>\n        );\n    }\n}\n\nReactflow.defaultProps = {\n    min_zoom: 0.5,\n    max_zoom: 2,\n    default_zoom: 1,\n    default_position: [0, 0],\n    fit_view: false,\n    snap_to_grid: false,\n    snap_grid: [15, 15],\n    nodes_draggable: true,\n    nodes_connectable: true,\n    elements_selectable: true,\n    pan_on_drag: true,\n    pan_on_scroll: false,\n    zoom_on_scroll: true,\n    zoom_on_pinch: true,\n    connection_mode: 'strict',\n    nodes_change: null,\n    edges_change: null,\n    connect: null,\n    clicked_node: null,\n    clicked_edge: null,\n    export_trigger: 0\n};\n\nReactflow.propTypes = {\n    /**\n     * The ID used to identify this component in Dash callbacks.\n     */\n    id: PropTypes.string,\n\n    /**\n     * Array of node objects with positions and data.\n     */\n    nodes: PropTypes.arrayOf(PropTypes.object).isRequired,\n\n    /**\n     * Array of edge objects that connect nodes.\n     */\n    edges: PropTypes.arrayOf(PropTypes.object).isRequired,\n\n    /**\n     * Latest nodes change event data\n     */\n    nodes_change: PropTypes.array,\n\n    /**\n     * Latest edges change event data\n     */\n    edges_change: PropTypes.array,\n\n    /**\n     * Latest connection event data\n     */\n    connect: PropTypes.object,\n\n    /**\n     * Latest clicked node data\n     */\n    clicked_node: PropTypes.object,\n\n    /**\n     * Latest clicked edge data\n     */\n    clicked_edge: PropTypes.object,\n\n    /**\n     * Custom node types object.\n     */\n    node_types: PropTypes.object,\n\n    /**\n     * Custom edge types object.\n     */\n    edge_types: PropTypes.object,\n\n    /**\n     * Minimum zoom level.\n     */\n    min_zoom: PropTypes.number,\n\n    /**\n     * Maximum zoom level.\n     */\n    max_zoom: PropTypes.number,\n\n    /**\n     * Default zoom level.\n     */\n    default_zoom: PropTypes.number,\n\n    /**\n     * Default position of the viewport [x, y].\n     */\n    default_position: PropTypes.arrayOf(PropTypes.number),\n\n    /**\n     * Fit the viewport to the nodes on first render.\n     */\n    fit_view: PropTypes.bool,\n\n    /**\n     * Enable snapping nodes to grid.\n     */\n    snap_to_grid: PropTypes.bool,\n\n    /**\n     * Grid size for snapping [x, y].\n     */\n    snap_grid: PropTypes.arrayOf(PropTypes.number),\n\n    /**\n     * Allow nodes to be dragged.\n     */\n    nodes_draggable: PropTypes.bool,\n\n    /**\n     * Allow nodes to be connected.\n     */\n    nodes_connectable: PropTypes.bool,\n\n    /**\n     * Allow elements to be selected.\n     */\n    elements_selectable: PropTypes.bool,\n\n    /**\n     * Enable panning when dragging on the canvas.\n     */\n    pan_on_drag: PropTypes.bool,\n\n    /**\n     * Enable panning when scrolling.\n     */\n    pan_on_scroll: PropTypes.bool,\n\n    /**\n     * Enable zooming when scrolling.\n     */\n    zoom_on_scroll: PropTypes.bool,\n\n    /**\n     * Enable zooming on pinch.\n     */\n    zoom_on_pinch: PropTypes.bool,\n\n    /**\n     * Connection mode: 'strict' (only source to target) or 'loose'.\n     */\n    connection_mode: PropTypes.oneOf(['strict', 'loose']),\n\n    /**\n     * CSS styles to apply to the container.\n     */\n    style: PropTypes.object,\n\n    /**\n     * Additional CSS class names.\n     */\n    className: PropTypes.string,\n\n    /**\n     * Trigger for exporting the flow diagram as PNG. Increment to trigger export.\n     */\n    export_trigger: PropTypes.number,\n\n    /**\n     * Dash-assigned callback that should be called to report property changes\n     * to Dash, to make them available for callbacks.\n     */\n    setProps: PropTypes.func\n};\n","\n      import API from \"!../../style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../css-loader/dist/cjs.js!./litegraph.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../css-loader/dist/cjs.js!./litegraph.css\";\n       export default content && content.locals ? content.locals : undefined;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { LGraph, LGraphCanvas, LiteGraph } from 'litegraph.js';\nimport 'litegraph.js/css/litegraph.css';\n\n/**\n * LiteGraph component for creating graph-based node editors in Dash.\n * Based on litegraph.js library.\n */\nexport default class Litegraph extends Component {\n    constructor(props) {\n        super(props);\n        \n        this.canvasRef = React.createRef();\n        this.graph = null;\n        this.canvas = null;\n        \n        console.log(\"Component initialized\");\n        /*this.serializeGraph = this.serializeGraph.bind(this);*/\n    }\n\n    componentDidMount() {\n        this.initGraph();\n        /*this.canvas.graph.serialize = () => this.graph.serialize();*/\n        console.log(\"componentDidMount initialized\");\n        /*this.props.setProps({ serializeGraph: () => this.handleSerialize() });*/\n        // Register the event function from Dash\n        if (this.props.setProps) {\n            this.props.setProps({ serializeGraph: this.handleSerialize });\n        }\n        console.log(\"serializeGraph initialized\");\n    }\n    \n    \n    handleSerialize = () => {\n        if (!this.graph) {\n            console.warn(\"No graph initialized\");\n            return;\n        }\n\n        const serializedData = this.graph.serialize();\n        console.log(\"📢 Serialized Data:\", serializedData);\n\n        if (this.props.setProps) {\n            this.props.setProps({ serializedGraph: serializedData });\n        }\n    };\n    \n    /*handleSerialize() {\n        console.log(\"Serialize requested\");\n        if (this.graph) {\n            const data = this.graph.serialize();\n            console.log(\"Graph data:\", data);\n            this.props.setProps({\n                serializedGraph: data\n            });\n        }\n    }*/\n    \n\n    componentDidUpdate(prevProps) {\n        // Handle updates to nodes or connections\n        if (prevProps.nodes !== this.props.nodes) {\n            this.updateNodes();\n        }\n        \n        // Handle size updates\n        if (prevProps.width !== this.props.width || prevProps.height !== this.props.height) {\n            if (this.canvas) {\n                this.canvas.resize(this.props.width, this.props.height);\n            }\n        }\n        \n        // Check if triggerSerialize changed and call serialization\n        /*if (prevProps.triggerSerialize !== this.props.triggerSerialize) {\n            console.log(\"trigger:\", this.props.triggerSerialize); \n            this.handleSerialize();\n        }*/\n        \n        if (this.props.serialize && !prevProps.serialize) {\n            this.handleSerialize();\n            this.props.setProps({serialize: false});\n        }\n    }\n    \n    \n\n    componentWillUnmount() {\n        // Cleanup\n        if (this.graph) {\n            this.graph.stop();\n            this.graph.clear();\n        }\n        if (this.canvas) {\n            this.canvas.clear();\n        }\n    }\n\n    initGraph() {\n        const { id, width, height } = this.props;\n        \n        if (!this.canvasRef.current) {\n            return;\n        }\n\n        // Set initial canvas dimensions\n        this.canvasRef.current.width = width;\n        this.canvasRef.current.height = height;\n        \n        // Create new graph\n        this.graph = new LGraph();\n        \n        // Initialize canvas with graph\n        this.canvas = new LGraphCanvas(`#${id}`, this.graph);\n        \n        // Configure canvas\n        if (this.canvas) {\n            this.canvas.resize(width, height);\n        \n            // Add nodes from props\n            this.updateNodes();\n            \n            // Start graph execution if autostart is true\n            if (this.props.autostart) {\n                this.graph.start();\n            }\n            \n            // Setup graph events\n            this.setupPointerEvents();\n        }\n        \n        // In your React component's initGraph function\n        // here we override onShowNodePanel to prevent showing the panel\n        this.canvas.onShowNodePanel = () => {\n            // Do nothing\n            return false; // Prevent default panel\n        };\n    }\n\n    updateNodes() {\n        if (!this.graph || !this.props.nodes) return;\n        \n        // Clear existing nodes\n        this.graph.clear();\n        \n        // Add nodes from props\n        this.props.nodes.forEach(nodeData => {\n            const node = LiteGraph.createNode(nodeData.type);\n            if (node) {\n                node.pos = nodeData.pos || [0, 0];\n                if (nodeData.properties) {\n                    Object.assign(node.properties, nodeData.properties);\n                }\n                this.graph.add(node);\n            }\n        });\n        \n        // Update connections\n        if (this.props.connections) {\n            this.props.connections.forEach(conn => {\n                const originNode = this.graph.getNodeById(conn.origin_id);\n                const targetNode = this.graph.getNodeById(conn.target_id);\n                if (originNode && targetNode) {\n                    originNode.connect(conn.origin_slot, targetNode, conn.target_slot);\n                }\n            });\n        }\n    }\n\n    \n    \n    setupPointerEvents() {\n        if (!this.graph || !this.canvas) return;\n\n\n        this.graph.onNodeAdded = (node) => {\n            if (this.props.setProps) {\n                const nodeData = {\n                    id: node.id,\n                    type: node.type,\n                    pos: node.pos\n                };\n                this.props.setProps({\n                    lastNodeAdded: nodeData,\n                    onNodeAdded: null\n                });\n            }\n        };\n\n        // Handle node selection\n        this.canvas.onNodeDblClicked = (node, event) => {\n            console.log(\"Node double clicked:\", node);\n            if (this.props.setProps) {\n                const nodeData = node ? {\n                    id: node.id,\n                    type: node.type,\n                    pos: node.pos,\n                    properties: node.properties || {},\n                    title: node.title,\n                    inputs: node.inputs?.map(input => ({\n                        name: input.name,\n                        type: input.type,\n                        link: input.link\n                    })) || [],\n                    outputs: node.outputs?.map(output => ({\n                        name: output.name,\n                        type: output.type,\n                        links: output.links\n                    })) || []\n                } : null;\n                \n                this.props.setProps({\n                    nodeDblClicked: nodeData,\n                    onNodeDblClicked: null\n                });\n            }\n        };\n        \n\n        this.graph.onNodeRemoved = (node) => {\n            if (this.props.setProps) {\n                this.props.setProps({\n                    lastNodeRemoved: node.id,\n                    onNodeRemoved: null\n                });\n            }\n        };\n\n        this.graph.onConnectionChange = (nodeOutput, nodeInput, event) => {\n            if (this.props.setProps) {\n                const pointerEvent = event ? createPointerEvent('pointerup', event) : null;\n                const connectionData = {\n                    output: nodeOutput?.id,\n                    input: nodeInput?.id,\n                    event: pointerEvent\n                };\n                this.props.setProps({\n                    lastConnectionChange: connectionData,\n                    onConnectionChange: null\n                });\n            }\n        };\n        \n        /*useEffect(() => {\n            if (props.serialize) {\n                handleSerialize(); // This will trigger onSerialize\n                props.setProps({serialize: false}); // Reset trigger\n            }\n        }, [props.serialize]);*/\n        \n        // Add serialize handler to the graph itself \n        /*this.graph.onSerialize = (data, event) => {\n            console.log(\"We got here!!\", data)\n            if (!this.graph) {\n                console.warn(\"No graph initialized\");\n                return null;\n            }\n            const serializedData = this.graph.serialize();\n            console.log(\"Serialized Graph Data:\", serializedData);  // <-- Debugging Log\n        \n            if (this.props.setProps) {\n                console.log(\"setProps is available\");  // <-- Confirm setProps is defined\n                this.props.setProps({ serializedGraph: serializedData });\n            } else {\n                console.log(\"setProps is NOT available\");\n            }\n        \n            return serializedData;\n        };*/\n        \n        \n        /*useEffect(() => {\n            if (props.triggerSerialize) {\n                serializeGraph();\n                props.setProps({triggerSerialize: false});\n            }\n        }, [props.triggerSerialize]);*/\n\n        // Add serialize handler\n        /*this.graph.onSerialize = () => {\n             if (!this.graph) {\n                 console.warn(\"No graph initialized\");\n                 return null;\n             }\n             const serializedData = this.graph.serialize();\n             if (this.props.setProps) {\n                 this.props.setProps({\n                     serializedGraph: serializedData\n                 });\n             }\n             return serializedData;\n        };*/\n        \n        /*this.graph.onSerialize = () => {\n            if (!this.graph) {\n                console.warn(\"No graph initialized\");\n                return null;\n            }\n            const serializedData = this.graph.serialize();\n            console.log(\"Serialized_Graph:\", serializedData);\n            \n            if (this.props.setProps) {\n                console.log(\"setProps is available\");\n                this.props.setProps({ serializedGraph: serializedData });\n            } else {\n                console.warn(\"setProps is NOT available\");\n            }\n    \n            return serializedData;\n        };*/\n        \n        /*// Add serialize handler to the graph itself\n        this.graph.onSerialize = (data, event) => {\n            console.log(\"OnSerialize called\", data, this.graph);\n            if (this.props.setProps) {\n                this.props.setProps({\n                    serializedGraph: data \n                });\n            }\n            return data;\n        };*/\n        \n        \n        \n        \n        /*// Add serialize handler\n        this.graph.onSerialize = () => {\n            console.log(\"onSerialize reached\");\n            if (!this.graph) {\n                console.log(\"No graph initialized\");\n                return null;\n            }\n            console.log(\"serialising data\");\n            const serializedData = this.graph.serialize();\n            if (this.props.setProps) {\n                this.props.setProps({\n                    serializedGraph: serializedData,\n                });\n            }\n            return serializedData;\n        };*/\n        \n        \n    }\n\n    updateNodes() {\n        if (!this.graph || !this.props.nodes) return;\n        \n        this.graph.clear();\n        \n        this.props.nodes.forEach(nodeData => {\n            const node = LiteGraph.createNode(nodeData.type);\n            if (node) {\n                node.pos = nodeData.pos || [0, 0];\n                if (nodeData.properties) {\n                    Object.assign(node.properties, nodeData.properties);\n                }\n                this.graph.add(node);\n            }\n        });\n        \n        if (this.props.connections) {\n            this.props.connections.forEach(conn => {\n                const originNode = this.graph.getNodeById(conn.origin_id);\n                const targetNode = this.graph.getNodeById(conn.target_id);\n                if (originNode && targetNode) {\n                    originNode.connect(conn.origin_slot, targetNode, conn.target_slot);\n                }\n            });\n        }\n    }\n\n\n    render() {\n        const { id, width, height, className } = this.props;\n        \n        return (\n            <div style={{ width: width, height: height }}>\n                <canvas\n                    ref={this.canvasRef}\n                    id={id}\n                    className={className}\n                    style={{ \n                        width: '100%',\n                        height: '100%',\n                        position: 'relative',\n                        touchAction: 'none',\n                        border: '1px solid #000'\n                    }}\n                />\n            </div>\n        );\n    }\n}\n\nLitegraph.defaultProps = {\n    width: 1024,\n    height: 720,\n    autostart: true,\n    nodes: [],\n    connections: [],\n    serialize: false,\n    //selectedNode: null,\n    lastNodeAdded: null,\n    lastNodeRemoved: null,\n    lastConnectionChange: null,\n    onNodeAdded: null,\n    onNodeRemoved: null,\n    onConnectionChange: null,\n    onNodeDblClicked: null,\n    /*triggerSerialize: 0  // Default value*/\n    /*onSerialize: null,*/\n    \n};\n\nLitegraph.propTypes = {\n    /**\n     * The ID used to identify this component in Dash callbacks.\n     */\n    id: PropTypes.string.isRequired,\n\n    /**\n     * Canvas width in pixels\n     */\n    width: PropTypes.number,\n\n    /**\n     * Canvas height in pixels\n     */\n    height: PropTypes.number,\n\n    /**\n     * Whether to automatically start graph execution\n     */\n    autostart: PropTypes.bool,\n\n    /**\n     * Array of node configurations\n     */\n    nodes: PropTypes.arrayOf(PropTypes.shape({\n        type: PropTypes.string.isRequired,\n        pos: PropTypes.arrayOf(PropTypes.number),\n        properties: PropTypes.object\n    })),\n\n    /**\n     * Array of connection configurations\n     */\n    connections: PropTypes.arrayOf(PropTypes.shape({\n        origin_id: PropTypes.number.isRequired,\n        target_id: PropTypes.number.isRequired,\n        origin_slot: PropTypes.number.isRequired,\n        target_slot: PropTypes.number.isRequired\n    })),\n\n    /**\n     * Additional CSS class for the canvas element\n     */\n    className: PropTypes.string,\n\n    /**\n     * Last node that was added\n     */\n    lastNodeAdded: PropTypes.object,\n\n    /**\n     * Last node that was removed\n     */\n    lastNodeRemoved: PropTypes.number,\n\n    /**\n     * Last connection change that occurred\n     */\n    lastConnectionChange: PropTypes.object,\n    \n    /**\n     * Serialised data\n     */\n    serializedGraph: PropTypes.object,\n\n    /**\n     * Temporary storage for node added event\n     */\n    onNodeAdded: PropTypes.object,\n\n    /**\n     * Temporary storage for node removed event\n     */\n    onNodeRemoved: PropTypes.number,\n\n    /**\n     * Temporary storage for connection change event\n     */\n    onConnectionChange: PropTypes.object,\n\n    /**\n     * Currently selected node and its properties\n     */\n    nodeDblClicked: PropTypes.shape({\n        id: PropTypes.number,\n        type: PropTypes.string,\n        pos: PropTypes.arrayOf(PropTypes.number),\n        properties: PropTypes.object,\n        title: PropTypes.string,\n        inputs: PropTypes.arrayOf(PropTypes.shape({\n            name: PropTypes.string,\n            type: PropTypes.string,\n            link: PropTypes.any\n        })),\n        outputs: PropTypes.arrayOf(PropTypes.shape({\n            name: PropTypes.string,\n            type: PropTypes.string,\n            links: PropTypes.any\n        })),\n        event: PropTypes.object\n    }),\n    /**\n     * Dash-assigned callback that should be called to report property changes\n     * to Dash, to make them available for callbacks.\n     */\n    setProps: PropTypes.func,\n    \n    /**\n     * Callback triggered when a node is double-clicked.\n     * Returns an object containing node data including id, type, position,\n     * properties, title, inputs, outputs, and the triggering event.\n     */\n    onNodeDblClicked: PropTypes.func,\n    \n    /**\n     * Serialise currently selected graph\n     */\n    serialize:  PropTypes.bool,\n    \n    \n};\n"],"names":["___CSS_LOADER_EXPORT___","push","module","id","exports","cssWithMappingToString","list","toString","this","map","item","content","needLayer","concat","length","join","i","modules","media","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","global","LiteGraph","VERSION","CANVAS_GRID_SIZE","NODE_TITLE_HEIGHT","NODE_TITLE_TEXT_Y","NODE_SLOT_HEIGHT","NODE_WIDGET_HEIGHT","NODE_WIDTH","NODE_MIN_WIDTH","NODE_COLLAPSED_RADIUS","NODE_COLLAPSED_WIDTH","NODE_TITLE_COLOR","NODE_SELECTED_TITLE_COLOR","NODE_TEXT_SIZE","NODE_TEXT_COLOR","NODE_SUBTEXT_SIZE","NODE_DEFAULT_COLOR","NODE_DEFAULT_BGCOLOR","NODE_DEFAULT_BOXCOLOR","NODE_DEFAULT_SHAPE","NODE_BOX_OUTLINE_COLOR","DEFAULT_SHADOW_COLOR","DEFAULT_GROUP_FONT","WIDGET_BGCOLOR","WIDGET_OUTLINE_COLOR","WIDGET_TEXT_COLOR","WIDGET_SECONDARY_TEXT_COLOR","LINK_COLOR","EVENT_LINK_COLOR","CONNECTING_LINK_COLOR","MAX_NUMBER_OF_NODES","DEFAULT_POSITION","VALID_SHAPES","BOX_SHAPE","ROUND_SHAPE","CIRCLE_SHAPE","CARD_SHAPE","ARROW_SHAPE","GRID_SHAPE","INPUT","OUTPUT","EVENT","ACTION","NODE_MODES","NODE_MODES_COLORS","ALWAYS","ON_EVENT","NEVER","ON_TRIGGER","UP","DOWN","LEFT","RIGHT","CENTER","LINK_RENDER_MODES","STRAIGHT_LINK","LINEAR_LINK","SPLINE_LINK","NORMAL_TITLE","NO_TITLE","TRANSPARENT_TITLE","AUTOHIDE_TITLE","VERTICAL_LAYOUT","proxy","node_images_path","debug","catch_exceptions","throw_errors","allow_scripts","use_deferred_actions","registered_node_types","node_types_by_file_extension","Nodes","Globals","searchbox_extras","auto_sort_node_types","node_box_coloured_when_on","node_box_coloured_by_mode","dialog_close_on_mouse_leave","dialog_close_on_mouse_leave_delay","shift_click_do_break_link_from","click_do_break_link_to","search_hide_on_mouse_leave","search_filter_enabled","search_show_all_on_open","auto_load_slot_types","registered_slot_in_types","registered_slot_out_types","slot_types_in","slot_types_out","slot_types_default_in","slot_types_default_out","alt_drag_do_clone_nodes","do_add_triggers_slots","allow_multi_output_for_events","middle_click_slot_add_default_node","release_link_on_empty_shows_menu","pointerevents_method","ctrl_shift_v_paste_connect_unselected_outputs","use_uuids","registerNodeType","type","base_class","prototype","console","log","classname","name","pos","lastIndexOf","category","substring","title","LGraphNode","prev","Object","hasOwnProperty","call","defineProperty","set","v","_shape","get","enumerable","configurable","supported_extensions","ext","constructor","String","toLowerCase","onNodeTypeRegistered","onNodeTypeReplaced","onPropertyChange","warn","unregisterNodeType","registerNodeAndSlotType","slot_type","out","class_type","allTypes","split","slotType","registerTo","nodes","includes","sort","buildNodeClassFromObject","object","ctor_code","inputs","_name","_type","outputs","properties","prop","classobj","Function","pop","desc","wrapFunctionAsNode","func","param_types","return_type","params","Array","code","names","getParameterNames","onExecute","getInputData","r","apply","setOutputData","clearRegisteredTypes","addNodeMethod","createNode","options","node","err","error","properties_info","flags","size","computeSize","mode","onNodeCreated","getNodeType","getNodeTypesInCategory","filter","a","b","localeCompare","getNodeTypesCategories","categories","skip_list","result","reloadNodes","folder_wildcard","tmp","document","getElementsByTagName","script_files","docHeadObj","location","href","src","substr","dynamicScript","createElement","appendChild","removeChild","cloneObject","obj","target","parse","uuidv4","replace","Math","random","isValidConnection","type_a","type_b","indexOf","supported_types_a","supported_types_b","j","registerSearchboxExtra","node_type","description","fetchFile","url","on_complete","on_error","fetch","then","response","ok","Error","arrayBuffer","text","json","blob","catch","File","Blob","reader","FileReader","onload","e","readAsArrayBuffer","readAsText","readAsBinaryString","LGraph","o","list_of_graphcanvas","clear","configure","LLink","origin_id","origin_slot","target_id","target_slot","_data","_pos","Float32Array","_ctor","LGraphGroup","DragAndScale","element","skip_events","offset","scale","max_scale","min_scale","onredraw","enabled","last_mouse","visible_area","bindEvents","LGraphCanvas","canvas","graph","background_image","DEFAULT_BACKGROUND_IMAGE","querySelector","ds","zoom_modify_alpha","title_text_font","inner_text_font","node_title_color","default_link_color","default_connection_color","input_off","input_on","output_off","output_on","default_connection_color_byType","default_connection_color_byTypeOff","highquality_render","use_gradients","editor_alpha","pause_rendering","clear_background","clear_background_color","read_only","render_only_selected","live_mode","show_info","allow_dragcanvas","allow_dragnodes","allow_interaction","multi_select","allow_searchbox","allow_reconnect_links","align_to_grid","drag_mode","dragging_rectangle","set_canvas_dirty_on_mouse_event","always_render_background","render_shadows","render_canvas_border","render_connections_shadows","render_connections_border","render_curved_connections","render_connection_arrows","render_collapsed_slots","render_execution_order","render_title_colored","render_link_tooltip","links_render_mode","mouse","graph_mouse","canvas_mouse","onSearchBox","onSearchBoxSelection","onMouse","onDrawBackground","onDrawForeground","onDrawOverlay","onDrawLinkTooltip","onNodeMoved","onSelectionChange","onConnectingChange","onBeforeChange","onAfterChange","connections_width","round_radius","current_node","node_widget","over_link_center","last_mouse_position","visible_links","viewport","attachCanvas","setCanvas","skip_render","startRendering","autoresize","performance","getTime","now","bind","Date","process","t","hrtime","supported_types","getSupportedTypes","STATUS_STOPPED","STATUS_RUNNING","stop","status","last_node_id","last_link_id","_version","_nodes","onRemoved","_nodes_by_id","_nodes_in_order","_nodes_executable","_groups","links","iteration","config","vars","extra","globaltime","runningtime","fixedtime","fixedtime_lapse","elapsed_time","last_update_time","starttime","catch_errors","nodes_executing","nodes_actioning","nodes_executedAction","change","sendActionToCanvas","graphcanvas","detachCanvas","splice","start","interval","onPlayEvent","sendEventToAllNodes","that","window","requestAnimationFrame","execution_timer_id","on_frame","onBeforeStep","runStep","onAfterStep","setInterval","onStopEvent","clearInterval","num","do_not_catch_errors","limit","_waiting_actions","executePendingActions","doExecute","onExecuteStep","onAfterExecute","errors_in_execution","elapsed","execution_time","updateExecutionOrder","computeExecutionOrder","only_onExecute","set_level","L","S","M","visited_links","remaining_links","l","l2","link","_level","shift","output","link_id","target_node","getNodeById","order","A","B","Ap","priority","Bp","getAncestors","ancestors","pending","visited","current","input","getInputNode","arrange","margin","layout","columns","col","x","column","max_size","y","max_size_index","node_size_index","setDirtyCanvas","getFixedTime","getElapsedTime","eventname","Subgraph","action","c","add","skip_compute_order","onAdded","alignToGrid","onNodeAdded","remove","index","ignore_remove","beforeChange","slot","disconnectInput","disconnectOutput","selected_nodes","node_dragged","onNodeRemoved","afterChange","findNodesByClass","classObject","findNodesByType","findNodeByTitle","findNodesByTitle","getNodeOnPos","nodes_list","n","isPointInside","getGroupOnPos","g","checkNodeTypes","ctor","newnode","serialize","onAction","param","_input_nodes","GraphInput","actionDo","trigger","onTrigger","addInput","value","onInputAdded","onInputsOutputsChange","setInputData","renameInput","old_name","onInputRenamed","changeInputType","onInputTypeChanged","removeInput","onInputRemoved","addOutput","onOutputAdded","getOutputData","renameOutput","onOutputRenamed","changeOutputType","onOutputTypeChanged","removeOutput","onOutputRemoved","triggerInput","setCallback","setTrigger","info","connectionChange","link_info","onConnectionChange","isLive","clearTriggeredSlots","_last_time","on_change","fg","bg","removeLink","nodes_info","link2","groups_info","groups","version","onSerialize","keep_old","link_data","n_info","last_serialization","has_errors","group","onConfigure","load","callback","addEventListener","event","req","XMLHttpRequest","open","send","oEvent","onerror","onNodeTrace","msg","color","connections","onPropertyChanged","onConnectionsChange","widgets","w","property","widgets_values","serialize_widgets","bgcolor","boxcolor","shape","clone","getTitle","setProperty","prev_value","output_info","setOutputDataType","force_update","updateOutputData","getInputDataType","getInputDataByName","slot_name","findInputSlot","isInputConnected","getInputInfo","getInputLink","slot_info","getInputOrProperty","input_info","getOutputInfo","isOutputConnected","isAnyOutputConnected","getOutputNodes","addOnTriggerInput","trigS","optional","nameLocked","addOnExecutedOutput","findOutputSlot","onAfterExecuteNode","triggerSlot","changeMode","modeTo","ON_REQUEST","p","action_call","floor","exec_version","execute_triggered","action_slot","action_triggered","_last_trigger_time","Number","target_connection","clearTriggeredSlot","setSize","onResize","addProperty","default_value","extra_info","addOutputs","array","addInputs","addConnection","direction","rows","max","font_size","title_width","compute_text_size","input_width","output_width","text_width","label","slot_start_y","widgets_height","widgets_up","widgets_start_y","min_height","getPropertyInfo","widgets_info","onGetPropertyInfo","widget","addWidget","values","addCustomWidget","custom_widget","getBounding","compute_outer","nodePos","isCollapsed","collapsed","nodeSize","left_offset","right_offset","top_offset","bottom_offset","_collapsed_width","onBounding","skip_title","margin_top","isInsideRectangle","getSlotInPosition","link_pos","getConnectionPos","returnObj","findInputSlotFree","optsIn","opts","assign","typesNotAccepted","findOutputSlotFree","findInputSlotByType","preferFreeSlot","doNotUseOccupied","findSlotByType","findOutputSlotByType","aSlots","aSource","aDest","sI","dI","connectByType","target_slotType","createEventInCase","firstFreeIfOutputGeneralInCase","generalTypeInCase","connect","connectByTypeOutput","source_node","source_slotType","firstFreeIfInputGeneralInCase","source_slot","changed","onBeforeConnectInput","onConnectInput","onConnectOutput","doProcessChange","onNodeConnectionChange","is_input","slot_number","num_slots","horizontal","round","trace","MAX_CONSOLE","dirty_foreground","dirty_background","loadImage","img","Image","ready","captureInput","node_capturing_input","collapse","force","collapsable","pin","pinned","localToScreen","node_colors","pale_blue","groupcolor","_bounding","subarray","_size","bounding","move","deltax","deltay","ignore_nodes","recomputeInsideNodes","node_bounding","overlapBounding","_binded_mouse_callback","pointerListenerAdd","computeVisibleArea","width","height","startx","starty","endx","endy","rect","getBoundingClientRect","clientX","left","clientY","top","canvasx","canvasy","dragging","is_inside","ignore","onmouse","pointerListenerRemove","mouseDrag","eventType","wheel","deltaY","wheelDeltaY","detail","delta","wheelDelta","changeDeltaScale","preventDefault","stopPropagation","toCanvasContext","ctx","translate","convertOffsetToCanvas","convertCanvasToOffset","changeScale","zooming_center","center","abs","new_center","delta_offset","reset","link_type_colors","number","gradients","frame","last_draw_time","render_time","fps","selected_group","visible_nodes","node_over","connecting_node","highlighted_links","dragging_canvas","dirty_canvas","dirty_bgcanvas","dirty_area","node_in_panel","last_mouseclick","pointer_is_down","pointer_is_double","onClear","setGraph","skip_clear","_graph_stack","setDirty","getTopGraph","openSubgraph","checkPanels","closeSubgraph","subgraph_node","_subgraph_node","centerOnNode","selectNodes","getCurrentGraph","getElementById","unbindEvents","className","tabindex","bgcanvas","getContext","localName","webgl_enabled","enableWebGL","_doNothing","_doReturnTrue","_events_binded","getCanvasWindow","_mousedown_callback","processMouseDown","_mousewheel_callback","processMouseWheel","_mousemove_callback","processMouseMove","_mouseup_callback","processMouseUp","_key_callback","processKey","setAttribute","_ondrop_callback","processDrop","removeEventListener","getFileExtension","question","point","GL","enableWebGLCanvas","gl","webgl","bgctx","fgcanvas","doc","ownerDocument","defaultView","parentWindow","is_rendering","renderFrame","draw","stopRendering","blockClick","block_click","adjustMouseEvent","ref_window","active_canvas","canvasX","canvasY","skip_action","is_primary","isPrimary","is_double_click","last_click_position","focus","closeAllContextMenus","which","mClikSlot","mClikSlot_index","mClikSlot_isOut","alphaPosY","posRef","createDefaultNodeForSlot","nodeFrom","slotFrom","nodeTo","slotTo","position","nodeType","posAdd","posSizeFix","keys","shiftKey","ctrlKey","metaKey","processContextMenu","altKey","cloned","doCalcSize","block_drag_node","processNodeSelected","clicking_canvas_bg","showLinkMenu","selected_group_resizing","distance","showSearchBox","bringToFront","resizable","resizing_node","style","cursor","connecting_output","slot_index","connecting_pos","connecting_slot","onOutputDblClick","onOutputClick","onInputDblClick","onInputClick","connecting_input","processNodeWidgets","onDblClick","processNodeDblClicked","onMouseDown","subgraph","skip_subgraph_button","setTimeout","is_selected","last_mouse_dragging","activeElement","nodeName","resize","mouseOver","onMouseLeave","redraw_on_mouse","onMouseEnter","onMouseMove","_highlight_input","isOverNodeBox","isOverNodeInput","_highlight_input_slot","_highlight_output","isOverNodeOutput","over_link","desired_size","min_size","click_time","diffx","diffy","h","to_select","nodeX","connType","node_from","slot_from","type_filter_in","node_to","type_filter_out","showConnectionMenu","deselectAllNodes","onMouseUp","title_height","slot_pos","block_default","keyCode","node_panel","close","options_panel","copyToClipboard","pasteFromClipboard","deleteSelectedNodes","onKeyDown","onKeyUp","stopImmediatePropagation","clipboard_info","selected_nodes_array","clonable","_relative_id","localStorage","setItem","isConnectUnselected","getItem","posMin","posMinIndexes","node_data","origin_node","origin_node_relative_id","origin_node_id","onDropItem","checkDropItem","onDropFile","onDropData","files","dataTransfer","file","filename","readAsDataURL","nodetype","onShowNodePanel","showShowNodePanel","onNodeDblClicked","selectNode","onNodeSelected","add_to_current_selection","deselectNode","onSelected","onDeselected","onNodeDeselected","block_delete","input_link","output_link","input_node","output_node","clientX_rel","clientY_rel","setZoom","convertEventToCanvasOffset","sendToBack","unshift","temp","computeVisibleNodes","force_canvas","force_bgcanvas","drawBackCanvas","drawFrontCanvas","start2D","restore","setTransform","area","save","beginPath","clip","clearRect","drawImage","onRender","renderInfo","drawNode","drawExecutionOrder","links_ontop","drawConnections","lineWidth","link_color","connInOrOut","connDir","dir","connShape","renderLink","fill","moveTo","lineTo","closePath","arc","PI","fillStyle","strokeStyle","strokeRect","drawLinkTooltip","visible_rect","drawSubgraphPanel","finish2D","subnode","drawSubgraphPanelLeft","drawSubgraphPanelRight","globalAlpha","roundRect","font","textAlign","fillText","drawButton","not_subgraph_input","input_node_type","showSubgraphPropertiesDialog","canvas_w","title_text","tw","measureText","output_node_type","showSubgraphPropertiesDialogRight","hovercolor","textcolor","hover","clicked","was_clicked","isAreaClicked","hold_click","toFixed","bg_already_painted","onRenderBackground","fillRect","imageSmoothingEnabled","_bg_img","pattern","_pattern","createPattern","_pattern_img","drawGroups","onBackgroundRender","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","finish","temp_vec2","low_quality","onDrawCollapsed","min","clip_area","drawNodeShape","render_text","out_slot","in_slot","max_y","input_slot","output_slot","slot_shape","color_on","color_off","doStroke","stroke","widgets_y","drawNodeWidgets","Boolean","toToolTip","tmp_area","fgcolor","selected","mouse_over","title_mode","render_title","old_alpha","onDrawTitleBar","title_color","grad","createLinearGradient","addColorStop","colState","box_size","onDrawTitleBox","onDrawTitleText","title_text_color","over","onDrawTitle","margin_area","link_bounding","tempA","tempB","compareObjects","sqrt","colorToString","growBounding","isInsideBounding","bb","A_end_x","A_end_y","B_end_x","B_end_y","hex2num","hex","charAt","slice","toUpperCase","int1","int2","hex_alphabets","num2hex","triplet","ContextMenu","parentMenu","lock","current_submenu","eventClass","root","on_mouse_wheel","parseInt","scroll_speed","minWidth","minHeight","pointerEvents","button","innerHTML","addItem","closing_timer","clearTimeout","root_document","fullscreenElement","body","body_rect","root_rect","transform","CurveEditor","points","nearest","must_update","clamp","start_node","start_node_slotpos","start_node_slot","end_node_slotpos","start_slot","end_slot","start_dir","end_dir","f","skip_border","flow","num_sublines","dist","lineJoin","offsety","start_offset_x","start_offset_y","end_offset_x","end_offset_y","bezierCurveTo","start_x","start_y","end_x","end_y","computeConnectionPoint","posA","posB","posC","posD","angleA","angleB","atan2","rotate","p0","p1","p2","p3","c1","c2","c3","c4","posY","active_widget","H","show_text","outline_color","background_color","text_color","secondary_text_color","last_y","disabled","widget_width","on","off","range","nvalue","slider_color","marker","marker_nvalue","marker_color","precision","deltaX","widget_height","old_value","inner_value_change","step","values_list","text_values","menu","inner_clicked","option","prompt","test","eval","multiline","onWidgetChanged","DEFAULT_GROUP_FONT_SIZE","adjustNodesSize","parent","parentNode","offsetWidth","offsetHeight","switchLiveMode","transition","self","onNodeSelectionChange","onGroupAdd","entry","mouse_event","getBoundaryNodes","right","bottom","nID","boundaryNodesForSelection","alignNodes","align_to","boundaryNodes","_","entries","onNodeAlign","prev_menu","onGroupAlign","onMenuAdd","inner_onMenuAdded","base_category","startsWith","base_category_regex","RegExp","category_name","category_path","findIndex","has_submenu","mouseEvent","contextMenu","first_event","getFirstEvent","onMenuCollapseAll","onMenuNodeEdit","showMenuNodeOptionalInputs","optional_inputs","onGetInputs","removable","onMenuNodeInputs","retEntries","onNodeInputAdd","showMenuNodeOptionalOutputs","optional_outputs","onGetOutputs","skip_repeated_outputs","onMenuNodeOutputs","onNodeOutputAdd","onShowMenuNodeProperties","getPropertyPrintableValue","decodeHTML","showEditPropertyValue","allow_html","str","innerText","onMenuResizeNode","fApplyMultiNode","node_left","node_right","fromType","destType","optPass","isFrom","isTo","slotX","iSlotConn","fromSlotType","slotTypesDefault","nodeNewType","typeX","nodeNewOpts","newNode","onShowPropertyEditor","dialog","is_modified","inner","offsetx","dialogCloseTimer","setValue","prompt_box","prevent_timeout","selInDia","querySelectorAll","forEach","selIn","value_element","search_limit","def_options","do_type_filter","show_general_if_none_on_typefilter","show_general_after_typefiltered","hide_on_mouse_leave","show_all_if_empty","show_all_on_open","overflow","selOut","search_box","blur","timeout_close","helper","first","timeout","changeSelection","refreshHelper","select","nSlots","iK","opt","iS","forward","classList","nextSibling","previousSibling","childNodes","scrollIntoView","block","behavior","addResult","sIn","sOut","inner_test_filter","filtered","filtered_extra","inTypeOverride","outTypeOverride","skipFilter","sType","sV","help","dataset","escape","layerY","maxHeight","input_html","createDialog","modified","checked","onclose","html","checkForInput","closeOnLeave","closeOnLeave_checkModified","aI","iX","createPanel","header","closable","title_element","alt_content","footer","onClose","toggleAltContent","vTo","vAlt","display","toggleFooterVisibility","addHTML","on_footer","elem","addButton","addSeparator","str_value","innerChange","inner_showCodePad","propname","toggle","elem_that","onOpen","desc_value","closePanels","panel","showShowGraphOptionsPanel","refOpts","obEv","refMenu","refMenu2","lgraphcanvas","OPTIONPANEL_IS_OPEN","fUpdate","key","aProps","availableCanvasOptions","pI","pX","inner_refresh","SELECTED_NODE","NODEPANEL_IS_OPEN","kV","nodeCol","pName","nK","onAddPropertyToPanel","onShowCustomPanelInfo","textarea","fDoneWith","float","old_panel","not_subgraph_output","panels","onMenuNodeCollapse","onMenuNodePin","onMenuNodeMode","onMenuNodeColors","fApplyColor","onMenuNodeShapes","onMenuNodeRemove","onMenuNodeToSubgraph","buildFromNodes","onMenuNodeClone","newSelected","red","brown","green","blue","cyan","purple","yellow","black","getCanvasMenuOptions","getMenuOptions","getExtraMenuOptions","getNodeMenuOptions","onGetNodeMenuOptions","getGroupMenuOptions","menu_info","active_node","getSlotMenuOptions","_slot","locked","submenu","inner_onclick","close_parent","ignore_item_callbacks","autoopen","onclick_callback","ignore_parent_menu","isCursorOverElement","event_name","origin","evt","createEvent","initCustomEvent","srcElement","dispatchEvent","__events","getTopMenu","elements","extendClass","__lookupGetter__","__defineGetter__","__lookupSetter__","__defineSetter__","sampleCurve","pn","local_f","line_color","inactive","localpos","max_dist","getCloserPoint","s","curvepos","_nearest","is_edge_point","min_dist","closest","vec2","oDOM","sEvIn","fCall","capture","sMethod","sEvent","PointerEvent","webkitRequestAnimationFrame","mozRequestAnimationFrame","Time","_is_subgraph","onSubgraphTrigger","onSubgraphNewInput","onSubgraphRenamedInput","onSubgraphTypeChangeInput","onSubgraphRemovedInput","onSubgraphNewOutput","onSubgraphRenamedOutput","onSubgraphTypeChangeOutput","onSubgraphRemovedOutput","name_in_graph","name_widget","type_widget","value_widget","GraphOutput","ConstantNumber","ConstantBoolean","ConstantString","ConstantObject","_object","ConstantFile","JSONParse","_str","_obj","ConstantData","_value","ConstantArray","SetArray","ArrayElement","TableElement","ObjectProperty","ObjectKeys","SetObject","MergeObjects","_result","Variable","varname","container","LITEGRAPH","DownloadData","downloadAsFile","Watch","Cast","Console","Alert","NodeScript","_func","GenericCompare","OP","overleft","num_inputs","num_outputs","oldname","reassignSubgraphUUIDs","idMap","nodeIDs","linkIDs","oldID","newID","merge","reassignGraphUUIDs","ids","min_x","updateType","parseFloat","_url","arr","table","row","C","GRAPH","GLOBALSCOPE","getContainer","URL","createObjectURL","click","revokeObjectURL","alert","compileCode","code_low","forbidden_words","getOwnPropertyNames","bProps","propName","LogEvent","TriggerEvent","only_on_change","Sequence","render_box","WaitAll","Stepper","FilterEvent","equal_to","has_property","property_equal_to","EventBranch","EventCounter","doCountExecution","DelayEvent","_pending","TimerEvent","time","last_interval","triggered","SemaphoreEvent","_ready","OnceEvent","_once","DataStore","_last_value","must_resend","time_in_ms","dt","actionPass","onStart","on_color","off_color","isNaN","WidgetButton","WidgetToggle","WidgetNumber","old_y","_remainder","_precision","mouse_captured","WidgetCombo","_values","WidgetKnob","WidgetSliderGUI","slider","WidgetHSlider","WidgetProgress","WidgetText","fontsize","align","glowSize","decimals","WidgetPanel","borderColor","bgcolorTop","bgcolorBottom","shadowSize","borderRadius","local_pos","message","pixels_threshold","markers_color","steps","center_x","center_y","radius","angle","cos","sin","oldmouse","m","lines","last_ctx","createGradient","lineargradient","GamepadInput","gamepad_index","threshold","_left_axis","_right_axis","_triggers","_previous_buttons","Uint8Array","_current_buttons","zero","buttons","gamepad","getGamepad","xbox","axes","hatmap","mapping","lb","rb","lt","rt","back","ls","rs","mapping_array","getGamepads","navigator","webkitGetGamepads","mozGetGamepads","gamepads","xbox_mapping","hat","pressed","was_pressed","la","ra","Converter","Bypass","ToNumber","MathRange","MathRand","MathNoise","MathSpikes","_remaining_time","_blink_time","MathClamp","MathLerp","MathAbs","MathFloor","MathFrac","MathSmoothStep","MathScale","Gate","MathAverageFilter","_current","MathTendTo","MathOperation","funcs","MathCompare","MathCondition","MathBranch","MathAccumulate","MathTrigonometry","bgImageUrl","MathFormula","formula","code_widget","Math3DVec2ToXY","Math3DXYToVec2","Math3DVec3ToXYZ","Math3DXYZToVec3","z","Math3DVec4ToXYZW","Math3DXYZWToVec4","count","_last_v","in_min","in_max","out_min","out_max","getValue","smooth","f_min","iterations","octaves","amp","seed","speed","total_amp","persistence","duration","pow","max_time","min_time","getCode","lang","v1","v2","_f","edge0","edge1","factor","num_samples","avr","samples","old","V","inc","increment","amplitude","tan","asin","acos","atan","_func_code","Math3DMat4","R_in_degrees","mat4","create","_must_update","Math3DOperation","vec3","Math3DVec3Scale","Math3DVec3Length","Math3DVec3Normalize","Math3DVec3Lerp","Math3DVec3Dot","temp_quat","temp_mat4","temp_vec3","Q","T","R","identity","DEG2RAD","quat","fromEuler","fromQuat","multiply","sub","mul","div","dot","cross","glMatrix","Math3DQuaternion","normalize","Math3DRotation","axis","fromValues","MathEulerToQuat","euler","use_yaw_pitch_roll","_degs","MathQuatToEuler","Math3DRotateVec3","vec","Math3DMultQuat","Math3DQuatSlerp","Math3DRemapRange","range_min","range_max","target_min","target_max","_clamped","setAxisAngle","q","toEuler","transformQuat","slerp","StringToTable","_table","separator","_last_separator","trim","Selector","sequence","logicAnd","logicOr","logicNot","logicCompare","logicBranch","sel","seq","current_sequence","ret","inX","last","GraphicsPlot","GraphicsImage","ColorPalette","colorA","colorB","colorC","colorD","ImageFrame","ImageFade","fade","ImageCrop","CanvasNode","autoclear","DrawImageNode","opacity","DrawRectangleNode","ImageVideo","use_proxy","ImageWebcam","filterFacingMode","facingMode","colors","dirty","onWidget","videoWidth","videoHeight","show","showElement","createCanvas","_video_url","loadVideo","_video","currentTime","pause","play","onStop","protocol","host","muted","autoplay","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","playPause","paused","is_webcam_open","openStream","mediaDevices","getUserMedia","_waiting_confirmation","constraints","audio","video","streamReady","_webcam_stream","closeStream","tracks","getTracks","localMediaStream","srcObject","onloadedmetadata","LGraphTexture","image_preview_size","LGraphTexturePreview","flipY","LGraphTextureSave","generate_mipmaps","LGraphTextureOperation","pixelcode","uvcode","DEFAULT","has_error","LGraphTextureShader","u_value","u_color","pixel_shader","_uniforms","vec4","in_texture","texSize","LGraphTextureScaleOffset","LGraphTextureWarp","u_texture","u_textureB","u_factor","u_scale","u_offset","LGraphTextureToViewport","additive","antialiasing","disable_alpha","gamma","LGraphTextureCopy","LGraphTextureDownsample","LGraphTextureResize","LGraphTextureAverage","use_previous_frame","high_quality","u_mipmap_offset","_luminance","LGraphTextureMinMax","_max","_min","_textures_chain","LGraphTextureTemporalSmooth","LGraphTextureLinearAvgSmooth","frames_interval","u_samples","u_isamples","LGraphImageToTexture","LGraphTextureLUT","intensity","texture","_shader","Shader","SCREEN_VERTEX_SHADER","LGraphTextureEncode","num_row_symbols","symbol_size","brightness","colorize","invert","u_row_simbols","u_simbol_size","u_res","LGraphTextureChannels","LGraphChannelsTexture","G","_color","u_textureR","u_textureG","u_textureA","LGraphTextureColor","_tex_color","LGraphTextureGradient","texture_size","u_angle","u_colorA","u_colorB","LGraphTextureMix","size_from_biggest","u_textureMix","u_mix","LGraphTextureEdges","LGraphTextureDepthRange","only_depth","high_precision","u_distance","u_range","u_camera_planes","LGraphTextureLinearDepth","u_ires","LGraphTextureBlur","preserve_aspect","FXGlow","dirt_texture","dirt_factor","_textures","u_intensity","u_glow_texture","u_threshold","u_texel_size","LGraphTextureGlow","fx","LGraphTextureKuwaharaFilter","LGraphTextureXDoGFilter","sigma","epsilon","phi","LGraphTextureWebcam","texture_name","LGraphLensFX","LOW","LGraphTextureFromData","channels","LGraphTextureCurve","split_channels","_curve_texture","u_curve","_points","RGB","curve_editor","curve_offset","LGraphExposition","exposition","u_exposition","LGraphToneMapping","average_lum","lum_white","u_lumwhite2","u_igamma","u_average_lum","LGraphTexturePerlin","_key","_texture","u_persistence","u_seed","u_viewport","LGraphTextureCanvas2D","default_code","use_html_canvas","_temp_texture","LGraphTextureMatte","key_color","slope","LGraphCubemapToTexture2D","yaw","loadTextureCallback","UNDEFINED","PASS_THROUGH","COPY","HIGH","REUSE","MODE_VALUES","copy","low","high","reuse","default","getTexturesContainer","textures","loadTexture","Texture","fromURL","getTexture","tex","getTargetTexture","tex_type","UNSIGNED_BYTE","HIGH_PRECISION_FORMAT","format","LINEAR","getTextureType","ref_texture","getWhiteTexture","_white_texture","fromMemory","RGBA","wrap","REPEAT","NEAREST","getNoiseTexture","_noise_texture","noise","fromDDSInMemory","_drop_texture","_last_tex","setParameter","TEXTURE_MAG_FILTER","fullpath","onResourceRenamed","new_name","_last_preview_tex","_canvas","tex_canvas","generateLowResTexturePreview","cloneCanvas","temp_tex","DEPTH_COMPONENT","_preview_temp_tex","minFilter","copyTo","_preview_canvas","toCanvas","getResources","res","replaceCode","context","allow_preview","handle","getPreviewTexture","TEXTURE_MIN_FILTER","LINEAR_MIPMAP_LINEAR","generateMipmap","texture_type","unbind","storeTexture","presets","_tex","texB","shader","_shader_code","final_pixel_code","UV_CODE","PIXEL_CODE","dumpErrorToConsole","drawTo","disable","DEPTH_TEST","CULL_FACE","BLEND","mesh","Mesh","getScreenQuad","uniforms","registerPreset","onInspect","addCombo","refresh","getShader","uniformInfo","already","loc","samplers","tex_slot","in_tex","setUniform","_prev_viewport","enable","blendFunc","SRC_ALPHA","ONE","ONE_MINUS_SRC_ALPHA","old_viewport","viewport_data","new_view","getViewport","aa_pixel_shader","uViewportSize","inverseVP","_gamma_shader","gamma_pixel_shader","toViewport","isPowerOfTwo","magFilter","TEXTURE_2D","releaseTemporary","getTemporary","updateAverage","onPreRenderExecute","u_samples_a","u_samples_b","FLOAT","_temp_pot2_texture","mipmap_offset","pixel","getPixels","HALF_FLOAT","HALF_FLOAT_OES","update","_temp_texture2","_shader_copy","pixel_shader_copy","_shader_avg","pixel_shader_avg","_temp_texture_out","shader_copy","shader_avg","gltexture","uploadImage","lut_tex","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","bindTexture","u_amount","symbols_tex","u_symbol_size","u_brightness","u_invert","u_colorize","texA","_channels","masks","u_mask","white","texR","texG","sqrDist","texMix","_shader_tex","MIX_TEX","_shader_factor","u_isize","half_float_ext","_shader_onlydepth","ONLY_DEPTH","planes","near_far_planes","LS","Renderer","_main_camera","DEPTH_STENCIL","max_iterations","_final_texture","aspect","camera_aspect","applyBlur","applyFX","output_texture","glow_texture","average_texture","texture_info","_cut_shader","cut_pixel_shader","currentDestination","blit","currentSource","texel_size","u_delta","scale_pixel_shader","final_texture","_dirt_final_shader","_final_shader","final_pixel_shader","USE_DIRT","_average_texture","_glow_texture","max_radius","_shaders","RADIUS","u_resolution","u_iResolution","_xdog_shader","xdog_pixel_shader","cvsWidth","cvsHeight","_video_texture","LUMINANCE","uploadData","updateCurve","curve_texture","curves","channel_line_colors","channel","globalCompositeOperation","exp_input","avg","u_average_texture","_shader_texture","AVG_TEXTURE","u_octaves","u_amplitude","executeDraw","func_context","_ctx","clearColor","COLOR_BUFFER_BIT","u_key_color","u_slope","TEXTURE_CUBE_MAP","cubemapToTexture2D","SHADERNODES_COLOR","LGShaders","Shaders","GLSL_types_const","GLSL_types","GLSL_functions_desc","GLSL_functions","GLSL_functions_name","parseGLSLDescriptions","ALL_TYPES","registerShaderNode","getInputLinkID","getOutputLinkID","getShaderNodeVarName","valueToGLSL","varToTypeGLSL","input_type","output_type","convertVarToGLSLType","target_type","LGShaderContext","_functions","_codeparts","_uniform_value","addUniform","addFunction","addCode","hook","destinations","computeCodeBlocks","extra_uniforms","vertexout","fragmentout","propagateDestination","functions","blocks","computeShaderCode","vs_code","replaceCodeUsingContext","vs_template","fs_code","fs_template","computeShader","finalcode","_shader_error","updateShader","fillUniforms","ShaderContext","Context","LGraphShaderGraph","template","intex","alpha","_context","inputs_y","onDrawSubgraphBackground","LGraphShaderUniform","onGetCode","shader_destination","getOutputVarName","LGraphShaderAttribute","LGraphShaderSampler2D","texname","buffer_names","uvs","LGraphShaderConstant","updateWidgets","link_name","LGraphShaderVec2","varmodes","props","varmode","inlink","outlink","LGraphShaderVec3","LGraphShaderVec4","LGraphShaderFragColor","LGraphShaderOperation","operations","operation","inlinks","base_type","op","param_code","LGraphShaderFunc","func_desc","LGraphShaderSnippet","inlinkA","inlinkB","inA_type","inB_type","funcname","func_code","LGraphShaderRand","LGraphShaderNoise","NOISE_TYPES","intype","shader_functions","LGraphShaderTime","LGraphShaderDither","dither_func","dither_values","LGraphShaderRemap","minv","min_value","maxv","max_value","minv2","min_value2","maxv2","max_value2","index2","func_name","node_ctor","clearDestination","dest_name","inputNode","sampler","outnode","view_matrix","projection_matrix","viewprojection_matrix","model_matrix","global_uniforms","u_view","u_projection","u_viewprojection","u_model","generateGeometryId","LGraphPoints3D","num_points","generate_normals","regular","SPHERE","normals","geometry","vertices","_id","_old_obj","_last_radius","findRandomTriangle","areas","imin","imid","imax","LGraphPointsToInstances","autoupdate","matrices","first_time","LGraphGeometryTransform","_last_geometry_id","_last_version","_last_key","LGraphGeometryPolygon","sides","geometry_id","last_info","LGraphGeometryExtrude","top_cap","bottom_cap","_last_geo_version","LGraphGeometryEval","execute_every_frame","LGraphConnectPoints","max_connections","probability","my_version","LGraphToGeometry","last_mesh","LGraphGeometryToMesh","LGraphRenderMesh","primitive","TRIANGLES","LGraphGeometryPrimitive","subdivisions","LGraphRenderPoints","point_size","fixed_size","u_point_size","u_perspective","u_point_perspective","LGraphRender","onRequestCameraMatrices","RECTANGLE","CIRCLE","CUBE","HEMISPHERE","INSIDE_SPHERE","OBJECT","OBJECT_UNIFORMLY","OBJECT_INSIDE","_old_obj_version","updatePoints","generatePoints","side","polarToCartesian","generateSphericalNormals","generateSphere","generateHemisphere","generateInsideCircle","generateInsideSphere","generateFromObject","generateFromInsideObject","r1","r2","u","theta","cbrt","sinTheta","cosTheta","sinPhi","cosPhi","evenly","mesh_normals","indices","vertexBuffers","indexBuffers","triangles","num_triangles","total_area","P1","P2","P3","aL","bL","cL","sqrt_s","af","bf","cf","N","aabb","getBoundingBox","octree","Octree","tries","hit","testRay","ALL","NORMAL","VERTICAL","SPHERICAL","RANDOM","RANDOM_VERTICAL","modes","geo","_geometry_id","updateInstances","FRONT","front","setTranslation","normal","model","typedArrayToArray","updateGeometry","_output","old_vertices","multiplyVec3","normal_model","transpose","old_normals","coords","_geo","extrudeGeometry","tempC","tempD","new_vertices","npos","x2","y2","z2","Uint32Array","buffer","updateMesh","buffer_data","common_buffers","spacing","mesh_buffer","upload","DYNAMIC_DRAW","Buffer","ELEMENT_ARRAY_BUFFER","ARRAY_BUFFER","addBuffer","updateBoundingBox","PRIMITIVE_VALUES","POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLE_FAN","TRIANGLE_STRIP","shaders","vertex_shader_code","fragment_shader_code","USE_TEXTURE","depthMask","VALID","_mesh","cube","plane","xz","cylinder","sphere","lat","circle","slices","hemi","icosahedron","cone","USE_TEXTURED_POINTS","USE_POINTS","LGraphFXLens","aberration","distortion","pixel_data","LGraphFXBokeh","LGraphFXGeneric","value1","value2","LGraphFXVigneting","u_aberration","u_distortion","u_blur","blurred_tex","mask_tex","shape_tex","first_shader","_first_shader","_first_pixel_shader","second_shader","_second_shader","_second_vertex_shader","_second_pixel_shader","points_mesh","_points_mesh","_width","_height","_spacing","createPointsMesh","screen_mesh","min_light","u_texture_blur","u_texsize","u_shape","u_alpha","u_pointSize","u_itexsize","nwidth","nheight","ny","dx","dy","nx","vertices2D","pixel_shader_code","camera_planes","camera","_current_camera","near","far","u_noise","u_size","u_rand","u_value1","u_value2","pixel_shader_halftone","pixel_shader_pixelate","pixel_shader_lowpalette","pixel_shader_noise","pixel_shader_gamma","MIDI_COLOR","MIDIEvent","cmd","setup","fromJSON","raw_data","midiStatus","midiCommand","NOTEON","velocity","NOTEOFF","cmd_str","commands","notes","note_to_index","D","E","F","toNoteString","octave","getPitch","computePitch","note","getCC","getCCValue","getPitchBend","computePitchBend","setCommandFromString","computeCommandFromString","KEYPRESSURE","CONTROLLERCHANGE","PROGRAMCHANGE","CHANNELPRESSURE","PITCHBEND","TIMETICK","d","skip_octave","NoteStringToPitch","pitch","toHexString","toJSON","object_class","commands_short","commands_reversed","MIDIInterface","on_ready","requestMIDIAccess","state","cc","input_ports","input_ports_info","output_ports","output_ports_info","onMIDISuccess","onMIDIFailure","LGMIDIIn","port","_last_midi_event","_current_midi_event","midi","_midi","_waiting","LGMIDIOut","getMIDIOutputs","LGMIDIShow","LGMIDIFilter","_learning","LGMIDIEvent","midi_event","gate","LGMIDICC","LGMIDIGenerator","notes_pitches","processScale","sequence_index","LGMIDITranspose","amount","LGMIDIQuantize","valid_notes","offset_notes","LGMIDIFromFile","_current_time","_playing","MidiParser","LGMIDIPlay","volume","AudioSynth","Synth","synth","instrument","createInstrument","LGMIDIKeys","num_octaves","start_octave","midiAccess","updatePorts","it","it_value","next","done","port_info","manufacturer","num_input_ports","num_output_ports","openInputPort","input_port","onmidimessage","updateState","on_message","parseMsg","sendMIDI","midi_data","output_port","onMIDIEvent","default_ports","_current_scale","loadMIDIFile","current_time","track","_last_pos","_time","deltaTime","midi_cmd","num_keys","key_width","key_height","key_info","getKeyIndex","start_note","LGAudio","LGAudioSource","gain","loop","playbackRate","_loading_audio","_audiobuffer","_audionodes","_last_sourcenode","getAudioContext","audionode","createGain","graphnode","loadSound","LGAudioMediaSource","_media_stream","LGAudioAnalyser","fftSize","minDecibels","maxDecibels","smoothingTimeConstant","createAnalyser","_freq_bin","_time_bin","LGAudioGain","LGAudioConvolver","impulse_src","createConvolver","LGAudioDynamicsCompressor","knee","ratio","reduction","attack","release","createDynamicsCompressor","LGAudioWaveShaper","createWaveShaper","LGAudioMixer","gain1","gain2","audionode1","audionode2","LGAudioADSR","LGAudioDelay","delayTime","createDelay","LGAudioBiquadFilter","frequency","detune","createBiquadFilter","LGAudioOscillatorNode","createOscillator","LGAudioVisualization","continuous","mark","_last_buffer","LGAudioBandSignal","band","LGAudioScript","default_function","createScriptProcessor","processCode","_bypass_function","onaudioprocess","LGAudioDestination","destination","_audio_context","AudioContext","webkitAudioContext","onmessage","onended","oncomplete","audionodeA","audionodeB","disconnect","changeAllAudiosConnections","origin_audionode","getAudioNodeInOutputSlot","target_audionode","getAudioNodeInInputSlot","connection","connected","local_audionode","createAudioNodeWrapper","class_object","old_func","cached_audios","onProcessAudioURL","request","responseType","decodeAudioData","onError","playBuffer","stopAllSounds","onPause","pauseAllSounds","onUnpause","unpauseAllSounds","_dropped_url","started","suspend","resume","createBufferSource","_request","abort","audiosource_node","createMediaStreamSource","bufferLength","frequencyBinCount","getByteFrequencyData","getByteTimeDomainData","onRemove","loadImpulse","_impulse_buffer","_loading_impulse","curve","setWaveShape","current_gate","cancelScheduledValues","setValueAtTime","linearRampToValueAtTime","binfreq","sampleRate","_freqs","_callback","_script","_old_code","audioProcessingEvent","inputBuffer","outputBuffer","numberOfChannels","inputData","getChannelData","outputData","sample","LGWebSocket","room","only_send_changes","_ws","_last_sent_data","_last_received_data","LGSillyClient","room_widget","setRoom","connectSocket","_server","HTTPRequestNode","_fetching","readyState","WebSocket","OPEN","only_changes","onopen","room_name","is_connected","prev_data","is_equal","sendMessage","SillyClient","_error","on_close","_final_url","resp","out$","xmlNs","svgNs","urlRegex","fontFormats","woff2","woff","otf","ttf","eot","sfnt","svg","isElement","HTMLElement","SVGElement","requireDomNode","el","requireDomNodePromise","Promise","resolve","reject","getDimension","dim","viewBox","baseVal","getAttribute","match","getComputedStyle","getPropertyValue","uriToBlob","uri","byteString","atob","mimeString","ArrayBuffer","intArray","charCodeAt","cachedFonts","cachedRules","inlineCss","_ref","selectorRemap","modifyStyle","modifyCss","fonts","excludeUnusedCss","generateCss","selector","css","detectFonts","fontList","from","styleSheets","sheet","rules","cssRules","_ref2","rule","query","selectorText","cssText","fontUrl","formats","fullUrl","extension","detectCssFont","all","fontInBase64","binary","bytes","byteLength","fromCharCode","arrayBufferToBase64","fontUri","fontCss","inlineFonts","downloadOptions","msSaveOrOpenBlob","popup","prepareSvg","_ref3","_ref3$left","_ref3$top","_ref3$scale","_ref3$responsive","responsive","_ref3$excludeCss","excludeCss","image","getAttributeNS","valueOf","crossOrigin","setAttributeNS","toDataURL","inlineImages","cloneNode","backgroundColor","_getDimensions","tagName","getBBox","_el$getBBox","getDimensions","createElementNS","removeAttribute","foreignObject","defs","insertBefore","firstChild","outer","svgAsDataUri","_ref4","svgXml","decodeURIComponent","svgAsPngUri","_ref5","_ref5$encoderType","encoderType","_ref5$encoderOptions","encoderOptions","canvg","convertToPng","_ref6","pixelRatio","devicePixelRatio","png","SecurityError","download","saveLink","onclick","saveSvg","downloadOpts","saveSvgAsPng","stylesInDOM","getIndexByIdentifier","identifier","modulesToDom","idCountMap","identifiers","base","indexByIdentifier","sourceMap","references","updater","addElementStyle","byIndex","api","domAPI","newObj","lastIdentifiers","newList","newLastIdentifiers","_i","_index","memo","insert","styleTarget","HTMLIFrameElement","contentDocument","head","getTarget","setAttributes","attributes","styleElement","nonce","insertStyleElement","styleTagTransform","removeStyleElement","styleSheet","createTextNode","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","getter","__esModule","definition","Symbol","toStringTag","getCurrentScript","script","currentScript","doc_scripts","scripts","async","textContent","isLocalScript","jsonpScriptSrc","__jsonpScriptSrc__","chunkId","isLocal","srcFragments","fileFragments","nc","_regeneratorRuntime","iterator","asyncIterator","define","writable","Generator","makeInvokeMethod","tryCatch","arg","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","defineIteratorMethods","_invoke","AsyncIterator","invoke","_typeof","__await","callInvokeWithMethodAndArg","method","delegate","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","TypeError","resultName","nextLoc","pushTryEntry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","displayName","isGeneratorFunction","setPrototypeOf","__proto__","awrap","reverse","rval","complete","delegateYield","asyncGeneratorStep","_asyncToGenerator","arguments","_next","_throw","_arrayLikeToArray","Mermaid","chart","export_trigger","setProps","mermaidRef","useRef","scriptRef","_React$useState2","React","isArray","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","lastExportTrigger","setLastExportTrigger","generateImage","_callee","svgElement","dateStr","timeStr","fileName","getFullYear","getMonth","padStart","getDate","getHours","getMinutes","getSeconds","t0","t1","useEffect","renderDiagram","_callee2","_context2","mermaid","initialize","_objectSpread","startOnLoad","theme","securityLevel","run","ref","padding","defaultProps","propTypes","PropTypes","isRequired","userAgent","useLayoutEffect","typename","types","args","matches","find","firstElementChild","children","datum","namespaceURI","_parent","__data__","enter","exit","groupLength","dataLength","keyValue","nodeByKeyValue","Map","keyValues","has","delete","NaN","child","xhtml","xlink","xml","xmlns","prefix","space","local","fullname","removeAttributeNS","removeProperty","string","_node","_names","documentElement","__on","listener","CustomEvent","initEvent","bubbles","cancelable","contains","parents","_parents","subgroups","subgroup","selectAll","selectChild","selectChildren","enterGroup","updateGroup","previous","i0","i1","_enter","_exit","onenter","onupdate","onexit","selection","append","groups0","groups1","m0","m1","merges","group0","group1","compareDocumentPosition","compare","compareNode","sortgroups","sortgroup","empty","each","attr","classed","raise","lower","before","deep","typenames","dispatch","passive","view","__noselect","MozUserSelect","noclick","exp","zoomRho","rho","rho2","rho4","zoom","ux0","uy0","w0","ux1","uy1","w1","d2","d1","b0","b1","r0","coshr0","SQRT2","_1","_2","sourceEvent","currentTarget","ownerSVGElement","createSVGPoint","matrixTransform","getScreenCTM","inverse","clientLeft","clientTop","pageX","pageY","_call","delay","restart","t2","Infinity","timing","schedules","__transition","tween","timer","tick","ease","schedule","active","translateX","translateY","skewX","scaleX","scaleY","pxComma","pxParen","degParen","xa","ya","xb","yb","DOMMatrix","WebKitCSSMatrix","isIdentity","consolidate","matrix","tween0","tween1","factory","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","blanchedalmond","blueviolet","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","rebeccapurple","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","wheat","whitesmoke","yellowgreen","rgb","formatHex","formatRgb","exec","m2","v0","v3","t3","displayable","formatHex8","formatHsl","brighter","darker","rgbGamma","end","spline","source","am","bm","bs","bi","lastIndex","interpolate","string00","interpolate0","string1","string0","string10","inherit","id0","id1","on0","on1","sit","every","attrTween","styleTween","listener0","textTween","easeVarying","cancel","interrupt","defineProperties","applyX","applyY","invertX","invertY","rescaleX","domain","rescaleY","ConnectionMode","BackgroundVariant","PanOnScrollMode","ConnectionLineType","MarkerType","Position","hasAttribute","clientWidth","clientHeight","__zoom","deltaMode","maxTouchPoints","extent","translateExtent","dx0","dx1","dy0","dy1","len","arr2","minLen","_s","_e","_arr","_n","_d","val","_element$getRootNode","_window","getRootNode","box1","box2","isFinite","enumerableOnly","getOwnPropertySymbols","symbols","sym","getOwnPropertyDescriptor","getOwnPropertyDescriptors","updateItem","extendWidth","extendHeight","_parent$style$width","_parent$style$height","xDiff","yDiff","changes","some","initElements","reduce","currentChange","positionAbsolute","expandParent","_updateItem","dimensions","items","selectedIds","willBeSelected","nodeElement","handles","handlesArray","nodeBounds","handleBounds","getState","handler","nodeInternals","store","_store$getState","addSelectedNodes","unselectNodesAndEdges","multiSelectionActive","setState","nodesSelectionActive","rfId","idPrefix","edgeParams","edges","edge","sourceHandle","targetHandle","snapToGrid","tx","ty","tScale","snapX","snapY","box","currBox","_ref7","_ref9","partially","excludeNonSelectableNodes","rBox","visibleNodes","_node$selectable","selectable","nBox","xOverlap","yOverlap","overlappingArea","ceil","nodeIds","bounds","minZoom","maxZoom","xZoom","yZoom","clampedZoom","parentNodes","_result$x","_parentNode$position$","_parentNode$position","_result$y","_parentNode$position$2","_parentNode$position2","_parentNode$internals","_parentNode$internals2","_result$z","_parentNode$internals3","_parentNode$internals4","_result$z2","nextNodeInternals","_currInternals$intern","zIndex","currInternals","internals","_node$internalsSymbol","_node$internalsSymbol2","_calculateXYZPosition","isParent","_get","d3Zoom","d3Selection","fitViewOnInitDone","fitViewOnInit","initial","includeHiddenNodes","hidden","nodesInitialized","_options$minZoom","_options$maxZoom","_options$padding","_getTransformForBound2","nextTransform","nodeChanges","_objectSpread2","edgeChanges","changedNodes","changedEdges","_get2","onNodesChange","onEdgesChange","hasDefaultNodes","hasDefaultEdges","NEGATIVE_INFINITY","POSITIVE_INFINITY","d3ZoomHandler","nodeExtent","userSelectionActive","connectionNodeId","connectionHandleId","connectionHandleType","connectionPosition","connectionMode","Strict","domNode","snapGrid","nodesDraggable","nodesConnectable","elementsSelectable","fitViewOnInitOptions","reactFlowVersion","connectionStartHandle","connectOnClick","ZustandContext","createContext","Provider","initialStore","createStore","storeRef","useStore","equalityFn","is","useProviderStore","useContext","useStoreApi","useMemo","subscribe","destroy","createState","listeners","Set","partial","nextState","previousState","currentSlice","listenerToAdd","nextSlice","previousSlice","subscribeWithSelector","forceUpdate","useReducer","stateRef","selectorRef","equalityFnRef","erroredRef","currentSliceRef","newStateSlice","hasNewStateSlice","stateBeforeSubscriptionRef","nextStateSlice","unsubscribe","sliceToReturn","useDebugValue","setNodes","setEdges","_get$defaultEdgeOptio","defaultEdgeOptions","setDefaultNodesAndEdges","updateNodeDimensions","updates","viewportNode","DOMMatrixReadOnly","m22","nextFitViewOnInitDone","updateNodePositions","nodeDragItems","positionChanged","_get3","selectedNodeIds","_get4","nodeId","addSelectedEdges","selectedEdgeIds","_get5","edgeId","_get6","storeEdges","edgesToUnselect","setMinZoom","_get7","scaleExtent","setMaxZoom","_get8","setTranslateExtent","resetSelectedElements","_get10","setNodeExtent","objA","objB","keysA","iter","zoomIn","zoomOut","zoomTo","getZoom","setViewport","fitView","setCenter","__","fitBounds","project","viewportInitialized","viewportHelper","_useStore","scaleBy","zoomLevel","scaleTo","_transform$x","_transform$y","_transform$zoom","_store$getState$trans","_store$getState$trans2","nextZoom","centerX","centerY","_store$getState2","_store$getState3","getNodes","useCallback","getNode","getEdges","_store$getState3$edge","getEdge","_store$getState4$edge","payload","_store$getState5","nextNodes","_store$getState6","_store$getState6$edge","nextEdges","addNodes","_store$getState7","currentNodes","addEdges","_store$getState8","_store$getState8$edge","toObject","_store$getState9","_store$getState9$edge","_transform","excluded","sourceKeys","sourceSymbolKeys","propertyIsEnumerable","rest","_ref2$showZoom","showZoom","_ref2$showFitView","showFitView","_ref2$showInteractive","showInteractive","fitViewOptions","onZoomIn","onZoomOut","onFitView","onInteractiveChange","_useState2","useState","isVisible","setIsVisible","isInteractive","_useReactFlow","onClick","subject","proOptions","_ref$position","account","hideAttribution","positionClasses","rel","_ref$labelStyle","labelStyle","_ref$labelShowBg","labelShowBg","_ref$labelBgStyle","labelBgStyle","_ref$labelBgPadding","labelBgPadding","_ref$labelBgBorderRad","labelBgBorderRadius","edgeRef","edgeTextBbox","setEdgeTextBbox","edgeTextClasses","textBbox","rx","ry","path","markerEnd","markerStart","ctX","ctY","x1","y1","Left","Right","Top","Bottom","sourceX","sourceY","_ref2$sourcePosition","sourcePosition","targetX","targetY","_ref2$targetPosition","targetPosition","_getControl2","sourceControlX","sourceControlY","_getControl4","targetControlX","targetControlY","_ref4$sourcePosition","_ref4$targetPosition","_getSimpleBezierCente","_ref3$sourcePosition","_ref3$targetPosition","_getControl6","_getControl8","_getSimpleBezierCente2","_ref$sourcePosition","_ref$targetPosition","sourceIsLeftOrRight","targetIsLeftOrRight","_xOffset","_centerX","_yOffset","xOffset","yOffset","_ref$borderRadius","_getCenter2","_centerY","offsetX","offsetY","cornerWidth","cornerHeight","cornerSize","leftAndRight","cX","cY","firstCornerPath","secondCornerPath","_ref2$borderRadius","_getCenter4","curvature","_ref2$curvature","_getControlWithCurvat2","_getControlWithCurvat4","_getBezierCenter","_ref3$curvature","_getControlWithCurvat6","_getControlWithCurvat8","_getBezierCenter2","isTarget","handleId","elementBelow","elementFromPoint","elementBelowIsTarget","elementBelowIsSource","isValid","isHoveringHandle","elementBelowNodeId","elementBelowHandleId","hoveredHandle","onConnect","elementEdgeUpdaterType","onEdgeUpdateEnd","reactFlowNode","recentHoveredHandle","_getState","onConnectStart","handleType","containerBounds","_getState2","onConnectStop","onConnectEnd","_checkElementBelowIsV2","_checkElementBelowIsV","Consumer","forwardRef","_ref$type","_ref$isValidConnectio","_ref$isConnectable","isConnectable","onConnectExtended","onConnectAction","connectable","connecting","onClickConnectStart","onClickConnectStop","onClickConnectEnd","selectedNodes","selectedEdges","selectedNodeIdsA","selectedNodeIdsB","selectedEdgeIdsA","selectedEdgeIdsB","setStoreState","defaultNodes","defaultEdges","onNodesDelete","onEdgesDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","_ref$radius","cx","cy","EdgeComponent","EdgeWrapper","onEdgeDoubleClick","animated","sourceHandleId","targetHandleId","onContextMenu","edgeUpdaterRadius","onEdgeUpdate","onEdgeUpdateStart","updating","setUpdating","onEdgeDoubleClickHandler","onEdgeContextMenu","onEdgeMouseEnter","onEdgeMouseMove","onEdgeMouseLeave","handleEdgeUpdater","isSourceHandle","_onEdgeUpdateEnd","onEdgeUpdaterMouseEnter","onEdgeUpdaterMouseOut","markerStartUrl","markerEndUrl","handleEdgeUpdate","edgeClasses","onDoubleClick","onMouseOut","edgeTypes","standardTypes","straight","bezier","smoothstep","simplebezier","specialTypes","nodeRect","_node$positionAbsolut","_node$positionAbsolut2","_node$positionAbsolut3","_node$positionAbsolut4","isInvalid","keyPressed","setKeyPressed","pressedKeys","_useMemo2","kc","keysFlat","keyCodes","keysToWatch","_options$target","_options$target2","downHandler","keyOrCode","upHandler","resetHandler","_options$target3","_options$target4","isUp","eventCode","_event$composedPath","composedPath","eventViewport","onMove","onMoveStart","onMoveEnd","_ref$zoomOnScroll","zoomOnScroll","_ref$zoomOnPinch","zoomOnPinch","_ref$panOnScroll","panOnScroll","_ref$panOnScrollSpeed","panOnScrollSpeed","_ref$panOnScrollMode","panOnScrollMode","Free","_ref$zoomOnDoubleClic","zoomOnDoubleClick","selectionKeyPressed","_ref$panOnDrag","panOnDrag","_ref$defaultZoom","defaultZoom","_ref$defaultPosition","defaultPosition","zoomActivationKeyCode","_ref$preventScrolling","preventScrolling","noWheelClassName","noPanClassName","isZoomingOrPanning","zoomPane","prevTransform","zoomActivationKeyPressed","rendererNode","resizeObserver","updateDimensions","onresize","ResizeObserver","observe","unobserve","_selection$node","d3ZoomInstance","touchstarting","touchfirst","touchending","constrain","touchable","clickDistance2","tapDistance","wheeled","mousedowned","dblclicked","touchstarted","touchmoved","touchended","centroid","gesture","clean","__zooming","Gesture","taps","moved","x0","y0","changedTouches","k1","touches","touch0","touch1","l0","l1","dp","dl","hypot","collection","translateBy","translateTo","emit","clickDistance","clampedX","clampedY","updatedTransform","currentZoom","pinchDelta","_zoom","deltaNormalize","Vertical","Horizontal","flowTransform","prevViewport","zoomScroll","pinchZoom","startX","startY","prevSelectedNodesCount","prevSelectedEdgesCount","userSelectionRect","setUserSelectionRect","resetUserSelection","mousePos","_userSelectionRect$st","_userSelectionRect$st2","nextUserSelectRect","_changes","nodeRef","parentElement","_n$positionAbsolute$x","_n$positionAbsolute","_n$positionAbsolute$y","_n$positionAbsolute2","dragItems","extentedDragItems","selectionFunc","_ref$disabled","noDragClassName","handleSelector","isSelectable","selectNodesOnDrag","setDragging","lastPos","getPointerPosition","dragHandler","mousedownx","mousedowny","mousemoving","gestures","drag","beforestart","mousemoved","mouseupped","touch","_nodeInternals$get","pointerPos","_getEventHandlerParam2","currentNode","dragItem","currentExtent","nextPosition","_parent$positionAbsol","_parent$positionAbsol2","_parent$positionAbsol3","_parent$positionAbsol4","parentX","parentY","parentPosition","_parentNode$positionA","_parentNode$positionA2","_parentNode$positionA3","_parentNode$positionA4","onDrag","_getEventHandlerParam4","_store$getState4","_updateNodePositions","_nodeInternals","_getEventHandlerParam6","_currentNode","transformString","onSelectionContextMenu","_useStore2","onPaneClick","onPaneContextMenu","onPaneScroll","deleteKeyCode","selectionKeyCode","multiSelectionKeyCode","deleteKeyPressed","multiSelectionKeyPressed","nodesToRemove","connectedEdges","edgesToRemove","edgeIdsToRemove","onWheel","onlyRenderVisible","onlyRenderVisibleElements","resizeObserverRef","observer","_resizeObserverRef$cu","_node$internalsSymbol3","nodeTypes","NodeComponent","isDraggable","draggable","xPos","yPos","onNodeClick","onNodeMouseEnter","onNodeMouseMove","onNodeMouseLeave","onNodeContextMenu","onNodeDoubleClick","dragHandle","initialized","_fromNode$internalsSy","_fromNode$width","_fromNode$height","_fromNode$positionAbs","_fromNode$positionAbs2","connectionLineStyle","_ref$connectionLineTy","connectionLineType","Bezier","CustomConnectionLineComponent","fromNode","toX","toY","fromHandleBounds","handleBound","fromHandle","fromHandleX","fromHandleY","fromX","fromY","fromPosition","toPosition","sourceNode","dAttr","pathParams","Step","SmoothStep","SimpleBezier","Arrow","_ref$color","_ref$strokeWidth","strokeWidth","strokeLinecap","strokeLinejoin","ArrowClosed","_ref2$color","_ref2$strokeWidth","_ref$width","_ref$height","_ref$markerUnits","markerUnits","_ref$orient","orient","_Symbol","markerWidth","markerHeight","refX","refY","defaultColor","markers","markerId","level","isMaxLevel","edgeTree","elevateEdgesOnSelect","maxLevel","levelLookup","tree","_nodeInternals$get$in","_nodeInternals$get2","_nodeInternals$get2$i","hasZIndex","targetNode","sourcePos","targetPos","sourceWidth","sourceHeight","targetWidth","targetHeight","edgeBox","defaultMarkerColor","connectionLineComponent","connectionLineContainerStyle","renderConnectionLine","_getNodeData2","sourceNodeRect","sourceHandleBounds","sourceIsValid","_getNodeData4","targetNodeRect","targetHandleBounds","targetIsValid","edgeType","targetNodeHandles","_getEdgePositions","sourceHandlePos","targetHandlePos","onEdgeClick","onInit","ReactFlowInstance","isInitialized","NodeWrapper","prevSourcePosition","prevTargetPosition","prevType","hasPointerEvents","onMouseEnterHandler","onMouseMoveHandler","onMouseLeaveHandler","onContextMenuHandler","onDoubleClickHandler","currNode","typeChanged","sourcePosChanged","targetPosChanged","visibility","nodeOrEdgeTypes","createTypes","isWrapped","_ref$nodeTypes","_ref$edgeTypes","_ref$connectionMode","_ref$deleteKeyCode","_ref$selectionKeyCode","_ref$multiSelectionKe","_ref$zoomActivationKe","_ref$snapToGrid","_ref$snapGrid","_ref$onlyRenderVisibl","_ref$selectNodesOnDra","_ref$minZoom","_ref$maxZoom","_ref$translateExtent","_ref$defaultMarkerCol","_ref$edgeUpdaterRadiu","_ref$noDragClassName","_ref$noWheelClassName","_ref$noPanClassName","_ref$fitView","_ref$connectOnClick","attributionPosition","_ref$elevateEdgesOnSe","nodeTypesWrapped","edgeTypesWrapped","applyChanges","initialItems","setItems","onItemsChange","strokeColor","shapeRendering","background","viewBBox","_style$width","_style$height","rect1","rect2","_ref$nodeStrokeColor","nodeStrokeColor","_ref$nodeColor","nodeColor","_ref$nodeClassName","nodeClassName","_ref$nodeBorderRadius","nodeBorderRadius","_ref$nodeStrokeWidth","nodeStrokeWidth","_ref$maskColor","maskColor","elementWidth","elementHeight","nodeColorFunc","nodeStrokeColorFunc","nodeClassNameFunc","boundingRect","scaledWidth","scaledHeight","viewScale","viewWidth","viewHeight","chrome","fillRule","Dots","Lines","_ref$variant","variant","_ref$gap","gap","_ref$size","patternId","setPatternId","tX","tY","bgs","scaledGap","isLines","bgColor","patternUnits","counter","arrayLike","styleProperty","leftBorder","rightBorder","topBorder","bottomBorder","decode","decoding","instance","nodePrototype","nativeNode","clonedNode","pseudo","getPropertyPriority","jpg","jpeg","gif","tiff","webp","search","mimeType","init","onloadend","resourceUrl","contentType","cacheKey","includeQueryParams","dataURL","cacheBust","fetchRequestInit","headers","imagePlaceholder","isRoot","HTMLCanvasElement","HTMLVideoElement","currentSrc","poster","iframe","_a","_b","assignedNodes","shadowRoot","deferred","clonedChild","Element","targetStyle","sourceStyle","transformOrigin","endsWith","reducedFont","HTMLTextAreaElement","HTMLInputElement","HTMLSelectElement","clonedSelect","selectedOption","uses","processedDefs","exist","ns","baseUrl","filteredCSSText","preferredFontFormat","urls","raw","quotation","resourceURL","baseURL","getContentFromUrl","resolvedURL","implementation","createHTMLDocument","escaped","propValue","cssString","isImageElement","HTMLImageElement","SVGImageElement","loading","srcset","deferreds","cache","regexUrl","loadFonts","keyframesRegex","importRegex","unifiedRegex","fontEmbedCSS","skipFonts","CSSRule","IMPORT_RULE","importIndex","metadata","insertRule","inline","FONT_FACE_RULE","parentStyleSheet","styleNode","sytleContent","manual","XMLSerializer","serializeToString","FlowWithDownload","_objectWithoutProperties","_excluded","reactFlowInstance","useReactFlow","flowNodes","nodesBounds","getRectOfNodes","imageWidth","imageHeight","getTransformForBounds","flowElement","FINAL_PROCESS","env","canvasWidth","canvasHeight","skipAutoScale","toPng","dataUrl","ReactFlow","_extends","Controls","MiniMap","Background","Reactflow","_Component","_classCallCheck","_callSuper","_inherits","_this$props","node_types","edge_types","min_zoom","max_zoom","default_zoom","default_position","fit_view","snap_to_grid","snap_grid","nodes_draggable","nodes_connectable","elements_selectable","pan_on_drag","pan_on_scroll","zoom_on_scroll","zoom_on_pinch","connection_mode","ReactFlowProvider","nodes_change","edges_change","clicked_node","clicked_edge","Component","locals","Litegraph","_this","serializedData","serializedGraph","canvasRef","initGraph","serializeGraph","handleSerialize","prevProps","updateNodes","autostart","setupPointerEvents","_this2","nodeData","conn","originNode","_this3","lastNodeAdded","_node$inputs","_node$outputs","nodeDblClicked","lastNodeRemoved","nodeOutput","nodeInput","pointerEvent","createPointerEvent","connectionData","lastConnectionChange","_this$props2","touchAction","border"],"sourceRoot":""}